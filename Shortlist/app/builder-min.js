/*! Storymaps-Shortlist - v2.0.0 - 2016-09-15, 01:17:13 AM - This application is released under the Apache License V2.0 by Esri http://www.esri.com/ - https://github.com/Esri/map-series-storytelling-template-js */function FastClick(e){"use strict";var t,n=this;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e;if(!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(n,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(n,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(n,arguments)};if(FastClick.notNeeded(e))return;this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;t==="click"?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;t==="click"?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),typeof e.onclick=="function"&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null)}define("lib-build/css",[],function(){if(typeof window=="undefined")return{load:function(e,t,n){n()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/)||0,n=!1,r=!0;t[1]||t[7]?n=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]?r=!1:t[4]&&(n=parseInt(t[4])<18);var i={};i.pluginBuilder="./css-builder";var s,o=function(){s=document.createElement("style"),e.appendChild(s)},u=function(e,t){o();var n=s.styleSheet||s.sheet;if(n&&n.addImport)n.addImport(e),s.onload=t;else{s.textContent='@import "'+e+'";';var r=setInterval(function(){try{s.sheet.cssRules,clearInterval(r),t()}catch(e){}},10)}},a=function(t,n){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet";if(r)i.onload=function(){i.onload=function(){},setTimeout(n,7)};else var s=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];if(t.href==i.href)return clearInterval(s),n()}},10);i.href=t,e.appendChild(i)};return i.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)},i.load=function(e,t,r,i){(n?u:a)(t.toUrl(e+".css"),r)},i}),define("lib-build/css!lib-app/bootstrap/css/bootstrap.min",[],function(){}),define("lib-build/css!storymaps/common/ui/Modal",[],function(){}),define("lib-build/css!storymaps/common/Core",[],function(){}),!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function y(e){var t=e.length,n=p.type(e);return"function"===n||p.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function x(e,t,n){if(p.isFunction(t))return p.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return p.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(S.test(t))return p.filter(t,e,n);t=p.filter(t,e)}return p.grep(e,function(e){return p.inArray(e,t)>=0!==n})}function O(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function D(e){var t=_[e]={};return p.each(e.match(M)||[],function(e,n){t[n]=!0}),t}function H(){N.addEventListener?(N.removeEventListener("DOMContentLoaded",B,!1),e.removeEventListener("load",B,!1)):(N.detachEvent("onreadystatechange",B),e.detachEvent("onload",B))}function B(){(N.addEventListener||"load"===event.type||"complete"===N.readyState)&&(H(),p.ready())}function R(e,t,n){if(void 0===n&&1===e.nodeType){var r="data-"+t.replace(q,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:I.test(n)?p.parseJSON(n):n}catch(i){}p.data(e,t,n)}else n=void 0}return n}function U(e){var t;for(t in e)if(("data"!==t||!p.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function z(e,t,r,i){if(p.acceptData(e)){var s,o,u=p.expando,a=e.nodeType,f=a?p.cache:e,l=a?e[u]:e[u]&&u;if(l&&f[l]&&(i||f[l].data)||void 0!==r||"string"!=typeof t)return l||(l=a?e[u]=n.pop()||p.guid++:u),f[l]||(f[l]=a?{}:{toJSON:p.noop}),("object"==typeof t||"function"==typeof t)&&(i?f[l]=p.extend(f[l],t):f[l].data=p.extend(f[l].data,t)),o=f[l],i||(o.data||(o.data={}),o=o.data),void 0!==r&&(o[p.camelCase(t)]=r),"string"==typeof t?(s=o[t],null==s&&(s=o[p.camelCase(t)])):s=o,s}}function W(e,t,n){if(p.acceptData(e)){var r,i,s=e.nodeType,o=s?p.cache:e,u=s?e[p.expando]:p.expando;if(o[u]){if(t&&(r=n?o[u]:o[u].data)){p.isArray(t)?t=t.concat(p.map(t,p.camelCase)):t in r?t=[t]:(t=p.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!U(r):!p.isEmptyObject(r))return}(n||(delete o[u].data,U(o[u])))&&(s?p.cleanData([e],!0):c.deleteExpando||o!=o.window?delete o[u]:o[u]=null)}}}function tt(){return!0}function nt(){return!1}function rt(){try{return N.activeElement}catch(e){}}function it(e){var t=st.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Et(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==j?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==j?e.querySelectorAll(t||"*"):void 0;if(!s)for(s=[],n=e.childNodes||e;null!=(r=n[i]);i++)!t||p.nodeName(r,t)?s.push(r):p.merge(s,Et(r,t));return void 0===t||t&&p.nodeName(e,t)?p.merge([e],s):s}function St(e){K.test(e.type)&&(e.defaultChecked=e.checked)}function xt(e,t){return p.nodeName(e,"table")&&p.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Tt(e){return e.type=(null!==p.find.attr(e,"type"))+"/"+e.type,e}function Nt(e){var t=mt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Ct(e,t){for(var n,r=0;null!=(n=e[r]);r++)p._data(n,"globalEval",!t||p._data(t[r],"globalEval"))}function kt(e,t){if(1===t.nodeType&&p.hasData(e)){var n,r,i,s=p._data(e),o=p._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)p.event.add(t,n,u[n][r])}o.data&&(o.data=p.extend({},o.data))}}function Lt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!c.noCloneEvent&&t[p.expando]){i=p._data(t);for(r in i.events)p.removeEvent(t,r,i.handle);t.removeAttribute(p.expando)}"script"===n&&t.text!==e.text?(Tt(t).text=e.text,Nt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),c.html5Clone&&e.innerHTML&&!p.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&K.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function Mt(t,n){var r=p(n.createElement(t)).appendTo(n.body),i=e.getDefaultComputedStyle?e.getDefaultComputedStyle(r[0]).display:p.css(r[0],"display");return r.detach(),i}function _t(e){var t=N,n=Ot[e];return n||(n=Mt(e,t),"none"!==n&&n||(At=(At||p("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(At[0].contentWindow||At[0].contentDocument).document,t.write(),t.close(),n=Mt(e,t),At.detach()),Ot[e]=n),n}function Ft(e,t){return{get:function(){var n=e();if(null!=n)return n?void delete this.get:(this.get=t).apply(this,arguments)}}}function $t(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Vt.length;while(i--)if(t=Vt[i]+n,t in e)return t;return r}function Jt(e,t){for(var n,r,i,s=[],o=0,u=e.length;u>o;o++)r=e[o],r.style&&(s[o]=p._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&$(r)&&(s[o]=p._data(r,"olddisplay",_t(r.nodeName)))):s[o]||(i=$(r),(n&&"none"!==n||!i)&&p._data(r,"olddisplay",i?n:p.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function Kt(e,t,n){var r=Ut.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Qt(e,t,n,r,i){for(var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;4>s;s+=2)"margin"===n&&(o+=p.css(e,n+V[s],!0,i)),r?("content"===n&&(o-=p.css(e,"padding"+V[s],!0,i)),"margin"!==n&&(o-=p.css(e,"border"+V[s]+"Width",!0,i))):(o+=p.css(e,"padding"+V[s],!0,i),"padding"!==n&&(o+=p.css(e,"border"+V[s]+"Width",!0,i)));return o}function Gt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=Ht(e),o=c.boxSizing()&&"border-box"===p.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Bt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Pt.test(i))return i;r=o&&(c.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Qt(e,t,n||(o?"border":"content"),r,s)+"px"}function Yt(e,t,n,r,i){return new Yt.prototype.init(e,t,n,r,i)}function un(){return setTimeout(function(){Zt=void 0}),Zt=p.now()}function an(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=V[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function fn(e,t,n){for(var r,i=(on[t]||[]).concat(on["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function ln(e,t,n){var r,i,s,o,u,a,f,l,h=this,d={},v=e.style,m=e.nodeType&&$(e),g=p._data(e,"fxshow");n.queue||(u=p._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,h.always(function(){h.always(function(){u.unqueued--,p.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=p.css(e,"display"),l=_t(e.nodeName),"none"===f&&(f=l),"inline"===f&&"none"===p.css(e,"float")&&(c.inlineBlockNeedsLayout&&"inline"!==l?v.zoom=1:v.display="inline-block")),n.overflow&&(v.overflow="hidden",c.shrinkWrapBlocks()||h.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],tn.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[r])continue;m=!0}d[r]=g&&g[r]||p.style(e,r)}if(!p.isEmptyObject(d)){g?"hidden"in g&&(m=g.hidden):g=p._data(e,"fxshow",{}),s&&(g.hidden=!m),m?p(e).show():h.done(function(){p(e).hide()}),h.done(function(){var t;p._removeData(e,"fxshow");for(t in d)p.style(e,t,d[t])});for(r in d)o=fn(m?g[r]:0,r,h),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}}function cn(e,t){var n,r,i,s,o;for(n in e)if(r=p.camelCase(n),i=t[r],s=e[n],p.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=p.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function hn(e,t,n){var r,i,s=0,o=sn.length,u=p.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;for(var t=Zt||un(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:p.extend({},t),opts:p.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Zt||un(),duration:n.duration,tweens:[],createTween:function(t,n){var r=p.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(cn(l,f.opts.specialEasing);o>s;s++)if(r=sn[s].call(f,e,l,f.opts))return r;return p.map(l,fn,f),p.isFunction(f.opts.start)&&f.opts.start.call(e,f),p.fx.timer(p.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function In(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(M)||[];if(p.isFunction(n))while(r=s[i++])"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,t,n,r){function o(u){var a;return i[u]=!0,p.each(e[u]||[],function(e,u){var f=u(t,n,r);return"string"!=typeof f||s||i[f]?s?!(a=f):void 0:(t.dataTypes.unshift(f),o(f),!1)}),a}var i={},s=e===Bn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Rn(e,t){var n,r,i=p.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&p.extend(!0,e,n),e}function Un(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function zn(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Kn(e,t,n,r){var i;if(p.isArray(t))p.each(t,function(t,i){n||Xn.test(e)?r(e,i):Kn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==p.type(t))r(e,t);else for(i in t)Kn(e+"["+i+"]",t[i],n,r)}function Zn(){try{return new e.XMLHttpRequest}catch(t){}}function er(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function sr(e){return p.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l="".trim,c={},h="1.11.0",p=function(e,t){return new p.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,v=/^-ms-/,m=/-([\da-z])/gi,g=function(e,t){return t.toUpperCase()};p.fn=p.prototype={jquery:h,constructor:p,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=p.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return p.each(this,e,t)},map:function(e){return this.pushStack(p.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},p.extend=p.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;for("boolean"==typeof o&&(f=o,o=arguments[u]||{},u++),"object"==typeof o||p.isFunction(o)||(o={}),u===a&&(o=this,u--);a>u;u++)if(null!=(i=arguments[u]))for(r in i)e=o[r],n=i[r],o!==n&&(f&&n&&(p.isPlainObject(n)||(t=p.isArray(n)))?(t?(t=!1,s=e&&p.isArray(e)?e:[]):s=e&&p.isPlainObject(e)?e:{},o[r]=p.extend(f,s,n)):void 0!==n&&(o[r]=n));return o},p.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===p.type(e)},isArray:Array.isArray||function(e){return"array"===p.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==p.type(e)||e.nodeType||p.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(c.ownLast)for(t in e)return f.call(e,t);for(t in e);return void 0===t||f.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&p.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(v,"ms-").replace(m,g)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=y(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:l&&!l.call("﻿ ")?function(e){return null==e?"":l.call(e)}:function(e){return null==e?"":(e+"").replace(d,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(y(Object(e))?p.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(n>r)e[i++]=t[r++];if(n!==n)while(void 0!==t[r])e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=y(e),a=[];if(u)for(;o>s;s++)r=t(e[s],s,n),null!=r&&a.push(r);else for(s in e)r=t(e[s],s,n),null!=r&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return"string"==typeof t&&(s=e[t],t=e,e=s),p.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||p.guid++,i):void 0},now:function(){return+(new Date)},support:c}),p.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var b=function(e){function rt(e,t,r,i){var s,o,u,a,f,h,v,m,w,E;if((t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,r=r||[],!e||"string"!=typeof e)return r;if(1!==(a=t.nodeType)&&9!==a)return[];if(p&&!i){if(s=G.exec(e))if(u=s[1]){if(9===a){if(o=t.getElementById(u),!o||!o.parentNode)return r;if(o.id===u)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&g(t,o)&&o.id===u)return r.push(o),r}else{if(s[2])return _.apply(r,t.getElementsByTagName(e)),r;if((u=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return _.apply(r,t.getElementsByClassName(u)),r}if(n.qsa&&(!d||!d.test(e))){if(m=v=y,w=t,E=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){h=dt(e),(v=t.getAttribute("id"))?m=v.replace(Z,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=h.length;while(f--)h[f]=m+vt(h[f]);w=Y.test(e)&&ht(t.parentNode)||t,E=h.join(",")}if(E)try{return _.apply(r,w.querySelectorAll(E)),r}catch(S){}finally{v||t.removeAttribute("id")}}}return xt(e.replace(R,"$1"),t,r,i)}function it(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function st(e){return e[y]=!0,e}function ot(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ut(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function at(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||k)-(~e.sourceIndex||k);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e){return e&&typeof e.getElementsByTagName!==C&&e}function pt(){}function dt(e,t){var n,i,s,o,u,a,f,l=x[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=U.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=z.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(R," ")}),u=u.slice(n.length));for(o in r.filter)!(i=$[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?rt.error(e):x(e,a).slice(0)}function vt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function mt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=E++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[w,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[y]||(t[y]={}),(u=a[r])&&u[0]===w&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function yt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function bt(e,t,n,r,i,s){return r&&!r[y]&&(r=bt(r)),i&&!i[y]&&(i=bt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||St(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:yt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=yt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=yt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function wt(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],f=o?1:0,l=mt(function(e){return e===t},a,!0),c=mt(function(e){return P.call(t,e)>-1},a,!0),h=[function(e,n,r){return!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];s>f;f++)if(n=r.relative[e[f].type])h=[mt(gt(h),n)];else{if(n=r.filter[e[f].type].apply(null,e[f].matches),n[y]){for(i=++f;s>i;i++)if(r.relative[e[i].type])break;return bt(f>1&&gt(h),f>1&&vt(e.slice(0,f-1).concat({value:" "===e[f-2].type?"*":""})).replace(R,"$1"),n,i>f&&wt(e.slice(f,i)),s>i&&wt(e=e.slice(i)),s>i&&vt(e))}h.push(n)}return gt(h)}function Et(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,a,f,l){var h,p,d,v=0,m="0",g=s&&[],y=[],b=u,E=s||i&&r.find.TAG("*",l),S=w+=null==b?1:Math.random()||.1,x=E.length;for(l&&(u=o!==c&&o);m!==x&&null!=(h=E[m]);m++){if(i&&h){p=0;while(d=e[p++])if(d(h,o,a)){f.push(h);break}l&&(w=S)}n&&((h=!d&&h)&&v--,s&&g.push(h))}if(v+=m,n&&m!==v){p=0;while(d=t[p++])d(g,y,o,a);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=O.call(f));y=yt(y)}_.apply(f,y),l&&!s&&y.length>0&&v+t.length>1&&rt.uniqueSort(f)}return l&&(w=S,u=b),g};return n?st(s):s}function St(e,t,n){for(var r=0,i=t.length;i>r;r++)rt(e,t[r],n);return n}function xt(e,t,i,s){var u,a,f,l,c,h=dt(e);if(!s&&1===h.length){if(a=h[0]=h[0].slice(0),a.length>2&&"ID"===(f=a[0]).type&&n.getById&&9===t.nodeType&&p&&r.relative[a[1].type]){if(t=(r.find.ID(f.matches[0].replace(et,tt),t)||[])[0],!t)return i;e=e.slice(a.shift().value.length)}u=$.needsContext.test(e)?0:a.length;while(u--){if(f=a[u],r.relative[l=f.type])break;if((c=r.find[l])&&(s=c(f.matches[0].replace(et,tt),Y.test(a[0].type)&&ht(t.parentNode)||t))){if(a.splice(u,1),e=s.length&&vt(a),!e)return _.apply(i,s),i;break}}}return o(e,h)(s,t,!p,i,Y.test(e)&&ht(t.parentNode)||t),i}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w=0,E=0,S=it(),x=it(),T=it(),N=function(e,t){return e===t&&(f=!0),0},C="undefined",k=1<<31,L={}.hasOwnProperty,A=[],O=A.pop,M=A.push,_=A.push,D=A.slice,P=A.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},H="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",F=j.replace("w","w#"),I="\\["+B+"*("+j+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+F+")|)|)"+B+"*\\]",q=":("+j+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),U=new RegExp("^"+B+"*,"+B+"*"),z=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),W=new RegExp("="+B+"*([^\\]'\"]*?)"+B+"*\\]","g"),X=new RegExp(q),V=new RegExp("^"+F+"$"),$={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+H+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,G=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Y=/[+~]/,Z=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),tt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{_.apply(A=D.call(b.childNodes),b.childNodes),A[b.childNodes.length].nodeType}catch(nt){_={apply:A.length?function(e,t){M.apply(e,D.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=rt.support={},s=rt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},l=rt.setDocument=function(e){var t,i=e?e.ownerDocument||e:b,o=i.defaultView;return i!==c&&9===i.nodeType&&i.documentElement?(c=i,h=i.documentElement,p=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){l()},!1):o.attachEvent&&o.attachEvent("onunload",function(){l()})),n.attributes=ot(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ot(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(i.getElementsByClassName)&&ot(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=ot(function(e){return h.appendChild(e).id=y,!i.getElementsByName||!i.getElementsByName(y).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==C&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==C&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==C?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==C&&p?t.getElementsByClassName(e):void 0},v=[],d=[],(n.qsa=Q.test(i.querySelectorAll))&&(ot(function(e){e.innerHTML="<select t=''><option selected=''></option></select>",e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||d.push("\\["+B+"*(?:value|"+H+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&d.push("name"+B+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(n.matchesSelector=Q.test(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){n.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),g=t||Q.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===b&&g(b,e)?-1:t===i||t.ownerDocument===b&&g(b,t)?1:a?P.call(a,e)-P.call(a,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],l=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:a?P.call(a,e)-P.call(a,t):0;if(s===o)return at(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)l.unshift(n);while(u[r]===l[r])r++;return r?at(u[r],l[r]):u[r]===b?-1:l[r]===b?1:0},i):c},rt.matches=function(e,t){return rt(e,null,null,t)},rt.matchesSelector=function(e,t){if((e.ownerDocument||e)!==c&&l(e),t=t.replace(W,"='$1']"),!(!n.matchesSelector||!p||v&&v.test(t)||d&&d.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return rt(t,c,null,[e]).length>0},rt.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},rt.attr=function(e,t){(e.ownerDocument||e)!==c&&l(e);var i=r.attrHandle[t.toLowerCase()],s=i&&L.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):void 0;return void 0!==s?s:n.attributes||!p?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},rt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},rt.uniqueSort=function(e){var t,r=[],i=0,s=0;if(f=!n.detectDuplicates,a=!n.sortStable&&e.slice(0),e.sort(N),f){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return a=null,e},i=rt.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=rt.selectors={cacheLength:50,createPseudo:st,match:$,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||rt.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&rt.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return $.CHILD.test(e[0])?null:(e[3]&&void 0!==e[4]?e[2]=e[4]:n&&X.test(n)&&(t=dt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(et,tt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&S(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==C&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=rt.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===w&&f[1],h=f[0]===w&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[w,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===w)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(b&&((c[y]||(c[y]={}))[e]=[w,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||rt.error("unsupported pseudo: "+e);return i[y]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=P.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:st(function(e){var t=[],n=[],r=o(e.replace(R,"$1"));return r[y]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return rt(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:st(function(e){return V.test(e||"")||rt.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[0>n?n+t:n]}),even:ct(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:ct(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ft(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=lt(t);return pt.prototype=r.filters=r.pseudos,r.setFilters=new pt,o=rt.compile=function(e,t){var n,r=[],i=[],s=T[e+" "];if(!s){t||(t=dt(e)),n=t.length;while(n--)s=wt(t[n]),s[y]?r.push(s):i.push(s);s=T(e,Et(i,r))}return s},n.sortStable=y.split("").sort(N).join("")===y,n.detectDuplicates=!!f,l(),n.sortDetached=ot(function(e){return 1&e.compareDocumentPosition(c.createElement("div"))}),ot(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ut("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ot(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ut("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),ot(function(e){return null==e.getAttribute("disabled")})||ut(H,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),rt}(e);p.find=b,p.expr=b.selectors,p.expr[":"]=p.expr.pseudos,p.unique=b.uniqueSort,p.text=b.getText,p.isXMLDoc=b.isXML,p.contains=b.contains;var w=p.expr.match.needsContext,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^.[^:#\[\.,]*$/;p.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?p.find.matchesSelector(r,e)?[r]:[]:p.find.matches(e,p.grep(t,function(e){return 1===e.nodeType}))},p.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(p(e).filter(function(){for(t=0;i>t;t++)if(p.contains(r[t],this))return!0}));for(t=0;i>t;t++)p.find(e,r[t],n);return n=this.pushStack(i>1?p.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,"string"==typeof e&&w.test(e)?p(e):e||[],!1).length}});var T,N=e.document,C=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=p.fn.init=function(e,t){var n,r;if(!e)return this;if("string"==typeof e){if(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:C.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||T).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof p?t[0]:t,p.merge(this,p.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:N,!0)),E.test(n[1])&&p.isPlainObject(t))for(n in t)p.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if(r=N.getElementById(n[2]),r&&r.parentNode){if(r.id!==n[2])return T.find(e);this.length=1,this[0]=r}return this.context=N,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):p.isFunction(e)?"undefined"!=typeof T.ready?T.ready(e):e(p):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),p.makeArray(e,this))};k.prototype=p.fn,T=p(N);var L=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};p.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&9!==i.nodeType&&(void 0===n||1!==i.nodeType||!p(i).is(n)))1===i.nodeType&&r.push(i),i=i[t];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),p.fn.extend({has:function(e){var t,n=p(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(p.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,r=0,i=this.length,s=[],o=w.test(e)||"string"!=typeof e?p(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&p.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?p.unique(s):s)},index:function(e){return e?"string"==typeof e?p.inArray(this[0],p(e)):p.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(p.unique(p.merge(this.get(),p(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),p.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return p.dir(e,"parentNode")},parentsUntil:function(e,t,n){return p.dir(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return p.dir(e,"nextSibling")},prevAll:function(e){return p.dir(e,"previousSibling")},nextUntil:function(e,t,n){return p.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return p.dir(e,"previousSibling",n)},siblings:function(e){return p.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return p.sibling(e.firstChild)},contents:function(e){return p.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:p.merge([],e.childNodes)}},function(e,t){p.fn[e]=function(n,r){var i=p.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=p.filter(r,i)),this.length>1&&(A[e]||(i=p.unique(i)),L.test(e)&&(i=i.reverse())),this.pushStack(i)}});var M=/\S+/g,_={};p.Callbacks=function(e){e="string"==typeof e?_[e]||D(e):p.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){for(n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;u&&i>s;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;!function s(t){p.each(t,function(t,n){var r=p.type(n);"function"===r?e.unique&&l.has(n)||u.push(n):n&&n.length&&"string"!==r&&s(n)})}(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&p.each(arguments,function(e,n){var r;while((r=p.inArray(n,u,r))>-1)u.splice(r,1),t&&(i>=r&&i--,s>=r&&s--)}),this},has:function(e){return e?p.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=void 0,this},disabled:function(){return!u},lock:function(){return a=void 0,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return!u||r&&!a||(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},p.extend({Deferred:function(e){var t=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return p.Deferred(function(n){p.each(t,function(t,s){var o=p.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&p.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?p.extend(e,r):r}},i={};return r.pipe=r.then,p.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=1!==i||e&&p.isFunction(e.promise)?i:0,o=1===s?e:p.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)n[t]&&p.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,n),o.promise()}});var P;p.fn.ready=function(e){return p.ready.promise().done(e),this},p.extend({isReady:!1,readyWait:1,holdReady:function(e){e?p.readyWait++:p.ready(!0)},ready:function(e){if(e===!0?!--p.readyWait:!p.isReady){if(!N.body)return setTimeout(p.ready);p.isReady=!0,e!==!0&&--p.readyWait>0||(P.resolveWith(N,[p]),p.fn.trigger&&p(N).trigger("ready").off("ready"))}}}),p.ready.promise=function(t){if(!P)if(P=p.Deferred(),"complete"===N.readyState)setTimeout(p.ready);else if(N.addEventListener)N.addEventListener("DOMContentLoaded",B,!1),e.addEventListener("load",B,!1);else{N.attachEvent("onreadystatechange",B),e.attachEvent("onload",B);var n=!1;try{n=null==e.frameElement&&N.documentElement}catch(r){}n&&n.doScroll&&!function i(){if(!p.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}H(),p.ready()}}()}return P.promise(t)};var j="undefined",F;for(F in p(c))break;c.ownLast="0"!==F,c.inlineBlockNeedsLayout=!1,p(function(){var e,t,n=N.getElementsByTagName("body")[0];n&&(e=N.createElement("div"),e.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",t=N.createElement("div"),n.appendChild(e).appendChild(t),typeof t.style.zoom!==j&&(t.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(c.inlineBlockNeedsLayout=3===t.offsetWidth)&&(n.style.zoom=1)),n.removeChild(e),e=t=null)}),function(){var e=N.createElement("div");if(null==c.deleteExpando){c.deleteExpando=!0;try{delete e.test}catch(t){c.deleteExpando=!1}}e=null}(),p.acceptData=function(e){var t=p.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t};var I=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,q=/([A-Z])/g;p.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?p.cache[e[p.expando]]:e[p.expando],!!e&&!U(e)},data:function(e,t,n){return z(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return z(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)}}),p.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(i=p.data(s),1===s.nodeType&&!p._data(s,"parsedAttrs"))){n=o.length;while(n--)r=o[n].name,0===r.indexOf("data-")&&(r=p.camelCase(r.slice(5)),R(s,r,i[r]));p._data(s,"parsedAttrs",!0)}return i}return"object"==typeof e?this.each(function(){p.data(this,e)}):arguments.length>1?this.each(function(){p.data(this,e,t)}):s?R(s,e,p.data(s,e)):void 0},removeData:function(e){return this.each(function(){p.removeData(this,e)})}}),p.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=p._data(e,t),n&&(!r||p.isArray(n)?r=p._data(e,t,p.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=p.queue(e,t),r=n.length,i=n.shift(),s=p._queueHooks(e,t),o=function(){p.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return p._data(e,n)||p._data(e,n,{empty:p.Callbacks("once memory").add(function(){p._removeData(e,t+"queue"),p._removeData(e,n)})})}}),p.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?p.queue(this[0],e):void 0===t?this:this.each(function(){var n=p.queue(this,e,t);p._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&p.dequeue(this,e)})},dequeue:function(e){return this.each(function(){p.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=p.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(o--)n=p._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var X=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=["Top","Right","Bottom","Left"],$=function(e,t){return e=t||e,"none"===p.css(e,"display")||!p.contains(e.ownerDocument,e)},J=p.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=null==n;if("object"===p.type(n)){i=!0;for(u in n)p.access(e,t,u,n[u],!0,s,o)}else if(void 0!==r&&(i=!0,p.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(p(e),n)})),t))for(;a>u;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)));return i?e:f?t.call(e):a?t(e[0],n):s},K=/^(?:checkbox|radio)$/i;!function(){var e=N.createDocumentFragment(),t=N.createElement("div"),n=N.createElement("input");if(t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a>",c.leadingWhitespace=3===t.firstChild.nodeType,c.tbody=!t.getElementsByTagName("tbody").length,c.htmlSerialize=!!t.getElementsByTagName("link").length,c.html5Clone="<:nav></:nav>"!==N.createElement("nav").cloneNode(!0).outerHTML,n.type="checkbox",n.checked=!0,e.appendChild(n),c.appendChecked=n.checked,t.innerHTML="<textarea>x</textarea>",c.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,e.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",c.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,c.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){c.noCloneEvent=!1}),t.cloneNode(!0).click()),null==c.deleteExpando){c.deleteExpando=!0;try{delete t.test}catch(r){c.deleteExpando=!1}}e=t=n=null}(),function(){var t,n,r=N.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(c[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),c[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var Q=/^(?:input|select|textarea)$/i,G=/^key/,Y=/^(?:mouse|contextmenu)|click/,Z=/^(?:focusinfocus|focusoutblur)$/,et=/^([^.]*)(?:\.(.+)|)$/;p.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p._data(e);if(g){n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=p.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof p===j||e&&p.event.triggered===e.type?void 0:p.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(M)||[""],u=t.length;while(u--)s=et.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort(),d&&(f=p.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=p.event.special[d]||{},c=p.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&p.expr.match.needsContext.test(i),namespace:v.join(".")},a),(h=o[d])||(h=o[d]=[],h.delegateCount=0,f.setup&&f.setup.call(e,r,v,l)!==!1||(e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l))),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,c):h.push(c),p.event.global[d]=!0);e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p.hasData(e)&&p._data(e);if(g&&(l=g.events)){t=(t||"").match(M)||[""],f=t.length;while(f--)if(u=et.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort(),d){c=p.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,h=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],!i&&m!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&(c.teardown&&c.teardown.call(e,v,g.handle)!==!1||p.removeEvent(e,d,g.handle),delete l[d])}else for(d in l)p.event.remove(e,d+t[f],n,r,!0);p.isEmptyObject(l)&&(delete g.handle,p._removeData(e,"events"))}},trigger:function(t,n,r,i){var s,o,u,a,l,c,h,d=[r||N],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];if(u=c=r=r||N,3!==r.nodeType&&8!==r.nodeType&&!Z.test(v+p.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[p.expando]?t:new p.Event(v,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:p.makeArray(n,[t]),l=p.event.special[v]||{},i||!l.trigger||l.trigger.apply(r,n)!==!1)){if(!i&&!l.noBubble&&!p.isWindow(r)){for(a=l.delegateType||v,Z.test(a+v)||(u=u.parentNode);u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||N)&&d.push(c.defaultView||c.parentWindow||e)}h=0;while((u=d[h++])&&!t.isPropagationStopped())t.type=h>1?a:l.bindType||v,s=(p._data(u,"events")||{})[t.type]&&p._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&p.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());if(t.type=v,!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&p.acceptData(r)&&o&&r[v]&&!p.isWindow(r)){c=r[o],c&&(r[o]=null),p.event.triggered=v;try{r[v]()}catch(g){}p.event.triggered=void 0,c&&(r[o]=c)}return t.result}},dispatch:function(e){e=p.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(p._data(this,"events")||{})[e.type]||[],l=p.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=p.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,n=((p.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||"click"!==e.type))for(;a!=this;a=a.parentNode||this)if(1===a.nodeType&&(a.disabled!==!0||"click"!==e.type)){for(i=[],s=0;u>s;s++)r=t[s],n=r.selector+" ",void 0===i[n]&&(i[n]=r.needsContext?p(n,this).index(a)>=0:p.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[p.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=Y.test(i)?this.mouseHooks:G.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new p.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||N),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||N,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==rt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===rt()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return p.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return p.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=p.extend(new p.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?p.event.trigger(i,null,t):p.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},p.removeEvent=N.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===j&&(e[r]=null),e.detachEvent(r,n))},p.Event=function(e,t){return this instanceof p.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&(e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault())?tt:nt):this.type=e,t&&p.extend(this,t),this.timeStamp=e&&e.timeStamp||p.now(),void (this[p.expando]=!0)):new p.Event(e,t)},p.Event.prototype={isDefaultPrevented:nt,isPropagationStopped:nt,isImmediatePropagationStopped:nt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=tt,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=tt,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()}},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){p.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!p.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),c.submitBubbles||(p.event.special.submit={setup:function(){return p.nodeName(this,"form")?!1:void p.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=p.nodeName(t,"input")||p.nodeName(t,"button")?t.form:void 0;n&&!p._data(n,"submitBubbles")&&(p.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),p._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&p.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return p.nodeName(this,"form")?!1:void p.event.remove(this,"._submit")}}),c.changeBubbles||(p.event.special.change={setup:function(){return Q.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(p.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,e,!0)})),!1):void p.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!p._data(t,"changeBubbles")&&(p.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||p.event.simulate("change",this.parentNode,e,!0)}),p._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return p.event.remove(this,"._change"),!Q.test(this.nodeName)}}),c.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){p.event.simulate(t,e.target,p.event.fix(e),!0)};p.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=p._data(r,t);i||r.addEventListener(e,n,!0),p._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=p._data(r,t)-1;i?p._data(r,t,i):(r.removeEventListener(e,n,!0),p._removeData(r,t))}}}),p.fn.extend({on:function(e,t,n,r,i){var s,o;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],i);return this}if(null==n&&null==r?(r=t,n=t=void 0):null==r&&("string"==typeof t?(r=n,n=void 0):(r=n,n=t,t=void 0)),r===!1)r=nt;else if(!r)return this;return 1===i&&(o=r,r=function(e){return p().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=p.guid++)),this.each(function(){p.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,p(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=nt),this.each(function(){p.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){p.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?p.event.trigger(e,t,n,!0):void 0}});var st="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ot=/ jQuery\d+="(?:null|\d+)"/g,ut=new RegExp("<(?:"+st+")[\\s/>]","i"),at=/^\s+/,ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,lt=/<([\w:]+)/,ct=/<tbody/i,ht=/<|&#?\w+;/,pt=/<(?:script|style|link)/i,dt=/checked\s*(?:[^=]|=\s*.checked.)/i,vt=/^$|\/(?:java|ecma)script/i,mt=/^true\/(.*)/,gt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,yt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:c.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},bt=it(N),wt=bt.appendChild(N.createElement("div"));yt.optgroup=yt.option,yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,p.extend({clone:function(e,t,n){var r,i,s,o,u,a=p.contains(e.ownerDocument,e);if(c.html5Clone||p.isXMLDoc(e)||!ut.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(wt.innerHTML=e.outerHTML,wt.removeChild(s=wt.firstChild)),!(c.noCloneEvent&&c.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||p.isXMLDoc(e)))for(r=Et(s),u=Et(e),o=0;null!=(i=u[o]);++o)r[o]&&Lt(i,r[o]);if(t)if(n)for(u=u||Et(e),r=r||Et(s),o=0;null!=(i=u[o]);o++)kt(i,r[o]);else kt(e,s);return r=Et(s,"script"),r.length>0&&Ct(r,!a&&Et(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){for(var i,s,o,u,a,f,l,h=e.length,d=it(t),v=[],m=0;h>m;m++)if(s=e[m],s||0===s)if("object"===p.type(s))p.merge(v,s.nodeType?[s]:s);else if(ht.test(s)){u=u||d.appendChild(t.createElement("div")),a=(lt.exec(s)||["",""])[1].toLowerCase(),l=yt[a]||yt._default,u.innerHTML=l[1]+s.replace(ft,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;if(!c.leadingWhitespace&&at.test(s)&&v.push(t.createTextNode(at.exec(s)[0])),!c.tbody){s="table"!==a||ct.test(s)?"<table>"!==l[1]||ct.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)p.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}p.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}else v.push(t.createTextNode(s));u&&d.removeChild(u),c.appendChecked||p.grep(Et(v,"input"),St),m=0;while(s=v[m++])if((!r||-1===p.inArray(s,r))&&(o=p.contains(s.ownerDocument,s),u=Et(d.appendChild(s),"script"),o&&Ct(u),n)){i=0;while(s=u[i++])vt.test(s.type||"")&&n.push(s)}return u=null,d},cleanData:function(e,t){for(var r,i,s,o,u=0,a=p.expando,f=p.cache,l=c.deleteExpando,h=p.event.special;null!=(r=e[u]);u++)if((t||p.acceptData(r))&&(s=r[a],o=s&&f[s])){if(o.events)for(i in o.events)h[i]?p.event.remove(r,i):p.removeEvent(r,i,o.handle);f[s]&&(delete f[s],l?delete r[a]:typeof r.removeAttribute!==j?r.removeAttribute(a):r[a]=null,n.push(s))}}}),p.fn.extend({text:function(e){return J(this,function(e){return void 0===e?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||N).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=xt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=xt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?p.filter(e,this):this,i=0;null!=(n=r[i]);i++)t||1!==n.nodeType||p.cleanData(Et(n)),n.parentNode&&(t&&p.contains(n.ownerDocument,n)&&Ct(Et(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&p.cleanData(Et(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&p.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return p.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(ot,""):void 0;if(!("string"!=typeof e||pt.test(e)||!c.htmlSerialize&&ut.test(e)||!c.leadingWhitespace&&at.test(e)||yt[(lt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(ft,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(p.cleanData(Et(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,p.cleanData(Et(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,l=this.length,h=this,d=l-1,v=e[0],m=p.isFunction(v);if(m||l>1&&"string"==typeof v&&!c.checkClone&&dt.test(v))return this.each(function(n){var r=h.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(l&&(a=p.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,1===a.childNodes.length&&(a=n),n)){for(o=p.map(Et(a,"script"),Tt),s=o.length;l>f;f++)r=a,f!==d&&(r=p.clone(r,!0,!0),s&&p.merge(o,Et(r,"script"))),t.call(this[f],r,f);if(s)for(u=o[o.length-1].ownerDocument,p.map(o,Nt),f=0;s>f;f++)r=o[f],vt.test(r.type||"")&&!p._data(r,"globalEval")&&p.contains(u,r)&&(r.src?p._evalUrl&&p._evalUrl(r.src):p.globalEval((r.text||r.textContent||r.innerHTML||"").replace(gt,"")));a=n=null}return this}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){p.fn[e]=function(e){for(var n,r=0,i=[],o=p(e),u=o.length-1;u>=r;r++)n=r===u?this:this.clone(!0),p(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var At,Ot={};!function(){var e,t,n=N.createElement("div"),r="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],e.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(e.style.opacity),c.cssFloat=!!e.style.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle="content-box"===n.style.backgroundClip,e=n=null,c.shrinkWrapBlocks=function(){var e,n,i,s;if(null==t){if(e=N.getElementsByTagName("body")[0],!e)return;s="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",n=N.createElement("div"),i=N.createElement("div"),e.appendChild(n).appendChild(i),t=!1,typeof i.style.zoom!==j&&(i.style.cssText=r+";width:1px;padding:1px;zoom:1",i.innerHTML="<div></div>",i.firstChild.style.width="5px",t=3!==i.offsetWidth),e.removeChild(n),e=n=i=null}return t}}();var Dt=/^margin/,Pt=new RegExp("^("+X+")(?!px)[a-z%]+$","i"),Ht,Bt,jt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Ht=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==o||p.contains(e.ownerDocument,e)||(o=p.style(e,t)),Pt.test(o)&&Dt.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),void 0===o?o:o+""}):N.documentElement.currentStyle&&(Ht=function(e){return e.currentStyle},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n[t]:void 0,null==o&&u&&u[t]&&(o=u[t]),Pt.test(o)&&!jt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left="fontSize"===t?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),void 0===o?o:o+""||"auto"}),!function(){function l(){var t,n,u=N.getElementsByTagName("body")[0];u&&(t=N.createElement("div"),n=N.createElement("div"),t.style.cssText=a,u.appendChild(t).appendChild(n),n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",p.swap(u,null!=u.style.zoom?{zoom:1}:{},function(){r=4===n.offsetWidth}),i=!0,s=!1,o=!0,e.getComputedStyle&&(s="1%"!==(e.getComputedStyle(n,null)||{}).top,i="4px"===(e.getComputedStyle(n,null)||{width:"4px"}).width),u.removeChild(t),n=u=null)}var t,n,r,i,s,o,u=N.createElement("div"),a="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",f="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";u.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=u.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(t.style.opacity),c.cssFloat=!!t.style.cssFloat,u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle="content-box"===u.style.backgroundClip,t=u=null,p.extend(c,{reliableHiddenOffsets:function(){if(null!=n)return n;var e,t,r,i=N.createElement("div"),s=N.getElementsByTagName("body")[0];if(s)return i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=N.createElement("div"),e.style.cssText=a,s.appendChild(e).appendChild(i),i.innerHTML="<table><tr><td></td><td>t</td></tr></table>",t=i.getElementsByTagName("td"),t[0].style.cssText="padding:0;margin:0;border:0;display:none",r=0===t[0].offsetHeight,t[0].style.display="",t[1].style.display="none",n=r&&0===t[0].offsetHeight,s.removeChild(e),i=s=null,n},boxSizing:function(){return null==r&&l(),r},boxSizingReliable:function(){return null==i&&l(),i},pixelPosition:function(){return null==s&&l(),s},reliableMarginRight:function(){var t,n,r,i;if(null==o&&e.getComputedStyle){if(t=N.getElementsByTagName("body")[0],!t)return;n=N.createElement("div"),r=N.createElement("div"),n.style.cssText=a,t.appendChild(n).appendChild(r),i=r.appendChild(N.createElement("div")),i.style.cssText=r.style.cssText=f,i.style.marginRight=i.style.width="0",r.style.width="1px",o=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight),t.removeChild(n)}return o}})}(),p.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var It=/alpha\([^)]*\)/i,qt=/opacity\s*=\s*([^)]*)/,Rt=/^(none|table(?!-c[ea]).+)/,Ut=new RegExp("^("+X+")(.*)$","i"),zt=new RegExp("^([+-])=("+X+")","i"),Wt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:0,fontWeight:400},Vt=["Webkit","O","Moz","ms"];p.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Bt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":c.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,o,u=p.camelCase(t),a=e.style;if(t=p.cssProps[u]||(p.cssProps[u]=$t(a,u)),o=p.cssHooks[t]||p.cssHooks[u],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:a[t];if(s=typeof n,"string"===s&&(i=zt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(p.css(e,t)),s="number"),null!=n&&n===n&&("number"!==s||p.cssNumber[u]||(n+="px"),c.clearCloneStyle||""!==n||0!==t.indexOf("background")||(a[t]="inherit"),!(o&&"set"in o&&void 0===(n=o.set(e,n,r)))))try{a[t]="",a[t]=n}catch(f){}}},css:function(e,t,n,r){var i,s,o,u=p.camelCase(t);return t=p.cssProps[u]||(p.cssProps[u]=$t(e.style,u)),o=p.cssHooks[t]||p.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),void 0===s&&(s=Bt(e,t,r)),"normal"===s&&t in Xt&&(s=Xt[t]),""===n||n?(i=parseFloat(s),n===!0||p.isNumeric(i)?i||0:s):s}}),p.each(["height","width"],function(e,t){p.cssHooks[t]={get:function(e,n,r){return n?0===e.offsetWidth&&Rt.test(p.css(e,"display"))?p.swap(e,Wt,function(){return Gt(e,t,r)}):Gt(e,t,r):void 0},set:function(e,n,r){var i=r&&Ht(e);return Kt(e,n,r?Qt(e,t,r,c.boxSizing()&&"border-box"===p.css(e,"boxSizing",!1,i),i):0)}}}),c.opacity||(p.cssHooks.opacity={get:function(e,t){return qt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=p.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===p.trim(s.replace(It,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=It.test(s)?s.replace(It,i):s+" "+i)}}),p.cssHooks.marginRight=Ft(c.reliableMarginRight,function(e,t){return t?p.swap(e,{display:"inline-block"},Bt,[e,"marginRight"]):void 0}),p.each({margin:"",padding:"",border:"Width"},function(e,t){p.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+V[r]+t]=s[r]||s[r-2]||s[0];return i}},Dt.test(e)||(p.cssHooks[e+t].set=Kt)}),p.fn.extend({css:function(e,t){return J(this,function(e,t,n){var r,i,s={},o=0;if(p.isArray(t)){for(r=Ht(e),i=t.length;i>o;o++)s[t[o]]=p.css(e,t[o],!1,r);return s}return void 0!==n?p.style(e,t,n):p.css(e,t)},e,t,arguments.length>1)},show:function(){return Jt(this,!0)},hide:function(){return Jt(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){$(this)?p(this).show():p(this).hide()})}}),p.Tween=Yt,Yt.prototype={constructor:Yt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(p.cssNumber[n]?"":"px")},cur:function(){var e=Yt.propHooks[this.prop];return e&&e.get?e.get(this):Yt.propHooks._default.get(this)},run:function(e){var t,n=Yt.propHooks[this.prop];return this.pos=t=this.options.duration?p.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yt.propHooks._default.set(this),this}},Yt.prototype.init.prototype=Yt.prototype,Yt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=p.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){p.fx.step[e.prop]?p.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[p.cssProps[e.prop]]||p.cssHooks[e.prop])?p.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yt.propHooks.scrollTop=Yt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},p.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},p.fx=Yt.prototype.init,p.fx.step={};var Zt,en,tn=/^(?:toggle|show|hide)$/,nn=new RegExp("^(?:([+-])=|)("+X+")([a-z%]*)$","i"),rn=/queueHooks$/,sn=[ln],on={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=nn.exec(t),s=i&&i[3]||(p.cssNumber[e]?"":"px"),o=(p.cssNumber[e]||"px"!==s&&+r)&&nn.exec(p.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,p.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&1!==u&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};p.Animation=p.extend(hn,{tweener:function(e,t){p.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],on[n]=on[n]||[],on[n].unshift(t)},prefilter:function(e,t){t?sn.unshift(e):sn.push(e)}}),p.speed=function(e,t,n){var r=e&&"object"==typeof e?p.extend({},e):{complete:n||!n&&t||p.isFunction(e)&&e,duration:e,easing:n&&t||t&&!p.isFunction(t)&&t};return r.duration=p.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in p.fx.speeds?p.fx.speeds[r.duration]:p.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){p.isFunction(r.old)&&r.old.call(this),r.queue&&p.dequeue(this,r.queue)},r},p.fn.extend({fadeTo:function(e,t,n,r){return this.filter($).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=p.isEmptyObject(e),s=p.speed(t,n,r),o=function(){var t=hn(this,p.extend({},e),s);(i||p._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",s=p.timers,o=p._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem!==this||null!=e&&s[i].queue!==e||(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&p.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=p._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=p.timers,o=r?r.length:0;for(n.finish=!0,p.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),p.each(["toggle","show","hide"],function(e,t){var n=p.fn[t];p.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(an(t,!0),e,r,i)}}),p.each({slideDown:an("show"),slideUp:an("hide"),slideToggle:an("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){p.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),p.timers=[],p.fx.tick=function(){var e,t=p.timers,n=0;for(Zt=p.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||p.fx.stop(),Zt=void 0},p.fx.timer=function(e){p.timers.push(e),e()?p.fx.start():p.timers.pop()},p.fx.interval=13,p.fx.start=function(){en||(en=setInterval(p.fx.tick,p.fx.interval))},p.fx.stop=function(){clearInterval(en),en=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(e,t){return e=p.fx?p.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i=N.createElement("div");i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=i.getElementsByTagName("a")[0],n=N.createElement("select"),r=n.appendChild(N.createElement("option")),t=i.getElementsByTagName("input")[0],e.style.cssText="top:1px",c.getSetAttribute="t"!==i.className,c.style=/top/.test(e.getAttribute("style")),c.hrefNormalized="/a"===e.getAttribute("href"),c.checkOn=!!t.value,c.optSelected=r.selected,c.enctype=!!N.createElement("form").enctype,n.disabled=!0,c.optDisabled=!r.disabled,t=N.createElement("input"),t.setAttribute("value",""),c.input=""===t.getAttribute("value"),t.value="t",t.setAttribute("type","radio"),c.radioValue="t"===t.value,e=t=n=r=i=null}();var pn=/\r/g;p.fn.extend({val:function(e){var t,n,r,i=this[0];if(arguments.length)return r=p.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,p(this).val()):e,null==i?i="":"number"==typeof i?i+="":p.isArray(i)&&(i=p.map(i,function(e){return null==e?"":e+""})),t=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=p.valHooks[i.type]||p.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(pn,""):null==n?"":n)}}),p.extend({valHooks:{option:{get:function(e){var t=p.find.attr(e,"value");return null!=t?t:p.text(e)}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(c.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&p.nodeName(n.parentNode,"optgroup"))){if(t=p(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n,r,i=e.options,s=p.makeArray(t),o=i.length;while(o--)if(r=i[o],p.inArray(p.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1;return n||(e.selectedIndex=-1),i}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(e,t){return p.isArray(t)?e.checked=p.inArray(p(e).val(),t)>=0:void 0}},c.checkOn||(p.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var dn,vn,mn=p.expr.attrHandle,gn=/^(?:checked|selected)$/i,yn=c.getSetAttribute,bn=c.input;p.fn.extend({attr:function(e,t){return J(this,p.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){p.removeAttr(this,e)})}}),p.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===j?p.prop(e,t,n):(1===s&&p.isXMLDoc(e)||(t=t.toLowerCase(),r=p.attrHooks[t]||(p.expr.match.bool.test(t)?vn:dn)),void 0===n?r&&"get"in r&&null!==(i=r.get(e,t))?i:(i=p.find.attr(e,t),null==i?void 0:i):null!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):void p.removeAttr(e,t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(M);if(s&&1===e.nodeType)while(n=s[i++])r=p.propFix[n]||n,p.expr.match.bool.test(n)?bn&&yn||!gn.test(n)?e[r]=!1:e[p.camelCase("default-"+n)]=e[r]=!1:p.attr(e,n,""),e.removeAttribute(yn?n:r)},attrHooks:{type:{set:function(e,t){if(!c.radioValue&&"radio"===t&&p.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),vn={set:function(e,t,n){return t===!1?p.removeAttr(e,n):bn&&yn||!gn.test(n)?e.setAttribute(!yn&&p.propFix[n]||n,n):e[p.camelCase("default-"+n)]=e[n]=!0,n}},p.each(p.expr.match.bool.source.match(/\w+/g),function(e,t){var n=mn[t]||p.find.attr;mn[t]=bn&&yn||!gn.test(t)?function(e,t,r){var i,s;return r||(s=mn[t],mn[t]=i,i=null!=n(e,t,r)?t.toLowerCase():null,mn[t]=s),i}:function(e,t,n){return n?void 0:e[p.camelCase("default-"+t)]?t.toLowerCase():null}}),bn&&yn||(p.attrHooks.value={set:function(e,t,n){return p.nodeName(e,"input")?void (e.defaultValue=t):dn&&dn.set(e,t,n)}}),yn||(dn={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},mn.id=mn.name=mn.coords=function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},p.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:dn.set},p.attrHooks.contenteditable={set:function(e,t,n){dn.set(e,""===t?!1:t,n)}},p.each(["width","height"],function(e,t){p.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),c.style||(p.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var wn=/^(?:input|select|textarea|button|object)$/i,En=/^(?:a|area)$/i;p.fn.extend({prop:function(e,t){return J(this,p.prop,e,t,arguments.length>1)},removeProp:function(e){return e=p.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),p.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return s=1!==o||!p.isXMLDoc(e),s&&(t=p.propFix[t]||t,i=p.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=p.find.attr(e,"tabindex");return t?parseInt(t,10):wn.test(e.nodeName)||En.test(e.nodeName)&&e.href?0:-1}}}}),c.hrefNormalized||p.each(["href","src"],function(e,t){p.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),c.optSelected||(p.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this}),c.enctype||(p.propFix.enctype="encoding");var Sn=/[\t\r\n\f]/g;p.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f="string"==typeof e&&e;if(p.isFunction(e))return this.each(function(t){p(this).addClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(M)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Sn," "):" ")){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=p.trim(r),n.className!==o&&(n.className=o)}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=0===arguments.length||"string"==typeof e&&e;if(p.isFunction(e))return this.each(function(t){p(this).removeClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(M)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Sn," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?p.trim(r):"",n.className!==o&&(n.className=o)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(p.isFunction(e)?function(n){p(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n){var t,r=0,i=p(this),s=e.match(M)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else(n===j||"boolean"===n)&&(this.className&&p._data(this,"__className__",this.className),this.className=this.className||e===!1?"":p._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Sn," ").indexOf(t)>=0)return!0;return!1}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){p.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),p.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var xn=p.now(),Tn=/\?/,Nn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;p.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=p.trim(t+"");return i&&!p.trim(i.replace(Nn,function(e,t,i,s){return n&&t&&(r=0),0===r?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():p.error("Invalid JSON: "+t)},p.parseXML=function(t){var n,r;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+t),n};var Cn,kn,Ln=/#.*$/,An=/([?&])_=[^&]*/,On=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Mn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_n=/^(?:GET|HEAD)$/,Dn=/^\/\//,Pn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hn={},Bn={},jn="*/".concat("*");try{kn=location.href}catch(Fn){kn=N.createElement("a"),kn.href="",kn=kn.href}Cn=Pn.exec(kn.toLowerCase())||[],p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:kn,type:"GET",isLocal:Mn.test(Cn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":jn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Rn(Rn(e,p.ajaxSettings),t):Rn(p.ajaxSettings,e)},ajaxPrefilter:In(Hn),ajaxTransport:In(Bn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;2!==b&&(b=2,o&&clearTimeout(o),a=void 0,s=r||"",E.readyState=e>0?4:0,f=e>=200&&300>e||304===e,n&&(w=Un(l,E,n)),w=zn(l,w,E,f),f?(l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(p.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(p.etag[i]=S)),204===e||"HEAD"===l.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=void 0,u&&h.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(h.trigger("ajaxComplete",[E,l]),--p.active||p.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,i,s,o,u,a,f,l=p.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?p(c):p.event,d=p.Deferred(),v=p.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!f){f={};while(t=On.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};if(d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||kn)+"").replace(Ln,"").replace(Dn,Cn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=p.trim(l.dataType||"*").toLowerCase().match(M)||[""],null==l.crossDomain&&(n=Pn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Cn[1]&&n[2]===Cn[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Cn[3]||("http:"===Cn[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=p.param(l.data,l.traditional)),qn(Hn,l,t,E),2===b)return E;u=l.global,u&&0===p.active++&&p.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!_n.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(Tn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=An.test(i)?i.replace(An,"$1_="+xn++):i+(Tn.test(i)?"&":"?")+"_="+xn++)),l.ifModified&&(p.lastModified[i]&&E.setRequestHeader("If-Modified-Since",p.lastModified[i]),p.etag[i]&&E.setRequestHeader("If-None-Match",p.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+jn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&2!==b){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);if(a=qn(Bn,l,t,E)){E.readyState=1,u&&h.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(2>b))throw S;x(-1,S)}}else x(-1,"No Transport");return E}return E.abort()},getJSON:function(e,t,n){return p.get(e,t,n,"json")},getScript:function(e,t){return p.get(e,void 0,t,"script")}}),p.each(["get","post"],function(e,t){p[t]=function(e,n,r,i){return p.isFunction(n)&&(i=i||r,r=n,n=void 0),p.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){p.fn[t]=function(e){return this.on(t,e)}}),p._evalUrl=function(e){return p.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},p.fn.extend({wrapAll:function(e){if(p.isFunction(e))return this.each(function(t){p(this).wrapAll(e.call(this,t))});if(this[0]){var t=p(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(p.isFunction(e)?function(t){p(this).wrapInner(e.call(this,t))}:function(){var t=p(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=p.isFunction(e);return this.each(function(n){p(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()}}),p.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!c.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||p.css(e,"display"))},p.expr.filters.visible=function(e){return!p.expr.filters.hidden(e)};var Wn=/%20/g,Xn=/\[\]$/,Vn=/\r?\n/g,$n=/^(?:submit|button|image|reset|file)$/i,Jn=/^(?:input|select|textarea|keygen)/i;p.param=function(e,t){var n,r=[],i=function(e,t){t=p.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=p.ajaxSettings&&p.ajaxSettings.traditional),p.isArray(e)||e.jquery&&!p.isPlainObject(e))p.each(e,function(){i(this.name,this.value)});else for(n in e)Kn(n,e[n],t,i);return r.join("&").replace(Wn,"+")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=p.prop(this,"elements");return e?p.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!p(this).is(":disabled")&&Jn.test(this.nodeName)&&!$n.test(e)&&(this.checked||!K.test(e))}).map(function(e,t){var n=p(this).val();return null==n?null:p.isArray(n)?p.map(n,function(e){return{name:t.name,value:e.replace(Vn,"\r\n")}}):{name:t.name,value:n.replace(Vn,"\r\n")}}).get()}}),p.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zn()||er()}:Zn;var Qn=0,Gn={},Yn=p.ajaxSettings.xhr();e.ActiveXObject&&p(e).on("unload",function(){for(var e in Gn)Gn[e](void 0,!0)}),c.cors=!!Yn&&"withCredentials"in Yn,Yn=c.ajax=!!Yn,Yn&&p.ajaxTransport(function(e){if(!e.crossDomain||c.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Qn;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)void 0!==n[i]&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||4===s.readyState))if(delete Gn[o],t=void 0,s.onreadystatechange=p.noop,i)4!==s.readyState&&s.abort();else{f={},u=s.status,"string"==typeof s.responseText&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}u||!e.isLocal||e.crossDomain?1223===u&&(u=204):u=f.text?200:404}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?4===s.readyState?setTimeout(t):s.onreadystatechange=Gn[o]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return p.globalEval(e),e}}}),p.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),p.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=N.head||p("head")[0]||N.documentElement;return{send:function(r,i){t=N.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var tr=[],nr=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tr.pop()||p.expando+"_"+xn++;return this[e]=!0,e}}),p.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(nr.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&nr.test(t.data)&&"data");return u||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=p.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(nr,"$1"+i):t.jsonp!==!1&&(t.url+=(Tn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||p.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,tr.push(i)),o&&p.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),p.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||N;var r=E.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=p.buildFragment([e],t,i),i&&i.length&&p(i).remove(),p.merge([],r.childNodes))};var rr=p.fn.load;p.fn.load=function(e,t,n){if("string"!=typeof e&&rr)return rr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u,e.length),e=e.slice(0,u)),p.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(s="POST"),o.length>0&&p.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?p("<div>").append(p.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},p.expr.filters.animated=function(e){return p.grep(p.timers,function(t){return e===t.elem}).length};var ir=e.document.documentElement;p.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=p.css(e,"position"),c=p(e),h={};"static"===l&&(e.style.position="relative"),u=c.offset(),s=p.css(e,"top"),a=p.css(e,"left"),f=("absolute"===l||"fixed"===l)&&p.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),p.isFunction(t)&&(t=t.call(e,n,u)),null!=t.top&&(h.top=t.top-u.top+o),null!=t.left&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},p.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){p.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(s)return t=s.documentElement,p.contains(t,i)?(typeof i.getBoundingClientRect!==j&&(r=i.getBoundingClientRect()),n=sr(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===p.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),p.nodeName(e[0],"html")||(n=e.offset()),n.top+=p.css(e[0],"borderTopWidth",!0),n.left+=p.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-p.css(r,"marginTop",!0),left:t.left-n.left-p.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||ir;while(e&&!p.nodeName(e,"html")&&"static"===p.css(e,"position"))e=e.offsetParent;return e||ir})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);p.fn[e]=function(r){return J(this,function(e,r,i){var s=sr(e);return void 0===i?s?t in s?s[t]:s.document.documentElement[r]:e[r]:void (s?s.scrollTo(n?p(s).scrollLeft():i,n?i:p(s).scrollTop()):e[r]=i)},e,r,arguments.length,null)}}),p.each(["top","left"],function(e,t){p.cssHooks[t]=Ft(c.pixelPosition,function(e,n){return n?(n=Bt(e,t),Pt.test(n)?p(e).position()[t]+"px":n):void 0})}),p.each({Height:"height",Width:"width"},function(e,t){p.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){p.fn[r]=function(r,i){var s=arguments.length&&(n||"boolean"!=typeof r),o=n||(r===!0||i===!0?"margin":"border");return J(this,function(t,n,r){var i;return p.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===r?p.css(t,n,o):p.style(t,n,r,o)},t,s?r:void 0,s,null)}})}),p.fn.size=function(){return this.length},p.fn.andSelf=p.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return p});var or=e.jQuery,ur=e.$;return p.noConflict=function(t){return e.$===p&&(e.$=ur),t&&e.jQuery===p&&(e.jQuery=or),p},typeof t===j&&(e.jQuery=e.$=p),p}),define("lib-app/jquery",function(){}),define("storymaps/common/utils/Polyfills",[],function(){return{apply:function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Date.now||(Date.now=function(){return(new Date).valueOf()}),Object.keys=Object.keys||function(e,t,n){n=[];for(t in e)n.hasOwnProperty.call(e,t)&&n.push(t);return n},function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}()}}}),define("storymaps/common/utils/SocialSharing",["dojo/Deferred","esri/urlUtils"],function(e,t){return{shareFacebook:function(e,t,n,r){var i=this.cleanURL(r||document.location.href);window.open("http://www.facebook.com/sharer/sharer.php?u="+i,"","toolbar=0,status=0,width=626,height=436")},shareTwitter:function(e,t){var n="text="+encodeURIComponent(e||"")+"&url="+this.cleanURL(t||document.location.href)+"&related=EsriStoryMaps"+"&hashtags=storymap";window.open("https://twitter.com/intent/tweet?"+n,"","toolbar=0,status=0,width=626,height=436")},requestBitly:function(t){var n=["http://api.bitly.com/v3/shorten?callback=?","https://api-ssl.bitly.com/v3/shorten?callback=?"],r=location.protocol=="http:"?n[0]:n[1],i=t||document.location.href,s=new e;return $.getJSON(r,{format:"json",apiKey:app.cfg.HEADER_SOCIAL.bitly.key,login:app.cfg.HEADER_SOCIAL.bitly.login,longUrl:i},function(e){!e||!e||!e.data.url?s.reject():s.resolve(e.data.url)}),s},cleanURL:function(e,n){var r=t.urlToObject(e),i=r.path;return r.query&&(delete r.query.edit,delete r.query.locale,delete r.query.folderId,delete r.query.webmap,delete r.query.autoplay,$.each(Object.keys(r.query),function(e,t){e===0?i+="?":i+="&",r.query[t]!==undefined&&r.query[t]!==""?i+=t+"="+r.query[t]:i+=t})),n?i:encodeURIComponent(i)}}}),define("storymaps/common/utils/CommonHelper",["dojo/cookie","dojo/has","dojo/Deferred","dojo/DeferredList","./SocialSharing","esri/request","esri/dijit/Search","esri/tasks/locator","esri/urlUtils","esri/arcgis/utils","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/geometry/Extent","esri/geometry/Polygon","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/OpenStreetMapLayer"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){return{isMobile:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/IEMobile/i)},switchToBuilder:function(){document.location.search.match(/appid/)?document.location=i.cleanURL(document.location.protocol+"//"+document.location.host+document.location.pathname+document.location.search,!0)+"&edit"+document.location.hash:document.location.search.slice(-1)=="?"?document.location=i.cleanURL(document.location.protocol+"//"+document.location.host+document.location.pathname,!0)+"?edit"+document.location.hash:document.location=i.cleanURL(document.location.protocol+"//"+document.location.host+document.location.pathname,!0)+"?edit"+document.location.hash},isArcGISHosted:function(){return/(\/)([a-zA-Z0-9]+(\/))*(apps\/|home\/)([a-zA-Z0-9\-\_]+\/)/.test(document.location.pathname)},browserSupportHistory:function(){return!!window.history&&!!history.pushState},getUrlParams:function(){var e=a.urlToObject(document.location.search).query;return e?e:!this.browserSupportHistory()&&!e?a.urlToObject(document.location.hash).query||{}:{}},getWebmapID:function(e){var t=this.getUrlParams();if(app.indexCfg&&app.indexCfg.webmap)return app.indexCfg.webmap;if(this.isArcGISHosted()||!e)return t.webmap;if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0])return t.webmap},getAppID:function(e){var t=this.getUrlParams();if(app.indexCfg&&app.indexCfg.appid)return app.indexCfg.appid;if(this.isArcGISHosted()||!e)return t.appid;if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0])return t.appid},getGraphicsLayerByName:function(e,t){var n;for(var r=0;r<e.graphicsLayerIds.length;r++){n=e.getLayer(e.graphicsLayerIds[r]);if(n.name==t)return n}return null},getWebMapExtentFromItem:function(e){if(!e.extent||e.extent.length!=2)return null;var t=l.geographicToWebMercator(new c(e.extent[0][0],e.extent[0][1])),n=l.geographicToWebMercator(new c(e.extent[1][0],e.extent[1][1]));return new h({xmax:n.x,xmin:t.x,ymax:n.y,ymin:t.y,spatialReference:{wkid:102100}})},serializeExtentToItem:function(e){if(!e||!e.spatialReference)return null;var t=e.spatialReference.wkid==4326?e:l.webMercatorToGeographic(e);return[[Math.round(t.xmin*1e4)/1e4,Math.round(t.ymin*1e4)/1e4],[Math.round(t.xmax*1e4)/1e4,Math.round(t.ymax*1e4)/1e4]]},serializedExtentEquals:function(e,t){return e&&t&&e.length==t.length&&e.length==2&&e[0][0]==t[0][0]&&e[0][1]==t[0][1]&&e[1][0]==t[1][0]&&e[1][1]==t[1][1]},cloneLayer:function(e){return e.url&&e.url.match(/virtualearth\./)?new v("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"):e instanceof v?new v(e.url):e instanceof d?new d(e.url):e.id=="OpenStreetMap"?new m:new v("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer")},extentToPolygon:function(e){var t=new p(e.spatialReference);return t.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t},getFirstLevelWhereExtentFit:function(e,t){var n=t.width,r=t.height,i=t._params.lods;if(!i)return-1;for(var s=i.length-1;s>=0;s--)if(n*t._params.lods[s].resolution>e.getWidth()&&r*t._params.lods[s].resolution>e.getHeight())return s;return-1},getPortalUser:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.email:null},getPortalRole:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.role:null},getAppViewModeURL:function(){return document.location.protocol+"//"+document.location.host+document.location.pathname+"?appid="+app.data.getWebAppItem().id},getWebmapViewerLinkFromSharingURL:function(e){var t=e.split("/sharing/")[0];return t+"/home/webmap/viewer.html"},getPortalURL:function(){return f.arcgisUrl.split("/sharing/")[0]},getItemURL:function(e){return this.getPortalURL()+"/home/item.html?id="+e},getMyContentURL:function(){return this.getPortalURL()+"/home/content.html"},getMyStoriesURL:function(){return app.isPortal?this.getPortalURL()+"/apps/MyStories/":"//storymaps.arcgis.com/en/my-stories/"},browserSupportAttachementUsingFileReader:function(){return!!window.FileReader&&!!window.FormData&&!!this.browserSupportCanvas()&&!!window.Blob},browserSupportCanvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},browserSupportFileReaderBinaryString:function(){if(!window.FileReader)return!1;var e=new window.FileReader;return"readAsArrayBuffer"in e},getBinaryStringFromArrayBuffer:function(e){var t=new Uint8Array(e),n="";for(var r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},addCSSRule:function(e,n,r){var i="head";if(t("ie")<=8)return;r&&(i=r.contents().find("head"));if(n){var s=$(i).find("#"+n).eq(0);if(s.length){s.html(e);return}}$("<style>").prop("type","text/css").attr("id",n).html(e).appendTo(i)},hex2rgba:function(e,t){if(!e||e==="")return"";var n=e.replace("#","").match(/../g),r=[],i;for(i in n)r.push(parseInt(n[i],16));return r.push(t),"rgba("+r.join()+")"},prependURLHTTP:function(e){return!e||e===""||e.match(/^mailto:/)?e:/^(https?:\/\/)|^(\/\/)/i.test(e)?e:"http://"+e},convertURLHTTPS:function(e){return!e||e===""||e.match(/^mailto:/)?e:(e=e.replace(/http:\/\//,"https://"),e=e.replace(/^\/\//,"https://"),/^(https:\/\/)/i.test(e)?e:"https://"+e)},convertURLHTTP:function(e){return!e||e===""||e.match(/^mailto:/)?e:(e=e.replace(/https:\/\//,"http://"),e=e.replace(/^\/\//,"http://"),/^(http:\/\/)/i.test(e)?e:"http://"+e)},checkImageURL:function(e){return e&&e.match(/((\.png)|(\.jp(e)?g))$/i)},createGeocoder:function(e){var t=new n;if(!e||!e.map||!e.domNode)return t.resolve(),t;if(!app.cfg.HELPER_SERVICES.geocode)return t.resolve(),t;var i=[];$.each(app.cfg.HELPER_SERVICES.geocode,function(e,t){var n=s({url:t.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});i.push(n)});var a=new r(i);return a.then(function(n){var r=[];$.each(n,function(e,t){if(!t[0])return;if(!t[1]||!t[1].singleLineAddressField)return;var n={};n.singleLineFieldName=t[1].singleLineAddressField.name;var i=new u(app.cfg.HELPER_SERVICES.geocode[e].url);n.name=app.cfg.HELPER_SERVICES.geocode[e].name?app.cfg.HELPER_SERVICES.geocode[e].name:t[1].name,n.locator=i,r.push(n)});if(r.length){var i=new o({map:e.map,sources:[],allPlaceholder:e.placeHolder,enableButtonMode:e.enableButtonMode},e.domNode),s=i.get("sources");$.each(r,function(e,t){s.push(t)}),i.set("sources",s),i.startup(),t.resolve(i)}}),t},debounce:function(e,t,n){var r;return function(){var i=this,s=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t),n&&!r&&e.apply(i,s)}},findDifferences:function(e,t){var n=[],r=["this"];return function(e,t){if(e.constructor==Array)if(!t||t.constructor!=Array||t.length!=e.length)n.push({Property:r.join(""),ObjectA:e,ObjectB:t});else for(var i=0;i<e.length;i++)r.push("["+i.toString()+"]"),arguments.callee(e[i],t[i]),r.pop();else if(e.constructor==Object||e.constructor!=Number&&e.constructor!=String&&e.constructor!=Date&&e.constructor!=RegExp&&e.constructor!=Function&&e.constructor!=Boolean)for(var s in e)r.push("."+s),t[s]?e[s]&&e[s].constructor!=Function&&arguments.callee(e[s],t[s]):n.push({Property:r.join(""),ObjectA:e[s],ObjectB:null}),r.pop();else e.constructor!=Function&&e!=t&&n.push({Property:r.join(""),ObjectA:e,ObjectB:t})}(e,t),n}}}),define("storymaps/common/builder/PortalVersionTest",["esri/arcgis/utils","dojo/Deferred"],function(e,t){function n(){return e.arcgisUrl.split("/sharing/")[0]}return{run:function(){var e=new t,r=null;app.portal.hasMyStories=null;var i=new Image,s=app.isProduction?n()+"/apps/":"../";return i.src=s+"MyStories/assets/my-stories-portal-detector.png",i.onload=function(){app.portal.hasMyStories=!0,r&&clearTimeout(r),e.resolve()},i.onerror=i.onabort=function(){app.portal.hasMyStories=!1,r&&clearTimeout(r),e.reject()},r=setTimeout(function(){e.reject()},2e3),e}}}),define("storymaps/common/builder/MyStoriesWrapper",["./PortalVersionTest","esri/IdentityManager","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r){function i(){e.run().then(function(){app.isProduction&&!f()?s():o()},s)}function s(){$(".check-story").hide()}function o(){window.myStoriesInit=u,r.publish("MYSTORIES_SCAN","start");var e="../MyStories/index.html?fromBuilder";e+="&locale="+dojo.locale,setTimeout(function(){$("#my-stories-frame").attr("src",e)},1e3)}function u(){var e=$("#my-stories-frame")[0].contentWindow;if(!e||!e.init||!e.check||!e.share){console.error("Failed to load My Stories");return}if(!app.data.getStoryLength()){console.log("Skipping the initialization of My Stories until the story has content");return}app.mystories={init:e.init,check:e.check,share:e.share,isChecking:!1,hasCheckErrors:!1,hasScanErrors:!1},app.mystories.init(app.isInBuilder?t.toJson():null,app.isDirectCreationFirstSave||app.isGalleryCreation?null:app.data.getWebAppItem(),app.cfg.TPL_ID,app.isPortal,function(e,t,n){r.publish("MY-STORIES-EDIT-MEDIA",{index:e,type:t,actionId:n})},function(e){r.publish("MY-STORIES-EDIT-MAP",{id:e})},function(){app.mystories.hasCheckErrors=!1,r.publish("MY-STORIES-REFRESH")},function(e){e=e||{completed:!1,ignoreAllIssues:!1},app.mystories.hasCheckErrors=!e.ignoreAllIssues,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MY-STORIES-REFRESH")}).then(a,function(){console.error("Failed to initialize My Stories")})}function a(){if(!app.mystories)return;if(!app.mystories.init){u();return}app.mystories.isChecking=!0,app.mystories.hasCheckErrors=!1,r.publish("MYSTORIES_SCAN","start"),app.mystories.check(app.data.getWebAppData().get()).then(function(e){e=e||{ignoreAllIssues:!1},app.mystories.isChecking=!1,app.mystories.hasCheckErrors=!1,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MYSTORIES_SCAN","success"),$("#sharePopup").is(":visible")&&app.builder.openSharePopup()},function(e){e=e||{completed:!1,ignoreAllIssues:!1},app.mystories.isChecking=!1,app.mystories.hasCheckErrors=!0,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MYSTORIES_SCAN","error"),$("#sharePopup").is(":visible")&&app.builder.openSharePopup()})}function f(){var e=n.getPortalURL().split("//").slice(-1)[0],t=e.split("."),r=document.location.host,i=r.split(".");return e==r||e.split("/").length>1&&e.split("/")[0]==r?!0:i.length<3?r==e:i.slice(1).join(".")==t.slice(-2).join(".")}return{loadMyStories:i,scanStory:a,myStoriesIsSameDomain:f}}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&e.type==="file"||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){"use strict";var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.determineEventType=function(e){"use strict";return this.deviceIsAndroid&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},FastClick.prototype.focus=function(e){"use strict";var t;this.deviceIsIOS&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){"use strict";var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){"use strict";var t,n,r;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(this.deviceIsIOS){r=window.getSelection();if(r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},FastClick.prototype.onTouchMove=function(e){"use strict";if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},FastClick.prototype.findControl=function(e){"use strict";return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){"use strict";var t,n,r,i,s,o=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(s=e.changedTouches[0],o=document.elementFromPoint(s.pageX-window.pageXOffset,s.pageY-window.pageYOffset)||o,o.fastClickScrollParent=this.targetElement.fastClickScrollParent),r=o.tagName.toLowerCase();if(r==="label"){t=this.findControl(o);if(t){this.focus(o);if(this.deviceIsAndroid)return!1;o=t}}else if(this.needsFocus(o)){if(e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&r==="input")return this.targetElement=null,!1;this.focus(o);if(!this.deviceIsIOS4||r!=="select")this.targetElement=null,e.preventDefault();return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){i=o.fastClickScrollParent;if(i&&i.fastClickLastScrollTop!==i.scrollTop)return!0}return this.needsClick(o)||(e.preventDefault(),this.sendClick(o,e)),!1},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){"use strict";return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},FastClick.prototype.onClick=function(e){"use strict";var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){"use strict";var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){"use strict";var t,n;if(typeof window.ontouchstart=="undefined")return!0;n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(n){if(!FastClick.prototype.deviceIsAndroid)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(n>31&&window.innerWidth<=window.screen.width)return!0}}return e.style.msTouchAction==="none"?!0:!1},FastClick.attach=function(e){"use strict";return new FastClick(e)},typeof define!="undefined"&&define.amd?define("lib-app/jquery.fastClick",[],function(){"use strict";return FastClick}):typeof module!="undefined"&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick;if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}function n(n){n&&3===n.which||(e(i).remove(),e(s).each(function(){var r=e(this),i=t(r),s={relatedTarget:this};i.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(i[0],n.target)||(i.trigger(n=e.Event("hide.bs.dropdown",s)),n.isDefaultPrevented()||(r.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",s))))}))}function r(t){return this.each(function(){var n=e(this),r=n.data("bs.dropdown");r||n.data("bs.dropdown",r=new o(this)),"string"==typeof t&&r[t].call(n)})}var i=".dropdown-backdrop",s='[data-toggle="dropdown"]',o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.VERSION="3.3.5",o.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=t(i),o=s.hasClass("open");if(n(),!o){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var u={relatedTarget:this};if(s.trigger(r=e.Event("show.bs.dropdown",u)),r.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger("shown.bs.dropdown",u)}return!1}},o.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var r=e(this);if(n.preventDefault(),n.stopPropagation(),!r.is(".disabled, :disabled")){var i=t(r),o=i.hasClass("open");if(!o&&27!=n.which||o&&27==n.which)return 27==n.which&&i.find(s).trigger("focus"),r.trigger("click");var u=" li:not(.disabled):visible a",a=i.find(".dropdown-menu"+u);if(a.length){var f=a.index(n.target);38==n.which&&f>0&&f--,40==n.which&&f<a.length-1&&f++,~f||(f=0),a.eq(f).trigger("focus")}}}};var u=e.fn.dropdown;e.fn.dropdown=r,e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=u,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,o.prototype.toggle).on("keydown.bs.dropdown.data-api",s,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t,r){return this.each(function(){var s=e(this),u=s.data("bs.modal"),a=e.extend({},n.DEFAULTS,s.data(),"object"==typeof t&&t);u||s.data("bs.modal",u=new n(this,a)),"string"==typeof t?u[t](r):a.show&&u.show(r)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.5",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var r=this,s=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(s),this.isShown||s.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){r.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(r.$element)&&(r.ignoreBackdropClick=!0)})}),this.backdrop(function(){var s=e.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(r.$body),r.$element.show().scrollTop(0),r.adjustDialog(),s&&r.$element[0].offsetWidth,r.$element.addClass("in"),r.enforceFocus();var u=e.Event("shown.bs.modal",{relatedTarget:t});s?r.$dialog.one("bsTransitionEnd",function(){r.$element.trigger("focus").trigger(u)}).emulateTransitionEnd(n.TRANSITION_DURATION):r.$element.trigger("focus").trigger(u)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var r=this,s=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=e.support.transition&&s;if(this.$backdrop=e(document.createElement("div")).addClass("modal-backdrop "+s).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){return this.ignoreBackdropClick?void (this.ignoreBackdropClick=!1):void (e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;o?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var u=function(){r.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",u).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):u()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var r=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var r=e(this),i=r.attr("href"),s=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},s.data(),r.data());r.is("a")&&n.preventDefault(),s.one("show.bs.modal",function(e){e.isDefaultPrevented()||s.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})}),t.call(s,o,this)})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),s=r.data("bs.tooltip"),o="object"==typeof t&&t;(s||!/destroy|hide/.test(t))&&(s||r.data("bs.tooltip",s=new n(this,o)),"string"==typeof t&&s[t]())})}var n=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,r){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focusin",a="hover"==o?"mouseleave":"focusout";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState?void (n.hoverState="in"):(clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void (n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),n.isInStateTrue()?void 0:(clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void (n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide())},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var r=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!r)return;var s=this,o=this.tip(),u=this.getUID(this.type);this.setContent(),o.attr("id",u),this.$element.attr("aria-describedby",u),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,f=/\s?auto?\s?/i,l=f.test(a);l&&(a=a.replace(f,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),h=o[0].offsetWidth,p=o[0].offsetHeight;if(l){var d=a,v=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+p>v.bottom?"top":"top"==a&&c.top-p<v.top?"bottom":"right"==a&&c.right+h>v.width?"left":"left"==a&&c.left-h<v.left?"right":a,o.removeClass(d).addClass(a)}var m=this.getCalculatedOffset(a,c,h,p);this.applyPlacement(m,a);var g=function(){var e=s.hoverState;s.$element.trigger("shown.bs."+s.type),s.hoverState=null,"out"==e&&s.leave(s)};e.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",g).emulateTransitionEnd(n.TRANSITION_DURATION):g()}},n.prototype.applyPlacement=function(t,n){var r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),t.top+=o,t.left+=u,e.offset.setOffset(r[0],e.extend({using:function(e){r.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),r.addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;"top"==n&&f!=s&&(t.top=t.top+s-f);var l=this.getViewportAdjustedDelta(n,t,a,f);l.left?t.left+=l.left:t.top+=l.top;var c=/top|bottom/.test(n),h=c?2*l.left-i+a:2*l.top-s+f,p=c?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(h,r[0][p],c)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function r(){"in"!=s.hoverState&&o.detach(),s.$element.removeAttr("aria-describedby").trigger("hidden.bs."+s.type),t&&t()}var s=this,o=e(this.$tip),u=e.Event("hide.bs."+this.type);return this.$element.trigger(u),u.isDefaultPrevented()?void 0:(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",r).emulateTransitionEnd(n.TRANSITION_DURATION):r(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],r="BODY"==n.tagName,i=n.getBoundingClientRect();null==i.width&&(i=e.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var s=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},u=r?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},i,o,u,s)},n.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,r){var i={top:0,left:0};if(!this.$viewport)return i;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var u=t.top-s-o.scroll,a=t.top+s-o.scroll+r;u<o.top?i.top=o.top-u:a>o.top+o.height&&(i.top=o.top+o.height-a)}else{var f=t.left-s,l=t.left+s+n;f<o.left?i.left=o.left-f:l>o.right&&(i.left=o.left+o.width-l)}return i},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var r=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),s=r.data("bs.popover"),o="object"==typeof t&&t;(s||!/destroy|hide/.test(t))&&(s||r.data("bs.popover",s=new n(this,o)),"string"==typeof t&&s[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.3.5",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var r=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new n(this)),"string"==typeof t&&i[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a"),s=e.Event("hide.bs.tab",{relatedTarget:t[0]}),o=e.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(s),t.trigger(o),!o.isDefaultPrevented()&&!s.isDefaultPrevented()){var u=e(r);this.activate(t.closest("li"),n),this.activate(u,u.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},n.prototype.activate=function(t,r,i){function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),u?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var o=r.find("> .active"),u=i&&e.support.transition&&(o.length&&o.hasClass("fade")||!!r.find("> .fade").length);o.length&&u?o.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),o.removeClass("in")};var r=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=r,this};var i=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),+function(e){"use strict";function t(t){var n,r=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(r)}function n(t){return this.each(function(){var n=e(this),i=n.data("bs.collapse"),s=e.extend({},r.DEFAULTS,n.data(),"object"==typeof t&&t);!i&&s.toggle&&/show|hide/.test(t)&&(s.toggle=!1),i||n.data("bs.collapse",i=new r(this,s)),"string"==typeof t&&i[t]()})}var r=function(t,n){this.$element=e(t),this.options=e.extend({},r.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};r.VERSION="3.3.5",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0},r.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,i=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(i&&i.length&&(t=i.data("bs.collapse"),t&&t.transitioning))){var s=e.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){i&&i.length&&(n.call(i,"hide"),t||i.data("bs.collapse",null));var u=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[u](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[u](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return a.call(this);var f=e.camelCase(["scroll",u].join("-"));this.$element.one("bsTransitionEnd",e.proxy(a,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[u](this.$element[0][f])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION):i.call(this)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,r){var i=e(r);this.addAriaAndCollapsedClass(t(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var i=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=r,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(r){var i=e(this);i.attr("data-target")||r.preventDefault();var s=t(i),o=s.data("bs.collapse"),u=o?"toggle":i.data();n.call(s,u)})}(jQuery),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one("bsTransitionEnd",function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),define("lib-app/bootstrap/js/bootstrap.min",function(){}),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n=e.History=e.History||{};if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={handlers:{},_uid:1,uid:function(e){return e._uid||(e._uid=n.Adapter._uid++)},bind:function(e,t,r){var i=n.Adapter.uid(e);n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[],n.Adapter.handlers[i][t].push(r),e["on"+t]=function(e,t){return function(r){n.Adapter.trigger(e,t,r)}}(e,t)},trigger:function(e,t,r){r=r||{};var i=n.Adapter.uid(e),s,o;n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[];for(s=0,o=n.Adapter.handlers[i][t].length;s<o;++s)n.Adapter.handlers[i][t][s].apply(this,[r])},extractEventData:function(e,n){var r=n&&n[e]||t;return r},onDomLoad:function(t){var n=e.setTimeout(function(){t()},2e3);e.onload=function(){clearTimeout(n),t()}}},typeof n.init!="undefined"&&n.init()}(window),function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0,o.enabled=!0,o.savedHashes=[],o.isLastHash=function(e){var t=o.getHashByIndex(),n;return n=e===t,n},o.isHashEqual=function(e,t){return e=encodeURIComponent(e).replace(/%25/g,"%"),t=encodeURIComponent(t).replace(/%25/g,"%"),e===t},o.saveHash=function(e){return o.isLastHash(e)?!1:(o.savedHashes.push(e),!0)},o.getHashByIndex=function(e){var t=null;return typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e],t},o.discardedHashes={},o.discardedStates={},o.discardState=function(e,t,n){var r=o.getHashByState(e),i;return i={discardedState:e,backState:n,forwardState:t},o.discardedStates[r]=i,!0},o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};return o.discardedHashes[e]=r,!0},o.discardedState=function(e){var t=o.getHashByState(e),n;return n=o.discardedStates[t]||!1,n},o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t},o.recycleState=function(e){var t=o.getHashByState(e);return o.discardedState(e)&&delete o.discardedStates[t],!0},o.emulated.hashChange&&(o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a,f=Boolean(o.getHash());return o.isInternetExplorer()?(r="historyjs-iframe",i=n.createElement("iframe"),i.setAttribute("id",r),i.setAttribute("src","#"),i.style.display="none",n.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),u="",a=!1,o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash(),r=o.getHash(i.contentWindow.document);return n!==t?(t=n,r!==n&&(u=r=n,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=o.escapeHash(n)),o.Adapter.trigger(e,"hashchange")):r!==u&&(u=r,f&&r===""?o.back():o.setHash(r,!1)),a=!1,!0}):o.checkerFunction=function(){var n=o.getHash()||"";return n!==t&&(t=n,o.Adapter.trigger(e,"hashchange")),!0},o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval)),!0},o.Adapter.onDomLoad(o.hashChangeInit)),o.emulated.pushState&&(o.onHashChange=function(t){var n=t&&t.newURL||o.getLocationHref(),r=o.getHashByUrl(n),i=null,s=null,u=null,a;return o.isLastHash(r)?(o.busy(!1),!1):(o.doubleCheckComplete(),o.saveHash(r),r&&o.isTraditionalAnchor(r)?(o.Adapter.trigger(e,"anchorchange"),o.busy(!1),!1):(i=o.extractState(o.getFullUrl(r||o.getLocationHref()),!0),o.isLastSavedState(i)?(o.busy(!1),!1):(s=o.getHashByState(i),a=o.discardedState(i),a?(o.getHashByIndex(-2)===o.getHashByState(a.forwardState)?o.back(!1):o.forward(!1),!1):(o.pushState(i.data,i.title,encodeURI(i.url),!1),!0))))},o.Adapter.bind(e,"hashchange",o.onHashChange),o.pushState=function(t,n,r,i){r=encodeURI(r).replace(/%25/g,"%");if(o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:i}),!1;o.busy(!0);var s=o.createStateObject(t,n,r),u=o.getHashByState(s),a=o.getState(!1),f=o.getHashByState(a),l=o.getHash(),c=o.expectedStateId==s.id;return o.storeState(s),o.expectedStateId=s.id,o.recycleState(s),o.setTitle(s),u===f?(o.busy(!1),!1):(o.saveState(s),c||o.Adapter.trigger(e,"statechange"),!o.isHashEqual(u,l)&&!o.isHashEqual(u,o.getShortUrl(o.getLocationHref()))&&o.setHash(u,!1),o.busy(!1),!0)},o.replaceState=function(t,n,r,i){r=encodeURI(r).replace(/%25/g,"%");if(o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:i}),!1;o.busy(!0);var s=o.createStateObject(t,n,r),u=o.getHashByState(s),a=o.getState(!1),f=o.getHashByState(a),l=o.getStateByIndex(-2);return o.discardState(a,s,l),u===f?(o.storeState(s),o.expectedStateId=s.id,o.recycleState(s),o.setTitle(s),o.saveState(s),o.Adapter.trigger(e,"statechange"),o.busy(!1)):o.pushState(s.data,s.title,s.url,!1),!0}),o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})},typeof o.init!="undefined"&&o.init()}(window),function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;try{s=e.sessionStorage,s.setItem("TEST","1"),s.removeItem("TEST")}catch(d){s=!1}l.stringify=l.stringify||l.encode,l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(e){return typeof h.Adapter=="undefined"?!1:(typeof h.initCore!="undefined"&&h.initCore(),typeof h.initHtml4!="undefined"&&h.initHtml4(),!0)},h.initCore=function(d){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0,h.options=h.options||{},h.options.hashChangeInterval=h.options.hashChangeInterval||100,h.options.safariPollInterval=h.options.safariPollInterval||500,h.options.doubleCheckInterval=h.options.doubleCheckInterval||500,h.options.disableSuid=h.options.disableSuid||!1,h.options.storeInterval=h.options.storeInterval||1e3,h.options.busyDelay=h.options.busyDelay||250,h.options.debug=h.options.debug||!1,h.options.initialTitle=h.options.initialTitle||r.title,h.options.html4Mode=h.options.html4Mode||!1,h.options.delayInit=h.options.delayInit||!1,h.intervalList=[],h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}},h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)},h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;e?(u=Array.prototype.slice.call(arguments),i=u.shift(),typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])):i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}return t?(t.value+=i+"\n-----\n",t.scrollTop=t.scrollHeight-t.clientHeight):e||c(i),!0},h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e},h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e},h.options.html4Mode?h.emulated={pushState:!0,hashChange:!0}:h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)},h.enabled=!h.emulated.pushState,h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)},h.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},h.cloneObject=function(e){var t,n;return e?(t=l.stringify(e),n=l.parse(t)):n={},n},h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;return e+="/",e},h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";return e.length===1&&(t=e[0],n=t.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e},h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||h.getLocationHref(),n;return n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"}),n},h.getBasePageUrl=function(){var e=h.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);return t=typeof t=="undefined"?!0:t,/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();return h.emulated.pushState&&(t=t.replace(n,"")),t=t.replace(r,"/"),h.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,""),t},h.getLocationHref=function(e){return e=e||r,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:e.URL.indexOf("#")==-1&&e.location.href.indexOf("#")!=-1?e.location.href:e.URL||e.location.href},h.store={},h.idToState=h.idToState||{},h.stateToId=h.stateToId||{},h.urlToId=h.urlToId||{},h.storedStates=h.storedStates||[],h.savedStates=h.savedStates||[],h.normalizeStore=function(){h.store.idToState=h.store.idToState||{},h.store.urlToId=h.store.urlToId||{},h.store.stateToId=h.store.stateToId||{}},h.getState=function(e,t){typeof e=="undefined"&&(e=!0),typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();return!n&&t&&(n=h.createStateObject()),e&&(n=h.cloneObject(n),n.url=n.cleanUrl||n.url),n},h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t,h.idToState[t]=e}}return t},h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};return t={},t.normalized=!0,t.title=e.title||"",t.url=h.getFullUrl(e.url?e.url:h.getLocationHref()),t.hash=h.getShortUrl(t.url),t.data=h.cloneObject(e.data),t.id=h.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,n=!h.isEmptyObject(t.data),(t.title||n)&&h.options.disableSuid!==!0&&(t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=h.getFullUrl(t.hash),(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t},h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};return r=h.normalizeState(r),r},h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n},h.getStateString=function(e){var t,n,r;return t=h.normalizeState(e),n={data:t.data,title:e.title,url:e.url},r=l.stringify(n),r},h.getStateId=function(e){var t,n;return t=h.normalizeState(e),n=t.id,n},h.getHashByState=function(e){var t,n;return t=h.normalizeState(e),n=t.hash,n},h.extractId=function(e){var t,n,r,i;return e.indexOf("#")!=-1?i=e.split("#")[0]:i=e,n=/(.*)\&_suid=([0-9]+)$/.exec(i),r=n?n[1]||e:e,t=n?String(n[2]||""):"",t||!1},h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},h.extractState=function(e,t){var n=null,r,i;return t=t||!1,r=h.extractId(e),r&&(n=h.getStateById(r)),n||(i=h.getFullUrl(e),r=h.getIdByUrl(i)||!1,r&&(n=h.getStateById(r)),!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))),n},h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n},h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t},h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t},h.hasUrlDuplicate=function(e){var t=!1,n;return n=h.extractState(e.url),t=n&&n.id!==e.id,t},h.storeState=function(e){return h.urlToId[e.url]=e.id,h.storedStates.push(h.cloneObject(e)),e},h.isLastSavedState=function(e){var t=!1,n,r,i;return h.savedStates.length&&(n=e.id,r=h.getLastSavedState(),i=r.id,t=n===i),t},h.saveState=function(e){return h.isLastSavedState(e)?!1:(h.savedStates.push(h.cloneObject(e)),!0)},h.getStateByIndex=function(e){var t=null;return typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e],t},h.getCurrentIndex=function(){var e=null;return h.savedStates.length<1?e=0:e=h.savedStates.length-1,e},h.getHash=function(e){var t=h.getLocationHref(e),n;return n=h.getHashByUrl(t),n},h.unescapeHash=function(e){var t=h.normalizeHash(e);return t=decodeURIComponent(t),t},h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},h.setHash=function(e,t){var n,i;return t!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t}),!1):(h.busy(!0),n=h.extractState(e,!0),n&&!h.emulated.pushState?h.pushState(n.data,n.title,n.url,!1):h.getHash()!==e&&(h.bugs.setHash?(i=h.getPageUrl(),h.pushState(null,null,i+"#"+e,!1)):r.location.hash=e),h)},h.escapeHash=function(t){var n=h.normalizeHash(t);return n=e.encodeURIComponent(n),h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=h.unescapeHash(t),t},h.setTitle=function(e){var t=e.title,n;t||(n=h.getStateByIndex(0),n&&n.url===e.url&&(t=n.title||h.options.initialTitle));try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}return r.title=t,h},h.queues=[],h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift(),h.fireQueueItem(r),h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag},h.busy.flag=!1,h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])},h.pushQueue=function(e){return h.queues[e.queue||0]=h.queues[e.queue||0]||[],h.queues[e.queue||0].push(e),h},h.queue=function(e,t){return typeof e=="function"&&(e={callback:e}),typeof t!="undefined"&&(e.queue=t),h.busy()?h.pushQueue(e):h.fireQueueItem(e),h},h.clearQueue=function(){return h.busy.flag=!1,h.queues=[],h},h.stateChanged=!1,h.doubleChecker=!1,h.doubleCheckComplete=function(){return h.stateChanged=!0,h.doubleCheckClear(),h},h.doubleCheckClear=function(){return h.doubleChecker&&(u(h.doubleChecker),h.doubleChecker=!1),h},h.doubleCheck=function(e){return h.stateChanged=!1,h.doubleCheckClear(),h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){return h.doubleCheckClear(),h.stateChanged||e(),!0},h.options.doubleCheckInterval)),h},h.safariStatePoll=function(){var t=h.extractState(h.getLocationHref()),n;if(!h.isLastSavedState(t))return n=t,n||(n=h.createStateObject()),h.Adapter.trigger(e,"popstate"),h;return},h.back=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.back(!1)}),p.go(-1),!0)},h.forward=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.forward(!1)}),p.go(1),!0)},h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var v=function(){};h.pushState=h.pushState||v,h.replaceState=h.replaceState||v}else h.onPopState=function(t,n){var r=!1,i=!1,s,o;return h.doubleCheckComplete(),s=h.getHash(),s?(o=h.extractState(s||h.getLocationHref(),!0),o?h.replaceState(o.data,o.title,o.url,!1):(h.Adapter.trigger(e,"anchorchange"),h.busy(!1)),h.expectedStateId=!1,!1):(r=h.Adapter.extractEventData("state",t,n)||!1,r?i=h.getStateById(r):h.expectedStateId?i=h.getStateById(h.expectedStateId):i=h.extractState(h.getLocationHref()),i||(i=h.createStateObject(null,null,h.getLocationHref())),h.expectedStateId=!1,h.isLastSavedState(i)?(h.busy(!1),!1):(h.storeState(i),h.saveState(i),h.setTitle(i),h.Adapter.trigger(e,"statechange"),h.busy(!1),!0))},h.Adapter.bind(e,"popstate",h.onPopState),h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i}),!1;h.busy(!0);var s=h.createStateObject(t,n,r);return h.isLastSavedState(s)?h.busy(!1):(h.storeState(s),h.expectedStateId=s.id,p.pushState(s.id,s.title,s.url),h.Adapter.trigger(e,"popstate")),!0},h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i}),!1;h.busy(!0);var s=h.createStateObject(t,n,r);return h.isLastSavedState(s)?h.busy(!1):(h.storeState(s),h.expectedStateId=s.id,p.replaceState(s.id,s.title,s.url),h.Adapter.trigger(e,"popstate")),!0};if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(m){h.store={}}h.normalizeStore()}else h.store={},h.normalizeStore();h.Adapter.bind(e,"unload",h.clearAllIntervals),h.saveState(h.storeState(h.extractState(h.getLocationHref(),!0))),s&&(h.onUnload=function(){var e,t,n;try{e=l.parse(s.getItem("History.store"))||{}}catch(r){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e,h.normalizeStore(),n=l.stringify(e);try{s.setItem("History.store",n)}catch(i){if(i.code!==DOMException.QUOTA_EXCEEDED_ERR)throw i;s.length&&(s.removeItem("History.store"),s.setItem("History.store",n))}},h.intervalList.push(a(h.onUnload,h.options.storeInterval)),h.Adapter.bind(e,"beforeunload",h.onUnload),h.Adapter.bind(e,"unload",h.onUnload));if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla")h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")}),h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}},(!h.options||!h.options.delayInit)&&h.init()}(window),define("lib-app/history.min",function(){}),define("storymaps/common/Core",["lib-build/css!lib-app/bootstrap/css/bootstrap.min","lib-build/css!storymaps/common/ui/Modal.css","lib-build/css!./Core","lib-app/jquery","./utils/Polyfills","esri/map","esri/arcgis/Portal","esri/arcgis/utils","./utils/CommonHelper","esri/urlUtils","./builder/MyStoriesWrapper","dojo/has","esri/IdentityManager","esri/arcgis/OAuthInfo","esri/config","esri/tasks/GeometryService","esri/request","dojo/topic","dojo/on","dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","dojo/Deferred","dojo/DeferredList","dojo/query","lib-app/jquery.fastClick","lib-app/bootstrap/js/bootstrap.min","lib-app/history.min"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N){function A(e,t){var n=!1,r=!1;console.log("common.core.Core - init",t),k=e,app.userCanEdit=!1,rt(),t!=null&&(n=L.fromScratch!=null||L.fromscratch!=null,r=L.fromGallery!=null),!a.browserSupportHistory()&&(n||r)&&L.ieredirected==null&&(window.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"#"+document.location.search+"&ieredirected"),a.isArcGISHosted()?app.indexCfg={}:it()||(app.indexCfg={proxyurl:app.indexCfg.proxyurl,sharingurl:app.indexCfg.sharingurl,username:app.indexCfg.username,password:app.indexCfg.password,oAuthAppId:app.indexCfg.oAuthAppId});if(!k.checkConfigFileIsOK()){q("invalidConfig");return}document.title=app.cfg.TPL_NAME,c("touch")&&$("body").addClass("hasTouch"),N.prototype._needsClick=N.prototype.needsClick,N.prototype.needsClick=function(e){return $(e).parents(".esriPopup").length?!0:N.prototype._needsClick.call(this,e)},N.attach(document.body),window!=window.top&&$("body").addClass("isEmbed"),b.mixin(app,{map:null,maps:{},portal:null,builder:t,isDirectCreation:n,isGalleryCreation:r,isDirectCreationFirstSave:n,isLoading:!0,loadingTimeout:null,ui:{}}),app.appCfg.useStandardHeader&&require(["storymaps/common/ui/header/Desktop"],function(e){app.ui.headerDesktop=new e($("#headerDesktop"),app.isInBuilder)});if(!k.init(this))return;!it()&&app.indexCfg.username&&app.indexCfg.password&&y(h,"dialog-create",function(){y(h.dialog,"show",function(){h.dialog.txtUser_.set("value",app.indexCfg.username),h.dialog.txtPwd_.set("value",app.indexCfg.password),h.dialog.btnSubmit_.onClick()})}),et();if(!app.indexCfg.sharingurl){var i=document.location.pathname.indexOf("/apps/");i==-1&&(i=document.location.pathname.indexOf("/home/"));if(i!=-1){var s=location.pathname.substr(0,i);app.indexCfg.sharingurl="//"+location.host+s+"/sharing/content/items",app.indexCfg.proxyurl="//"+location.host+s+"/sharing/proxy"}else app.indexCfg.sharingurl=app.cfg.DEFAULT_SHARING_URL}app.indexCfg.sharingurl.match(/^http/)?u.arcgisUrl=app.indexCfg.sharingurl:u.arcgisUrl=location.protocol+app.indexCfg.sharingurl,app.indexCfg.proxyurl||(app.indexCfg.proxyurl=app.cfg.DEFAULT_PROXY_URL),d.defaults.io.proxyUrl=location.protocol+app.indexCfg.proxyurl,h&&h.setProtocolErrorHandler(function(){return!0}),app.isInBuilder&&app.cfg.CORS_SERVER&&$.each(app.cfg.CORS_SERVER,function(e,t){d.defaults.io.corsEnabledServers.push(t)}),app.cfg.PROXY_RULES&&app.cfg.PROXY_RULES.length&&$.each(app.cfg.PROXY_RULES,function(e,t){t&&t.urlPrefix&&t.proxyUrl&&f.addProxyRule(t)}),d.defaults.io.timeout=app.isInBuilder?app.cfg.TIMEOUT_BUILDER_REQUEST:app.cfg.TIMEOUT_VIEWER_REQUEST,$.fn.modal.Constructor.prototype.enforceFocus=function(){},k.initLocalization(),$(window).resize(V),$("form").bind("keydown",function(e){if(e.keyCode==13)return!1}),y(h,"dialog-create",K),g.subscribe("CORE_UPDATE_UI",W),g.subscribe("CORE_RESIZE",V),g.subscribe("CORE_UPDATE_EXTENT",U),app.portal=new o.Portal(app.indexCfg.sharingurl.split("/sharing/")[0]),app.portal.on("load",function(e){app.isPortal=!!e.isPortal,st();if(app.indexCfg.oAuthAppId){var n=new p({appId:app.indexCfg.oAuthAppId,popup:!1,portalUrl:"https:"+app.indexCfg.sharingurl.split("/sharing/")[0]});h.registerOAuthInfos([n]),h.checkSignInStatus(n.portalUrl).then(function(){t?D().then(O):D().then(O)},function(){h.getCredential(n.portalUrl)})}else O()})}function O(){console.log("common.core.Core - initStep2");var e=a.getAppID(it()),t=a.getWebmapID(it()),n=app.appCfg?!!app.appCfg.supportWebmapPreviewAGOL:!0;if(e){M(e);return}var r=a.getUrlParams().insights;if(app.isDirectCreation&&r){if(!r.match(/^[a-fA-F0-9]{32}$/)){q("appLoadingFail");return}D().then(function(){j(),app.isInitializing=!1,app.data.setStoryStorage("WEBAPP"),u.getItem(r).then(function(e){if(!e){q("appLoadingFail");return}var t=e.item;if(!t.url){q("appLoadingFail");return}app.data.getWebAppData().setTitle(t.title+" - story");var n=location.protocol+app.indexCfg.sharingurl.split("/sharing/")[0]+"/apps/insights/#/embed/"+r;app.data.addStorySection({title:t.title,creaDate:Date.now(),status:"PUBLISHED",media:{type:"webpage",webpage:{url:n,display:"stretch",unload:!1}},description:t.description}),app.data.getWebAppData().setLayout({id:"tab"}),app.data.getWebAppData().setLayoutOptions({description:!0,legend:"panel",panel:{position:"right",size:"medium"},panelMapOverlap:!1}),app.data.setCurrentSectionIndex(0),g.publish("story-update-entries"),g.publish("BUILDER_INCREMENT_COUNTER",1),F(),g.publish("CORE_UPDATE_UI"),I()},function(){q("appLoadingFail")})});return}var i=a.getUrlParams().webmap;if(app.isDirectCreation&&(t||i)){D().then(function(){j(),a.getUrlParams().source=="opendata"&&(app.isDirectCreationOpenData=!0),app.isInitializing=!1,app.data.setStoryStorage("WEBAPP");var e=(t||i).split(","),n=[];$.each(e,function(e,t){if(!t.match(/^[a-fA-F0-9]{32}$/))return;if(app.data.getStoryLength()>=app.cfg.MAX_NB_ENTRIES)return;var r={title:"",creaDate:Date.now(),status:"PUBLISHED",media:{type:"webmap",webmap:{id:t,extent:null,layers:null,popup:null,legend:{enable:!1,openByDefault:!1}}},description:""};n.push(r),app.data.addStorySection(r)}),app.data.getWebAppData().setLayout({id:"tab"}),app.data.getWebAppData().setDefaultLayoutOptions(),app.data.getWebAppData().setMapOptions({mapsSync:!1});var r=0,s=n.length,o=g.subscribe("story-loaded-map",function(e){if(!app.maps[e.id])console.log("Could not load web map with id:",e.id),s--;else{var t=app.maps[e.id].response.itemInfo.item;$.each(n,function(n,i){i.media.webmap.id==e.id&&(n===0&&app.data.getWebAppData().setTitle(t.title),i.title=t.title,i.description=t.description,app.data.editSection(n,i),r++)})}r==s&&(o.remove(),F(),g.publish("CORE_UPDATE_UI"),g.publish("story-update-entries"),I())});app.data.setCurrentSectionIndex(0),g.publish("story-update-entries"),g.publish("BUILDER_INCREMENT_COUNTER",1),app.ui.mainStage.preloadAllMaps(!0)});return}if(t&&!n){a.isArcGISHosted()?B():P(t);return}if(app.isDirectCreation&&it()&&!a.getPortalUser()&&!app.portal.getPortalUser()){Y();return}if(app.isDirectCreation){D().then(function(){j(),k.startFromScratch(),F()});return}a.isArcGISHosted()?B():L.appid&&(!app.indexCfg.authorizedOwners||!app.indexCfg.authorizedOwners[0])?q("unspecifiedConfigOwner"):app.isProduction?q("invalidConfigNoApp"):q("invalidConfigNoAppDev")}function M(e){console.log("common.core.Core - loadWebMappingApp - appId:",e);var t=L.forceLogin!==undefined;t||app.isInBuilder?D().then(function(){_(e)},function(){q("notAuthorized")}):_(e)}function _(e){u.getItem(e).then(function(e){if(!e){q("appLoadingFail");return}var t=e.item,n=e.itemData;app.data.setWebAppItem(t),app.data.getWebAppData().set(n),app.userCanEdit=app.data.userIsAppOwner(),!app.isInBuilder&&!app.userCanEdit&&(document.__defineGetter__?(document.__defineGetter__("cookie",function(){return""}),document.__defineSetter__("cookie",function(){})):Object.defineProperty(document,"cookie",{get:function(){return""},set:function(){return!0}}));if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0]){var r=t.owner,i=!1;r&&(i=$.inArray(r,app.indexCfg.authorizedOwners)!=-1),!i&&app.indexCfg.authorizedOwners[0]=="*"&&(i=!0),i||$.each(app.indexCfg.authorizedOwners,function(e,n){var r=n.match(/^\[(.*)\]$/);r&&t.orgId==r[1]&&(i=!0)});if(!i){q("invalidConfigOwner");return}}if(t&&t.appProxies){var s=w.map(t.appProxies,function(e){return{url:e.sourceUrl,mixin:{url:e.proxyUrl}}});app.data.setAppProxies(s)}if(app.isInBuilder&&it()&&!app.userCanEdit){q("notAuthorized");return}k.webAppConfigLoaded();var o=app.appCfg?!!app.appCfg.useWebmapInApp:!0,u=app.data.getWebAppData().getWebmap()||a.getWebmapID(it());u&&o&&app.data.getWebAppData().isBlank()||app.isGalleryCreation?(k.startFromScratch(),j()):u&&o?P(u):!o||!u&&o?(j(),k.loadWebmapFromData()):a.getPortalUser()||!it()&&app.data.getWebAppData().isBlank()?Z():app.data.getWebAppData().isBlank()?q("appLoadingFail"):P(app.data.getWebAppData().getViews()[0].cfg.webmap.id)},function(e){e&&e.httpCode==400?q("invalidApp"):e&&e.httpCode==403?q("notAuthorized"):q("appLoadingFail")})}function D(){var e=new S;return y(h,"dialog-create",Q),app.portal.signIn().then(function(){if(app.isInBuilder&&!app.data.checkUserItemPrivileges()){q("notAuthorizedBuilder");return}app.userCanEdit=app.data.userIsAppOwner(),st(),e.resolve()},function(){e.reject()}),e}function P(e){k.loadFirstWebmap(e).then(b.hitch(this,function(e){H(e)}),b.hitch(this,function(){q("createMap")}))}function H(e){console.log("common.core.Core - webMapInitCallback"),app.maps[e.itemInfo.item.id]=k.getMapConfig(e),app.map=e.map,app.data.setWebMap(e.itemInfo),app.map.disableKeyboardNavigation(),j(),k.firstWebmapLoaded()}function B(){window.location=app.isPortal&&app.cfg.HELP_URL_PORTAL?app.cfg.HELP_URL_PORTAL:app.cfg.HELP_URL}function j(){var e=app.indexCfg.title||app.data.getWebAppData().getTitle(),t=app.indexCfg.subtitle||app.data.getWebAppData().getSubtitle(),n=app.data.getWebAppData().getColors();app.ui.headerDesktop&&app.ui.headerDesktop.init(!app.isInBuilder&&(app.cfg.EMBED||L.embed||L.embed===""),e,t,X(),n,J(),app.appCfg.headerCompactByDefault),app.appCfg.useAppTitleAsPageTitle&&(document.title=e?$("<div>"+e+"</div>").text():app.cfg.TPL_NAME)}function F(){console.log("common.core.Core - initApp"),V(),location.hash&&a.browserSupportHistory()&&(location.hash="map"),window.onhashchange=function(){k.prepareMobileViewSwitch(),k.onHashChange()},k.appInitComplete(),app.builder&&app.builder.appInitComplete(),(app.isInBuilder||app.userCanEdit)&&c("ie")!=9&&!L.preview&&(c("ff")&&$(".builderShare #my-stories-frame").remove(),(c("ff")||!app.isInBuilder)&&$("body").append('<div id="my-stories-hidden-container"><iframe id="my-stories-frame"></iframe></div>'),l.loadMyStories()),document.location.pathname.match(/\/apps\/[a-zA-Z]+\/$/)&&document.location.search.match(/^\?appid=/)&&(!c("ie")||c("ie")>=10)&&History.replaceState({},"","index.html"+document.location.search+document.location.hash);var e=document.location.search;e&&(e=e.replace("&preview",""),e!=document.location.search&&window.history.replaceState({},"","index.html"+e+document.location.hash))}function I(){app.isLoading=!1,$("#headerDesktop").removeAttr("aria-hidden"),$("#loadingIndicator, #loadingMessage").addClass("fadeOut").fadeOut(400),$("#loadingOverlay").fadeOut(800)}function q(e,t,n){var r=i18n.viewer.errors[e];tt(),$("#loadingIndicator").hide(),r=r.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME),e=="notAuthorized"&&app.indexCfg.oAuthAppId&&(r+='<div><button class="btn btn-sm btn-default" onclick="esri.id.destroyCredentials(); window.location.reload();">'+i18n.viewer.errors.signOut+"</button></div>"),e=="appLoadingFail"?$("#loadingMessage").html('<div id="loadingRetry"> <button type="button" class="btn btn-naked btn-sm" onclick="document.location.reload()">'+i18n.viewer.loading.failButton+" </button>"+"</div>").hide().fadeIn(1200,function(){$("#loadingMessage").addClass("loaded")}):$("#loadingMessage").hide(),c("ie")==8&&($("#fatalError-icon").css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='_resources/icons/warning-icon.png', sizingMethod='scale')",backgroundPosition:"2px 3px",width:78}),$("#fatalError-msg").css({paddingLeft:5})),$("#fatalError .error-msg").html(r),n||$("#fatalError").show()}function R(e){$("#fatalError .error-msg").html(i18n.viewer.errors[e])}function U(e,t){t=t||app.map;if(!e||!e.spatialReference||!t||!t.extent.spatialReference||!t.spatialReference){var n=new S;return n.resolve(),n}var r=app.appCfg.mapExtentFit?app.appCfg.mapExtentFit:!1;if(t.spatialReference.wkid==e.spatialReference.wkid)return t.setExtent(k.getLayoutExtent(e,!1),r);var i=new S;return d.defaults.geometryService.project([e],t.spatialReference,function(e){if(!e||!e[0])return;t.setExtent(k.getLayoutExtent(e[0],!1),r),i.resolve()}),i}function z(e,t){e?app.map.spatialReference.wkid!=102100&&app.map.spatialReference.wkid!=4326?d.defaults.geometryService.project([t],app.map.spatialReference,function(e){if(!e||!e[0])return;app.map.extent.contains(e[0])||app.map.centerAt(e[0])}):app.map.extent.contains(t)||app.map.centerAt(t):($(".mainMediaContainer.active .mapLocationMsg").html(i18n.viewer.locatorFromCommon.error),$(".mainMediaContainer.active .mapLocationError").fadeIn(),setTimeout(function(){$(".mainMediaContainer.active .mapLocationError").fadeOut()},5e3))}function W(){console.log("common.core.Core - updateUI");var e=app.data.getWebAppData().getColors();app.ui.headerDesktop&&(app.ui.headerDesktop.setTitleAndSubtitle(app.data.getWebAppData().getTitle()||(app.data.getWebMap()?app.data.getWebMap().item.title:""),app.data.getWebAppData().getSubtitle()||(app.data.getWebMap()?app.data.getWebMap().item.snippet:"")),app.ui.headerDesktop.update(X(),e,app.appCfg.headerCompactByDefault)),k.updateUI(),V()}function X(e){return{logoURL:app.data.getWebAppData().getLogoURL(e&&e.useMobileLogo),logoTarget:app.data.getWebAppData().getLogoTarget(),linkText:app.data.getWebAppData().getHeaderLinkText(),linkURL:app.data.getWebAppData().getHeaderLinkURL(),socialBtn:app.data.getWebAppData().getSocial(),compactSize:app.data.getWebAppData().getHeaderCompactSize()}}function V(){var e=$("body").width(),t=$("body").height(),n=0,r=0,i=L.forceDesktop!==undefined||app.indexCfg.forceDesktop,s=L.forceMobile!==undefined||app.indexCfg.forceMobile,o=e<=768||s,u=$(".centerLink").length?$(".centerLink").hasClass("current"):!0;i&&(o=!1),o?$("body").addClass("mobile-view"):$("body").removeClass("mobile-view"),$(".mainViewAboveMap, .mainViewBelowMap").each(function(e,t){var r=$(t);n+=r.is(":visible")?r.outerHeight():0}),$(".mainViewSideMap").each(function(e,t){var n=$(t);r+=n.is(":visible")?n.outerWidth():0}),app.ui.headerDesktop&&app.ui.headerDesktop.resize(e),app.initScreenIsOpen&&($("#header").css("display",o?"none":"block"),$("#fatalError").css("display",o?"block":"none")),app.initScreenIsOpen||$("#contentPanel").height(t-n),k.resize({isMobileView:o,isOnMobileMapView:u,width:e,height:t-n}),app.isInBuilder&&app.builder.resize({isMobileView:o});if(app.map&&(!o||o&&u))try{app.map.resize(!!app.appCfg.mapsImmediateResize)}catch(a){}o?$(".mapContainer .esriControlsBR > div").first().removeClass("logo-med").addClass("logo-sm"):$(".mapContainer .esriControlsBR > div").first().removeClass("logo-sm").addClass("logo-med")}function J(){return!app.isInBuilder&&(!it()&&!!a.getAppID(it())||it()&&app.userCanEdit)&&(L.preview===undefined||L.preview=="false")}function K(){$(".esriSignInDialog td label").siblings("br").css("display","none"),$(".esriSignInDialog .dijitDialogPaneContentArea div:nth(1)").css("display","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("padding","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("margin-bottom","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitValidationContainer").css("display","none"),$(".esriSignInDialog .esriErrorMsg").css("margin-top","10px"),$(".esriSignInDialog").find(".dijitDialogTitleBar").find(".dijitDialogTitle").first().html(i18n.viewer.signin.title),h._arcgisUrl&&($(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaLoginText'>"+i18n.viewer.signin.explainViewer.replace("%PORTAL_LINK%","<a href='http://"+h._arcgisUrl+"' title='"+h._arcgisUrl+"' target='_blank'>"+h._arcgisUrl+"</a>")+"</div>"))}function Q(){h._arcgisUrl&&$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").html(i18n.viewer.signin.explainBuilder.replace("%PORTAL_LINK%","<a href='http://"+h._arcgisUrl+"' title='"+h._arcgisUrl+"' target='_blank'>"+h._arcgisUrl+"</a>"))}function G(){$("#header").css("display","inherit"),$(".mobileView").css("display","inherit"),$("#fatalError").css("display","none"),$("#loadingOverlay").css("top","0px"),et(),V()}function Y(){window.location=u.arcgisUrl.split("/sharing/")[0]+"/home/signin.html?returnUrl="+encodeURIComponent(document.location.href)}function Z(){window.location=document.location.href+"&fromGallery"}function et(){app.loadingTimeout=setTimeout(nt,app.cfg.TIMEOUT_VIEWER_LOAD)}function tt(){typeof app!="undefined"&&app.loadingTimeout&&(clearTimeout(app.loadingTimeout),app.loadingTimeout=null)}function nt(){if(h&&h.dialog&&h.dialog._alreadyInitialized&&!h.loadingTimeoutAlreadyFired){clearTimeout(app.loadingTimeout),et(),h._busy||(h.loadingTimeoutAlreadyFired=!0);return}$("#loadingMessage").html('<div class="mainMessage">'+i18n.viewer.loading.long+"<br />"+i18n.viewer.loading.long2+"</div>").fadeIn("slow",function(){$("#loadingMessage").addClass("loaded")})}function rt(){document.documentElement.lang=E.locale,T("#fatalError .error-title")[0].innerHTML=i18n.viewer.errors.boxTitle}function it(){return C.environment!=["TPL","ENV","DEV"].join("_")}function st(){console.log("common.core.Core - parsePortalConfig");if(!app.portal)return;!app.cfg.HELPER_SERVICES.geocode.length&&app.portal.helperServices&&app.portal.helperServices.geocode&&app.portal.helperServices.geocode.length&&app.portal.helperServices.geocode[0].url&&$.each(app.portal.helperServices.geocode,function(e,t){app.cfg.HELPER_SERVICES.geocode.push(t)});var e;app.cfg.HELPER_SERVICES.geometry&&app.cfg.HELPER_SERVICES.geometry.url?e=app.cfg.HELPER_SERVICES.geometry.url:app.portal.helperServices.geometry&&app.portal.helperServices.geometry.url&&(e=app.portal.helperServices.geometry.url),d.defaults.geometryService=new v(e),!app.cfg.BING_MAPS_KEY&&app.portal.bingKey&&(app.cfg.BING_MAPS_KEY=app.portal.bingKey),app.portal.isPortal&&app.cfg&&app.cfg.AUTHORIZED_IMPORT_SOURCE&&(app.cfg.AUTHORIZED_IMPORT_SOURCE.featureService=!1),app.isPortal=!!app.portal.isPortal;if(app.isPortal&&app.portal.helpBase&&app.portal.portalHostname&&!app.cfg.HELP_URL_PORTAL.match("^//")){var t=app.portal.portalHostname.split("/")[0];app.cfg.HELP_URL_PORTAL="//"+t+app.portal.helpBase+app.cfg.HELP_URL_PORTAL}}function ot(){var e="notConfiguredMobile";tt(),app.isInitializing=!0,app.initScreenIsOpen=!0,c("touch")&&a.isMobile()&&(window.innerHeight>window.innerWidth?window.innerHeight>768&&(e="notConfiguredMobile2"):window.innerWidth>768&&(e="notConfiguredMobile2")),q(e,null,!0),setTimeout(V,50)}function ut(){$("#initPopup").modal("hide"),app.initScreenIsOpen=!1}function at(){R("notConfiguredDesktop"),$("#loadingOverlay").css("top","0px"),$("#header").css("display","inherit"),$("#fatalError").css("display","block"),app.initScreenIsOpen=!1,V()}var C={environment:"TPL_ENV_PRODUCTION"},k=null,L=a.getUrlParams();return i.apply(),{init:A,isProd:it,appInitComplete:F,displayApp:I,loadWebMap:P,handleWindowResize:V,hasSwitchBuilderButton:J,initPopupPrepare:ot,initPopupComplete:ut,initPopupFail:at,setMapExtent:U,zoomToDeviceLocation:z,getHeaderUserCfg:X,cleanLoadingTimeout:tt,initError:q,prepareAppForWebmapReload:G,replaceInitErrorMessage:R,portalLogin:D}}),define("lib-build/css!storymaps/common/ui/header/Desktop",[],function(){}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("lib-build/tpl",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("lib-build/tpl!storymaps/common/ui/share/ShareDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title"></h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="social-container">\r\n				<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\r\n				<i class="shareIcon blackHover share_twitter icon-twitter"></i>\r\n			</div>\r\n			\r\n			<div class="share-url-panel"></div>\r\n			\r\n			<div class="embed-title"></div>\r\n			<div class="share-embed-panel"></div>\r\n			\r\n			<div class="checkbox autoplay-container">\r\n				<label>\r\n					<input type="checkbox" class="autoplay-checkbox" value="autoplay" />\r\n					<span class="autoplay-label"></span>\r\n				</label>\r\n				<a href="#" class="help autoplay-help" data-toggle="tooltip">\r\n					<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\r\n				</a>\r\n				<span class="autoplay-notification"></span>\r\n			</div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal"></button>\r\n		</div>\r\n	</div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareDialog",[],function(){}),define("lib-build/tpl!storymaps/common/ui/share/ShareURLPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="share-url-container">\r\n	<span class="share-btn share-clipboard"></span>\r\n	<input type="text" class="form-control bitlylink" readonly="true"/>\r\n	<a class="btn btn-primary btn-bitlylink-open" target="_blank"></a>\r\n	<div class="share-status-wrapper"><span class="share-status"></span></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareURLPanel",[],function(){}),function(e,t){"use strict";var n=e,r=n.document,i=n.navigator,s=n.setTimeout,o=n.encodeURIComponent,u=n.ActiveXObject,a=n.Error,f=n.Number.parseInt||n.parseInt,l=n.Number.parseFloat||n.parseFloat,c=n.Number.isNaN||n.isNaN,h=n.Math.round,p=n.Date.now,d=n.Object.keys,v=n.Object.defineProperty,m=n.Object.prototype.hasOwnProperty,g=n.Array.prototype.slice,y=function(e){return g.call(e,0)},b=function(){var e,n,r,i,s,o,u=y(arguments),a=u[0]||{};for(e=1,n=u.length;e<n;e++)if((r=u[e])!=null)for(i in r)m.call(r,i)&&(s=a[i],o=r[i],a!==o&&o!==t&&(a[i]=o));return a},w=function(e){var t,n,r,i;if(typeof e!="object"||e==null)t=e;else if(typeof e.length=="number"){t=[];for(n=0,r=e.length;n<r;n++)m.call(e,n)&&(t[n]=w(e[n]))}else{t={};for(i in e)m.call(e,i)&&(t[i]=w(e[i]))}return t},E=function(e,t){var n={};for(var r=0,i=t.length;r<i;r++)t[r]in e&&(n[t[r]]=e[t[r]]);return n},S=function(e,t){var n={};for(var r in e)t.indexOf(r)===-1&&(n[r]=e[r]);return n},x=function(e){if(e)for(var t in e)m.call(e,t)&&delete e[t];return e},T=function(e,t){if(e&&e.nodeType===1&&e.ownerDocument&&t&&(t.nodeType===1&&t.ownerDocument&&t.ownerDocument===e.ownerDocument||t.nodeType===9&&!t.ownerDocument&&t===e.ownerDocument))do{if(e===t)return!0;e=e.parentNode}while(e);return!1},N=function(e){var t;return typeof e=="string"&&e&&(t=e.split("#")[0].split("?")[0],t=e.slice(0,e.lastIndexOf("/")+1)),t},C=function(e){var t,n;return typeof e=="string"&&e&&(n=e.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&&n[1]?t=n[1]:(n=e.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),n&&n[1]&&(t=n[1]))),t},k=function(){var e,t;try{throw new a}catch(n){t=n}return t&&(e=t.sourceURL||t.fileName||C(t.stack)),e},L=function(){var e,n,i;if(r.currentScript&&(e=r.currentScript.src))return e;n=r.getElementsByTagName("script");if(n.length===1)return n[0].src||t;if("readyState"in n[0])for(i=n.length;i--;)if(n[i].readyState==="interactive"&&(e=n[i].src))return e;return r.readyState==="loading"&&(e=n[n.length-1].src)?e:(e=k())?e:t},A=function(){var e,n,i,s=r.getElementsByTagName("script");for(e=s.length;e--;){if(!(i=s[e].src)){n=null;break}i=N(i);if(n==null)n=i;else if(n!==i){n=null;break}}return n||t},O=function(){var e=N(L())||A()||"";return e+"ZeroClipboard.swf"},M={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,deactivated:null,overdue:null,ready:null},_="11.0.0",D={},P,H={},B=null,j={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}},F={swfPath:O(),trustedDomains:e.location.host?[e.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},I=function(e){if(typeof e=="object"&&e!==null)for(var t in e)if(m.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))F[t]=e[t];else if(M.bridge==null)if(t==="containerId"||t==="swfObjectId"){if(!et(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");F[t]=e[t]}else F[t]=e[t];if(typeof e=="string"&&e){if(m.call(F,e))return F[e];return}return w(F)},q=function(){return{browser:E(i,["userAgent","platform","appName"]),flash:S(M,["bridge"]),zeroclipboard:{version:At.version,config:At.config()}}},R=function(){return!!(M.disabled||M.outdated||M.unavailable||M.deactivated)},U=function(e,t){var n,r,i,s={};if(typeof e=="string"&&e)i=e.toLowerCase().split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&At.on(n,e[n]);if(i&&i.length){for(n=0,r=i.length;n<r;n++)e=i[n].replace(/^on/,""),s[e]=!0,D[e]||(D[e]=[]),D[e].push(t);s.ready&&M.ready&&At.emit({type:"ready"});if(s.error){var o=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=o.length;n<r;n++)if(M[o[n]]===!0){At.emit({type:"error",name:"flash-"+o[n]});break}}}return At},z=function(e,t){var n,r,i,s,o;if(arguments.length===0)s=d(D);else if(typeof e=="string"&&e)s=e.split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&At.off(n,e[n]);if(s&&s.length)for(n=0,r=s.length;n<r;n++){e=s[n].toLowerCase().replace(/^on/,""),o=D[e];if(o&&o.length)if(t){i=o.indexOf(t);while(i!==-1)o.splice(i,1),i=o.indexOf(t,i)}else o.length=0}return At},W=function(e){var t;return typeof e=="string"&&e?t=w(D[e])||null:t=w(D),t},X=function(e){var t,n,r;e=tt(e);if(!e)return;if(ut(e))return;return e.type==="ready"&&M.overdue===!0?At.emit({type:"error",name:"flash-overdue"}):(t=b({},e),ot.call(this,t),e.type==="copy"&&(r=pt(H),n=r.data,B=r.formatMap),n)},V=function(){typeof M.ready!="boolean"&&(M.ready=!1);if(!At.isFlashUnusable()&&M.bridge===null){var e=F.flashLoadTimeout;typeof e=="number"&&e>=0&&s(function(){typeof M.deactivated!="boolean"&&(M.deactivated=!0),M.deactivated===!0&&At.emit({type:"error",name:"flash-deactivated"})},e),M.overdue=!1,ct()}},$=function(){At.clearData(),At.blur(),At.emit("destroy"),ht(),At.off()},J=function(e,t){var n;if(typeof e=="object"&&e&&typeof t=="undefined")n=e,At.clearData();else{if(typeof e!="string"||!e)return;n={},n[e]=t}for(var r in n)typeof r=="string"&&r&&m.call(n,r)&&typeof n[r]=="string"&&n[r]&&(H[r]=n[r])},K=function(e){typeof e=="undefined"?(x(H),B=null):typeof e=="string"&&m.call(H,e)&&delete H[e]},Q=function(e){if(typeof e=="undefined")return w(H);if(typeof e=="string"&&m.call(H,e))return H[e]},G=function(e){if(!e||e.nodeType!==1)return;P&&(Et(P,F.activeClass),P!==e&&Et(P,F.hoverClass)),P=e,wt(e,F.hoverClass);var t=e.getAttribute("title")||F.title;if(typeof t=="string"&&t){var n=lt(M.bridge);n&&n.setAttribute("title",t)}var r=F.forceHandCursor===!0||St(e,"cursor")==="pointer";Ct(r),Nt()},Y=function(){var e=lt(M.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.top="1px"),P&&(Et(P,F.hoverClass),Et(P,F.activeClass),P=null)},Z=function(){return P||null},et=function(e){return typeof e=="string"&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},tt=function(e){var t;typeof e=="string"&&e?(t=e,e={}):typeof e=="object"&&e&&typeof e.type=="string"&&e.type&&(t=e.type);if(!t)return;b(e,{type:t.toLowerCase(),target:e.target||P||null,relatedTarget:e.relatedTarget||null,currentTarget:M&&M.bridge||null,timeStamp:e.timeStamp||p()||null});var n=j[e.type];return e.type==="error"&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),e.type==="ready"&&b(e,{target:null,version:M.version}),e.type==="error"&&(/^flash-(disabled|outdated|unavailable|deactivated|overdue)$/.test(e.name)&&b(e,{target:null,minimumVersion:_}),/^flash-(outdated|unavailable|deactivated|overdue)$/.test(e.name)&&b(e,{version:M.version})),e.type==="copy"&&(e.clipboardData={setData:At.setData,clearData:At.clearData}),e.type==="aftercopy"&&(e=dt(e,B)),e.target&&!e.relatedTarget&&(e.relatedTarget=nt(e.target)),e=rt(e),e},nt=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?r.getElementById(t):null},rt=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var i=e.target,s=e.type==="_mouseover"&&e.relatedTarget?e.relatedTarget:t,o=e.type==="_mouseout"&&e.relatedTarget?e.relatedTarget:t,u=Tt(i),a=n.screenLeft||n.screenX||0,f=n.screenTop||n.screenY||0,l=r.body.scrollLeft+r.documentElement.scrollLeft,c=r.body.scrollTop+r.documentElement.scrollTop,h=u.left+(typeof e._stageX=="number"?e._stageX:0),p=u.top+(typeof e._stageY=="number"?e._stageY:0),d=h-l,v=p-c,m=a+d,g=f+v,y=typeof e.movementX=="number"?e.movementX:0,w=typeof e.movementY=="number"?e.movementY:0;delete e._stageX,delete e._stageY,b(e,{srcElement:i,fromElement:s,toElement:o,screenX:m,screenY:g,pageX:h,pageY:p,clientX:d,clientY:v,x:d,y:v,movementX:y,movementY:w,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},it=function(e){var t=e&&typeof e.type=="string"&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},st=function(e,t,n,r){r?s(function(){e.apply(t,n)},0):e.apply(t,n)},ot=function(e){if(typeof e!="object"||!e||!e.type)return;var t=it(e),r=D["*"]||[],i=D[e.type]||[],s=r.concat(i);if(s&&s.length){var o,u,a,f,l,c=this;for(o=0,u=s.length;o<u;o++)a=s[o],f=c,typeof a=="string"&&typeof n[a]=="function"&&(a=n[a]),typeof a=="object"&&a&&typeof a.handleEvent=="function"&&(f=a,a=a.handleEvent),typeof a=="function"&&(l=b({},e),st(a,f,[l],t))}return this},ut=function(e){var t=e.target||P||null,n=e._source==="swf";delete e._source;var r=["flash-disabled","flash-outdated","flash-unavailable","flash-deactivated","flash-overdue"];switch(e.type){case"error":r.indexOf(e.name)!==-1&&b(M,{disabled:e.name==="flash-disabled",outdated:e.name==="flash-outdated",unavailable:e.name==="flash-unavailable",deactivated:e.name==="flash-deactivated",overdue:e.name==="flash-overdue",ready:!1});break;case"ready":var i=M.deactivated===!0;b(M,{disabled:!1,outdated:!1,unavailable:!1,deactivated:!1,overdue:i,ready:!i});break;case"copy":var s,o,u=e.relatedTarget;!H["text/html"]&&!H["text/plain"]&&u&&(o=u.value||u.outerHTML||u.innerHTML)&&(s=u.value||u.textContent||u.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",s),o!==s&&e.clipboardData.setData("text/html",o)):!H["text/plain"]&&e.target&&(s=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",s));break;case"aftercopy":At.clearData(),t&&t!==bt()&&t.focus&&t.focus();break;case"_mouseover":At.focus(t),F.bubbleEvents===!0&&n&&(t&&t!==e.relatedTarget&&!T(e.relatedTarget,t)&&at(b({},e,{type:"mouseenter",bubbles:!1,cancelable:!1})),at(b({},e,{type:"mouseover"})));break;case"_mouseout":At.blur(),F.bubbleEvents===!0&&n&&(t&&t!==e.relatedTarget&&!T(e.relatedTarget,t)&&at(b({},e,{type:"mouseleave",bubbles:!1,cancelable:!1})),at(b({},e,{type:"mouseout"})));break;case"_mousedown":wt(t,F.activeClass),F.bubbleEvents===!0&&n&&at(b({},e,{type:e.type.slice(1)}));break;case"_mouseup":Et(t,F.activeClass),F.bubbleEvents===!0&&n&&at(b({},e,{type:e.type.slice(1)}));break;case"_click":case"_mousemove":F.bubbleEvents===!0&&n&&at(b({},e,{type:e.type.slice(1)}))}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type))return!0},at=function(e){if(!e||typeof e.type!="string"||!e)return;var t,i=e.target||null,s=i&&i.ownerDocument||r,o={view:s.defaultView||n,canBubble:!0,cancelable:!0,detail:e.type==="click"?1:0,button:typeof e.which=="number"?e.which-1:typeof e.button=="number"?e.button:s.createEvent?0:1},u=b(o,e);if(!i)return;s.createEvent&&i.dispatchEvent&&(u=[u.type,u.canBubble,u.cancelable,u.view,u.detail,u.screenX,u.screenY,u.clientX,u.clientY,u.ctrlKey,u.altKey,u.shiftKey,u.metaKey,u.button,u.relatedTarget],t=s.createEvent("MouseEvents"),t.initMouseEvent&&(t.initMouseEvent.apply(t,u),t._source="js",i.dispatchEvent(t)))},ft=function(){var e=r.createElement("div");return e.id=F.containerId,e.className=F.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+kt(F.zIndex),e},lt=function(e){var t=e&&e.parentNode;while(t&&t.nodeName==="OBJECT"&&t.parentNode)t=t.parentNode;return t||null},ct=function(){var e,t=M.bridge,i=lt(t);if(!t){var s=yt(n.location.host,F),o=s==="never"?"none":"all",u=mt(F),a=F.swfPath+vt(F.swfPath,F);i=ft();var f=r.createElement("div");i.appendChild(f),r.body.appendChild(i);var l=r.createElement("div"),c=M.pluginType==="activex";l.innerHTML='<object id="'+F.swfObjectId+'" name="'+F.swfObjectId+'" '+'width="100%" height="100%" '+(c?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+a+'"')+">"+(c?'<param name="movie" value="'+a+'"/>':"")+'<param name="allowScriptAccess" value="'+s+'"/>'+'<param name="allowNetworking" value="'+o+'"/>'+'<param name="menu" value="false"/>'+'<param name="wmode" value="transparent"/>'+'<param name="flashvars" value="'+u+'"/>'+"</object>",t=l.firstChild,l=null,t.ZeroClipboard=At,i.replaceChild(t,f)}return t||(t=r[F.swfObjectId],t&&(e=t.length)&&(t=t[e-1]),!t&&i&&(t=i.firstChild)),M.bridge=t||null,t},ht=function(){var e=M.bridge;if(e){var t=lt(e);t&&(M.pluginType==="activex"&&"readyState"in e?(e.style.display="none",function n(){if(e.readyState===4){for(var r in e)typeof e[r]=="function"&&(e[r]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else s(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),M.ready=null,M.bridge=null,M.deactivated=null}},pt=function(e){var t={},n={};if(typeof e!="object"||!e)return;for(var r in e)if(r&&m.call(e,r)&&typeof e[r]=="string"&&e[r])switch(r.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[r],n.text=r;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[r],n.html=r;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[r],n.rtf=r;break;default:}return{data:t,formatMap:n}},dt=function(e,t){if(typeof e!="object"||!e||typeof t!="object"||!t)return e;var n={};for(var r in e)if(m.call(e,r)){if(r!=="success"&&r!=="data"){n[r]=e[r];continue}n[r]={};var i=e[r];for(var s in i)s&&m.call(i,s)&&m.call(t,s)&&(n[r][t[s]]=i[s])}return n},vt=function(e,t){var n=t==null||t&&t.cacheBust===!0;return n?(e.indexOf("?")===-1?"?":"&")+"noCache="+p():""},mt=function(e){var t,r,i,s,u="",a=[];e.trustedDomains&&(typeof e.trustedDomains=="string"?s=[e.trustedDomains]:typeof e.trustedDomains=="object"&&"length"in e.trustedDomains&&(s=e.trustedDomains));if(s&&s.length)for(t=0,r=s.length;t<r;t++)if(m.call(s,t)&&s[t]&&typeof s[t]=="string"){i=gt(s[t]);if(!i)continue;if(i==="*"){a.length=0,a.push(i);break}a.push.apply(a,[i,"//"+i,n.location.protocol+"//"+i])}return a.length&&(u+="trustedOrigins="+o(a.join(","))),e.forceEnhancedClipboard===!0&&(u+=(u?"&":"")+"forceEnhancedClipboard=true"),typeof e.swfObjectId=="string"&&e.swfObjectId&&(u+=(u?"&":"")+"swfObjectId="+o(e.swfObjectId)),u},gt=function(e){if(e==null||e==="")return null;e=e.replace(/^\s+|\s+$/g,"");if(e==="")return null;var t=e.indexOf("//");e=t===-1?e:e.slice(t+2);var n=e.indexOf("/");return e=n===-1?e:t===-1||n===0?null:e.slice(0,n),e&&e.slice(-4).toLowerCase()===".swf"?null:e||null},yt=function(){var e=function(e){var t,n,r,i=[];typeof e=="string"&&(e=[e]);if(typeof e!="object"||!e||typeof e.length!="number")return i;for(t=0,n=e.length;t<n;t++)if(m.call(e,t)&&(r=gt(e[t]))){if(r==="*"){i.length=0,i.push("*");break}i.indexOf(r)===-1&&i.push(r)}return i};return function(t,n){var r=gt(n.swfPath);r===null&&(r=t);var i=e(n.trustedDomains),s=i.length;if(s>0){if(s===1&&i[0]==="*")return"always";if(i.indexOf(t)!==-1)return s===1&&t===r?"sameDomain":"always"}return"never"}}(),bt=function(){try{return r.activeElement}catch(e){return null}},wt=function(e,t){if(!e||e.nodeType!==1)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&typeof t=="string"){var n=(t||"").split(/\s+/);if(e.nodeType===1)if(!e.className)e.className=t;else{var r=" "+e.className+" ",i=e.className;for(var s=0,o=n.length;s<o;s++)r.indexOf(" "+n[s]+" ")<0&&(i+=" "+n[s]);e.className=i.replace(/^\s+|\s+$/g,"")}}return e},Et=function(e,t){if(!e||e.nodeType!==1)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if(typeof t=="string"&&t){var n=t.split(/\s+/);if(e.nodeType===1&&e.className){var r=(" "+e.className+" ").replace(/[\n\t]/g," ");for(var i=0,s=n.length;i<s;i++)r=r.replace(" "+n[i]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}}return e},St=function(e,t){var r=n.getComputedStyle(e,null).getPropertyValue(t);return t!=="cursor"||!!r&&r!=="auto"||e.nodeName!=="A"?r:"pointer"},xt=function(){var e,t,n,i=1;return typeof r.body.getBoundingClientRect=="function"&&(e=r.body.getBoundingClientRect(),t=e.right-e.left,n=r.body.offsetWidth,i=h(t/n*100)/100),i},Tt=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var i=e.getBoundingClientRect(),s,o,u;"pageXOffset"in n&&"pageYOffset"in n?(s=n.pageXOffset,o=n.pageYOffset):(u=xt(),s=h(r.documentElement.scrollLeft/u),o=h(r.documentElement.scrollTop/u));var a=r.documentElement.clientLeft||0,f=r.documentElement.clientTop||0;t.left=i.left+s-a,t.top=i.top+o-f,t.width="width"in i?i.width:i.right-i.left,t.height="height"in i?i.height:i.bottom-i.top}return t},Nt=function(){var e;if(P&&(e=lt(M.bridge))){var t=Tt(P);b(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+kt(F.zIndex)})}},Ct=function(e){M.ready===!0&&(M.bridge&&typeof M.bridge.setHandCursor=="function"?M.bridge.setHandCursor(e):M.ready=!1)},kt=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return typeof e=="number"&&!c(e)?t=e:typeof e=="string"&&(t=kt(f(e,10))),typeof t=="number"?t:"auto"},Lt=function(e){function f(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function c(e){return!!e&&(e=e.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||e.slice(-13)==="chrome.plugin")}function h(e){e&&(s=!0,e.version&&(a=f(e.version)),!a&&e.description&&(a=f(e.description)),e.filename&&(u=c(e.filename)))}var t,n,r,s=!1,o=!1,u=!1,a="";if(i.plugins&&i.plugins.length)t=i.plugins["Shockwave Flash"],h(t),i.plugins["Shockwave Flash 2.0"]&&(s=!0,a="2.0.0.11");else if(i.mimeTypes&&i.mimeTypes.length)r=i.mimeTypes["application/x-shockwave-flash"],t=r&&r.enabledPlugin,h(t);else if(typeof e!="undefined"){o=!0;try{n=new e("ShockwaveFlash.ShockwaveFlash.7"),s=!0,a=f(n.GetVariable("$version"))}catch(p){try{n=new e("ShockwaveFlash.ShockwaveFlash.6"),s=!0,a="6.0.21"}catch(d){try{n=new e("ShockwaveFlash.ShockwaveFlash"),s=!0,a=f(n.GetVariable("$version"))}catch(v){o=!1}}}}M.disabled=s!==!0,M.outdated=a&&l(a)<l(_),M.version=a||"0.0.0",M.pluginType=u?"pepper":o?"activex":s?"netscape":"unknown"};Lt(u);var At=function(){if(!(this instanceof At))return new At;typeof At._createClient=="function"&&At._createClient.apply(this,y(arguments))};try{v(At,"version",{value:"2.1.3",writable:!1,configurable:!0,enumerable:!0})}catch(Ot){}At.config=function(){return I.apply(this,y(arguments))},At.state=function(){return q.apply(this,y(arguments))},At.isFlashUnusable=function(){return R.apply(this,y(arguments))},At.on=function(){return U.apply(this,y(arguments))},At.off=function(){return z.apply(this,y(arguments))},At.handlers=function(){return W.apply(this,y(arguments))},At.emit=function(){return X.apply(this,y(arguments))},At.create=function(){return V.apply(this,y(arguments))},At.destroy=function(){return $.apply(this,y(arguments))},At.setData=function(){return J.apply(this,y(arguments))},At.clearData=function(){return K.apply(this,y(arguments))},At.getData=function(){return Q.apply(this,y(arguments))},At.focus=At.activate=function(){return G.apply(this,y(arguments))},At.blur=At.deactivate=function(){return Y.apply(this,y(arguments))},At.activeElement=function(){return Z.apply(this,y(arguments))};var Mt=0,_t={},Dt=0,Pt={},Ht={};b(F,{autoActivate:!0});var Bt=function(e){var t=this;t.id=""+Mt++,_t[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),At.on("*",function(e){return t.emit(e)}),At.on("destroy",function(){t.destroy()}),At.create()},jt=function(e,t){var n,r,i,s={},o=_t[this.id]&&_t[this.id].handlers;if(typeof e=="string"&&e)i=e.toLowerCase().split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&this.on(n,e[n]);if(i&&i.length){for(n=0,r=i.length;n<r;n++)e=i[n].replace(/^on/,""),s[e]=!0,o[e]||(o[e]=[]),o[e].push(t);s.ready&&M.ready&&this.emit({type:"ready",client:this});if(s.error){var u=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=u.length;n<r;n++)if(M[u[n]]){this.emit({type:"error",name:"flash-"+u[n],client:this});break}}}return this},Ft=function(e,t){var n,r,i,s,o,u=_t[this.id]&&_t[this.id].handlers;if(arguments.length===0)s=d(u);else if(typeof e=="string"&&e)s=e.split(/\s+/);else if(typeof e=="object"&&e&&typeof t=="undefined")for(n in e)m.call(e,n)&&typeof n=="string"&&n&&typeof e[n]=="function"&&this.off(n,e[n]);if(s&&s.length)for(n=0,r=s.length;n<r;n++){e=s[n].toLowerCase().replace(/^on/,""),o=u[e];if(o&&o.length)if(t){i=o.indexOf(t);while(i!==-1)o.splice(i,1),i=o.indexOf(t,i)}else o.length=0}return this},It=function(e){var t=null,n=_t[this.id]&&_t[this.id].handlers;return n&&(typeof e=="string"&&e?t=n[e]?n[e].slice(0):[]:t=w(n)),t},qt=function(e){if(Xt.call(this,e)){typeof e=="object"&&e&&typeof e.type=="string"&&e.type&&(e=b({},e));var t=b({},tt(e),{client:this});Vt.call(this,t)}return this},Rt=function(e){e=$t(e);for(var t=0;t<e.length;t++)if(m.call(e,t)&&e[t]&&e[t].nodeType===1){e[t].zcClippingId?Pt[e[t].zcClippingId].indexOf(this.id)===-1&&Pt[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+Dt++,Pt[e[t].zcClippingId]=[this.id],F.autoActivate===!0&&Jt(e[t]));var n=_t[this.id]&&_t[this.id].elements;n.indexOf(e[t])===-1&&n.push(e[t])}return this},Ut=function(e){var t=_t[this.id];if(!t)return this;var n=t.elements,r;typeof e=="undefined"?e=n.slice(0):e=$t(e);for(var i=e.length;i--;)if(m.call(e,i)&&e[i]&&e[i].nodeType===1){r=0;while((r=n.indexOf(e[i],r))!==-1)n.splice(r,1);var s=Pt[e[i].zcClippingId];if(s){r=0;while((r=s.indexOf(this.id,r))!==-1)s.splice(r,1);s.length===0&&(F.autoActivate===!0&&Kt(e[i]),delete e[i].zcClippingId)}}return this},zt=function(){var e=_t[this.id];return e&&e.elements?e.elements.slice(0):[]},Wt=function(){this.unclip(),this.off(),delete _t[this.id]},Xt=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=_t[this.id]&&_t[this.id].elements,n=!!t&&t.length>0,r=!e.target||n&&t.indexOf(e.target)!==-1,i=e.relatedTarget&&n&&t.indexOf(e.relatedTarget)!==-1,s=e.client&&e.client===this;return r||i||s?!0:!1},Vt=function(e){if(typeof e!="object"||!e||!e.type)return;var t=it(e),r=_t[this.id]&&_t[this.id].handlers["*"]||[],i=_t[this.id]&&_t[this.id].handlers[e.type]||[],s=r.concat(i);if(s&&s.length){var o,u,a,f,l,c=this;for(o=0,u=s.length;o<u;o++)a=s[o],f=c,typeof a=="string"&&typeof n[a]=="function"&&(a=n[a]),typeof a=="object"&&a&&typeof a.handleEvent=="function"&&(f=a,a=a.handleEvent),typeof a=="function"&&(l=b({},e),st(a,f,[l],t))}return this},$t=function(e){return typeof e=="string"&&(e=[]),typeof e.length!="number"?[e]:e},Jt=function(e){if(!e||e.nodeType!==1)return;var t=function(e){if(!e&&!(e=n.event))return;e._source!=="js"&&(e.stopImmediatePropagation(),e.preventDefault()),delete e._source},r=function(r){if(!r&&!(r=n.event))return;t(r),At.focus(e)};e.addEventListener("mouseover",r,!1),e.addEventListener("mouseout",t,!1),e.addEventListener("mouseenter",t,!1),e.addEventListener("mouseleave",t,!1),e.addEventListener("mousemove",t,!1),Ht[e.zcClippingId]={mouseover:r,mouseout:t,mouseenter:t,mouseleave:t,mousemove:t}},Kt=function(e){if(!e||e.nodeType!==1)return;var t=Ht[e.zcClippingId];if(typeof t!="object"||!t)return;var n,r,i=["move","leave","enter","out","over"];for(var s=0,o=i.length;s<o;s++)n="mouse"+i[s],r=t[n],typeof r=="function"&&e.removeEventListener(n,r,!1);delete Ht[e.zcClippingId]};At._createClient=function(){Bt.apply(this,y(arguments))},At.prototype.on=function(){return jt.apply(this,y(arguments))},At.prototype.off=function(){return Ft.apply(this,y(arguments))},At.prototype.handlers=function(){return It.apply(this,y(arguments))},At.prototype.emit=function(){return qt.apply(this,y(arguments))},At.prototype.clip=function(){return Rt.apply(this,y(arguments))},At.prototype.unclip=function(){return Ut.apply(this,y(arguments))},At.prototype.elements=function(){return zt.apply(this,y(arguments))},At.prototype.destroy=function(){return Wt.apply(this,y(arguments))},At.prototype.setText=function(e){return At.setData("text/plain",e),this},At.prototype.setHtml=function(e){return At.setData("text/html",e),this},At.prototype.setRichText=function(e){return At.setData("application/rtf",e),this},At.prototype.setData=function(){return At.setData.apply(this,y(arguments)),this},At.prototype.clearData=function(){return At.clearData.apply(this,y(arguments)),this},At.prototype.getData=function(){return At.getData.apply(this,y(arguments))},typeof define=="function"&&define.amd?define("lib-app/ZeroClipboard/ZeroClipboard.min",[],function(){return At}):typeof module=="object"&&module&&typeof module.exports=="object"&&module.exports?module.exports=At:e.ZeroClipboard=At}(function(){return this||window}()),define("lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font",[],function(){}),define("storymaps/common/ui/share/ShareURLPanel",["lib-build/tpl!./ShareURLPanel","lib-build/css!./ShareURLPanel","../../utils/SocialSharing","dojo/has","lib-app/ZeroClipboard/ZeroClipboard.min","lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css"],function(e,t,n,r,i){return function(s){function a(e,t){o.val(e),s.find(".btn-bitlylink-open").attr("href",e),n.requestBitly(e).then(function(e){o.val(e),(t===undefined||t===!0)&&o.select()}),i.config({swfPath:(app.isProduction?"resources/lib/":"lib-app")+"/ZeroClipboard/ZeroClipboard.swf"});var r=new i(s.find(".share-btn"));r.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",s.find(".bitlylink").val()),s.find(".share-btn").removeClass("share-clipboard").addClass("share-ok"),s.find(".share-status").show(),s.find(".bitlylink")[0].selectionStart=s.find(".bitlylink")[0].selectionEnd=-1,s.find(".bitlylink").focus(),setTimeout(function(){s.find(".share-btn").addClass("share-clipboard").removeClass("share-ok"),s.find(".share-status").hide()},2e3)})}function f(){s.find(".bitlylink").click(function(){this.setSelectionRange(0,this.value.length)})}s.append(e({}));var o=s.find(".bitlylink"),u=null;f(),this.present=function(e,t){u=n.cleanURL(e,!0),a(u,t),s.find(".btn-bitlylink-open").html(i18n.viewer.shareFromCommon.open),s.find(".share-url-container").toggleClass("touch",!!r("touch")),s.find(".share-btn").attr("title",i18n.viewer.shareFromCommon.copy),s.find(".share-status").html(i18n.viewer.shareFromCommon.copied)},this.focus=function(){o.select()},this.setAutoplay=function(e){var t=u;e&&(t+=t.match(/\?/)?"&":"?",t+="autoplay"),a(t)}}}),define("lib-build/tpl!storymaps/common/ui/share/ShareEmbedPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="share-embed-container">\r\n	<div class="embed-explain"></div>\r\n\r\n	<div class="share-embed-wrapper">\r\n		<div class="share-btn share-clipboard"></div>	\r\n		<textarea class="form-control embedTextarea" readonly="true"></textarea>\r\n	</div>\r\n	<div class="share-status-wrapper"><span class="share-status"></span></div>\r\n	\r\n	<div>\r\n		<span class="embed-lbl-size"></span>\r\n		<div class="btn-group">\r\n			<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">\r\n				<span class="embed-sizes-btn"></span>&nbsp;<span class="caret"></span>\r\n			</button>\r\n			<ul class="dropdown-menu embed-sizes" role="menu"></ul>\r\n		</div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareEmbedPanel",[],function(){}),define("storymaps/common/ui/share/ShareEmbedPanel",["lib-build/tpl!./ShareEmbedPanel","lib-build/css!./ShareEmbedPanel","dojo/has","lib-app/ZeroClipboard/ZeroClipboard.min","lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css"],function(e,t,n,r){return function(i){function f(){$.each(o,function(e,t){i.find(".embed-sizes").append('<li><a data-width="'+t.width+'" data-height="'+t.height+'">'+t.width+" / "+t.height+"</a></li>")}),i.find(".embed-sizes a").click(function(){var e=$(this);e.parents(".btn-group").find(".embed-sizes-btn").text(e.text()),l(e.data("width"),e.data("height"))})}function l(e,t){i.find(".embedTextarea").val(s.replace("%URL%",u).replace("%WIDTH%",e).replace("%HEIGHT%",t)),r.config({swfPath:(app.isProduction?"resources/lib/":"lib-app")+"/ZeroClipboard/ZeroClipboard.swf"});var n=new r(i.find(".share-btn"));n.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",i.find(".embedTextarea").val()),i.find(".share-btn").removeClass("share-clipboard").addClass("share-ok"),i.find(".share-status").show(),i.find(".embedTextarea")[0].selectionStart=i.find(".embedTextarea")[0].selectionEnd=-1,i.find(".bitlylink").focus(),setTimeout(function(){i.find(".share-btn").addClass("share-clipboard").removeClass("share-ok"),i.find(".share-status").hide()},2e3)})}function c(){i.find(".embedTextarea").click(function(){this.setSelectionRange(0,this.value.length)})}var s='<iframe width="%WIDTH%" height="%HEIGHT%" src="%URL%" frameborder="0" scrolling="no"></iframe>',o=[{width:"100%",height:"800px"},{width:"100%",height:"640px"},{width:"800px",height:"600px"},{width:"640px",height:"480px"}],u=null,a=null;i.append(e({})),f(),c(),this.present=function(e){a=e,u=e,i.find(".embed-explain").html(i18n.viewer.shareFromCommon.embedExplain),i.find(".embed-lbl-size").html(i18n.viewer.shareFromCommon.size),i.find(".embed-sizes a").eq(0).click(),i.find(".share-embed-wrapper").toggleClass("touch",!!n("touch")),i.find(".share-clipboard").attr("title",i18n.viewer.shareFromCommon.copy),i.find(".share-status").html(i18n.viewer.shareFromCommon.copied)},this.setAutoplay=function(e){var t=a;e&&(t+=t.match(/\?/)?"&":"?",t+="autoplay"),u=t,i.find(".embed-sizes a").eq(0).click()}}}),define("storymaps/common/ui/share/ShareDialog",["lib-build/tpl!./ShareDialog","lib-build/css!./ShareDialog","./ShareURLPanel","./ShareEmbedPanel","../../utils/SocialSharing"],function(e,t,n,r,i){return function(s){function a(e){var t=$("<div>"+app.data.getWebAppData().getTitle()+"</div>").text();s.find(".share_facebook").toggle(e.facebook),e.facebook&&s.find(".share_facebook").off("click").click(function(){i.shareFacebook("","",null,$(this).data("url"))}),s.find(".share_twitter").toggle(e.twitter),e.twitter&&s.find(".share_twitter").off("click").click(function(){i.shareTwitter(t,$(this).data("url"))})}s.append(e({}));var o=new n(s.find(".share-url-panel")),u=new r(s.find(".share-embed-panel"));s.on("shown.bs.modal",function(){o.focus()}),s.find(".autoplay-checkbox").change(function(){o.setAutoplay(!!this.checked),u.setAutoplay(!!this.checked),s.find(".autoplay-notification").html(i18n.viewer.shareFromCommon.linksupdated).fadeIn(),setTimeout(function(){s.find(".autoplay-notification").fadeOut()},1e3)}),this.present=function(e,t){t=t||{facebook:!1,twitter:!1},s.find(".social-container").toggle(t.facebook||t.twitter),a(t),o.present(e),u.present(e),s.find(".modal-title").html(i18n.viewer.headerFromCommon.share),s.find(".embed-title").html(i18n.viewer.shareFromCommon.embed),s.find(".btn-close").html(i18n.viewer.common.close),s.find(".autoplay-label").html(i18n.viewer.shareFromCommon.autoplayLabel),s.find(".autoplay-help").tooltip({title:i18n.viewer.shareFromCommon.autoplayExplain1+"<br /><br />"+i18n.viewer.shareFromCommon.autoplayExplain2,html:!0}),s.find(".autoplay-checkbox").prop("checked",!1),s.modal({keyboard:!0}),app.appCfg.disableAutoPlay&&s.find(".autoplay-container").hide()}}}),define("storymaps/common/utils/HeaderHelper",["./SocialSharing","../ui/share/ShareDialog"],function(e,t){function r(e){e.find(".linkContainer").parent().length&&e.find(".linkContainer").css("width",(e.find(".logoContainer").position()||{left:186}).left-e.find(".linkContainer").parent().position().left-e.find(".shareBtns").outerWidth()-($(".logoContainer").width()>1?14:4))}var n=new t($("#shareDialog"));return{setLogo:function(e,t,n){!t.logoURL||t.logoURL=="NO_LOGO"?(e.find(".logoImg").hide(),r(e)):(e.find(".logoLink").css("cursor",t.logoTarget?"pointer":"default"),t.logoTarget&&e.find(".logoLink").attr("href",t.logoTarget),r(e),e.find(".logoImg")[0].onload=function(){r(e),n&&typeof n=="function"&&n()},e.find(".logoImg")[0].onerror=function(){r(e)},e.find(".logoImg").attr("src",t.logoURL).show())},setLink:function(e,t){t.linkURL&&t.linkText?e.find(".linkContainer").html('<a href="'+t.linkURL+'" class="link" target="_blank" tabindex="-1">'+t.linkText+"</a>"):e.find(".linkContainer").html(t.linkText)},setSocial:function(e,t){var n=app.cfg.HEADER_SOCIAL,r=t.socialBtn,i=n&&n.facebook&&(!r||r.facebook),s=n&&n.twitter&&(!r||r.twitter),o=n&&n.bitly&&n.bitly.enable&&n.bitly.login&&n.bitly.key&&(!r||r.bitly);e.find(".share_facebook").toggleClass("active",i),e.find(".share_twitter").toggleClass("active",s),e.find(".share_bitly").toggleClass("active",o),e.find(".share-all").data("share-facebook",i).data("share-twitter",s).toggleClass("active",i||s||o)},toggleSocialBtnAppSharing:function(e,t){t&&e.find(".shareIcon").attr("title",""),e.find(".shareIcon").toggleClass("disabled",!!t).tooltip(t?{title:i18n.commonCore?i18n.commonCore.builderPanel.tooltipNotShared:"",container:"body"}:"destroy")},disableSocialBtnAppSharingAutoplay:function(e,t){e.find(".shareIcon").attr("title",""),e.find(".shareIcon").toggleClass("disabled",!0).tooltip({title:i18n.viewer.headerFromCommon.tooltipAutoplayDisabled,container:"body",placement:t?t:"bottom"})},initEvents:function(t){t.find(".share_facebook").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$("<div>"+(app.data.getWebAppData().getTitle()||"")+"</div>").text(),n=$("<div>"+(app.data.getWebAppData().getSubtitle()||"")+"</div>").text();e.shareFacebook(t,n,null,$(this).data("url"))}),t.find(".share_twitter").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$("<div>"+(app.data.getWebAppData().getTitle()||"")+"</div>").text();e.shareTwitter(t,$(this).data("url"))}),t.find(".share_bitly").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$(this).data("url")||document.location.href;n.present(e.cleanURL(t,!0))}),t.find(".share-all").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$(this).data("url")||document.location.href;n.present(e.cleanURL(t,!0),{facebook:!!$(this).data("share-facebook"),twitter:!!$(this).data("share-twitter")})}),t.find(".shareIcon, .share-all").off("keypress").keypress(function(e){if(e.which==13)return $(this).click(),!1}),t.find(".share_facebook").attr("title",i18n.viewer.headerFromCommon.facebookTooltip),t.find(".share_twitter").attr("title",i18n.viewer.headerFromCommon.twitterTooltip),t.find(".share_bitly").attr("title",i18n.viewer.headerFromCommon.bitlyTooltip),$(window).resize(function(){r(t)})}}}),define("lib-build/css!storymaps/common/builder/InlineFieldEdit",[],function(){}),define("storymaps/common/builder/InlineFieldEdit",["lib-build/css!./InlineFieldEdit","dojo/has"],function(e,t){return function(n,r,i){function o(e,t,n){if(!e||!t||!n)return;typeof r=="function"&&r(),s=n,t.parent().parent().addClass("isEditing"),t.hide(),e.hide(),n.val(t.html()),n.show(),n.select()}function u(e){if(!e||!e.get(0))return;s=null;var n=e.get(0).value,r=e.parent().find(".text_edit_label"),o=e.parent().find(".text_edit_icon"),u=r.parent().first();n===""&&(n=i18n.commonCore.inlineFieldEdit.editMe),n=n.replace(/<\/?script>/g,""),r.parent().parent().removeClass("isEditing"),r.html(n),r.show(),e.hide(),o.css("display","inline-block"),t("ios")&&document.activeElement.blur(),typeof i=="function"&&i(u,n)}var s=null;n.find(".text_edit_icon").click(function(){o($(this),$(this).parent().find(".text_edit_label"),$(this).parent().find(".text_edit_input"))}),n.find(".text_edit_label").click(function(){o($(this).parent().find(".text_edit_icon"),$(this),$(this).parent().find(".text_edit_input"))}),n.find(".text_edit_input").blur(function(){u($(this))}),t("ios")&&$("body").bind("touchstart",function(e){s&&e.target!=s.get(0)&&u(s)}),n.find(".text_edit_input").keypress(function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&u($(this))})}}),define("storymaps/common/ui/header/Desktop",["lib-build/css!./Desktop","../../utils/HeaderHelper","../../builder/InlineFieldEdit","../../utils/CommonHelper","dojo/has","dojo/topic"],function(e,t,n,r,i,s){return function(o,u){function f(){$("#headerDesktop .subtitle:visible").length?$("#headerDesktop .subtitle")[0].focus():$("#headerDesktop .title")[0].focus()}function l(e){o.css("background-color",e.header),o.find(".textArea").css("color",e.headerTitle),o.find(".rightArea").css("color",e.headerText)}function c(e,n){var r=e.compactSize===undefined?n:e.compactSize;t.setLogo(o,e,a.resize),t.setLink(o,e),t.setSocial(o,e),t.initEvents(o,"bottom"),o.toggleClass("compact",r),r&&(o.find(".rightArea").hide(),setTimeout(function(){o.find(".rightArea").show()},0))}function h(){return o.find(".check-story").hide(),!o.find(".check-story").is(":visible")&&!o.find(".share-story").is(":visible")&&o.find(".error-status").removeClass("enabled"),a.resize(),!1}function p(){return o.find(".share-story").hide(),!o.find(".check-story").is(":visible")&&!o.find(".share-story").is(":visible")&&o.find(".error-status").removeClass("enabled"),a.resize(),!1}function d(e){var t=o.find(".check-story"),n=$('<span aria-hidden="true" class="check-story-close">×</span>'),s=$('<span aria-hidden="true" class="check-story-close">×</span>');t.off("click").removeClass("forceEvent").show(),n.click(h),s.click(p),e=="start"?t.html('<span class="small-loader"></span>'+i18n.viewer.headerFromCommon.checking).append(n).css("cursor","default"):e=="error"?t.html(i18n.viewer.headerFromCommon.fix).append(n).css("cursor","pointer").click(r.switchToBuilder).removeClass("btn-warning").addClass("btn-danger"):t.html(i18n.viewer.headerFromCommon.noerrors).append(n).removeClass("btn-warning").addClass("btn-success"),(i("ff")||i("ie")||i("trident")==7)&&e!="error"&&t.click(h).addClass("forceEvent"),o.find(".share-story").html(i18n.viewer.headerFromCommon.notshared).append(s).toggle(app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared")}function v(){}function m(e,t){setTimeout(function(){s.publish("HEADER_EDITED",{src:$(e).attr("class").split(" ")[0],value:t}),$(e).removeClass("error")},i("ios")||i("ie")>=10?700:0),app.builder.hideSaveConfirmation()}var a=this;this.init=function(e,t,a,f,h,p,g){l(h);if(e){o.addClass("hideDesktop");return}u&&(o.addClass("isBuilder"),t="<div class='text_edit_label'>"+(t||i18n.commonCore.inlineFieldEdit.editMe)+"</div>",t+="<div class='text_edit_icon' title='"+i18n.commonCore.header.title.replace("%TPL_NAME%",app.cfg.TPL_NAME)+"'></div>",t+="<textarea rows='1' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>",a="<span class='text_edit_label'>"+(a||i18n.commonCore.inlineFieldEdit.editMe)+"</span>",a+="<div class='text_edit_icon' title='"+i18n.commonCore.header.subtitle.replace("%TPL_NAME%",app.cfg.TPL_NAME)+"'></div>",a+="<textarea rows='3' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>"),o.find(".title").html(t),o.find(".subtitle").html(a),u&&new n(o,v,m);if(!u&&!a){var y=f.compactSize===undefined?g:f.compactSize;y||(o.find(".title").css({paddingTop:30,height:90}),o.find(".subtitle").css("height",32).attr("tabindex","-1"))}p&&(o.find(".switchBuilder").html('<span class="glyphicon glyphicon-cog"></span>'+i18n.viewer.headerFromCommon.builderButton+'<span aria-hidden="true" class="switch-builder-close">×</span>').click(r.switchToBuilder).show(),i("ff")||i("ie")||i("trident")==7?o.find(".switch-builder-close").hide():o.find(".switch-builder-close").click(function(){return o.find(".switchBuilder").hide(),$(window).resize(),!1})),!app.isInBuilder&&app.userCanEdit&&i("ie")!=9&&!r.getUrlParams().preview&&(o.find(".error-status").addClass("enabled"),s.subscribe("MYSTORIES_SCAN",d),d("start")),c(f,g)},this.resize=function(e){e||(e=$(document).width());var t=Math.max(o.find(".logoImg").outerWidth()+50,o.find(".rightArea").outerWidth()+20);o.find(".textArea").width(e-t-15)},this.update=function(e,t,n){l(t),c(e,n)},this.getTitle=function(){return u?o.find(".title .text_edit_label").html():o.find(".title").html()},this.getSubtitle=function(){return u?o.find(".subtitle .text_edit_label").html():o.find(".subtitle").html()},this.setTitleAndSubtitle=function(e,t){var n=u?i18n.commonCore.inlineFieldEdit.editMe:"";o.find(".title"+(u?" .text_edit_label":"")).html(e||n),o.find(".subtitle"+(u?" .text_edit_label":"")).html(t||n)},this.toggleSocialBtnAppSharing=function(e){t.toggleSocialBtnAppSharing(o,e)},this.focus=function(e){!e||e.area=="social"?($("#headerDesktop .shareIcon").attr("tabindex","0"),$("#headerDesktop .linkContainer a").length?$("#headerDesktop .linkContainer a").attr("tabindex","0")[0].focus():$("#headerDesktop .linkContainer").length?$("#headerDesktop .linkContainer").attr("tabindex","0")[0].focus():$("#headerDesktop .shareIcon:visible").length?$("#headerDesktop .shareIcon")[0].focus():f()):f()},this.enableAutoplay=function(){t.disableSocialBtnAppSharingAutoplay(o)},this.setTitleError=function(){o.find(".title").addClass("error")},this.initLocalization=function(){}}}),define("lib-build/css!storymaps/tpl/core/MainView",[],function(){}),define("storymaps/tpl/core/Config",[],function(){var e="resources/tpl/viewer/icons/esri-logo-white.png",t="http://www.esri.com",n="A story map",r="http://storymaps.arcgis.com";return app.appCfg={supportWebmapPreviewAGOL:!1,webmapStory:!0,createWebmap:!0,useWebmapInApp:!0,useStandardHeader:!0,useAppTitleAsPageTitle:!0,headerCompactOpt:!0,headerCompactByDefault:!1,mapsImmediateResize:!0,mapCommandLargerTouch:!1,mediaPickerDisableVideo:!0,mediaPickerDisableWebPage:!0,mediaPickerSkipConfigure:!0,mediaPickerConfigureForceMode:"shortlist",disableAutoPlay:!0,noAppTitleInitScreen:!0,mapExtentFit:!0},{checkConfigFileIsOK:function(){return app.cfg.HEADER_LOGO_URL=e,app.cfg.HEADER_LOGO_TARGET=t,app.cfg.HEADER_LINK_TEXT=n,app.cfg.HEADER_LINK_URL=r,app.cfg&&app.cfg.HEADER_LOGO_URL!==undefined&&app.cfg.HEADER_LOGO_TARGET!==undefined&&app.cfg.HEADER_LINK_TEXT!==undefined&&app.cfg.HEADER_LINK_URL!==undefined&&app.cfg.HEADER_SOCIAL&&app.cfg.TIMEOUT_VIEWER_LOAD&&app.cfg.TIMEOUT_VIEWER_REQUEST&&app.cfg.TIMEOUT_BUILDER_REQUEST&&app.cfg.HELP_URL&&app.cfg.HELP_URL_PORTAL&&app.cfg.TPL_NAME&&app.cfg.WEBAPP_TAG&&app.cfg.WEBAPP_KEYWORD_GENERIC&&app.cfg.WEBAPP_KEYWORD_APP&&app.cfg.AUTHORIZED_IMPORT_SOURCE&&app.cfg.FLICKR_API_KEY&&app.cfg.FACEBOOK_APP_ID&&app.cfg.YOUTUBE_DISABLE_ON_PORTAL!==undefined&&app.cfg.YOUTUBE_API_KEY&&app.cfg.CORS_SERVER&&app.cfg.DEFAULT_SHARING_URL&&app.cfg.DEFAULT_PROXY_URL}}}),define("storymaps/tpl/core/WebApplicationData",["dojo/_base/lang"],function(e){var t={},n={values:{tabs:[]}};return{set:function(r){t=e.clone(r);if(!r||!r.values)return;n=r},get:function(){var t=e.clone(n);return t.values.template=t.values.template||{},t.values.template={name:t.values.template.name||app.cfg.TPL_NAME,createdWith:t.values.template.createdWith||app.version,editedWith:app.version},t},getOriginalData:function(){return t},isBlank:function(){return Object.keys(n.values).length<=2},getBlank:function(){return{values:{webmap:t.values.webmap}}},getSourceWebmap:function(){return t&&t.values?t.values.webmap:null},cleanWebAppAfterInitialization:function(){return!1},restoreOriginalData:function(){this.set(t)},updateAfterSave:function(){t=e.clone(n)},getTemplateVersion:function(){return n.values.template?n.values.template.editedWith:null},getTemplateCreation:function(){return n.values.template?n.values.template.creaedWith:null},getDoNotWarnTitle:function(){return n.values.doNotWarnTitle||!1},setDoNotWarnTitle:function(e){n.values.doNotWarnTitle=e},getWebmap:function(){return n.values.webmap},setWebmap:function(e){n.values.webmap=e},getResponse:function(){return n.values.response},setResponse:function(e){n.values.response=e},getOriginalWebmap:function(){return n.values.originalWebmap},setOriginalWebmap:function(e){n.values.originalWebmap=e},getMapExtent:function(){return n.values.mapExtent},setMapExtent:function(e){n.values.mapExtent=e},getTitle:function(){return n.values.title},setTitle:function(e){n.values.title=e},getSubtitle:function(){return n.values.subtitle},setSubtitle:function(e){n.values.subtitle=e},getSettings:function(){return n.values.settings||{}},getLayoutId:function(){return"shortlist-classic"},getLayers:function(){return n.values.layers},setLayers:function(e){n.values.layers||(n.values.layers=[]),n.values.layers.push(e)},getShortlistLayerId:function(){return n.values.shortlistLayerId},setShortlistLayerId:function(e){n.values.shortlistLayerId=e},getTabs:function(){return n.values.tabs},setTabs:function(e){n.values.tabs=e},clearLayers:function(){n.values.layers=[]},reverseContentLayers:function(){n.values.contentLayers.reverse()},getSupportLayers:function(){return n.values.supportLayers},setSupportLayers:function(e){n.values.supportLayers||(n.values.supportLayers=[]),n.values.supportLayers.push(e)},getStoryTestPanel:function(){return n.values.testPanel},setStoryTestPanel:function(e){n.values.testPanel=e},getLocateBtn:function(){return!0},getGeneralOptions:function(){var t=e.clone(this.getSettings().generalOptions)||{};return t},setGeneralOptions:function(e){n.values.settings=n.values.settings||{},n.values.settings.generalOptions=e},setDefaultGeneralOptions:function(){this.setGeneralOptions({extentMode:"default",numberedIcons:!1,filterByExtent:!0,bookmarks:!1,bookmarksAlias:"Zoom"})},getMapOptions:function(){var t=e.clone(this.getSettings().mapOptions)||{};return t},setMapOptions:function(e){n.values.settings=n.values.settings||{},n.values.settings.mapOptions=e},setDefaultMapOptions:function(){this.setMapOptions({locateBtn:!1,geocoder:!1,bookmarks:!1})},getLayoutOptions:function(){var t=e.clone(this.getSettings().layoutOptions)||{};return t},setLayoutOptions:function(e){n.values.settings=n.values.settings||{},n.values.settings.layoutOptions=e},setDefaultLayoutOptions:function(){this.setLayoutOptions({description:!0})},getColors:function(){return{}},getHeader:function(){return this.getSettings().header||{}},setHeader:function(e){n.values.settings=n.values.settings||{},n.values.settings.header=e},getHeaderLinkText:function(){return this.getHeader().linkText===undefined?app.cfg.HEADER_LINK_TEXT:this.getHeader().linkText},getHeaderLinkURL:function(){return this.getHeader().linkURL===undefined?app.cfg.HEADER_LINK_URL:this.getHeader().linkURL},getLogoURL:function(e){var t=this.getHeader().logoURL?this.getHeader().logoURL:app.cfg.HEADER_LOGO_URL;return t==app.cfg.HEADER_LOGO_URL&&this.getColors()&&(e?this.getColors().esriLogoMobile=="white"&&(t="resources/tpl/viewer/icons/esri-logo-white.png"):this.getColors().esriLogo=="white"&&(t="resources/tpl/viewer/icons/esri-logo-white.png")),t},getLogoTarget:function(){return!this.getHeader().logoURL||this.getHeader().logoURL==app.cfg.HEADER_LOGO_URL?app.cfg.HEADER_LOGO_TARGET:this.getHeader().logoTarget},getSocial:function(){return this.getHeader().social},getHeaderCompactSize:function(){return this.getHeader().compactSize}}}),define("storymaps/tpl/core/Data",["./WebApplicationData","storymaps/common/utils/CommonHelper"],function(e,t){return function(){var r=null,i=null,s=null,o=null,u={},a=null;this.getWebMap=function(){return r},this.setWebMap=function(e){r=e},this.getShortlistLayerId=function(){return o},this.setShortlistLayerId=function(e){o=e},this.getWebAppItem=function(){return i||{}},this.setWebAppItem=function(e){i=e},this.getResponse=function(){return s},this.setResponse=function(e){s=e},this.getWebAppData=function(){return e},this.updateAfterSave=function(){e.updateAfterSave()},this.userIsAppOwner=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&e.username==this.getWebAppItem().owner||t.getPortalUser()!=null&&t.getPortalUser()==this.getWebAppItem().owner||e&&e.privileges&&$.inArray("portal:admin:updateItems",e.privileges)>-1||this.getWebAppItem().itemControl=="admin"||this.getWebAppItem().itemControl=="update"},this.userIsOrgaPublisher=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&e.orgId&&(e.role=="org_admin"||e.role=="org_publisher")},this.checkUserItemPrivileges=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&!e.orgId&&!e.privileges||e&&e.privileges&&$.inArray("portal:user:createItem",e.privileges)>-1},this.isOrga=function(){return!app.portal||!app.portal.getPortalUser()?!1:!!app.portal.getPortalUser().orgId},this.getAppProxies=function(){return a},this.setAppProxies=function(e){a=e},this.debug=function(){},this.getStory=function(){return u},this.setStory=function(e,t,n,r){e in u||(u[e]={title:"",id:e,color:null,extent:null}),t&&(u[e].title=t),n&&(u[e].color=n),r&&(u[e].extent=r)},this.clearStory=function(){u={}},this.getStoryByIndex=function(e){return u[e]},this.getStoryLength=function(){return app.data.getShortlistLayerId()&&app.map.getLayer(app.data.getShortlistLayerId())&&app.map.getLayer(app.data.getShortlistLayerId()).graphics.length?!!app.map.getLayer(app.data.getShortlistLayerId()).graphics.length:0},this.storyReadyToScan=function(){return!app.isGalleryCreation||app.data.getWebMap().item.id}}}),define("storymaps/tpl/core/Helper",[],function(){return function(){this.isMobile=function(){var e=navigator.userAgent.match(/Android/i)?!0:!1,t=navigator.userAgent.match(/BlackBerry/i)?!0:!1,n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?!0:!1,r=navigator.userAgent.match(/IEMobile/i)?!0:!1;return e||t||n||r},this.isIE=function(){return navigator.appVersion.indexOf("MSIE")>-1||navigator.userAgent.match(/Trident.*rv\:11\./)},this.isIE8=function(){return parseInt(navigator.userAgent.toLowerCase().split("msie")[1])<9},this.prependURLHTTP=function(e){return!e||e===""||e.match(/^mailto:/)?e:/^(https?:\/\/)|^(\/\/)/i.test(e)?e:"http://"+e}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/TestPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="userInput"></div>';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/TestPanel",[],function(){}),define("lib-build/css!storymaps/tpl/ui/desktop/Common",[],function(){}),define("storymaps/tpl/ui/desktop/TestPanel",["lib-build/tpl!./TestPanel","lib-build/css!./TestPanel","lib-build/css!./Common"],function(e){return function(n,r,i){function s(){n.find(".userInput").attr("contenteditable","true")}function o(){r&&n.find(".userInput").blur(function(){i($(this).html())})}this.init=function(t){t=t||{},n.html(e({})),n.show(),r&&s(),o()},this.update=function(e){e=e||{},n.find(".userInput").html(e.data)},this.resize=function(){},this.showEntryIndex=function(){},this.destroy=function(){}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/TilePanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="paneLeft">\r\n	<ul id="myList" class="tilelist"></ul>\r\n	<div class="noFeature">\r\n		<span class="noFeatureText">\r\n			None of these places are in your current map extent.\r\n			Zoom out to see places.\r\n		</span>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/TilePanel",[],function(){}),define("storymaps/tpl/ui/desktop/TilePanel",["esri/geometry/screenUtils","../../core/Helper","lib-build/tpl!./TilePanel","lib-build/css!./TilePanel","../../core/WebApplicationData"],function(e,t,n){return function(r,i,s){var o=this,u=i,a=new t;this.tileClick=!0,$(document).bind("cbox_complete",function(){$(".details .rightDiv").height($(".details").height()-$(".detailsTitle").height()-20)}),this.init=function(){$(r).prepend(n({})),$("#mainStagePanel").width($("#contentPanel").width()-$("#paneLeft").width()),$("#mainStagePanel").css({left:$("#paneLeft").width()})},this.resize=function(e){$("#paneLeft").width(e),$(".tilelist").width(e)},this.createTab=function(e,t){$("#tabs").append('<div class="tab" tabindex="0">'+t.title+"</div>")},this.setTabClick=function(){$.each($(".entry"),function(e){$(this).click(function(){u.selected=null,u.activateLayer(e),$(".detailContainer").hide(),app.mapTips&&app.mapTips.clean()})})},this.clearTilePanel=function(){$("#myList").empty()},this.buildTilePanel=function(){o.clearTilePanel();var e,t,n,r,i,u,a=!1;if(!app.layerCurrent||!app.layerCurrent.graphics||!app.layerCurrent.graphics.length)return;app.layerCurrent.graphics[0].attributes.number&&app.layerCurrent.graphics.sort(function(e,t){return parseInt(e.attributes.number)-parseInt(t.attributes.number)}),$.each(app.layerCurrent.graphics,function(o,f){app.map.extent.contains(f.geometry)?(e="block",a=!0):app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder&&(e="none"),t=$('<li tabindex="0" id="item'+f.attributes.shortlist_id+'" style="display:'+e+'">'),n=$('<div class="tileImage"></div>'),f.attributes.thumb_url?($(n).css("background-image","url("+f.attributes.thumb_url+")"),$(n).find("i").hide()):f.attributes.pic_url?($(n).css("background-image","url("+f.attributes.pic_url+")"),$(n).find("i").hide()):$(n).append('<i class=" fa fa-camera" aria-hidden="true"></i>'),r=$('<div class="footer"></div>');var l=f.attributes.name||"Place Name";u=$('<div class="blurb">'+l+"</div>"),s.getGeneralOptions().numberedIcons&&(f.attributes.number<100?i=$('<div class="num" style="background-color:'+app.layerCurrent.color+'">'+f.attributes.number+"</div>"):(i=$('<div class="num longNum" style="background-color:'+app.layerCurrent.color+'">'+f.attributes.number+"</div>"),u=$('<div class="blurb longNumBlurb">'+f.attributes.name+"</div>")),$(r).append(i)),$(r).append(u),$(t).append(r),$(t).data("shortlist-id",f.attributes.shortlist_id),app.ui.mobileFeatureList.buildList(o,f,t),$(t).append(n),app.isInBuilder&&(f.attributes.locationSet?$(t).addClass("located"):$(t).find(".tileImage").append('<div class="unlocated" style="outline: none;"></div>')),$("#myList").append(t)}),o.setTileEvents(),$("ul.tilelist").animate({scrollTop:0},{duration:200}),!a&&app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder?$(".noFeature").css("display","block"):$(".noFeature").css("display","none"),s.getGeneralOptions().numberedIcons||$("ul.tilelist .blurb").addClass("unNumBlurb")},this.findTile=function(e){return $.grep($(r).find($("ul.tilelist li")),function(t){return t.id=="item"+e})[0]},this.findMobileTile=function(e){return $.grep($("ul.mobileTileList li"),function(t){return t.id=="item"+e})[0]},this.setTileEvents=function(){console.log("SET TILE EVENTS"),$("ul.tilelist li").mouseover(o.tile_onMouseOver),$("ul.tilelist li").mouseout(o.tile_onMouseOut),$("ul.tilelist li").click(o.tile_onClick)},this.refreshList=function(){var e,t,n=!1;app.layerCurrent&&app.layerCurrent.graphics.length&&setTimeout(function(){$.each(app.layerCurrent.graphics,function(r,i){e=o.findTile(i.attributes.shortlist_id),t=o.findMobileTile(i.attributes.shortlist_id),app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder&&(app.map.extent.contains(i.geometry)?($(e).css("display")=="none"&&$(e).stop().fadeIn(),n=!0):$(e).css("display")!="none"&&$(e).stop().fadeOut(1e3))}),!n&&app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder?$(".noFeature").css("display","block"):$(".noFeature").css("display","none")},100)},this.initSortable=function(){$("#myList").sortable({update:function(){app.addFeatureBar.updateNumber()}}),$("#myList").addClass("organize")},this.destroySortable=function(){$("#myList").sortable("destroy"),$("#myList").css("background-color","#C7C7C7"),$("body").removeClass("organizeFeatures"),$("#myList").removeClass("organize")},this.tile_onMouseOver=function(){var e=this,t=$.grep(app.layerCurrent.graphics,function(t){return t.attributes.shortlist_id==$(e).data("shortlist-id")});t[0].symbol.setWidth(app.cfg.lutIconSpecs.medium.getWidth()),t[0].symbol.setHeight(app.cfg.lutIconSpecs.medium.getHeight()),t[0].symbol.setOffset(app.cfg.lutIconSpecs.medium.getOffsetX(),app.cfg.lutIconSpecs.medium.getOffsetY()),t[0].draw(),a.isIE()||u.moveGraphicToFront(t[0]),u.buildMapHoverTips(t[0].attributes.name,t[0])},this.tile_onMouseOut=function(){if(u.selected!=null){var e=parseInt($(this).attr("id").substring(4));if(u.selected.attributes.shortlist_id==e)return}var t=this,n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")});n[0].symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),n[0].symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),n[0].symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),n[0].draw(),app.mapTips&&app.mapTips.clean(!0)},this.tile_onClick=function(e){if($("body").hasClass("organizeFeatures"))return;e.which==1||e.which==2||e.which==3?o.tileClick=!0:o.tileClick=!1;var t=$(this).data("shortlist-id");u.preSelection(),u.selected=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==t})[0],u.postSelection(),$("#mobileTitlePage").css("display","none"),u.themeSelected||app.ui.mobileFeatureList.selectTheme(0),u.themeSelected=!0}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/DetailPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="detailContainer swiper-container">\r\n	<button type="button" class=\'detailClose ion-android-close\' style=""></button>\r\n	<div class="detail-btn-container detail-btn-left">\r\n		<div class="detail-btn ion-chevron-left" style="outline: none;"></div>\r\n	</div>\r\n	<div class="detail-btn-container detail-btn-right">\r\n		<div class="detail-btn ion-chevron-right" style="outline: none;"></div>\r\n	</div>\r\n	<div class="detailView swiper-wrapper"></div>\r\n</div>\r\n';return __p}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/DetailSlide",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='swiper-slide'>\r\n	<div class='detailHeader'>\r\n		<div class=\"detailFeatureNum\" ></div>\r\n		<div class='detailFeatureTitle'></div>\r\n	</div>\r\n	<div class=\"detailTextContainer\">\r\n		<div class=\"detailPictureDiv\">\r\n			<img>\r\n		</div>\r\n		<div class='description detailFeatureDesc'></div>\r\n		<div class=\"website\"></div>\r\n	</div>\r\n</div>\r\n";return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/DetailPanel",[],function(){}),define("storymaps/tpl/ui/desktop/DetailPanel",["../../core/Helper","lib-build/tpl!./DetailPanel","lib-build/tpl!./DetailSlide","lib-build/css!./DetailPanel"],function(e,t,n){return function(i,s,o,u,a){function b(){var e=$(".entry.active").index();e<0&&(e=0),setTimeout(function(){$(".detailContainer").show(),v[e].slideNext(),v[e].slidePrev(),c.resize(),$(".detailContainer").hide()},0)}function w(){i.find(".userInput").attr("contenteditable","true")}function E(){s&&i.find(".userInput").blur(function(){o($(this).html())})}var f=u,l,c=this,h=new e,p=0,d=!1,v=[],m={},g=!1,y=a;c.loaded=!1,c.viewed=!1,this.init=function(e){e=e||{},$(i).show(),s&&w(),E()},this.buildFeatureViews=function(){var e=$(".entry.active").index();e<0&&(e=0);var n=[],r=app.map.getLayer(app.data.getShortlistLayerId());$.each(r.graphics,function(e,t){if(!n[t.attributes.tab_id]){var r={title:"tab "+(n.length+1),features:[]};n.push(r)}}),$.each(r.graphics,function(e,t){t.attributes.locationSet&&t.attributes.name&&t.attributes.pic_url&&n[t.attributes.tab_id].features.push(t)}),d||$.each(n,function(e){if(e===0)$(i).prepend(t({}));else{var n=$(i).find(" .detailContainer")[e-1];$(n).after(t({}))}var r=$(".detailView")[e];$(r).attr("id","detailView"+e),v[e]={},m[String(e)]=[]}),d=!0;if(m[String(e)].length)return;$(".detailContainer").css("z-index","0");var s=$(".detailContainer")[e];$(s).css("z-index","99"),p=0,c.buildSlides(n)},this.buildSlides=function(e){c.loaded=!1,l=e;var t=$(".entry.active").index();t<0&&(t=0);var r=l[t],s=r.features,o=app.cfg.COLOR_ORDER.split(",");for(;p<s.length;p++){var u=$(".detailContainer")[t];i.find("#detailView"+t).append(n());var a=$(u).find(".swiper-slide")[p],d=s[p].attributes,y=d.name,w=d.description,E=d.pic_url,S=h.prependURLHTTP(d.website);app.data.getWebAppData().getGeneralOptions().numberedIcons?($(a).find(".detailFeatureNum").css("background-color",app.data.getStory()[t].color),$(a).find(".detailFeatureNum").text(d.number)):($(a).find(".detailFeatureNum").hide(),$(a).find(".detailFeatureTitle").addClass("notNumbered")),y&&$(a).find(".detailFeatureTitle").html(y),E&&$(a).find("img").attr("src",E),w&&$(a).find(".description").html(w),S&&($(a).find(".website").append("<a href="+S+' target="_blank" >More info</a>'),$(".website").show()),$(a).data("shortlist-id",d.shortlist_id),$("#detailView"+t).append(a),m[String(t)].push(a);if(p%10===0&&p+1<s.length)return setTimeout(function(){p++,c.buildSlides(e)},0),!1;if(p+1==s.length){var x=new Swiper($(".detailContainer")[t],{speed:0,setWrapperSize:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0});v[t]=x,x.init(),x.update(),x.on("onSlideChangeEnd",function(e){g||f.preSelection();var t=$(".entry.active").index();t<0&&(t=0);if(c.viewed){var n=x.slides[x.activeIndex],r=$(n).data("shortlist-id"),i=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==r})[0];f.selected=i,(!app.map.extent.contains(f.selected.geometry)&&!app.data.getWebAppData().getGeneralOptions().filterByExtent||app.isInBuilder)&&app.map.centerAt(f.selected.geometry)}setTimeout(function(){f.buildMapTips()},0);if($(".showOnce").length){var s=$(".showOnce")[0];$(s).hasClass("swiper-slide-active")||($(".swiper-slide").removeClass("showOnce"),v[t].removeSlide(v[t].previousIndex),v[t].update())}v[t].slides.length==1?$(".detail-btn-container").hide():$(".detail-btn-container").show(),c.resize(),x.update(),$(".esriPopup").hide()}),i.find(".detail-btn-left").mouseover(function(){$(".detail-btn-left").css("opacity",1),$(".detail-btn-right").css("opacity",.8)}),i.find(".detail-btn-right").mouseover(function(){$(".detail-btn-right").css("opacity",1),$(".detail-btn-left").css("opacity",.8)}),i.find(".detail-btn-left").mouseout(function(){$(".detail-btn-left").css("opacity",.8)}),i.find(".detail-btn-right").mouseout(function(){$(".detail-btn-right").css("opacity",.8)}),i.find(".detailClose").click(function(){i.find(".detailContainer").hide(),app.ui.mobileIntro.screenSize=="small"&&app.ui.mobileFeatureList.showMobileList(),f.unselect()}),i.find($(".detail-btn-left")[t]).click(function(){v[t].activeIndex===0?v[t].slideTo(v[t].slides.length-1,0):v[t].slidePrev()}),i.find($(".detail-btn-right")[t]).click(function(){v[t].activeIndex==v[t].slides.length-1?v[t].slideTo(0,0):v[t].slideNext()});var T=app.data.getStory()[t].color;$("#detailView"+t).find(".detailHeader").css("border-top-color",T),i.find(".detailPictureDiv img").click(function(){v[t].activeIndex==v[t].slides.length-1?v[t].slideTo(0,0):v[t].slideNext()}),c.refreshSlides(),v[t].update(),b(),c.resize()}}c.loaded=!0,c.viewed=!1},this.showDetails=function(e){c.resize();if(e==null)return;var t=$(".entry.active").index();t<0&&(t=0);var n=$(".detailContainer")[t];$(n).show(),$("#mobilePaneList").css("visibility","hidden");var r;$.each($("#detailView"+t).find($(".swiper-slide")),function(t,n){parseInt($(n).data("shortlist-id"))==e.attributes.shortlist_id&&(r=t)}),y.getGeneralOptions().numberedIcons||$(".detailFeatureTitle").addClass("notNumbered"),r>-1&&setTimeout(function(){v[t].slideTo(r,0),$(n).css("z-index",99)},0),v[t].slides.length==1?$(".detail-btn-container").hide():$(".detail-btn-container").show(),v[t].update();if($(".swiper-slide-active img").width()===0){var i=$(".swiper-slide-active img")[0],s=$(i).attr("data-src");$(i).attr("src",s)}c.viewed=!0},this.refreshSlides=function(){g=!0;if(!app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder)return;var e=$(".entry.active").index();e<0&&(e=0),$(".detailContainer").css("z-index","0");var t=$(".detailContainer")[e];$(t).css("z-index","99");if(!l)return;var n=l[e],r=n.features,i=null;v[e].removeAllSlides(),$.each(r,function(t,n){app.map.extent.contains(n.geometry)&&$.each(m[String(e)],function(t,r){parseInt($(r).data("shortlist-id"))==n.attributes.shortlist_id&&(v[e].appendSlide($(r)[0]),f.selected&&parseInt($(r).data("shortlist-id"))==f.selected.attributes.shortlist_id&&(i=parseInt(t)))}),f.selected&&!app.map.extent.contains(f.selected.geometry)&&$.each(m[String(e)],function(t,n){parseInt($(n).data("shortlist-id"))==f.selected.attributes.shortlist_id&&(v[e].appendSlide($(n)[0]),$(n).addClass("showOnce"))})}),f.selected&&$.each($("#detailView"+e).find($(".swiper-slide")),function(e,t){parseInt($(t).data("shortlist-id"))==f.selected.attributes.shortlist_id&&(i=parseInt(e))}),v[e].update(),i!=null&&v[e].slideTo(i,0),v[e].slides.length==1?$(".detail-btn-container").hide():$(".detail-btn-container").show(),g=!1},this.update=function(e){e=e||{},i.find(".detailContainer").html(e.data)},this.resize=function(){setTimeout(function(){var e=40;app.ui.mobileIntro.screenSize=="small"&&($("#paneLeft").css("height",$("#contentPanel").height()-$("#map").height()+10),$("#paneLeft").css("width","100%"),$("#paneLeft").css({top:$("#map").height()-10}),e=20);var t=$(".entry.active").index(),n;t<0&&(t=0);if(!$.isEmptyObject(v[t])){var r=v[t];n=r.slides[r.activeIndex]}$(n).height($("#paneLeft").outerHeight()-5);var i=$(n).find(".detailHeader").outerHeight();$(".detailTextContainer").height($("#paneLeft").outerHeight()-i-e+"px"),$(".detailPictureDiv img").css("max-width",$("#paneLeft").outerWidth());var s=$("#paneLeft").outerHeight()-i-60<$("#paneLeft").outerHeight()*.6?$("#paneLeft").outerHeight()-i-60:$("#paneLeft").outerHeight()*.6;$(".detailPictureDiv img").css("max-height",parseInt(s)+"px"),$(".detailContainer").width($("#paneLeft").outerWidth()),$(".detailContainer").height($("#paneLeft").outerHeight())},0)},this.showEntryIndex=function(){},this.destroy=function(){}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBar",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="nav-bar">\r\n	<div class="entries">\r\n		<ul class="nav nav-tabs">\r\n			<!--\r\n				tabs and the more button are injected here\r\n			-->\r\n		</ul>\r\n	</div>\r\n	<div class="builder-content-panel inline">\r\n		<span class="builder-content-panel-group builder-edit btn btn-sm btn-default">\r\n			<div class="builder-btn"></div>\r\n			<div class="builder-lbl"></div>\r\n		</span>\r\n\r\n		<span class="builder-content-panel-group builder-add btn btn-sm btn-default">\r\n			<div class="builder-btn"></div>\r\n			<div class="builder-lbl"></div>\r\n		</span>\r\n		<span class="builder-content-panel-group builder-organize btn btn-sm btn-default">\r\n			<div class="builder-btn"></div>\r\n			<div class="builder-lbl"></div>\r\n		</span>\r\n	</div>\r\n	<div class="builder-mask"></div>\r\n	<div id="bookmarksCon">\r\n		<div id="bookmarksButton"></div>\r\n		<div id="bookmarksToggle"> <!--tabindex="0"-->\r\n			<span id="bookmarksTogText"></span>\r\n		</div>\r\n		<div id="bookmarksDiv"></div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/NavBar",[],function(){}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntry",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="entry '+((__t=optHtmlClass)==null?"":__t)+'" data-title="'+((__t=tooltip)==null?"":__t)+'">\r\n	<a class="entryLbl" tabindex="0">'+((__t=value)==null?"":__t)+"</a>\r\n</li>\r\n";return __p}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntryMore",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="dropdown pull-right"> <!-- tabindex="0" -->\r\n	<a class="dropdown-toggle" data-toggle="dropdown">\r\n		<span class="glyphicon glyphicon-th-list"></span> <span class="caret"></span>\r\n	</a>\r\n	<ul class="dropdown-menu">\r\n		<!--\r\n			tabs are injected here a second time\r\n			that way they are just toggled and not moved around\r\n		-->\r\n		'+((__t=entries)==null?"":__t)+"\r\n	</ul>\r\n</li>\r\n";return __p}}),define("storymaps/tpl/ui/desktop/NavBar",["lib-build/tpl!./NavBar","lib-build/css!./NavBar","lib-build/tpl!./NavBarEntry","lib-build/tpl!./NavBarEntryMore","storymaps/common/utils/CommonHelper","esri/graphicsUtils","esri/layers/GraphicsLayer","esri/geometry/webMercatorUtils","esri/geometry/Extent","dojo/topic","dojo/has"],function(e,t,n,r,i,s,o,u,a,f,l){return function(s,o,u,a){function v(e,t){c=c||[],m(e),$(".nav-bar").addClass("isTab");var i=c.length,o="";$.each(c,function(e,t){var r=t.title;o+=n({value:r,tooltip:"",optHtmlClass:""})}),s.find(".nav-tabs").html(o+r({entries:o})),s.find(".entry").click(g),s.find(".entryLbl").on("keydown",function(e){if(e.keyCode===9)return f.publish("story-tab-navigation",{from:"nav",direction:e.shiftKey?"backward":"forward"}),!1}),s.find(".entryLbl").eq(0).focus(function(){!$(this).data("mouseDown")&&!$(this).parent(".entry").hasClass("active")&&$(this).parent(".entry").click()}).mousedown(function(){$(this).data("mouseDown",!0)}).mouseup(function(){$(this).removeData("mouseDown")}),$("#nav-bar").show(),app.isInBuilder&&app.addFeatureBar.updateLocatedFeatures(t),l.resize()}function m(e){s.css("background-color",e.header),i.addCSSRule(".nav-bar .nav > .entry .entryLbl, 					.nav-bar .dropdown-toggle { 						color: "+e.tabText+"; 						background-color: "+e.tab+" !important; 					}","NavBarTab"),i.addCSSRule(".nav-bar .entry.active > .entryLbl, 					.nav-bar .dropdown.active .dropdown-toggle { 						color: "+e.tabTextActive+"; 						background-color: "+e.tabActive+" !important; 					}","NavBarActive"),i.addCSSRule(".nav-bar .dropdown:not(.active):hover .dropdown-toggle, 					.nav-bar li:not(.active) .entryLbl:hover { 						color: "+e.tabTextHover+"; 						background-color: "+e.tabHover+" !important; 					}","NavBarHover"),i.addCSSRule(".nav-bar .dropdown-menu, 					.nav-bar .dropdown-menu .entryLbl { 						color: "+e.tabText+" !important; 						background-color: "+e.header+" !important; 					}","NavBarMore")}function g(){if($("body").hasClass("organizeFeatures"))return;var e=$(this).index();u(e),app.isInBuilder&&(app.addFeatureBar.updateLocatedFeatures(),app.addFeatureBar.exitOrganizeMode())}function y(){s.find(".builder-content-panel").css("display","inline-block"),s.find(".builder-edit").off("click").click(b).find(".builder-lbl").html("Edit Tab"),s.find(".builder-add").off("click").click(l.onClickAdd).find(".builder-lbl").html("Add tab")}function b(){if($("body").hasClass("organizeFeatures"))return;app.builder.openEditPopup({entryIndex:l.getEntryIndex()})}function w(e,t,n){return e.hasOwnProperty(t)&&e[t]===n}function E(){}var l=this,c=null,h=null,p=a,d=null;s.html(e({})),this.init=function(e,t,n,r){c=e,h=null,d=r,v(n,t),this.showEntryIndex(t),c.length==1&&app.ui.navBar.disableOrganize(),E(),o&&y()},this.update=function(e){v(e),this.showEntryIndex(h)},this.resize=function(){s.find(".nav-tabs > li").addClass("visible"),s.find(".nav-tabs .dropdown").removeClass("visible"),s.find(".nav-tabs .dropdown-menu li").removeClass("visible");var e=0,t=0,n=!1,r=s.find(".nav-tabs > li:not(.dropdown)"),i=s.find("li.dropdown").outerWidth(),o=s.width()-s.find(".builder-content-panel:visible").outerWidth()-30-4;r.each(function(){t++,e+=$(this).outerWidth();if(e>o||e+i>o&&t<r.length)n=!0,$(this).removeClass("visible"),s.find(".nav-tabs .dropdown-menu li").eq($(this).index()).addClass("visible")});var u=s.find(".nav-tabs > .entry.active"),a=s.find(".nav-tabs .dropdown-menu li.active");u.length&&!u.hasClass("visible")?(u.removeClass("active"),s.find(".nav-tabs .dropdown-menu li").eq(u.index()).addClass("active"),s.find(".nav-tabs > .dropdown").addClass("active")):a.length&&!a.hasClass("visible")&&(a.removeClass("active"),s.find(".nav-tabs > .entry").eq(a.index()).addClass("active"),s.find(".nav-tabs > .dropdown").removeClass("active")),n&&s.find(".nav-tabs .dropdown").addClass("visible")},this.showEntryIndex=function(e){var t=s.find(".nav-tabs > .entry.visible").length;s.find("li").removeClass("active"),e<t?(s.find(".entry").eq(e).addClass("active"),app.isLoading||(s.find(".entry").eq(e).find(".entryLbl").focus(),s.find(".dropdown").hasClass("open")&&s.find(".dropdown-toggle").click())):(s.find(".dropdown").addClass("active"),s.find(".dropdown .entry").eq(e).addClass("active"),app.isLoading||(s.find(".dropdown").hasClass("open")||s.find(".dropdown-toggle").click(),s.find(".dropdown .entry").eq(e).focus())),app.isInBuilder&&setTimeout(function(){l.resize()},50),h=e},this.getEntryIndex=function(){return h},this.destroy=function(){s.hide()},this.bookmarksLoaded=!1,this.initBookmarks=function(){var e=app.data.getResponse()?app.data.getResponse().itemInfo.itemData.bookmarks:app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.itemData.bookmarks;e.length&&app.data.getWebAppData().getGeneralOptions().bookmarks&&($("#bookmarksCon").show(),$("#bookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;"),$("#mobileBookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;"),$("#bookmarksToggle").addClass("closed"),$("#mobileBookmarksToggle").addClass("closed"),$("#bookmarksToggle").click(function(){$("#bookmarksDiv").css("display")=="none"?($("#bookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25B2;"),$("#bookmarksDiv").css("display","inline-block"),$("#bookmarksToggle").removeClass("closed"),$("#bookmarksToggle").addClass("open")):($("#bookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;"),$("#bookmarksDiv").css("display","none"),$("#bookmarksToggle").removeClass("open"),$("#bookmarksToggle").addClass("closed")),$("#mobileBookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;")}),$("#mobileBookmarksToggle").click(function(){$("#mobileBookmarksDiv").css("display")=="none"?($("#mobileBookmarksDiv").css("display","inline-block"),$("#mobileBookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25B2;"),$("#mobileBookmarksToggle").removeClass("closed"),$("#mobileBookmarksToggle").addClass("open")):($("#mobileBookmarksDiv").css("display","none"),$("#mobileBookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;"),$("#mobileBookmarksToggle").removeClass("open"),$("#mobileBookmarksToggle").addClass("closed"))}),$.each(e,function(e,t){$("#bookmarksDiv").append("<p><a tabindex='0'>"+t.name+"</a></p>"),$("#mobileBookmarksDiv").append("<p><a>"+t.name+"</a></p>")}),$("#bookmarksDiv a").click(function(){var t=$(this).html(),n=new esri.geometry.Extent($.grep(e,function(e){return e.name==t})[0].extent);app.map.setExtent(n),$("#bookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;"),$("#bookmarksDiv").css("display","none"),$("#bookmarksToggle").removeClass("open"),$("#bookmarksToggle").addClass("closed")}),$("#mobileBookmarksDiv a").click(function(){var t=$(this).html(),n=new esri.geometry.Extent($.grep(e,function(e){return e.name==t})[0].extent);app.map.setExtent(n),$("#mobileBookmarksTogText").html(app.data.getWebAppData().getGeneralOptions().bookmarksAlias+" &#x25BC;"),$("#mobileBookmarksToggle").removeClass("open"),$("#mobileBookmarksToggle").addClass("closed"),$("#mobileBookmarksDiv").css("display","none")})),l.bookmarksLoaded=!0},this.hideBookmarks=function(){$("#bookmarksCon").hide()},this.showBookmarks=function(){$("#bookmarksCon").show()},this.updateBookmarksAlias=function(e){$("#bookmarksTogText").html(e+" &#x25BC;"),$("#mobileBookmarksTogText").html(e+" &#x25BC;")},this.disableOrganize=function(){s.find(".builder-organize").attr("disabled",!0),s.find(".builder-organize").addClass("disabled"),$.each(s.find(".builder-organize").children(),function(e,t){$(t).addClass("disabled")})},this.enableOrganize=function(){s.find(".builder-organize").attr("disabled",!1),s.find(".builder-organize").removeClass("disabled"),$.each(s.find(".builder-organize").children(),function(e,t){$(t).removeClass("disabled")})},this.onClickAdd=function(e,t){if($("body").hasClass("organizeFeatures"))return;app.detailPanelBuilder.hideSearch();var n=s.find(".nav-tabs .entry.visible").length,r=app.data.getWebAppData().getGeneralOptions().extentMode=="customHome"?app.data.getWebAppData().getMapExtent():null,i={id:n,title:t?t:"Tab "+(n+1),features:[],extent:r};w(c,"id",n)||(c[n]=i);var o=app.cfg.COLOR_ORDER.split(","),a=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==o[n]});i.color=a,$("#paneLeft").css("border-top-color",a[0].color),app.ui.tilePanel.clearTilePanel();var h={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:a[0].color,tabTextHover:"#fff",tabHover:"#666"};app.isGalleryCreation&&app.data.getStory()[0].title&&(c[0].title=app.data.getStory()[0].title),l.init(c,s.find(".nav-tabs .entry.visible").length,h,d);var p=app.map.getLayer(app.data.getShortlistLayerId());$.each(p.graphics,function(e,t){t.hide()});var v=new esri.layers.GraphicsLayer,m=a[0].color;v.color=m,app.layerCurrent=v,app.detailPanelBuilder.addDetailPanelSwiper(n),app.addFeatureBar.exitOrganizeMode(),app.data.setStory(n,i.title,m,r),u(n),l.enableOrganize(),d.getTitle()&&f.publish("BUILDER_INCREMENT_COUNTER")}}}),define("storymaps/tpl/ui/desktop/MultiTips",["dojo/dom-style","dojo/dom-construct","dojo/_base/lang","dojo/on","dojo/_base/array","dojo/query","dojo/dom","dojo/has"],function(e,t,n,r,i,s,o,u){return function(f){function p(e){l=n.mixin({pointArray:[],map:null,attributeLabelField:"",content:"",selected:!1,zoomToPoints:!1,backgroundColor:"#000000",borderColor:"#000000",pointerColor:"#000000",textColor:"#ffffff",minWidth:"",labelDirection:"auto",offsetTop:8,offsetSide:3,offsetBottom:8,mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0},e),e.mapAuthorizedWidth==-1&&(l.mapAuthorizedWidth=l.map.width),e.mapAuthorizedHeight==-1&&(l.mapAuthorizedHeight=l.map.height),d(e.map.container)}function d(n,o){v();var u=r(l.map,"zoom-start",function(){y()}),a=r(l.map,"zoom-end",function(e){c||m(e.extent,!0)}),f=r(l.map,"pan",function(e){if(!e||!e.delta.x&&!e.delta.y)return;c||g(e.extent,e.delta)}),p=r(l.map,"extent-change",function(e){if(e&&e.delta&&e.delta.x===0&&e.delta.y===0)return;c||m(e.extent,!0)});o&&(l.visible=!0),l.selected&&(l.pointArray.push(l.selected),l.pointArray.reverse(),l.selected.geometry.x==l.pointArray[1].geometry.x&&l.selected.geometry.y==l.pointArray[1].geometry.y&&l.pointArray.splice(1,1)),i.forEach(l.pointArray,function(r,i){t.place("<div id='arrow"+i+"' class='mtArrow'></div><div id='multiTip"+i+"' class='multiTip'></div>",n,"last"),s("#multiTip"+i)[0].innerHTML=i===0&&l.selected?l.selected.attributes.name:l.content;var o=$("#multiTip"+i),u=$("#arrow"+i);i===0&&l.selected?$(o).addClass("selected"):null,i===0&&l.selected?$(u).addClass("selected"):null,e.set("multiTip"+i,{backgroundColor:i===0&&l.selected?app.cfg.SELECTED_POPUP_BACKGROUND_COLOR:l.backgroundColor,borderColor:i===0&&l.selected?app.cfg.SELECTED_POPUP_BORDER_COLOR:l.borderColor,color:l.textColor,padding:"5px",position:"absolute"}),l.minWidth&&e.set("multiTip"+i,"minWidth",l.minWidth+"px"),e.set("arrow"+i,{pointerColor:i===0&&l.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:l.pointerColor,position:"absolute",width:"0px",height:"0px"});if(l.map.extent.contains(r.geometry)){var a=l.map.toScreen(r.geometry);E(a,i,l)}}),h=[u,a,f,p]}function v(e){c=!1,i.forEach(h,function(e){e.remove()}),e?(s(".multiTip").forEach(function(e){$(e).remove()}),s(".mtArrow").forEach(function(e){$(e).remove()}),c=!0):(s(".multiTip").forEach(function(e){$(e).hasClass("selected")||$(e).remove()}),s(".mtArrow").forEach(function(e){$(e).hasClass("selected")||$(e).remove()}))}function m(e,t){i.forEach(l.pointArray,function(n,r){e.contains(n.geometry)&&(w(r)||t)?E(l.map.toScreen(n.geometry),r,l):b(r)})}function g(e,t){i.forEach(l.pointArray,function(n,r){if(e.contains(n.geometry)){var i=l.map.toScreen(n.geometry);i.x+=t.x,i.y+=t.y,E(i,r,l)}else b(r)})}function y(){s(".multiTip, .mtArrow").forEach(function(e){$(e).hasClass("selected")||(e.style.display="none")})}function b(t){if(!o.byId("multiTip"+t))return;if(e.get(o.byId("multiTip"+t),"display")=="none")return;e.set(o.byId("multiTip"+t),"display","none"),e.set(o.byId("arrow"+t),"display","none")}function w(t){if(o.byId("multiTip"+t))return e.get(o.byId("multiTip"+t),"display")=="block"}function E(t,n,r){if(!o.byId("multiTip"+n))return;if(t.x>r.mapAuthorizedWidth||t.y>r.mapAuthorizedHeight){b(n);return}var i=n===0&&r.selected?44:r.offsetTop;if(u("ie")>0||/Trident\/7\./.test(navigator.userAgent))i+=10;var s=e.get("multiTip"+n,"width"),a=e.get("multiTip"+n,"height");u("ie")==8&&(s-=7,a-=14);if(!s||!a)e.set(o.byId("multiTip"+n),"display",r.visible?"block":"none"),e.set(o.byId("arrow"+n),"display",r.visible?"block":"none"),s=e.get("multiTip"+n,"width"),a=e.get("multiTip"+n,"height");r.minWidth&&s<r.minWidth&&(s=r.minWidth);if(r.labelDirection!="auto")r.labelDirection=="left"?N(t,n,r,s,a):r.labelDirection=="right"?T(t,n,r,s,a):r.labelDirection=="down"?S(t,n,r,s,a):x(t,n,r,s,a,i);else if(t.x<s/2+25+r.offsetSide+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]+a){if(t.y<a-15||t.x<35+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]){b(n);return}T(t,n,r,s,a)}else if(t.x<s/2+25+r.offsetSide){if(t.y<a-15||t.y>r.mapAuthorizedHeight-a/2-10){b(n);return}T(t,n,r,s,a)}else if(t.x>r.mapAuthorizedWidth-s/2-10){if(t.y<a-15||t.y>r.mapAuthorizedHeight-a/2-10){b(n);return}N(t,n,r,s,a)}else if(t.x<r.mapAuthorizedMinWidth+s/2){if(t.y<a-15||t.y>r.mapAuthorizedHeight-a/2-10||t.x<r.mapAuthorizedMinWidth){b(n);return}T(t,n,r,s,a)}else t.y>a+25+i?x(t,n,r,s,a,i):S(t,n,r,s,a);e.set(o.byId("multiTip"+n),"display",r.visible?"block":"none"),e.set(o.byId("arrow"+n),"display",r.visible?"block":"none")}function S(t,n,r,i){e.set("multiTip"+n,{top:t.y+3+r.offsetBottom+"px",left:t.x-i/2-5+"px"}),e.set("arrow"+n,{left:t.x-10+"px",top:t.y+r.offsetBottom-5+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"10px solid",borderBottomColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderTop:"none"})}function x(t,n,r,i,s,o){e.set("multiTip"+n,{top:t.y-s-10-o+"px",left:t.x-i/2+0+"px"});if(u("ie")>0||/Trident\/7\./.test(navigator.userAgent))o-=10;e.set("arrow"+n,{left:t.x-10+"px",top:t.y-10-o+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:"10px solid",borderTopColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderBottom:"none"})}function T(t,n,r,i,s){var o=n===0&&r.selected?5:0;e.set("multiTip"+n,{top:t.y-22-o-(s-10)/2+"px",left:t.x+17+r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x+8+r.offsetSide+"px",top:t.y-26-o+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderRight:"10px solid",borderRightColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderLeft:"none"})}function N(t,n,r,i,s){var o=n===0&&r.selected?5:0;e.set("multiTip"+n,{top:t.y-22-o-(s-10)/2+"px",left:t.x-18-i-r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x-18-r.offsetSide+"px",top:t.y-26-o+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"10px solid",borderLeftColor:n===0&&r.selected?app.cfg.SELECTED_POPUP_ARROW_COLOR:r.pointerColor,borderRight:"none"})}var l=null,c=!1,h=[];p(f),this.current=function(){return l.pointArray},this.clean=function(e){l=null,v(e)},this.hide=function(){c=!0,y()},this.show=function(){if(!l)return;c=!1,l.visible=!0,m(l.map.extent,!0)}}}),define("lib-build/tpl!storymaps/tpl/ui/mobile/MobileIntro",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="mobileIntro"></div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/ui/mobile/MobileIntro",[],function(){}),define("storymaps/tpl/ui/mobile/MobileIntro",["lib-build/tpl!./MobileIntro","lib-build/css!./MobileIntro","dojo/on"],function(e){return function(n,r,i,s){function a(){app.map.on("click",function(){$("#mobileIntro").css("display","none")})}var o=s,u=this;this.screenSize="desktop",this.init=function(){$(n).prepend(e({}))},this.hide=function(){$("#mobileIntro").hide()},this.setTitle=function(){var e=app.data.getWebAppData().getTitle(),t=app.data.getWebAppData().getSubtitle();$("#mobileIntro").append('<div class="mobileTitle">'+e+"</div>"),$("#mobileIntro").append('<div class="mobileSnippet"></div>'),t&&$(".mobileSnippet").html(t),a()},this.fillList=function(e,t,n){e===0&&$("#mobileIntro").append('<ul id="mobileThemeList" style=" height: 80px; line-height: 80px;" class="mobileTileList introList">');var r=$('<li class="mobileTitleThemes">').append('<span style="width: 100%;margin-left: 30px; margin-right: 30px; vertical-align: middle; line-height: 20px; display: inline-block;">'+t.title+"</span>");r.on("click",function(){u.selectMobileTheme(e)}),e===0&&$(r).css("border-width","2px 0px 1px 0px"),e==n.length-1&&$(r).css("border-width","1px 0px 2px 0px"),$("#mobileThemeList").append(r)},this.resizeMobileElements=function(){u.screenSize=="desktop"&&!o.selected&&app.ui.mobileFeatureList.showMobileList();var e=$(window).height()*.48-20;$("#map").css("height",e),$("#map").css({top:0}),$("#mainStagePanel").css({left:0}),$("#mainStagePanel").css("width","100%"),$("#map").css("width","100%"),$("#mainStagePanel").height($("#map").height()),$("#paneLeft").css("height","52%").css("height","+=20px"),$("#paneLeft").css("top","52%").css("top","-=20px"),$("#mobileThemeBar").css("top","48%").css("top",$("#mobileThemeBar").position().top-20+"px");var t=$(".mobileThemeTitle").length;$("#mobileThemeBarSlider").width($(window).width()*t),$("#returnHiddenBar").css("width","100%").css("width","-=80px"),$("#mobilePaneList").css("height","52%").css("height","-=20px"),$(".mobileTileList.blurb").css("width","100%").css("width","-=125px"),u.screenSize="small",setTimeout(function(){},0)},this.selectMobileTheme=function(e){e!==0&&o.activateLayer(e),$("#contentPanel").css("display","block"),$("#mobileIntro").css("display","none"),$(window).resize(),app.ui.mobileFeatureList.selectTheme(e),o.themeSelected=!0}}}),define("lib-build/css!storymaps/tpl/ui/mobile/MobileFeatureList",[],function(){}),define("lib-build/css!lib-app/Swiper/swiper.min",[],function(){}),function(){"use strict";function o(e){e.fn.swiper=function(n){var r;return e(this).each(function(){var e=new t(this,n);r||(r=e)}),r}}var e,t=function(r,i){function d(e){return Math.floor(e)}function v(){h.autoplayTimeoutId=setTimeout(function(){h.params.loop?(h.fixLoop(),h._slideNext(),h.emit("onAutoplay",h)):h.isEnd?i.autoplayStopOnLast?h.stopAutoplay():(h._slideTo(0),h.emit("onAutoplay",h)):(h._slideNext(),h.emit("onAutoplay",h))},h.params.autoplay)}function g(t,n){var r=e(t.target);if(!r.is(n))if(typeof n=="string")r=r.parents(n);else if(n.nodeType){var i;return r.parents().each(function(e,t){t===n&&(i=n)}),i?n:undefined}return r.length===0?undefined:r[0]}function D(e,t){t=t||{};var n=window.MutationObserver||window.WebkitMutationObserver,r=new n(function(e){e.forEach(function(e){h.onResize(!0),h.emit("onObserverUpdate",h,e)})});r.observe(e,{attributes:typeof t.attributes=="undefined"?!0:t.attributes,childList:typeof t.childList=="undefined"?!0:t.childList,characterData:typeof t.characterData=="undefined"?!0:t.characterData}),h.observers.push(r)}function P(e){e.originalEvent&&(e=e.originalEvent);var t=e.keyCode||e.charCode;if(!h.params.allowSwipeToNext&&(h.isHorizontal()&&t===39||!h.isHorizontal()&&t===40))return!1;if(!h.params.allowSwipeToPrev&&(h.isHorizontal()&&t===37||!h.isHorizontal()&&t===38))return!1;if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)return;if(document.activeElement&&document.activeElement.nodeName&&(document.activeElement.nodeName.toLowerCase()==="input"||document.activeElement.nodeName.toLowerCase()==="textarea"))return;if(t===37||t===39||t===38||t===40){var n=!1;if(h.container.parents(".swiper-slide").length>0&&h.container.parents(".swiper-slide-active").length===0)return;var r={left:window.pageXOffset,top:window.pageYOffset},i=window.innerWidth,s=window.innerHeight,o=h.container.offset();h.rtl&&(o.left=o.left-h.container[0].scrollLeft);var u=[[o.left,o.top],[o.left+h.width,o.top],[o.left,o.top+h.height],[o.left+h.width,o.top+h.height]];for(var a=0;a<u.length;a++){var f=u[a];f[0]>=r.left&&f[0]<=r.left+i&&f[1]>=r.top&&f[1]<=r.top+s&&(n=!0)}if(!n)return}if(h.isHorizontal()){if(t===37||t===39)e.preventDefault?e.preventDefault():e.returnValue=!1;(t===39&&!h.rtl||t===37&&h.rtl)&&h.slideNext(),(t===37&&!h.rtl||t===39&&h.rtl)&&h.slidePrev()}else{if(t===38||t===40)e.preventDefault?e.preventDefault():e.returnValue=!1;t===40&&h.slideNext(),t===38&&h.slidePrev()}}function B(e){e.originalEvent&&(e=e.originalEvent);var t=h.mousewheel.event,n=0,r=h.rtl?-1:1;if(t==="mousewheel")if(h.params.mousewheelForceToAxis)if(h.isHorizontal()){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;n=e.wheelDeltaX*r}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;n=e.wheelDeltaY}else n=Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)?-e.wheelDeltaX*r:-e.wheelDeltaY;else if(t==="DOMMouseScroll")n=-e.detail;else if(t==="wheel")if(h.params.mousewheelForceToAxis)if(h.isHorizontal()){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;n=-e.deltaX*r}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;n=-e.deltaY}else n=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX*r:-e.deltaY;if(n===0)return;h.params.mousewheelInvert&&(n=-n);if(!h.params.freeMode){if((new window.Date).getTime()-h.mousewheel.lastScrollTime>60)if(n<0){if((!h.isEnd||h.params.loop)&&!h.animating)h.slideNext();else if(h.params.mousewheelReleaseOnEdges)return!0}else if((!h.isBeginning||h.params.loop)&&!h.animating)h.slidePrev();else if(h.params.mousewheelReleaseOnEdges)return!0;h.mousewheel.lastScrollTime=(new window.Date).getTime()}else{var i=h.getWrapperTranslate()+n*h.params.mousewheelSensitivity,s=h.isBeginning,o=h.isEnd;i>=h.minTranslate()&&(i=h.minTranslate()),i<=h.maxTranslate()&&(i=h.maxTranslate()),h.setWrapperTransition(0),h.setWrapperTranslate(i),h.updateProgress(),h.updateActiveIndex(),(!s&&h.isBeginning||!o&&h.isEnd)&&h.updateClasses(),h.params.freeModeSticky?(clearTimeout(h.mousewheel.timeout),h.mousewheel.timeout=setTimeout(function(){h.slideReset()},300)):h.params.lazyLoading&&h.lazy&&h.lazy.load();if(i===0||i===h.maxTranslate())return}return h.params.autoplay&&h.stopAutoplay(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function j(t,n){t=e(t);var r,i,s,o=h.rtl?-1:1;r=t.attr("data-swiper-parallax")||"0",i=t.attr("data-swiper-parallax-x"),s=t.attr("data-swiper-parallax-y"),i||s?(i=i||"0",s=s||"0"):h.isHorizontal()?(i=r,s="0"):(s=r,i="0"),i.indexOf("%")>=0?i=parseInt(i,10)*n*o+"%":i=i*n*o+"px",s.indexOf("%")>=0?s=parseInt(s,10)*n+"%":s=s*n+"px",t.transform("translate3d("+i+", "+s+",0px)")}function q(e){return e.indexOf("on")!==0&&(e[0]!==e[0].toUpperCase()?e="on"+e[0].toUpperCase()+e.substring(1):e="on"+e),e}if(this instanceof t){var s={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,hashnav:!1,breakpoints:undefined,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,uniqueNavElements:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:undefined,controlInverse:!1,controlBy:"slide",allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},o=i&&i.virtualTranslate;i=i||{};var u={};for(var a in i)if(typeof i[a]=="object"&&i[a]!==null&&!(i[a].nodeType||i[a]===window||i[a]===document||typeof n!="undefined"&&i[a]instanceof n||typeof jQuery!="undefined"&&i[a]instanceof jQuery)){u[a]={};for(var f in i[a])u[a][f]=i[a][f]}else u[a]=i[a];for(var l in s)if(typeof i[l]=="undefined")i[l]=s[l];else if(typeof i[l]=="object")for(var c in s[l])typeof i[l][c]=="undefined"&&(i[l][c]=s[l][c]);var h=this;h.params=i,h.originalParams=u,h.classNames=[],typeof e!="undefined"&&typeof n!="undefined"&&(e=n);if(typeof e=="undefined"){typeof n=="undefined"?e=window.Dom7||window.Zepto||window.jQuery:e=n;if(!e)return}h.$=e,h.currentBreakpoint=undefined,h.getActiveBreakpoint=function(){if(!h.params.breakpoints)return!1;var e=!1,t=[],n;for(n in h.params.breakpoints)h.params.breakpoints.hasOwnProperty(n)&&t.push(n);t.sort(function(e,t){return parseInt(e,10)>parseInt(t,10)});for(var r=0;r<t.length;r++)n=t[r],n>=window.innerWidth&&!e&&(e=n);return e||"max"},h.setBreakpoint=function(){var e=h.getActiveBreakpoint();if(e&&h.currentBreakpoint!==e){var t=e in h.params.breakpoints?h.params.breakpoints[e]:h.originalParams,n=h.params.loop&&t.slidesPerView!==h.params.slidesPerView;for(var r in t)h.params[r]=t[r];h.currentBreakpoint=e,n&&h.destroyLoop&&h.reLoop(!0)}},h.params.breakpoints&&h.setBreakpoint(),h.container=e(r);if(h.container.length===0)return;if(h.container.length>1){var p=[];return h.container.each(function(){var e=this;p.push(new t(this,i))}),p}h.container[0].swiper=h,h.container.data("swiper",h),h.classNames.push("swiper-container-"+h.params.direction),h.params.freeMode&&h.classNames.push("swiper-container-free-mode"),h.support.flexbox||(h.classNames.push("swiper-container-no-flexbox"),h.params.slidesPerColumn=1),h.params.autoHeight&&h.classNames.push("swiper-container-autoheight");if(h.params.parallax||h.params.watchSlidesVisibility)h.params.watchSlidesProgress=!0;["cube","coverflow","flip"].indexOf(h.params.effect)>=0&&(h.support.transforms3d?(h.params.watchSlidesProgress=!0,h.classNames.push("swiper-container-3d")):h.params.effect="slide"),h.params.effect!=="slide"&&h.classNames.push("swiper-container-"+h.params.effect),h.params.effect==="cube"&&(h.params.resistanceRatio=0,h.params.slidesPerView=1,h.params.slidesPerColumn=1,h.params.slidesPerGroup=1,h.params.centeredSlides=!1,h.params.spaceBetween=0,h.params.virtualTranslate=!0,h.params.setWrapperSize=!1);if(h.params.effect==="fade"||h.params.effect==="flip")h.params.slidesPerView=1,h.params.slidesPerColumn=1,h.params.slidesPerGroup=1,h.params.watchSlidesProgress=!0,h.params.spaceBetween=0,h.params.setWrapperSize=!1,typeof o=="undefined"&&(h.params.virtualTranslate=!0);h.params.grabCursor&&h.support.touch&&(h.params.grabCursor=!1),h.wrapper=h.container.children("."+h.params.wrapperClass),h.params.pagination&&(h.paginationContainer=e(h.params.pagination),h.params.uniqueNavElements&&typeof h.params.pagination=="string"&&h.paginationContainer.length>1&&h.container.find(h.params.pagination).length===1&&(h.paginationContainer=h.container.find(h.params.pagination)),h.params.paginationType==="bullets"&&h.params.paginationClickable?h.paginationContainer.addClass("swiper-pagination-clickable"):h.params.paginationClickable=!1,h.paginationContainer.addClass("swiper-pagination-"+h.params.paginationType));if(h.params.nextButton||h.params.prevButton)h.params.nextButton&&(h.nextButton=e(h.params.nextButton),h.params.uniqueNavElements&&typeof h.params.nextButton=="string"&&h.nextButton.length>1&&h.container.find(h.params.nextButton).length===1&&(h.nextButton=h.container.find(h.params.nextButton))),h.params.prevButton&&(h.prevButton=e(h.params.prevButton),h.params.uniqueNavElements&&typeof h.params.prevButton=="string"&&h.prevButton.length>1&&h.container.find(h.params.prevButton).length===1&&(h.prevButton=h.container.find(h.params.prevButton)));h.isHorizontal=function(){return h.params.direction==="horizontal"},h.rtl=h.isHorizontal()&&(h.container[0].dir.toLowerCase()==="rtl"||h.container.css("direction")==="rtl"),h.rtl&&h.classNames.push("swiper-container-rtl"),h.rtl&&(h.wrongRTL=h.wrapper.css("display")==="-webkit-box"),h.params.slidesPerColumn>1&&h.classNames.push("swiper-container-multirow"),h.device.android&&h.classNames.push("swiper-container-android"),h.container.addClass(h.classNames.join(" ")),h.translate=0,h.progress=0,h.velocity=0,h.lockSwipeToNext=function(){h.params.allowSwipeToNext=!1},h.lockSwipeToPrev=function(){h.params.allowSwipeToPrev=!1},h.lockSwipes=function(){h.params.allowSwipeToNext=h.params.allowSwipeToPrev=!1},h.unlockSwipeToNext=function(){h.params.allowSwipeToNext=!0},h.unlockSwipeToPrev=function(){h.params.allowSwipeToPrev=!0},h.unlockSwipes=function(){h.params.allowSwipeToNext=h.params.allowSwipeToPrev=!0},h.params.grabCursor&&(h.container[0].style.cursor="move",h.container[0].style.cursor="-webkit-grab",h.container[0].style.cursor="-moz-grab",h.container[0].style.cursor="grab"),h.imagesToLoad=[],h.imagesLoaded=0,h.loadImage=function(e,t,n,r,i){function o(){i&&i()}var s;!e.complete||!r?t?(s=new window.Image,s.onload=o,s.onerror=o,n&&(s.srcset=n),t&&(s.src=t)):o():o()},h.preloadImages=function(){function e(){if(typeof h=="undefined"||h===null)return;h.imagesLoaded!==undefined&&h.imagesLoaded++,h.imagesLoaded===h.imagesToLoad.length&&(h.params.updateOnImagesReady&&h.update(),h.emit("onImagesReady",h))}h.imagesToLoad=h.container.find("img");for(var t=0;t<h.imagesToLoad.length;t++)h.loadImage(h.imagesToLoad[t],h.imagesToLoad[t].currentSrc||h.imagesToLoad[t].getAttribute("src"),h.imagesToLoad[t].srcset||h.imagesToLoad[t].getAttribute("srcset"),!0,e)},h.autoplayTimeoutId=undefined,h.autoplaying=!1,h.autoplayPaused=!1,h.startAutoplay=function(){if(typeof h.autoplayTimeoutId!="undefined")return!1;if(!h.params.autoplay)return!1;if(h.autoplaying)return!1;h.autoplaying=!0,h.emit("onAutoplayStart",h),v()},h.stopAutoplay=function(e){if(!h.autoplayTimeoutId)return;h.autoplayTimeoutId&&clearTimeout(h.autoplayTimeoutId),h.autoplaying=!1,h.autoplayTimeoutId=undefined,h.emit("onAutoplayStop",h)},h.pauseAutoplay=function(e){if(h.autoplayPaused)return;h.autoplayTimeoutId&&clearTimeout(h.autoplayTimeoutId),h.autoplayPaused=!0,e===0?(h.autoplayPaused=!1,v()):h.wrapper.transitionEnd(function(){if(!h)return;h.autoplayPaused=!1,h.autoplaying?v():h.stopAutoplay()})},h.minTranslate=function(){return-h.snapGrid[0]},h.maxTranslate=function(){return-h.snapGrid[h.snapGrid.length-1]},h.updateAutoHeight=function(){var e=h.slides.eq(h.activeIndex)[0];if(typeof e!="undefined"){var t=e.offsetHeight;t&&h.wrapper.css("height",t+"px")}},h.updateContainerSize=function(){var e,t;typeof h.params.width!="undefined"?e=h.params.width:e=h.container[0].clientWidth,typeof h.params.height!="undefined"?t=h.params.height:t=h.container[0].clientHeight;if(e===0&&h.isHorizontal()||t===0&&!h.isHorizontal())return;e=e-parseInt(h.container.css("padding-left"),10)-parseInt(h.container.css("padding-right"),10),t=t-parseInt(h.container.css("padding-top"),10)-parseInt(h.container.css("padding-bottom"),10),h.width=e,h.height=t,h.size=h.isHorizontal()?h.width:h.height},h.updateSlidesSize=function(){h.slides=h.wrapper.children("."+h.params.slideClass),h.snapGrid=[],h.slidesGrid=[],h.slidesSizesGrid=[];var e=h.params.spaceBetween,t=-h.params.slidesOffsetBefore,n,r=0,i=0;if(typeof h.size=="undefined")return;typeof e=="string"&&e.indexOf("%")>=0&&(e=parseFloat(e.replace("%",""))/100*h.size),h.virtualSize=-e,h.rtl?h.slides.css({marginLeft:"",marginTop:""}):h.slides.css({marginRight:"",marginBottom:""});var s;h.params.slidesPerColumn>1&&(Math.floor(h.slides.length/h.params.slidesPerColumn)===h.slides.length/h.params.slidesPerColumn?s=h.slides.length:s=Math.ceil(h.slides.length/h.params.slidesPerColumn)*h.params.slidesPerColumn,h.params.slidesPerView!=="auto"&&h.params.slidesPerColumnFill==="row"&&(s=Math.max(s,h.params.slidesPerView*h.params.slidesPerColumn)));var o,u=h.params.slidesPerColumn,a=s/u,f=a-(h.params.slidesPerColumn*a-h.slides.length);for(n=0;n<h.slides.length;n++){o=0;var l=h.slides.eq(n);if(h.params.slidesPerColumn>1){var c,p,v;h.params.slidesPerColumnFill==="column"?(p=Math.floor(n/u),v=n-p*u,(p>f||p===f&&v===u-1)&&++v>=u&&(v=0,p++),c=p+v*s/u,l.css({"-webkit-box-ordinal-group":c,"-moz-box-ordinal-group":c,"-ms-flex-order":c,"-webkit-order":c,order:c})):(v=Math.floor(n/a),p=n-v*a),l.css({"margin-top":v!==0&&h.params.spaceBetween&&h.params.spaceBetween+"px"}).attr("data-swiper-column",p).attr("data-swiper-row",v)}if(l.css("display")==="none")continue;h.params.slidesPerView==="auto"?(o=h.isHorizontal()?l.outerWidth(!0):l.outerHeight(!0),h.params.roundLengths&&(o=d(o))):(o=(h.size-(h.params.slidesPerView-1)*e)/h.params.slidesPerView,h.params.roundLengths&&(o=d(o)),h.isHorizontal()?h.slides[n].style.width=o+"px":h.slides[n].style.height=o+"px"),h.slides[n].swiperSlideSize=o,h.slidesSizesGrid.push(o),h.params.centeredSlides?(t=t+o/2+r/2+e,n===0&&(t=t-h.size/2-e),Math.abs(t)<.001&&(t=0),i%h.params.slidesPerGroup===0&&h.snapGrid.push(t),h.slidesGrid.push(t)):(i%h.params.slidesPerGroup===0&&h.snapGrid.push(t),h.slidesGrid.push(t),t=t+o+e),h.virtualSize+=o+e,r=o,i++}h.virtualSize=Math.max(h.virtualSize,h.size)+h.params.slidesOffsetAfter;var m;h.rtl&&h.wrongRTL&&(h.params.effect==="slide"||h.params.effect==="coverflow")&&h.wrapper.css({width:h.virtualSize+h.params.spaceBetween+"px"});if(!h.support.flexbox||h.params.setWrapperSize)h.isHorizontal()?h.wrapper.css({width:h.virtualSize+h.params.spaceBetween+"px"}):h.wrapper.css({height:h.virtualSize+h.params.spaceBetween+"px"});if(h.params.slidesPerColumn>1){h.virtualSize=(o+h.params.spaceBetween)*s,h.virtualSize=Math.ceil(h.virtualSize/h.params.slidesPerColumn)-h.params.spaceBetween,h.wrapper.css({width:h.virtualSize+h.params.spaceBetween+"px"});if(h.params.centeredSlides){m=[];for(n=0;n<h.snapGrid.length;n++)h.snapGrid[n]<h.virtualSize+h.snapGrid[0]&&m.push(h.snapGrid[n]);h.snapGrid=m}}if(!h.params.centeredSlides){m=[];for(n=0;n<h.snapGrid.length;n++)h.snapGrid[n]<=h.virtualSize-h.size&&m.push(h.snapGrid[n]);h.snapGrid=m,Math.floor(h.virtualSize-h.size)-Math.floor(h.snapGrid[h.snapGrid.length-1])>1&&h.snapGrid.push(h.virtualSize-h.size)}h.snapGrid.length===0&&(h.snapGrid=[0]),h.params.spaceBetween!==0&&(h.isHorizontal()?h.rtl?h.slides.css({marginLeft:e+"px"}):h.slides.css({marginRight:e+"px"}):h.slides.css({marginBottom:e+"px"})),h.params.watchSlidesProgress&&h.updateSlidesOffset()},h.updateSlidesOffset=function(){for(var e=0;e<h.slides.length;e++)h.slides[e].swiperSlideOffset=h.isHorizontal()?h.slides[e].offsetLeft:h.slides[e].offsetTop},h.updateSlidesProgress=function(e){typeof e=="undefined"&&(e=h.translate||0);if(h.slides.length===0)return;typeof h.slides[0].swiperSlideOffset=="undefined"&&h.updateSlidesOffset();var t=-e;h.rtl&&(t=e),h.slides.removeClass(h.params.slideVisibleClass);for(var n=0;n<h.slides.length;n++){var r=h.slides[n],i=(t-r.swiperSlideOffset)/(r.swiperSlideSize+h.params.spaceBetween);if(h.params.watchSlidesVisibility){var s=-(t-r.swiperSlideOffset),o=s+h.slidesSizesGrid[n],u=s>=0&&s<h.size||o>0&&o<=h.size||s<=0&&o>=h.size;u&&h.slides.eq(n).addClass(h.params.slideVisibleClass)}r.progress=h.rtl?-i:i}},h.updateProgress=function(e){typeof e=="undefined"&&(e=h.translate||0);var t=h.maxTranslate()-h.minTranslate(),n=h.isBeginning,r=h.isEnd;t===0?(h.progress=0,h.isBeginning=h.isEnd=!0):(h.progress=(e-h.minTranslate())/t,h.isBeginning=h.progress<=0,h.isEnd=h.progress>=1),h.isBeginning&&!n&&h.emit("onReachBeginning",h),h.isEnd&&!r&&h.emit("onReachEnd",h),h.params.watchSlidesProgress&&h.updateSlidesProgress(e),h.emit("onProgress",h,h.progress)},h.updateActiveIndex=function(){var e=h.rtl?h.translate:-h.translate,t,n,r;for(n=0;n<h.slidesGrid.length;n++)typeof h.slidesGrid[n+1]!="undefined"?e>=h.slidesGrid[n]&&e<h.slidesGrid[n+1]-(h.slidesGrid[n+1]-h.slidesGrid[n])/2?t=n:e>=h.slidesGrid[n]&&e<h.slidesGrid[n+1]&&(t=n+1):e>=h.slidesGrid[n]&&(t=n);if(t<0||typeof t=="undefined")t=0;r=Math.floor(t/h.params.slidesPerGroup),r>=h.snapGrid.length&&(r=h.snapGrid.length-1);if(t===h.activeIndex)return;h.snapIndex=r,h.previousIndex=h.activeIndex,h.activeIndex=t,h.updateClasses()},h.updateClasses=function(){h.slides.removeClass(h.params.slideActiveClass+" "+h.params.slideNextClass+" "+h.params.slidePrevClass);var t=h.slides.eq(h.activeIndex);t.addClass(h.params.slideActiveClass);var n=t.next("."+h.params.slideClass).addClass(h.params.slideNextClass);h.params.loop&&n.length===0&&h.slides.eq(0).addClass(h.params.slideNextClass);var r=t.prev("."+h.params.slideClass).addClass(h.params.slidePrevClass);h.params.loop&&r.length===0&&h.slides.eq(-1).addClass(h.params.slidePrevClass);if(h.paginationContainer&&h.paginationContainer.length>0){var i,s=h.params.loop?Math.ceil((h.slides.length-h.loopedSlides*2)/h.params.slidesPerGroup):h.snapGrid.length;h.params.loop?(i=Math.ceil((h.activeIndex-h.loopedSlides)/h.params.slidesPerGroup),i>h.slides.length-1-h.loopedSlides*2&&(i-=h.slides.length-h.loopedSlides*2),i>s-1&&(i-=s),i<0&&h.params.paginationType!=="bullets"&&(i=s+i)):typeof h.snapIndex!="undefined"?i=h.snapIndex:i=h.activeIndex||0,h.params.paginationType==="bullets"&&h.bullets&&h.bullets.length>0&&(h.bullets.removeClass(h.params.bulletActiveClass),h.paginationContainer.length>1?h.bullets.each(function(){e(this).index()===i&&e(this).addClass(h.params.bulletActiveClass)}):h.bullets.eq(i).addClass(h.params.bulletActiveClass)),h.params.paginationType==="fraction"&&(h.paginationContainer.find("."+h.params.paginationCurrentClass).text(i+1),h.paginationContainer.find("."+h.params.paginationTotalClass).text(s));if(h.params.paginationType==="progress"){var o=(i+1)/s,u=o,a=1;h.isHorizontal()||(a=o,u=1),h.paginationContainer.find("."+h.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+u+") scaleY("+a+")").transition(h.params.speed)}h.params.paginationType==="custom"&&h.params.paginationCustomRender&&(h.paginationContainer.html(h.params.paginationCustomRender(h,i+1,s)),h.emit("onPaginationRendered",h,h.paginationContainer[0]))}h.params.loop||(h.params.prevButton&&h.prevButton&&h.prevButton.length>0&&(h.isBeginning?(h.prevButton.addClass(h.params.buttonDisabledClass),h.params.a11y&&h.a11y&&h.a11y.disable(h.prevButton)):(h.prevButton.removeClass(h.params.buttonDisabledClass),h.params.a11y&&h.a11y&&h.a11y.enable(h.prevButton))),h.params.nextButton&&h.nextButton&&h.nextButton.length>0&&(h.isEnd?(h.nextButton.addClass(h.params.buttonDisabledClass),h.params.a11y&&h.a11y&&h.a11y.disable(h.nextButton)):(h.nextButton.removeClass(h.params.buttonDisabledClass),h.params.a11y&&h.a11y&&h.a11y.enable(h.nextButton))))},h.updatePagination=function(){if(!h.params.pagination)return;if(h.paginationContainer&&h.paginationContainer.length>0){var e="";if(h.params.paginationType==="bullets"){var t=h.params.loop?Math.ceil((h.slides.length-h.loopedSlides*2)/h.params.slidesPerGroup):h.snapGrid.length;for(var n=0;n<t;n++)h.params.paginationBulletRender?e+=h.params.paginationBulletRender(n,h.params.bulletClass):e+="<"+h.params.paginationElement+' class="'+h.params.bulletClass+'"></'+h.params.paginationElement+">";h.paginationContainer.html(e),h.bullets=h.paginationContainer.find("."+h.params.bulletClass),h.params.paginationClickable&&h.params.a11y&&h.a11y&&h.a11y.initPagination()}h.params.paginationType==="fraction"&&(h.params.paginationFractionRender?e=h.params.paginationFractionRender(h,h.params.paginationCurrentClass,h.params.paginationTotalClass):e='<span class="'+h.params.paginationCurrentClass+'"></span>'+" / "+'<span class="'+h.params.paginationTotalClass+'"></span>',h.paginationContainer.html(e)),h.params.paginationType==="progress"&&(h.params.paginationProgressRender?e=h.params.paginationProgressRender(h,h.params.paginationProgressbarClass):e='<span class="'+h.params.paginationProgressbarClass+'"></span>',h.paginationContainer.html(e)),h.params.paginationType!=="custom"&&h.emit("onPaginationRendered",h,h.paginationContainer[0])}},h.update=function(e){function t(){r=Math.min(Math.max(h.translate,h.maxTranslate()),h.minTranslate()),h.setWrapperTranslate(r),h.updateActiveIndex(),h.updateClasses()}h.updateContainerSize(),h.updateSlidesSize(),h.updateProgress(),h.updatePagination(),h.updateClasses(),h.params.scrollbar&&h.scrollbar&&h.scrollbar.set();if(e){var n,r;h.controller&&h.controller.spline&&(h.controller.spline=undefined),h.params.freeMode?(t(),h.params.autoHeight&&h.updateAutoHeight()):((h.params.slidesPerView==="auto"||h.params.slidesPerView>1)&&h.isEnd&&!h.params.centeredSlides?n=h.slideTo(h.slides.length-1,0,!1,!0):n=h.slideTo(h.activeIndex,0,!1,!0),n||t())}else h.params.autoHeight&&h.updateAutoHeight()},h.onResize=function(e){h.params.breakpoints&&h.setBreakpoint();var t=h.params.allowSwipeToPrev,n=h.params.allowSwipeToNext;h.params.allowSwipeToPrev=h.params.allowSwipeToNext=!0,h.updateContainerSize(),h.updateSlidesSize(),(h.params.slidesPerView==="auto"||h.params.freeMode||e)&&h.updatePagination(),h.params.scrollbar&&h.scrollbar&&h.scrollbar.set(),h.controller&&h.controller.spline&&(h.controller.spline=undefined);var r=!1;if(h.params.freeMode){var i=Math.min(Math.max(h.translate,h.maxTranslate()),h.minTranslate());h.setWrapperTranslate(i),h.updateActiveIndex(),h.updateClasses(),h.params.autoHeight&&h.updateAutoHeight()}else h.updateClasses(),(h.params.slidesPerView==="auto"||h.params.slidesPerView>1)&&h.isEnd&&!h.params.centeredSlides?r=h.slideTo(h.slides.length-1,0,!1,!0):r=h.slideTo(h.activeIndex,0,!1,!0);h.params.lazyLoading&&!r&&h.lazy&&h.lazy.load(),h.params.allowSwipeToPrev=t,h.params.allowSwipeToNext=n};var m=["mousedown","mousemove","mouseup"];window.navigator.pointerEnabled?m=["pointerdown","pointermove","pointerup"]:window.navigator.msPointerEnabled&&(m=["MSPointerDown","MSPointerMove","MSPointerUp"]),h.touchEvents={start:h.support.touch||!h.params.simulateTouch?"touchstart":m[0],move:h.support.touch||!h.params.simulateTouch?"touchmove":m[1],end:h.support.touch||!h.params.simulateTouch?"touchend":m[2]},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&(h.params.touchEventsTarget==="container"?h.container:h.wrapper).addClass("swiper-wp8-"+h.params.direction),h.initEvents=function(e){var t=e?"off":"on",n=e?"removeEventListener":"addEventListener",r=h.params.touchEventsTarget==="container"?h.container[0]:h.wrapper[0],s=h.support.touch?r:document,o=h.params.nested?!0:!1;h.browser.ie?(r[n](h.touchEvents.start,h.onTouchStart,!1),s[n](h.touchEvents.move,h.onTouchMove,o),s[n](h.touchEvents.end,h.onTouchEnd,!1)):(h.support.touch&&(r[n](h.touchEvents.start,h.onTouchStart,!1),r[n](h.touchEvents.move,h.onTouchMove,o),r[n](h.touchEvents.end,h.onTouchEnd,!1)),i.simulateTouch&&!h.device.ios&&!h.device.android&&(r[n]("mousedown",h.onTouchStart,!1),document[n]("mousemove",h.onTouchMove,o),document[n]("mouseup",h.onTouchEnd,!1))),window[n]("resize",h.onResize),h.params.nextButton&&h.nextButton&&h.nextButton.length>0&&(h.nextButton[t]("click",h.onClickNext),h.params.a11y&&h.a11y&&h.nextButton[t]("keydown",h.a11y.onEnterKey)),h.params.prevButton&&h.prevButton&&h.prevButton.length>0&&(h.prevButton[t]("click",h.onClickPrev),h.params.a11y&&h.a11y&&h.prevButton[t]("keydown",h.a11y.onEnterKey)),h.params.pagination&&h.params.paginationClickable&&(h.paginationContainer[t]("click","."+h.params.bulletClass,h.onClickIndex),h.params.a11y&&h.a11y&&h.paginationContainer[t]("keydown","."+h.params.bulletClass,h.a11y.onEnterKey)),(h.params.preventClicks||h.params.preventClicksPropagation)&&r[n]("click",h.preventClicks,!0)},h.attachEvents=function(){h.initEvents()},h.detachEvents=function(){h.initEvents(!0)},h.allowClick=!0,h.preventClicks=function(e){h.allowClick||(h.params.preventClicks&&e.preventDefault(),h.params.preventClicksPropagation&&h.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},h.onClickNext=function(e){e.preventDefault();if(h.isEnd&&!h.params.loop)return;h.slideNext()},h.onClickPrev=function(e){e.preventDefault();if(h.isBeginning&&!h.params.loop)return;h.slidePrev()},h.onClickIndex=function(t){t.preventDefault();var n=e(this).index()*h.params.slidesPerGroup;h.params.loop&&(n+=h.loopedSlides),h.slideTo(n)},h.updateClickedSlide=function(t){var n=g(t,"."+h.params.slideClass),r=!1;if(n)for(var i=0;i<h.slides.length;i++)h.slides[i]===n&&(r=!0);if(!n||!r){h.clickedSlide=undefined,h.clickedIndex=undefined;return}h.clickedSlide=n,h.clickedIndex=e(n).index();if(h.params.slideToClickedSlide&&h.clickedIndex!==undefined&&h.clickedIndex!==h.activeIndex){var s=h.clickedIndex,o,u;if(h.params.loop){if(h.animating)return;o=e(h.clickedSlide).attr("data-swiper-slide-index"),h.params.centeredSlides?s<h.loopedSlides-h.params.slidesPerView/2||s>h.slides.length-h.loopedSlides+h.params.slidesPerView/2?(h.fixLoop(),s=h.wrapper.children("."+h.params.slideClass+'[data-swiper-slide-index="'+o+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){h.slideTo(s)},0)):h.slideTo(s):s>h.slides.length-h.params.slidesPerView?(h.fixLoop(),s=h.wrapper.children("."+h.params.slideClass+'[data-swiper-slide-index="'+o+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){h.slideTo(s)},0)):h.slideTo(s)}else h.slideTo(s)}};var y,b,w,E,S,x,T,N,C="input, select, textarea, button",k=Date.now(),L,A=[],O;h.animating=!1,h.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var M,_;h.onTouchStart=function(t){t.originalEvent&&(t=t.originalEvent),M=t.type==="touchstart";if(!M&&"which"in t&&t.which===3)return;if(h.params.noSwiping&&g(t,"."+h.params.noSwipingClass)){h.allowClick=!0;return}if(h.params.swipeHandler&&!g(t,h.params.swipeHandler))return;var n=h.touches.currentX=t.type==="touchstart"?t.targetTouches[0].pageX:t.pageX,r=h.touches.currentY=t.type==="touchstart"?t.targetTouches[0].pageY:t.pageY;if(h.device.ios&&h.params.iOSEdgeSwipeDetection&&n<=h.params.iOSEdgeSwipeThreshold)return;y=!0,b=!1,w=!0,S=undefined,_=undefined,h.touches.startX=n,h.touches.startY=r,E=Date.now(),h.allowClick=!0,h.updateContainerSize(),h.swipeDirection=undefined,h.params.threshold>0&&(N=!1);if(t.type!=="touchstart"){var i=!0;e(t.target).is(C)&&(i=!1),document.activeElement&&e(document.activeElement).is(C)&&document.activeElement.blur(),i&&t.preventDefault()}h.emit("onTouchStart",h,t)},h.onTouchMove=function(t){t.originalEvent&&(t=t.originalEvent);if(M&&t.type==="mousemove")return;if(t.preventedByNestedSwiper){h.touches.startX=t.type==="touchmove"?t.targetTouches[0].pageX:t.pageX,h.touches.startY=t.type==="touchmove"?t.targetTouches[0].pageY:t.pageY;return}if(h.params.onlyExternal){h.allowClick=!1,y&&(h.touches.startX=h.touches.currentX=t.type==="touchmove"?t.targetTouches[0].pageX:t.pageX,h.touches.startY=h.touches.currentY=t.type==="touchmove"?t.targetTouches[0].pageY:t.pageY,E=Date.now());return}if(M&&document.activeElement&&t.target===document.activeElement&&e(t.target).is(C)){b=!0,h.allowClick=!1;return}w&&h.emit("onTouchMove",h,t);if(t.targetTouches&&t.targetTouches.length>1)return;h.touches.currentX=t.type==="touchmove"?t.targetTouches[0].pageX:t.pageX,h.touches.currentY=t.type==="touchmove"?t.targetTouches[0].pageY:t.pageY;if(typeof S=="undefined"){var n=Math.atan2(Math.abs(h.touches.currentY-h.touches.startY),Math.abs(h.touches.currentX-h.touches.startX))*180/Math.PI;S=h.isHorizontal()?n>h.params.touchAngle:90-n>h.params.touchAngle}S&&h.emit("onTouchMoveOpposite",h,t),typeof _=="undefined"&&h.browser.ieTouch&&(h.touches.currentX!==h.touches.startX||h.touches.currentY!==h.touches.startY)&&(_=!0);if(!y)return;if(S){y=!1;return}if(!_&&h.browser.ieTouch)return;h.allowClick=!1,h.emit("onSliderMove",h,t),t.preventDefault(),h.params.touchMoveStopPropagation&&!h.params.nested&&t.stopPropagation(),b||(i.loop&&h.fixLoop(),T=h.getWrapperTranslate(),h.setWrapperTransition(0),h.animating&&h.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),h.params.autoplay&&h.autoplaying&&(h.params.autoplayDisableOnInteraction?h.stopAutoplay():h.pauseAutoplay()),O=!1,h.params.grabCursor&&(h.container[0].style.cursor="move",h.container[0].style.cursor="-webkit-grabbing",h.container[0].style.cursor="-moz-grabbin",h.container[0].style.cursor="grabbing")),b=!0;var r=h.touches.diff=h.isHorizontal()?h.touches.currentX-h.touches.startX:h.touches.currentY-h.touches.startY;r*=h.params.touchRatio,h.rtl&&(r=-r),h.swipeDirection=r>0?"prev":"next",x=r+T;var s=!0;r>0&&x>h.minTranslate()?(s=!1,h.params.resistance&&(x=h.minTranslate()-1+Math.pow(-h.minTranslate()+T+r,h.params.resistanceRatio))):r<0&&x<h.maxTranslate()&&(s=!1,h.params.resistance&&(x=h.maxTranslate()+1-Math.pow(h.maxTranslate()-T-r,h.params.resistanceRatio))),s&&(t.preventedByNestedSwiper=!0),!h.params.allowSwipeToNext&&h.swipeDirection==="next"&&x<T&&(x=T),!h.params.allowSwipeToPrev&&h.swipeDirection==="prev"&&x>T&&(x=T);if(!h.params.followFinger)return;if(h.params.threshold>0){if(!(Math.abs(r)>h.params.threshold||N)){x=T;return}if(!N){N=!0,h.touches.startX=h.touches.currentX,h.touches.startY=h.touches.currentY,x=T,h.touches.diff=h.isHorizontal()?h.touches.currentX-h.touches.startX:h.touches.currentY-h.touches.startY;return}}(h.params.freeMode||h.params.watchSlidesProgress)&&h.updateActiveIndex(),h.params.freeMode&&(A.length===0&&A.push({position:h.touches[h.isHorizontal()?"startX":"startY"],time:E}),A.push({position:h.touches[h.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),h.updateProgress(x),h.setWrapperTranslate(x)},h.onTouchEnd=function(t){t.originalEvent&&(t=t.originalEvent),w&&h.emit("onTouchEnd",h,t),w=!1;if(!y)return;h.params.grabCursor&&b&&y&&(h.container[0].style.cursor="move",h.container[0].style.cursor="-webkit-grab",h.container[0].style.cursor="-moz-grab",h.container[0].style.cursor="grab");var n=Date.now(),r=n-E;h.allowClick&&(h.updateClickedSlide(t),h.emit("onTap",h,t),r<300&&n-k>300&&(L&&clearTimeout(L),L=setTimeout(function(){if(!h)return;h.params.paginationHide&&h.paginationContainer.length>0&&!e(t.target).hasClass(h.params.bulletClass)&&h.paginationContainer.toggleClass(h.params.paginationHiddenClass),h.emit("onClick",h,t)},300)),r<300&&n-k<300&&(L&&clearTimeout(L),h.emit("onDoubleTap",h,t))),k=Date.now(),setTimeout(function(){h&&(h.allowClick=!0)},0);if(!y||!b||!h.swipeDirection||h.touches.diff===0||x===T){y=b=!1;return}y=b=!1;var i;h.params.followFinger?i=h.rtl?h.translate:-h.translate:i=-x;if(h.params.freeMode){if(i<-h.minTranslate()){h.slideTo(h.activeIndex);return}if(i>-h.maxTranslate()){h.slides.length<h.snapGrid.length?h.slideTo(h.snapGrid.length-1):h.slideTo(h.slides.length-1);return}if(h.params.freeModeMomentum){if(A.length>1){var s=A.pop(),o=A.pop(),u=s.position-o.position,a=s.time-o.time;h.velocity=u/a,h.velocity=h.velocity/2,Math.abs(h.velocity)<h.params.freeModeMinimumVelocity&&(h.velocity=0);if(a>150||(new window.Date).getTime()-s.time>300)h.velocity=0}else h.velocity=0;A.length=0;var f=1e3*h.params.freeModeMomentumRatio,l=h.velocity*f,c=h.translate+l;h.rtl&&(c=-c);var p=!1,d,v=Math.abs(h.velocity)*20*h.params.freeModeMomentumBounceRatio;if(c<h.maxTranslate())h.params.freeModeMomentumBounce?(c+h.maxTranslate()<-v&&(c=h.maxTranslate()-v),d=h.maxTranslate(),p=!0,O=!0):c=h.maxTranslate();else if(c>h.minTranslate())h.params.freeModeMomentumBounce?(c-h.minTranslate()>v&&(c=h.minTranslate()+v),d=h.minTranslate(),p=!0,O=!0):c=h.minTranslate();else if(h.params.freeModeSticky){var m=0,g;for(m=0;m<h.snapGrid.length;m+=1)if(h.snapGrid[m]>-c){g=m;break}Math.abs(h.snapGrid[g]-c)<Math.abs(h.snapGrid[g-1]-c)||h.swipeDirection==="next"?c=h.snapGrid[g]:c=h.snapGrid[g-1],h.rtl||(c=-c)}if(h.velocity!==0)h.rtl?f=Math.abs((-c-h.translate)/h.velocity):f=Math.abs((c-h.translate)/h.velocity);else if(h.params.freeModeSticky){h.slideReset();return}h.params.freeModeMomentumBounce&&p?(h.updateProgress(d),h.setWrapperTransition(f),h.setWrapperTranslate(c),h.onTransitionStart(),h.animating=!0,h.wrapper.transitionEnd(function(){if(!h||!O)return;h.emit("onMomentumBounce",h),h.setWrapperTransition(h.params.speed),h.setWrapperTranslate(d),h.wrapper.transitionEnd(function(){if(!h)return;h.onTransitionEnd()})})):h.velocity?(h.updateProgress(c),h.setWrapperTransition(f),h.setWrapperTranslate(c),h.onTransitionStart(),h.animating||(h.animating=!0,h.wrapper.transitionEnd(function(){if(!h)return;h.onTransitionEnd()}))):h.updateProgress(c),h.updateActiveIndex()}if(!h.params.freeModeMomentum||r>=h.params.longSwipesMs)h.updateProgress(),h.updateActiveIndex();return}var S,N=0,C=h.slidesSizesGrid[0];for(S=0;S<h.slidesGrid.length;S+=h.params.slidesPerGroup)typeof h.slidesGrid[S+h.params.slidesPerGroup]!="undefined"?i>=h.slidesGrid[S]&&i<h.slidesGrid[S+h.params.slidesPerGroup]&&(N=S,C=h.slidesGrid[S+h.params.slidesPerGroup]-h.slidesGrid[S]):i>=h.slidesGrid[S]&&(N=S,C=h.slidesGrid[h.slidesGrid.length-1]-h.slidesGrid[h.slidesGrid.length-2]);var M=(i-h.slidesGrid[N])/C;if(r>h.params.longSwipesMs){if(!h.params.longSwipes){h.slideTo(h.activeIndex);return}h.swipeDirection==="next"&&(M>=h.params.longSwipesRatio?h.slideTo(N+h.params.slidesPerGroup):h.slideTo(N)),h.swipeDirection==="prev"&&(M>1-h.params.longSwipesRatio?h.slideTo(N+h.params.slidesPerGroup):h.slideTo(N))}else{if(!h.params.shortSwipes){h.slideTo(h.activeIndex);return}h.swipeDirection==="next"&&h.slideTo(N+h.params.slidesPerGroup),h.swipeDirection==="prev"&&h.slideTo(N)}},h._slideTo=function(e,t){return h.slideTo(e,t,!0,!0)},h.slideTo=function(e,t,n,r){typeof n=="undefined"&&(n=!0),typeof e=="undefined"&&(e=0),e<0&&(e=0),h.snapIndex=Math.floor(e/h.params.slidesPerGroup),h.snapIndex>=h.snapGrid.length&&(h.snapIndex=h.snapGrid.length-1);var i=-h.snapGrid[h.snapIndex];h.params.autoplay&&h.autoplaying&&(r||!h.params.autoplayDisableOnInteraction?h.pauseAutoplay(t):h.stopAutoplay()),h.updateProgress(i);for(var s=0;s<h.slidesGrid.length;s++)-Math.floor(i*100)>=Math.floor(h.slidesGrid[s]*100)&&(e=s);return!h.params.allowSwipeToNext&&i<h.translate&&i<h.minTranslate()?!1:!h.params.allowSwipeToPrev&&i>h.translate&&i>h.maxTranslate()&&(h.activeIndex||0)!==e?!1:(typeof t=="undefined"&&(t=h.params.speed),h.previousIndex=h.activeIndex||0,h.activeIndex=e,h.rtl&&-i===h.translate||!h.rtl&&i===h.translate?(h.params.autoHeight&&h.updateAutoHeight(),h.updateClasses(),h.params.effect!=="slide"&&h.setWrapperTranslate(i),!1):(h.updateClasses(),h.onTransitionStart(n),t===0?(h.setWrapperTranslate(i),h.setWrapperTransition(0),h.onTransitionEnd(n)):(h.setWrapperTranslate(i),h.setWrapperTransition(t),h.animating||(h.animating=!0,h.wrapper.transitionEnd(function(){if(!h)return;h.onTransitionEnd(n)}))),!0))},h.onTransitionStart=function(e){typeof e=="undefined"&&(e=!0),h.params.autoHeight&&h.updateAutoHeight(),h.lazy&&h.lazy.onTransitionStart(),e&&(h.emit("onTransitionStart",h),h.activeIndex!==h.previousIndex&&(h.emit("onSlideChangeStart",h),h.activeIndex>h.previousIndex?h.emit("onSlideNextStart",h):h.emit("onSlidePrevStart",h)))},h.onTransitionEnd=function(e){h.animating=!1,h.setWrapperTransition(0),typeof e=="undefined"&&(e=!0),h.lazy&&h.lazy.onTransitionEnd(),e&&(h.emit("onTransitionEnd",h),h.activeIndex!==h.previousIndex&&(h.emit("onSlideChangeEnd",h),h.activeIndex>h.previousIndex?h.emit("onSlideNextEnd",h):h.emit("onSlidePrevEnd",h))),h.params.hashnav&&h.hashnav&&h.hashnav.setHash()},h.slideNext=function(e,t,n){if(h.params.loop){if(h.animating)return!1;h.fixLoop();var r=h.container[0].clientLeft;return h.slideTo(h.activeIndex+h.params.slidesPerGroup,t,e,n)}return h.slideTo(h.activeIndex+h.params.slidesPerGroup,t,e,n)},h._slideNext=function(e){return h.slideNext(!0,e,!0)},h.slidePrev=function(e,t,n){if(h.params.loop){if(h.animating)return!1;h.fixLoop();var r=h.container[0].clientLeft;return h.slideTo(h.activeIndex-1,t,e,n)}return h.slideTo(h.activeIndex-1,t,e,n)},h._slidePrev=function(e){return h.slidePrev(!0,e,!0)},h.slideReset=function(e,t,n){return h.slideTo(h.activeIndex,t,e)},h.setWrapperTransition=function(e,t){h.wrapper.transition(e),h.params.effect!=="slide"&&h.effects[h.params.effect]&&h.effects[h.params.effect].setTransition(e),h.params.parallax&&h.parallax&&h.parallax.setTransition(e),h.params.scrollbar&&h.scrollbar&&h.scrollbar.setTransition(e),h.params.control&&h.controller&&h.controller.setTransition(e,t),h.emit("onSetTransition",h,e)},h.setWrapperTranslate=function(e,t,n){var r=0,i=0,s=0;h.isHorizontal()?r=h.rtl?-e:e:i=e,h.params.roundLengths&&(r=d(r),i=d(i)),h.params.virtualTranslate||(h.support.transforms3d?h.wrapper.transform("translate3d("+r+"px, "+i+"px, "+s+"px)"):h.wrapper.transform("translate("+r+"px, "+i+"px)")),h.translate=h.isHorizontal()?r:i;var o,u=h.maxTranslate()-h.minTranslate();u===0?o=0:o=(e-h.minTranslate())/u,o!==h.progress&&h.updateProgress(e),t&&h.updateActiveIndex(),h.params.effect!=="slide"&&h.effects[h.params.effect]&&h.effects[h.params.effect].setTranslate(h.translate),h.params.parallax&&h.parallax&&h.parallax.setTranslate(h.translate),h.params.scrollbar&&h.scrollbar&&h.scrollbar.setTranslate(h.translate),h.params.control&&h.controller&&h.controller.setTranslate(h.translate,n),h.emit("onSetTranslate",h,h.translate)},h.getTranslate=function(e,t){var n,r,i,s;return typeof t=="undefined"&&(t="x"),h.params.virtualTranslate?h.rtl?-h.translate:h.translate:(i=window.getComputedStyle(e,null),window.WebKitCSSMatrix?(r=i.transform||i.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),s=new window.WebKitCSSMatrix(r==="none"?"":r)):(s=i.MozTransform||i.OTransform||i.MsTransform||i.msTransform||i.transform||i.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=s.toString().split(",")),t==="x"&&(window.WebKitCSSMatrix?r=s.m41:n.length===16?r=parseFloat(n[12]):r=parseFloat(n[4])),t==="y"&&(window.WebKitCSSMatrix?r=s.m42:n.length===16?r=parseFloat(n[13]):r=parseFloat(n[5])),h.rtl&&r&&(r=-r),r||0)},h.getWrapperTranslate=function(e){return typeof e=="undefined"&&(e=h.isHorizontal()?"x":"y"),h.getTranslate(h.wrapper[0],e)},h.observers=[],h.initObservers=function(){if(h.params.observeParents){var e=h.container.parents();for(var t=0;t<e.length;t++)D(e[t])}D(h.container[0],{childList:!1}),D(h.wrapper[0],{attributes:!1})},h.disconnectObservers=function(){for(var e=0;e<h.observers.length;e++)h.observers[e].disconnect();h.observers=[]},h.createLoop=function(){h.wrapper.children("."+h.params.slideClass+"."+h.params.slideDuplicateClass).remove();var t=h.wrapper.children("."+h.params.slideClass);h.params.slidesPerView==="auto"&&!h.params.loopedSlides&&(h.params.loopedSlides=t.length),h.loopedSlides=parseInt(h.params.loopedSlides||h.params.slidesPerView,10),h.loopedSlides=h.loopedSlides+h.params.loopAdditionalSlides,h.loopedSlides>t.length&&(h.loopedSlides=t.length);var n=[],r=[],i;t.each(function(i,s){var o=e(this);i<h.loopedSlides&&r.push(s),i<t.length&&i>=t.length-h.loopedSlides&&n.push(s),o.attr("data-swiper-slide-index",i)});for(i=0;i<r.length;i++)h.wrapper.append(e(r[i].cloneNode(!0)).addClass(h.params.slideDuplicateClass));for(i=n.length-1;i>=0;i--)h.wrapper.prepend(e(n[i].cloneNode(!0)).addClass(h.params.slideDuplicateClass))},h.destroyLoop=function(){h.wrapper.children("."+h.params.slideClass+"."+h.params.slideDuplicateClass).remove(),h.slides.removeAttr("data-swiper-slide-index")},h.reLoop=function(e){var t=h.activeIndex-h.loopedSlides;h.destroyLoop(),h.createLoop(),h.updateSlidesSize(),e&&h.slideTo(t+h.loopedSlides,0,!1)},h.fixLoop=function(){var e;if(h.activeIndex<h.loopedSlides)e=h.slides.length-h.loopedSlides*3+h.activeIndex,e+=h.loopedSlides,h.slideTo(e,0,!1,!0);else if(h.params.slidesPerView==="auto"&&h.activeIndex>=h.loopedSlides*2||h.activeIndex>h.slides.length-h.params.slidesPerView*2)e=-h.slides.length+h.activeIndex+h.loopedSlides,e+=h.loopedSlides,h.slideTo(e,0,!1,!0)},h.appendSlide=function(e){h.params.loop&&h.destroyLoop();if(typeof e=="object"&&e.length)for(var t=0;t<e.length;t++)e[t]&&h.wrapper.append(e[t]);else h.wrapper.append(e);h.params.loop&&h.createLoop(),(!h.params.observer||!h.support.observer)&&h.update(!0)},h.prependSlide=function(e){h.params.loop&&h.destroyLoop();var t=h.activeIndex+1;if(typeof e=="object"&&e.length){for(var n=0;n<e.length;n++)e[n]&&h.wrapper.prepend(e[n]);t=h.activeIndex+e.length}else h.wrapper.prepend(e);h.params.loop&&h.createLoop(),(!h.params.observer||!h.support.observer)&&h.update(!0),h.slideTo(t,0,!1)},h.removeSlide=function(e){h.params.loop&&(h.destroyLoop(),h.slides=h.wrapper.children("."+h.params.slideClass));var t=h.activeIndex,n;if(typeof e=="object"&&e.length){for(var r=0;r<e.length;r++)n=e[r],h.slides[n]&&h.slides.eq(n).remove(),n<t&&t--;t=Math.max(t,0)}else n=e,h.slides[n]&&h.slides.eq(n).remove(),n<t&&t--,t=Math.max(t,0);h.params.loop&&h.createLoop(),(!h.params.observer||!h.support.observer)&&h.update(!0),h.params.loop?h.slideTo(t+h.loopedSlides,0,!1):h.slideTo(t,0,!1)},h.removeAllSlides=function(){var e=[];for(var t=0;t<h.slides.length;t++)e.push(t);h.removeSlide(e)},h.effects={fade:{setTranslate:function(){for(var e=0;e<h.slides.length;e++){var t=h.slides.eq(e),n=t[0].swiperSlideOffset,r=-n;h.params.virtualTranslate||(r-=h.translate);var i=0;h.isHorizontal()||(i=r,r=0);var s=h.params.fade.crossFade?Math.max(1-Math.abs(t[0].progress),0):1+Math.min(Math.max(t[0].progress,-1),0);t.css({opacity:s}).transform("translate3d("+r+"px, "+i+"px, 0px)")}},setTransition:function(e){h.slides.transition(e);if(h.params.virtualTranslate&&e!==0){var t=!1;h.slides.transitionEnd(function(){if(t)return;if(!h)return;t=!0,h.animating=!1;var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"];for(var n=0;n<e.length;n++)h.wrapper.trigger(e[n])})}}},flip:{setTranslate:function(){for(var t=0;t<h.slides.length;t++){var n=h.slides.eq(t),r=n[0].progress;h.params.flip.limitRotation&&(r=Math.max(Math.min(n[0].progress,1),-1));var i=n[0].swiperSlideOffset,s=-180*r,o=s,u=0,a=-i,f=0;h.isHorizontal()?h.rtl&&(o=-o):(f=a,a=0,u=-o,o=0),n[0].style.zIndex=-Math.abs(Math.round(r))+h.slides.length;if(h.params.flip.slideShadows){var l=h.isHorizontal()?n.find(".swiper-slide-shadow-left"):n.find(".swiper-slide-shadow-top"),c=h.isHorizontal()?n.find(".swiper-slide-shadow-right"):n.find(".swiper-slide-shadow-bottom");l.length===0&&(l=e('<div class="swiper-slide-shadow-'+(h.isHorizontal()?"left":"top")+'"></div>'),n.append(l)),c.length===0&&(c=e('<div class="swiper-slide-shadow-'+(h.isHorizontal()?"right":"bottom")+'"></div>'),n.append(c)),l.length&&(l[0].style.opacity=Math.max(-r,0)),c.length&&(c[0].style.opacity=Math.max(r,0))}n.transform("translate3d("+a+"px, "+f+"px, 0px) rotateX("+u+"deg) rotateY("+o+"deg)")}},setTransition:function(t){h.slides.transition(t).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(t);if(h.params.virtualTranslate&&t!==0){var n=!1;h.slides.eq(h.activeIndex).transitionEnd(function(){if(n)return;if(!h)return;if(!e(this).hasClass(h.params.slideActiveClass))return;n=!0,h.animating=!1;var t=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"];for(var r=0;r<t.length;r++)h.wrapper.trigger(t[r])})}}},cube:{setTranslate:function(){var t=0,n;h.params.cube.shadow&&(h.isHorizontal()?(n=h.wrapper.find(".swiper-cube-shadow"),n.length===0&&(n=e('<div class="swiper-cube-shadow"></div>'),h.wrapper.append(n)),n.css({height:h.width+"px"})):(n=h.container.find(".swiper-cube-shadow"),n.length===0&&(n=e('<div class="swiper-cube-shadow"></div>'),h.container.append(n))));for(var r=0;r<h.slides.length;r++){var i=h.slides.eq(r),s=r*90,o=Math.floor(s/360);h.rtl&&(s=-s,o=Math.floor(-s/360));var u=Math.max(Math.min(i[0].progress,1),-1),a=0,f=0,l=0;r%4===0?(a=-o*4*h.size,l=0):(r-1)%4===0?(a=0,l=-o*4*h.size):(r-2)%4===0?(a=h.size+o*4*h.size,l=h.size):(r-3)%4===0&&(a=-h.size,l=3*h.size+h.size*4*o),h.rtl&&(a=-a),h.isHorizontal()||(f=a,a=0);var c="rotateX("+(h.isHorizontal()?0:-s)+"deg) rotateY("+(h.isHorizontal()?s:0)+"deg) translate3d("+a+"px, "+f+"px, "+l+"px)";u<=1&&u>-1&&(t=r*90+u*90,h.rtl&&(t=-r*90-u*90)),i.transform(c);if(h.params.cube.slideShadows){var p=h.isHorizontal()?i.find(".swiper-slide-shadow-left"):i.find(".swiper-slide-shadow-top"),d=h.isHorizontal()?i.find(".swiper-slide-shadow-right"):i.find(".swiper-slide-shadow-bottom");p.length===0&&(p=e('<div class="swiper-slide-shadow-'+(h.isHorizontal()?"left":"top")+'"></div>'),i.append(p)),d.length===0&&(d=e('<div class="swiper-slide-shadow-'+(h.isHorizontal()?"right":"bottom")+'"></div>'),i.append(d)),p.length&&(p[0].style.opacity=Math.max(-u,0)),d.length&&(d[0].style.opacity=Math.max(u,0))}}h.wrapper.css({"-webkit-transform-origin":"50% 50% -"+h.size/2+"px","-moz-transform-origin":"50% 50% -"+h.size/2+"px","-ms-transform-origin":"50% 50% -"+h.size/2+"px","transform-origin":"50% 50% -"+h.size/2+"px"});if(h.params.cube.shadow)if(h.isHorizontal())n.transform("translate3d(0px, "+(h.width/2+h.params.cube.shadowOffset)+"px, "+ -h.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+h.params.cube.shadowScale+")");else{var v=Math.abs(t)-Math.floor(Math.abs(t)/90)*90,m=1.5-(Math.sin(v*2*Math.PI/360)/2+Math.cos(v*2*Math.PI/360)/2),g=h.params.cube.shadowScale,y=h.params.cube.shadowScale/m,b=h.params.cube.shadowOffset;n.transform("scale3d("+g+", 1, "+y+") translate3d(0px, "+(h.height/2+b)+"px, "+ -h.height/2/y+"px) rotateX(-90deg)")}var w=h.isSafari||h.isUiWebView?-h.size/2:0;h.wrapper.transform("translate3d(0px,0,"+w+"px) rotateX("+(h.isHorizontal()?0:t)+"deg) rotateY("+(h.isHorizontal()?-t:0)+"deg)")},setTransition:function(e){h.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),h.params.cube.shadow&&!h.isHorizontal()&&h.container.find(".swiper-cube-shadow").transition(e)}},coverflow:{setTranslate:function(){var t=h.translate,n=h.isHorizontal()?-t+h.width/2:-t+h.height/2,r=h.isHorizontal()?h.params.coverflow.rotate:-h.params.coverflow.rotate,i=h.params.coverflow.depth;for(var s=0,o=h.slides.length;s<o;s++){var u=h.slides.eq(s),a=h.slidesSizesGrid[s],f=u[0].swiperSlideOffset,l=(n-f-a/2)/a*h.params.coverflow.modifier,c=h.isHorizontal()?r*l:0,p=h.isHorizontal()?0:r*l,d=-i*Math.abs(l),v=h.isHorizontal()?0:h.params.coverflow.stretch*l,m=h.isHorizontal()?h.params.coverflow.stretch*l:0;Math.abs(m)<.001&&(m=0),Math.abs(v)<.001&&(v=0),Math.abs(d)<.001&&(d=0),Math.abs(c)<.001&&(c=0),Math.abs(p)<.001&&(p=0);var g="translate3d("+m+"px,"+v+"px,"+d+"px)  rotateX("+p+"deg) rotateY("+c+"deg)";u.transform(g),u[0].style.zIndex=-Math.abs(Math.round(l))+1;if(h.params.coverflow.slideShadows){var y=h.isHorizontal()?u.find(".swiper-slide-shadow-left"):u.find(".swiper-slide-shadow-top"),b=h.isHorizontal()?u.find(".swiper-slide-shadow-right"):u.find(".swiper-slide-shadow-bottom");y.length===0&&(y=e('<div class="swiper-slide-shadow-'+(h.isHorizontal()?"left":"top")+'"></div>'),u.append(y)),b.length===0&&(b=e('<div class="swiper-slide-shadow-'+(h.isHorizontal()?"right":"bottom")+'"></div>'),u.append(b)),y.length&&(y[0].style.opacity=l>0?l:0),b.length&&(b[0].style.opacity=-l>0?-l:0)}}if(h.browser.ie){var w=h.wrapper[0].style;w.perspectiveOrigin=n+"px 50%"}},setTransition:function(e){h.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}}},h.lazy={initialImageLoaded:!1,loadImageInSlide:function(t,n){if(typeof t=="undefined")return;typeof n=="undefined"&&(n=!0);if(h.slides.length===0)return;var r=h.slides.eq(t),i=r.find(".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)");r.hasClass("swiper-lazy")&&!r.hasClass("swiper-lazy-loaded")&&!r.hasClass("swiper-lazy-loading")&&(i=i.add(r[0]));if(i.length===0)return;i.each(function(){var t=e(this);t.addClass("swiper-lazy-loading");var i=t.attr("data-background"),s=t.attr("data-src"),o=t.attr("data-srcset");h.loadImage(t[0],s||i,o,!1,function(){i?(t.css("background-image",'url("'+i+'")'),t.removeAttr("data-background")):(o&&(t.attr("srcset",o),t.removeAttr("data-srcset")),s&&(t.attr("src",s),t.removeAttr("data-src"))),t.addClass("swiper-lazy-loaded").removeClass("swiper-lazy-loading"),r.find(".swiper-lazy-preloader, .preloader").remove();if(h.params.loop&&n){var e=r.attr("data-swiper-slide-index");if(r.hasClass(h.params.slideDuplicateClass)){var u=h.wrapper.children('[data-swiper-slide-index="'+e+'"]:not(.'+h.params.slideDuplicateClass+")");h.lazy.loadImageInSlide(u.index(),!1)}else{var a=h.wrapper.children("."+h.params.slideDuplicateClass+'[data-swiper-slide-index="'+e+'"]');h.lazy.loadImageInSlide(a.index(),!1)}}h.emit("onLazyImageReady",h,r[0],t[0])}),h.emit("onLazyImageLoad",h,r[0],t[0])})},load:function(){var t;if(h.params.watchSlidesVisibility)h.wrapper.children("."+h.params.slideVisibleClass).each(function(){h.lazy.loadImageInSlide(e(this).index())});else if(h.params.slidesPerView>1)for(t=h.activeIndex;t<h.activeIndex+h.params.slidesPerView;t++)h.slides[t]&&h.lazy.loadImageInSlide(t);else h.lazy.loadImageInSlide(h.activeIndex);if(h.params.lazyLoadingInPrevNext)if(h.params.slidesPerView>1||h.params.lazyLoadingInPrevNextAmount&&h.params.lazyLoadingInPrevNextAmount>1){var n=h.params.lazyLoadingInPrevNextAmount,r=h.params.slidesPerView,i=Math.min(h.activeIndex+r+Math.max(n,r),h.slides.length),s=Math.max(h.activeIndex-Math.max(r,n),0);for(t=h.activeIndex+h.params.slidesPerView;t<i;t++)h.slides[t]&&h.lazy.loadImageInSlide(t);for(t=s;t<h.activeIndex;t++)h.slides[t]&&h.lazy.loadImageInSlide(t)}else{var o=h.wrapper.children("."+h.params.slideNextClass);o.length>0&&h.lazy.loadImageInSlide(o.index());var u=h.wrapper.children("."+h.params.slidePrevClass);u.length>0&&h.lazy.loadImageInSlide(u.index())}},onTransitionStart:function(){h.params.lazyLoading&&(h.params.lazyLoadingOnTransitionStart||!h.params.lazyLoadingOnTransitionStart&&!h.lazy.initialImageLoaded)&&h.lazy.load()},onTransitionEnd:function(){h.params.lazyLoading&&!h.params.lazyLoadingOnTransitionStart&&h.lazy.load()}},h.scrollbar={isTouched:!1,setDragPosition:function(e){var t=h.scrollbar,n=0,r=0,i,s=h.isHorizontal()?e.type==="touchstart"||e.type==="touchmove"?e.targetTouches[0].pageX:e.pageX||e.clientX:e.type==="touchstart"||e.type==="touchmove"?e.targetTouches[0].pageY:e.pageY||e.clientY,o=s-t.track.offset()[h.isHorizontal()?"left":"top"]-t.dragSize/2,u=-h.minTranslate()*t.moveDivider,a=-h.maxTranslate()*t.moveDivider;o<u?o=u:o>a&&(o=a),o=-o/t.moveDivider,h.updateProgress(o),h.setWrapperTranslate(o,!0)},dragStart:function(e){var t=h.scrollbar;t.isTouched=!0,e.preventDefault(),e.stopPropagation(),t.setDragPosition(e),clearTimeout(t.dragTimeout),t.track.transition(0),h.params.scrollbarHide&&t.track.css("opacity",1),h.wrapper.transition(100),t.drag.transition(100),h.emit("onScrollbarDragStart",h)},dragMove:function(e){var t=h.scrollbar;if(!t.isTouched)return;e.preventDefault?e.preventDefault():e.returnValue=!1,t.setDragPosition(e),h.wrapper.transition(0),t.track.transition(0),t.drag.transition(0),h.emit("onScrollbarDragMove",h)},dragEnd:function(e){var t=h.scrollbar;if(!t.isTouched)return;t.isTouched=!1,h.params.scrollbarHide&&(clearTimeout(t.dragTimeout),t.dragTimeout=setTimeout(function(){t.track.css("opacity",0),t.track.transition(400)},1e3)),h.emit("onScrollbarDragEnd",h),h.params.scrollbarSnapOnRelease&&h.slideReset()},enableDraggable:function(){var t=h.scrollbar,n=h.support.touch?t.track:document;e(t.track).on(h.touchEvents.start,t.dragStart),e(n).on(h.touchEvents.move,t.dragMove),e(n).on(h.touchEvents.end,t.dragEnd)},disableDraggable:function(){var t=h.scrollbar,n=h.support.touch?t.track:document;e(t.track).off(h.touchEvents.start,t.dragStart),e(n).off(h.touchEvents.move,t.dragMove),e(n).off(h.touchEvents.end,t.dragEnd)},set:function(){if(!h.params.scrollbar)return;var t=h.scrollbar;t.track=e(h.params.scrollbar),h.params.uniqueNavElements&&typeof h.params.scrollbar=="string"&&t.track.length>1&&h.container.find(h.params.scrollbar).length===1&&(t.track=h.container.find(h.params.scrollbar)),t.drag=t.track.find(".swiper-scrollbar-drag"),t.drag.length===0&&(t.drag=e('<div class="swiper-scrollbar-drag"></div>'),t.track.append(t.drag)),t.drag[0].style.width="",t.drag[0].style.height="",t.trackSize=h.isHorizontal()?t.track[0].offsetWidth:t.track[0].offsetHeight,t.divider=h.size/h.virtualSize,t.moveDivider=t.divider*(t.trackSize/h.size),t.dragSize=t.trackSize*t.divider,h.isHorizontal()?t.drag[0].style.width=t.dragSize+"px":t.drag[0].style.height=t.dragSize+"px",t.divider>=1?t.track[0].style.display="none":t.track[0].style.display="",h.params.scrollbarHide&&(t.track[0].style.opacity=0)},setTranslate:function(){if(!h.params.scrollbar)return;var e,t=h.scrollbar,n=h.translate||0,r,i=t.dragSize;r=(t.trackSize-t.dragSize)*h.progress,h.rtl&&h.isHorizontal()?(r=-r,r>0?(i=t.dragSize-r,r=0):-r+t.dragSize>t.trackSize&&(i=t.trackSize+r)):r<0?(i=t.dragSize+r,r=0):r+t.dragSize>t.trackSize&&(i=t.trackSize-r),h.isHorizontal()?(h.support.transforms3d?t.drag.transform("translate3d("+r+"px, 0, 0)"):t.drag.transform("translateX("+r+"px)"),t.drag[0].style.width=i+"px"):(h.support.transforms3d?t.drag.transform("translate3d(0px, "+r+"px, 0)"):t.drag.transform("translateY("+r+"px)"),t.drag[0].style.height=i+"px"),h.params.scrollbarHide&&(clearTimeout(t.timeout),t.track[0].style.opacity=1,t.timeout=setTimeout(function(){t.track[0].style.opacity=0,t.track.transition(400)},1e3))},setTransition:function(e){if(!h.params.scrollbar)return;h.scrollbar.drag.transition(e)}},h.controller={LinearSpline:function(e,t){this.x=e,this.y=t,this.lastIndex=e.length-1;var n,r,i=this.x.length;this.interpolate=function(e){return e?(r=s(this.x,e),n=r-1,(e-this.x[n])*(this.y[r]-this.y[n])/(this.x[r]-this.x[n])+this.y[n]):0};var s=function(){var e,t,n;return function(r,i){t=-1,e=r.length;while(e-t>1)r[n=e+t>>1]<=i?t=n:e=n;return e}}()},getInterpolateFunction:function(e){h.controller.spline||(h.controller.spline=h.params.loop?new h.controller.LinearSpline(h.slidesGrid,e.slidesGrid):new h.controller.LinearSpline(h.snapGrid,e.snapGrid))},setTranslate:function(e,n){function o(t){e=t.rtl&&t.params.direction==="horizontal"?-h.translate:h.translate,h.params.controlBy==="slide"&&(h.controller.getInterpolateFunction(t),s=-h.controller.spline.interpolate(-e));if(!s||h.params.controlBy==="container")i=(t.maxTranslate()-t.minTranslate())/(h.maxTranslate()-h.minTranslate()),s=(e-h.minTranslate())*i+t.minTranslate();h.params.controlInverse&&(s=t.maxTranslate()-s),t.updateProgress(s),t.setWrapperTranslate(s,!1,h),t.updateActiveIndex()}var r=h.params.control,i,s;if(h.isArray(r))for(var u=0;u<r.length;u++)r[u]!==n&&r[u]instanceof t&&o(r[u]);else r instanceof t&&n!==r&&o(r)},setTransition:function(e,n){function s(t){t.setWrapperTransition(e,h),e!==0&&(t.onTransitionStart(),t.wrapper.transitionEnd(function(){if(!r)return;t.params.loop&&h.params.controlBy==="slide"&&t.fixLoop(),t.onTransitionEnd()}))}var r=h.params.control,i;if(h.isArray(r))for(i=0;i<r.length;i++)r[i]!==n&&r[i]instanceof t&&s(r[i]);else r instanceof t&&n!==r&&s(r)}},h.hashnav={init:function(){if(!h.params.hashnav)return;h.hashnav.initialized=!0;var e=document.location.hash.replace("#","");if(!e)return;var t=0;for(var n=0,r=h.slides.length;n<r;n++){var i=h.slides.eq(n),s=i.attr("data-hash");if(s===e&&!i.hasClass(h.params.slideDuplicateClass)){var o=i.index();h.slideTo(o,t,h.params.runCallbacksOnInit,!0)}}},setHash:function(){if(!h.hashnav.initialized||!h.params.hashnav)return;document.location.hash=h.slides.eq(h.activeIndex).attr("data-hash")||""}},h.disableKeyboardControl=function(){h.params.keyboardControl=!1,e(document).off("keydown",P)},h.enableKeyboardControl=function(){h.params.keyboardControl=!0,e(document).on("keydown",P)},h.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()};if(h.params.mousewheelControl){try{new window.WheelEvent("wheel"),h.mousewheel.event="wheel"}catch(H){if(window.WheelEvent||h.container[0]&&"wheel"in h.container[0])h.mousewheel.event="wheel"}!h.mousewheel.event&&window.WheelEvent,!h.mousewheel.event&&document.onmousewheel!==undefined&&(h.mousewheel.event="mousewheel"),h.mousewheel.event||(h.mousewheel.event="DOMMouseScroll")}h.disableMousewheelControl=function(){return h.mousewheel.event?(h.container.off(h.mousewheel.event,B),!0):!1},h.enableMousewheelControl=function(){return h.mousewheel.event?(h.container.on(h.mousewheel.event,B),!0):!1},h.parallax={setTranslate:function(){h.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){j(this,h.progress)}),h.slides.each(function(){var t=e(this);t.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var e=Math.min(Math.max(t[0].progress,-1),1);j(this,e)})})},setTransition:function(t){typeof t=="undefined"&&(t=h.params.speed),h.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var n=e(this),r=parseInt(n.attr("data-swiper-parallax-duration"),10)||t;t===0&&(r=0),n.transition(r)})}},h._plugins=[];for(var F in h.plugins){var I=h.plugins[F](h,h.params[F]);I&&h._plugins.push(I)}return h.callPlugins=function(e){for(var t=0;t<h._plugins.length;t++)e in h._plugins[t]&&h._plugins[t][e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},h.emitterEventListeners={},h.emit=function(e){h.params[e]&&h.params[e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var t;if(h.emitterEventListeners[e])for(t=0;t<h.emitterEventListeners[e].length;t++)h.emitterEventListeners[e][t](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);h.callPlugins&&h.callPlugins(e,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},h.on=function(e,t){return e=q(e),h.emitterEventListeners[e]||(h.emitterEventListeners[e]=[]),h.emitterEventListeners[e].push(t),h},h.off=function(e,t){var n;e=q(e);if(typeof t=="undefined")return h.emitterEventListeners[e]=[],h;if(!h.emitterEventListeners[e]||h.emitterEventListeners[e].length===0)return;for(n=0;n<h.emitterEventListeners[e].length;n++)h.emitterEventListeners[e][n]===t&&h.emitterEventListeners[e].splice(n,1);return h},h.once=function(e,t){e=q(e);var n=function(){t(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),h.off(e,n)};return h.on(e,n),h},h.a11y={makeFocusable:function(e){return e.attr("tabIndex","0"),e},addRole:function(e,t){return e.attr("role",t),e},addLabel:function(e,t){return e.attr("aria-label",t),e},disable:function(e){return e.attr("aria-disabled",!0),e},enable:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(t){if(t.keyCode!==13)return;e(t.target).is(h.params.nextButton)?(h.onClickNext(t),h.isEnd?h.a11y.notify(h.params.lastSlideMessage):h.a11y.notify(h.params.nextSlideMessage)):e(t.target).is(h.params.prevButton)&&(h.onClickPrev(t),h.isBeginning?h.a11y.notify(h.params.firstSlideMessage):h.a11y.notify(h.params.prevSlideMessage)),e(t.target).is("."+h.params.bulletClass)&&e(t.target)[0].click()},liveRegion:e('<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'),notify:function(e){var t=h.a11y.liveRegion;if(t.length===0)return;t.html(""),t.html(e)},init:function(){h.params.nextButton&&h.nextButton&&h.nextButton.length>0&&(h.a11y.makeFocusable(h.nextButton),h.a11y.addRole(h.nextButton,"button"),h.a11y.addLabel(h.nextButton,h.params.nextSlideMessage)),h.params.prevButton&&h.prevButton&&h.prevButton.length>0&&(h.a11y.makeFocusable(h.prevButton),h.a11y.addRole(h.prevButton,"button"),h.a11y.addLabel(h.prevButton,h.params.prevSlideMessage)),e(h.container).append(h.a11y.liveRegion)},initPagination:function(){h.params.pagination&&h.params.paginationClickable&&h.bullets&&h.bullets.length&&h.bullets.each(function(){var t=e(this);h.a11y.makeFocusable(t),h.a11y.addRole(t,"button"),h.a11y.addLabel(t,h.params.paginationBulletMessage.replace(/{{index}}/,t.index()+1))})},destroy:function(){h.a11y.liveRegion&&h.a11y.liveRegion.length>0&&h.a11y.liveRegion.remove()}},h.init=function(){h.params.loop&&h.createLoop(),h.updateContainerSize(),h.updateSlidesSize(),h.updatePagination(),h.params.scrollbar&&h.scrollbar&&(h.scrollbar.set(),h.params.scrollbarDraggable&&h.scrollbar.enableDraggable()),h.params.effect!=="slide"&&h.effects[h.params.effect]&&(h.params.loop||h.updateProgress(),h.effects[h.params.effect].setTranslate()),h.params.loop?h.slideTo(h.params.initialSlide+h.loopedSlides,0,h.params.runCallbacksOnInit):(h.slideTo(h.params.initialSlide,0,h.params.runCallbacksOnInit),h.params.initialSlide===0&&(h.parallax&&h.params.parallax&&h.parallax.setTranslate(),h.lazy&&h.params.lazyLoading&&(h.lazy.load(),h.lazy.initialImageLoaded=!0))),h.attachEvents(),h.params.observer&&h.support.observer&&h.initObservers(),h.params.preloadImages&&!h.params.lazyLoading&&h.preloadImages(),h.params.autoplay&&h.startAutoplay(),h.params.keyboardControl&&h.enableKeyboardControl&&h.enableKeyboardControl(),h.params.mousewheelControl&&h.enableMousewheelControl&&h.enableMousewheelControl(),h.params.hashnav&&h.hashnav&&h.hashnav.init(),h.params.a11y&&h.a11y&&h.a11y.init(),h.emit("onInit",h)},h.cleanupStyles=function(){h.container.removeClass(h.classNames.join(" ")).removeAttr("style"),h.wrapper.removeAttr("style"),h.slides&&h.slides.length&&h.slides.removeClass([h.params.slideVisibleClass,h.params.slideActiveClass,h.params.slideNextClass,h.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),h.paginationContainer&&h.paginationContainer.length&&h.paginationContainer.removeClass(h.params.paginationHiddenClass),h.bullets&&h.bullets.length&&h.bullets.removeClass(h.params.bulletActiveClass),h.params.prevButton&&e(h.params.prevButton).removeClass(h.params.buttonDisabledClass),h.params.nextButton&&e(h.params.nextButton).removeClass(h.params.buttonDisabledClass),h.params.scrollbar&&h.scrollbar&&(h.scrollbar.track&&h.scrollbar.track.length&&h.scrollbar.track.removeAttr("style"),h.scrollbar.drag&&h.scrollbar.drag.length&&h.scrollbar.drag.removeAttr("style"))},h.destroy=function(e,t){h.detachEvents(),h.stopAutoplay(),h.params.scrollbar&&h.scrollbar&&h.params.scrollbarDraggable&&h.scrollbar.disableDraggable(),h.params.loop&&h.destroyLoop(),t&&h.cleanupStyles(),h.disconnectObservers(),h.params.keyboardControl&&h.disableKeyboardControl&&h.disableKeyboardControl(),h.params.mousewheelControl&&h.disableMousewheelControl&&h.disableMousewheelControl(),h.params.a11y&&h.a11y&&h.a11y.destroy(),h.emit("onDestroy"),e!==!1&&(h=null)},h.init(),h}return new t(r,i)};t.prototype={isSafari:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),isArray:function(e){return Object.prototype.toString.apply(e)==="[object Array]"},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1},device:function(){var e=navigator.userAgent,t=e.match(/(Android);?[\s\/]+([\d.]+)?/),n=e.match(/(iPad).*OS\s([\d_]+)/),r=e.match(/(iPod)(.*OS\s([\d_]+))?/),i=!n&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:n||i||r,android:t}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),flexbox:function(){var e=document.createElement("div").style,t="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" ");for(var n=0;n<t.length;n++)if(t[n]in e)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}()},plugins:{}};var n=function(){var e=function(e){var t=this,n=0;for(n=0;n<e.length;n++)t[n]=e[n];return t.length=e.length,this},t=function(t,n){var r=[],i=0;if(t&&!n&&t instanceof e)return t;if(t)if(typeof t=="string"){var s,o,u=t.trim();if(u.indexOf("<")>=0&&u.indexOf(">")>=0){var a="div";u.indexOf("<li")===0&&(a="ul"),u.indexOf("<tr")===0&&(a="tbody");if(u.indexOf("<td")===0||u.indexOf("<th")===0)a="tr";u.indexOf("<tbody")===0&&(a="table"),u.indexOf("<option")===0&&(a="select"),o=document.createElement(a),o.innerHTML=t;for(i=0;i<o.childNodes.length;i++)r.push(o.childNodes[i])}else{!n&&t[0]==="#"&&!t.match(/[ .<>:~]/)?s=[document.getElementById(t.split("#")[1])]:s=(n||document).querySelectorAll(t);for(i=0;i<s.length;i++)s[i]&&r.push(s[i])}}else if(t.nodeType||t===window||t===document)r.push(t);else if(t.length>0&&t[0].nodeType)for(i=0;i<t.length;i++)r.push(t[i]);return new e(r)};return e.prototype={addClass:function(e){if(typeof e=="undefined")return this;var t=e.split(" ");for(var n=0;n<t.length;n++)for(var r=0;r<this.length;r++)this[r].classList.add(t[n]);return this},removeClass:function(e){var t=e.split(" ");for(var n=0;n<t.length;n++)for(var r=0;r<this.length;r++)this[r].classList.remove(t[n]);return this},hasClass:function(e){return this[0]?this[0].classList.contains(e):!1},toggleClass:function(e){var t=e.split(" ");for(var n=0;n<t.length;n++)for(var r=0;r<this.length;r++)this[r].classList.toggle(t[n]);return this},attr:function(e,t){if(arguments.length===1&&typeof e=="string")return this[0]?this[0].getAttribute(e):undefined;for(var n=0;n<this.length;n++)if(arguments.length===2)this[n].setAttribute(e,t);else for(var r in e)this[n][r]=e[r],this[n].setAttribute(r,e[r]);return this},removeAttr:function(e){for(var t=0;t<this.length;t++)this[t].removeAttribute(e);return this},data:function(e,t){if(typeof t=="undefined"){if(this[0]){var n=this[0].getAttribute("data-"+e);return n?n:this[0].dom7ElementDataStorage&&e in this[0].dom7ElementDataStorage?this[0].dom7ElementDataStorage[e]:undefined}return undefined}for(var r=0;r<this.length;r++){var i=this[r];i.dom7ElementDataStorage||(i.dom7ElementDataStorage={}),i.dom7ElementDataStorage[e]=t}return this},transform:function(e){for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=e}return this},transition:function(e){typeof e!="string"&&(e+="ms");for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransitionDuration=n.MsTransitionDuration=n.msTransitionDuration=n.MozTransitionDuration=n.OTransitionDuration=n.transitionDuration=e}return this},on:function(e,n,r,i){function s(e){var i=e.target;if(t(i).is(n))r.call(i,e);else{var s=t(i).parents();for(var o=0;o<s.length;o++)t(s[o]).is(n)&&r.call(s[o],e)}}var o=e.split(" "),u,a;for(u=0;u<this.length;u++)if(typeof n=="function"||n===!1){typeof n=="function"&&(r=arguments[1],i=arguments[2]||!1);for(a=0;a<o.length;a++)this[u].addEventListener(o[a],r,i)}else for(a=0;a<o.length;a++)this[u].dom7LiveListeners||(this[u].dom7LiveListeners=[]),this[u].dom7LiveListeners.push({listener:r,liveListener:s}),this[u].addEventListener(o[a],s,i);return this},off:function(e,t,n,r){var i=e.split(" ");for(var s=0;s<i.length;s++)for(var o=0;o<this.length;o++)if(typeof t=="function"||t===!1)typeof t=="function"&&(n=arguments[1],r=arguments[2]||!1),this[o].removeEventListener(i[s],n,r);else if(this[o].dom7LiveListeners)for(var u=0;u<this[o].dom7LiveListeners.length;u++)this[o].dom7LiveListeners[u].listener===n&&this[o].removeEventListener(i[s],this[o].dom7LiveListeners[u].liveListener,r);return this},once:function(e,t,n,r){function s(o){n(o),i.off(e,t,s,r)}var i=this;typeof t=="function"&&(t=!1,n=arguments[1],r=arguments[2]),i.on(e,t,s,r)},trigger:function(e,t){for(var n=0;n<this.length;n++){var r;try{r=new window.CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0})}catch(i){r=document.createEvent("Event"),r.initEvent(e,!0,!0),r.detail=t}this[n].dispatchEvent(r)}return this},transitionEnd:function(e){function s(r){if(r.target!==this)return;e.call(this,r);for(n=0;n<t.length;n++)i.off(t[n],s)}var t=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],n,r,i=this;if(e)for(n=0;n<t.length;n++)i.on(t[n],s);return this},width:function(){return this[0]===window?window.innerWidth:this.length>0?parseFloat(this.css("width")):null},outerWidth:function(e){return this.length>0?e?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:this.length>0?parseFloat(this.css("height")):null},outerHeight:function(e){return this.length>0?e?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(this.length>0){var e=this[0],t=e.getBoundingClientRect(),n=document.body,r=e.clientTop||n.clientTop||0,i=e.clientLeft||n.clientLeft||0,s=window.pageYOffset||e.scrollTop,o=window.pageXOffset||e.scrollLeft;return{top:t.top+s-r,left:t.left+o-i}}return null},css:function(e,t){var n;if(arguments.length===1){if(typeof e!="string"){for(n=0;n<this.length;n++)for(var r in e)this[n].style[r]=e[r];return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(e)}if(arguments.length===2&&typeof e=="string"){for(n=0;n<this.length;n++)this[n].style[e]=t;return this}return this},each:function(e){for(var t=0;t<this.length;t++)e.call(this[t],t,this[t]);return this},html:function(e){if(typeof e=="undefined")return this[0]?this[0].innerHTML:undefined;for(var t=0;t<this.length;t++)this[t].innerHTML=e;return this},text:function(e){if(typeof e=="undefined")return this[0]?this[0].textContent.trim():null;for(var t=0;t<this.length;t++)this[t].textContent=e;return this},is:function(n){if(!this[0])return!1;var r,i;if(typeof n=="string"){var s=this[0];if(s===document)return n===document;if(s===window)return n===window;if(s.matches)return s.matches(n);if(s.webkitMatchesSelector)return s.webkitMatchesSelector(n);if(s.mozMatchesSelector)return s.mozMatchesSelector(n);if(s.msMatchesSelector)return s.msMatchesSelector(n);r=t(n);for(i=0;i<r.length;i++)if(r[i]===this[0])return!0;return!1}if(n===document)return this[0]===document;if(n===window)return this[0]===window;if(n.nodeType||n instanceof e){r=n.nodeType?[n]:n;for(i=0;i<r.length;i++)if(r[i]===this[0])return!0;return!1}return!1},index:function(){if(this[0]){var e=this[0],t=0;while((e=e.previousSibling)!==null)e.nodeType===1&&t++;return t}return undefined},eq:function(t){if(typeof t=="undefined")return this;var n=this.length,r;return t>n-1?new e([]):t<0?(r=n+t,r<0?new e([]):new e([this[r]])):new e([this[t]])},append:function(t){var n,r;for(n=0;n<this.length;n++)if(typeof t=="string"){var i=document.createElement("div");i.innerHTML=t;while(i.firstChild)this[n].appendChild(i.firstChild)}else if(t instanceof e)for(r=0;r<t.length;r++)this[n].appendChild(t[r]);else this[n].appendChild(t);return this},prepend:function(t){var n,r;for(n=0;n<this.length;n++)if(typeof t=="string"){var i=document.createElement("div");i.innerHTML=t;for(r=i.childNodes.length-1;r>=0;r--)this[n].insertBefore(i.childNodes[r],this[n].childNodes[0])}else if(t instanceof e)for(r=0;r<t.length;r++)this[n].insertBefore(t[r],this[n].childNodes[0]);else this[n].insertBefore(t,this[n].childNodes[0]);return this},insertBefore:function(e){var n=t(e);for(var r=0;r<this.length;r++)if(n.length===1)n[0].parentNode.insertBefore(this[r],n[0]);else if(n.length>1)for(var i=0;i<n.length;i++)n[i].parentNode.insertBefore(this[r].cloneNode(!0),n[i])},insertAfter:function(e){var n=t(e);for(var r=0;r<this.length;r++)if(n.length===1)n[0].parentNode.insertBefore(this[r],n[0].nextSibling);else if(n.length>1)for(var i=0;i<n.length;i++)n[i].parentNode.insertBefore(this[r].cloneNode(!0),n[i].nextSibling)},next:function(n){return this.length>0?n?this[0].nextElementSibling&&t(this[0].nextElementSibling).is(n)?new e([this[0].nextElementSibling]):new e([]):this[0].nextElementSibling?new e([this[0].nextElementSibling]):new e([]):new e([])},nextAll:function(n){var r=[],i=this[0];if(!i)return new e([]);while(i.nextElementSibling){var s=i.nextElementSibling;n?t(s).is(n)&&r.push(s):r.push(s),i=s}return new e(r)},prev:function(n){return this.length>0?n?this[0].previousElementSibling&&t(this[0].previousElementSibling).is(n)?new e([this[0].previousElementSibling]):new e([]):this[0].previousElementSibling?new e([this[0].previousElementSibling]):new e([]):new e([])},prevAll:function(n){var r=[],i=this[0];if(!i)return new e([]);while(i.previousElementSibling){var s=i.previousElementSibling;n?t(s).is(n)&&r.push(s):r.push(s),i=s}return new e(r)},parent:function(e){var n=[];for(var r=0;r<this.length;r++)e?t(this[r].parentNode).is(e)&&n.push(this[r].parentNode):n.push(this[r].parentNode);return t(t.unique(n))},parents:function(e){var n=[];for(var r=0;r<this.length;r++){var i=this[r].parentNode;while(i)e?t(i).is(e)&&n.push(i):n.push(i),i=i.parentNode}return t(t.unique(n))},find:function(t){var n=[];for(var r=0;r<this.length;r++){var i=this[r].querySelectorAll(t);for(var s=0;s<i.length;s++)n.push(i[s])}return new e(n)},children:function(n){var r=[];for(var i=0;i<this.length;i++){var s=this[i].childNodes;for(var o=0;o<s.length;o++)n?s[o].nodeType===1&&t(s[o]).is(n)&&r.push(s[o]):s[o].nodeType===1&&r.push(s[o])}return new e(t.unique(r))},remove:function(){for(var e=0;e<this.length;e++)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){var e=this,n,r;for(n=0;n<arguments.length;n++){var i=t(arguments[n]);for(r=0;r<i.length;r++)e[e.length]=i[r],e.length++}return e}},t.fn=e.prototype,t.unique=function(e){var t=[];for(var n=0;n<e.length;n++)t.indexOf(e[n])===-1&&t.push(e[n]);return t},t}(),r=["jQuery","Zepto","Dom7"];for(var i=0;i<r.length;i++)window[r[i]]&&o(window[r[i]]);var s;typeof n=="undefined"?s=window.Dom7||window.Zepto||window.jQuery:s=n,s&&("transitionEnd"in s.fn||(s.fn.transitionEnd=function(e){function s(r){if(r.target!==this)return;e.call(this,r);for(n=0;n<t.length;n++)i.off(t[n],s)}var t=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],n,r,i=this;if(e)for(n=0;n<t.length;n++)i.on(t[n],s);return this}),"transform"in s.fn||(s.fn.transform=function(e){for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=e}return this}),"transition"in s.fn||(s.fn.transition=function(e){typeof e!="string"&&(e+="ms");for(var t=0;t<this.length;t++){var n=this[t].style;n.webkitTransitionDuration=n.MsTransitionDuration=n.msTransitionDuration=n.MozTransitionDuration=n.OTransitionDuration=n.transitionDuration=e}return this})),window.Swiper=t}(),typeof module!="undefined"?module.exports=window.Swiper:typeof define=="function"&&define.amd&&define("lib-app/Swiper/swiper",[],function(){"use strict";return window.Swiper}),define("storymaps/tpl/ui/mobile/MobileFeatureList",["lib-build/css!./MobileFeatureList","lib-build/css!lib-app/Swiper/swiper.min","lib-app/Swiper/swiper"],function(){return function(t,n,r,i){function f(){$("#navThemeRight").on("click",function(){u.slideNext()}),$("#navThemeLeft").on("click",function(){u.slidePrev()})}function l(e){e===0&&u.slides.length>1?($("#navThemeLeft").css("display","none"),$("#navThemeRight").css("display","block")):e==u.slides.length-1?($("#navThemeRight").css("display","none"),$("#navThemeLeft").css("display","block")):($("#navThemeLeft").css("display","block"),$("#navThemeRight").css("display","block"))}function c(e){return $.grep($("ul.mobileTileList li"),function(t,n){return t.id=="item"+e})[0]}var s=i,o=!0,u=null,a=$("#mobileThemeBarSlider");app.scrollList,this.init=function(){u=new Swiper("#mobileThemeSliderContainer",{speed:0,direction:"horizontal"}),u.on("onSlideChangeEnd",function(e){$("#mobileThemeBar").css("visibility")=="visible"&&s.activateLayer(u.activeIndex),l(u.activeIndex),$("#mobileThemeBar").css("background-color",app.layerCurrent.color)}),f()},this.addTheme=function(e,t){var n='<div class="mobileThemeTitle swiper-slide"><p style="margin-top: 7px;">'+e.title+"</p></div>";$(a).append(n),u.update(),t&&($("#mobileThemeBar .swiper-container").css("display","none"),$("#navThemeLeft").css("display","none"),$("#navThemeRight").css("display","none"))},this.showMobileList=function(){$("#mobileFeature").css("visibility","hidden"),$("#mobileSupportedLayersView").css("visibility","hidden"),$("#mobileThemeBarSlider").css("display","block"),$("#mobilePaneList").css("visibility","visible"),$("#returnIcon").css("display","none"),$("#returnHiddenBar").css("display","none"),$("#centerMapIconContainer").css("display","none"),$("#navThemeLeft").css("visibility","visible"),$("#navThemeRight").css("visibility","visible"),s.selected&&(s.selected.symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),s.selected.symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),s.selected.symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),s.selected.draw()),s.selected=null,app.mapTips&&app.mapTips.clean(!0),$(".detailContainer").hide(),u.update()},this.selectTheme=function(e){o?u.slideTo(e,0):(u.slideTo(e,0),$("#mobileTitlePage").css("display","none")),o=!1,$("#mobileThemeBar").css("background-color",app.layerCurrent.color),l(e)},this.buildList=function(e,t,n){e===0&&$("#mobileList").empty();var r=$(n).clone();$(r).data("shortlist-id",t.attributes.shortlist_id);var i=t.attributes.thumb_url?t.attributes.thumb_url:t.attributes.pic_url,s=$('<div style="height: 75px; margin-bottom: 8px;"><img src="'+i+'"></div>');$(r).append(s),$("#mobilePaneList ul.mobileTileList li").on("tap",app.ui.tilePanel.tile_onClick),$("#mobilePaneList ul.mobileTileList li").on("click",app.ui.tilePanel.tile_onClick),$("#mobileList").append(r)},this.setColor=function(){if(app.isInBuilder)return;$("#mobileThemeBar").css("background-color",app.layerCurrent.color)},this.refreshMobileList=function(){var e,t=!1;app.layerCurrent&&app.layerCurrent.graphics.length&&setTimeout(function(){$.each(app.layerCurrent.graphics,function(n,r){e=c(r.attributes.shortlist_id),app.map.extent.contains(r.geometry)?($(e).css("display")=="none"&&$(e).css("display","block"),t=!0):$(e).css("display")!="none"&&$(e).css("display","none")}),$("#mobilePaneList").scrollTop(0),t?$(".noFeature").css("display","none"):$(".noFeature").css("display","block")},100)}}}),define("lib-build/css!storymaps/common/mapcontrols/command/MapCommand",[],function(){}),define("storymaps/common/mapcontrols/command/MapCommand",["lib-build/css!./MapCommand","dojo/has","esri/geometry/Point","dojo/on","esri/symbols/PictureMarkerSymbol","esri/layers/GraphicsLayer","esri/graphic","esri/config"],function(e,t,n,r,i,s,o,u){return function(a,f,l,c){function m(e){if(e)$(a.container).find(".mapCommandHomeBtn").addClass("loading"),h=Date.now();else{var t=Date.now()-h,n=0;t<450&&(n=450-t),setTimeout(function(){$(a.container).find(".mapCommandHomeBtn").removeClass("loading"),h=0},n)}}function g(){console.log("getDeviceLocation");var e=1e4,t=!1;setTimeout(function(){t||$(a.container).find(".mapCommandLocation").addClass("loading")},300),navigator.geolocation.getCurrentPosition(function(e){t=!0,$(a.container).find(".mapCommandLocation").removeClass("loading");var r=new n(e.coords.longitude,e.coords.latitude);l&&typeof l=="function"&&l(!0,r,e);if(a.spatialReference.wkid!=102100&&a.spatialReference.wkid!=4326){u.defaults.geometryService.project([r],a.spatialReference,function(e){if(!e||!e[0])return;y(e[0])});return}y(r)},function(e){t=!0,b(e)},{enableHighAccuracy:!0,maximumAge:12e4,timeout:e}),setTimeout(function(){t||b()},e)}function y(e){v.clear(),v.add(new o(e,d)),setTimeout(function(){$("#locateLayer_layer image").fadeOut({duration:800})},1e4)}function b(e){console.log("getDeviceLocationError",e),$(a.container).find(".mapCommandLocation").removeClass("loading"),l(!1,null)}var h=0,p=$('<div class="esriSimpleSliderIncrementButton"><div class="mapCommandHomeBtn"></div></div>'),d=new i("resources/common/icons/mapcommand-location-marker.png",21,21),v=new s({id:"locateLayer"});p.click(function(){if(h!==0&&$("body").hasClass("mobile-view"))return;f&&typeof f=="function"?f(a._params.extent):a.setExtent(a._params.extent)}),$(a.container).find(".esriSimpleSlider div:nth-child(1)").after(p),r(a,"update-start",function(){h===0&&m(!0)}),r(a,"update-end",function(){m(!1)}),this.setMobile=function(e){$(".esriSimpleSlider, .mapCommandHomeBtn",a.container).toggleClass("touch",!!e)},this.destroy=function(){$(a.container).find(".esriSimpleSliderIncrementButton").remove(),$(a.container).find(".mapCommandLocation").remove()},this.startLoading=function(){m(!0)},this.stopLoading=function(){m(!1)},this.enableLocationButton=function(e){$(a.container).toggleClass("has-locator",e),$(".mapCommandLocation",a.container).toggleClass("hidden",!e)},navigator&&navigator.geolocation&&($(".esriSimpleSlider",a.container).after('<div class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"></div>'),$(".mapCommandLocation",a.container).click(g),this.enableLocationButton(c),a.addLayer(v)),this.setMobile(app.appCfg.mapCommandLargerTouch||app.appCfg.mapCommandLargerTouch===undefined&&t("touch"))}}),define("lib-build/tpl!storymaps/common/mapcontrols/legend/Legend",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="legendContainer mapControls">\r\n	<div class="titleBtn">\r\n		<span class="collapseBtn">\r\n			<div class="glyphicon glyphicon-chevron-down"></div>\r\n			<div class="glyphicon glyphicon-chevron-up"></div>\r\n		</span>\r\n		'+((__t=title)==null?"":__t)+'\r\n	</div>\r\n	\r\n	<div class="content">\r\n		<div class="legendDijitContainer"></div>\r\n		',isInBuilder&&(__p+='\r\n			<div class="settingsGear glyphicon glyphicon-wrench"></div>\r\n			<div class="settingsOverlay">\r\n				<div class="settings-title">'+((__t=settings)==null?"":__t)+'</div>\r\n				<div class="settings-content">\r\n					<!-- Open by default -->\r\n					<div class="checkbox">\r\n						<label>\r\n							<input type="checkbox" class="expandStartup" />\r\n							'+((__t=openDefault)==null?"":__t)+"\r\n						</label>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		"),__p+="\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/mapcontrols/legend/Legend",[],function(){}),define("lib-build/css!storymaps/common/mapcontrols/Common",[],function(){}),define("storymaps/common/mapcontrols/legend/Legend",["lib-build/tpl!./Legend","lib-build/css!./Legend","lib-build/css!../Common","storymaps/common/utils/CommonHelper","esri/dijit/Legend","esri/arcgis/utils","dojo/topic"],function(e,t,n,r,i,s,o){return function(n,u,a){function d(){h.find(".legendDijitContainer").html('<div class="legendDijit"></div>'),l=new i({map:n.map,layerInfos:s.getLegendLayers(n)},h.find(".legendDijit")[0]),l.startup()}function v(){l&&l.destroy(),l=null}function m(){h.find(".legendContainer").toggleClass("collapsed"),h.find(".settingsOverlay").hide()}function g(){h.find(".titleBtn").click(m),h.find(".settingsGear").click(function(){h.find(".settingsOverlay").is(":visible")?h.off("mouseleave"):h.mouseleave(function(){h.find(".settingsOverlay").toggle(),h.off("mouseleave"),h.find(".content").removeClass("settingsOpen")}),h.find(".settingsOverlay").toggle(),h.find(".content").toggleClass("settingsOpen")}),h.find(".expandStartup").change(y),f.updatePlacementSettings(a)}function y(){c.openByDefault=h.find(".expandStartup").prop("checked"),o.publish("BUILDER_INCREMENT_COUNTER",1)}var f=this,l=null,c=null,h=a.container,p={isInBuilder:u,title:i18n.viewer.legendFromCommon.title};u&&(p.settings=i18n.commonMapControls.common.settings,p.openDefault=i18n.commonMapControls.common.openDefault),h.html(e(p)),this.toggle=function(e){h.toggle(!!e),e&&!l?d():e||v()},this.toggleExpanded=function(e){h.find(".legendContainer").toggleClass("collapsed",!e)},this.setColors=function(e){h.find(".legendContainer").css({backgroundColor:e.dotNav||e.mapControls,color:e.text}),h.find(".titleBtn").css("color",e.softText),h.find(".settingsGear, .collapseBtn").css("color",e.softBtn),r.addCSSRule(".mainMediaContainer .legendContainer ::-webkit-scrollbar-thumb { background-color:"+e.header+"; }","MapControlLegendDropdownScrollbar")},this.updatePlacementSettings=function(e){h.find(".legendContainer").toggleClass("isInlined",e.mode=="panel"),e.container[0]!=h[0]&&(e.container.html(h.find(".legendContainer")),h=e.container)},this.setSettings=function(e){c=e,h.find(".expandStartup").prop("checked",c.openByDefault)},g()}}),define("lib-build/tpl!storymaps/common/mapcontrols/overview/Overview",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="overviewContainer mapControls">\r\n	<div class="titleBtn">\r\n		<span class="collapseBtn">\r\n			<div class="glyphicon glyphicon-chevron-down"></div>\r\n			<div class="glyphicon glyphicon-chevron-up"></div>\r\n		</span>\r\n		'+((__t=title)==null?"":__t)+'\r\n	</div>\r\n	\r\n	<div class="content">\r\n		<div class="overviewMapContainer">\r\n			<!-- Map is injected here -->\r\n		</div>\r\n		',isInBuilder&&(__p+='\r\n			<div class="settingsGear glyphicon glyphicon-wrench"></div>\r\n			<div class="settingsOverlay">\r\n				<div class="settings-title">'+((__t=settings)==null?"":__t)+'</div>\r\n				<div class="settings-content">\r\n					<!-- Open by default -->\r\n					<div class="checkbox">\r\n						<label>\r\n							<input type="checkbox" class="expandStartup" />\r\n							'+((__t=openDefault)==null?"":__t)+'\r\n						</label>\r\n					</div>\r\n					\r\n					<!-- Basemap -->\r\n					<div class="btn-group dropup basemap-dropdown">\r\n						<button type="button" class="btn btn-default btn-sm dropdown-toggle basemapBtn" data-toggle="dropdown">\r\n							'+((__t=basemapGalleryBtnLabel)==null?"":__t)+' <span class="caret"></span>\r\n						</button>\r\n						<ul class="dropdown-menu basemaps dropdown-menu-form pull-right" role="menu"></ul>\r\n					</div>\r\n					<div id="basemapGallery"></div>\r\n			\r\n					<!-- Expand factor -->\r\n					<div class="spinnerLabel">\r\n						<label for="expandFactorSpinner">'+((__t=expandFactorLabel)==null?"":__t)+'</label>\r\n						<a class="locateBtnHelp" data-original-title="" title="">\r\n							<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;">\r\n						</a>\r\n					</div>\r\n					\r\n					<div class="input-group expandFactorSpinner">\r\n						<input type="text" class="form-control input-small input-xs" id="expandFactorSpinner" value="2">\r\n						<div class="input-group-btn-vertical">\r\n							<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-up"></i></button>\r\n							<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-down"></i></button>\r\n						</div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		'),__p+="\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/mapcontrols/overview/Overview",[],function(){}),define("storymaps/common/mapcontrols/overview/Overview",["lib-build/tpl!./Overview","lib-build/css!./Overview","lib-build/css!../Common","esri/dijit/OverviewMap","esri/dijit/BasemapGallery","esri/layers/ArcGISTiledMapServiceLayer","esri/arcgis/utils","dojo/Deferred","dojo/dom","dojo/on","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f,l){return function(n,i,s){function c(e){i.find(".overviewMapContainer").html('<div class="overviewMap"></div>'),o=new r({map:n,visible:!0,color:"transparent",opacity:1},i.find(".overviewMap")[0]),o.startup();var t=e?e.dotNav||e.header:a;t&&i.find(".ovwHighlight").css("border","3px solid "+t)}function h(){o&&o.destroy(),o=null}function p(){i.find(".overviewContainer").toggleClass("collapsed"),i.find(".settingsOverlay").hide()}function d(){i.find(".titleBtn").click(p),i.find(".settingsGear").click(function(){i.find(".settingsOverlay").is(":visible")?i.off("mouseleave"):i.mouseleave(function(){i.find(".settingsOverlay").toggle(),i.off("mouseleave")}),i.find(".settingsOverlay").toggle()}),i.find(".expandStartup").change(v)}function v(){u.openByDefault=i.find(".expandStartup").prop("checked"),l.publish("BUILDER_INCREMENT_COUNTER",1)}var o=null,u=null,a=null,f={isInBuilder:s,title:i18n.viewer.overviewFromCommon.title,overlayHeader:"",basemapGalleryBtnLabel:"",expandFactorLabel:""};s&&(f.settings=i18n.commonMapControls.common.settings,f.openDefault=i18n.commonMapControls.common.openDefault,f.basemapGalleryBtnLabel=i18n.commonMapControls.overview.basemapGalleryBtnLabel,f.expandFactorLabel=i18n.commonMapControls.overview.expandFactorLabel),i.append(e(f)),this.toggle=function(e,t){i.toggle(!!e),e&&!o?c(t):e||h()},this.toggleExpanded=function(e){i.find(".overviewContainer").toggleClass("collapsed",!e)},this.setColors=function(e){a=e.dotNav||e.mapControls,i.find(".overviewContainer").css({backgroundColor:a,color:e.text}),i.find(".titleBtn").css("color",e.softText),i.find(".settingsGear, .collapseBtn").css("color",e.softBtn),i.find(".ovwHighlight").css("border","3px solid "+a)},this.setSettings=function(e){u=e,i.find(".expandStartup").prop("checked",u.openByDefault)},d()}}),define("lib-build/tpl!storymaps/common/mapcontrols/geocoder/Geocoder",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="geocoderBtn">\r\n	<div class="geocoderContainer"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/mapcontrols/geocoder/Geocoder",[],function(){}),define("storymaps/common/mapcontrols/geocoder/Geocoder",["lib-build/tpl!./Geocoder","lib-build/css!./Geocoder","../../utils/CommonHelper"],function(e,t,n){return function(r,i,s){function a(){$(r.container).find(".esriSimpleSlider").last().after(e({})),o.toggle(s)}var o=this,u=null;this.toggle=function(e){var t=$(r.container).find(".geocoderBtn");u||n.createGeocoder({map:r,domNode:t.find(".geocoderContainer")[0],enableButtonMode:!0}).then(function(e){u=e,t.find(".esriGeocoderContainer input, .esriGeocoderSearch").attr("tabindex","-1")}),$(r.container).toggleClass("has-geocoder",e),t.toggle(e)},a()}}),define("lib-build/css!storymaps/common/utils/SocialSharing",[],function(){}),define("lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator",[],function(){}),define("lib-build/css!storymaps/tpl/ui/Common",[],function(){}),define("lib-build/css!storymaps/tpl/ui/mobile/Common",[],function(){}),define("lib-build/css!storymaps/tpl/ui/Responsive",[],function(){}),define("lib-build/css!storymaps/tpl/ui/desktop/MultiTips",[],function(){}),define("storymaps/tpl/core/MainView",["lib-build/css!./MainView","./Config","./Data","./WebApplicationData","./Helper","../ui/desktop/TestPanel","../ui/desktop/TilePanel","../ui/desktop/DetailPanel","../ui/desktop/NavBar","../ui/desktop/MultiTips","../ui/mobile/MobileIntro","../ui/mobile/MobileFeatureList","storymaps/common/mapcontrols/command/MapCommand","storymaps/common/mapcontrols/legend/Legend","storymaps/common/mapcontrols/overview/Overview","storymaps/common/mapcontrols/geocoder/Geocoder","lib-build/css!storymaps/common/ui/Modal.css","lib-build/css!storymaps/common/utils/SocialSharing.css","lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator.css","storymaps/common/utils/CommonHelper","dojo/has","dojo/topic","dojo/on","dojo/dom","dojo/DeferredList","dojo/_base/lang","esri/arcgis/utils","esri/geometry/Point","esri/geometry/screenUtils","esri/geometry/Extent","esri/SpatialReference","lib-build/css!../ui/Common","lib-build/css!../ui/mobile/Common","lib-build/css!../ui/Responsive","lib-build/css!../ui/desktop/MultiTips"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O){return function(s){function T(){app.data.getWebAppData().getGeneralOptions().bookmarks&&app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.itemData.bookmarks&&app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.itemData.bookmarks.length&&app.ui.navBar.initBookmarks(),app.data.getWebAppData().getWebmap()&&(app.mapItem=app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo);if(!app.map)return;setTimeout(function(){if(app.data.getWebAppData().getTabs()&&app.data.getWebAppData().getTabs()[0]&&app.data.getWebAppData().getTabs()[0].extent){var e=new A(app.data.getWebAppData().getTabs()[0].extent);setTimeout(function(){app.map.setExtent(e,!0)},500)}else app.isDirectCreationFirstSave?app.map.centerAndZoom([0,0],3):setTimeout(function(){app.map.setExtent(app.map._params.extent,!0)},500);app.map.on("extent-change",function(){setTimeout(function(){app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder?(app.ui.tilePanel.refreshList(),app.ui.mobileFeatureList.refreshMobileList(),app.ui.detailPanel.loaded&&(app.ui.detailPanel.refreshSlides(),v.selected&&setTimeout(function(){app.ui.detailPanel.loaded&&app.ui.detailPanel.showDetails(v.selected)},0))):app.ui.detailPanel.loaded&&v.selected&&setTimeout(function(){app.ui.detailPanel.loaded&&app.ui.detailPanel.showDetails(v.selected)},0)},0)}),app.isDirectCreation||setTimeout(function(){p.displayApp()},500)},750),app.ui.mobileIntro.setTitle(),r.getTabs()&&$.each(r.getTabs(),function(e,t){app.data.setStory(e,t.title,t.color,t.extent)});var e=$.grep(app.map.graphicsLayerIds,function(e){return e.split("_").slice(0,-1).join("_")==r.getShortlistLayerId()?e:e==r.getShortlistLayerId()?e:!1});app.data.setShortlistLayerId(e[0]),app.map||setTimeout(function(){},500),app.map.loaded?k():app.map.on("load",function(){k()}),s&&s.storyDataReady()}function k(){app.map.resize(),app.map.on("click",function(e){app.mapTips&&(e.graphic?v.selected&&(v.selected.hidden=!1):(app.mapTips.clean(!0),v.selected&&!app.isInBuilder&&(v.selected.hidden=!0)))});var e=[];$.each(r.getTabs(),function(t,n){e.push({features:[],title:n.title,color:n.color,extent:n.extent})});var t=app.map.getLayer(app.data.getWebAppData().getShortlistLayerId())?app.data.getWebAppData().getShortlistLayerId():app.data.getWebAppData().getShortlistLayerId()+"_0";app.data.getWebAppData().setShortlistLayerId(t);var n=app.map.getLayer(app.data.getWebAppData().getShortlistLayerId());$.each(n.graphics,function(t,n){n.attributes.locationSet&&n.attributes.name&&n.attributes.name!="Unnamed Place"&&n.attributes.pic_url&&!app.isInBuilder?e[n.attributes.tab_id].features.push(n):app.isInBuilder&&e[n.attributes.tab_id].features.push(n)}),n.on("mouse-over",v.layer_onMouseOver),n.on("mouse-out",v.layer_onMouseOut),n.on("click",v.layer_onClick);var i=[];$.each(app.map.graphicsLayerIds,function(e,t){t!==n.id&&i.push(app.map.getLayer(t))}),$.each(i,function(e,t){t.on("click",j)});if(e.length>1||app.isInBuilder&&!app.isDirectCreationFirstSave){$("#divStrip").height("35px"),$.each(e,function(t,n){app.ui.tilePanel.createTab(t,n),app.ui.mobileIntro.fillList(t,n,e),app.ui.mobileFeatureList.addTheme(n);var r=app.cfg.COLOR_ORDER.split(","),i=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name.toLowerCase()==$.trim(r[t].toLowerCase())})[0],s=n.color||i.color;v.buildLayer(n.features.sort(z),s);if(app.isInBuilder){app.data.setStory(t,n.title,i.color,n.extent);var o=N.clone(app.data.getStory());$.each(o,function(e,t){t.title=n.title,t.color=s}),app.detailPanelBuilder.addDetailPanelSwiper(t)}app.data.setStory(t,n.title,n.color)});if(!app.isDirectCreationFirstSave){var s={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:"#999",tabTextHover:"#fff",tabHover:"#666"},o=0;app.ui.navBar.init(e,o,s,r),app.ui.tilePanel.setTabClick()}}else{if(e.length<1)return!1;$.each(e,function(e,t){app.ui.tilePanel.createTab(e,t),app.ui.mobileFeatureList.addTheme(t);var n=app.cfg.COLOR_ORDER.split(","),r=$.grep(app.cfg.COLOR_SCHEMES,function(t){return t.name.toLowerCase()==$.trim(n[e].toLowerCase())})[0],i=t.color||r.color;v.buildLayer(t.features.sort(z),i);if(app.isInBuilder){app.data.setStory(e,t.title,r.color);var s=N.clone(app.data.getStory());$.each(s,function(e,n){n.title=t.title,n.color=i}),app.detailPanelBuilder.addDetailPanelSwiper(e)}}),$(".tab").css("display","none"),$("#mobileIntro").append("<br><hr></hr>"),$("#mobileIntro").append('<ul id="mobileThemeList" class="mobileTileList">');var u=$('<li class="mobileTitleTheme" onclick="app.ui.mobileIntro.selectMobileTheme(0)">').append('<div class="startButton"> Start </div>');$("#mobileThemeList").append(u),$("#navThemeLeft").addClass("hideButtons"),$("#navThemeRight").addClass("hideButtons"),$("#nav-bar").show(),$("#nav-bar .entries").hide(),$("#bookmarksCon").css({top:0})}p.handleWindowResize(),v.activateLayer(0),app.isInBuilder&&app.detailPanelBuilder.buildSlides(),$(".entryLbl").css("outline-style","none"),$("#zoomToggle").css("visibility","visible"),$("#whiteOut").fadeOut("slow"),$("body").width()>768?($("#paneLeft").height($("#contentPanel").height()-$("#tabs").height()),$("#paneLeft").css("top",$("#divStrip").height()),$("#map").height($("#contentPanel").height()),$("#map").css("top",0),$(".tilelist").height($("#paneLeft").height()-25)):app.ui.mobileIntro.resizeMobileElements(),p.appInitComplete(r),$("body").on("mousedown","*",function(e){($(this).is(":focus")||$(this).is(e.target))&&$(this).css("outline-style")=="none"&&($(this).css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}),$(this).parents("#bookmarksToggle").length&&$(this).parents("#bookmarksToggle").css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}))}),app.map.disableKeyboardNavigation(),$("body").keypress(function(e){e.which==13&&$(document.activeElement).click(),e.which==43&&(app.map.setLevel(app.map.getLevel()+1),$("#zoomIn").focus(),v.hideBookmarks()),e.which==45&&(app.map.setLevel(app.map.getLevel()-1),$("#zoomOut").focus(),v.hideBookmarks())}),app.map.reorderLayer(app.data.getWebAppData().getShortlistLayerId(),app.map.graphicsLayerIds.length-1)}function M(){if(v.selected.symbol.width==app.cfg.lutIconSpecs.large.getWidth())return;v.selected.symbol.setWidth(app.cfg.lutIconSpecs.large.getWidth()),v.selected.symbol.setHeight(app.cfg.lutIconSpecs.large.getHeight()),v.selected.symbol.setOffset(app.cfg.lutIconSpecs.large.getOffsetX(),app.cfg.lutIconSpecs.large.getOffsetY()),v.selected.draw(),setTimeout(function(){try{v.selected.getShape().moveToFront()}catch(e){console.log("problem with 'moveToFront()'...")}},10)}function _(e,t){var n=t*4,r=e.data;return[r[n],r[n+1],r[n+2],r[n+3]]}function D(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function P(e,t,n){var r=(new esri.symbol.PictureMarkerSymbol(t.toDataURL(),n.getWidth(),n.getHeight())).setOffset(n.getOffsetX(),n.getOffsetY());return r}function H(e){if(d.isMobile())return;app.map.setMapCursor("pointer");var t=e.graphic,n={};n.geometry=L.toMapPoint(app.map.extent,app.map.width,app.map.height,e.screenPoint),v.buildMapSupportHoverTips(t.attributes.name,n)}function B(){if(d.isMobile())return;app.map.setMapCursor("default"),app.mapTips.clean()}function j(e){v.selected=null,$("#mobileTitlePage").css("display","none");var t=$(".esriPopup")[0];if(app.ui.mobileIntro.screenSize!="small")app.map.infoWindow.on("set-features",function(){$(t).show()}),app.mapTips&&app.mapTips.clean();else{$(t).hide();var n=e.graphic,r={};r.geometry=L.toMapPoint(app.map.extent,app.map.width,app.map.height,e.screenPoint),v.buildMapSupportHoverTips(n.attributes.name,r)}}function F(){var e=[],t=[];$.each(app.map.graphicsLayerIds,function(t,n){e.push(app.map.getLayer(n))});var n={bookmarks:!1,bookmarksAlias:"Zoom",extentMode:"customHome",filterByExtent:!0,numberedIcons:!1};app.data.getWebAppData().setGeneralOptions(n),$.each(app.map.layerIds,function(t,n){var r=app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.itemData.baseMap.baseMapLayers,i=$.grep(r,function(e){return e.id==n});i[0]||e.push(app.map.getLayer(n))});var i=[],o=[],u,a=null,f;$.each(e,function(e,n){n.layerType?f=n.layerType:f=n.type,n.geometryType=="esriGeometryPoint"&&n.id.toLowerCase().indexOf("mapnotes")==-1&&t.push(n),n.url&&(f==="ArcGISFeatureLayer"||f==="Feature Layer")&&!n.id.match(/^csv_/)&&(u=!0,a=n,i.push(n.url),o.push(e))});var l=app.data.getWebMap().item.extent,c=new A(l[0][0],l[0][1],l[1][0],l[1][1],new O({wkid:4326}));app.map.setExtent(c,!0),app.map._params.extent=new A(JSON.parse(JSON.stringify(app.map.extent.toJson()))),app.data.getWebAppData().setMapExtent(c),$(".builder-share").css("pointer-events","none").css("cursor","default").css("opacity","0.5");if(!t.length){var h={};s.initPopupComplete(h),app.detailPanelBuilder.init(app.ui.mainView,s),app.data.getWebAppData().setTitle(app.data.getResponse().itemInfo.item.title),app.data.getWebAppData().setSubtitle(app.data.getResponse().itemInfo.item.description),app.ui.headerDesktop.setTitleAndSubtitle(app.data.getWebAppData().getTitle(),app.data.getWebAppData().getSubtitle());if(app.data.getResponse().itemInfo.itemData.bookmarks&&app.data.getResponse().itemInfo.itemData.bookmarks.length){var d={extentMode:"default",numberedIcons:!1,filterByExtent:!0,bookmarks:!0,bookmarksAlias:"Zoom"};app.data.getWebAppData().setGeneralOptions(d),app.ui.navBar.initBookmarks()}p.appInitComplete(r)}else $.each(t,function(t,n){var r=e.indexOf(n);e.splice(r,1)}),s.openMigrationPopup(t,e),$("#loadingIndicator").hide(),clearTimeout(app.loadingTimeout),app.loadingTimeout=null}function I(){if(!r.isBlank())p.appInitComplete(r);else if(app.isInBuilder&&app.data.getWebAppData().getWebmap()){var e=v.loadWebmap(app.data.getWebAppData().getWebmap(),"map");e.then(function(t){app.data.setResponse(t),app.maps[t.itemInfo.item.id]=v.getMapConfig(t),app.map=e.results[0].map,app.data.setWebMap(e.results[0].itemInfo),s.updateUI(),F()}),p.isProd()?s.showInitPopup():p.portalLogin().then()}if(s&&!app.data.getWebAppData().getWebmap()){var e=v.loadWebmap(s.buildWebMap(),"map");e.then(function(t){app.data.setResponse(t),app.map=e.results[0].map,app.data.setWebMap(e.results[0].itemInfo),app.maps[t.itemInfo.item.id]=v.getMapConfig(t),s.updateUI(),p.appInitComplete(r),s.storyDataReady(),p.displayApp()})}}function q(e){var t={objectIdField:"__OBJECTID",geometryType:"esriGeometryPoint",drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Shapes/GreenDiamondLargeB.png",width:15,height:15}}},fields:e};return t}function R(e){return e.url?e.featureCollection.featureSet:e.featureCollection.layers[0].featureSet}function U(e){return e.url?e.id:e.id}function z(e,t){var n=e.attributes.number||e.attributes.shortlist_id,r=t.attributes.number||t.attributes.shortlist_id;return n<r?-1:n>r?1:0}function W(){E.publish("CORE_UPDATE_EXTENT",new A(app.data.getWebAppData().getMapExtent()))}var p=null,d=new i,v=this,m=!1,g,y,S,x=0;this.init=function(e){p=e;if(app.isInBuilder&&w("ie")&&w("ie")<10)return i18n.viewer.errors.noBuilderIE=i18n.viewer.errors.noBuilderIE.replace("%VERSION%",10).replace("%UPGRADE%",i18n.viewer.errors.upgradeBrowser),p.initError("noBuilderIE"),!1;if(w("ie")&&w("ie")<=8)return i18n.viewer.errors.noViewerIE=i18n.viewer.errors.noViewerIE.replace("%VERSION%",9).replace("%UPGRADE%",i18n.viewer.errors.upgradeBrowser),p.initError("noViewerIE"),!1;app.data=new n,S=document.createElement("canvas"),g=S.getContext("2d"),y=new Image,y.src=app.cfg.ICON_SRC,y.onload=function(){g.drawImage(y,0,0),g.font=S.width/2+"pt Calibri"},v.themeSelected=!1,app.ui.mainView=this,app.ui.tilePanel=new o($("#contentPanel"),v,r,app.isInBuilder),setTimeout(function(){app.ui.detailPanel=new u($("#paneLeft"),app.isInBuilder,r,v,r),app.ui.detailPanel.init()},100),app.ui.navBar=new a($("#nav-bar"),app.isInBuilder,v.activateLayer,s),app.ui.tilePanel.init(),app.ui.mobileIntro=new l($("body"),app.isInBuilder,function(){},v),app.ui.mobileFeatureList=new c($("#contentPanel"),app.isInBuilder,function(){},v),app.ui.mobileIntro.init(),app.ui.mobileFeatureList.init();var t={},i=esri.urlToObject(document.location.href).query;return i&&$.each(i,function(e,n){t[e.toLowerCase()]=n}),$("body").on("mousedown","*",function(e){($(this).is(":focus")||$(this).is(e.target))&&$(this).css("outline-style")=="none"&&$(this).css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")})}),!0},this.webAppConfigLoaded=function(){app.isGalleryCreation=!app.data.getWebAppData().getOriginalData()||!Object.keys(app.data.getWebAppData().getOriginalData().values).length},this.loadFirstWebmap=function(e){return this.loadWebmap(e,$("#map")[0])},this.loadWebmapFromData=function(){T()},this.loadWebmap=function(e,t,n){console.log("tpl.core.MainView - loadWebMap - webmapId:",e);var r=new esri.dijit.Popup({highlight:!1},dojo.create("div"));return C.createMap(e,t,{mapOptions:{slider:!0,autoResize:!1,showAttribution:!0,infoWindow:r,extent:n,wrapAround180:!1},usePopupManager:!0,bingMapsKey:app.cfg.BING_MAPS_KEY,editable:!1,layerMixins:app.data.getAppProxies()})},this.firstWebmapLoaded=function(){T()},this.startFromScratch=function(){I()},this.getMapConfig=function(e){return{response:e,mapCommand:new h(e.map,W,p.zoomToDeviceLocation,app.data.getWebAppData().getLocateBtn())}},this.activateLayer=function(e){var t=[],n=app.map.getLayer(app.data.getShortlistLayerId());$.each(n.graphics,function(n,r){r.attributes.tab_id==e?app.isInBuilder&&r.attributes.locationSet||r.attributes.locationSet&&r.attributes.name&&r.attributes.name!="Unnamed Place"&&r.attributes.pic_url?(r.show(),t.push(r)):(app.isInBuilder&&t.push(r),r.hide()):r.hide()});var i=new esri.layers.GraphicsLayer;i.graphics=t;var s=app.data.getStory()[e].color;i.color=s,app.layerCurrent=i,app.layerCurrent.color=app.data.getStory()[e].color,n.redraw(),app.ui.mobileFeatureList.setColor(),app.mapTips&&app.mapTips.clean(!0),v.preSelection(),v.selected=null,v.postSelection();if(!$.isEmptyObject(app.cfg.TAB_SPECIFIC_SUPPORT_LAYERS)){var o=r.getSupportLayers(),u="tab"+String(e+1),a=app.cfg.TAB_SPECIFIC_SUPPORT_LAYERS[u];$.each(o,function(e,t){a&&a.indexOf(t.name)>-1?t.setVisibility(!0):t.setVisibility(!1)})}$(".detailContainer").hide(),app.ui.tilePanel.buildTilePanel(),app.ui.navBar.showEntryIndex(e),b.addCSSRule(".nav-bar .entry.active > .entryLbl, 					.nav-bar .dropdown.active .dropdown-toggle { 						background-color: "+app.data.getStory()[e].color+" !important; 					}","NavBarActive"),$("#paneLeft").css("border-top-color",app.data.getStory()[e].color),$(".detailHeader").css("border-top-color",app.data.getStory()[e].color);var f=e===0?500:100;setTimeout(function(){app.isInBuilder||app.ui.detailPanel.buildFeatureViews()},f),app.isInBuilder&&app.addFeatureBar.updateLocatedFeatures()},this.unselect=function(){v.preSelection(),v.selected=null,v.postSelection()},this.preSelection=function(){v.selected&&v.selected.symbol&&v.selected.symbol.setWidth&&(v.selected.symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),v.selected.symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),v.selected.symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),v.selected.draw(),app.mapTips&&app.mapTips.clean(!0))},this.postSelection=function(){if(v.selected==null)app.map.infoWindow.hide();else{if(!v.selected.attributes.locationSet&&!app.isInBuilder)return;!app.map.extent.contains(v.selected.geometry)&&v.selected.attributes.locationSet&&app.map.centerAt(v.selected.geometry),setTimeout(function(){v.buildMapTips()},250),app.isInBuilder?app.detailPanelBuilder.showSlide(v.selected.attributes.shortlist_id):app.ui.detailPanel.showDetails(v.selected),app.ui.mobileIntro.hide(),app.ui.mobileFeatureList.setColor()}},this.buildMapTips=function(e){setTimeout(function(){if(!v.selected||!v.selected.attributes||v.selected.hidden||!v.selected.attributes.locationSet){app.mapTips&&app.mapTips.clean(!0);return}if(app.mapTips&&!app.map.extent.contains(v.selected.geometry)&&app.data.getWebAppData().getGeneralOptions().filterByExtent&&!app.isInBuilder){app.mapTips.clean(!0);return}if($("body").hasClass("mobile-view")){app.mapTips&&app.mapTips.clean(!0),v.selected&&M();return}e&&app.mapTips.clean(!0),v.selected.attributes.name||(v.selected.attributes.name="Unnamed Place");var t=e?e:v.selected.attributes.name;app.mapTips=new f({map:app.map,content:t,selected:v.selected&&v.selected.hidden!==!0?v.selected:null,pointArray:[v.selected],labelDirection:"auto",backgroundColor:app.cfg.SELECTED_POPUP_BACKGROUND_COLOR,borderColor:app.cfg.SELECTED_POPUP_BORDER_COLOR,pointerColor:app.cfg.SELECTED_POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:44,topLeftNotAuthorizedArea:[40,180],mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0}),M()},100)},this.buildMapHoverTips=function(e,t){if(app.mapTips&&($("body").hasClass("mobile-view")||!t.attributes.locationSet)){app.mapTips.clean(!0);return}var n=t==v.selected?44:33;t.attributes.name||(t.attributes.name="Unnamed Place"),app.mapTips=new f({map:app.map,content:e,selected:v.selected&&v.selected.hidden!==!0?v.selected:null,pointArray:[t],labelDirection:"auto",backgroundColor:app.cfg.POPUP_BACKGROUND_COLOR,borderColor:app.cfg.POPUP_BORDER_COLOR,pointerColor:app.cfg.POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:n,topLeftNotAuthorizedArea:[40,180],mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0})},this.buildMapSupportHoverTips=function(e,t){if(app.mapTips&&$("body").hasClass("mobile-view")){app.mapTips.clean(!0);return}app.mapTips=new f({map:app.map,content:e,selected:v.selected&&v.selected.hidden!==!0?v.selected:null,pointArray:[t],labelDirection:"auto",backgroundColor:app.cfg.POPUP_BACKGROUND_COLOR,borderColor:app.cfg.POPUP_BORDER_COLOR,pointerColor:app.cfg.POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:5,topLeftNotAuthorizedArea:[40,180],mapAuthorizedMinWidth:-1,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0})},this.moveGraphicToFront=function(e){var t=e.getDojoShape();t&&t.moveToFront()},this.buildLayer=function(e,t){var n=app.cfg.lutIconSpecs.tiny,i;$.each(e,function(e,s){var o=document.createElement("canvas");o.width=y.width,o.height=y.height;var u=o.getContext("2d");u.font="bold "+o.width/3.8+"pt Calibri",u.drawImage(S,0,0);var a=t;if(!i){var f=u.getImageData(0,0,S.width,S.height),l=_(f,4804);if(l[0]!=D(a).r&&l[1]!=D(a).g&&l[1]!=D(a).b){for(var c=0;c<f.data.length;c+=4)f.data[c]==l[0]&&f.data[c+1]==l[1]&&f.data[c+2]==l[2]&&(f.data[c]=D(a).r,f.data[c+1]=D(a).g,f.data[c+2]=D(a).b);u.putImageData(f,0,0)}i=f}e>0&&u.putImageData(i,0,0);if(r.getGeneralOptions().numberedIcons){var h=s.attributes.number;u.textAlign="center",u.fillStyle="white",u.fillText(h,o.width/3.2,o.height/2)}s.setSymbol(P(e,o,n))})},this.layer_onClick=function(e){if($("body").hasClass("pickLocation"))return;m=!0,v.preSelection(),v.selected=null,v.selected=e.graphic,v.postSelection(),$("#mobileTitlePage").css("display","none");var t=$(".esriPopup");$(t).hide(),setTimeout(function(){m=!1},500),v.themeSelected||app.ui.mobileFeatureList.selectTheme(0),v.themeSelected=!0},this.layer_onMouseOver=function(e){if(m||$("body").hasClass("pickLocation"))return;if(d.isMobile())return;app.map.setMapCursor("pointer");var t=e.graphic,n=app.map.toScreen(t.geometry);if(t==v.selected&&v.selected.hidden!==!0&&$("#header").css("display")=="block")return;if(t!=v.selected||v.selected.hidden!==!0)t.symbol.setWidth(app.cfg.lutIconSpecs.medium.getWidth()),t.symbol.setHeight(app.cfg.lutIconSpecs.medium.getHeight()),t.symbol.setOffset(app.cfg.lutIconSpecs.medium.getOffsetX(),app.cfg.lutIconSpecs.medium.getOffsetY()),t.draw(),d.isIE()||v.moveGraphicToFront(t);v.buildMapHoverTips(t.attributes.name,t)},this.layer_onMouseOut=function(e){if($("body").hasClass("pickLocation"))return;if(d.isMobile())return;app.map.setMapCursor("default");var t=e.graphic;t!=v.selected&&(t.symbol.setWidth(app.cfg.lutIconSpecs.tiny.getWidth()),t.symbol.setHeight(app.cfg.lutIconSpecs.tiny.getHeight()),t.symbol.setOffset(app.cfg.lutIconSpecs.tiny.getOffsetX(),app.cfg.lutIconSpecs.tiny.getOffsetY()),t.draw()),app.mapTips&&app.mapTips.clean()},this.updateUI=function(){},this.resize=function(e){app.isInBuilder&&(app.initScreenIsOpen=!0);if(!e.isMobileView){app.isInBuilder&&$("#mobileBuilderOverlay").css("display")=="block"&&app.addFeatureBar.loaded&&$("#mobileBuilderOverlay").attr("style","display: none !important"),app.ui.mobileIntro.screenSize="desktop",$("#navThemeLeft").css("visibility","hidden"),$("#navThemeRight").css("visibility","hidden"),$("#mobileBookmarksCon").hide();var t=$("body").height(),n=0;$(".mainViewAboveMap, .mainViewBelowMap").each(function(e,t){var r=$(t);n+=r.is(":visible")?r.outerHeight():0}),$("#contentPanel").height(t-n),$("#paneLeft").height($("#contentPanel").height()-$("#tabs").height());var r=app.data.getWebAppData().getHeader().compactSize?"60px":"110px";$("#header").height(r),$(".tilelist").height($("#paneLeft").height()-(app.isInBuilder?70:48)),$(".tilelist").css("top",app.isInBuilder?60:38),$("#paneLeft .noFeature").width($("#paneLeft").width()),$("#paneLeft").width()==app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN?$("#paneLeft .noFeatureText").css("margin-left","50px"):$("#paneLeft .noFeatureText").css("margin-left","150px"),$("#map").height(e.height),$("#map").css("top",0),app.ui.navBar.resize(),e.width<=app.cfg.TWO_COLUMN_THRESHOLD||e.width<=1024&&e.height<=768?(setTimeout(function(){$("#mainStagePanel").width(e.width-(app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN+16)),$("#mainStagePanel").css("left",app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN+16),app.map&&app.map.resize(),v.selected&&!app.map.extent.contains(v.selected.geometry)&&app.mapTips.clean(!0)},0),app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_TWO_COLUMN),app.isInBuilder?app.detailPanelBuilder.resize():app.ui.detailPanel.resize()):e.width<=app.cfg.THREE_COLUMN_THRESHOLD&&e.width>=app.cfg.TWO_COLUMN_THRESHOLD?(setTimeout(function(){$("#mainStagePanel").width(e.width-(app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN+16)),$("#mainStagePanel").css("left",app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN+16),app.map&&app.map.resize()},0),app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_THREE_COLUMN),app.isInBuilder?app.detailPanelBuilder.resize():app.ui.detailPanel.resize()):(setTimeout(function(){$("#mainStagePanel").width(e.width-(app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN+16)),$("#mainStagePanel").css("left",app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN+16),app.map&&app.map.resize()},0),app.ui.tilePanel.resize(app.cfg.LEFT_PANE_WIDTH_FOUR_COLUMN),app.isInBuilder?app.detailPanelBuilder.resize():app.ui.detailPanel.resize())}else app.isInBuilder&&$("#mobileBuilderOverlay").attr("style","display: block !important"),app.ui.mobileIntro.resizeMobileElements(),app.cfg.BOOKMARKS&&$("#mobileBookmarksCon").show(),$("#header").height("0"),app.mapTips&&app.mapTips.hide(),(x<2||$("#mobileIntro").css("display")=="block")&&W();x++},this.setMapExtent=function(e,t){return p.setMapExtent(e,t)},this.getLayoutExtent=function(e){return e},this.checkConfigFileIsOK=function(){return t.checkConfigFileIsOK()},this.appInitComplete=function(){this.updateUI(),p.cleanLoadingTimeout(),$(window).resize();var e=app.data.getWebAppData().isBlank()||app.data.getWebAppItem().access=="private";app.ui.headerDesktop&&app.ui.headerDesktop.toggleSocialBtnAppSharing(e),E.publish("tpl-ready")},this.onHashChange=function(){},this.prepareMobileViewSwitch=function(){},this.initLocalization=function(){}}}),define("lib-build/css!storymaps/common/builder/Builder",[],function(){}),define("lib-build/tpl!storymaps/common/builder/BuilderPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<h3 class="appTitle"><!--'+((__t=title)==null?"":__t)+'--></h3>\r\n<div class="buttons btn-group">\r\n	<div class="builder-cmd builder-settings">'+((__t=btnSettings)==null?"":__t)+'</div>\r\n	<div class="builder-cmd builder-share" data-title="'+((__t=tooltipFirstSave)==null?"":__t)+'" data-placement="bottom">'+((__t=btnShare)==null?"":__t)+'</div>\r\n	<div class="builder-cmd builder-preview" data-title="'+((__t=tooltipNotShared)==null?"":__t)+'" data-placement="bottom">'+((__t=btnPreview)==null?"":__t)+'</div>\r\n	<div class="builder-cmd builder-help">'+((__t=btnHelp)==null?"":__t)+'</div>\r\n</div>\r\n<div class="status-bar">\r\n	<div class="status-bar-info">\r\n		<span class="status-msg"></span>\r\n		<span class="status-btns">\r\n			<button class="btn btn-warning check-story"></button>\r\n			<button type="button" class="btn btn-default builder-save disabled" tabindex="-1">'+((__t=btnSave)==null?"":__t)+'</button>\r\n		</span>\r\n	</div>\r\n</div>\r\n<div class="builder-mask"></div>';return __p}}),define("lib-build/css!storymaps/common/builder/BuilderPanel",[],function(){}),define("lib-build/tpl!storymaps/common/builder/SaveErrorPopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			'+((__t=content)==null?"":__t)+'\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<button type="button" class="btn btn-primary" data-dismiss="modal">'+((__t=btnOk)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/SaveErrorPopup",[],function(){}),define("storymaps/common/builder/SaveErrorPopup",["lib-build/tpl!./SaveErrorPopup","lib-build/css!./SaveErrorPopup","../utils/CommonHelper","dojo/Deferred","dojo/i18n!commonResources/nls/core.js?v="+app.version],function(e,t,n,r,i){return function(n){n.append(e({title:i.commonCore.saveError.title,content:i.commonCore.saveError.err1Div1+"<br /><br />"+i.commonCore.saveError.err1Div2,btnOk:i.commonCore.saveError.btnOk})),this.present=function(){var e=new r;return n.on("hide.bs.modal",function(){e.resolve()}),n.modal({keyboard:!0}),e}}}),define("lib-build/tpl!storymaps/common/builder/SaveErrorPopupSocial",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="panel1">\r\n				'+((__t=panel1)==null?"":__t)+'\r\n				<a href="#" class="help" data-toggle="tooltip">\r\n					<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\r\n				</a>\r\n			</div>\r\n			<div class="panel2">\r\n				<div class="panel2lbl">'+((__t=panel2)==null?"":__t)+'</div>\r\n				<div class="form-group">\r\n					<div class="radio">\r\n						<label>\r\n							<input type="radio" name="optErrorSocial" value="story" checked>\r\n							<span>\r\n								'+((__t=panel2q1)==null?"":__t)+'\r\n								<a href="#" class="help" data-toggle="tooltip" title="'+((__t=panel2q1tooltip)==null?"":__t)+'">\r\n									<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\r\n								</a>\r\n							</span>\r\n						</label>\r\n					</div>\r\n					<div class="radio">\r\n						<label>\r\n							<input type="radio" name="optErrorSocial" value="item">\r\n							<span>'+((__t=panel2q2)==null?"":__t)+'</span>\r\n						</label>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div class="panel3">'+((__t=panel3)==null?"":__t)+'</div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<div class="stop-asking">\r\n				<div class="checkbox">\r\n					<label class="disabled">\r\n						<input type="checkbox" value="" disabled>\r\n						'+((__t=panel4)==null?"":__t)+'\r\n					</label>\r\n				</div>\r\n			</div>\r\n			<button type="button" class="btn btn-primary">'+((__t=btnSave)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/SaveErrorPopupSocial",[],function(){}),define("storymaps/common/builder/SaveErrorPopupSocial",["lib-build/tpl!./SaveErrorPopupSocial","lib-build/css!./SaveErrorPopupSocial","../utils/CommonHelper","storymaps/tpl/core/WebApplicationData","dojo/Deferred","dojo/i18n!commonResources/nls/core.js?v="+app.version],function(e,t,n,r,i,s){return function(o){function a(){o.find("input[name='optErrorSocial']").change(function(){var e=o.find("input[name='optErrorSocial']:checked").val();e=="story"?(o.find(".stop-asking input").attr("disabled","disabled").prop("checked",!1),o.find(".stop-asking label").addClass("disabled")):(o.find(".stop-asking input").removeAttr("disabled"),o.find(".stop-asking label").removeClass("disabled"))}),o.find(".btn-primary").click(function(){o.find(".stop-asking input").is(":checked")&&r.setDoNotWarnTitle(!0),u.resolve({choice:o.find("input[name='optErrorSocial']:checked").val()}),o.modal("hide")})}var u=null;o.append(e({title:s.commonCore.saveErrorSocial.title,panel1:s.commonCore.saveErrorSocial.panel1,panel2:s.commonCore.saveErrorSocial.panel2,panel2q1:s.commonCore.saveErrorSocial.panel2q1,panel2q1tooltip:s.commonCore.saveErrorSocial.panel2q1tooltip,panel2q2:s.commonCore.saveErrorSocial.panel2q2,panel3:s.commonCore.saveErrorSocial.panel3.replace("${MYSTORIES}",'<a href="'+n.getMyStoriesURL()+'" target="_blank">'+s.commonCore.common.mystories+"</a>"),panel4:s.commonCore.saveErrorSocial.panel4,btnSave:s.commonCore.common.save})),a(),this.present=function(){return u=new i,o.find(".panel1 .help").tooltip({title:s.commonCore.saveErrorSocial.panel1tooltip+'<img src="resources/tpl/builder/icons/builder-help-social.png"/>',html:!0,placement:"right"}),o.find(".panel2 .help").tooltip(),o.modal({keyboard:!1}),u}}}),define("storymaps/common/builder/BuilderPanel",["lib-build/tpl!./BuilderPanel","lib-build/css!./BuilderPanel","dojo/i18n!commonResources/nls/core.js?v="+app.version,"storymaps/common/utils/CommonHelper","./SaveErrorPopup","./SaveErrorPopupSocial","dojo/topic"],function(e,t,n,r,i,s,o){return function(u,a,f,l){function v(){console.log("common.builder.Builder - save");if(u.find(".builder-save").hasClass("disabled")){app.appCfg.noAppTitleInitScreen&&!app.data.getWebAppData().getTitle()&&$("#headerDesktop").find(".title").addClass("titleEmpty");return}u.find(".builder-save").addClass("saving").html('<span class="small-loader"></span>'+n.commonCore.builderPanel.buttonSaving),T(!1);if(app.isDirectCreationFirstSave){var e=app.data.getWebAppData().getTitle(),t=app.data.getWebAppData().getSubtitle();if(!e){c.saveFailed("NONAME");return}app.portal.getPortalUser().getItems().then(function(r){var i=!1;r&&$.each(r,function(t,n){n.title&&n.title.toLowerCase()==e.toLowerCase()&&(i=!0)}),i?(u.find(".builder-save").removeClass("saving").html(n.commonCore.common.save),p.present().then(function(){app.appCfg.useStandardHeader?app.ui.headerDesktop.setTitleError():app.builder.openEditPopup({sectionIndex:0,displayTab:"main-stage"})})):f(e,t)})}else if(app.appCfg.useWebmapInApp&&app.isGalleryCreation)l();else{var r="",i="";app.data.getWebAppData().getTitle()&&(r=app.data.getWebAppData().getTitle().trim()),app.data.getWebAppItem()&&app.data.getWebAppItem().title&&(i=app.data.getWebAppItem().title.trim());if(!app.builder.titleMatchOnLoad&&!app.data.getWebAppData().getDoNotWarnTitle()&&app.data.getWebAppItem().access=="public"&&r!=i)app.builder.titleMatchDialogDisplayed?a(app.builder.titleFromItem):(app.builder.titleMatchDialogDisplayed=!0,d.present().then(function(e){app.builder.titleFromItem=e&&e.choice=="item",a(app.builder.titleFromItem)}));else{var s=app.data.getWebAppData().getDoNotWarnTitle()||app.data.getWebAppItem().access!="public"&&!app.builder.titleMatchOnLoad;a(s)}}}function m(){E(),h.openSettingPopup(!1)}function g(){E(),o.publish("OPEN_HELP")}function y(){$(this).hasClass("disabled")||window.open(r.getAppViewModeURL()+"&preview","_blank")}function b(){$(this).hasClass("disabled")||app.builder.openSharePopup(!1)}function w(){u.find(".save-counter").removeClass("pendingChanges").html(n.commonCore.builderPanel.noPendingChange),u.find(".builder-save").addClass("disabled")}function E(){u.find(".builder-save").tooltip("hide")}function S(){var e="#"+u.attr("id");u.find(".builder-save").tooltip("destroy"),u.find(".builder-save").tooltip({html:!0,trigger:"manual",placement:"left",title:'<script>$("'+e+' .builder-save").next(".tooltip").addClass("save-fail-popover");'+'$("'+e+' .builder-save").next(".tooltip").find(".stepHidden").css("display", "none");'+"</script>"+'<div class="stepHidden stepFailed" style="color: red; width: 180px;">'+n.commonCore.builderPanel.saveError+" "+'<button type="button" class="btn btn-xs" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">'+n.commonCore.common.close+"</button> "+"</div>"})}function x(){u.find(".builder-save").tooltip("hide")}function T(){c.updateSharingStatus(),c.resize()}function N(){u.find(".status-msg").show(),app.isDirectCreationFirstSave||app.isGalleryCreation?u.find(".status-msg").html(n.commonCore.builderPanel.status6):app.mystories&&app.mystories.hasCheckErrors?app.data.getWebAppItem().access=="public"?u.find(".status-msg").html(n.commonCore.builderPanel.status1):app.data.getWebAppItem().access=="account"?u.find(".status-msg").html(n.commonCore.builderPanel.status1):u.find(".status-msg").html(n.commonCore.builderPanel.status2):app.data.getWebAppItem().access=="public"?u.find(".status-msg").html(n.commonCore.builderPanel.status3):app.data.getWebAppItem().access=="account"?u.find(".status-msg").html(n.commonCore.builderPanel.status4):u.find(".status-msg").html(n.commonCore.builderPanel.status5),c.resize()}function C(){app.builder.openSharePopup()}function k(e){var t=u.find(".check-story");app.data.getStoryLength()?e=="start"?(t.html('<span class="small-loader"></span>'+n.commonCore.builderPanel.checking).show().css("cursor","default").off("click"),u.find(".status-msg").hide()):e=="error"?(t.html(n.commonCore.builderPanel.fix).show().css("cursor","pointer").click(C),c.updateSharingStatus()):(t.hide(),c.updateSharingStatus()):t.hide()}function L(){}u.append(e({title:n.commonCore.builderPanel.panelHeader.replace("%TPL_NAME%",app.cfg.TPL_NAME),btnSave:n.commonCore.common.save,btnShare:n.commonCore.builderPanel.buttonShare,btnSettings:n.commonCore.builderPanel.buttonSettings,btnHelp:n.commonCore.builderPanel.buttonHelp,btnPreview:n.commonCore.builderPanel.buttonPreview,tooltipFirstSave:n.commonCore.builderPanel.tooltipFirstSave,tooltipNotShared:n.commonCore.builderPanel.tooltipNotShared2,saveCounter:n.commonCore.builderPanel.noPendingChange}));var c=this,h=null,p=null,d=null;this.init=function(e){h=e,p=new i($("#saveErrorPopup")),d=new s($("#saveErrorPopupSocial")),L(),u.removeClass("hide"),app.builder.hideSaveConfirmation=x,u.find(".builder-save").click(v),u.find(".builder-share").click(b),u.find(".builder-settings").click(m),u.find(".builder-help").click(g),u.find(".builder-preview").click(y),$(window).bind("keydown",function(e){(e.ctrlKey||e.metaKey)&&String.fromCharCode(e.which).toLowerCase()=="s"&&!u.find(".builder-save").attr("disabled")&&!app.initScreenIsOpen&&(e.preventDefault(),v())}),S(),o.subscribe("MYSTORIES_SCAN",k),k("start")},this.saveSucceeded=function(){(app.isDirectCreationFirstSave||app.isGalleryCreation)&&app.builder.openSharePopup(!0),w(),T(!0),u.find(".builder-save").html('<span class="glyphicon glyphicon-ok"></span> '+n.commonCore.builderPanel.buttonSaved),setTimeout(function(){u.find(".builder-save").removeClass("saving").html(n.commonCore.common.save)},3500)},this.saveFailed=function(){u.find(".builder-save").removeClass("saving").html(n.commonCore.common.save),u.find(".builder-save").tooltip("show"),u.find(".builder-save").next(".tooltip").find(".stepFailed").css("display","block"),T(!0)},this.hasPendingChange=function(){return!u.find(".builder-save").hasClass("disabled")},this.incrementSaveCounter=function(){var e="";e=n.commonCore.builderPanel.unSavedChangePlural,u.find(".save-counter").addClass("pendingChanges").html(e),u.find(".builder-save").toggleClass("disabled",app.isDirectCreationFirstSave&&!app.data.getStoryLength()||!app.data.getWebAppData().getTitle()),app.isDirectCreationFirstSave&&app.data.getStoryLength()&&u.find(".status-bar").removeClass("hideCounterAndSharing")},this.updateSharingStatus=function(){var e=app.isDirectCreationFirstSave||app.isGalleryCreation||app.isWebMapCreation,t=app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared";u.find(".builder-share").toggleClass("disabled",!!e),u.find(".builder-preview").tooltip("destroy").removeClass("disabled"),e?u.find(".builder-share").tooltip({trigger:"hover"}):u.find(".builder-share").tooltip("destroy"),e?u.find(".builder-preview").addClass("disabled").tooltip({trigger:"hover",title:n.commonCore.builderPanel.tooltipFirstSave}):t?u.find(".builder-preview").tooltip({trigger:"hover",title:n.commonCore.builderPanel.tooltipNotShared2}):u.find(".builder-preview").tooltip("destroy"),app.ui.headerDesktop&&app.ui.headerDesktop.toggleSocialBtnAppSharing(t),app.ui.mobileHeader&&app.ui.mobileHeader.toggleSocialBtnAppSharing(t),N()},this.resize=function(){u.find(".status-msg").css("max-width",$(window).width()-(u.find(".buttons").position().left+u.find(".buttons").outerWidth()+u.find(".status-btns").outerWidth()+20))}}}),define("lib-build/tpl!storymaps/common/builder/settings/SettingsPopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h3 class="modal-title"></h3>\r\n		</div>\r\n		<ul class="settingsPopupHeader modal-tabs nav nav-tabs">\r\n			<!-- Tab injected here -->\r\n		</ul>\r\n		<div class="modal-body">\r\n			<!-- Views injected here -->\r\n		</div>\r\n		<div class="modal-footer">\r\n			<span class="error"></span>\r\n			<button class="btnSave btn btn-primary" data-dismiss="modal"></button>\r\n			<button class="btnClose btn btn-naked btn-close" data-dismiss="modal" aria-hidden="true"></button>\r\n		</div>\r\n	</div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/settings/SettingsPopup",[],function(){}),define("storymaps/common/builder/settings/SettingsPopup",["lib-build/tpl!./SettingsPopup","lib-build/css!./SettingsPopup","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r){var i=null;return function(s){function c(){if($(this).hasClass("disabled"))return;p($(this).index())}function h(){var e=[],t=-1;$.each(o,function(n,r){var i=r.save();i===!1&&(t=n),e.push(i)});if(t!=-1)return p(t),!1;r.publish("SETTINGS_POPUP_SAVE",{settings:e})}function p(e){u.removeClass("active disabled"),a.hide(),u.eq(e).addClass("active"),o[e].show(),a.eq(e).show(),i=e}s.append(e({}));var o=[],u=null,a=s.find(".tab-content"),f=s.find(".btnSave"),l=s.find(".btnClose");this.init=function(e){o=e.getSettingsTab(),s.find(".settingsPopupHeader").empty(),s.find(".modal-body").empty(),$.each(o,function(){s.find(".settingsPopupHeader").append('<li class="tab"><a></a></li>'),s.find(".modal-body").append('<div class="tab-content"></div>')}),u=s.find(".tab"),a=s.find(".tab-content"),$.each(o,function(e,t){t.init(u.eq(e).find("a"),a.eq(e)),t.initLocalization()}),u.click(c),f.click(h)},this.present=function(e,t){var r=0,a=!app.isProduction&&n.getUrlParams().debugParam?n.getUrlParams().debugParam:null;u.removeClass("disabled"),l.removeAttr("disabled"),$(".error-msg",s).hide(),$(".modal-header .close",s).attr("data-dismiss","modal"),$(".modal-footer .error",s).hide(),$.each(o,function(n,r){r.present(e[n],n==t)}),t?r=t:a?r=a:i&&(r=i),p(r),t&&(u.addClass("disabled"),u.eq(t).removeClass("disabled"),l.attr("disabled","disabled"),$(".modal-header .close",s).attr("data-dismiss","none")),s.modal({keyboard:!t})},this.initLocalization=function(){s.find(".modal-title").html(i18n.commonCore.settings.header),s.find(".btnClose").html(i18n.commonCore.common.cancel),s.find(".btnSave").html(i18n.commonCore.common.apply),s.find(".error").html(i18n.commonCore.settings.tabError)}}}),define("storymaps/common/builder/BuilderHelper",[],function(){return{getBlankAppJSON:function(){return{itemType:"text",guid:null,name:null,type:"Web Mapping Application",typeKeywords:app.cfg.WEBAPP_KEYWORD_GENERIC.concat(app.cfg.WEBAPP_KEYWORD_APP),description:null,tags:app.cfg.WEBAPP_TAG,snippet:null,thumbnail:"thumbnail/ago_downloaded.png",documentation:null,extent:[],lastModified:-1,spatialReference:null,accessInformation:null,licenseInfo:null,culture:"en-us",properties:null,size:116,appCategories:[],industries:[],languages:[],largeThumbnail:null,banner:null,screenshots:[],listed:!1,ownerFolder:null,commentsEnabled:!0,numComments:0,numRatings:0,avgRating:0,numViews:1}},getBlankWebmapJSON:function(){return{item:{id:"",guid:null,name:null,type:"Web Map",typeKeywords:app.cfg.WEBMAP_KEYWORD,description:null,tags:app.cfg.WEBMAP_TAG,snippet:null,thumbnail:"thumbnail/ago_downloaded.png",documentation:null,extent:[[-180,-90],[180,90]],spatialReference:null,accessInformation:null,licenseInfo:null,culture:"en-us",properties:null,url:null,size:233,appCategories:[],industries:[],languages:[],largeThumbnail:null,banner:null,screenshots:[],listed:!1,ownerFolder:null,commentsEnabled:!0,numComments:0,numRatings:0,avgRating:0,numViews:1},itemData:{operationalLayers:[],baseMap:{baseMapLayers:[{id:"defaultBasemap",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer"}],title:"Topographic"},version:"1.9"}}}}}),define("storymaps/common/utils/WebMapHelper",["esri/request","esri/renderers/jsonUtils","dojo/Deferred","dojo/_base/lang","dojo/_base/array"],function(e,t,n,r,i){return{findLayerTypeById:function(e,t){var n="";return i.forEach(e.operationalLayers,function(e){e.id==t&&(n=e.type)}),n},saveWebmap:function(e,t){var i=new n;this.prepareWebmapItemForCloning(e);var s=r.clone(e.item),o=r.clone(e.itemData);s.tags=s.tags?s.tags.join(","):"",s.typeKeywords=s.typeKeywords?s.typeKeywords.join(","):"";var u=t.getPortalUser(),a=this.getSharingURL(t)+"content/users/"+u.credential.userId+(s.ownerFolder?"/"+s.ownerFolder:"")+"/addItem",f={item:s.item,title:s.title,tags:s.tags,extent:JSON.stringify(s.extent),text:JSON.stringify(o),type:s.type,typeKeywords:s.typeKeywords,overwrite:!0,thumbnailURL:s.thumbnailURL};return this.request(a,f,!0).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},serializeGraphicsLayerToFeatureCollection:function(e){return this._serializeGraphicsLayerToFeatureCollection(e,e.visible,e.graphics)},_serializeGraphicsLayerToFeatureCollection:function(e,t,n){var r={layers:[{featureSet:{features:[],geometryType:e.geometryType},id:e.id,layerDefinition:{geometryType:e.geometryType,objectIdField:e.objectIdField,name:e.name,type:e.type,typeIdField:e.typeIdField,drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",contentType:"image/png",width:15,height:15}}},fields:[],types:[],capabilities:e.capabilities},layerObject:null,opacity:e.opacity,visibility:t}],showLegend:!0};return $.each(e.fields,function(e,t){r.layers[0].layerDefinition.fields.push({name:t.name,alias:t.alias,type:t.type,editable:t.editable,domain:null})}),$.each(n,function(e,t){r.layers[0].featureSet.features.push({attributes:t.attributes,geometry:t.geometry})}),r},request:function(t,n,i,s){var o=i||!1;return n=n||{},s=s||"",e({url:t,content:r.mixin(n,{f:"json",token:s}),callbackParamName:"callback",handleAs:"json"},{usePost:o})},prepareWebmapItemForCloning:function(e){i.forEach(e.itemData.baseMap.baseMapLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo}),i.forEach(e.itemData.operationalLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo,e.featureCollection&&e.featureCollection.layers&&i.forEach(e.featureCollection.layers,function(e){delete e.layerObject}),e.featureCollection&&e.featureCollection.featureSet&&e.featureCollection.featureSet.features&&i.forEach(e.featureCollection.featureSet.features,function(e){delete e._shape,delete e._graphicsLayer}),e.type=="CSV"&&e.featureCollection&&delete e.featureCollection,i.forEach(e.layers,function(e){delete e.drawingInfo,e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer&&(e.layerDefinition.drawingInfo.renderer=t.fromJson(e.layerDefinition.drawingInfo.renderer).toJson())}),e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer&&(e.layerDefinition.drawingInfo.renderer=t.fromJson(e.layerDefinition.drawingInfo.renderer).toJson())})},getSharingURL:function(e){var t=e.portalUrl;return t.match("/sharing/rest/$")?t=t.split("/").slice(0,-2).join("/")+"/":t.match("/sharing/rest$")?t=t.split("/").slice(0,-1).join("/")+"/":t.match("/sharing$")&&(t+="/"),t}}}),define("storymaps/common/builder/Builder",["lib-build/css!./Builder","esri/arcgis/Portal","./BuilderPanel","./settings/SettingsPopup","./BuilderHelper","./MyStoriesWrapper","../utils/CommonHelper","../utils/WebMapHelper","dojo/_base/lang","dojo/_base/array","dojo/has","esri/arcgis/utils","esri/IdentityManager","esri/request","dojo/topic","lib-app/history.min"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function b(e,t){v=e,m=t,y=new r($("#settingsPopup")),console.log("common.builder.Builder - init");if(!o.getAppID(v.isProd())&&!app.isDirectCreation){console.error("common.builder.Builder - abort builder initialization, no appid supplied");return}app.isDirectCreation?console.log("common.builder.Builder - Builder start in direct creation mode"):app.isGalleryCreation&&console.log("common.builder.Builder - Builder start in gallery creation mode"),$("body").addClass("builder-mode"),m.init(y),g.init(m),y.init(m),y.initLocalization(),d.subscribe("BUILDER_INCREMENT_COUNTER",g.incrementSaveCounter),d.subscribe("HEADER_EDITED",S),d.subscribe("BUILDER-MY-STORIES-CHECK",s.scanStory),window.onbeforeunload=function(e){e=e||window.event;if(!g.hasPendingChange())return;return e&&(e.returnValue=i18n.commonCore.builderPanel.closeWithPendingChange),i18n.commonCore.builderPanel.closeWithPendingChange},app.builder.cleanApp=D}function w(){var e="",t="";app.data.getWebAppData().getTitle()&&(e=app.data.getWebAppData().getTitle().trim()),app.data.getWebAppItem()&&app.data.getWebAppItem().title&&(t=app.data.getWebAppItem().title.trim()),app.builder.titleMatchOnLoad=t==e,app.data.getWebAppData().isBlank()&&(app.builder.titleMatchOnLoad=!0),g.updateSharingStatus(),m.appInitComplete()}function E(e){g.resize(),m.resize(e)}function S(e){if(!e.src)return;e.value==i18n.commonCore.inlineFieldEdit.editMe&&(e.value=""),e.src=="title"?!app.data.getWebMap()||e.value!=app.data.getWebMap().item.title?e.value!=app.data.getWebAppData().getTitle()&&(app.data.getWebAppData().setTitle(e.value),g.incrementSaveCounter()):app.data.getWebAppData().setTitle(""):e.src=="subtitle"&&(!app.data.getWebMap()||e.value!=app.data.getWebMap().item.snippet?e.value!=app.data.getWebAppData().getSubtitle()&&(app.data.getWebAppData().setSubtitle(e.value),g.incrementSaveCounter()):app.data.getWebAppData().setSubtitle(""))}function x(e){if(!app.portal){console.error("Fatal error - not signed in"),M("APP");return}app.portal.signIn().then(function(){C(e,function(e){if(!e||!e.success){M("APP");return}k(function(e){if(!e||!e.success){M("WEBMAP");return}O({success:!0})})})},function(e){M("APP",e)})}function T(e,t){if(!app.portal){console.error("Fatal error - not signed in"),M("APP");return}var n=h.findCredential(_()).userId;app.data.setWebAppItem(a.mixin(i.getBlankAppJSON(),{title:e,snippet:t,uploaded:Date.now(),modified:Date.now(),owner:n,access:"private"}));var r=function(e){if(!e||!e.success){M("APP");return}var t=document.location.protocol+"//"+document.location.host+document.location.pathname;t.match(/index\.html$/)||(t+="index.html"),app.data.setWebAppItem(a.mixin(app.data.getWebAppItem(),{id:e.id,item:e.item,url:t+"?appid="+e.id})),app.isDirectCreationOpenData&&(app.data.getWebAppItem().tags.push("open-data-favorite"),app.data.getWebAppItem().properties={content:"story map",datasetType:"story map",url:t+"?appid="+e.id});var n=function(){C(!1,function(e){if(!e||!e.success){M("APP");return}console.log("common.builder.Builder - firstSaveForDirectCreation - appid:",e.id," webmap:",null),O({success:!0}),app.isDirectCreationFirstSave=!1,g.updateSharingStatus(),History.replaceState({},"","index.html?appid="+e.id+"&edit")})};if(app.isDirectCreationOpenData){var r=app.portal.getPortalUser().favGroupId,i=_()+"/sharing/rest/content/items/"+e.id+"/share";p({url:i,handleAs:"json",content:{everyone:!1,org:!1,groups:r,items:e.id}},{usePost:!0}).then(n,n)}else n()};app.portal.signIn().then(function(){if(app.appCfg.webmapStory){var i=app.data.getWebMap();a.mixin(i.item,{title:e,snippet:t,uploaded:Date.now(),modified:Date.now(),owner:n,access:"private"}),k(function(e){if(!e||!e.success){M("WEBMAP");return}app.data.getWebAppData().setWebmap(e.id);var t=app.data.getWebMap();a.mixin(t.item,{id:e.id,item:e.item}),C(!1,r)})}else C(!1,r)},function(e){M("APP",e)})}function N(){if(!app.portal){console.error("Fatal error - not signed in"),M("APP");return}var e=h.findCredential(_()).userId,t=app.data.getWebMap();a.mixin(t.item,{title:app.data.getWebMap().item.title?app.data.getWebMap().item.title:app.data.getWebAppItem().title,uploaded:Date.now(),modified:Date.now(),owner:e}),app.data.getWebAppItem().ownerFolder&&(t.item.ownerFolder=app.data.getWebAppItem().ownerFolder),app.portal.signIn().then(function(){k(function(e){if(!e||!e.success||!e.id){M("WEBMAP");return}app.data.getWebAppData().setWebmap(e.id);var t=app.data.getWebMap();a.mixin(t.item,{id:e.id,item:e.item}),C(!1,function(t){if(!t||!t.success){M("APP");return}var n=function(){console.log("common.builder.Builder - builderGalleryCreationFirstSave - appid:",t.id," webmap:",e.id),O({success:!0}),app.isGalleryCreation=!1,g.updateSharingStatus(),History.replaceState({},"","index.html?appid="+t.id+"&edit")},r=app.data.getWebAppItem().access;if(r!="private"){var i=[app.data.getWebMap().item.id];A(i.join(","),r).then(function(e){var t=e&&e.results&&e.results.length==i.length;t?($.each(e.results,function(e,n){n.success||(t=!1)}),t?n():M("WEBMAP")):M("WEBMAP")})}else n()})})},function(e){M("APP",e)})}function C(e,t){var n=_(),r=a.clone(app.data.getWebAppItem()),i=r.owner||h.findCredential(n).userId,s=h.findCredential(n).token;delete r.avgRating,delete r.modified,delete r.numComments,delete r.numRatings,delete r.numViews,delete r.size,r.typeKeywords||(r.typeKeywords=[]),r.typeKeywords=r.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_APP),r.typeKeywords=r.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_GENERIC);var o=$.map(app.cfg.LAYOUTS,function(e){return"layout-"+e.id});r.typeKeywords=$.grep(r.typeKeywords,function(e){return $.inArray(e,o)==-1}),r.typeKeywords.push("layout-"+app.data.getWebAppData().getLayoutId()),r.typeKeywords=$.grep(r.typeKeywords,function(e,t){return t==$.inArray(e,r.typeKeywords)}),r.tags=r.tags?r.tags.join(","):"",r.typeKeywords=r.typeKeywords.join(","),r.serviceProxyParams=JSON.stringify(r.serviceProxyParams),e||(r.title=app.data.getWebAppData().getTitle()),r.properties&&(r.properties=JSON.stringify(r.properties)),r.url&&r.url.match(/apps\/[a-zA-Z]+\/\?appid=/)&&(r.url=r.url.replace("/?appid=","/index.html?appid=")),r=a.mixin(r,{f:"json",token:s,overwrite:!0,text:JSON.stringify(app.data.getWebAppData().get())});var u=n+"/sharing/content/users/"+i+(r.ownerFolder?"/"+r.ownerFolder:"");r.id?u+="/items/"+r.id+"/update":u+="/addItem";var f=p({url:u,handleAs:"json",content:r},{usePost:!0});f.then(t,M)}function k(e){app.isDirectCreationFirstSave||app.appCfg.useWebmapInApp&&app.isGalleryCreation||app.appCfg.webmapStory?(m.preWebmapSave&&m.preWebmapSave(),u.saveWebmap(app.data.getWebMap(),app.portal).then(function(t){e(t)},M)):e({success:!0})}function L(e,t){e!="public"&&e!="account"&&(e="public");var n=[];e=="account"?(app.data.getWebMap()&&app.data.getWebMap().item.access=="private"&&app.data.getWebMap().item.owner==app.portal.getPortalUser().username&&n.push(app.data.getWebMap().item.id),app.data.getWebAppItem().access=="private"&&n.push(app.data.getWebAppItem().id)):(app.data.getWebMap()&&app.data.getWebMap().item.access!="public"&&app.data.getWebMap().item.owner==app.portal.getPortalUser().username&&n.push(app.data.getWebMap().item.id),app.data.getWebAppItem().access!="public"&&n.push(app.data.getWebAppItem().id)),A(n.join(","),e).then(function(r){var i=r&&r.results&&r.results.length==n.length;i&&($.each(r.results,function(e,t){t.success||(i=!1)}),app.data.getWebMap()&&(app.data.getWebMap().item.access=e),app.data.getWebAppItem().access=e,g.updateSharingStatus()),t(i)})}function A(e,t){var n=_(),r=h.findCredential(n).userId,i=h.findCredential(n).token,s={f:"json",token:i,items:e,groups:"",everyone:"",account:""};return t=="public"&&(s.everyone=!0),t=="account"&&(s.account=!0),p({url:n+"/sharing/content/users/"+r+"/shareItems",handleAs:"json",content:s},{usePost:!0})}function O(e){e&&e.success?(app.mystories=app.mystories||{},app.mystories.isChecking=!0,app.isWebMapCreation=!1,g.saveSucceeded(),app.data.updateAfterSave(),app.isGalleryCreation||app.isDirectCreationFirstSave?(app.isDirectCreationFirstSave=!1,app.isGalleryCreation=!1,setTimeout(window.myStoriesInit,200)):s.scanStory(),g.updateSharingStatus()):M()}function M(e,t){g.saveFailed(e,t)}function _(){return c.arcgisUrl.split("/sharing/")[0]}function D(){if(!app.portal){console.error("Fatal error - not signed in");return}return app.portal.signIn().then(function(){var e=_(),t=h.findCredential(e).userId,n=h.findCredential(e).token,r=a.clone(app.data.getWebAppItem());delete r.avgRating,delete r.modified,delete r.numComments,delete r.numRatings,delete r.numViews,delete r.size,r=a.mixin(r,{f:"json",token:n,overwrite:!0,text:JSON.stringify(app.data.getWebAppData().getBlank())});var i=p({url:e+"/sharing/content/users/"+t+(r.ownerFolder?"/"+r.ownerFolder:"")+"/addItem",handleAs:"json",content:r},{usePost:!0});i.then(function(){console.log("Web Application data cleaned successfully")},function(){console.log("Web Application data cleaning has failed")})},function(e){console.error("Web Application data cleaning has failed",e)}),"Cleaning ..."}var v=null,m=null,g=new n($("#builderPanel"),x,T,N),y=null;return{init:b,resize:E,appInitComplete:w,shareAppAndWebmap:L}}),define("lib-build/tpl!storymaps/tpl/builder/BuilderView",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal fade" id="settingsPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal" id="initPopup" role="dialog" data-backdrop="static"></div>\r\n\r\n<div class="modal fade builderShare" id="sharePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade builderShareError" id="sharePopupError" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade saveErrorPopup" id="saveErrorPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade saveErrorPopupSocial" id="saveErrorPopupSocial" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade addEditPopup" id="addEditPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade editorDialog editorDialogInlineMedia" id="editorDialogInlineMedia" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade organizePopup" id="organizePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade migrationPopup" id="migrationPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade builderHelp" id="builderHelp" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n';return __p}}),define("lib-build/tpl!storymaps/tpl/builder/BasemapChooser",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="basemapChooser">\r\n	<div data-dojo-type="dijit/TitlePane"\r\n		 data-dojo-props="closable:false, open:false">\r\n	<div data-dojo-type="dijit/layout/ContentPane" style="width:380px; height:280px; overflow:auto;">\r\n		<div id="basemapGallery" ></div></div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/BuilderView",[],function(){}),define("lib-build/css!storymaps/tpl/builder/Common",[],function(){}),define("lib-build/tpl!storymaps/common/builder/Landing",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="builderLanding">\r\n	<div class="landing-add-container">\r\n		<div class="landing-lbl">'+((__t=lblAdd)==null?"":__t)+'</div>\r\n		<div class="add-title-wrapper">\r\n			<input type="text" class="form-control add-title" spellcheck="true" placeholder="'+((__t=phAdd)==null?"":__t)+'"/>\r\n			<span class="landing-btn disabled"></span>\r\n		</div>\r\n	</div>\r\n	\r\n	<div class="btnSeparator">\r\n		<span class="solidline"></span>\r\n		'+((__t=lblOR)==null?"":__t)+'\r\n		<span class="solidline"></span>\r\n	</div>\r\n	\r\n	<div class="landing-tour-container">\r\n		<div class="landing-btn"></div>\r\n		<div class="landing-lbl">'+((__t=lblHelp)==null?"":__t)+"</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/Landing",[],function(){}),define("storymaps/common/builder/Landing",["lib-build/tpl!./Landing","lib-build/css!./Landing"],function(e){return function(n,r,i){function o(){return n.find(".landing-add-container .add-title").val()}function u(){n.find(".landing-add-container .landing-btn").toggleClass("disabled",!o())}function a(){$(this).hasClass("disabled")||r(o())}function f(e){e.keyCode==13&&$(this).val()&&a()}function l(){n.find(".landing-add-container .add-title").bind("input propertychange",u).keyup(f),n.find(".landing-add-container .landing-btn").click(a),n.find(".landing-tour-container").click(i),$("#builderQuotes").html('<div style="padding: 0 18%">'+s[Math.floor(Math.random()*s.length)].join("<br />")+"</div>")}var s=[["&ldquo;There's always room for a story that can transport people to another place.&rdquo;","--J.K. Rowling"],["&ldquo;Storytelling is the most powerful way to put ideas into the world today.&rdquo;","--Robert McKee"],["&ldquo;The stories we tell literally make the world. If you want to change the world, you need to change your story. This truth applies both to individuals and institutions.&rdquo;","--Michael Margolis"],["&ldquo;The shortest distance between a human being and the truth is a story.&rdquo;","--Anthony de Mello"],["&ldquo;People don’t want more information. They are up to their eyeballs in information. They want faith–faith in you, your goals, your success, in the story you tell.&rdquo;","--Annette Simmons"],["&ldquo;I truly believe that people are looking for stories that really mean something–stories that are redemptive, inspiring, and bigger than an individual.&rdquo;","--Scott Harrison"],["&ldquo;If you wish to influence an individual or a group to embrace a particular value in their daily lives, tell them a compelling story.&rdquo;","--Annette Simmons"],["&ldquo;If you tell me, it’s an essay. If you show me, it’s a story.&rdquo;","--Barbara Greene"],["&ldquo;If you don’t know the trees you may be lost in the forest, but if you don’t know the stories you may be lost in life.&rdquo;","--Siberian Elder"],["&ldquo;Stories are the creative conversion of life itself into a more powerful, clearer, more meaningful experience. They are the currency of human contact.&rdquo;","--Robert McKee"]];n.append(e({lblAdd:i18n.builder.landing.lblAdd,phAdd:i18n.builder.landing.phAdd,lblOR:i18n.builder.landing.lblOR,lblHelp:i18n.builder.landing.lblHelp})),l(),this.toggle=function(e){i18n.builder.landing.lblAdd.match("%LAYOUT_TITLE%")&&n.find(".landing-add-container .landing-lbl").html(i18n.builder.landing.lblAdd.replace("%LAYOUT_TITLE%",app.data.getCurrentLayoutStaticConfig().title)),!o()&&(app.isGalleryCreation||app.isWebMapCreation)&&(n.find(".landing-add-container .add-title").val(app.data.getWebAppItem().title).select(),u()),n.toggle(e),$("#builderQuotes").toggle(e),focus()},this.focus=function(){n.find(".landing-add-container .add-title").focus()}}}),define("lib-build/tpl!storymaps/tpl/builder/Help",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<p>\r\n			Welcome to the Story Map Shortlist (beta). This app lets you present places of interest organized into tabs, making it fun for people to explore what\'s in an area. You can author your places interactively in this Builder.\r\n			</p>\r\n			<p>\r\n			You can also create a Shortlist from an existing ArcGIS web map, including the option to import point data in the map into the Builder as places.\r\n			</p>\r\n			<p>\r\n			To create a Shortlist from a web map, go to <a href="http://www.arcgis.com/home" target="_blank">ArcGIS Online</a>, open the web map, create a web app from it, and choose Story Map Shortlist from the gallery of apps. If your web map contains any point layers, the Shortlist Builder will prompt you to select the layers you want to import as places. If you created a Shortlist using the original, non-hosted version of the app, you can migrate your Shortlist into this new, hosted version of the app using the same steps.\r\n			</p>\r\n			<p>\r\n\r\n			<h3>For more information</h3>\r\n			<ul>\r\n				<li>\r\n					<a href="//storymaps.arcgis.com/en/app-list/shortlist" target="_blank">Visit the Shortlist section of the Esri Story Maps website</a>\r\n				</li>\r\n				<li>\r\n					<a href="//links.esri.com/storymaps/faq_shortlist" target="_blank">Shortlist FAQ</a>\r\n				</li>\r\n			</ul>\r\n\r\n			<h3>Beta feedback</h3>\r\n\r\n			<p>\r\n			We would love to hear from you! Let us know about issues and new features you need by visiting the <a href="//links.esri.com/storymaps/forum" target="_blank">Story Maps forum on GeoNet</a>.\r\n			</p>\r\n\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnClose)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n";return __p}}),define("lib-build/css!storymaps/tpl/builder/Help",[],function(){}),define("storymaps/tpl/builder/Help",["lib-build/tpl!./Help","lib-build/css!./Help"],function(e,t){return function(n){n.append(e({title:"Help",btnClose:i18n.commonCore.common.close})),this.present=function(){n.modal({keyboard:!0})}}}),define("lib-build/tpl!storymaps/tpl/builder/InitPopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-header">\r\n			<h3 class="modal-title">'+((__t=title)==null?"":__t)+'</h3>\r\n		</div>\r\n		<div class="modal-body">\r\n			Ready?\r\n		</div>\r\n		<div class="modal-footer">\r\n			<span class="modal-footer-left"></span>\r\n			<button class="btnNext btn btn-primary"></button>\r\n		</div>\r\n	</div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/builder/InitPopup",[],function(){}),define("storymaps/tpl/builder/InitPopup",["lib-build/tpl!./InitPopup","lib-build/css!./InitPopup","dojo/Deferred"],function(e,t,n){return function(r){function o(){i.resolve({ok:!0,pickWebmap:!1})}function u(e){e.keyCode==13&&o()}function a(){$("body").bind("keydown",u)}r.append(e({title:i18n.builder.initPopup.title+'<span class="builder-logo"></span>'}));var i=null,s=r.find(".btnNext");a(),this.init=function(){},this.present=function(){return i=new n,s.removeAttr("disabled"),s.html(i18n.builder.initPopup.startBtn).show(),s.click(o),r.modal({keyboard:!1}),o(),i},this.initLocalization=function(){}}}),define("lib-build/tpl!storymaps/common/builder/SharePopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h3 class="modal-title">'+((__t=title)==null?"":__t)+'</h3>\r\n		</div>\r\n		<div class="modal-body">\r\n			<div class="sharing-container">\r\n				<div class="btn-group app-sharing-container">\r\n					<div class="app-sharing-wrapper">\r\n						<div class="app-sharing-loading"></div>\r\n						<button class="app-sharing-icon glyphicon glyphicon-user" data-sharing="private" title="'+((__t=btnPrivateTooltip)==null?"":__t)+'"><span class="app-sharing-private">'+((__t=btnPrivate)==null?"":__t)+'</span></button>\r\n					</div>\r\n					<div class="app-sharing-wrapper">\r\n						<div class="app-sharing-loading"></div>\r\n						<button class="app-sharing-icon share-group" data-sharing="organization" title="'+((__t=btnOrgTooltip)==null?"":__t)+'">'+((__t=btnOrg)==null?"":__t)+'</button>						\r\n					</div>\r\n					<div class="app-sharing-wrapper">\r\n						<div class="app-sharing-loading"></div>\r\n						<button class="app-sharing-icon share-globe" data-sharing="public" title="'+((__t=btnPublicTooltip)==null?"":__t)+'">'+((__t=btnPublic)==null?"":__t)+'</button>\r\n					</div>\r\n					<span class="preview-container">\r\n						<button class="btn btn-naked btn-link btn-open"></button>\r\n					</span>\r\n				</div>\r\n				<div class="sharing-action-result hide"></div>\r\n			</div>\r\n			\r\n			<div class="story-checked-container hide">\r\n				<div class="story-status"></div>\r\n				\r\n				<div class="views">\r\n					<div class="view view-share active" style="text-align: center">\r\n						<table style="width: 100%">\r\n							<tr style="vertical-align: top;">\r\n								<td style="width: 50%">\r\n									<div class="socialize-title">'+((__t=socialize)==null?"":__t)+'</div>\r\n									<div class="share-url-panel"></div>\r\n									<div class="social-container">\r\n										<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\r\n										<i class="shareIcon blackHover share_twitter icon-twitter"></i>\r\n									</div>\r\n								</td>\r\n								<td style="width: 50%">\r\n									<div class="embed-title">'+((__t=embedTitle)==null?"":__t)+'</div>\r\n									<div class="share-embed-panel"></div>\r\n								</td>\r\n							</tr>\r\n						</table>\r\n						<div class="my-stories-call">'+((__t=mystoriesinvite2)==null?"":__t)+'</div>\r\n					</div>\r\n					<div class="view view-my-stories">\r\n						<iframe id="my-stories-frame"></iframe>\r\n					</div>\r\n					<div class="view view-private-story">\r\n						<div class="private-story-call-to-action"></div>\r\n					</div>\r\n				</div>\r\n				\r\n				<div class="view-toggle-container">\r\n					<div class="btn btn-default view-toggle-btn">'+((__t=btnToggle)==null?"":__t)+'</div>\r\n				</div>\r\n			</div>\r\n			\r\n			<div class="story-checking-container">\r\n				<div style="margin: 20px 0;">\r\n					<img src="resources/tpl/viewer/icons/loading-light.gif" />\r\n				</div>\r\n				'+((__t=loadingMessage)==null?"":__t)+'\r\n			</div>\r\n		</div>\r\n		<div class="modal-footer">\r\n			<span class="footer-msg"></span>\r\n			<button class="btnClose btn btn-naked btn-close" data-dismiss="modal" aria-hidden="true">'+((__t=close)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/SharePopup",[],function(){}),define("lib-build/tpl!storymaps/common/builder/SharePopupError",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="error-msg"></div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n		<span class="error"></span>\r\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnClose)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/SharePopupError",[],function(){}),define("storymaps/common/builder/SharePopupError",["lib-build/tpl!./SharePopupError","lib-build/css!./SharePopupError"],function(e){return function(n){n.html(e({title:i18n.commonCore.share.shareTitle,btnClose:i18n.commonCore.common.close})),this.present=function(e){var t="";e.error=="DOMAIN"?t+=i18n.commonCore.share.notavailable1.replace("%PRODUCT%",e.isPortal?"Portal for ArcGIS":"ArcGIS Online"):e.error=="PORTAL"?t+=i18n.commonCore.share.notavailable2:e.error=="DEV"&&(t+=i18n.commonCore.share.notavailable6),t+="<br /><br />",e.error=="DOMAIN"?t+=i18n.commonCore.share.notavailable3.replace("%LINK%",'<a href="'+e.mystoriesURL+'" target="_blank">'+i18n.commonCore.share.notavailable4+"</a>"):(t+=i18n.commonCore.share.notavailable3.replace("%LINK%",'<a href="'+e.itemURL+'" target="_blank">'+i18n.commonCore.share.notavailable5+"</a>"),t+=" ",t+=i18n.commonCore.share.notavailable7.replace("%MYCONTENT%",'<a href="'+e.mycontentURL+'" target="_blank">'+i18n.commonCore.share.notavailable8+"</a>")),n.find(".error-msg").html(t),n.modal({keyboard:!0})}}}),define("storymaps/common/builder/SharePopup",["lib-build/tpl!./SharePopup","lib-build/css!./SharePopup","./SharePopupError","./MyStoriesWrapper","../utils/CommonHelper","../ui/share/ShareURLPanel","../ui/share/ShareEmbedPanel","../utils/HeaderHelper","dojo/topic","dojo/has"],function(e,t,n,r,i,s,o,u,a,f){return function(l){function v(){var e=app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared";l.find(".views .view-my-stories").hasClass("active")?(e?(l.find(".views .view-share").toggleClass("active",!1),l.find(".views .view-my-stories").toggleClass("active",!1),l.find(".views .view-private-story").toggleClass("active",!0),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1)):(l.find(".views .view-share").toggleClass("active",!0),l.find(".views .view-my-stories").toggleClass("active",!1),l.find(".views .view-private-story").toggleClass("active",!1),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1)),f("ff")&&$("#my-stories-hidden-container").removeClass("active")):(l.find(".views .view-share").toggleClass("active",!1),l.find(".views .view-my-stories").toggleClass("active",!0),l.find(".views .view-private-story").toggleClass("active",!1),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle2),c.updateMyStoriesPosition())}function m(){var e=$(this).data("sharing"),t=e=="private"?0:e=="organization"?1:2,n=l.find(".app-sharing-icon.active").index();console.log("Changing sharing level to:",e),l.find(".app-sharing-icon").removeClass("active"),$(this).addClass("active"),l.find(".app-sharing-icon").addClass("locked"),l.find(".sharing-action-result").addClass("hide"),l.find(".app-sharing-wrapper").eq(t).find(".app-sharing-loading").show(),l.find(".btn-open").addClass("disabled"),app.mystories.share(e).then(g,function(e){e.needsUserInput&&e.delayPromise?(app.mystories.hasCheckErrors=!0,e.delayPromise.then(g,function(e){y(e,n)}),b({postSharing:!0,previousLevelIndex:n,targetLevelIndex:t,needsUserInput:!0})):y(e,n)})}function g(e){console.log(e),app.mystories.hasCheckErrors=!e.allClear,l.find(".app-sharing-icon").removeClass("locked"),l.find(".app-sharing-loading").hide(),l.find(".btn-open").removeClass("disabled"),e.storyAndContent&&l.find(".sharing-action-result").removeClass("hide").addClass("status-ok").html(e.message),e.targetAccess=="private"?app.data.getWebAppItem().access="private":e.targetAccess=="organization"?app.data.getWebAppItem().access="account":e.targetAccess=="public"&&(app.data.getWebAppItem().access="public"),b()}function y(e,t){console.error("sharing failed"),app.mystories.hasCheckErrors=!e.allClear,l.find(".app-sharing-icon").removeClass("locked active"),l.find(".app-sharing-icon").eq(t).addClass("active"),l.find(".app-sharing-loading").hide(),l.find(".btn-open").removeClass("disabled"),l.find(".sharing-action-result").removeClass("hide status-ok").html(e.message)}function b(e){var t=app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared",n=app.data.getWebAppItem().access=="account",r=app.isDirectCreationFirstSave||app.isGalleryCreation,i=t?0:n?1:2,s="";e=e||{},l.find(".story-checked-container").toggleClass("hide",app.mystories.isChecking),l.find(".story-checking-container").toggleClass("hide",!app.mystories.isChecking),l.find(".app-sharing-icon").removeClass("locked active"),r?l.find(".app-sharing-icon").addClass("locked"):t||e.needsUserInput&&e.targetLevelIndex===0?l.find(".app-sharing-icon").eq(0).addClass("active"):n||e.needsUserInput&&e.targetLevelIndex===1?l.find(".app-sharing-icon").eq(1).addClass("active"):l.find(".app-sharing-icon").eq(2).addClass("active");var o;!r&&!app.mystories.forcedIgnoreIssues&&(e.needsUserInput?(o=e.targetLevelIndex,l.find(".app-sharing-loading").hide(),o==2?l.find(".app-sharing-icon").eq(2).toggleClass("locked",!0):o==1?(l.find(".app-sharing-icon").eq(2).toggleClass("locked",!0),l.find(".app-sharing-icon").eq(1).toggleClass("locked",!0)):o===0&&l.find(".app-sharing-icon").eq(0).toggleClass("locked",!0)):app.mystories.hasCheckErrors?(o=e.postSharing?e.previousLevelIndex:i,o==2?l.find(".app-sharing-icon").toggleClass("locked",!1):o==1?(l.find(".app-sharing-icon").toggleClass("locked",!0),l.find(".app-sharing-icon").eq(0).toggleClass("locked",!1)):o===0&&l.find(".app-sharing-icon").toggleClass("locked",!0)):l.find(".app-sharing-icon").toggleClass("locked",app.mystories.isChecking));if(!app.mystories.isChecking){if(app.mystories.hasCheckErrors||app.mystories.forcedIgnoreIssues)s+=i18n.commonCore.share.statusError;l.find(".story-status").hide();if(app.mystories.hasCheckErrors||app.mystories.forcedIgnoreIssues){l.find(".story-status").html(s).show();if(t){var u=i18n.commonCore.share.statusPrivate;u+="<br />",u+=i18n.commonCore.share.statusNoErrPrivate,l.find(".private-story-call-to-action").html(u)}}else t&&(s+=i18n.commonCore.share.statusPrivate,s+="<br />",s+=i18n.commonCore.share.statusNoErrPrivate,l.find(".private-story-call-to-action").html(s));if(!e.isRefresh||app.mystories.forcedIgnoreIssues){var h=!!(app.mystories.hasCheckErrors&&!app.mystories.forcedIgnoreIssues||e.needsUserInput||r);l.find(".views .view-share").toggleClass("active",(!app.mystories.hasCheckErrors||!!app.mystories.forcedIgnoreIssues)&&!e.needsUserInput&&!t&&!r),l.find(".views .view-my-stories").toggleClass("active",h),l.find(".views .view-private-story").toggleClass("active",(!app.mystories.hasCheckErrors||app.mystories.forcedIgnoreIssues)&&!e.needsUserInput&&t),f("ff")&&($("#my-stories-hidden-container").toggleClass("active",h),h&&c.updateMyStoriesPosition())}}l.find(".btn-open").toggle(!r),l.find(".btn-open").html(t?i18n.commonCore.share.preview:i18n.commonCore.share.viewlive),l.find(".view-toggle-container").toggleClass("hide",app.mystories.hasCheckErrors&&!app.mystories.forcedIgnoreIssues||r),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1),a.publish("MYSTORIES_SCAN",app.mystories.hasCheckErrors||e.needsUserInput?"error":null)}function w(){l.find(".app-sharing-icon").click(m),l.find(".view-toggle-btn").click(v),l.find(".btn-open").off("click").click(function(){window.open(i.getAppViewModeURL(),"_blank")}),l.on("hide.bs.modal",function(){f("ff")&&$("#my-stories-hidden-container").removeClass("active")}),l.on("shown.bs.modal",function(){f("ff")&&c.updateMyStoriesPosition()})}l.append(e({title:i18n.commonCore.share.shareTitle,btnPrivate:i18n.commonCore.share.btnPrivate,btnPrivateTooltip:i18n.commonCore.share.btnPrivateTooltip,btnOrg:i18n.commonCore.share.btnOrg,btnOrgTooltip:i18n.commonCore.share.btnOrgTooltip,btnPublic:i18n.commonCore.share.btnPublic,btnPublicTooltip:i18n.commonCore.share.btnPublicTooltip,loadingMessage:i18n.commonCore.share.loadingMessage,btnToggle:i18n.commonCore.share.viewToggle1,socialize:i18n.commonCore.share.socialize,embedTitle:i18n.viewer.shareFromCommon.embed,mystoriesinvite2:i18n.commonCore.share.mystoriesinvite2.replace("${MYSTORIES}",'<a href="'+i.getMyStoriesURL()+'" target="_blank">'+i18n.commonCore.common.mystories+"</a>"),close:i18n.commonCore.common.close}));var c=this,h=new n($("#sharePopupError")),p=new s(l.find(".share-url-panel")),d=new o(l.find(".share-embed-panel"));w(),a.subscribe("MY-STORIES-REFRESH",function(){b({isRefresh:!0})}),this.present=function(e,t){var n=i.getAppViewModeURL();if(!app.portal.hasMyStories||!app.isProduction||!r.myStoriesIsSameDomain()){var s="";!app.isProduction&&!app.portal.hasMyStories?s="DEV":app.isProduction&&app.isPortal&&r.myStoriesIsSameDomain()&&!app.portal.hasMyStories?s="PORTAL":app.isProduction&&(!app.portal.hasMyStories||!r.myStoriesIsSameDomain())&&(s="DOMAIN");if(s){h.present({error:s,isPortal:app.isPortal,itemURL:i.getItemURL(app.data.getWebAppItem().id),mycontentURL:i.getMyContentURL(),mystoriesURL:i.getMyStoriesURL()});return}}p.present(n,!1),d.present(n),u.setSocial(l,t),u.initEvents(l,"bottom");if(app.mystories){l.find(".app-sharing-icon").tooltip({placement:"top",container:".app-sharing-container",trigger:"hover"}),b();var o='<a href="'+i.getMyStoriesURL()+'" target="_blank">'+i18n.commonCore.share.mystoriesinvite+"</a>";l.find(".footer-msg").html(o)}else l.find(".app-sharing-icon").removeClass("active").addClass("locked");l.find(".sharing-action-result").addClass("hide");var a=app.portal.isOrganization!==!1,f=a&&$.inArray("portal:user:shareToOrg",app.portal.getPortalUser().privileges)>-1,c=!a||$.inArray("portal:user:shareToPublic",app.portal.getPortalUser().privileges)>-1,v=app.data.getWebAppItem().itemControl,m=app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared",g=app.data.getWebAppItem().access=="account",y=app.data.getWebAppItem().owner==app.portal.getPortalUser().username;v=="update"?(f=!1,c=!1):v=="admin"&&!y&&(f=$.inArray("portal:admin:shareToOrg",app.portal.getPortalUser().privileges)>-1,c=$.inArray("portal:admin:shareToPublic",app.portal.getPortalUser().privileges)>-1),g?f=!0:m||(c=!0),l.find(".app-sharing-wrapper").eq(0).addClass("enabled"),l.find(".app-sharing-wrapper").eq(1).toggleClass("enabled",f),l.find(".app-sharing-wrapper").eq(2).toggleClass("enabled",c),l.find(".app-sharing-wrapper.enabled:last").addClass("lastBtn"),l.modal({keyboard:!0})},this.updateMyStoriesPosition=function(){if(f("ff")){var e=l.find(".view-my-stories")[0].getBoundingClientRect();$("#my-stories-hidden-container").addClass("active").css({top:e.top,left:e.left,width:e.right-e.left,height:l.find(".story-status").is(":visible")?270:300})}}}}),define("storymaps/tpl/builder/BuilderHelper",[],function(){return{getNewLayerJSON:function(e){return{id:"shortlist-layer"+(new Date).getTime(),title:"Shortlist layer",visibility:!0,opacity:1,featureCollection:{layers:[e],showLegend:!0}}},getFeatureCollectionTemplate:function(e){var t={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};return t.layerDefinition={geometryType:"esriGeometryPoint",objectIdField:"__OBJECTID",name:"Shortlist-layer",type:"Feature Layer",typeIdField:"",drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",contentType:"image/png",width:15,height:15}}},fields:[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}],types:[],capabilities:"Query"},e?t.layerDefinition.fields=[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null},{name:"name",type:"esriFieldTypeString",alias:"Name",domain:null,editable:!0,nullable:!0,length:254},{name:"description",type:"esriFieldTypeString",alias:"Description",domain:null,editable:!0,nullable:!0,length:1e3},{name:"pic_url",type:"esriFieldTypeString",alias:"Picture URL",domain:null,editable:!0,nullable:!0,length:254},{name:"thumb_url",type:"esriFieldTypeString",alias:"Thumbnail URL",domain:null,editable:!0,nullable:!0,length:254},{name:"website",type:"esriFieldTypeString",alias:"Website",domain:null,editable:!0,nullable:!0,length:254},{name:"shortlist_id",type:"esriFieldTypeInteger",alias:"Shortlist Id",domain:null,editable:!0,nullable:!0,length:254},{name:"number",type:"esriFieldTypeInteger",alias:"Number",domain:null,editable:!0,nullable:!0,length:254},{name:"tab_id",type:"esriFieldTypeInteger",alias:"Tab index",domain:null,editable:!0,nullable:!0,length:254},{name:"set",type:"esriFieldTypeInteger",alias:"Location Set",domain:null,editable:!0,nullable:!0,length:254}]:t.layerDefinition.fields=[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}],t},serializeGraphicsLayerToFeatureCollection:function(e,t,n){var r={layers:[{featureSet:{features:[],geometryType:e.geometryType},layerDefinition:{geometryType:e.geometryType,objectIdField:e.objectIdField,name:e.name,type:e.type,typeIdField:e.typeIdField,drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",contentType:"image/png",width:15,height:15}}},fields:[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null},{name:"name",type:"esriFieldTypeString",alias:"Name",domain:null,editable:!0,nullable:!0,length:254},{name:"description",type:"esriFieldTypeString",alias:"Description",domain:null,editable:!0,nullable:!0,length:1e3},{name:"pic_url",type:"esriFieldTypeString",alias:"Picture URL",domain:null,editable:!0,nullable:!0,length:254},{name:"thumb_url",type:"esriFieldTypeString",alias:"Thumbnail URL",domain:null,editable:!0,nullable:!0,length:254},{name:"website",type:"esriFieldTypeString",alias:"Website",domain:null,editable:!0,nullable:!0,length:254},{name:"shortlist_id",type:"esriFieldTypeInteger",alias:"Shortlist Id",domain:null,editable:!0,nullable:!0,length:254},{name:"number",type:"esriFieldTypeInteger",alias:"Number",domain:null,editable:!0,nullable:!0,length:254},{name:"tab_id",type:"esriFieldTypeInteger",alias:"Tab index",domain:null,editable:!0,nullable:!0,length:254},{name:"set",type:"esriFieldTypeInteger",alias:"Location Set",domain:null,editable:!0,nullable:!0,length:254}],types:[],capabilities:e.capabilities}}],showLegend:!0};return $.each(e.fields,function(e,t){r.layers[0].layerDefinition.fields.push({name:t.name,alias:t.alias,type:t.type,editable:t.editable,domain:null})}),$.each(n,function(e,t){r.layers[0].featureSet.features.push({attributes:t.attributes,geometry:t.geometry})}),r},getBlankWebmapJSON:function(){return{item:{id:"",guid:null,name:null,type:"Web Map",typeKeywords:["ArcGIS Online","Explorer Web Map","Map","Online Map","Web Map","Story Maps","Shortlist"],description:null,tags:["map"],snippet:null,thumbnail:"thumbnail/ago_downloaded.png",documentation:null,extent:[[-180,-90],[180,90]],spatialReference:null,accessInformation:null,licenseInfo:null,culture:"en-us",properties:null,url:null,size:233,appCategories:[],industries:[],languages:[],largeThumbnail:null,banner:null,screenshots:[],listed:!1,ownerFolder:null,commentsEnabled:!0,numComments:0,numRatings:0,avgRating:0,numViews:1},itemData:{operationalLayers:[],baseMap:{baseMapLayers:[{id:"defaultBasemap",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Base/MapServer"},{id:"referenceOverlay",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Reference/MapServer"}],title:"Light Gray"},version:"1.9"}}}}}),define("storymaps/common/builder/browse-dialog/js/_RefreshMixin",["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on"],function(e,t,n,r){function i(e){typeof e!="object"&&(e=new Error(e)),e.grid=this,r.emit(this.domNode,"dgrid-error",{grid:this,error:e,cancelable:!0,bubbles:!0})&&console.error(e)}var s=e(null,{_trackError:function(e){var s;typeof e=="string"&&(e=t.hitch(this,e));try{s=e()}catch(o){i.call(this,o)}return n.when(s,t.hitch(this,function(){r.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),t.hitch(this,i))}});return s}),define("storymaps/common/builder/browse-dialog/js/PortalItemStore",["dojo/_base/declare","dojo/_base/lang","esri/arcgis/Portal"],function(e,t,n){return e(null,{idProperty:"id",constructor:function(t){e.safeMixin(this,t),this.portalUrl=this.portal&&this.portal.portalUrl},getIdentity:function(e){return e[this.idProperty]},query:function(e,r){var e=e,i=t.isObject(e)?e:{q:e};if(r){i=t.mixin(i,{num:r.count,start:(r.start||0)+1});if(r.sort&&r.sort.length){var s=r.sort[0];i=t.mixin(i,{sortField:encodeURIComponent(s.attribute==="created"?"uploaded":s.attribute),sortOrder:s.descending?"desc":"asc"})}}if(this.galleryType==="webmap")var o=this.portal.queryItems(i).then(function(e){return e.results.total=e.total,e.results});else var o=this.portal.queryGroups(i).then(function(e){return e.results.total=e.total,e.results});return n.PortalResult(o)}})}),define("storymaps/common/builder/browse-dialog/js/Grid",["dojo/_base/declare","dojo/Evented","dojo/string","dojo/_base/lang","dojo/_base/array","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/Grid","./_RefreshMixin","dgrid/Selection","dgrid/extensions/Pagination","dojo/query","dojo/store/Memory","dojo/store/Cache","./PortalItemStore","dojo/store/Observable","put-selector/put","dgrid/util/mouse"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return e([s,t],{postMixInProperties:function(){this.inherited(arguments),this._supportedViews=["gallery","details"],this._galleryTemplate=this._galleryTemplate||"<div class='itemGrid'><img alt='' src='${thumbnailUrl:_formatThumbnail}'><div class='itemTitle'>${title:_formatTitle}</div><span class='itemOwner'>${owner}</span><p class='itemText snippet' style='display:none;'>${snippet}</p></div>",this._renderers=r.mixin(this._renderers||{},{gallery:r.hitch(this,function(t){t.snippet=t.snippet||t.description||t.title||"";var r=g("div"),i=new(e([s,o,u],{templateString:n.substitute(this._galleryTemplate,t,null,this)}));return r.appendChild(i.domNode),r})})},_formatTitle:function(e){return e||(e=""),e},_formatThumbnail:function(e){return e||"resources/common/icons/browse-dialog/default.png"},buildRendering:function(){this.inherited(arguments);var t=e([a,c,l,f]),n=this.columns||{id:{label:"id"},title:{label:"title"},type:{label:"type"},modified:{label:"last modified"},snippet:{label:"snippet"}};this._view=this.view||"gallery",this._query=this.query,this._queryOptions=this.queryOptions||{sort:this.sort||[{attribute:"modified",descending:!0}]},this._store=this.store||new d(new v({portal:this.portal,galleryType:this.galleryType}),new p({data:[]})),this._rowsPerPage=this.rowsPerPage||8,this._sort=this.sort||[{attribute:"title",descending:!1}],this._pagingLinks=this.pagingLinks?3:!1,this._grid=new t({columns:n,showHeader:!1,selectionMode:"single",renderRow:this._renderers[this._view],store:this._store,query:this._query,loadingMessage:"Loading...",noDataMessage:"No results found",showLoadingMessage:!0,firstLastArrows:this._pagingLinks,previousNextArrows:this._pagingLinks,rowsPerPage:this._rowsPerPage,pagingLinks:this._pagingLinks,pagingTextBox:!0,sort:this._sort},this.domNode),this._grid.startup()},postCreate:function(){this.inherited(arguments),this.own(this._grid.on(y.enterRow,r.hitch(this,"_showSnippet",!0)),this._grid.on(y.leaveRow,r.hitch(this,"_showSnippet",!1)),this._grid.on("refresh",r.hitch(this,"_onGridRefresh")),this._grid.on(".dgrid-row:click",r.hitch(this,"_onRowClick")))},_onGridRefresh:function(e){this.emit("onRefresh",{currentPage:this._grid._currentPage}),this._pagingLinks&&(h(".dgrid-navigation")[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide"),h(".dgrid-pagination")[this._grid._total===0?"addClass":"removeClass"]("hide"))},_onRowClick:function(e){this.emit("onItemClick",{row:this._grid.row(e)})},_showSnippet:function(e,t){var n=this._grid.row(t);n&&(h(".itemGrid .itemTitle",n.element)[e?"addClass":"removeClass"]("hover"),h(".itemGrid .itemOwner",n.element).style("display",e?"none":""),h(".itemGrid > img",n.element).style("display",e?"none":""))},_getGridAttr:function(){return this._grid},refresh:function(){this._grid&&this._grid.set("query",this._query,this._queryOptions)},gotoPage:function(e){this._grid.query=this._query,this._grid.queryOptions=this._queryOptions,this._grid._sort=this._queryOptions.sort,this._grid.gotoPage(e)},_setViewAttr:function(e){e=i.indexOf(this._supportedViews,e)===-1?this._view:e,this._view=e,this._grid&&(this._grid.renderRow=this._renderers[e],g(this._grid.domNode,"!gallery!details."+e))},_setStoreAttr:function(e){this._store=e},_setQueryAttr:function(e,t){this._query=e||this._query,this._queryOptions=t||this._queryOptions},_setItemsAttr:function(e){this._store=this._store||new m(p({data:e})),this._store&&this._store.setData?this._store.setData(e):this._store=new m(p({data:e})),this.set("store",this._store),this.set("view",this._view)}})}),define("text!storymaps/common/builder/browse-dialog/js/templates/BrowseIdDlg.html",[],function(){return'<div class="widgetContent" >\r\n  <div data-dojo-type="dijit/Dialog" id="browse-id-dialog" title="${i18n.title}" execute="">\r\n    <div data-dojo-attach-point="formNode" class="esriItemLinks dijitDialogPaneContentArea">\r\n      <div id="browse-id-box" style="border:#333 1px solid; width:565px; min-height:330px; padding:0; overflow:hidden;">            \r\n        <div class="esriFloatLeading esriLeadingMargin1" style="width:250px; margin-top:10px;">\r\n          <select data-dojo-attach-point="_filterSelect"  data-dojo-type="dijit/form/Select" sortByLabel="false" maxHeight=\'350\' style="width:240px;">\r\n          </select>\r\n        </div>  \r\n        <div class="search esriFloatTrailing esriTrailingMargin1" style="width:250px;">\r\n          <div id="search-form" style="position:relative;">\r\n            <input class="esriSearchBox" type="text" data-dojo-type="dijit/form/TextBox" trim="true" id="browse-id-search-box" data-dojo-attach-point="searchText" data-dojo-attach-event="onKeyPress:_onSearchKeyPress,onFocus:_onSearchBoxFocus,onBlur:_onSearchBoxBlur" alt="${i18n.searchTitle}" title="${i18n.searchTitle}" placeholder="${i18n.placeholder}" />\r\n            <button class="esriLeadingMargin13 esriSearchButton dijitDialogCloseIcon hide" id="clear-box_submit" alt="${i18n.searchTitle}" title="searchTitle" data-dojo-attach-point="clearButton" data-dojo-attach-event="onclick:_onSearchClear" >&nbsp;&nbsp;</button>\r\n          </div>\r\n        </div>\r\n        <div style="position:relative; width:565px;clear:both;" data-dojo-attach-point="gallery"  id="gallery"></div>\r\n      </div>\r\n    </div>\r\n    <div class="submitButtons dijitDialogPaneActionBar esriPositionRight0">\r\n      <input data-dojo-type="dijit/form/Button" name="cancel" class="cancel esriFloatTrailing" type="button" data-dojo-attach-event="onClick:onCancel" label="${i18n.cancel}">\r\n      <input data-dojo-type="dijit/form/Button" name="ok" class="ok esriFloatTrailing calcite blue" type="button" data-dojo-attach-event="onClick:onClose" label="${i18n.ok}">\r\n    </div>\r\n  </div>\r\n</div>\r\n'}),define("storymaps/common/builder/browse-dialog/js/BrowseIdDlg",["require","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/event","dojo/dom-class","dojo/keys","dijit/registry","dojo/on","dojo/i18n!commonResources/nls/webmap.js?v="+app.version,"dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","./Grid","esri/arcgis/Portal","text!./templates/BrowseIdDlg.html","dijit/Dialog","dijit/form/Select","dijit/form/Button"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return t([l,c,h],{templateString:v,constructor:function(e){r.mixin(this,e)},postMixInProperties:function(){this.inherited(arguments),this.i18n={},this.galleryType==="webmap"?this.i18n=f.configure.mapdlg:this.i18n=f.configure.groupdlg,this.selected=null},postCreate:function(){var e=[];e.push({label:this.i18n.items.contentLabel,value:"content"},{label:this.i18n.items.organizationLabel,value:"org"},{label:app.isPortal?app.portal.name:this.i18n.items.onlineLabel,value:"online"}),this.galleryType==="webmap"&&e.push({label:this.i18n.items.favoritesLabel,value:"favorites"}),this._filterSelect.set("options",e),this._filterSelectHandler=a(this._filterSelect,"change",r.hitch(this,"doSearch"));var t={},n=this.portal.user;n.username&&(t.q="owner: "+n.username),this.galleryType==="webmap"&&(t.q+=' type:"Web Map" -type:"Web Mapping Application"'),this._grid=new p({portal:this.portal,query:t,pagingLinks:!0,galleryType:this.galleryType,view:"gallery"},"gallery"),this._grid.refresh(),a(this._grid,"onItemClick",r.hitch(this,function(e){var t=e.row;e.row.data&&e.row.data.id&&(this.selected=t.data)})),$("#dijit_form_Button_2_label, .dijitSelectLabel, .dijitButtonText, .dijitButtonContents, .dijitArrowButtonInner, .dijitArrowButtonContainer, .dijitMenuItem, .dijitMenuItemLabel").addClass("needsclick")},destroy:function(){this._filterSelectHandler.remove(),this.inherited(arguments)},doSearch:function(){var e=this._filterSelect.get("value"),t=this.portal.user,n=null,i=[];if(this.searchText.getValue()&&this.searchText.getValue().match(/^[A-Fa-f0-9]{32}$/))i.id=this.searchText.getValue();else{this.searchText.getValue()&&(n=this.searchText.getValue()),e==="org"&&(i.orgid=t.orgId),e==="content"&&(i.owner=t.username),e==="favorites"&&(i.group=t.favGroupId);if(e==="online"&&this.galleryType==="group"){var s=this.searchText.getValue();s===""&&(i.access="public")}}this.galleryType==="webmap"&&(i.type='"Web Map" -type:"Web Mapping Application"');var o="";for(var u in i){var a=i[u];o+=u+":"+a+" "}var f={};n&&(o=n+" "+o),f.q=r.trim(o),console.log(f.q),this._grid.set("query",f),this._grid.refresh()},_onSearchClear:function(e){i.stop(e),e!=null&&e.prefentDefault&&e.preventDefault(),this.searchText.setValue(""),s.add("clear-box_submit","hide"),this.doSearch()},_onSearchBoxFocus:function(e){},_onSearchBoxBlur:function(e){this.searchText.getValue()==""},_onSearchKeyPress:function(e){e.keyCode==o.ENTER&&(i.stop(e),this.doSearch()),e.keyCode==8&&this.searchText.getValue().length==1?s.add("clear-box_submit","hide"):s.remove("clear-box_submit","hide"),this.onSearchFieldKeyPress(e)},onSearchFieldKeyPress:function(e){},onClose:function(){u.byId("browse-id-dialog").hide()},onCancel:function(){this.set("selected",null),u.byId("browse-id-dialog").hide()},show:function(e){u.byId("browse-id-dialog").show(),this._grid.refresh()}})}),define("lib-build/css!storymaps/common/builder/browse-dialog/css/browse-dialog",[],function(){}),define("lib-build/css!storymaps/common/builder/browse-dialog/storymaps-override",[],function(){}),define("lib-build/tpl!storymaps/tpl/builder/settings/ViewGeneralOptions",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-generaloptions">\r\n	<table class="tab-cfg">\r\n		<tr class="tab-cfg-row tab-cfg-extent-mode">\r\n			<td class="tab-cfg-title" style="outline: none;">\r\n				<div class="homeLocation">Default map location</div>\r\n			</td>\r\n			<td class="tab-cfg-extent-btns">\r\n				<div class="regular-control" style="display: block;">\r\n					<span class="btn-group">\r\n						<button type="button" class="btn btn-default btn-xs btn-primary defaultExtent" data-value="default" data-placement="top" data-title="The location is managed automatically so that all your places are visible">\r\n							Auto\r\n						</button>\r\n						<button type="button" class="btn btn-default btn-xs customHomeExtent" data-value="customHome" data-placement="top" data-title="Set the location using the button that will appear in the map zoom controls">\r\n							Custom&nbsp;\r\n						</button>\r\n					</span>\r\n				</div>\r\n			</td>\r\n			<td>\r\n				<span class="extentModeTooltip" data-placement="right" data-title="The location people see when they open your Shortlist" >\r\n					<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n				</span>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n\r\n	<div class="generalSettingsButtons">\r\n		<div class="checkbox opt-container">\r\n			<label>\r\n				<input type="checkbox" class="opt-checkbox-numbered-icons" />\r\n				Show places with numbers\r\n			</label>\r\n		</div>\r\n		<div class="checkbox opt-container">\r\n			<label>\r\n				<input type="checkbox" class="opt-checkbox-filter-by-extent" />\r\n				Only list places visible on the map (only applies in viewer)\r\n			</label>\r\n		</div>\r\n		<div class="bookmarksContainer">\r\n			<div class="checkbox opt-container" >\r\n				<label>\r\n					<input type="checkbox" class="opt-checkbox-bookmarks" />\r\n					Bookmarks\r\n				</label>\r\n				<div class="opt-bookmarks-alias-cont">\r\n					<label>\r\n						Menu name\r\n						<input type="text" class="opt-bookmarks-alias" />\r\n					</label>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<span class="bookmarkTooltip" data-placement="right" data-title="To enable bookmarks in Shortlist, add and manage the web map\'s bookmarks in the web map viewer" >\r\n			<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n		</span>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/settings/ViewGeneralOptions",[],function(){}),define("storymaps/tpl/builder/settings/ViewGeneralOptions",["lib-build/tpl!./ViewGeneralOptions","lib-build/css!./ViewGeneralOptions"],function(e){return function(){var n=null,r=null,i=null;this.init=function(t,i){n=t,r=i,r.append(e({})),r.find(".extentModeTooltip").tooltip({trigger:"hover"}),r.find(".defaultExtent").tooltip({trigger:"hover"}),r.find(".customHomeExtent").tooltip({trigger:"hover"}),r.find(".bookmarkTooltip").tooltip({trigger:"hover"}),s()},this.present=function(e){e.extentMode=="default"&&($('.tab-cfg-extent-mode .btn[data-value="default"]').addClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="customHome"]').removeClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="customTheme"]').removeClass("btn-primary")),e.extentMode=="customHome"&&($('.tab-cfg-extent-mode .btn[data-value="customHome"]').addClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="default"]').removeClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="customTheme"]').removeClass("btn-primary"));var t=app.data.getResponse()?app.data.getResponse().itemInfo.itemData.bookmarks:app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.itemData.bookmarks;t&&t.length?r.find(".bookmarkTooltip").tooltip({trigger:"hover"}):(r.find(".bookmarksContainer").children().addClass("disabled"),r.find(".bookmarksContainer").children().prop("disabled",!0),r.find(".bookmarksContainer").children().click(!1),r.find(".opt-bookmarks-alias-cont input").prop("disabled",!0),r.find(".bookmarkTooltip").tooltip({trigger:"hover"})),r.find(".opt-checkbox-numbered-icons").prop("checked",e.numberedIcons),r.find(".opt-checkbox-filter-by-extent").prop("checked",e.filterByExtent),r.find(".opt-checkbox-bookmarks").prop("checked",e.bookmarks),r.find(".opt-bookmarks-alias").val(e.bookmarksAlias),i=e},this.show=function(){},this.save=function(){return{extentMode:r.find(".tab-cfg-extent-mode .btn-primary").data().value,numberedIcons:r.find(".opt-checkbox-numbered-icons").prop("checked"),filterByExtent:r.find(".opt-checkbox-filter-by-extent").prop("checked"),bookmarks:r.find(".opt-checkbox-bookmarks").prop("checked"),bookmarksAlias:r.find(".opt-bookmarks-alias").val()}},this.initLocalization=function(){n.html("General options")};var s=function(){$('.tab-cfg-extent-mode .btn[data-value="default"]').click(function(){$('.tab-cfg-extent-mode .btn[data-value="default"]').addClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="customHome"]').removeClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="customTheme"]').removeClass("btn-primary")}),$('.tab-cfg-extent-mode .btn[data-value="customHome"]').click(function(){$('.tab-cfg-extent-mode .btn[data-value="customHome"]').addClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="default"]').removeClass("btn-primary"),$('.tab-cfg-extent-mode .btn[data-value="customTheme"]').removeClass("btn-primary")})}}}),define("lib-build/tpl!storymaps/tpl/builder/settings/ViewMapOptions",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-mapoptions">\r\n	<div class="checkbox">\r\n		<label>\r\n			<input type="checkbox" class="opt-checkbox-locateBtn" />\r\n			Locate Button\r\n			<a href="#" class="help" data-toggle="tooltip" data-placement="right">\r\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n			</a>\r\n		</label>\r\n	</div>\r\n	<div class="checkbox">\r\n		<label>\r\n			<input type="checkbox" class="opt-checkbox-place-finder" />\r\n			Address or Place Finder\r\n			<a href="#" class="help" data-toggle="tooltip" data-placement="right">\r\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n			</a>\r\n		</label>\r\n	</div>\r\n	<div class="checkbox" >\r\n		<label>\r\n			<input type="checkbox" class="opt-checkbox-bookmarks" />\r\n			Bookmarks\r\n			<a href="#" class="help" data-toggle="tooltip" data-placement="right">\r\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n			</a>\r\n		</label>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/settings/ViewMapOptions",[],function(){}),define("storymaps/tpl/builder/settings/ViewMapOptions",["lib-build/tpl!./ViewMapOptions","lib-build/css!./ViewMapOptions"],function(e){return function(){var n=null,r=null,i=null;this.init=function(t,i){n=t,r=i,r.append(e({})),r.find(".help").tooltip({trigger:"hover"})},this.present=function(e){r.find(".opt-checkbox-locateBtn").prop("checked",e.locateBtn&&e.locateBtn.enable),r.find(".opt-checkbox-geocoder").prop("checked",e.geocoder&&e.geocoder.enable),r.find(".opt-checkbox-bookmarks").prop("checked",e.bookmarks),i=e},this.show=function(){},this.save=function(){return{locateBtn:{enable:r.find(".opt-checkbox-locateBtn").prop("checked")},geocoder:{enable:r.find(".opt-checkbox-geocoder").prop("checked")},bookmarks:r.find(".opt-checkbox-bookmarks").prop("checked")}},this.initLocalization=function(){n.html("Map options")}}}),define("lib-build/tpl!storymaps/common/builder/settings/ViewHeader",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-header">\r\n	<div class="settings-simulator">\r\n		<img class="imgLogo"/>\r\n	</div>\r\n	<div class="settings-content">\r\n		<form role="form" class="form1">\r\n			<div class="form-group form-inline form-horizontal">\r\n				<div class="radio">\r\n					<label>\r\n						<input type="radio" name="optionsLogo" id="optionsRadios2" value="esri" checked>\r\n						<span class="logoText">'+((__t=logoEsri)==null?"":__t)+'</span>\r\n					</label>\r\n				</div>\r\n				<div class="radio">\r\n					<label>\r\n						<input type="radio" name="optionsLogo" id="optionsRadios1" value="none">\r\n						<span class="logoText">'+((__t=logoNone)==null?"":__t)+'</span>\r\n					</label>\r\n				</div>\r\n				<div class="radio">\r\n					<label>\r\n						<input type="radio" name="optionsLogo" id="optionsRadios2" value="custom">\r\n						<span class="logoText">'+((__t=logoCustom)==null?"":__t)+'</span>\r\n					</label>\r\n				</div>\r\n				<div class="optionsLogoCustom">\r\n					<table class="settings-table">\r\n						<tr>\r\n							<td class="td-lbl">'+((__t=logoCustomlbl)==null?"":__t)+'</td>\r\n							<td class="td-input"><input class="form-control input-sm" id="logoInput" type="text" placeholder="'+((__t=logoCustomHelp)==null?"":__t)+'"></td>\r\n						</tr>\r\n						<tr>\r\n							<td class="td-lbl">'+((__t=logoLinkLbl)==null?"":__t)+'</td>\r\n							<td class="td-input"><input class="form-control input-sm" id="logoTargetInput" type="text" spellcheck="true" placeholder="'+((__t=logoTargetHelp)==null?"":__t)+'"></td>\r\n						</tr>\r\n					</table>\r\n				</div>\r\n			</div>\r\n		</form>\r\n		\r\n		<form class="form2">\r\n			<p>'+((__t=socialExplain)==null?"":__t)+'</p>\r\n			<div class="form-group socialConfig">\r\n				<div class="checkbox">\r\n					<label>\r\n						<input type="checkbox" class="enableFB" />\r\n						<span class="social-lbl">Facebook</span>\r\n					</label>\r\n				</div>\r\n				<div class="checkbox">\r\n					<label>\r\n						<input type="checkbox" class="enableTwitter" />\r\n						<span class="social-lbl">Twitter</span>\r\n					</label>\r\n				</div>\r\n				<div class="checkbox">\r\n					<label>\r\n						<input type="checkbox" class="enableBitly" />\r\n						<span class="social-lbl" style="word-break: break-all;">'+((__t=share)==null?"":__t)+'</span>\r\n					</label>\r\n				</div>\r\n			</div>\r\n			<table class="settings-table">\r\n				<tr>\r\n					<td class="td-lbl">'+((__t=socialText)==null?"":__t)+'</td>\r\n					<td class="td-input"><input id="selectSocialText" type="text" class="form-control input-sm" /></td>\r\n				</tr>\r\n				<tr>\r\n					<td class="td-lbl">'+((__t=socialLink)==null?"":__t)+'</td>\r\n					<td class="td-input"><input id="selectSocialLink" type="text" class="form-control input-sm" /></td>\r\n				</tr>\r\n			</table>\r\n		</form>\r\n	</div>\r\n	<form class="form-config-size">\r\n		<div class="checkbox">\r\n			<label>\r\n				<input type="checkbox" class="enableCompact" />\r\n				<span>'+((__t=lblSmallHeader)==null?"":__t)+"</span>\r\n			</label>\r\n		</div>\r\n	</form>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/settings/ViewHeader",[],function(){}),define("storymaps/common/builder/settings/ViewHeader",["lib-build/tpl!./ViewHeader","lib-build/css!./ViewHeader","../../utils/CommonHelper"],function(e,t,n){return function(r){function f(){v()}function l(){}function c(){a=!0,s.find(".imgLogo").hide()}function h(e){if(e.keyCode==13)return a=!1,p(),!1;e.keyCode==8&&($("#logoTargetInput").focus(),$("#logoInput").focus())}function p(){var e=$.trim($("#logoInput",s).val());s.find(".imgLogo").attr("src",n.prependURLHTTP(e)).show()}function d(e){e.keyCode==8&&($("#logoInput").focus(),$("#logoTargetInput").focus())}function v(){var e=$("input[name=optionsLogo]:checked",s).val();s.find(".imgLogo").hide(),e=="custom"?p():e=="esri"&&s.find(".imgLogo").attr("src","resources/tpl/viewer/icons/esri-logo.png").show()}var i=null,s=null,o=null,u=null,a=!1;r=r||{},this.init=function(t,n){i=t,s=n,s.append(e({explain:i18n.commonCore.settingsHeader.explain,logoEsri:i18n.commonCore.settingsHeader.logoEsri,logoNone:i18n.commonCore.settingsHeader.logoNone,logoCustom:i18n.commonCore.settingsHeader.logoCustom,logoCustomlbl:"Image:",logoLinkLbl:i18n.commonCore.settingsHeader.logoSocialLink+":",logoCustomHelp:i18n.commonCore.settingsHeader.logoCustomPlaceholder,logoTargetHelp:i18n.commonCore.settingsHeader.logoCustomTargetPlaceholder,socialExplain:i18n.commonCore.settingsHeader.logoSocialExplain,socialText:i18n.commonCore.settingsHeader.logoSocialText+":",socialLink:i18n.commonCore.settingsHeader.logoSocialLink+":",lblSmallHeader:i18n.commonCore.settingsHeader.lblSmallHeader,share:i18n.commonCore.builderPanel.buttonShare})),o=s.find("#logoInput"),u=s.find("#logoTargetInput"),o.keydown(h),o.focusout(p),u.keydown(d),$("input[type=radio]",s).click(f),$("#imgLogo",s).error(c),$("#imgLogo",s).load(l),s.find(".form-config-size").toggle(r.smallSizeOpt)},this.present=function(e){var t=e.logoURL,n=app.data.getWebAppData().getColors();o.attr("disabled","true"),u.attr("disabled","true"),$("input[name='optionsLogo']",s).change(function(){var e=$("input[name='optionsLogo']:checked",s).val();e=="none"||e=="esri"?(o.attr("disabled","true"),u.attr("disabled","true")):(o.removeAttr("disabled"),u.removeAttr("disabled"))}),$("#headerSimulator",s).css("background-color",n),t==app.cfg.HEADER_LOGO_URL||t==null?($("input[name=optionsLogo]:eq(0)",s).attr("checked","checked"),$("#imgLogo",s).show(),o.val(""),u.val("")):t==="NO_LOGO"?($("input[name=optionsLogo]:eq(1)",s).attr("checked","checked"),o.val(""),u.val("")):($("input[name=optionsLogo]:eq(2)",s).attr("checked","checked"),$("#imgLogo",s).attr("src",t),$("#imgLogo",s).show(),$("#logoInput",s).val(t),u.val(e.logoTarget),o.removeAttr("disabled"),u.removeAttr("disabled")),$("#selectSocialText",s).val(e.linkText===undefined?app.cfg.HEADER_LINK_TEXT:e.linkText),$("#selectSocialLink",s).val(e.linkURL===undefined?app.cfg.HEADER_LINK_URL:e.linkURL),$("#selectSocialText",s).blur(function(){$(window).scrollTop(0)}),$("#selectSocialLink",s).blur(function(){$(window).scrollTop(0)}),$("#logoInput",s).blur(function(){$(window).scrollTop(0)}),u.blur(function(){$(window).scrollTop(0)}),app.cfg.HEADER_SOCIAL.facebook?(!e.social||e.social.facebook)&&$(".enableFB",s).prop("checked",!0):$(".enableFB",s).attr("disabled","disabled").parent().addClass("disabled").attr("title",i18n.commonCore.common.disabledAdmin),app.cfg.HEADER_SOCIAL.twitter?(!e.social||e.social.twitter)&&$(".enableTwitter",s).prop("checked",!0):$(".enableTwitter",s).attr("disabled","disabled").parent().addClass("disabled").attr("title",i18n.commonCore.common.disabledAdmin),!app.cfg.HEADER_SOCIAL.bitly||!app.cfg.HEADER_SOCIAL.bitly.enable||!app.cfg.HEADER_SOCIAL.bitly.login||!app.cfg.HEADER_SOCIAL.bitly.key?$(".enableBitly",s).attr("disabled","disabled").parent().addClass("disabled").attr("title",i18n.commonCore.common.disabledAdmin):(!e.social||e.social.bitly)&&$(".enableBitly",s).prop("checked",!0),v(),s.find(".enableCompact").prop("checked",e.compactSize||e.compactSize===undefined)},this.show=function(){setTimeout(function(){var e=Math.max.apply(Math,s.find(".td-lbl").map(function(){return $(this).width()}).get());s.find(".td-lbl").css("min-width",e)},200)},this.save=function(){var e=s.find("input[name=optionsLogo]:checked").val(),t,r;e=="none"?(t="NO_LOGO",r=""):e=="esri"?(t=null,r=""):(t=a?app.cfg.HEADER_LOGO_URL:n.prependURLHTTP(s.find(".imgLogo").attr("src")),r=u.val());var i=$("#selectSocialText",s).val()||"";i=i.replace(/<\/?script>/g,"");var o=$("#selectSocialLink",s).val()||"";return o=o.replace(/<\/?script>/g,""),{linkText:i,linkURL:n.prependURLHTTP(o),logoURL:t,logoTarget:n.prependURLHTTP(r),social:{facebook:$(".enableFB").prop("checked"),twitter:$(".enableTwitter").prop("checked"),bitly:$(".enableBitly").prop("checked")},compactSize:s.find(".enableCompact").prop("checked")}},this.initLocalization=function(){i.html(i18n.commonCore.settingsHeader.title)}}}),define("lib-build/tpl!storymaps/tpl/builder/MapExtentSave",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div title="Save home location" class="home-location-save-btn btn btn-default location-changed">\r\n	<div class="home-location-save-logo" tabindex="0"></div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/MapExtentSave",[],function(){}),define("storymaps/tpl/builder/MapExtentSave",["lib-build/tpl!./MapExtentSave","lib-build/css!./MapExtentSave","storymaps/common/utils/CommonHelper","esri/geometry/Extent","dojo/topic"],function(e,t,n,r,i){return function(r,s){function f(){o.hide(),app.data.getWebMap().item.extent=a.serializeExtentToItem(app.map.extent),app.data.getWebAppData().setMapExtent(app.map.extent),$.each(app.data.getStory(),function(e){app.data.setStory(e,null,null,app.map.extent)}),i.publish("BUILDER_INCREMENT_COUNTER",1)}function l(){$(".home-location-save-btn").click(f),app.map.on("extent-change",function(){var e=u.serializeExtentToItem(app.map.extent);u.serializedExtentEquals(e,app.data.getWebMap().item.extent)?o.hide():setTimeout(function(){o.show()},250)}),o.initDone=!0}var o=this,u=n,a=s;this.init=function(){$("#map_zoom_slider").append(e()),l()},this.initDone=!1,this.present=function(){l()},this.show=function(){$(".home-location-save-btn").show()},this.reinit=function(){$(".home-location-save-btn").css("visibility","visible"),$(".home-location-save-btn").show()},this.hide=function(){$(".home-location-save-btn").hide()},this.hideAlways=function(){$(".home-location-save-btn").css("visibility","hidden")}}}),define("lib-build/tpl!storymaps/tpl/builder/Workflow",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="addFeatures" tabindex="-1">\r\n	Would you like to build your shortlist by adding features?\r\n</div>\r\n\r\n<div id="addWebMap" tabindex="-1">\r\n	Or would you like to build your shortlist from an existing web map?\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/Workflow",[],function(){}),define("lib-build/tpl!storymaps/tpl/builder/Data",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="oneLayer" tabindex="-1">\r\n	Are all of your features in one layer and need to be split up into different tabs?\r\n</div>\r\n\r\n<div id="multiLayers" tabindex="-1">\r\n	Or do you have several layers that will each make up a tab?\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/Data",[],function(){}),define("storymaps/tpl/builder/Data",["lib-build/tpl!./Data","lib-build/css!./Data"],function(e,t){return function(n){function i(){console.log("$$$")}function s(){n.find(".btnNext").attr("disabled"),n.find(".btnNext").click(i),r=!0}var r=!1;this.present=function(t){n.find(".modal-body").empty(),n.find(".modal-body").append(e()),s()},this.close=function(){}}}),define("storymaps/tpl/builder/Workflow",["lib-build/tpl!./Workflow","lib-build/css!./Workflow","./Data"],function(e,t,n){return function(r){function o(){console.log("$$$"),s.present()}function u(){r.find(".btnNext").attr("disabled"),r.find(".btnNext").click(o),i=!0}var i=!1,s=new n(r);this.present=function(t){r.find(".modal-body").empty(),r.find(".modal-body").append(e()),u()},this.close=function(){}}}),define("lib-build/tpl!storymaps/tpl/builder/AddFeatureBar",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div id="addFeatureBar">\r\n	<button id="addFeature" class="btn btn-success">Add</button>\r\n	<button id="importFeature" class="btn btn-success">Import</button>\r\n	<button id="organizeFeatures" class="btn btn-primary">Organize</button>\r\n	<button id="locateFeatures" class="btn btn-warning">\r\n		<span class="unlocatedFeatures"></span>\r\n	</button>\r\n	<button id="completeOrganization" class="btn btn-success">Done</button>\r\n	<button id="deleteFeatures" class="btn btn-danger disabled">Delete</button>\r\n	<div id="moveFeaturesContainer" class="dropdown">\r\n		<button class="btn btn-default dropdown-toggle disabled" type="button" id="moveFeaturesDropdownMenu" data-toggle="dropdown">\r\n			Move\r\n			<span class="caret"></span>\r\n		</button>\r\n		<ul id="tabSelector" class="dropdown-menu" >\r\n		</ul>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/AddFeatureBar",[],function(){}),define("storymaps/tpl/builder/AddFeatureBar",["lib-build/tpl!./AddFeatureBar","lib-build/css!./AddFeatureBar","../core/WebApplicationData","../core/Helper","./BuilderHelper","esri/geometry/Point","esri/geometry/Extent","esri/symbols/SimpleMarkerSymbol","esri/layers/GraphicsLayer","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/graphicsUtils","esri/layers/FeatureLayer","esri/graphic","dojo/topic","dojo/_base/lang"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return function(a,c){function T(e,t){var n=t*4,r=e.data;return[r[n],r[n+1],r[n+2],r[n+3]]}function N(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function C(e,t){var n=(new esri.symbol.PictureMarkerSymbol(e.toDataURL(),t.getWidth(),t.getHeight())).setOffset(t.getOffsetX(),t.getOffsetY());return n}function k(){var e={};e.mode="import",y.present(e).then(function(e){$("body").addClass("loadingPlaces");var t=180,n=90,r=-180,i=-90;if(!e)return;$.each(e,function(e,s){m.addFeature(s,!1),s.lng&&s.lat&&(s.lng>r&&(r=s.lng),s.lng<t&&(t=s.lng),s.lat>i&&(i=s.lat),s.lat<n&&(n=s.lat))}),app.data.getWebAppData().getGeneralOptions().extentMode=="default"&&x.updateShortlistExtent();if(e.length>1&&t!=180&&n!=90&&r!=-180&&i!=-90){var s=new o(t,n,r,i,new f({wkid:4326}));app.map.setExtent(s,!0),app.map.getLayer(app.data.getShortlistLayerId()).redraw()}var u=$(".entry.active").index(),a=$(".detailContainer")[u];$(a).hide(),$("#editorDialogInlineMedia").hide(),m.updateLocatedFeatures(),setTimeout(function(){$("body").removeClass("loadingPlaces")},500)})}function L(){$("body").addClass("organizeFeatures"),$(".builder-content-panel .builder-content-panel-group").addClass("disabled"),$(".builder-lbl").addClass("disabled"),$(".builder-content-panel.inline .builder-btn").addClass("disabled"),app.ui.tilePanel.initSortable(),$("#addFeature").hide(),$("#importFeature").hide(),$("#organizeFeatures").hide(),$("#locateFeatures").hide(),$("#deleteFeatures").addClass("disabled"),$("#deleteFeatures").prop("disabled",!0),$("#moveFeaturesDropdownMenu").addClass("disabled"),$("#completeOrganization").show(),$("#deleteFeatures").show();var e=$(".entry.active").index();$(".dropdown-menu .entry").length>1&&($("#tabSelector").empty(),$.each($(".dropdown-menu .entry"),function(t){t==e?$("#tabSelector").append($('<li class="disabledTab"><a href="#">'+app.data.getStory()[t].title+"</a></li>")):$("#tabSelector").append($('<li class="enabledTab"><a href="#">'+app.data.getStory()[t].title+"</a></li>"))}),e===0&&$("#tabSelector option:eq(1)"),$("#moveFeaturesContainer").css("display","inline-block")),a.find("#moveFeaturesContainer li.enabledTab").on("click",O),$("#myList").find("li").on("click",function(){$("body").hasClass("organizeFeatures")&&($(this).toggleClass("selected"),$("#myList").find("li.selected").length?($("#deleteFeatures").removeClass("disabled"),$("#deleteFeatures").prop("disabled",!1),$("#moveFeaturesDropdownMenu").removeClass("disabled")):($("#deleteFeatures").addClass("disabled"),$("#moveFeaturesDropdownMenu").addClass("disabled")))})}function A(){var e=$("#myList").find("li.selected"),t=app.map.getLayer(app.data.getShortlistLayerId());$.each(e,function(e,n){var r=$.grep(t.graphics,function(e){return e.attributes.shortlist_id==$(n).data("shortlist-id")});t.remove(r[0])});var n=$(".entry.active").index(),r=[];$.each(t.graphics,function(e,t){t.attributes.tab_id==n?(r.push(t),t.attributes.locationSet&&t.show()):t.hide()}),app.layerCurrent.graphics=r,m.updateAllFeatures(),x.updateShortlistExtent(),app.ui.tilePanel.buildTilePanel(),app.detailPanelBuilder.buildSlides(),m.updateLocatedFeatures(),$("#myList").find("li").on("click",function(){$("body").hasClass("organizeFeatures")&&$(this).toggleClass("selected")}),$("#deleteFeatures").addClass("disabled"),$("#moveFeaturesDropdownMenu").addClass("disabled"),m.exitOrganizeMode()}function O(){var e=$(this).index(),t=$("#myList").find("li.selected"),r=app.map.getLayer(app.data.getShortlistLayerId()),i=900;$.each(t,function(t,n){var s=$.grep(r.graphics,function(e){return e.attributes.shortlist_id==$(n).data("shortlist-id")});s[0].attributes.tab_id=e,s[0].attributes.number=i,s[0].attr("number",i),i++}),m.updateAllFeatures();var s=$(".entry.active").index(),o=[];$.each(r.graphics,function(e,t){t.attributes.tab_id==s?(t.show(),o.push(t)):t.hide()}),app.layerCurrent.graphics=o,app.ui.tilePanel.buildTilePanel(),m.updateLocatedFeatures(!0),$("#deleteFeatures").addClass("disabled"),$("#moveFeaturesDropdownMenu").addClass("disabled"),m.exitOrganizeMode(!0),n.getTitle()&&d.publish("BUILDER_INCREMENT_COUNTER")}function M(){$("body").addClass("locateFeatures"),$(".located").hide(),$("#addFeature").hide(),$("#importFeature").hide(),$("#organizeFeatures").hide(),$("#completeOrganization").show(),$("#locateFeatures").hide(),app.detailPanelBuilder.buildSlides(!0)}function _(){v=!0}function D(){a.find("#addFeature").on("click",m.addFeature),a.find("#importFeature").on("click",k),a.find("#organizeFeatures").on("click",L),a.find("#locateFeatures").on("click",M),a.find("#completeOrganization").on("click",m.exitOrganizeMode),a.find("#deleteFeatures").on("click",A)}var v=!1,m=this,g,y=c,b=new r,w,E,S,x;this.loaded=!1,this.init=function(t,n){m.loaded=!0,g=t,x=n,setTimeout(function(){a.find("#paneLeft").prepend(e()),_(),D(),m.updateLocatedFeatures()},0),$("#importFeature").prop("disabled",!0),E=document.createElement("canvas"),S=E.getContext("2d"),w=new Image,w.src=app.cfg.ICON_SRC,w.onload=function(){S.drawImage(w,0,0),S.font=E.width/2+"pt Calibri"},$("#myList").addClass("builder")},this.close=function(){},this.addLayer=function(e){var t=i.getNewLayerJSON(i.getFeatureCollectionTemplate(!0));app.data.getWebMap().itemData.operationalLayers.push(t),n.setShortlistLayerId(t.id);var r=new h(t.featureCollection.layers[0]);r.id=t.id,app.map?app.map.addLayer(r):setTimeout(function(){app.map.addLayer(r)},500),app.data.setShortlistLayerId(t.id),app.layerCurrent=r,r.on("mouse-over",app.ui.mainView.layer_onMouseOver),r.on("mouse-out",app.ui.mainView.layer_onMouseOut),r.on("click",app.ui.mainView.layer_onClick);if(app.isInBuilder&&(app.isDirectCreationFirstSave||e||app.isGalleryCreation)){app.detailPanelBuilder.addDetailPanelSwiper(0);var s=app.cfg.COLOR_ORDER.split(","),o=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name.toLowerCase()==$.trim(s[0].toLowerCase())})[0];app.data.setStory(0,"Tab 1",o.color),n.setTabs(app.data.getStory()),app.ui.mainView.activateLayer(0)}},this.addFeature=function(e,t,r){e&&e.type=="click"&&(e=null);var i=$(".entry.active").index();i<0&&(i=0);var o=app.map.getLayer(app.data.getShortlistLayerId()),c=$.grep(o.graphics,function(e){return e.attributes.tab_id==i}),h=c.length,v=app.cfg.COLOR_ORDER.split(","),g=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==v[i]}),y=app.data.getStory()[i].color,b=e&&e.name?e.name:"Place Name",w=e&&e.thumb_url?e.thumb_url:null,E;w||(w=e&&e.pic_url?e.pic_url:null),w&&(E=$('<li tabindex="0" id="item'+(h+1)+'" style="display:block"><div class="footer"><div class="blurb  ">'+b+'</div></div><div class="tileImage" style="outline: none; background-image: url('+w+');"></div></li>')),w||(E=$('<li tabindex="0" id="item'+(h+1)+'" style="display:block"><div class="footer"><div class="blurb  ">'+b+'</div></div><div class="tileImage" style="outline: none;" ><i class=" fa fa-camera" aria-hidden="true"></i></div></li>')),n.getGeneralOptions().numberedIcons&&$(E).find(".footer").prepend($('<div class="num" style="background-color:'+y+'">'+(h+1)+"</div>")),a.find("#myList").append(E);var S=o.graphics.length+1;$(E).data("shortlist-id",S),$(E).on("click",function(){var e=this;if($("body").hasClass("organizeFeatures"))return;app.detailPanelBuilder.showSlide($(this).data("shortlist-id")),app.ui.mainView.preSelection(),app.ui.mainView.selected=$.grep(o.graphics,function(t){return t.attributes.shortlist_id==$(e).data("shortlist-id")})[0],app.ui.mainView.postSelection()}),$(E).on("mouseover",app.ui.tilePanel.tile_onMouseOver),$(E).on("mouseout",app.ui.tilePanel.tile_onMouseOut),app.detailPanelBuilder.addSlide(c.length+1,S,e),app.detailPanelBuilder.showSlide(S);var x,T={__OBJECTID:S,name:e&&e.name?e.name:"",description:e&&e.description?e.description:"",pic_url:e&&e.pic_url?e.pic_url:"",thumb_url:e&&e.thumb_url?e.thumb_url:"",shortlist_id:S,number:c.length+1,tab_id:i,locationSet:r?1:0};if(!r){var N=45,C=45,k=0;e&&e.lng&&e.lat?(N=e.lng,C=e.lat,k=1,$(E).addClass("located")):$(E).find(".tileImage").append('<div class="unlocated" style="outline: none;"></div>');var L=new s(N,C,new f({wkid:4326}));x=l.geographicToWebMercator(L),T.locationSet=k}else $(E).addClass("located"),x=r;var A=new u,O=new p(x,A,T),M=m.addMapIcon(O,app.data.getStory()[i].color);o.add(M),app.layerCurrent.add(M),c.push(M),T.locationSet||M.hide(),m.updateLocatedFeatures(),n.getTitle()&&d.publish("BUILDER_INCREMENT_COUNTER")},this.updateAllFeatures=function(e){var t=0,r=app.map.getLayer(app.data.getShortlistLayerId()),i=r.graphics,s={};$.each(i,function(e,t){t.attributes.tab_id in s||(s[t.attributes.tab_id]=t.attributes.tab_id)});if(e){$.each(e.entries,function(e,t){delete s[t.id]});var o=i.slice(0);$.each(o,function(e,t){t.attributes.tab_id in s&&r.remove(t)});var u=[];$.each(e.entries,function(e,t){u.push($.grep(i,function(e){return e.attributes.tab_id==t.id}))}),$.each(u,function(e,t){$.each(t,function(t,n){n.attributes.tab_id=e}),t.id=e})}var a=[],f=$("#nav-bar").find(".nav-tabs > li:not(.dropdown)");$.each(f,function(){a.push([])}),$.each(i,function(e,t){a[t.attributes.tab_id].push(t)});var l=[],c=[];$.each(a,function(n,r){r.sort(function(e,t){return parseInt(e.attributes.number)-parseInt(t.attributes.number)});var i=e&&e.entries[n].color?e.entries[n].color:app.data.getStory()[n].color,s=e&&e.entries[n].title?e.entries[n].title:app.data.getStory()[n].title;$.each(r,function(e,n){n.attributes.shortlist_id=t,n.attributes.number=e+1;var r=m.addMapIcon(n,i);n.symbol=r.symbol,t++}),l.push(s),c.push(i)}),app.data.clearStory(),$.each(a,function(e){app.data.setStory(e,l[e],c[e])}),n.setTabs(app.data.getStory());var h=$(".entry.active").index();e&&(h=e.sectionIndex),app.ui.tilePanel.buildTilePanel(),r.redraw(),n.getTitle()&&d.publish("BUILDER_INCREMENT_COUNTER")},this.exitOrganizeMode=function(e){$("body").hasClass("organizeFeatures")&&app.ui.tilePanel.destroySortable(),$("#myList").find("li").removeClass("selected"),$(".builder-content-panel .builder-content-panel-group").removeClass("disabled"),$(".builder-lbl").removeClass("disabled"),$(".builder-content-panel.inline .builder-btn").removeClass("disabled"),$(".located").show(),$("#addFeature").show(),$("#importFeature").show(),$("#organizeFeatures").show(),m.updateLocatedFeatures(),$("#completeOrganization").hide(),$("#deleteFeatures").hide(),$("#moveFeaturesContainer").hide(),$("#myList").find("li").off(),$("body").removeClass("locateFeatures"),$("#myList").find("li").click(app.ui.tilePanel.tile_onClick),$("#myList").find("li").mouseover(app.ui.tilePanel.tile_onMouseOver),$("#myList").find("li").mouseout(app.ui.tilePanel.tile_onMouseOut),app.layerCurrent.graphics.length?e?app.detailPanelBuilder.buildAllSlides():app.detailPanelBuilder.buildSlides():($("#locateFeatures").hide(),$("#organizeFeatures").hide())},this.updateLocatedFeatures=function(e){var t=[];app.layerCurrent&&(t=app.layerCurrent.graphics);var n=e||$(".entry.active").index();n<0&&(n=0);var r=$.grep(t,function(e){return e.attributes.tab_id==n});setTimeout(function(){r.length&&!$("body").hasClass("organizeFeatures")&&!$("body").hasClass("locateFeatures")?$("#organizeFeatures").show():$("#organizeFeatures").hide()},50);var i=$.grep(r,function(e){return!e.attributes.locationSet});$(".unlocatedFeatures").text(i.length);if(i.length>0&&!$("body").hasClass("organizeFeatures"))$("#locateFeatures").show();else{if(app.isLoading)return;$("#locateFeatures").hide()}i.length===0&&$("#locateFeatures").hide(),t.length===0&&$("#organizeFeatures").hide(),d.publish("BUILDER_INCREMENT_COUNTER")},this.updateNumber=function(){$.each($(".tilelist li"),function(e,t){var n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")});n[0].attributes.number=e+1,$(t).attr("id","item"+e),$(t).find(".num").text(e+1),app.layerCurrent.graphics.sort(function(e,t){return e.attributes.number-t.attributes.number})});var e=$(".entry.active").index(),t=app.data.getStory()[e].color;$.each(app.layerCurrent.graphics,function(e,n){m.addMapIcon(n,t,!0)});var r=app.map.getLayer(app.data.getShortlistLayerId());r.redraw(),setTimeout(function(){app.detailPanelBuilder.buildSlides()},500),n.getTitle()&&d.publish("BUILDER_INCREMENT_COUNTER")},this.addMapIcon=function(e,t,r){var i=app.cfg.lutIconSpecs.tiny,s,o=t,u=document.createElement("canvas");u.width=w.width,u.height=w.height;var a=u.getContext("2d");a.font="bold "+u.width/3.8+"pt Calibri",a.drawImage(E,0,0);if(!s){var f=a.getImageData(0,0,E.width,E.height),l=T(f,4804);if(l[0]!=N(o).r||l[1]!=N(o).g||l[1]!=N(o).b){for(var c=0;c<f.data.length;c+=4)f.data[c]==l[0]&&f.data[c+1]==l[1]&&f.data[c+2]==l[2]&&(f.data[c]=N(o).r,f.data[c+1]=N(o).g,f.data[c+2]=N(o).b);a.putImageData(f,0,0)}s=f}a.putImageData(s,0,0);if(n.getGeneralOptions().numberedIcons){var h=e.attributes.number;a.textAlign="center",a.fillStyle="white",a.fillText(h,u.width/3.2,u.height/2)}if(!r){var p=new esri.Graphic(new esri.geometry.Point(e.geometry),C(u,i),e.attributes);return p}e.setSymbol(C(u,i))}}}),define("lib-build/tpl!storymaps/tpl/builder/DetailPanelBuilder",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="detailContainer swiper-container">\r\n	<button type="button" class=\'detailClose ion-android-close\' style=""></button>\r\n	<div class="detail-btn-container detail-btn-left">\r\n		<div class="detail-btn ion-chevron-left" style="outline: none;"></div>\r\n	</div>\r\n	<div class="detail-btn-container detail-btn-right">\r\n		<div class="detail-btn ion-chevron-right" style="outline: none;"></div>\r\n	</div>\r\n	<div class="detail-btn-container detail-btn-add" data-toggle="tooltip" title="Add another place">\r\n		<div class="detail-btn" style="outline: none;"> + </div>\r\n	</div>\r\n	<div class="detailView swiper-wrapper"></div>\r\n</div>\r\n';return __p}}),define("lib-build/tpl!storymaps/tpl/builder/DetailPanelBuilderSlide",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class=\'swiper-slide\'>\r\n	<div class=\'detailHeader\'>\r\n		<div class="detailFeatureNum" ></div>\r\n		<div class=\'detailFeatureTitle\'></div>\r\n	</div>\r\n	<div class="detailTextContainer">\r\n		<div class="detailPictureDiv">\r\n			<img style="max-width: 506px; max-height: 493px;" >\r\n			<div class="imagePicker"><span>Click to add an image<span></div>\r\n		</div>\r\n		<div class=\'description detailFeatureDesc editable\'></div>\r\n		<div class="website"></div>\r\n	</div>\r\n	<div class="editLocationContainer">\r\n		<button class="setLocation btn btn-warning" >Set Location</button>\r\n		<button class="editLocation btn btn-primary" >Change Location</button>\r\n		<button class="updateLocation btn btn-success" >Update</button>\r\n		<button class="cancelLocation btn btn-danger" >Cancel</button>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/DetailPanelBuilder",[],function(){}),"classList"in document.createElement("_")||function(e){"use strict";if(!("Element"in e))return;var t="classList",n="prototype",r=e.Element[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(){var e=arguments,t=0,n=e.length,r,i=!1;do r=e[t]+"",a(this,r)===-1&&(this.push(r),i=!0);while(++t<n);i&&this._updateClassName()},l.remove=function(){var e=arguments,t=0,n=e.length,r,i=!1,s;do{r=e[t]+"",s=a(this,r);while(s!==-1)this.splice(s,1),i=!0,s=a(this,r)}while(++t<n);i&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),t===!0||t===!1?t:!n},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self),function(e){"use strict";e.URL=e.URL||e.webkitURL;if(e.Blob&&e.URL)try{new Blob;return}catch(t){}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(t,n,r){this.data=t,this.size=t.length,this.type=n,this.encoding=r},i=n.prototype,s=r.prototype,o=e.FileReaderSync,u=function(e){this.code=this[this.name=e]},a="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),f=a.length,l=e.URL||e.webkitURL||e,c=l.createObjectURL,h=l.revokeObjectURL,p=l,d=e.btoa,v=e.atob,m=e.ArrayBuffer,g=e.Uint8Array,y=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;r.fake=s.fake=!0;while(f--)u.prototype[a[f]]=f+1;return l.createObjectURL||(p=e.URL=function(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","a"),n;return t.href=e,"origin"in t||(t.protocol.toLowerCase()==="data:"?t.origin=null:(n=e.match(y),t.origin=n&&n[1])),t}),p.createObjectURL=function(e){var t=e.type,n;t===null&&(t="application/octet-stream");if(e instanceof r)return n="data:"+t,e.encoding==="base64"?n+";base64,"+e.data:e.encoding==="URI"?n+","+decodeURIComponent(e.data):d?n+";base64,"+d(e.data):n+","+encodeURIComponent(e.data);if(c)return c.call(l,e)},p.revokeObjectURL=function(e){e.substring(0,5)!=="data:"&&h&&h.call(l,e)},i.append=function(e){var n=this.data;if(g&&(e instanceof m||e instanceof g)){var i="",s=new g(e),a=0,f=s.length;for(;a<f;a++)i+=String.fromCharCode(s[a]);n.push(i)}else if(t(e)==="Blob"||t(e)==="File"){if(!o)throw new u("NOT_READABLE_ERR");var l=new o;n.push(l.readAsBinaryString(e))}else e instanceof r?e.encoding==="base64"&&v?n.push(v(e.data)):e.encoding==="URI"?n.push(decodeURIComponent(e.data)):e.encoding==="raw"&&n.push(e.data):(typeof e!="string"&&(e+=""),n.push(unescape(encodeURIComponent(e))))},i.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},i.toString=function(){return"[object BlobBuilder]"},s.slice=function(e,t,n){var i=arguments.length;return i<3&&(n=null),new r(this.data.slice(e,i>1?t:this.data.length),n,this.encoding)},s.toString=function(){return"[object Blob]"},s.close=function(){this.size=0,delete this.data},n}(e);e.Blob=function(e,t){var r=t?t.type||"":"",i=new n;if(e)for(var s=0,o=e.length;s<o;s++)Uint8Array&&e[s]instanceof Uint8Array?i.append(e[s].buffer):i.append(e[s]);var u=i.getBlob(r);return!u.slice&&u.webkitSlice&&(u.slice=u.webkitSlice),u};var r=Object.getPrototypeOf||function(e){return e.__proto__};e.Blob.prototype=r(new e.Blob)}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content||this),function(e,t){"use strict";var n=typeof module=="object"&&process&&process.versions&&process.versions.electron;!n&&typeof module=="object"?module.exports=t:typeof define=="function"&&define.amd?define("lib-app/medium-editor/dist/js/medium-editor",[],function(){return t}):e.MediumEditor=t}(this,function(){"use strict";function e(e,t){return this.init(e,t)}return e.extensions={},function(t){function n(e,t){var n,r=Array.prototype.slice.call(arguments,2);t=t||{};for(var i=0;i<r.length;i++){var s=r[i];if(s)for(n in s)s.hasOwnProperty(n)&&typeof s[n]!="undefined"&&(e||t.hasOwnProperty(n)===!1)&&(t[n]=s[n])}return t}var r=!1;try{var i=document.createElement("div"),s=document.createTextNode(" ");i.appendChild(s),r=i.contains(s)}catch(o){}var u={isIE:navigator.appName==="Microsoft Internet Explorer"||navigator.appName==="Netscape"&&(new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(navigator.userAgent)!==null,isEdge:/Edge\/\d+/.exec(navigator.userAgent)!==null,isFF:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isMac:t.navigator.platform.toUpperCase().indexOf("MAC")>=0,keyCode:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DELETE:46,K:75,M:77,V:86},isMetaCtrlKey:function(e){return u.isMac&&e.metaKey||!u.isMac&&e.ctrlKey?!0:!1},isKey:function(e,t){var n=u.getKeyCode(e);return!1===Array.isArray(t)?n===t:-1===t.indexOf(n)?!1:!0},getKeyCode:function(e){var t=e.which;return null===t&&(t=e.charCode!==null?e.charCode:e.keyCode),t},blockContainerElementNames:["p","h1","h2","h3","h4","h5","h6","blockquote","pre","ul","li","ol","address","article","aside","audio","canvas","dd","dl","dt","fieldset","figcaption","figure","footer","form","header","hgroup","main","nav","noscript","output","section","video","table","thead","tbody","tfoot","tr","th","td"],emptyElementNames:["br","col","colgroup","hr","img","input","source","wbr"],extend:function(){var t=[!0].concat(Array.prototype.slice.call(arguments));return n.apply(this,t)},defaults:function(){var t=[!1].concat(Array.prototype.slice.call(arguments));return n.apply(this,t)},createLink:function(e,t,n,r){var i=e.createElement("a");return u.moveTextRangeIntoElement(t[0],t[t.length-1],i),i.setAttribute("href",n),r&&i.setAttribute("target",r),i},findOrCreateMatchingTextNodes:function(e,t,n){var r=e.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1),i=[],s=0,o=!1,a=null,f=null;while((a=r.nextNode())!==null){if(a.nodeType>3)continue;if(a.nodeType===3){!o&&n.start<s+a.nodeValue.length&&(o=!0,f=u.splitStartNodeIfNeeded(a,n.start,s)),o&&u.splitEndNodeIfNeeded(a,f,n.end,s);if(o&&s===n.end)break;if(o&&s>n.end+1)throw new Error("PerformLinking overshot the target!");o&&i.push(f||a),s+=a.nodeValue.length,f!==null&&(s+=f.nodeValue.length,r.nextNode()),f=null}else a.tagName.toLowerCase()==="img"&&(!o&&n.start<=s&&(o=!0),o&&i.push(a))}return i},splitStartNodeIfNeeded:function(e,t,n){return t!==n?e.splitText(t-n):null},splitEndNodeIfNeeded:function(e,t,n,r){var i,s;i=r+(t||e).nodeValue.length+(t?e.nodeValue.length:0)-1,s=(t||e).nodeValue.length-(i+1-n),i>=n&&r!==i&&s!==0&&(t||e).splitText(s)},splitByBlockElements:function(t){if(t.nodeType!==3&&t.nodeType!==1)return[];var n=[],r=e.util.blockContainerElementNames.join(",");if(t.nodeType===3||t.querySelectorAll(r).length===0)return[t];for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];if(s.nodeType===3)n.push(s);else if(s.nodeType===1){var o=s.querySelectorAll(r);o.length===0?n.push(s):n=n.concat(e.util.splitByBlockElements(s))}}return n},findAdjacentTextNodeWithContent:function(t,n,r){var i=!1,s,o=r.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);s=o.nextNode();while(s){if(s===n)i=!0;else if(i&&s.nodeType===3&&s.nodeValue&&s.nodeValue.trim().length>0)break;s=o.nextNode()}return s},findPreviousSibling:function(e){if(!e||u.isMediumEditorElement(e))return!1;var t=e.previousSibling;while(!t&&!u.isMediumEditorElement(e.parentNode))e=e.parentNode,t=e.previousSibling;return t},isDescendant:function(t,n,i){if(!t||!n)return!1;if(t===n)return!!i;if(t.nodeType!==1)return!1;if(r||n.nodeType!==3)return t.contains(n);var s=n.parentNode;while(s!==null){if(s===t)return!0;s=s.parentNode}return!1},isElement:function(t){return!!t&&t.nodeType===1},throttle:function(e,t){var n=50,r,i,s,o=null,u=0,a=function(){u=Date.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return!t&&t!==0&&(t=n),function(){var n=Date.now(),f=t-(n-u);return r=this,i=arguments,f<=0||f>t?(o&&(clearTimeout(o),o=null),u=n,s=e.apply(r,i),o||(r=i=null)):o||(o=setTimeout(a,f)),s}},traverseUp:function(e,t){if(!e)return!1;do{if(e.nodeType===1){if(t(e))return e;if(u.isMediumEditorElement(e))return!1}e=e.parentNode}while(e);return!1},htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},insertHTMLCommand:function(t,n){var r,i,s,o,a,f,l,c=!1,h=["insertHTML",!1,n];if(!e.util.isEdge&&t.queryCommandSupported("insertHTML"))try{return t.execCommand.apply(t,h)}catch(p){}r=t.getSelection();if(r.rangeCount){i=r.getRangeAt(0),l=i.commonAncestorContainer;if(u.isMediumEditorElement(l)&&!l.firstChild)i.selectNode(l.appendChild(t.createTextNode("")));else if(l.nodeType===3&&i.startOffset===0&&i.endOffset===l.nodeValue.length||l.nodeType!==3&&l.innerHTML===i.toString()){while(!u.isMediumEditorElement(l)&&l.parentNode&&l.parentNode.childNodes.length===1&&!u.isMediumEditorElement(l.parentNode))l=l.parentNode;i.selectNode(l)}i.deleteContents(),s=t.createElement("div"),s.innerHTML=n,o=t.createDocumentFragment();while(s.firstChild)a=s.firstChild,f=o.appendChild(a);i.insertNode(o),f&&(i=i.cloneRange(),i.setStartAfter(f),i.collapse(!0),e.selection.selectRange(t,i)),c=!0}return t.execCommand.callListeners&&t.execCommand.callListeners(h,c),c},execFormatBlock:function(t,n){var r=u.getTopBlockContainer(e.selection.getSelectionStart(t)),i;if(n==="blockquote"){if(r){i=Array.prototype.slice.call(r.childNodes);if(i.some(function(e){return u.isBlockContainer(e)}))return t.execCommand("outdent",!1,null)}if(u.isIE)return t.execCommand("indent",!1,n)}r&&n===r.nodeName.toLowerCase()&&(n="p"),u.isIE&&(n="<"+n+">");if(r&&r.nodeName.toLowerCase()==="blockquote"){if(u.isIE&&n==="<p>")return t.execCommand("outdent",!1,n);if((u.isFF||u.isEdge)&&n==="p")return i=Array.prototype.slice.call(r.childNodes),i.some(function(e){return!u.isBlockContainer(e)})&&t.execCommand("formatBlock",!1,n),t.execCommand("outdent",!1,n)}return t.execCommand("formatBlock",!1,n)},setTargetBlank:function(e,t){var n,r=t||!1;if(e.nodeName.toLowerCase()==="a")e.target="_blank";else{e=e.getElementsByTagName("a");for(n=0;n<e.length;n+=1)if(!1===r||r===e[n].attributes.href.value)e[n].target="_blank"}},removeTargetBlank:function(e,t){var n;if(e.nodeName.toLowerCase()==="a")e.removeAttribute("target");else{e=e.getElementsByTagName("a");for(n=0;n<e.length;n+=1)t===e[n].attributes.href.value&&e[n].removeAttribute("target")}},addClassToAnchors:function(e,t){var n=t.split(" "),r,i;if(e.nodeName.toLowerCase()==="a")for(i=0;i<n.length;i+=1)e.classList.add(n[i]);else{e=e.getElementsByTagName("a");for(r=0;r<e.length;r+=1)for(i=0;i<n.length;i+=1)e[r].classList.add(n[i])}},isListItem:function(e){if(!e)return!1;if(e.nodeName.toLowerCase()==="li")return!0;var t=e.parentNode,n=t.nodeName.toLowerCase();while(n==="li"||!u.isBlockContainer(t)&&n!=="div"){if(n==="li")return!0;t=t.parentNode;if(!t)return!1;n=t.nodeName.toLowerCase()}return!1},cleanListDOM:function(t,n){if(n.nodeName.toLowerCase()!=="li")return;var r=n.parentElement;r.parentElement.nodeName.toLowerCase()==="p"&&(u.unwrap(r.parentElement,t),e.selection.moveCursor(t,n.firstChild,n.firstChild.textContent.length))},splitOffDOMTree:function(e,t,n){var r=t,i=null,s=!n;while(r!==e){var o=r.parentNode,u=o.cloneNode(!1),a=s?r:o.firstChild,f;i&&(s?u.appendChild(i):f=i),i=u;while(a){var l=a.nextSibling;a===r?(a.hasChildNodes()?a=a.cloneNode(!1):a.parentNode.removeChild(a),a.textContent&&i.appendChild(a),a=s?l:null):(a.parentNode.removeChild(a),(a.hasChildNodes()||a.textContent)&&i.appendChild(a),a=l)}f&&i.appendChild(f),r=o}return i},moveTextRangeIntoElement:function(e,t,n){if(!e||!t)return!1;var r=u.findCommonRoot(e,t);if(!r)return!1;if(t===e){var i=e.parentNode,s=e.nextSibling;return i.removeChild(e),n.appendChild(e),s?i.insertBefore(n,s):i.appendChild(n),n.hasChildNodes()}var o=[],a,f,l;for(var c=0;c<r.childNodes.length;c++){l=r.childNodes[c];if(!a)u.isDescendant(l,e,!0)&&(a=l);else{if(u.isDescendant(l,t,!0)){f=l;break}o.push(l)}}var h=f.nextSibling,p=r.ownerDocument.createDocumentFragment();return a===e?(a.parentNode.removeChild(a),p.appendChild(a)):p.appendChild(u.splitOffDOMTree(a,e)),o.forEach(function(e){e.parentNode.removeChild(e),p.appendChild(e)}),f===t?(f.parentNode.removeChild(f),p.appendChild(f)):p.appendChild(u.splitOffDOMTree(f,t,!0)),n.appendChild(p),f.parentNode===r?r.insertBefore(n,f):h?r.insertBefore(n,h):r.appendChild(n),n.hasChildNodes()},depthOfNode:function(e){var t=0,n=e;while(n.parentNode!==null)n=n.parentNode,t++;return t},findCommonRoot:function(e,t){var n=u.depthOfNode(e),r=u.depthOfNode(t),i=e,s=t;while(n!==r)n>r?(i=i.parentNode,n-=1):(s=s.parentNode,r-=1);while(i!==s)i=i.parentNode,s=s.parentNode;return i},isElementAtBeginningOfBlock:function(e){var t,n;while(!u.isBlockContainer(e)&&!u.isMediumEditorElement(e)){n=e;while(n=n.previousSibling){t=n.nodeType===3?n.nodeValue:n.textContent;if(t.length>0)return!1}e=e.parentNode}return!0},isMediumEditorElement:function(e){return e&&e.getAttribute&&!!e.getAttribute("data-medium-editor-element")},getContainerEditorElement:function(e){return u.traverseUp(e,function(e){return u.isMediumEditorElement(e)})},isBlockContainer:function(e){return e&&e.nodeType!==3&&u.blockContainerElementNames.indexOf(e.nodeName.toLowerCase())!==-1},getClosestBlockContainer:function(e){return u.traverseUp(e,function(e){return u.isBlockContainer(e)||u.isMediumEditorElement(e)})},getTopBlockContainer:function(e){var t=u.isBlockContainer(e)?e:!1;return u.traverseUp(e,function(e){return u.isBlockContainer(e)&&(t=e),!t&&u.isMediumEditorElement(e)?(t=e,!0):!1}),t},getFirstSelectableLeafNode:function(e){while(e&&e.firstChild)e=e.firstChild;e=u.traverseUp(e,function(e){return u.emptyElementNames.indexOf(e.nodeName.toLowerCase())===-1});if(e.nodeName.toLowerCase()==="table"){var t=e.querySelector("th, td");t&&(e=t)}return e},getFirstTextNode:function(e){return u.warn("getFirstTextNode is deprecated and will be removed in version 6.0.0"),u._getFirstTextNode(e)},_getFirstTextNode:function(e){if(e.nodeType===3)return e;for(var t=0;t<e.childNodes.length;t++){var n=u._getFirstTextNode(e.childNodes[t]);if(n!==null)return n}return null},ensureUrlHasProtocol:function(e){return e.indexOf("://")===-1?"http://"+e:e},warn:function(){t.console!==undefined&&typeof t.console.warn=="function"&&t.console.warn.apply(t.console,arguments)},deprecated:function(e,t,n){var r=e+" is deprecated, please use "+t+" instead.";n&&(r+=" Will be removed in "+n),u.warn(r)},deprecatedMethod:function(e,t,n,r){u.deprecated(e,t,r),typeof this[t]=="function"&&this[t].apply(this,n)},cleanupAttrs:function(e,t){t.forEach(function(t){e.removeAttribute(t)})},cleanupTags:function(e,t){t.forEach(function(t){e.nodeName.toLowerCase()===t&&e.parentNode.removeChild(e)})},getClosestTag:function(e,t){return u.traverseUp(e,function(e){return e.nodeName.toLowerCase()===t.toLowerCase()})},unwrap:function(e,t){var n=t.createDocumentFragment(),r=Array.prototype.slice.call(e.childNodes);for(var i=0;i<r.length;i++)n.appendChild(r[i]);n.childNodes.length?e.parentNode.replaceChild(n,e):e.parentNode.removeChild(e)},guid:function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}};e.util=u}(window),function(){var t=function(t){e.util.extend(this,t)};t.extend=function(t){var n=this,r;t&&t.hasOwnProperty("constructor")?r=t.constructor:r=function(){return n.apply(this,arguments)},e.util.extend(r,n);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,t&&e.util.extend(r.prototype,t),r},t.prototype={init:function(){},base:undefined,name:undefined,checkState:undefined,destroy:undefined,queryCommandState:undefined,isActive:undefined,isAlreadyApplied:undefined,setActive:undefined,setInactive:undefined,getInteractionElements:undefined,window:undefined,document:undefined,getEditorElements:function(){return this.base.elements},getEditorId:function(){return this.base.id},getEditorOption:function(e){return this.base.options[e]}},["execAction","on","off","subscribe","trigger"].forEach(function(e){t.prototype[e]=function(){return this.base[e].apply(this.base,arguments)}}),e.Extension=t}(),function(){function t(t){return e.util.isBlockContainer(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}var n={findMatchingSelectionParent:function(t,n){var r=n.getSelection(),i,s;return r.rangeCount===0?!1:(i=r.getRangeAt(0),s=i.commonAncestorContainer,e.util.traverseUp(s,t))},getSelectionElement:function(t){return this.findMatchingSelectionParent(function(t){return e.util.isMediumEditorElement(t)},t)},exportSelection:function(e,t){if(!e)return null;var n=null,r=t.getSelection();if(r.rangeCount>0){var i=r.getRangeAt(0),s=i.cloneRange(),o;s.selectNodeContents(e),s.setEnd(i.startContainer,i.startOffset),o=s.toString().length,n={start:o,end:o+i.toString().length},this.doesRangeStartWithImages(i,t)&&(n.startsWithImage=!0);var u=this.getTrailingImageCount(e,n,i.endContainer,i.endOffset);u&&(n.trailingImageCount=u);if(o!==0){var a=this.getIndexRelativeToAdjacentEmptyBlocks(t,e,i.startContainer,i.startOffset);a!==-1&&(n.emptyBlocksIndex=a)}}return n},importSelection:function(e,t,n,r){if(!e||!t)return;var i=n.createRange();i.setStart(t,0),i.collapse(!0);var s=t,o=[],u=0,a=!1,f=!1,l=0,c=!1,h,p=!1,d=null;if(r||e.startsWithImage||typeof e.emptyBlocksIndex!="undefined")p=!0;while(!c&&s){if(s.nodeType>3){s=o.pop();continue}if(s.nodeType===3&&!f)h=u+s.length,!a&&e.start>=u&&e.start<=h&&(p||e.start<h?(i.setStart(s,e.start-u),a=!0):d=s),a&&e.end>=u&&e.end<=h&&(e.trailingImageCount?f=!0:(i.setEnd(s,e.end-u),c=!0)),u=h;else{if(e.trailingImageCount&&f){s.nodeName.toLowerCase()==="img"&&l++;if(l===e.trailingImageCount){var v=0;while(s.parentNode.childNodes[v]!==s)v++;i.setEnd(s.parentNode,v+1),c=!0}}if(!c&&s.nodeType===1){var m=s.childNodes.length-1;while(m>=0)o.push(s.childNodes[m]),m-=1}}c||(s=o.pop())}!a&&d&&(i.setStart(d,d.length),i.setEnd(d,d.length)),typeof e.emptyBlocksIndex!="undefined"&&(i=this.importSelectionMoveCursorPastBlocks(n,t,e.emptyBlocksIndex,i)),r&&(i=this.importSelectionMoveCursorPastAnchor(e,i)),this.selectRange(n,i)},importSelectionMoveCursorPastAnchor:function(t,n){var r=function(e){return e.nodeName.toLowerCase()==="a"};if(t.start===t.end&&n.startContainer.nodeType===3&&n.startOffset===n.startContainer.nodeValue.length&&e.util.traverseUp(n.startContainer,r)){var i=n.startContainer,s=n.startContainer.parentNode;while(s!==null&&s.nodeName.toLowerCase()!=="a")s.childNodes[s.childNodes.length-1]!==i?s=null:(i=s,s=s.parentNode);if(s!==null&&s.nodeName.toLowerCase()==="a"){var o=null;for(var u=0;o===null&&u<s.parentNode.childNodes.length;u++)s.parentNode.childNodes[u]===s&&(o=u);n.setStart(s.parentNode,o+1),n.collapse(!0)}}return n},importSelectionMoveCursorPastBlocks:function(n,r,i,s){var o=n.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),u=s.startContainer,a,f,l=0;i=i||1,u.nodeType===3&&e.util.isBlockContainer(u.previousSibling)?a=u.previousSibling:a=e.util.getClosestBlockContainer(u);while(o.nextNode())if(!f)a===o.currentNode&&(f=o.currentNode);else{f=o.currentNode,l++;if(l===i)break;if(f.textContent.length>0)break}return f||(f=a),s.setStart(e.util.getFirstSelectableLeafNode(f),0),s},getIndexRelativeToAdjacentEmptyBlocks:function(n,r,i,s){if(i.textContent.length>0&&s>0)return-1;var o=i;o.nodeType!==3&&(o=i.childNodes[s]);if(o){if(!e.util.isElementAtBeginningOfBlock(o))return-1;var u=e.util.findPreviousSibling(o);if(!u)return-1;if(u.nodeValue)return-1}var a=e.util.getClosestBlockContainer(i),f=n.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1),l=0;while(f.nextNode()){var c=f.currentNode.textContent==="";if(c||l>0)l+=1;if(f.currentNode===a)return l;c||(l=0)}return l},doesRangeStartWithImages:function(e,t){if(e.startOffset!==0||e.startContainer.nodeType!==1)return!1;if(e.startContainer.nodeName.toLowerCase()==="img")return!0;var n=e.startContainer.querySelector("img");if(!n)return!1;var r=t.createTreeWalker(e.startContainer,NodeFilter.SHOW_ALL,null,!1);while(r.nextNode()){var i=r.currentNode;if(i===n)break;if(i.nodeValue)return!1}return!0},getTrailingImageCount:function(e,t,n,r){if(r===0||n.nodeType!==1)return 0;if(n.nodeName.toLowerCase()!=="img"&&!n.querySelector("img"))return 0;var i=n.childNodes[r-1];while(i.hasChildNodes())i=i.lastChild;var s=e,o=[],u=0,a=!1,f=!1,l=!1,c,h=0;while(!l&&s){if(s.nodeType>3){s=o.pop();continue}if(s.nodeType===3&&!f)h=0,c=u+s.length,!a&&t.start>=u&&t.start<=c&&(a=!0),a&&t.end>=u&&t.end<=c&&(f=!0),u=c;else{s.nodeName.toLowerCase()==="img"&&h++;if(s===i)l=!0;else if(s.nodeType===1){var p=s.childNodes.length-1;while(p>=0)o.push(s.childNodes[p]),p-=1}}l||(s=o.pop())}return h},selectionContainsContent:function(e){var t=e.getSelection();if(!t||t.isCollapsed||!t.rangeCount)return!1;if(t.toString().trim()!=="")return!0;var n=this.getSelectedParentElement(t.getRangeAt(0));if(n)if(n.nodeName.toLowerCase()==="img"||n.nodeType===1&&n.querySelector("img"))return!0;return!1},selectionInContentEditableFalse:function(e){var t,n=this.findMatchingSelectionParent(function(e){var n=e&&e.getAttribute("contenteditable");return n==="true"&&(t=!0),e.nodeName!=="#text"&&n==="false"},e);return!t&&n},getSelectionHtml:function(t){var n,r="",i=t.getSelection(),s,o;if(i.rangeCount){o=t.createElement("div");for(n=0,s=i.rangeCount;n<s;n+=1)o.appendChild(i.getRangeAt(n).cloneContents());r=o.innerHTML}return r},getCaretOffsets:function(t,n){var r,i;return n||(n=window.getSelection().getRangeAt(0)),r=n.cloneRange(),i=n.cloneRange(),r.selectNodeContents(t),r.setEnd(n.endContainer,n.endOffset),i.selectNodeContents(t),i.setStart(n.endContainer,n.endOffset),{left:r.toString().length,right:i.toString().length}},rangeSelectsSingleNode:function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},getSelectedParentElement:function(e){return e?this.rangeSelectsSingleNode(e)&&e.startContainer.childNodes[e.startOffset].nodeType!==3?e.startContainer.childNodes[e.startOffset]:e.startContainer.nodeType===3?e.startContainer.parentNode:e.startContainer:null},getSelectedElements:function(e){var t=e.getSelection(),n,r,i;if(!t.rangeCount||t.isCollapsed||!t.getRangeAt(0).commonAncestorContainer)return[];n=t.getRangeAt(0);if(n.commonAncestorContainer.nodeType===3){r=[],i=n.commonAncestorContainer;while(i.parentNode&&i.parentNode.childNodes.length===1)r.push(i.parentNode),i=i.parentNode;return r}return[].filter.call(n.commonAncestorContainer.getElementsByTagName("*"),function(e){return typeof t.containsNode=="function"?t.containsNode(e,!0):!0})},selectNode:function(e,t){var n=t.createRange();n.selectNodeContents(e),this.selectRange(t,n)},select:function(e,t,n,r,i){var s=e.createRange();return s.setStart(t,n),r?s.setEnd(r,i):s.collapse(!0),this.selectRange(e,s),s},clearSelection:function(e,t){t?e.getSelection().collapseToStart():e.getSelection().collapseToEnd()},moveCursor:function(e,t,n){this.select(e,t,n)},getSelectionRange:function(e){var t=e.getSelection();return t.rangeCount===0?null:t.getRangeAt(0)},selectRange:function(e,t){var n=e.getSelection();n.removeAllRanges(),n.addRange(t)},getSelectionStart:function(e){var t=e.getSelection().anchorNode,n=t&&t.nodeType===3?t.parentNode:t;return n}};e.selection=n}(),function(){function t(t,n){return t.some(function(t){if(typeof t.getInteractionElements!="function")return!1;var r=t.getInteractionElements();return r?(Array.isArray(r)||(r=[r]),r.some(function(t){return e.util.isDescendant(t,n,!0)})):!1})}var n=function(e){this.base=e,this.options=this.base.options,this.events=[],this.disabledEvents={},this.customEvents={},this.listeners={}};n.prototype={InputEventOnContenteditableSupported:!e.util.isIE&&!e.util.isEdge,attachDOMEvent:function(t,n,r,i){t=e.util.isElement(t)||[window,document].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){e.addEventListener(n,r,i),this.events.push([e,n,r,i])}.bind(this))},detachDOMEvent:function(t,n,r,i){var s,o;t=e.util.isElement(t)||[window,document].indexOf(t)>-1?[t]:t,Array.prototype.forEach.call(t,function(e){s=this.indexOfListener(e,n,r,i),s!==-1&&(o=this.events.splice(s,1)[0],o[0].removeEventListener(o[1],o[2],o[3]))}.bind(this))},indexOfListener:function(e,t,n,r){var i,s,o;for(i=0,s=this.events.length;i<s;i+=1){o=this.events[i];if(o[0]===e&&o[1]===t&&o[2]===n&&o[3]===r)return i}return-1},detachAllDOMEvents:function(){var e=this.events.pop();while(e)e[0].removeEventListener(e[1],e[2],e[3]),e=this.events.pop()},detachAllEventsFromElement:function(e){var t=this.events.filter(function(t){return t&&t[0].getAttribute&&t[0].getAttribute("medium-editor-index")===e.getAttribute("medium-editor-index")});for(var n=0,r=t.length;n<r;n++){var i=t[n];this.detachDOMEvent(i[0],i[1],i[2],i[3])}},attachAllEventsToElement:function(e){this.listeners.editableInput&&(this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML),this.eventsCache&&this.eventsCache.forEach(function(t){this.attachDOMEvent(e,t.name,t.handler.bind(this))},this)},enableCustomEvent:function(e){this.disabledEvents[e]!==undefined&&delete this.disabledEvents[e]},disableCustomEvent:function(e){this.disabledEvents[e]=!0},attachCustomEvent:function(e,t){this.setupListener(e),this.customEvents[e]||(this.customEvents[e]=[]),this.customEvents[e].push(t)},detachCustomEvent:function(e,t){var n=this.indexOfCustomListener(e,t);n!==-1&&this.customEvents[e].splice(n,1)},indexOfCustomListener:function(e,t){return!this.customEvents[e]||!this.customEvents[e].length?-1:this.customEvents[e].indexOf(t)},detachAllCustomEvents:function(){this.customEvents={}},triggerCustomEvent:function(e,t,n){this.customEvents[e]&&!this.disabledEvents[e]&&this.customEvents[e].forEach(function(e){e(t,n)})},destroy:function(){this.detachAllDOMEvents(),this.detachAllCustomEvents(),this.detachExecCommand(),this.base.elements&&this.base.elements.forEach(function(e){e.removeAttribute("data-medium-focused")})},attachToExecCommand:function(){if(this.execCommandListener)return;this.execCommandListener=function(e){this.handleDocumentExecCommand(e)}.bind(this),this.wrapExecCommand(),this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener)},detachExecCommand:function(){var e=this.options.ownerDocument;if(!this.execCommandListener||!e.execCommand.listeners)return;var t=e.execCommand.listeners.indexOf(this.execCommandListener);t!==-1&&e.execCommand.listeners.splice(t,1),e.execCommand.listeners.length||this.unwrapExecCommand()},wrapExecCommand:function(){var e=this.options.ownerDocument;if(e.execCommand.listeners)return;var t=function(t,n){e.execCommand.listeners&&e.execCommand.listeners.forEach(function(e){e({command:t[0],value:t[2],args:t,result:n})})},n=function(){var n=e.execCommand.orig.apply(this,arguments);if(!e.execCommand.listeners)return n;var r=Array.prototype.slice.call(arguments);return t(r,n),n};n.orig=e.execCommand,n.listeners=[],n.callListeners=t,e.execCommand=n},unwrapExecCommand:function(){var e=this.options.ownerDocument;if(!e.execCommand.orig)return;e.execCommand=e.execCommand.orig},setupListener:function(e){if(this.listeners[e])return;switch(e){case"externalInteraction":this.attachDOMEvent(this.options.ownerDocument.body,"mousedown",this.handleBodyMousedown.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"click",this.handleBodyClick.bind(this),!0),this.attachDOMEvent(this.options.ownerDocument.body,"focus",this.handleBodyFocus.bind(this),!0);break;case"blur":this.setupListener("externalInteraction");break;case"focus":this.setupListener("externalInteraction");break;case"editableInput":this.contentCache={},this.base.elements.forEach(function(e){this.contentCache[e.getAttribute("medium-editor-index")]=e.innerHTML},this),this.InputEventOnContenteditableSupported&&this.attachToEachElement("input",this.handleInput),this.InputEventOnContenteditableSupported||(this.setupListener("editableKeypress"),this.keypressUpdateInput=!0,this.attachDOMEvent(document,"selectionchange",this.handleDocumentSelectionChange.bind(this)),this.attachToExecCommand());break;case"editableClick":this.attachToEachElement("click",this.handleClick);break;case"editableBlur":this.attachToEachElement("blur",this.handleBlur);break;case"editableKeypress":this.attachToEachElement("keypress",this.handleKeypress);break;case"editableKeyup":this.attachToEachElement("keyup",this.handleKeyup);break;case"editableKeydown":this.attachToEachElement("keydown",this.handleKeydown);break;case"editableKeydownSpace":this.setupListener("editableKeydown");break;case"editableKeydownEnter":this.setupListener("editableKeydown");break;case"editableKeydownTab":this.setupListener("editableKeydown");break;case"editableKeydownDelete":this.setupListener("editableKeydown");break;case"editableMouseover":this.attachToEachElement("mouseover",this.handleMouseover);break;case"editableDrag":this.attachToEachElement("dragover",this.handleDragging),this.attachToEachElement("dragleave",this.handleDragging);break;case"editableDrop":this.attachToEachElement("drop",this.handleDrop);break;case"editablePaste":this.attachToEachElement("paste",this.handlePaste)}this.listeners[e]=!0},attachToEachElement:function(e,t){this.eventsCache||(this.eventsCache=[]),this.base.elements.forEach(function(n){this.attachDOMEvent(n,e,t.bind(this))},this),this.eventsCache.push({name:e,handler:t})},cleanupElement:function(e){var t=e.getAttribute("medium-editor-index");t&&(this.detachAllEventsFromElement(e),this.contentCache&&delete this.contentCache[t])},focusElement:function(e){e.focus(),this.updateFocus(e,{target:e,type:"focus"})},updateFocus:function(n,r){var i=this.base.getFocusedElement(),s;i&&r.type==="click"&&this.lastMousedownTarget&&(e.util.isDescendant(i,this.lastMousedownTarget,!0)||t(this.base.extensions,this.lastMousedownTarget))&&(s=i),s||this.base.elements.some(function(t){return!s&&e.util.isDescendant(t,n,!0)&&(s=t),!!s},this);var o=!e.util.isDescendant(i,n,!0)&&!t(this.base.extensions,n);s!==i&&(i&&o&&(i.removeAttribute("data-medium-focused"),this.triggerCustomEvent("blur",r,i)),s&&(s.setAttribute("data-medium-focused",!0),this.triggerCustomEvent("focus",r,s))),o&&this.triggerCustomEvent("externalInteraction",r)},updateInput:function(e,t){if(!this.contentCache)return;var n=e.getAttribute("medium-editor-index"),r=e.innerHTML;r!==this.contentCache[n]&&this.triggerCustomEvent("editableInput",t,e),this.contentCache[n]=r},handleDocumentSelectionChange:function(t){if(t.currentTarget&&t.currentTarget.activeElement){var n=t.currentTarget.activeElement,r;this.base.elements.some(function(t){return e.util.isDescendant(t,n,!0)?(r=t,!0):!1},this),r&&this.updateInput(r,{target:n,currentTarget:r})}},handleDocumentExecCommand:function(){var e=this.base.getFocusedElement();e&&this.updateInput(e,{target:e,currentTarget:e})},handleBodyClick:function(e){this.updateFocus(e.target,e)},handleBodyFocus:function(e){this.updateFocus(e.target,e)},handleBodyMousedown:function(e){this.lastMousedownTarget=e.target},handleInput:function(e){this.updateInput(e.currentTarget,e)},handleClick:function(e){this.triggerCustomEvent("editableClick",e,e.currentTarget)},handleBlur:function(e){this.triggerCustomEvent("editableBlur",e,e.currentTarget)},handleKeypress:function(e){this.triggerCustomEvent("editableKeypress",e,e.currentTarget);if(this.keypressUpdateInput){var t={target:e.target,currentTarget:e.currentTarget};setTimeout(function(){this.updateInput(t.currentTarget,t)}.bind(this),0)}},handleKeyup:function(e){this.triggerCustomEvent("editableKeyup",e,e.currentTarget)},handleMouseover:function(e){this.triggerCustomEvent("editableMouseover",e,e.currentTarget)},handleDragging:function(e){this.triggerCustomEvent("editableDrag",e,e.currentTarget)},handleDrop:function(e){this.triggerCustomEvent("editableDrop",e,e.currentTarget)},handlePaste:function(e){this.triggerCustomEvent("editablePaste",e,e.currentTarget)},handleKeydown:function(t){this.triggerCustomEvent("editableKeydown",t,t.currentTarget);if(e.util.isKey(t,e.util.keyCode.SPACE))return this.triggerCustomEvent("editableKeydownSpace",t,t.currentTarget);if(e.util.isKey(t,e.util.keyCode.ENTER)||t.ctrlKey&&e.util.isKey(t,e.util.keyCode.M))return this.triggerCustomEvent("editableKeydownEnter",t,t.currentTarget);if(e.util.isKey(t,e.util.keyCode.TAB))return this.triggerCustomEvent("editableKeydownTab",t,t.currentTarget);if(e.util.isKey(t,[e.util.keyCode.DELETE,e.util.keyCode.BACKSPACE]))return this.triggerCustomEvent("editableKeydownDelete",t,t.currentTarget)}},e.Events=n}(),function(){var t=e.Extension.extend({action:undefined,aria:undefined,tagNames:undefined,style:undefined,useQueryState:undefined,contentDefault:undefined,contentFA:undefined,classList:undefined,attrs:undefined,constructor:function(n){t.isBuiltInButton(n)?e.Extension.call(this,this.defaults[n]):e.Extension.call(this,n)},init:function(){e.Extension.prototype.init.apply(this,arguments),this.button=this.createButton(),this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},getAction:function(){return typeof this.action=="function"?this.action(this.base.options):this.action},getAria:function(){return typeof this.aria=="function"?this.aria(this.base.options):this.aria},getTagNames:function(){return typeof this.tagNames=="function"?this.tagNames(this.base.options):this.tagNames},createButton:function(){var e=this.document.createElement("button"),t=this.contentDefault,n=this.getAria(),r=this.getEditorOption("buttonLabels");return e.classList.add("medium-editor-action"),e.classList.add("medium-editor-action-"+this.name),this.classList&&this.classList.forEach(function(t){e.classList.add(t)}),e.setAttribute("data-action",this.getAction()),n&&(e.setAttribute("title",n),e.setAttribute("aria-label",n)),this.attrs&&Object.keys(this.attrs).forEach(function(t){e.setAttribute(t,this.attrs[t])},this),r==="fontawesome"&&this.contentFA&&(t=this.contentFA),e.innerHTML=t,e},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.getAction();t&&this.execAction(t)},isActive:function(){return this.button.classList.contains(this.getEditorOption("activeButtonClass"))},setInactive:function(){this.button.classList.remove(this.getEditorOption("activeButtonClass")),delete this.knownState},setActive:function(){this.button.classList.add(this.getEditorOption("activeButtonClass")),delete this.knownState},queryCommandState:function(){var e=null;return this.useQueryState&&(e=this.base.queryCommandState(this.getAction())),e},isAlreadyApplied:function(e){var t=!1,n=this.getTagNames(),r,i;return this.knownState===!1||this.knownState===!0?this.knownState:(n&&n.length>0&&(t=n.indexOf(e.nodeName.toLowerCase())!==-1),!t&&this.style&&(r=this.style.value.split("|"),i=this.window.getComputedStyle(e,null).getPropertyValue(this.style.prop),r.forEach(function(e){if(!this.knownState){t=i.indexOf(e)!==-1;if(t||this.style.prop!=="text-decoration")this.knownState=t}},this)),t)}});t.isBuiltInButton=function(t){return typeof t=="string"&&e.extensions.button.prototype.defaults.hasOwnProperty(t)},e.extensions.button=t}(),function(){e.extensions.button.prototype.defaults={bold:{name:"bold",action:"bold",aria:"bold",tagNames:["b","strong"],style:{prop:"font-weight",value:"700|bold"},useQueryState:!0,contentDefault:"<b>B</b>",contentFA:'<i class="fa fa-bold"></i>'},italic:{name:"italic",action:"italic",aria:"italic",tagNames:["i","em"],style:{prop:"font-style",value:"italic"},useQueryState:!0,contentDefault:"<b><i>I</i></b>",contentFA:'<i class="fa fa-italic"></i>'},underline:{name:"underline",action:"underline",aria:"underline",tagNames:["u"],style:{prop:"text-decoration",value:"underline"},useQueryState:!0,contentDefault:"<b><u>U</u></b>",contentFA:'<i class="fa fa-underline"></i>'},strikethrough:{name:"strikethrough",action:"strikethrough",aria:"strike through",tagNames:["strike"],style:{prop:"text-decoration",value:"line-through"},useQueryState:!0,contentDefault:"<s>A</s>",contentFA:'<i class="fa fa-strikethrough"></i>'},superscript:{name:"superscript",action:"superscript",aria:"superscript",tagNames:["sup"],contentDefault:"<b>x<sup>1</sup></b>",contentFA:'<i class="fa fa-superscript"></i>'},subscript:{name:"subscript",action:"subscript",aria:"subscript",tagNames:["sub"],contentDefault:"<b>x<sub>1</sub></b>",contentFA:'<i class="fa fa-subscript"></i>'},image:{name:"image",action:"image",aria:"image",tagNames:["img"],contentDefault:"<b>image</b>",contentFA:'<i class="fa fa-picture-o"></i>'},orderedlist:{name:"orderedlist",action:"insertorderedlist",aria:"ordered list",tagNames:["ol"],useQueryState:!0,contentDefault:"<b>1.</b>",contentFA:'<i class="fa fa-list-ol"></i>'},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",aria:"unordered list",tagNames:["ul"],useQueryState:!0,contentDefault:"<b>&bull;</b>",contentFA:'<i class="fa fa-list-ul"></i>'},indent:{name:"indent",action:"indent",aria:"indent",tagNames:[],contentDefault:"<b>&rarr;</b>",contentFA:'<i class="fa fa-indent"></i>'},outdent:{name:"outdent",action:"outdent",aria:"outdent",tagNames:[],contentDefault:"<b>&larr;</b>",contentFA:'<i class="fa fa-outdent"></i>'},justifyCenter:{name:"justifyCenter",action:"justifyCenter",aria:"center justify",tagNames:[],style:{prop:"text-align",value:"center"},contentDefault:"<b>C</b>",contentFA:'<i class="fa fa-align-center"></i>'},justifyFull:{name:"justifyFull",action:"justifyFull",aria:"full justify",tagNames:[],style:{prop:"text-align",value:"justify"},contentDefault:"<b>J</b>",contentFA:'<i class="fa fa-align-justify"></i>'},justifyLeft:{name:"justifyLeft",action:"justifyLeft",aria:"left justify",tagNames:[],style:{prop:"text-align",value:"left"},contentDefault:"<b>L</b>",contentFA:'<i class="fa fa-align-left"></i>'},justifyRight:{name:"justifyRight",action:"justifyRight",aria:"right justify",tagNames:[],style:{prop:"text-align",value:"right"},contentDefault:"<b>R</b>",contentFA:'<i class="fa fa-align-right"></i>'},removeFormat:{name:"removeFormat",aria:"remove formatting",action:"removeFormat",contentDefault:"<b>X</b>",contentFA:'<i class="fa fa-eraser"></i>'},quote:{name:"quote",action:"append-blockquote",aria:"blockquote",tagNames:["blockquote"],contentDefault:"<b>&ldquo;</b>",contentFA:'<i class="fa fa-quote-right"></i>'},pre:{name:"pre",action:"append-pre",aria:"preformatted text",tagNames:["pre"],contentDefault:"<b>0101</b>",contentFA:'<i class="fa fa-code fa-lg"></i>'},h1:{name:"h1",action:"append-h1",aria:"header type one",tagNames:["h1"],contentDefault:"<b>H1</b>",contentFA:'<i class="fa fa-header"><sup>1</sup>'},h2:{name:"h2",action:"append-h2",aria:"header type two",tagNames:["h2"],contentDefault:"<b>H2</b>",contentFA:'<i class="fa fa-header"><sup>2</sup>'},h3:{name:"h3",action:"append-h3",aria:"header type three",tagNames:["h3"],contentDefault:"<b>H3</b>",contentFA:'<i class="fa fa-header"><sup>3</sup>'},h4:{name:"h4",action:"append-h4",aria:"header type four",tagNames:["h4"],contentDefault:"<b>H4</b>",contentFA:'<i class="fa fa-header"><sup>4</sup>'},h5:{name:"h5",action:"append-h5",aria:"header type five",tagNames:["h5"],contentDefault:"<b>H5</b>",contentFA:'<i class="fa fa-header"><sup>5</sup>'},h6:{name:"h6",action:"append-h6",aria:"header type six",tagNames:["h6"],contentDefault:"<b>H6</b>",contentFA:'<i class="fa fa-header"><sup>6</sup>'}}}(),function(){var t=e.extensions.button.extend({init:function(){e.extensions.button.prototype.init.apply(this,arguments)},formSaveLabel:"&#10003;",formCloseLabel:"&times;",activeClass:"medium-editor-toolbar-form-active",hasForm:!0,getForm:function(){},isDisplayed:function(){return this.hasForm?this.getForm().classList.contains(this.activeClass):!1},showForm:function(){this.hasForm&&this.getForm().classList.add(this.activeClass)},hideForm:function(){this.hasForm&&this.getForm().classList.remove(this.activeClass)},showToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.showToolbarDefaultActions()},hideToolbarDefaultActions:function(){var e=this.base.getExtensionByName("toolbar");e&&e.hideToolbarDefaultActions()},setToolbarPosition:function(){var e=this.base.getExtensionByName("toolbar");e&&e.setToolbarPosition()}});e.extensions.form=t}(),function(){var t=e.extensions.form.extend({customClassOption:null,customClassOptionText:"Button",linkValidation:!1,placeholderText:"Paste or type a link",targetCheckbox:!1,targetCheckboxText:"Open in new window",name:"anchor",action:"createLink",aria:"link",tagNames:["a"],contentDefault:"<b>#</b>",contentFA:'<i class="fa fa-link"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this))},handleClick:function(t){t.preventDefault(),t.stopPropagation();var n=e.selection.getSelectionRange(this.document);return n.startContainer.nodeName.toLowerCase()==="a"||n.endContainer.nodeName.toLowerCase()==="a"||e.util.getClosestTag(e.selection.getSelectedParentElement(n),"a")?this.execAction("unlink"):(this.isDisplayed()||this.showForm(),!1)},handleKeydown:function(t){e.util.isKey(t,e.util.keyCode.K)&&e.util.isMetaCtrlKey(t)&&!t.shiftKey&&this.handleClick(t)},getForm:function(){return this.form||(this.form=this.createForm()),this.form},getTemplate:function(){var e=['<input type="text" class="medium-editor-toolbar-input" placeholder="',this.placeholderText,'">'];return e.push('<a href="#" class="medium-editor-toolbar-save">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':this.formSaveLabel,"</a>"),e.push('<a href="#" class="medium-editor-toolbar-close">',this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':this.formCloseLabel,"</a>"),this.targetCheckbox&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-target">',"<label>",this.targetCheckboxText,"</label>","</div>"),this.customClassOption&&e.push('<div class="medium-editor-toolbar-form-row">','<input type="checkbox" class="medium-editor-toolbar-anchor-button">',"<label>",this.customClassOptionText,"</label>","</div>"),e.join("")},isDisplayed:function(){return e.extensions.form.prototype.isDisplayed.apply(this)},hideForm:function(){e.extensions.form.prototype.hideForm.apply(this),this.getInput().value=""},showForm:function(t){var n=this.getInput(),r=this.getAnchorTargetCheckbox(),i=this.getAnchorButtonCheckbox();t=t||{value:""},typeof t=="string"&&(t={value:t}),this.base.saveSelection(),this.hideToolbarDefaultActions(),e.extensions.form.prototype.showForm.apply(this),this.setToolbarPosition(),n.value=t.value,n.focus(),r&&(r.checked=t.target==="_blank");if(i){var s=t.buttonClass?t.buttonClass.split(" "):[];i.checked=s.indexOf(this.customClassOption)!==-1}},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},getFormOpts:function(){var e=this.getAnchorTargetCheckbox(),t=this.getAnchorButtonCheckbox(),n={value:this.getInput().value.trim()};return this.linkValidation&&(n.value=this.checkLinkFormat(n.value)),n.target="_self",e&&e.checked&&(n.target="_blank"),t&&t.checked&&(n.buttonClass=this.customClassOption),n},doFormSave:function(){var e=this.getFormOpts();this.completeFormSave(e)},completeFormSave:function(e){this.base.restoreSelection(),this.execAction(this.action,e),this.base.checkSelection()},checkLinkFormat:function(e){var t=/^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,n=/^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/;return n.test(e)?"tel:"+e:(t.test(e)?"":"http://")+encodeURI(e)},doFormCancel:function(){this.base.restoreSelection(),this.base.checkSelection()},attachFormEvents:function(e){var t=e.querySelector(".medium-editor-toolbar-close"),n=e.querySelector(".medium-editor-toolbar-save"),r=e.querySelector(".medium-editor-toolbar-input");this.on(e,"click",this.handleFormClick.bind(this)),this.on(r,"keyup",this.handleTextboxKeyup.bind(this)),this.on(t,"click",this.handleCloseClick.bind(this)),this.on(n,"click",this.handleSaveClick.bind(this),!0)},createForm:function(){var e=this.document,t=e.createElement("div");return t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-anchor-"+this.getEditorId(),t.innerHTML=this.getTemplate(),this.attachFormEvents(t),t},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},getAnchorTargetCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-target")},getAnchorButtonCheckbox:function(){return this.getForm().querySelector(".medium-editor-toolbar-anchor-button")},handleTextboxKeyup:function(t){if(t.keyCode===e.util.keyCode.ENTER){t.preventDefault(),this.doFormSave();return}t.keyCode===e.util.keyCode.ESCAPE&&(t.preventDefault(),this.doFormCancel())},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});e.extensions.anchor=t}(),function(){var t=e.Extension.extend({name:"anchor-preview",hideDelay:500,previewValueSelector:"a",showWhenToolbarIsVisible:!1,showOnEmptyLinks:!0,init:function(){this.anchorPreview=this.createPreview(),this.getEditorOption("elementsContainer").appendChild(this.anchorPreview),this.attachToEditables()},getInteractionElements:function(){return this.getPreviewElement()},getPreviewElement:function(){return this.anchorPreview},createPreview:function(){var e=this.document.createElement("div");return e.id="medium-editor-anchor-preview-"+this.getEditorId(),e.className="medium-editor-anchor-preview",e.innerHTML=this.getTemplate(),this.on(e,"click",this.handleClick.bind(this)),e},getTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <a class="medium-editor-toolbar-anchor-preview-inner"></a></div>'},destroy:function(){this.anchorPreview&&(this.anchorPreview.parentNode&&this.anchorPreview.parentNode.removeChild(this.anchorPreview),delete this.anchorPreview)},hidePreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active"),this.activeAnchor=null},showPreview:function(e){return this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||e.getAttribute("data-disable-preview")?!0:(this.previewValueSelector&&(this.anchorPreview.querySelector(this.previewValueSelector).textContent=e.attributes.href.value,this.anchorPreview.querySelector(this.previewValueSelector).href=e.attributes.href.value),this.anchorPreview.classList.add("medium-toolbar-arrow-over"),this.anchorPreview.classList.remove("medium-toolbar-arrow-under"),this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")||this.anchorPreview.classList.add("medium-editor-anchor-preview-active"),this.activeAnchor=e,this.positionPreview(),this.attachPreviewHandlers(),this)},positionPreview:function(e){e=e||this.activeAnchor;var t=this.window.innerWidth,n=this.anchorPreview.offsetHeight,r=e.getBoundingClientRect(),i=this.diffLeft,s=this.diffTop,o=this.getEditorOption("elementsContainer"),u=["absolute","fixed"].indexOf(window.getComputedStyle(o).getPropertyValue("position"))>-1,a={},f,l,c,h,p;f=this.anchorPreview.offsetWidth/2;var d=this.base.getExtensionByName("toolbar");d&&(i=d.diffLeft,s=d.diffTop),l=i-f,u?(h=o.getBoundingClientRect(),["top","left"].forEach(function(e){a[e]=r[e]-h[e]}),a.width=r.width,a.height=r.height,r=a,t=h.width,p=o.scrollTop):p=this.window.pageYOffset,c=r.left+r.width/2,p+=n+r.top+r.height-s-this.anchorPreview.offsetHeight,this.anchorPreview.style.top=Math.round(p)+"px",this.anchorPreview.style.right="initial",c<f?(this.anchorPreview.style.left=l+f+"px",this.anchorPreview.style.right="initial"):t-c<f?(this.anchorPreview.style.left="auto",this.anchorPreview.style.right=0):(this.anchorPreview.style.left=l+c+"px",this.anchorPreview.style.right="initial")},attachToEditables:function(){this.subscribe("editableMouseover",this.handleEditableMouseover.bind(this)),this.subscribe("positionedToolbar",this.handlePositionedToolbar.bind(this))},handlePositionedToolbar:function(){this.showWhenToolbarIsVisible||this.hidePreview()},handleClick:function(e){var t=this.base.getExtensionByName("anchor"),n=this.activeAnchor;t&&n&&(e.preventDefault(),this.base.selectElement(this.activeAnchor),this.base.delay(function(){if(n){var e={value:n.attributes.href.value,target:n.getAttribute("target"),buttonClass:n.getAttribute("class")};t.showForm(e),n=null}}.bind(this))),this.hidePreview()},handleAnchorMouseout:function(){this.anchorToPreview=null,this.off(this.activeAnchor,"mouseout",this.instanceHandleAnchorMouseout),this.instanceHandleAnchorMouseout=null},handleEditableMouseover:function(t){var n=e.util.getClosestTag(t.target,"a");if(!1===n)return;if(!this.showOnEmptyLinks&&(!/href=["']\S+["']/.test(n.outerHTML)||/href=["']#\S+["']/.test(n.outerHTML)))return!0;var r=this.base.getExtensionByName("toolbar");if(!this.showWhenToolbarIsVisible&&r&&r.isDisplayed&&r.isDisplayed())return!0;this.activeAnchor&&this.activeAnchor!==n&&this.detachPreviewHandlers(),this.anchorToPreview=n,this.instanceHandleAnchorMouseout=this.handleAnchorMouseout.bind(this),this.on(this.anchorToPreview,"mouseout",this.instanceHandleAnchorMouseout),this.base.delay(function(){this.anchorToPreview&&this.showPreview(this.anchorToPreview)}.bind(this))},handlePreviewMouseover:function(){this.lastOver=(new Date).getTime(),this.hovering=!0},handlePreviewMouseout:function(e){if(!e.relatedTarget||!/anchor-preview/.test(e.relatedTarget.className))this.hovering=!1},updatePreview:function(){if(this.hovering)return!0;var e=(new Date).getTime()-this.lastOver;e>this.hideDelay&&this.detachPreviewHandlers()},detachPreviewHandlers:function(){clearInterval(this.intervalTimer),this.instanceHandlePreviewMouseover&&(this.off(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.activeAnchor&&(this.off(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.off(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout))),this.hidePreview(),this.hovering=this.instanceHandlePreviewMouseover=this.instanceHandlePreviewMouseout=null},attachPreviewHandlers:function(){this.lastOver=(new Date).getTime(),this.hovering=!0,this.instanceHandlePreviewMouseover=this.handlePreviewMouseover.bind(this),this.instanceHandlePreviewMouseout=this.handlePreviewMouseout.bind(this),this.intervalTimer=setInterval(this.updatePreview.bind(this),200),this.on(this.anchorPreview,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.anchorPreview,"mouseout",this.instanceHandlePreviewMouseout),this.on(this.activeAnchor,"mouseover",this.instanceHandlePreviewMouseover),this.on(this.activeAnchor,"mouseout",this.instanceHandlePreviewMouseout)}});e.extensions.anchorPreview=t}(),function(){function s(t){return!e.util.getClosestTag(t,"a")}var t,n,r,i;t=[" ","	","\n","\r"," "," "," "," "," ","\u2028","\u2029"],n="com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw",r="(((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.]("+n+")\\/)\\S+(?:[^\\s`!\\[\\]{};:'\".,?«»“”‘’]))"+")|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.("+n+"))",i=new RegExp("^("+n+")$","i");var o=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.disableEventHandling=!1,this.subscribe("editableKeypress",this.onKeypress.bind(this)),this.subscribe("editableBlur",this.onBlur.bind(this)),this.document.execCommand("AutoUrlDetect",!1,!1)},isLastInstance:function(){var e=0;for(var t=0;t<this.window._mediumEditors.length;t++){var n=this.window._mediumEditors[t];n!==null&&n.getExtensionByName("autoLink")!==undefined&&e++}return e===1},destroy:function(){this.document.queryCommandSupported("AutoUrlDetect")&&this.isLastInstance()&&this.document.execCommand("AutoUrlDetect",!1,!0)},onBlur:function(e,t){this.performLinking(t)},onKeypress:function(t){if(this.disableEventHandling)return;e.util.isKey(t,[e.util.keyCode.SPACE,e.util.keyCode.ENTER])&&(clearTimeout(this.performLinkingTimeout),this.performLinkingTimeout=setTimeout(function(){try{var e=this.base.exportSelection();this.performLinking(t.target)&&this.base.importSelection(e,!0)}catch(n){window.console&&window.console.error("Failed to perform linking",n),this.disableEventHandling=!0}}.bind(this),0))},performLinking:function(t){var n=e.util.splitByBlockElements(t),r=!1;n.length===0&&(n=[t]);for(var i=0;i<n.length;i++)r=this.removeObsoleteAutoLinkSpans(n[i])||r,r=this.performLinkingWithinElement(n[i])||r;return this.base.events.updateInput(t,{target:t,currentTarget:t}),r},removeObsoleteAutoLinkSpans:function(t){if(!t||t.nodeType===3)return!1;var n=t.querySelectorAll('span[data-auto-link="true"]'),r=!1;for(var i=0;i<n.length;i++){var o=n[i].textContent;o.indexOf("://")===-1&&(o=e.util.ensureUrlHasProtocol(o));if(n[i].getAttribute("data-href")!==o&&s(n[i])){r=!0;var u=o.replace(/\s+$/,"");if(n[i].getAttribute("data-href")===u){var a=o.length-u.length,f=e.util.splitOffDOMTree(n[i],this.splitTextBeforeEnd(n[i],a));n[i].parentNode.insertBefore(f,n[i].nextSibling)}else e.util.unwrap(n[i],this.document)}}return r},splitTextBeforeEnd:function(e,t){var n=this.document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),r=!0;while(r)r=n.lastChild()!==null;var i,s,o;while(t>0&&o!==null)i=n.currentNode,s=i.nodeValue,s.length>t?(o=i.splitText(s.length-t),t=0):(o=n.previousNode(),t-=s.length);return o},performLinkingWithinElement:function(t){var n=this.findLinkableText(t),r=!1;for(var i=0;i<n.length;i++){var s=e.util.findOrCreateMatchingTextNodes(this.document,t,n[i]);if(this.shouldNotLink(s))continue;this.createAutoLink(s,n[i].href)}return r},shouldNotLink:function(t){var n=!1;for(var r=0;r<t.length&&n===!1;r++)n=!!e.util.traverseUp(t[r],function(e){return e.nodeName.toLowerCase()==="a"||e.getAttribute&&e.getAttribute("data-auto-link")==="true"});return n},findLinkableText:function(e){var n=new RegExp(r,"gi"),s=e.textContent,o=null,u=[];while((o=n.exec(s))!==null){var a=!0,f=o.index+o[0].length;a=(o.index===0||t.indexOf(s[o.index-1])!==-1)&&(f===s.length||t.indexOf(s[f])!==-1),a=a&&(o[0].indexOf("/")!==-1||i.test(o[0].split(".").pop().split("?").shift())),a&&u.push({href:o[0],start:o.index,end:f})}return u},createAutoLink:function(t,n){n=e.util.ensureUrlHasProtocol(n);var r=e.util.createLink(this.document,t,n,this.getEditorOption("targetBlank")?"_blank":null),i=this.document.createElement("span");i.setAttribute("data-auto-link","true"),i.setAttribute("data-href",n),r.insertBefore(i,r.firstChild);while(r.childNodes.length>1)i.appendChild(r.childNodes[1])}});e.extensions.autoLink=o}(),function(){function n(n){var r=e.util.getContainerEditorElement(n),i=Array.prototype.slice.call(r.parentElement.querySelectorAll("."+t));i.forEach(function(e){e.classList.remove(t)})}var t="medium-editor-dragover",r=e.Extension.extend({name:"fileDragging",allowedTypes:["image"],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy";var r=e.target.classList?e.target:e.target.parentElement;n(r),e.type==="dragover"&&r.classList.add(t)},handleDrop:function(e){e.preventDefault(),e.stopPropagation(),this.base.selectElement(e.target);var t=this.base.exportSelection();t.start=t.end,this.base.importSelection(t),e.dataTransfer.files&&Array.prototype.slice.call(e.dataTransfer.files).forEach(function(e){this.isAllowedFile(e)&&e.type.match("image")&&this.insertImageFile(e)},this),n(e.target)},isAllowedFile:function(e){return this.allowedTypes.some(function(t){return!!e.type.match(t)})},insertImageFile:function(t){if(typeof FileReader!="function")return;var n=new FileReader;n.readAsDataURL(t),n.addEventListener("load",function(t){var n=this.document.createElement("img");n.src=t.target.result,e.util.insertHTMLCommand(this.document,n.outerHTML)}.bind(this))}});e.extensions.fileDragging=r}(),function(){var t=e.Extension.extend({name:"keyboard-commands",commands:[{command:"bold",key:"B",meta:!0,shift:!1,alt:!1},{command:"italic",key:"I",meta:!0,shift:!1,alt:!1},{command:"underline",key:"U",meta:!0,shift:!1,alt:!1}],init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.keys={},this.commands.forEach(function(e){var t=e.key.charCodeAt(0);this.keys[t]||(this.keys[t]=[]),this.keys[t].push(e)},this)},handleKeydown:function(t){var n=e.util.getKeyCode(t);if(!this.keys[n])return;var r=e.util.isMetaCtrlKey(t),i=!!t.shiftKey,s=!!t.altKey;this.keys[n].forEach(function(e){e.meta===r&&e.shift===i&&(e.alt===s||undefined===e.alt)&&(t.preventDefault(),t.stopPropagation(),typeof e.command=="function"?e.command.apply(this):!1!==e.command&&this.execAction(e.command))},this)}});e.extensions.keyboardCommands=t}(),function(){var t=e.extensions.form.extend({name:"fontname",action:"fontName",aria:"change font name",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-font"></i>',fonts:["","Arial","Verdana","Times New Roman"],init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){e.preventDefault(),e.stopPropagation();if(!this.isDisplayed()){var t=this.document.queryCommandValue("fontName")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getSelect().value=""},showForm:function(e){var t=this.getSelect();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontName(),this.base.checkSelection()},createForm:function(){var e=this.document,t=e.createElement("div"),n=e.createElement("select"),r=e.createElement("a"),i=e.createElement("a"),s;t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-fontname-"+this.getEditorId(),this.on(t,"click",this.handleFormClick.bind(this));for(var o=0;o<this.fonts.length;o++)s=e.createElement("option"),s.innerHTML=this.fonts[o],s.value=this.fonts[o],n.appendChild(s);return n.className="medium-editor-toolbar-select",t.appendChild(n),this.on(n,"change",this.handleFontChange.bind(this)),i.setAttribute("href","#"),i.className="medium-editor-toobar-save",i.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",t.appendChild(i),this.on(i,"click",this.handleSaveClick.bind(this),!0),r.setAttribute("href","#"),r.className="medium-editor-toobar-close",r.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",t.appendChild(r),this.on(r,"click",this.handleCloseClick.bind(this)),t},getSelect:function(){return this.getForm().querySelector("select.medium-editor-toolbar-select")},clearFontName:function(){e.selection.getSelectedElements(this.document).forEach(function(e){e.nodeName.toLowerCase()==="font"&&e.hasAttribute("face")&&e.removeAttribute("face")})},handleFontChange:function(){var e=this.getSelect().value;e===""?this.clearFontName():this.execAction("fontName",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});e.extensions.fontName=t}(),function(){var t=e.extensions.form.extend({name:"fontsize",action:"fontSize",aria:"increase/decrease font size",contentDefault:"&#xB1;",contentFA:'<i class="fa fa-text-height"></i>',init:function(){e.extensions.form.prototype.init.apply(this,arguments)},handleClick:function(e){e.preventDefault(),e.stopPropagation();if(!this.isDisplayed()){var t=this.document.queryCommandValue("fontSize")+"";this.showForm(t)}return!1},getForm:function(){return this.form||(this.form=this.createForm()),this.form},isDisplayed:function(){return this.getForm().style.display==="block"},hideForm:function(){this.getForm().style.display="none",this.getInput().value=""},showForm:function(e){var t=this.getInput();this.base.saveSelection(),this.hideToolbarDefaultActions(),this.getForm().style.display="block",this.setToolbarPosition(),t.value=e||"",t.focus()},destroy:function(){if(!this.form)return!1;this.form.parentNode&&this.form.parentNode.removeChild(this.form),delete this.form},doFormSave:function(){this.base.restoreSelection(),this.base.checkSelection()},doFormCancel:function(){this.base.restoreSelection(),this.clearFontSize(),this.base.checkSelection()},createForm:function(){var e=this.document,t=e.createElement("div"),n=e.createElement("input"),r=e.createElement("a"),i=e.createElement("a");return t.className="medium-editor-toolbar-form",t.id="medium-editor-toolbar-form-fontsize-"+this.getEditorId(),this.on(t,"click",this.handleFormClick.bind(this)),n.setAttribute("type","range"),n.setAttribute("min","1"),n.setAttribute("max","7"),n.className="medium-editor-toolbar-input",t.appendChild(n),this.on(n,"change",this.handleSliderChange.bind(this)),i.setAttribute("href","#"),i.className="medium-editor-toobar-save",i.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-check"></i>':"&#10003;",t.appendChild(i),this.on(i,"click",this.handleSaveClick.bind(this),!0),r.setAttribute("href","#"),r.className="medium-editor-toobar-close",r.innerHTML=this.getEditorOption("buttonLabels")==="fontawesome"?'<i class="fa fa-times"></i>':"&times;",t.appendChild(r),this.on(r,"click",this.handleCloseClick.bind(this)),t},getInput:function(){return this.getForm().querySelector("input.medium-editor-toolbar-input")},clearFontSize:function(){e.selection.getSelectedElements(this.document).forEach(function(e){e.nodeName.toLowerCase()==="font"&&e.hasAttribute("size")&&e.removeAttribute("size")})},handleSliderChange:function(){var e=this.getInput().value;e==="4"?this.clearFontSize():this.execAction("fontSize",{value:e})},handleFormClick:function(e){e.stopPropagation()},handleSaveClick:function(e){e.preventDefault(),this.doFormSave()},handleCloseClick:function(e){e.preventDefault(),this.doFormCancel()}});e.extensions.fontSize=t}(),function(){function s(){return[[new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g),""],[new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g),""],[new RegExp(/<br>$/i),""],[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"|“|”)(((?!&quot;|&rdquo;|&ldquo;|"|“|”).)*)(?:&quot;|&rdquo;|&ldquo;|"|“|”)(?:(?!&gt;).)*&gt;/gi),'<a href="$1">'],[new RegExp(/<\/p>\n+/gi),"</p>"],[new RegExp(/\n+<p/gi),"<p"],[new RegExp(/<\/?o:[a-z]*>/gi),""],[new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi),"$1"]]}function o(e,t,n){var r=e.clipboardData||t.clipboardData||n.dataTransfer,i={};if(!r)return i;if(r.getData){var s=r.getData("Text");s&&s.length>0&&(i["text/plain"]=s)}if(r.types)for(var o=0;o<r.types.length;o++){var u=r.types[o];i[u]=r.getData(u)}return i}var t="%ME_PASTEBIN%",n=null,r=null,i=function(e){e.stopPropagation()},u=e.Extension.extend({forcePlainText:!0,cleanPastedHTML:!1,preCleanReplacements:[],cleanReplacements:[],cleanAttrs:["class","style","dir"],cleanTags:["meta"],init:function(){e.Extension.prototype.init.apply(this,arguments);if(this.forcePlainText||this.cleanPastedHTML)this.subscribe("editableKeydown",this.handleKeydown.bind(this)),this.getEditorElements().forEach(function(e){this.on(e,"paste",this.handlePaste.bind(this))},this),this.subscribe("addElement",this.handleAddElement.bind(this))},handleAddElement:function(e,t){this.on(t,"paste",this.handlePaste.bind(this))},destroy:function(){(this.forcePlainText||this.cleanPastedHTML)&&this.removePasteBin()},handlePaste:function(e,t){if(e.defaultPrevented)return;var n=o(e,this.window,this.document),r=n["text/html"],i=n["text/plain"];this.window.clipboardData&&e.clipboardData===undefined&&!r&&(r=i);if(r||i)e.preventDefault(),this.doPaste(r,i,t)},doPaste:function(t,n,r){var i,s="",o;if(this.cleanPastedHTML&&t)return this.cleanPaste(t);if(!(this.getEditorOption("disableReturn")||r&&r.getAttribute("data-disable-return"))){i=n.split(/[\r\n]+/g);if(i.length>1)for(o=0;o<i.length;o+=1)i[o]!==""&&(s+="<p>"+e.util.htmlEntities(i[o])+"</p>");else s=e.util.htmlEntities(i[0])}else s=e.util.htmlEntities(n);e.util.insertHTMLCommand(this.document,s)},handlePasteBinPaste:function(e){if(e.defaultPrevented){this.removePasteBin();return}var t=o(e,this.window,this.document),n=t["text/html"],i=t["text/plain"],s=r;if(!this.cleanPastedHTML||n){e.preventDefault(),this.removePasteBin(),this.doPaste(n,i,s),this.trigger("editablePaste",{currentTarget:s,target:s},s);return}setTimeout(function(){this.cleanPastedHTML&&(n=this.getPasteBinHtml()),this.removePasteBin(),this.doPaste(n,i,s),this.trigger("editablePaste",{currentTarget:s,target:s},s)}.bind(this),0)},handleKeydown:function(t,n){if(!e.util.isKey(t,e.util.keyCode.V)||!e.util.isMetaCtrlKey(t))return;t.stopImmediatePropagation(),this.removePasteBin(),this.createPasteBin(n)},createPasteBin:function(s){var o,u=e.selection.getSelectionRange(this.document),a=this.window.pageYOffset;r=s,u&&(o=u.getClientRects(),o.length?a+=o[0].top:a+=u.startContainer.getBoundingClientRect().top),n=u;var f=this.document.createElement("div");f.id=this.pasteBinId="medium-editor-pastebin-"+ +Date.now(),f.setAttribute("style","border: 1px red solid; position: absolute; top: "+a+"px; width: 10px; height: 10px; overflow: hidden; opacity: 0"),f.setAttribute("contentEditable",!0),f.innerHTML=t,this.document.body.appendChild(f),this.on(f,"focus",i),this.on(f,"focusin",i),this.on(f,"focusout",i),f.focus(),e.selection.selectNode(f,this.document),this.boundHandlePaste||(this.boundHandlePaste=this.handlePasteBinPaste.bind(this)),this.on(f,"paste",this.boundHandlePaste)},removePasteBin:function(){null!==n&&(e.selection.selectRange(this.document,n),n=null),null!==r&&(r=null);var t=this.getPasteBin();if(!t)return;t&&(this.off(t,"focus",i),this.off(t,"focusin",i),this.off(t,"focusout",i),this.off(t,"paste",this.boundHandlePaste),t.parentElement.removeChild(t))},getPasteBin:function(){return this.document.getElementById(this.pasteBinId)},getPasteBinHtml:function(){var e=this.getPasteBin();if(!e)return!1;if(e.firstChild&&e.firstChild.id==="mcepastebin")return!1;var n=e.innerHTML;return!n||n===t?!1:n},cleanPaste:function(e){var t,n,r,i,o=/<p|<br|<div/.test(e),u=[].concat(this.preCleanReplacements||[],s(),this.cleanReplacements||[]);for(t=0;t<u.length;t+=1)e=e.replace(u[t][0],u[t][1]);if(!o)return this.pasteHTML(e);r=this.document.createElement("div"),r.innerHTML="<p>"+e.split("<br><br>").join("</p><p>")+"</p>",n=r.querySelectorAll("a,p,div,br");for(t=0;t<n.length;t+=1){i=n[t],i.innerHTML=i.innerHTML.replace(/\n/gi," ");switch(i.nodeName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(i);break;case"br":this.filterLineBreak(i)}}this.pasteHTML(r.innerHTML)},pasteHTML:function(t,n){n=e.util.defaults({},n,{cleanAttrs:this.cleanAttrs,cleanTags:this.cleanTags});var r,i,s,o,u=this.document.createDocumentFragment();u.appendChild(this.document.createElement("body")),o=u.querySelector("body"),o.innerHTML=t,this.cleanupSpans(o),r=o.querySelectorAll("*");for(s=0;s<r.length;s+=1)i=r[s],"a"===i.nodeName.toLowerCase()&&this.getEditorOption("targetBlank")&&e.util.setTargetBlank(i),e.util.cleanupAttrs(i,n.cleanAttrs),e.util.cleanupTags(i,n.cleanTags);e.util.insertHTMLCommand(this.document,o.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(e){return e&&(e.nodeName.toLowerCase()==="p"||e.nodeName.toLowerCase()==="div")},filterCommonBlocks:function(e){/^\s*$/.test(e.textContent)&&e.parentNode&&e.parentNode.removeChild(e)},filterLineBreak:function(e){this.isCommonBlock(e.previousElementSibling)?this.removeWithParent(e):!this.isCommonBlock(e.parentNode)||e.parentNode.firstChild!==e&&e.parentNode.lastChild!==e?e.parentNode&&e.parentNode.childElementCount===1&&e.parentNode.textContent===""&&this.removeWithParent(e):this.removeWithParent(e)},removeWithParent:function(e){e&&e.parentNode&&(e.parentNode.parentNode&&e.parentNode.childElementCount===1?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e))},cleanupSpans:function(t){var n,r,i,s=t.querySelectorAll(".replace-with"),o=function(e){return e&&e.nodeName!=="#text"&&e.getAttribute("contenteditable")==="false"};for(n=0;n<s.length;n+=1)r=s[n],i=this.document.createElement(r.classList.contains("bold")?"b":"i"),r.classList.contains("bold")&&r.classList.contains("italic")?i.innerHTML="<i>"+r.innerHTML+"</i>":i.innerHTML=r.innerHTML,r.parentNode.replaceChild(i,r);s=t.querySelectorAll("span");for(n=0;n<s.length;n+=1){r=s[n];if(e.util.traverseUp(r,o))return!1;e.util.unwrap(r,this.document)}}});e.extensions.paste=u}(),function(){var t=e.Extension.extend({name:"placeholder",text:"Type your text",hideOnClick:!0,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initPlaceholders(),this.attachEventHandlers()},initPlaceholders:function(){this.getEditorElements().forEach(this.initElement,this)},handleAddElement:function(e,t){this.initElement(t)},initElement:function(e){e.getAttribute("data-placeholder")||e.setAttribute("data-placeholder",this.text),this.updatePlaceholder(e)},destroy:function(){this.getEditorElements().forEach(this.cleanupElement,this)},handleRemoveElement:function(e,t){this.cleanupElement(t)},cleanupElement:function(e){e.getAttribute("data-placeholder")===this.text&&e.removeAttribute("data-placeholder")},showPlaceholder:function(t){t&&(e.util.isFF&&t.childNodes.length===0?(t.classList.add("medium-editor-placeholder-relative"),t.classList.remove("medium-editor-placeholder")):(t.classList.add("medium-editor-placeholder"),t.classList.remove("medium-editor-placeholder-relative")))},hidePlaceholder:function(e){e&&(e.classList.remove("medium-editor-placeholder"),e.classList.remove("medium-editor-placeholder-relative"))},updatePlaceholder:function(e,t){if(e.querySelector("img, blockquote, ul, ol, table")||e.textContent.replace(/^\s+|\s+$/g,"")!=="")return this.hidePlaceholder(e);t||this.showPlaceholder(e)},attachEventHandlers:function(){this.hideOnClick&&this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableInput",this.handleInput.bind(this)),this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("addElement",this.handleAddElement.bind(this)),this.subscribe("removeElement",this.handleRemoveElement.bind(this))},handleInput:function(e,t){var n=this.hideOnClick&&t===this.base.getFocusedElement();this.updatePlaceholder(t,n)},handleFocus:function(e,t){this.hidePlaceholder(t)},handleBlur:function(e,t){this.updatePlaceholder(t)}});e.extensions.placeholder=t}(),function(){var t=e.Extension.extend({name:"toolbar",align:"center",allowMultiParagraphSelection:!0,buttons:["bold","italic","underline","anchor","h2","h3","quote"],diffLeft:0,diffTop:-10,firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last",standardizeSelectionStart:!1,"static":!1,sticky:!1,stickyTopOffset:0,updateOnEmptySelection:!1,relativeContainer:null,init:function(){e.Extension.prototype.init.apply(this,arguments),this.initThrottledMethods(),this.relativeContainer?this.relativeContainer.appendChild(this.getToolbarElement()):this.getEditorOption("elementsContainer").appendChild(this.getToolbarElement())},forEachExtension:function(e,t){return this.base.extensions.forEach(function(n){if(n===this)return;return e.apply(t||this,arguments)},this)},createToolbar:function(){var e=this.document.createElement("div");return e.id="medium-editor-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",this.static?e.className+=" static-toolbar":this.relativeContainer?e.className+=" medium-editor-relative-toolbar":e.className+=" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(t){t.hasForm&&e.appendChild(t.getForm())}),this.attachEventHandlers(),e},createToolbarButtons:function(){var t=this.document.createElement("ul"),n,r,i,s,o,u;return t.id="medium-editor-toolbar-actions"+this.getEditorId(),t.className="medium-editor-toolbar-actions",t.style.display="block",this.buttons.forEach(function(i){typeof i=="string"?(o=i,u=null):(o=i.name,u=i),s=this.base.addBuiltInExtension(o,u),s&&typeof s.getButton=="function"&&(r=s.getButton(this.base),n=this.document.createElement("li"),e.util.isElement(r)?n.appendChild(r):n.innerHTML=r,t.appendChild(n))},this),i=t.querySelectorAll("button"),i.length>0&&(i[0].classList.add(this.firstButtonClass),i[i.length-1].classList.add(this.lastButtonClass)),t},destroy:function(){this.toolbar&&(this.toolbar.parentNode&&this.toolbar.parentNode.removeChild(this.toolbar),delete this.toolbar)},getInteractionElements:function(){return this.getToolbarElement()},getToolbarElement:function(){return this.toolbar||(this.toolbar=this.createToolbar()),this.toolbar},getToolbarActionsElement:function(){return this.getToolbarElement().querySelector(".medium-editor-toolbar-actions")},initThrottledMethods:function(){this.throttledPositionToolbar=e.util.throttle(function(){this.base.isActive&&this.positionToolbarIfShown()}.bind(this))},attachEventHandlers:function(){this.subscribe("blur",this.handleBlur.bind(this)),this.subscribe("focus",this.handleFocus.bind(this)),this.subscribe("editableClick",this.handleEditableClick.bind(this)),this.subscribe("editableKeyup",this.handleEditableKeyup.bind(this)),this.on(this.document.documentElement,"mouseup",this.handleDocumentMouseup.bind(this)),this.static&&this.sticky&&this.on(this.window,"scroll",this.handleWindowScroll.bind(this),!0),this.on(this.window,"resize",this.handleWindowResize.bind(this))},handleWindowScroll:function(){this.positionToolbarIfShown()},handleWindowResize:function(){this.throttledPositionToolbar()},handleDocumentMouseup:function(t){if(t&&t.target&&e.util.isDescendant(this.getToolbarElement(),t.target))return!1;this.checkState()},handleEditableClick:function(){setTimeout(function(){this.checkState()}.bind(this),0)},handleEditableKeyup:function(){this.checkState()},handleBlur:function(){clearTimeout(this.hideTimeout),clearTimeout(this.delayShowTimeout),this.hideTimeout=setTimeout(function(){this.hideToolbar()}.bind(this),1)},handleFocus:function(){this.checkState()},isDisplayed:function(){return this.getToolbarElement().classList.contains("medium-editor-toolbar-active")},showToolbar:function(){clearTimeout(this.hideTimeout),this.isDisplayed()||(this.getToolbarElement().classList.add("medium-editor-toolbar-active"),this.trigger("showToolbar",{},this.base.getFocusedElement()))},hideToolbar:function(){this.isDisplayed()&&(this.getToolbarElement().classList.remove("medium-editor-toolbar-active"),this.trigger("hideToolbar",{},this.base.getFocusedElement()))},isToolbarDefaultActionsDisplayed:function(){return this.getToolbarActionsElement().style.display==="block"},hideToolbarDefaultActions:function(){this.isToolbarDefaultActionsDisplayed()&&(this.getToolbarActionsElement().style.display="none")},showToolbarDefaultActions:function(){this.hideExtensionForms(),this.isToolbarDefaultActionsDisplayed()||(this.getToolbarActionsElement().style.display="block"),this.delayShowTimeout=this.base.delay(function(){this.showToolbar()}.bind(this))},hideExtensionForms:function(){this.forEachExtension(function(e){e.hasForm&&e.isDisplayed()&&e.hideForm()})},multipleBlockElementsSelected:function(){var t=/<[^\/>][^>]*><\/[^>]+>/gim,n=new RegExp("<("+e.util.blockContainerElementNames.join("|")+")[^>]*>","g"),r=e.selection.getSelectionHtml(this.document).replace(t,""),i=r.match(n);return!!i&&i.length>1},modifySelection:function(){var t=this.window.getSelection(),n=t.getRangeAt(0);if(this.standardizeSelectionStart&&n.startContainer.nodeValue&&n.startOffset===n.startContainer.nodeValue.length){var r=e.util.findAdjacentTextNodeWithContent(e.selection.getSelectionElement(this.window),n.startContainer,this.document);if(r){var i=0;while(r.nodeValue.substr(i,1).trim().length===0)i+=1;n=e.selection.select(this.document,r,i,n.endContainer,n.endOffset)}}},checkState:function(){if(this.base.preventSelectionUpdates)return;if(!this.base.getFocusedElement()||e.selection.selectionInContentEditableFalse(this.window))return this.hideToolbar();var t=e.selection.getSelectionElement(this.window);if(!t||this.getEditorElements().indexOf(t)===-1||t.getAttribute("data-disable-toolbar"))return this.hideToolbar();if(this.updateOnEmptySelection&&this.static)return this.showAndUpdateToolbar();if(!e.selection.selectionContainsContent(this.document)||this.allowMultiParagraphSelection===!1&&this.multipleBlockElementsSelected())return this.hideToolbar();this.showAndUpdateToolbar()},showAndUpdateToolbar:function(){this.modifySelection(),this.setToolbarButtonStates(),this.trigger("positionToolbar",{},this.base.getFocusedElement()),this.showToolbarDefaultActions(),this.setToolbarPosition()},setToolbarButtonStates:function(){this.forEachExtension(function(e){typeof e.isActive=="function"&&typeof e.setInactive=="function"&&e.setInactive()}),this.checkActiveButtons()},checkActiveButtons:function(){var t=[],n=null,r=e.selection.getSelectionRange(this.document),i,s=function(e){typeof e.checkState=="function"?e.checkState(i):typeof e.isActive=="function"&&typeof e.isAlreadyApplied=="function"&&typeof e.setActive=="function"&&!e.isActive()&&e.isAlreadyApplied(i)&&e.setActive()};if(!r)return;this.forEachExtension(function(e){if(typeof e.queryCommandState=="function"){n=e.queryCommandState();if(n!==null){n&&typeof e.setActive=="function"&&e.setActive();return}}t.push(e)}),i=e.selection.getSelectedParentElement(r);if(!this.getEditorElements().some(function(t){return e.util.isDescendant(t,i,!0)}))return;while(i){t.forEach(s);if(e.util.isMediumEditorElement(i))break;i=i.parentNode}},positionToolbarIfShown:function(){this.isDisplayed()&&this.setToolbarPosition()},setToolbarPosition:function(){var e=this.base.getFocusedElement(),t=this.window.getSelection();if(!e)return this;if(this.static||!t.isCollapsed)this.showToolbar(),this.relativeContainer||(this.static?this.positionStaticToolbar(e):this.positionToolbar(t)),this.trigger("positionedToolbar",{},this.base.getFocusedElement())},positionStaticToolbar:function(e){this.getToolbarElement().style.left="0";var t=this.document.documentElement&&this.document.documentElement.scrollTop||this.document.body.scrollTop,n=this.window.innerWidth,r=this.getToolbarElement(),i=e.getBoundingClientRect(),s=i.top+t,o=i.left+i.width/2,u=r.offsetHeight,a=r.offsetWidth,f=a/2,l;this.sticky?t>s+e.offsetHeight-u-this.stickyTopOffset?(r.style.top=s+e.offsetHeight-u+"px",r.classList.remove("medium-editor-sticky-toolbar")):t>s-u-this.stickyTopOffset?(r.classList.add("medium-editor-sticky-toolbar"),r.style.top=this.stickyTopOffset+"px"):(r.classList.remove("medium-editor-sticky-toolbar"),r.style.top=s-u+"px"):r.style.top=s-u+"px";switch(this.align){case"left":l=i.left;break;case"right":l=i.right-a;break;case"center":l=o-f}l<0?l=0:l+a>n&&(l=n-Math.ceil(a)-1),r.style.left=l+"px"},positionToolbar:function(e){this.getToolbarElement().style.left="0",this.getToolbarElement().style.right="initial";var t=e.getRangeAt(0),n=t.getBoundingClientRect();if(!n||n.height===0&&n.width===0&&t.startContainer===t.endContainer)t.startContainer.nodeType===1&&t.startContainer.querySelector("img")?n=t.startContainer.querySelector("img").getBoundingClientRect():n=t.startContainer.getBoundingClientRect();var r=this.window.innerWidth,i=this.getToolbarElement(),s=i.offsetHeight,o=i.offsetWidth,u=o/2,a=50,f=this.diffLeft-u,l=this.getEditorOption("elementsContainer"),c=["absolute","fixed"].indexOf(window.getComputedStyle(l).getPropertyValue("position"))>-1,h={},p={},d,v;c?(v=l.getBoundingClientRect(),["top","left"].forEach(function(e){p[e]=n[e]-v[e]}),p.width=n.width,p.height=n.height,n=p,r=v.width,h.top=l.scrollTop):h.top=this.window.pageYOffset,d=n.left+n.width/2,h.top+=n.top-s,n.top<a?(i.classList.add("medium-toolbar-arrow-over"),i.classList.remove("medium-toolbar-arrow-under"),h.top+=a+n.height-this.diffTop):(i.classList.add("medium-toolbar-arrow-under"),i.classList.remove("medium-toolbar-arrow-over"),h.top+=this.diffTop),d<u?(h.left=f+u,h.right="initial"):r-d<u?(h.left="auto",h.right=0):(h.left=f+d,h.right="initial"),["top","left","right"].forEach(function(e){i.style[e]=h[e]+(isNaN(h[e])?"":"px")})}});e.extensions.toolbar=t}(),function(){var t=e.Extension.extend({init:function(){e.Extension.prototype.init.apply(this,arguments),this.subscribe("editableDrag",this.handleDrag.bind(this)),this.subscribe("editableDrop",this.handleDrop.bind(this))},handleDrag:function(e){var t="medium-editor-dragover";e.preventDefault(),e.dataTransfer.dropEffect="copy",e.type==="dragover"?e.target.classList.add(t):e.type==="dragleave"&&e.target.classList.remove(t)},handleDrop:function(t){var n="medium-editor-dragover",r;t.preventDefault(),t.stopPropagation(),t.dataTransfer.files&&(r=Array.prototype.slice.call(t.dataTransfer.files,0),r.some(function(t){if(t.type.match("image")){var n,r;n=new FileReader,n.readAsDataURL(t),r="medium-img-"+ +(new Date),e.util.insertHTMLCommand(this.document,'<img class="medium-editor-image-loading" id="'+r+'" />'),n.onload=function(){var e=this.document.getElementById(r);e&&(e.removeAttribute("id"),e.removeAttribute("class"),e.src=n.result)}.bind(this)}}.bind(this))),t.target.classList.remove(n)}});e.extensions.imageDragging=t}(),function(){function t(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r=n.textContent,i=e.selection.getCaretOffsets(n);(r[i.left-1]===undefined||r[i.left-1].trim()===""||r[i.left]!==undefined&&r[i.left].trim()==="")&&t.preventDefault()}function n(t,n){if(this.options.disableReturn||n.getAttribute("data-disable-return"))t.preventDefault();else if(this.options.disableDoubleReturn||n.getAttribute("data-disable-double-return")){var r=e.selection.getSelectionStart(this.options.ownerDocument);(r&&r.textContent.trim()===""&&r.nodeName.toLowerCase()!=="li"||r.previousElementSibling&&r.previousElementSibling.nodeName.toLowerCase()!=="br"&&r.previousElementSibling.textContent.trim()==="")&&t.preventDefault()}}function r(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r=n&&n.nodeName.toLowerCase();r==="pre"&&(t.preventDefault(),e.util.insertHTMLCommand(this.options.ownerDocument,"    ")),e.util.isListItem(n)&&(t.preventDefault(),t.shiftKey?this.options.ownerDocument.execCommand("outdent",!1,null):this.options.ownerDocument.execCommand("indent",!1,null))}function i(t){var n,r=e.selection.getSelectionStart(this.options.ownerDocument),i=r.nodeName.toLowerCase(),s=/^(\s+|<br\/?>)?$/i,o=/h\d/i;e.util.isKey(t,[e.util.keyCode.BACKSPACE,e.util.keyCode.ENTER])&&r.previousElementSibling&&o.test(i)&&e.selection.getCaretOffsets(r).left===0?e.util.isKey(t,e.util.keyCode.BACKSPACE)&&s.test(r.previousElementSibling.innerHTML)?(r.previousElementSibling.parentNode.removeChild(r.previousElementSibling),t.preventDefault()):!this.options.disableDoubleReturn&&e.util.isKey(t,e.util.keyCode.ENTER)&&(n=this.options.ownerDocument.createElement("p"),n.innerHTML="<br>",r.previousElementSibling.parentNode.insertBefore(n,r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.DELETE)&&r.nextElementSibling&&r.previousElementSibling&&!o.test(i)&&s.test(r.innerHTML)&&o.test(r.nextElementSibling.nodeName.toLowerCase())?(e.selection.moveCursor(this.options.ownerDocument,r.nextElementSibling),r.previousElementSibling.parentNode.removeChild(r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&i==="li"&&s.test(r.innerHTML)&&!r.previousElementSibling&&!r.parentElement.previousElementSibling&&r.nextElementSibling&&r.nextElementSibling.nodeName.toLowerCase()==="li"?(n=this.options.ownerDocument.createElement("p"),n.innerHTML="<br>",r.parentElement.parentElement.insertBefore(n,r.parentElement),e.selection.moveCursor(this.options.ownerDocument,n),r.parentElement.removeChild(r),t.preventDefault()):e.util.isKey(t,e.util.keyCode.BACKSPACE)&&e.util.getClosestTag(r,"blockquote")!==!1&&e.selection.getCaretOffsets(r).left===0?(t.preventDefault(),e.util.execFormatBlock(this.options.ownerDocument,"p")):e.util.isKey(t,e.util.keyCode.ENTER)&&e.util.getClosestTag(r,"blockquote")!==!1&&e.selection.getCaretOffsets(r).right===0&&(n=this.options.ownerDocument.createElement("p"),n.innerHTML="<br>",r.parentElement.insertBefore(n,r.nextSibling),e.selection.moveCursor(this.options.ownerDocument,n),t.preventDefault())}function s(t){var n=e.selection.getSelectionStart(this.options.ownerDocument),r;if(!n)return;e.util.isMediumEditorElement(n)&&n.children.length===0&&!e.util.isBlockContainer(n)&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"),e.util.isKey(t,e.util.keyCode.ENTER)&&!e.util.isListItem(n)&&!e.util.isBlockContainer(n)&&(r=n.nodeName.toLowerCase(),r==="a"?this.options.ownerDocument.execCommand("unlink",!1,null):!t.shiftKey&&!t.ctrlKey&&this.options.ownerDocument.execCommand("formatBlock",!1,"p"))}function o(e,t){var n=t.parentNode.querySelector('textarea[medium-editor-textarea-id="'+t.getAttribute("medium-editor-textarea-id")+'"]');n&&(n.value=t.innerHTML.trim())}function u(e){e._mediumEditors||(e._mediumEditors=[null]),this.id||(this.id=e._mediumEditors.length),e._mediumEditors[this.id]=this}function a(e){if(!e._mediumEditors||!e._mediumEditors[this.id])return;e._mediumEditors[this.id]=null}function f(t,n,r){var i=[];t||(t=[]),typeof t=="string"&&(t=n.querySelectorAll(t)),e.util.isElement(t)&&(t=[t]);if(r)for(var s=0;s<t.length;s++){var o=t[s];e.util.isElement(o)&&!o.getAttribute("data-medium-editor-element")&&!o.getAttribute("medium-editor-textarea-id")&&i.push(o)}else i=Array.prototype.slice.apply(t);return i}function l(e){var t=e.parentNode.querySelector('textarea[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]');t&&(t.classList.remove("medium-editor-hidden"),t.removeAttribute("medium-editor-textarea-id")),e.parentNode&&e.parentNode.removeChild(e)}function c(e,t){return Object.keys(t).forEach(function(n){e[n]===undefined&&(e[n]=t[n])}),e}function h(e,t,n){var r={window:n.options.contentWindow,document:n.options.ownerDocument,base:n};return e=c(e,r),typeof e.init=="function"&&e.init(),e.name||(e.name=t),e}function p(){return this.elements.every(function(e){return!!e.getAttribute("data-disable-toolbar")})?!1:this.options.toolbar!==!1}function d(){return p.call(this)?this.options.anchorPreview!==!1:!1}function v(){return this.options.placeholder!==!1}function m(){return this.options.autoLink!==!1}function g(){return this.options.imageDragging!==!1}function y(){return this.options.keyboardCommands!==!1}function b(){return!this.options.extensions.imageDragging}function w(e){var t=this.options.ownerDocument.createElement("div"),n=Date.now(),r="medium-editor-"+n,i=e.attributes;while(this.options.ownerDocument.getElementById(r))n++,r="medium-editor-"+n;t.className=e.className,t.id=r,t.innerHTML=e.value,e.setAttribute("medium-editor-textarea-id",r);for(var s=0,o=i.length;s<o;s++)t.hasAttribute(i[s].nodeName)||t.setAttribute(i[s].nodeName,i[s].nodeValue);return e.form&&this.on(e.form,"reset",function(e){e.defaultPrevented||this.resetContent(this.options.ownerDocument.getElementById(r))}.bind(this)),e.classList.add("medium-editor-hidden"),e.parentNode.insertBefore(t,e),t}function E(t,r){if(!t.getAttribute("data-medium-editor-element")){t.nodeName.toLowerCase()==="textarea"&&(t=w.call(this,t),this.instanceHandleEditableInput||(this.instanceHandleEditableInput=o.bind(this),this.subscribe("editableInput",this.instanceHandleEditableInput))),!this.options.disableEditing&&!t.getAttribute("data-disable-editing")&&(t.setAttribute("contentEditable",!0),t.setAttribute("spellcheck",this.options.spellcheck)),!this.instanceHandleEditableKeydownEnter&&(t.getAttribute("data-disable-return")||t.getAttribute("data-disable-double-return"))&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter)),!this.options.disableReturn&&!t.getAttribute("data-disable-return")&&this.on(t,"keyup",s.bind(this));var i=e.util.guid();t.setAttribute("data-medium-editor-element",!0),t.classList.add("medium-editor-element"),t.setAttribute("role","textbox"),t.setAttribute("aria-multiline",!0),t.setAttribute("data-medium-editor-editor-index",r),t.setAttribute("medium-editor-index",i),k[i]=t.innerHTML,this.events.attachAllEventsToElement(t)}return t}function S(){this.subscribe("editableKeydownTab",r.bind(this)),this.subscribe("editableKeydownDelete",i.bind(this)),this.subscribe("editableKeydownEnter",i.bind(this)),this.options.disableExtraSpaces&&this.subscribe("editableKeydownSpace",t.bind(this)),!this.instanceHandleEditableKeydownEnter&&(this.options.disableReturn||this.options.disableDoubleReturn)&&(this.instanceHandleEditableKeydownEnter=n.bind(this),this.subscribe("editableKeydownEnter",this.instanceHandleEditableKeydownEnter))}function x(){this.extensions=[],Object.keys(this.options.extensions).forEach(function(e){e!=="toolbar"&&this.options.extensions[e]&&this.extensions.push(h(this.options.extensions[e],e,this))},this);if(b.call(this)){var t=this.options.fileDragging;t||(t={},g.call(this)||(t.allowedTypes=[])),this.addBuiltInExtension("fileDragging",t)}var n={paste:!0,"anchor-preview":d.call(this),autoLink:m.call(this),keyboardCommands:y.call(this),placeholder:v.call(this)};Object.keys(n).forEach(function(e){n[e]&&this.addBuiltInExtension(e)},this);var r=this.options.extensions.toolbar;if(!r&&p.call(this)){var i=e.util.extend({},this.options.toolbar,{allowMultiParagraphSelection:this.options.allowMultiParagraphSelection});r=new e.extensions.toolbar(i)}r&&this.extensions.push(h(r,"toolbar",this))}function T(t,n){var r=[["allowMultiParagraphSelection","toolbar.allowMultiParagraphSelection"]];return n&&r.forEach(function(t){n.hasOwnProperty(t[0])&&n[t[0]]!==undefined&&e.util.deprecated(t[0],t[1],"v6.0.0")}),e.util.defaults({},n,t)}function N(t,n){var r=/^append-(.+)$/gi,i=/justify([A-Za-z]*)$/g,s,o;s=r.exec(t);if(s)return e.util.execFormatBlock(this.options.ownerDocument,s[1]);if(t==="fontSize")return n.size&&e.util.deprecated(".size option for fontSize command",".value","6.0.0"),o=n.value||n.size,this.options.ownerDocument.execCommand("fontSize",!1,o);if(t==="fontName")return n.name&&e.util.deprecated(".name option for fontName command",".value","6.0.0"),o=n.value||n.name,this.options.ownerDocument.execCommand("fontName",!1,o);if(t==="createLink")return this.createLink(n);if(t==="image"){var u=this.options.contentWindow.getSelection().toString().trim();return this.options.ownerDocument.execCommand("insertImage",!1,u)}if(i.exec(t)){var a=this.options.ownerDocument.execCommand(t,!1,null),f=e.selection.getSelectedParentElement(e.selection.getSelectionRange(this.options.ownerDocument));return f&&C.call(this,e.util.getTopBlockContainer(f)),a}return o=n&&n.value,this.options.ownerDocument.execCommand(t,!1,o)}function C(t){if(!t)return;var n,r=Array.prototype.slice.call(t.childNodes).filter(function(e){var t=e.nodeName.toLowerCase()==="div";return t&&!n&&(n=e.style.textAlign),t});r.length&&(this.saveSelection(),r.forEach(function(t){if(t.style.textAlign===n){var r=t.lastChild;if(r){e.util.unwrap(t,this.options.ownerDocument);var i=this.options.ownerDocument.createElement("BR");r.parentNode.insertBefore(i,r.nextSibling)}}},this),t.style.textAlign=n,this.restoreSelection())}var k={};e.prototype={init:function(e,t){return this.options=T.call(this,this.defaults,t),this.origElements=e,this.options.elementsContainer||(this.options.elementsContainer=this.options.ownerDocument.body),this.setup()},setup:function(){if(this.isActive)return;u.call(this,this.options.contentWindow),this.events=new e.Events(this),this.elements=[],this.addElements(this.origElements);if(this.elements.length===0)return;this.isActive=!0,x.call(this),S.call(this)},destroy:function(){if(!this.isActive)return;this.isActive=!1,this.extensions.forEach(function(e){typeof e.destroy=="function"&&e.destroy()},this),this.events.destroy(),this.elements.forEach(function(e){this.options.spellcheck&&(e.innerHTML=e.innerHTML),e.removeAttribute("contentEditable"),e.removeAttribute("spellcheck"),e.removeAttribute("data-medium-editor-element"),e.classList.remove("medium-editor-element"),e.removeAttribute("role"),e.removeAttribute("aria-multiline"),e.removeAttribute("medium-editor-index"),e.removeAttribute("data-medium-editor-editor-index"),e.getAttribute("medium-editor-textarea-id")&&l(e)},this),this.elements=[],this.instanceHandleEditableKeydownEnter=null,this.instanceHandleEditableInput=null,a.call(this,this.options.contentWindow)},on:function(e,t,n,r){return this.events.attachDOMEvent(e,t,n,r),this},off:function(e,t,n,r){return this.events.detachDOMEvent(e,t,n,r),this},subscribe:function(e,t){return this.events.attachCustomEvent(e,t),this},unsubscribe:function(e,t){return this.events.detachCustomEvent(e,t),this},trigger:function(e,t,n){return this.events.triggerCustomEvent(e,t,n),this},delay:function(e){var t=this;return setTimeout(function(){t.isActive&&e()},this.options.delay)},serialize:function(){var e,t,n={},r=this.elements.length;for(e=0;e<r;e+=1)t=this.elements[e].id!==""?this.elements[e].id:"element-"+e,n[t]={value:this.elements[e].innerHTML.trim()};return n},getExtensionByName:function(e){var t;return this.extensions&&this.extensions.length&&this.extensions.some(function(n){return n.name===e?(t=n,!0):!1}),t},addBuiltInExtension:function(t,n){var r=this.getExtensionByName(t),i;if(r)return r;switch(t){case"anchor":i=e.util.extend({},this.options.anchor,n),r=new e.extensions.anchor(i);break;case"anchor-preview":r=new e.extensions.anchorPreview(this.options.anchorPreview);break;case"autoLink":r=new e.extensions.autoLink;break;case"fileDragging":r=new e.extensions.fileDragging(n);break;case"fontname":r=new e.extensions.fontName(this.options.fontName);break;case"fontsize":r=new e.extensions.fontSize(n);break;case"keyboardCommands":r=new e.extensions.keyboardCommands(this.options.keyboardCommands);break;case"paste":r=new e.extensions.paste(this.options.paste);break;case"placeholder":r=new e.extensions.placeholder(this.options.placeholder);break;default:e.extensions.button.isBuiltInButton(t)&&(n?(i=e.util.defaults({},n,e.extensions.button.prototype.defaults[t]),r=new e.extensions.button(i)):r=new e.extensions.button(t))}return r&&this.extensions.push(h(r,t,this)),r},stopSelectionUpdates:function(){this.preventSelectionUpdates=!0},startSelectionUpdates:function(){this.preventSelectionUpdates=!1},checkSelection:function(){var e=this.getExtensionByName("toolbar");return e&&e.checkState(),this},queryCommandState:function(e){var t=/^full-(.+)$/gi,n,r=null;n=t.exec(e),n&&(e=n[1]);try{r=this.options.ownerDocument.queryCommandState(e)}catch(i){r=null}return r},execAction:function(t,n){var r=/^full-(.+)$/gi,i,s;return i=r.exec(t),i?(this.saveSelection(),this.selectAllContents(),s=N.call(this,i[1],n),this.restoreSelection()):s=N.call(this,t,n),(t==="insertunorderedlist"||t==="insertorderedlist")&&e.util.cleanListDOM(this.options.ownerDocument,this.getSelectedParentElement()),this.checkSelection(),s},getSelectedParentElement:function(t){return t===undefined&&(t=this.options.contentWindow.getSelection().getRangeAt(0)),e.selection.getSelectedParentElement(t)},selectAllContents:function(){var t=e.selection.getSelectionElement(this.options.contentWindow);if(t){while(t.children.length===1)t=t.children[0];this.selectElement(t)}},selectElement:function(t){e.selection.selectNode(t,this.options.ownerDocument);var n=e.selection.getSelectionElement(this.options.contentWindow);n&&this.events.focusElement(n)},getFocusedElement:function(){var e;return this.elements.some(function(t){return!e&&t.getAttribute("data-medium-focused")&&(e=t),!!e},this),e},exportSelection:function(){var t=e.selection.getSelectionElement(this.options.contentWindow),n=this.elements.indexOf(t),r=null;return n>=0&&(r=e.selection.exportSelection(t,this.options.ownerDocument)),r!==null&&n!==0&&(r.editableElementIndex=n),r},saveSelection:function(){this.selectionState=this.exportSelection()},importSelection:function(t,n){if(!t)return;var r=this.elements[t.editableElementIndex||0];e.selection.importSelection(t,r,this.options.ownerDocument,n)},restoreSelection:function(){this.importSelection(this.selectionState)},createLink:function(t){var n=e.selection.getSelectionElement(this.options.contentWindow),r={},i;if(this.elements.indexOf(n)===-1)return;try{this.events.disableCustomEvent("editableInput"),t.url&&e.util.deprecated(".url option for createLink",".value","6.0.0"),i=t.url||t.value;if(i&&i.trim().length>0){var s=this.options.contentWindow.getSelection();if(s){var o=s.getRangeAt(0),u=o.commonAncestorContainer,a,f,l,c;o.endContainer.nodeType===3&&o.startContainer.nodeType!==3&&o.startOffset===0&&o.startContainer.firstChild===o.endContainer&&(u=o.endContainer),f=e.util.getClosestBlockContainer(o.startContainer),l=e.util.getClosestBlockContainer(o.endContainer);if(u.nodeType!==3&&u.textContent.length!==0&&f===l){var h=f||n,p=this.options.ownerDocument.createDocumentFragment();this.execAction("unlink"),a=this.exportSelection(),p.appendChild(h.cloneNode(!0)),n===h?e.selection.select(this.options.ownerDocument,h.firstChild,0,h.lastChild,h.lastChild.nodeType===3?h.lastChild.nodeValue.length:h.lastChild.childNodes.length):e.selection.select(this.options.ownerDocument,h,0,h,h.childNodes.length);var d=this.exportSelection();c=e.util.findOrCreateMatchingTextNodes(this.options.ownerDocument,p,{start:a.start-d.start,end:a.end-d.start,editableElementIndex:a.editableElementIndex}),c.length===0&&(p=this.options.ownerDocument.createDocumentFragment(),p.appendChild(u.cloneNode(!0)),c=[p.firstChild.firstChild,p.firstChild.lastChild]),e.util.createLink(this.options.ownerDocument,c,i.trim());var v=(p.firstChild.innerHTML.match(/^\s+/)||[""])[0].length;e.util.insertHTMLCommand(this.options.ownerDocument,p.firstChild.innerHTML.replace(/^\s+/,"")),a.start-=v,a.end-=v,this.importSelection(a)}else this.options.ownerDocument.execCommand("createLink",!1,i);this.options.targetBlank||t.target==="_blank"?e.util.setTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),i):e.util.removeTargetBlank(e.selection.getSelectionStart(this.options.ownerDocument),i),t.buttonClass&&e.util.addClassToAnchors(e.selection.getSelectionStart(this.options.ownerDocument),t.buttonClass)}}if(this.options.targetBlank||t.target==="_blank"||t.buttonClass){r=this.options.ownerDocument.createEvent("HTMLEvents"),r.initEvent("input",!0,!0,this.options.contentWindow);for(var m=0,g=this.elements.length;m<g;m+=1)this.elements[m].dispatchEvent(r)}}finally{this.events.enableCustomEvent("editableInput")}this.events.triggerCustomEvent("editableInput",r,n)},cleanPaste:function(e){this.getExtensionByName("paste").cleanPaste(e)},pasteHTML:function(e,t){this.getExtensionByName("paste").pasteHTML(e,t)},setContent:function(e,t){t=t||0;if(this.elements[t]){var n=this.elements[t];n.innerHTML=e,this.checkContentChanged(n)}},getContent:function(e){return e=e||0,this.elements[e]?this.elements[e].innerHTML.trim():null},checkContentChanged:function(t){t=t||e.selection.getSelectionElement(this.options.contentWindow),this.events.updateInput(t,{target:t,currentTarget:t})},resetContent:function(e){if(e){var t=this.elements.indexOf(e);t!==-1&&this.setContent(k[e.getAttribute("medium-editor-index")],t);return}this.elements.forEach(function(e,t){this.setContent(k[e.getAttribute("medium-editor-index")],t)},this)},addElements:function(e){var t=f(e,this.options.ownerDocument,!0);if(t.length===0)return!1;t.forEach(function(e){e=E.call(this,e,this.id),this.elements.push(e),this.trigger("addElement",{target:e,currentTarget:e},e)},this)},removeElements:function(e){var t=f(e,this.options.ownerDocument),n=t.map(function(e){return e.getAttribute("medium-editor-textarea-id")&&e.parentNode?e.parentNode.querySelector('div[medium-editor-textarea-id="'+e.getAttribute("medium-editor-textarea-id")+'"]'):e});this.elements=this.elements.filter(function(e){return n.indexOf(e)!==-1?(this.events.cleanupElement(e),e.getAttribute("medium-editor-textarea-id")&&l(e),this.trigger("removeElement",{target:e,currentTarget:e},e),!1):!0},this)}},e.getEditorFromElement=function(e){var t=e.getAttribute("data-medium-editor-editor-index"),n=e&&e.ownerDocument&&(e.ownerDocument.defaultView||e.ownerDocument.parentWindow);return n&&n._mediumEditors&&n._mediumEditors[t]?n._mediumEditors[t]:null}}(),function(){e.prototype.defaults={activeButtonClass:"medium-editor-button-active",buttonLabels:!1,delay:0,disableReturn:!1,disableDoubleReturn:!1,disableExtraSpaces:!1,disableEditing:!1,autoLink:!1,elementsContainer:!1,contentWindow:window,ownerDocument:document,targetBlank:!1,extensions:{},spellcheck:!0}}(),e.parseVersionString=function(e){var t=e.split("-"),n=t[0].split("."),r=t.length>1?t[1]:"";return{major:parseInt(n[0],10),minor:parseInt(n[1],10),revision:parseInt(n[2],10),preRelease:r,toString:function(){return[n[0],n[1],n[2]].join(".")+(r?"-"+r:"")}}},e.version=e.parseVersionString.call(this,{version:"5.21.1"}.version),e}()),define("lib-build/css!lib-app/medium-editor/dist/css/medium-editor",[],function(){}),define("lib-build/css!lib-app/medium-editor/dist/css/themes/flat",[],function(){}),define("lib-build/css!lib-app/font-awesome/css/font-awesome",[],function(){}),define("lib-build/css!storymaps/tpl/builder/textEditor/MediumEditorWrapper",[],function(){}),define("storymaps/tpl/builder/textEditor/MediumEditorWrapper",["lib-app/medium-editor/dist/js/medium-editor","lib-build/css!lib-app/medium-editor/dist/css/medium-editor","lib-build/css!lib-app/medium-editor/dist/css/themes/flat","lib-build/css!lib-app/font-awesome/css/font-awesome","lib-build/css!./MediumEditorWrapper","dojo/_base/lang"],function(e,t,n,r,i,s){var o={buttonLabels:"fontawesome",targetBlank:!0,autoLink:!0,imageDragging:!1,fileDragging:!1,disableDoubleReturn:!0,anchor:{linkValidation:!0,placeholderText:"Enter a link..."},paste:{forcePlainText:!0,cleanPastedHTML:!1},extensions:{imageDragging:new function(){}}},u={toolbar:!1,disableReturn:!0,keyboardCommands:!1},a={toolbar:{allowMultiParagraphSelection:!1,buttons:["anchor"]},disableReturn:!0,keyboardCommands:!1},f={toolbar:{allowMultiParagraphSelection:!1,buttons:["bold","italic","underline","strikethrough","anchor"]}},l="rgb(0, 0, 0)";return function(n){n=n||{};if(!n.container){console.error("Could not initialize MediumEditorWrapper, userOptions:",n);return}var r=n.mode||"standard",i=s.mixin({},o);r=="single-line"?i=s.mixin(i,u):r=="link"?(i=s.mixin(i,a),i.placeholder={text:"Enter the link label and highlight it...",hideOnClick:!1}):i=s.mixin(i,f),n.placeholder&&(i.placeholder={text:n.placeholder,hideOnClick:!1}),i=s.mixin(i,n.editorConfig),i.elementsContainer=n.container.parent()[0];var c=new e(n.container,i);n.onBlur&&typeof n.onBlur=="function"&&c.subscribe("blur",n.onBlur),c.subscribe("editableInput",function(e,t){$(t).find("p").contents().each(function(){(this.nodeType===Node.COMMENT_NODE||this.nodeType==8)&&$(this).remove()})});var h=$(c.elements[0]);h.on("input",function(){h.children("p").children("span[style]").each(function(){(!this.style.color||this.style.color=="inherit"||this.style.color==l)&&$(this).contents().unwrap()})}),this.setContent=function(e){e=e||{};var t=e.text;if(t===undefined)return;t="<p>"+t+"</p>",e.convertLine&&(t=t.replace(/\n{2}/g,"</p><p>")),c.setContent(t)}}}),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o)):!1):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r,i,s=e(this[0]);s.length&&s[0]!==document;){if(r=s.css("position"),("absolute"===r||"relative"===r||"fixed"===r)&&(i=parseInt(s.css("zIndex"),10),!isNaN(i)&&0!==i))return i;s=s.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s="Width"===r?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"!=typeof t?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;i.length>r;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(n,r,i){var s,o,u,a,f={},l=n.split(".")[0];n=n.split(".")[1],s=l+"-"+n,i||(i=r,r=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},o=e[l][n],u=e[l][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new u(e,n)},e.extend(u,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new r,a.options=e.widget.extend({},a.options),e.each(i,function(n,i){return e.isFunction(i)?(f[n]=function(){var e=function(){return r.prototype[n].apply(this,arguments)},t=function(e){return r.prototype[n].apply(this,e)};return function(){var n,r=this._super,s=this._superApply;return this._super=e,this._superApply=t,n=i.apply(this,arguments),this._super=r,this._superApply=s,n}}(),t):(f[n]=i,t)}),u.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix||n:n},f,{constructor:u,namespace:l,widgetName:n,widgetFullName:s}),o?(e.each(o._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,u,n._proto)}),delete o._childConstructors):r._childConstructors.push(u),e.widget.bridge(n,u)},e.widget.extend=function(n){for(var i,o,u=r.call(arguments,1),a=0,f=u.length;f>a;a++)for(i in u[a])o=u[a][i],u[a].hasOwnProperty(i)&&o!==t&&(n[i]=e.isPlainObject(o)?e.isPlainObject(n[i])?e.widget.extend({},n[i],o):e.widget.extend({},o):o);return n},e.widget.bridge=function(n,i){var o=i.prototype.widgetFullName||n;e.fn[n]=function(u){var a="string"==typeof u,f=r.call(arguments,1),l=this;return u=!a&&f.length?e.widget.extend.apply(null,[u].concat(f)):u,a?this.each(function(){var r,i=e.data(this,o);return i?e.isFunction(i[u])&&"_"!==u.charAt(0)?(r=i[u].apply(i,f),r!==i&&r!==t?(l=r&&r.jquery?l.pushStack(r.get()):r,!1):t):e.error("no such method '"+u+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+u+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(u||{})._init():e.data(this,o,new i(u,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i,s,o,u=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(u={},i=n.split("."),n=i.shift(),i.length){for(s=u[n]=e.widget.extend({},this.options[n]),o=0;i.length-1>o;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];if(n=i.pop(),1===arguments.length)return s[n]===t?null:s[n];s[n]=r}else{if(1===arguments.length)return this.options[n]===t?null:this.options[n];u[n]=r}return this._setOptions(u),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,r,i){var s,o=this;"boolean"!=typeof n&&(i=r,r=n,n=!1),i?(r=s=e(r),this.bindings=this.bindings.add(r)):(i=r,r=this.element,s=this.widget()),e.each(i,function(i,u){function f(){return n||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof u?o[u]:u).apply(o,arguments):t}"string"!=typeof u&&(f.guid=u.guid=u.guid||f.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,h=l[2];h?s.delegate(h,c,f):r.bind(c,f)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var o,u=i?i===!0||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var r=this,i=1===n.which,s="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return i&&!s&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?n/100:1)]}function r(t,n){return parseInt(e.css(t,n),10)||0}function i(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var s,o=Math.max,u=Math.abs,a=Math.round,f=/left|center|right/,l=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,p=/%$/,d=e.fn.position;e.position={scrollbarWidth:function(){if(s!==t)return s;var n,r,i=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=i.children()[0];return e("body").append(i),n=o.offsetWidth,i.css("overflow","scroll"),r=o.offsetWidth,n===r&&(r=i[0].clientWidth),i.remove(),s=n-r},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),i="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,s="scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:i?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]),i=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:r,isDocument:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var s,p,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=i(b),b[0].preventDefault&&(t.at="left top"),p=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e,n,r=(t[this]||"").split(" ");1===r.length&&(r=f.test(r[0])?r.concat(["center"]):l.test(r[0])?["center"].concat(r):["center","center"]),r[0]=f.test(r[0])?r[0]:"center",r[1]=l.test(r[1])?r[1]:"center",e=c.exec(r[0]),n=c.exec(r[1]),x[this]=[e?e[0]:0,n?n[0]:0],t[this]=[h.exec(r[0])[0],h.exec(r[1])[0]]}),1===S.length&&(S[1]=S[0]),"right"===t.at[0]?g.left+=p:"center"===t.at[0]&&(g.left+=p/2),"bottom"===t.at[1]?g.top+=v:"center"===t.at[1]&&(g.top+=v/2),s=n(x.at,p,v),g.left+=s[0],g.top+=s[1],this.each(function(){var i,f,l=e(this),c=l.outerWidth(),h=l.outerHeight(),d=r(this,"marginLeft"),y=r(this,"marginTop"),T=c+d+r(this,"marginRight")+E.width,N=h+y+r(this,"marginBottom")+E.height,C=e.extend({},g),L=n(x.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?C.left-=c:"center"===t.my[0]&&(C.left-=c/2),"bottom"===t.my[1]?C.top-=h:"center"===t.my[1]&&(C.top-=h/2),C.left+=L[0],C.top+=L[1],e.support.offsetFractions||(C.left=a(C.left),C.top=a(C.top)),i={marginLeft:d,marginTop:y},e.each(["left","top"],function(n,r){e.ui.position[S[n]]&&e.ui.position[S[n]][r](C,{targetWidth:p,targetHeight:v,elemWidth:c,elemHeight:h,collisionPosition:i,collisionWidth:T,collisionHeight:N,offset:[s[0]+L[0],s[1]+L[1]],my:t.my,at:t.at,within:w,elem:l})}),t.using&&(f=function(e){var n=m.left-C.left,r=n+p-c,i=m.top-C.top,s=i+v-h,a={target:{element:b,left:m.left,top:m.top,width:p,height:v},element:{element:l,left:C.left,top:C.top,width:c,height:h},horizontal:0>r?"left":n>0?"right":"center",vertical:0>s?"top":i>0?"bottom":"middle"};c>p&&p>u(n+r)&&(a.horizontal="center"),h>v&&v>u(i+s)&&(a.vertical="middle"),a.important=o(u(n),u(r))>o(u(i),u(s))?"horizontal":"vertical",t.using.call(this,e,a)}),l.offset(e.extend(C,{using:f}))})},e.ui.position={fit:{left:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,u=e.left-t.collisionPosition.marginLeft,a=i-u,f=u+t.collisionWidth-s-i;t.collisionWidth>s?a>0&&0>=f?(n=e.left+a+t.collisionWidth-s-i,e.left+=a-n):e.left=f>0&&0>=a?i:a>f?i+s-t.collisionWidth:i:a>0?e.left+=a:f>0?e.left-=f:e.left=o(e.left-u,e.left)},top:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollTop:r.offset.top,s=t.within.height,u=e.top-t.collisionPosition.marginTop,a=i-u,f=u+t.collisionHeight-s-i;t.collisionHeight>s?a>0&&0>=f?(n=e.top+a+t.collisionHeight-s-i,e.top+=a-n):e.top=f>0&&0>=a?i:a>f?i+s-t.collisionHeight:i:a>0?e.top+=a:f>0?e.top-=f:e.top=o(e.top-u,e.top)}},flip:{left:function(e,t){var n,r,i=t.within,s=i.offset.left+i.scrollLeft,o=i.width,a=i.isWindow?i.scrollLeft:i.offset.left,f=e.left-t.collisionPosition.marginLeft,l=f-a,c=f+t.collisionWidth-o-a,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,d=-2*t.offset[0];0>l?(n=e.left+h+p+d+t.collisionWidth-o-s,(0>n||u(l)>n)&&(e.left+=h+p+d)):c>0&&(r=e.left-t.collisionPosition.marginLeft+h+p+d-a,(r>0||c>u(r))&&(e.left+=h+p+d))},top:function(e,t){var n,r,i=t.within,s=i.offset.top+i.scrollTop,o=i.height,a=i.isWindow?i.scrollTop:i.offset.top,f=e.top-t.collisionPosition.marginTop,l=f-a,c=f+t.collisionHeight-o-a,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,v=-2*t.offset[1];0>l?(r=e.top+p+d+v+t.collisionHeight-o-s,e.top+p+d+v>l&&(0>r||u(l)>r)&&(e.top+=p+d+v)):c>0&&(n=e.top-t.collisionPosition.marginTop+p+d+v-a,e.top+p+d+v>c&&(n>0||c>u(n))&&(e.top+=p+d+v))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&11>i,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(n){var r=this.options;return this.helper||r.disabled||e(n.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(n),this.handle?(e(r.iframeFix===!0?"iframe":r.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(n){var r=this.options;return this.helper=this._createHelper(n),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:n.pageX-this.offset.left,top:n.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(n),this.originalPageX=n.pageX,this.originalPageY=n.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this._setContainment(),this._trigger("start",n)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,n),this._mouseDrag(n,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,n),!0)},_mouseDrag:function(n,r){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(n),this.positionAbs=this._convertPositionTo("absolute"),!r){var i=this._uiHash();if(this._trigger("drag",n,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,n),!1},_mouseStop:function(n){var r=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,n)),this.dropped&&(i=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",n)!==!1&&r._clear()}):this._trigger("stop",n)!==!1&&this._clear(),!1):!1},_mouseUp:function(n){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,n),e.ui.mouse.prototype._mouseUp.call(this,n)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(n){return this.options.handle?!!e(n.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(n){var r=this.options,i=e.isFunction(r.helper)?e(r.helper.apply(this.element[0],[n])):"clone"===r.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===r.appendTo?this.element[0].parentNode:r.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(n){"string"==typeof n&&(n=n.split(" ")),e.isArray(n)&&(n={left:+n[0],top:+n[1]||0}),"left"in n&&(this.offset.click.left=n.left+this.margins.left),"right"in n&&(this.offset.click.left=this.helperProportions.width-n.right+this.margins.left),"top"in n&&(this.offset.click.top=n.top+this.margins.top),"bottom"in n&&(this.offset.click.top=this.helperProportions.height-n.bottom+this.margins.top)},_getParentOffset:function(){var n=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(n.left+=this.scrollParent.scrollLeft(),n.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(n={top:0,left:0}),{top:n.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:n.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var n,r,i,s=this.options;return s.containment?"window"===s.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===s.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):s.containment.constructor===Array?(this.containment=s.containment,undefined):("parent"===s.containment&&(s.containment=this.helper[0].parentNode),r=e(s.containment),i=r[0],i&&(n="hidden"!==r.css("overflow"),this.containment=[(parseInt(r.css("borderLeftWidth"),10)||0)+(parseInt(r.css("paddingLeft"),10)||0),(parseInt(r.css("borderTopWidth"),10)||0)+(parseInt(r.css("paddingTop"),10)||0),(n?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(r.css("borderRightWidth"),10)||0)-(parseInt(r.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(n?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(r.css("borderBottomWidth"),10)||0)-(parseInt(r.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=r),undefined):(this.containment=null,undefined)},_convertPositionTo:function(n,r){r||(r=this.position);var i="absolute"===n?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),{top:r.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:r.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(n){var r,i,s,o,u=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=n.pageX,l=n.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),r=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):r=this.containment,n.pageX-this.offset.click.left<r[0]&&(f=r[0]+this.offset.click.left),n.pageY-this.offset.click.top<r[1]&&(l=r[1]+this.offset.click.top),n.pageX-this.offset.click.left>r[2]&&(f=r[2]+this.offset.click.left),n.pageY-this.offset.click.top>r[3]&&(l=r[3]+this.offset.click.top)),u.grid&&(s=u.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/u.grid[1])*u.grid[1]:this.originalPageY,l=r?s-this.offset.click.top>=r[1]||s-this.offset.click.top>r[3]?s:s-this.offset.click.top>=r[1]?s-u.grid[1]:s+u.grid[1]:s,o=u.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/u.grid[0])*u.grid[0]:this.originalPageX,f=r?o-this.offset.click.left>=r[0]||o-this.offset.click.left>r[2]?o:o-this.offset.click.left>=r[0]?o-u.grid[0]:o+u.grid[0]:o)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(n,r,i){return i=i||this._uiHash(),e.ui.plugin.call(this,n,[r,i]),"drag"===n&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,n,r,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(n,r){var i=e(this).data("ui-draggable"),s=i.options,o=e.extend({},r,{item:i.element});i.sortables=[],e(s.connectToSortable).each(function(){var r=e.data(this,"ui-sortable");r&&!r.options.disabled&&(i.sortables.push({instance:r,shouldRevert:r.options.revert}),r.refreshPositions(),r._trigger("activate",n,o))})},stop:function(n,r){var i=e(this).data("ui-draggable"),s=e.extend({},r,{item:i.element});e.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(n),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",n,s))})},drag:function(n,r){var i=e(this).data("ui-draggable"),s=this;e.each(i.sortables,function(){var o=!1,u=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==u&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return r.helper[0]},n.target=this.instance.currentItem[0],this.instance._mouseCapture(n,!0),this.instance._mouseStart(n,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",n),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(n)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",n,this.instance._uiHash(this.instance)),this.instance._mouseStop(n,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",n),i.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var n=e("body"),r=e(this).data("ui-draggable").options;n.css("cursor")&&(r._cursor=n.css("cursor")),n.css("cursor",r.cursor)},stop:function(){var n=e(this).data("ui-draggable").options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(n,r){var i=e(r.helper),s=e(this).data("ui-draggable").options;i.css("opacity")&&(s._opacity=i.css("opacity")),i.css("opacity",s.opacity)},stop:function(n,r){var i=e(this).data("ui-draggable").options;i._opacity&&e(r.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var n=e(this).data("ui-draggable");n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName&&(n.overflowOffset=n.scrollParent.offset())},drag:function(n){var r=e(this).data("ui-draggable"),i=r.options,s=!1;r.scrollParent[0]!==document&&"HTML"!==r.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(r.overflowOffset.top+r.scrollParent[0].offsetHeight-n.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:n.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(r.overflowOffset.left+r.scrollParent[0].offsetWidth-n.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:n.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(n.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(n.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(n.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(n.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,n)}}),e.ui.plugin.add("draggable","snap",{start:function(){var n=e(this).data("ui-draggable"),r=n.options;n.snapElements=[],e(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each(function(){var r=e(this),i=r.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:r.outerWidth(),height:r.outerHeight(),top:i.top,left:i.left})})},drag:function(n,r){var i,s,o,u,a,f,l,c,h,p,d=e(this).data("ui-draggable"),v=d.options,m=v.snapTolerance,g=r.offset.left,y=g+d.helperProportions.width,b=r.offset.top,w=b+d.helperProportions.height;for(h=d.snapElements.length-1;h>=0;h--)a=d.snapElements[h].left,f=a+d.snapElements[h].width,l=d.snapElements[h].top,c=l+d.snapElements[h].height,a-m>y||g>f+m||l-m>w||b>c+m||!e.contains(d.snapElements[h].item.ownerDocument,d.snapElements[h].item)?(d.snapElements[h].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,n,e.extend(d._uiHash(),{snapItem:d.snapElements[h].item})),d.snapElements[h].snapping=!1):("inner"!==v.snapMode&&(i=m>=Math.abs(l-w),s=m>=Math.abs(c-b),o=m>=Math.abs(a-y),u=m>=Math.abs(f-g),i&&(r.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top-d.margins.top),s&&(r.position.top=d._convertPositionTo("relative",{top:c,left:0}).top-d.margins.top),o&&(r.position.left=d._convertPositionTo("relative",{top:0,left:a-d.helperProportions.width}).left-d.margins.left),u&&(r.position.left=d._convertPositionTo("relative",{top:0,left:f}).left-d.margins.left)),p=i||s||o||u,"outer"!==v.snapMode&&(i=m>=Math.abs(l-b),s=m>=Math.abs(c-w),o=m>=Math.abs(a-g),u=m>=Math.abs(f-y),i&&(r.position.top=d._convertPositionTo("relative",{top:l,left:0}).top-d.margins.top),s&&(r.position.top=d._convertPositionTo("relative",{top:c-d.helperProportions.height,left:0}).top-d.margins.top),o&&(r.position.left=d._convertPositionTo("relative",{top:0,left:a}).left-d.margins.left),u&&(r.position.left=d._convertPositionTo("relative",{top:0,left:f-d.helperProportions.width}).left-d.margins.left)),!d.snapElements[h].snapping&&(i||s||o||u||p)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,n,e.extend(d._uiHash(),{snapItem:d.snapElements[h].item})),d.snapElements[h].snapping=i||s||o||u||p)}}),e.ui.plugin.add("draggable","stack",{start:function(){var n,r=this.data("ui-draggable").options,i=e.makeArray(e(r.stack)).sort(function(n,r){return(parseInt(e(n).css("zIndex"),10)||0)-(parseInt(e(r).css("zIndex"),10)||0)});i.length&&(n=parseInt(e(i[0]).css("zIndex"),10)||0,e(i).each(function(r){e(this).css("zIndex",n+r)}),this.css("zIndex",n+i.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(n,r){var i=e(r.helper),s=e(this).data("ui-draggable").options;i.css("zIndex")&&(s._zIndex=i.css("zIndex")),i.css("zIndex",s.zIndex)},stop:function(n,r){var i=e(this).data("ui-draggable").options;i._zIndex&&e(r.helper).css("zIndex",i._zIndex)}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}e.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,n=this.options,r=n.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(r)?r:function(e){return e.is(r)},this.proportions=function(){return arguments.length?(t=arguments[0],undefined):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},e.ui.ddmanager.droppables[n.scope]=e.ui.ddmanager.droppables[n.scope]||[],e.ui.ddmanager.droppables[n.scope].push(this),n.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,n=e.ui.ddmanager.droppables[this.options.scope];n.length>t;t++)n[t]===this&&n.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){"accept"===t&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current,i=!1;return r&&(r.currentItem||r.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(i=!0,!1):undefined}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,n,r){if(!n.offset)return!1;var i,s,o=(e.positionAbs||e.position.absolute).left,u=(e.positionAbs||e.position.absolute).top,a=o+e.helperProportions.width,f=u+e.helperProportions.height,l=n.offset.left,c=n.offset.top,h=l+n.proportions().width,p=c+n.proportions().height;switch(r){case"fit":return o>=l&&h>=a&&u>=c&&p>=f;case"intersect":return o+e.helperProportions.width/2>l&&h>a-e.helperProportions.width/2&&u+e.helperProportions.height/2>c&&p>f-e.helperProportions.height/2;case"pointer":return i=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,s=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(s,c,n.proportions().height)&&t(i,l,n.proportions().width);case"touch":return(u>=c&&p>=u||f>=c&&p>=f||c>u&&f>p)&&(o>=l&&h>=o||a>=l&&h>=a||l>o&&a>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r,i,s=e.ui.ddmanager.droppables[t.options.scope]||[],o=n?n.type:null,u=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;s.length>r;r++)if(!(s[r].options.disabled||t&&!s[r].accept.call(s[r].element[0],t.currentItem||t.element))){for(i=0;u.length>i;i++)if(u[i]===s[r].element[0]){s[r].proportions().height=0;continue e}s[r].visible="none"!==s[r].element.css("display"),s[r].visible&&("mousedown"===o&&s[r]._activate.call(s[r],n),s[r].offset=s[r].element.offset(),s[r].proportions({width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight}))}},drop:function(t,n){var r=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n)))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,s,o,u=e.ui.intersect(t,this,this.options.tolerance),a=!u&&this.isover?"isout":u&&!this.isover?"isover":null;a&&(this.options.greedy&&(s=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===s}),o.length&&(r=e.data(o[0],"ui-droppable"),r.greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,n)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,n),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,n)))}})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;t.length>n;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i);this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){u.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){u.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles)r=e(this.handles[n])[0],(r===t.target||e.contains(r,t.target))&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(n){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=t(this.helper.css("left")),i=t(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===s?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];return p?(n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,r,s,o,u,a=this.options;u={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,r=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,t>u.minWidth&&(u.minWidth=t),s>u.minHeight&&(u.minHeight=s),u.maxWidth>r&&(u.maxWidth=r),u.maxHeight>o&&(u.maxHeight=o)),this._vBoundaries=u},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,r=this.size,s=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(r.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(r.height-e.height),e.left=t.left+(r.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,r=this.axis,s=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,u=n(e.width)&&t.minWidth&&t.minWidth>e.width,a=n(e.height)&&t.minHeight&&t.minHeight>e.height,f=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(r),h=/nw|ne|n/.test(r);return u&&(e.width=t.minWidth),a&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),u&&c&&(e.left=f-t.minWidth),s&&c&&(e.left=f-t.maxWidth),a&&h&&(e.top=l-t.minHeight),o&&h&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,n,r,i,s=this.helper||this.element;for(e=0;this._proportionallyResizeElements.length>e;e++){if(i=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")],t=0;n.length>t;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0);i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var n,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;p&&(f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(n=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=t(n.css("padding"+i))}),f.containerOffset=n.offset(),f.containerPosition=n.position(),f.containerSize={height:n.innerHeight()-r[3],width:n.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a}))},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=Math.abs(o.parentData.left)),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?r(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)})},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};"object"!=typeof i.alsoResize||i.alsoResize.nodeType?a(i.alsoResize):e.each(i.alsoResize,function(e,t){a(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u="number"==typeof n.grid?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&h>n.maxWidth,v=n.maxHeight&&p>n.maxHeight,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(p-f>0?(t.size.height=p,t.position.top=s.top-c):(t.size.height=f,t.position.top=s.top+i.height-f),h-a>0?(t.size.width=h,t.position.left=s.left-l):(t.size.width=a,t.position.left=s.left+i.width-a))}})}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var n,r=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){n=e(r.options.filter,r.element[0]),n.addClass("ui-selectee"),n.each(function(){var n=e(this),r=n.offset();e.data(this,"selectable-item",{element:this,$element:n,left:r.left,top:r.top,right:r.left+n.outerWidth(),bottom:r.top+n.outerHeight(),startselected:!1,selected:n.hasClass("ui-selected"),selecting:n.hasClass("ui-selecting"),unselecting:n.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(n){var r=this,i=this.options;this.opos=[n.pageX,n.pageY],this.options.disabled||(this.selectees=e(i.filter,this.element[0]),this._trigger("start",n),e(i.appendTo).append(this.helper),this.helper.css({left:n.pageX,top:n.pageY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=e.data(this,"selectable-item");i.startselected=!0,n.metaKey||n.ctrlKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",n,{unselecting:i.element}))}),e(n.target).parents().addBack().each(function(){var i,s=e.data(this,"selectable-item");return s?(i=!n.metaKey&&!n.ctrlKey||!s.$element.hasClass("ui-selected"),s.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),s.unselecting=!i,s.selecting=i,s.selected=i,i?r._trigger("selecting",n,{selecting:s.element}):r._trigger("unselecting",n,{unselecting:s.element}),!1):undefined}))},_mouseDrag:function(n){if(this.dragged=!0,!this.options.disabled){var r,i=this,s=this.options,o=this.opos[0],u=this.opos[1],a=n.pageX,f=n.pageY;return o>a&&(r=a,a=o,o=r),u>f&&(r=f,f=u,u=r),this.helper.css({left:o,top:u,width:a-o,height:f-u}),this.selectees.each(function(){var r=e.data(this,"selectable-item"),c=!1;r&&r.element!==i.element[0]&&("touch"===s.tolerance?c=!(r.left>a||o>r.right||r.top>f||u>r.bottom):"fit"===s.tolerance&&(c=r.left>o&&a>r.right&&r.top>u&&f>r.bottom),c?(r.selected&&(r.$element.removeClass("ui-selected"),r.selected=!1),r.unselecting&&(r.$element.removeClass("ui-unselecting"),r.unselecting=!1),r.selecting||(r.$element.addClass("ui-selecting"),r.selecting=!0,i._trigger("selecting",n,{selecting:r.element}))):(r.selecting&&((n.metaKey||n.ctrlKey)&&r.startselected?(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.$element.addClass("ui-selected"),r.selected=!0):(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.startselected&&(r.$element.addClass("ui-unselecting"),r.unselecting=!0),i._trigger("unselecting",n,{unselecting:r.element}))),r.selected&&(n.metaKey||n.ctrlKey||r.startselected||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",n,{unselecting:r.element})))))}),!1}},_mouseStop:function(n){var r=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,r._trigger("unselected",n,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,r._trigger("selected",n,{selected:s.element})}),this._trigger("stop",n),this.helper.remove(),!1}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}function n(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||n(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,i=!1,s=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,s.widgetName+"-item")===s?(r=e(this),!1):undefined}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target)),r?!this.options.handle||n||(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)}),i)?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,n,r){var i,s,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i,s,o=this.options,u=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?u=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(u=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?u=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(u=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r),s&&r.instance===this.currentContainer&&i!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],i):!0)){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,i=this.placeholder.offset(),s=this.options.axis,o={};s&&"x"!==s||(o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c="x"===this.options.axis||r+f>u&&a>r+f,h="y"===this.options.axis||t+l>s&&o>t+l,p=c&&h;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>s&&o>n-this.helperProportions.width/2&&r+this.helperProportions.height/2>u&&a>i-this.helperProportions.height/2},_intersectsWithPointer:function(e){var n="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&"right"===o||"down"===s?2:1:s&&("down"===s?2:1):!1},_intersectsWithSides:function(e){var n=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?"right"===s&&r||"left"===s&&!r:i&&("down"===i&&n||"up"===i&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function n(){u.push(this)}var r,i,s,o,u=[],a=[],f=this._connectWith();if(f&&t)for(r=f.length-1;r>=0;r--)for(s=e(f[r]),i=s.length-1;i>=0;i--)o=e.data(s[i],this.widgetFullName),o&&o!==this&&!o.options.disabled&&a.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=a.length-1;r>=0;r--)a[r][0].each(n);return e(u)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;t.length>n;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--)for(i=e(h[n]),r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s));for(n=c.length-1;n>=0;n--)for(o=c[n][1],u=c[n][0],r=0,f=u.length;f>r;r++)a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--)r=this.items[n],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;r.placeholder&&r.placeholder.constructor!==String||(n=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),s=e("<"+r+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(s)}):"img"===r&&s.attr("src",t.currentItem.attr("src")),n||s.css("visibility","hidden"),s},update:function(e,o){(!n||r.forcePlaceholderSize)&&(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(r){var s,o,u,a,f,l,c,h,p,d,v=null,m=null;for(s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(v&&e.contains(this.containers[s].element[0],v.element[0]))continue;v=this.containers[s],m=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",r,this._uiHash(this)),this.containers[s].containerCache.over=0);if(v)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(u=1e4,a=null,d=v.floating||n(this.currentItem),f=d?"left":"top",l=d?"width":"height",c=this.positionAbs[f]+this.offset.click[f],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!d||t(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[f],p=!1,Math.abs(h-c)>Math.abs(h+this.items[o][l]-c)&&(p=!0,h+=this.items[o][l]),u>Math.abs(h-c)&&(u=Math.abs(h-c),a=this.items[o],this.direction=p?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(r,a,null,!0):this._rearrange(r,null,this.containers[m].element,!0),this._trigger("change",r,this._uiHash()),this.containers[m]._trigger("change",r,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),("document"===i.containment||"window"===i.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){function n(e,t,n){return function(r){n._trigger(e,r,t._uiHash(t))}}this.reverting=!1;var r,i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&i.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||i.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(i.push(function(e){this._trigger("remove",e,this._uiHash())}),i.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)t||i.push(n("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(n("out",this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),r=0;i.length>r;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(r=0;i.length>r;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){var n="ui-effects-";e.effects={effect:{}},function(e,t){function n(e,t,n){var r=c[t.type]||{};return null==e?n||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:e>r.max?r.max:e)}function r(n){var r=f(),i=r._rgba=[];return n=n.toLowerCase(),d(a,function(e,s){var o,u=s.re.exec(n),a=u&&s.parse(u),f=s.space||"rgba";return a?(o=r[f](a),r[l[f].cache]=o[l[f].cache],i=r._rgba=o._rgba,!1):t}),i.length?("0,0,0,0"===i.join()&&e.extend(i,s.transparent),r):s[n]}function i(e,t,n){return n=(n+1)%1,1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(2/3-n):e}var s,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",u=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],f=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},l={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=f.support={},p=e("<p>")[0],d=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=p.style.backgroundColor.indexOf("rgba")>-1,d(l,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),f.fn=e.extend(f.prototype,{parse:function(i,o,u,a){if(i===t)return this._rgba=[null,null,null,null],this;(i.jquery||i.nodeType)&&(i=e(i).css(o),o=t);var c=this,h=e.type(i),p=this._rgba=[];return o!==t&&(i=[i,o,u,a],h="array"),"string"===h?this.parse(r(i)||s._default):"array"===h?(d(l.rgba.props,function(e,t){p[t.idx]=n(i[t.idx],t)}),this):"object"===h?(i instanceof f?d(l,function(e,t){i[t.cache]&&(c[t.cache]=i[t.cache].slice())}):d(l,function(t,r){var s=r.cache;d(r.props,function(e,t){if(!c[s]&&r.to){if("alpha"===e||null==i[e])return;c[s]=r.to(c._rgba)}c[s][t.idx]=n(i[e],t,!0)}),c[s]&&0>e.inArray(null,c[s].slice(0,3))&&(c[s][3]=1,r.from&&(c._rgba=r.from(c[s])))}),this):t},is:function(e){var n=f(e),r=!0,i=this;return d(l,function(e,s){var o,u=n[s.cache];return u&&(o=i[s.cache]||s.to&&s.to(i._rgba)||[],d(s.props,function(e,n){return null!=u[n.idx]?r=u[n.idx]===o[n.idx]:t})),r}),r},_space:function(){var e=[],t=this;return d(l,function(n,r){t[r.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var r=f(e),i=r._space(),s=l[i],o=0===this.alpha()?f("transparent"):this,u=o[s.cache]||s.to(o._rgba),a=u.slice();return r=r[s.cache],d(s.props,function(e,i){var s=i.idx,o=u[s],f=r[s],l=c[i.type]||{};null!==f&&(null===o?a[s]=f:(l.mod&&(f-o>l.mod/2?o+=l.mod:o-f>l.mod/2&&(o-=l.mod)),a[s]=n((f-o)*t+o,i)))}),this[i](a)},blend:function(t){if(1===this._rgba[3])return this;var n=this._rgba.slice(),r=n.pop(),i=f(t)._rgba;return f(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===n[3]&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===n[3]&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();return t&&n.push(~~(255*r)),"#"+e.map(n,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),f.fn.parse.prototype=f.fn,l.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,n,r=e[0]/255,i=e[1]/255,s=e[2]/255,o=e[3],u=Math.max(r,i,s),a=Math.min(r,i,s),f=u-a,l=u+a,c=.5*l;return t=a===u?0:r===u?60*(i-s)/f+360:i===u?60*(s-r)/f+120:60*(r-i)/f+240,n=0===f?0:.5>=c?f/l:f/(2-l),[Math.round(t)%360,n,c,null==o?1:o]},l.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],s=e[3],o=.5>=r?r*(1+n):r+n-r*n,u=2*r-o;return[Math.round(255*i(u,o,t+1/3)),Math.round(255*i(u,o,t)),Math.round(255*i(u,o,t-1/3)),s]},d(l,function(r,i){var s=i.props,o=i.cache,a=i.to,l=i.from;f.fn[r]=function(r){if(a&&!this[o]&&(this[o]=a(this._rgba)),r===t)return this[o].slice();var i,u=e.type(r),c="array"===u||"object"===u?r:arguments,h=this[o].slice();return d(s,function(e,t){var r=c["object"===u?e:t.idx];null==r&&(r=h[t.idx]),h[t.idx]=n(r,t)}),l?(i=f(l(h)),i[o]=h,i):f(h)},d(s,function(t,n){f.fn[t]||(f.fn[t]=function(i){var s,o=e.type(i),a="alpha"===t?this._hsla?"hsla":"rgba":r,f=this[a](),l=f[n.idx];return"undefined"===o?l:("function"===o&&(i=i.call(this,l),o=e.type(i)),null==i&&n.empty?this:("string"===o&&(s=u.exec(i),s&&(i=l+parseFloat(s[2])*("+"===s[1]?1:-1))),f[n.idx]=i,this[a](f)))})})}),f.hook=function(t){var n=t.split(" ");d(n,function(t,n){e.cssHooks[n]={set:function(t,i){var s,o,u="";if("transparent"!==i&&("string"!==e.type(i)||(s=r(i)))){if(i=f(s||i),!h.rgba&&1!==i._rgba[3]){for(o="backgroundColor"===n?t.parentNode:t;(""===u||"transparent"===u)&&o&&o.style;)try{u=e.css(o,"backgroundColor"),o=o.parentNode}catch(a){}i=i.blend(u&&"transparent"!==u?u:"_default")}i=i.toRgbaString()}try{t.style[n]=i}catch(a){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=f(t.elem,n),t.end=f(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},f.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return d(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e}),t}},s=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function n(t){var n,r,i=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,s={};if(i&&i.length&&i[0]&&i[i[0]])for(r=i.length;r--;)n=i[r],"string"==typeof i[n]&&(s[e.camelCase(n)]=i[n]);else for(n in i)"string"==typeof i[n]&&(s[n]=i[n]);return s}function r(t,n){var r,i,o={};for(r in n)i=n[r],t[r]!==i&&(s[r]||(e.fx.step[r]||!isNaN(parseFloat(i)))&&(o[r]=i));return o}var i=["add","remove","toggle"],s={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,n,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,s,o,u){var a=e.speed(s,o,u);return this.queue(function(){var s,o=e(this),u=o.attr("class")||"",f=a.children?o.find("*").addBack():o;f=f.map(function(){var t=e(this);return{el:t,start:n(this)}}),s=function(){e.each(i,function(e,n){t[n]&&o[n+"Class"](t[n])})},s(),f=f.map(function(){return this.end=n(this.el[0]),this.diff=r(this.start,this.end),this}),o.attr("class",u),f=f.map(function(){var t=this,n=e.Deferred(),r=e.extend({},a,{queue:!1,complete:function(){n.resolve(t)}});return this.el.animate(this.diff,r),n.promise()}),e.when.apply(e,f.get()).done(function(){s(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),a.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(n,r,i,s){return r?e.effects.animateClass.call(this,{add:n},r,i,s):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(n,r,i,s){return arguments.length>1?e.effects.animateClass.call(this,{remove:n},r,i,s):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(n){return function(r,i,s,o,u){return"boolean"==typeof i||i===t?s?e.effects.animateClass.call(this,i?{add:r}:{remove:r},s,o,u):n.apply(this,arguments):e.effects.animateClass.call(this,{toggle:r},i,s,o)}}(e.fn.toggleClass),switchClass:function(t,n,r,i,s){return e.effects.animateClass.call(this,{add:n,remove:t},r,i,s)}})}(),function(){function r(t,n,r,i){return e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},null==n&&(n={}),e.isFunction(n)&&(i=n,r=null,n={}),("number"==typeof n||e.fx.speeds[n])&&(i=r,r=n,n={}),e.isFunction(r)&&(i=r,r=null),n&&e.extend(t,n),r=r||n.duration,t.duration=e.fx.off?0:"number"==typeof r?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=i||n.complete,t}function s(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.4",save:function(e,t){for(var r=0;t.length>r;r++)null!==t[r]&&e.data(n+t[r],e[0].style[t[r]])},restore:function(e,r){var s,o;for(o=0;r.length>o;o++)null!==r[o]&&(s=e.data(n+r[o]),s===t&&(s=""),e.css(r[o],s))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;try{s.id}catch(o){s=document.body}return t.wrap(r),(t[0]===s||e.contains(t[0],s))&&e(s).focus(),r=t.parent(),"static"===t.css("position")?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(i),r.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),e.fn.extend({effect:function(){function t(t){function r(){e.isFunction(s)&&s.call(i[0]),e.isFunction(t)&&t()}var i=e(this),s=n.complete,u=n.mode;(i.is(":hidden")?"hide"===u:"show"===u)?(i[u](),r()):o.call(i[0],n,r)}var n=r.apply(this,arguments),i=n.mode,s=n.queue,o=e.effects.effect[n.effect];return e.fx.off||!o?i?this[i](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):s===!1?this.each(t):this.queue(s||"fx",t)},show:function(e){return function(t){if(s(t))return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(t){if(s(t))return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(t){if(s(t)||"boolean"==typeof t)return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,n=4;((t=Math.pow(2,--n))-1)/11>e;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?n(2*e)/2:1-n(-2*e+2)/2}})}()}(jQuery),function(e){e.effects.effect.drop=function(n,r){var i,s=e(this),o=["position","top","bottom","left","right","opacity","height","width"],u=e.effects.setMode(s,n.mode||"hide"),a="show"===u,f=n.direction||"left",l="up"===f||"down"===f?"top":"left",c="up"===f||"left"===f?"pos":"neg",h={opacity:a?1:0};e.effects.save(s,o),s.show(),e.effects.createWrapper(s),i=n.distance||s["top"===l?"outerHeight":"outerWidth"](!0)/2,a&&s.css("opacity",0).css(l,"pos"===c?-i:i),h[l]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+i,s.animate(h,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===u&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),r()}})}}(jQuery),function(e){e.effects.effect.fade=function(n,r){var i=e(this),s=e.effects.setMode(i,n.mode||"toggle");i.animate({opacity:s},{queue:!1,duration:n.duration,easing:n.easing,complete:r})}}(jQuery),function(e){e.effects.effect.highlight=function(n,r){var i=e(this),s=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(i,n.mode||"show"),u={backgroundColor:i.css("backgroundColor")};"hide"===o&&(u.opacity=0),e.effects.save(i,s),i.show().css({backgroundImage:"none",backgroundColor:n.color||"#ffff99"}).animate(u,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===o&&i.hide(),e.effects.restore(i,s),r()}})}}(jQuery),define("lib-app/jquery-ui.min",function(){}),define("storymaps/tpl/builder/MovableGraphic",["dojo/has","dojo/touch","dojo/on","dojo/_base/array","dojo/_base/connect"],function(e,t,n,r,i){return function(o,u,a,f,l){function p(){var r=i.connect(u,"onMouseOver",function(e){e.graphic==a&&o.setMapCursor("move")}),s=i.connect(u,"onMouseOut",function(e){e.graphic==a&&o.setMapCursor("default")}),l=n(u._div.rawNode,t.press,function(t){if(t.graphic==a||e("touch")||e("ie")==10||e("trident")==7)o.disablePan(),c=!0,a.hasBeenMoved=!1}),p=t.release(u._div.rawNode,function(){o.enablePan(),c=!1,f&&a.hasBeenMoved&&f(a,!0)}),v=e("touch")||e("ie")>=10||e("trident")==7?t.move(o.__container,d):i.connect(o,"onMouseDrag",d);h=[r,s,l,p,v]}function d(e){c&&e.mapPoint&&(a.setGeometry(e.mapPoint),l&&!a.hasBeenMoved&&l(a),a.hasBeenMoved=!0)}var c=!1,h=[];p(),this.clean=function(){r.forEach(h,function(e){i.disconnect(e)})}}}),define("storymaps/tpl/builder/DetailPanelBuilder",["lib-build/tpl!./DetailPanelBuilder","lib-build/tpl!./DetailPanelBuilderSlide","lib-build/css!../ui/desktop/DetailPanel","lib-build/css!./DetailPanelBuilder","./textEditor/MediumEditorWrapper","lib-app/jquery-ui.min","../core/WebApplicationData","./MovableGraphic","esri/geometry/webMercatorUtils","esri/SpatialReference","esri/graphic","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/dijit/Search","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){return function(r,s){function k(){var e=$(".entry.active").index();e<0&&(e=0),setTimeout(function(){$(".detailContainer").css("z-index",99999999),$(".detailContainer").show(),m[e].update(),m[e].slideNext(),m[e].slidePrev(),m[e].update(),y.resize(),$(".detailContainer").hide(),$(".detailContainer").css("z-index",0)},0)}function L(e){console.log("OPEN SEARCH WIDGET ",e),$("body").addClass("pickLocation");var t=$.grep(app.layerCurrent.graphics,function(t){return t.attributes.shortlist_id==e}),n=$(".entry.active").index(),r=m[n].slides[m[n].activeIndex];b.show(),$(r).find(".setLocation").hide(),$(r).find(".editLocation").hide(),$(r).find(".cancelLocation").show(),$(r).find(".cancelLocation").click(D);if(!t[0].attributes.locationSet){app.map.setMapCursor("crosshair");var i=app.map.on("click",function(n){t[0].setGeometry(n.mapPoint),t[0].symbol.setWidth(app.cfg.lutIconSpecs.large.getWidth()),t[0].symbol.setHeight(app.cfg.lutIconSpecs.large.getHeight()),t[0].symbol.setOffset(app.cfg.lutIconSpecs.large.getOffsetX(),app.cfg.lutIconSpecs.large.getOffsetY()),app.ui.mainView.selected=t[0],t[0].attributes.locationSet=1,app.ui.mainView.buildMapTips(),t[0].show(),$(r).find(".editLocation").show(),$(r).find(".updateLocation").hide(),$(r).find(".cancelLocation").hide(),b.hide(),b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),app.map.setMapCursor("auto"),i.remove();var s=$.grep($("#myList li"),function(t){return $(t).data("shortlist-id")==e});$(s).find(".unlocated").removeClass("unlocated"),app.addFeatureBar.updateLocatedFeatures();var o=app.map.getLayer(app.data.getShortlistLayerId());o.graphics.length>1&&x.updateShortlistExtent(),o.redraw(),A(t[0]),$("body").removeClass("pickLocation"),H()})}else{t[0].hide();var s=new l(t[0].geometry,t[0].symbol,t[0].attributes);w.add(s),w.graphics[0].show(),E=new u(app.map,w,w.graphics[0],O)}}function A(e){var t=$.grep($("#myList li"),function(t){return $(t).data("shortlist-id")==e.attributes.shortlist_id});$(t).addClass("located"),$(t).find(".unlocated").length&&$(t).find(".unlocated").removeClass("unlocated"),$("body").hasClass("organizeFeatures"),$("body").hasClass("locateFeatures")&&$(".located").hide()}function O(e,t){var n=$(".entry.active").index(),r=m[n].slides[m[n].activeIndex];app.mapTips.clean(!0),T=e,b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$(r).find(".updateLocation").show(),$(r).find(".updateLocation").click(_),$(r).find(".cancelLocation").click(M)}function M(){E&&E.clean(),b.hide(),$("body").removeClass("pickLocation"),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]),app.map.setMapCursor("auto");var e=$(".entry.active").index(),t=m[e].slides[m[e].activeIndex],n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")});b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$(t).find(".cancelLocation").hide(),$(t).find(".updateLocation").hide(),n[0]&&n[0].attributes.locationSet?($(t).find(".editLocation").show(),n[0].show()):$(t).find(".setLocation").show();var r=app.map.getLayer(app.data.getShortlistLayerId());r.redraw()}function _(){E&&E.clean(),S.buildMapTips(),b.hide(),b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$("body").removeClass("pickLocation");var e=$(".entry.active").index(),t=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==T.attributes.shortlist_id}),n=m[e].slides[m[e].activeIndex];t[0].setGeometry(T.geometry),t[0].show(),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]);var r=app.map.getLayer(app.data.getShortlistLayerId());r.redraw(),app.addFeatureBar.updateLocatedFeatures(),app.map.setMapCursor("auto"),app.mapTips.clean(!0),app.ui.mainView.buildMapTips(),x.updateShortlistExtent(),$(n).find(".editLocation").show(),$(n).find(".updateLocation").hide(),$(n).find(".cancelLocation").hide(),H()}function D(){var e=$(".entry.active").index(),t=m[e].slides[m[e].activeIndex],n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")});y.hideSearch(),app.mapTips&&app.mapTips.clean(!0),app.ui.mainView.buildMapTips(),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]),n[0].attributes.locationSet&&n[0].show();var r=app.map.getLayer(app.data.getShortlistLayerId());r.redraw(),b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$(t).find(".cancelLocation").hide(),n[0].attributes.locationSet?$(t).find(".editLocation").show():$(t).find(".setLocation").show()}function P(){var e={};e.mode="add",g.present(e).then(function(e){y.updateSlide(e)})}function H(){var e=$(".entry.active").index();m[e].slides.length==1?($(".detail-btn-left").hide(),$(".detail-btn-right").hide()):($(".detail-btn-left").show(),m[e].activeIndex!=m[e].slides.length-1&&$(".detail-btn-right").show());if(m[e].activeIndex==m[e].slides.length-1&&!$("body").hasClass("locateFeatures")){$(".detail-btn-right").hide();var t=m[e].slides[m[e].activeIndex],n=app.map.getLayer(app.data.getWebAppData().getShortlistLayerId()).graphics,r=$.grep(n,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")});r[0].attributes.name||r[0].attributes.description||r[0].attributes.pic_url||r[0].attributes.thumb_url||r[0].attributes.locationSet?$(".detail-btn-add").show():$(".detail-btn-add").hide()}else $(".detail-btn-add").hide(),m[e].slides.length>1&&$(".detail-btn-right").show()}function B(){console.log("$$$")}function j(){h=!0}var h=!1,v,m=[],g=s,y=this,b,w,E,S,x,T,N,C;this.init=function(e,t){S=e,x=t,setTimeout(function(){b=new p({map:app.map,showInfoWindowOnSelect:!0},"search"),b.startup(),b.hide(),b.on("select-result",function(e){b.hide(),app.map.setMapCursor("auto");var t=$('<div class="addLocationText"><a href="#">Use this location </a> </div>');$(".esriPopup .contentPane").append(t),$(".esriPopup").show();var n=$(".entry.active").index(),r=$(".swiper-slide-active")[n],i=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(r).data("shortlist-id")});i[0].attributes.locationSet||app.map.setMapCursor("crosshair"),$(t).on("click",function(){i[0].setGeometry(e.result.feature.geometry),i[0].attributes.locationSet=1,i[0].show(),b.highlightGraphic.hide(),$(".esriPopup").hide();var t=app.map.getLayer(app.data.getShortlistLayerId());t.redraw(),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]),app.addFeatureBar.updateLocatedFeatures(),A(i[0]),x.updateShortlistExtent(),$(r).find(".setLocation").hide(),$(r).find(".editLocation").show(),$(r).find(".cancelLocation").hide()})})},500),w=new esri.layers.GraphicsLayer,w.id="tempIconLayer",app.map.addLayer(w),app.map.reorderLayer(w,app.map.graphicsLayerIds.length-1)},this.buildSlides=function(e,t){var n=app.map.getLayer(app.data.getShortlistLayerId()),r=$(".entry.active").index();r<0&&(r=0),t>-1&&(r=t),m[r].removeAllSlides();var i=$.grep(n.graphics,function(e){return e.attributes.tab_id==r});i[0]&&i[0].attributes.number&&i.sort(function(e,t){return parseInt(e.attributes.number)-parseInt(t.attributes.number)}),$("body").addClass("loadingPlaces"),$.each(i,function(e,t){var n=t.attributes,i=e+1,s={name:n.name,description:n.description,pic_url:n.pic_url,thumb_url:n.thumb_url,locationSet:1,number:n.number};y.addSlide(i,n.shortlist_id,s,r),m[r].update()}),m[r].update(),k(),setTimeout(function(){$("body").removeClass("loadingPlaces")},500)},this.buildAllSlides=function(){var e=app.map.getLayer(app.data.getShortlistLayerId()),t=e.graphics,n=[],r=$("#nav-bar").find(".nav-tabs > li:not(.dropdown)");$.each(r,function(){n.push([])}),$.each(t,function(e,t){n[parseInt(t.attributes.tab_id)].push(t)}),$.each(n,function(e){y.buildSlides(!1,e)}),k(),y.resize()},this.addDetailPanelSwiper=function(t){var n=t;t||(n=0);if(n==0)$(r).find("#paneLeft").append(e({})),$(r).find(" .detailView")[n].setAttribute("id","detailView"+n);else{var i=$(r).find(" .detailContainer")[n-1];$(i).after(e({})),$(r).find(" .detailView")[n].setAttribute("id","detailView"+n)}$(".detailContainer").hide();var s=$(".detailContainer")[n];$(s).show();var o=new Swiper($(s),{speed:0,setWrapperSize:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0,simulateTouch:!1});m[n]=o,m[n].updating=!1,o.init(),$(s).hide(),o.update(),o.on("onSlideChangeEnd",function(e){H();if($("body").hasClass("loadingPlaces"))return;S.preSelection();var t=$(".entry.active").index(),n=e.slides[e.activeIndex],r=$(n).data("shortlist-id"),i=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==r})[0];S.selected=i,m[t].update(),S.selected&&S.selected.attributes.locationSet&&!app.map.extent.contains(S.selected.geometry)&&app.map.centerAt(S.selected.geometry),setTimeout(function(){S.buildMapTips()},0),$(".esriPopup").hide()}),r.find(".detailClose").click(function(){$(".arcgisSearch").css("display")=="block",M(),r.find(".detailContainer").hide(),app.ui.mobileIntro.screenSize=="small"&&app.ui.mobileFeatureList.showMobileList(),app.ui.mainView.unselect()}),r.find($(".detail-btn-left")[n]).click(function(){var e=$(".entry.active").index(),t=m[e];t.activeIndex===0?t.slideTo(t.slides.length-1,0):t.slidePrev();if($(".arcgisSearch").css("display")=="block"){E&&E.clean(),b.hide(),$("body").removeClass("pickLocation"),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]),app.map.setMapCursor("auto");var e=$(".entry.active").index(),n=m[e].slides[m[e].activeIndex],r=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(n).data("shortlist-id")+1});b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$(n).find(".cancelLocation").hide(),$(n).find(".updateLocation").hide(),r[0]&&r[0].attributes.locationSet?($(n).find(".editLocation").show(),r[0].show()):$(n).find(".setLocation").show();var i=app.map.getLayer(app.data.getShortlistLayerId());i.redraw()}}),r.find($(".detail-btn-right")[n]).click(function(){var e=$(".entry.active").index(),t=m[e];t.activeIndex==t.slides.length-1?t.slideTo(0,0):t.slideNext();if($(".arcgisSearch").css("display")=="block"){E&&E.clean(),b.hide(),$("body").removeClass("pickLocation"),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]),app.map.setMapCursor("auto");var e=$(".entry.active").index(),n=m[e].slides[m[e].activeIndex],r=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(n).data("shortlist-id")-1});b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$(n).find(".cancelLocation").hide(),$(n).find(".updateLocation").hide(),r[0]&&r[0].attributes.locationSet?($(n).find(".editLocation").show(),r[0].show()):$(n).find(".setLocation").show();var i=app.map.getLayer(app.data.getShortlistLayerId());i.redraw()}}),r.find($(".detail-btn-add")[n]).click(function(){app.addFeatureBar.addFeature();if($(".arcgisSearch").css("display")=="block"){E&&E.clean(),b.hide(),$("body").removeClass("pickLocation"),app.map.getLayer("tempIconLayer").remove(app.map.getLayer("tempIconLayer").graphics[0]),app.map.setMapCursor("auto");var e=$(".entry.active").index(),t=m[e].slides[m[e].activeIndex],n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")-1});b.highlightGraphic&&b.highlightGraphic.hide(),$(".esriPopup").hide(),$(t).find(".cancelLocation").hide(),$(t).find(".updateLocation").hide(),n[0]&&n[0].attributes.locationSet?($(t).find(".editLocation").show(),n[0].show()):$(t).find(".setLocation").show();var r=app.map.getLayer(app.data.getShortlistLayerId());r.redraw()}})},this.present=function(e){j()},this.addSlide=function(e,n,s,u){var a=$(".entry.active").index();u>-1&&(a=u);var f=$(".detailContainer")[a];r.find("#detailView"+a).append(t());var l=$(f).find(".swiper-slide")[e-1];$(l).find(".detailFeatureNum").text(e);var c=app.cfg.COLOR_ORDER.split(","),h=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==c[a]});app.data.getWebAppData().getGeneralOptions().numberedIcons?($(l).find(".detailFeatureNum").css("background-color",app.data.getStory()[a].color),$(l).find(".detailFeatureNum").show(),$(l).find(".detailFeatureTitle").removeClass("notNumbered")):($(l).find(".detailFeatureNum").hide(),$(l).find(".detailFeatureTitle").addClass("notNumbered")),$(l).find(".detailPictureDiv img").click(P),$(l).find(".detailPictureDiv .imagePicker").click(P),$(l).data("shortlist-id",n),$(l).find(".detailFeatureTitle").addClass("noTitle");if(s){s.name&&($(l).find(".detailFeatureTitle").html(s.name),$(l).find(".detailFeatureTitle").removeClass("noTitle")),s.pic_url&&($(l).find("img").attr("src",s.pic_url),$(l).find(".imagePicker").hide()),s.description&&$(l).find(".description").html(s.description);if(s.lng&&s.lat||s.locationSet)$(l).find(".setLocation").hide(),$(l).find(".editLocation").show()}!s||!s.lng&&!s.lat&&!s.locationSet?($(l).find(".setLocation").show(),$(l).find(".editLocation").hide()):($(l).find(".editLocation").show(),$(l).find(".setLocation").hide()),m[a].update();var p=function(e,t){var n=$(".entry.active").index(),r=m[n].slides[m[n].activeIndex],i=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(r).data("shortlist-id")});if(t.selector==".detailFeatureTitle"){i[0].attributes.name=$(t).text();var s=$.grep($("#myList li"),function(e){return $(e).data("shortlist-id")==$(r).data("shortlist-id")});$(s).find(".blurb").text($(t).text()),$(r).find(".detailFeatureTitle").removeClass("noTitle"),app.mapTips&&(app.mapTips.clean(!0),app.ui.mainView.buildMapTips())}t.selector==".description"&&(i[0].attributes.description=$(t).html()),o.getTitle()&&d.publish("BUILDER_INCREMENT_COUNTER"),setTimeout(function(){H()},50)};N=new i({container:$(l).find(".detailFeatureTitle"),mode:"single-line",placeholder:"Enter place name...",onBlur:function(e){p(e,$(l).find(".detailFeatureTitle"))}}),C=new i({container:$(l).find(".editable"),mode:"standard",placeholder:"Enter place description...",onBlur:function(e){p(e,$(l).find(".description"))}}),(!s||s&&!s.name)&&setTimeout(function(){$(l).find(".detailFeatureTitleText").focus()},0),$(l).find(".setLocation, .editLocation").click(function(){var e=$(".entry.active").index(),t=m[e].slides[m[e].activeIndex],n=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(t).data("shortlist-id")});L(n[0].attributes.shortlist_id)}),m[a].updating=!1},this.showSlide=function(e){y.resize();var t=$(".entry.active").index(),n=$(".detailContainer")[t];$(n).show(),$(n).css("z-index",99);var r=null;$.each($("#detailView"+t).find($(".swiper-slide")),function(t,n){parseInt($(n).data("shortlist-id"))==e&&(r=t)}),r>-1&&($(n).show(),$(n).css("z-index",99),setTimeout(function(){m[t].slideTo(r,0)},0)),setTimeout(function(){H()},50),y.resize()},this.updateSlide=function(e){var t=$(".entry.active").index();m[t].updating=!0;var n=m[t].slides[m[t].activeIndex];$(n).find("img").attr("src",e.url),$(n).find(".imagePicker").hide();var r=$.grep(app.layerCurrent.graphics,function(e){return e.attributes.shortlist_id==$(n).data("shortlist-id")});r[0].attributes.pic_url=e.url,e.thumb_url?r[0].attributes.thumb_url=e.thumb_url:r[0].attributes.thumb_url=e.url;var i=$.grep($("#myList li"),function(e){return $(e).data("shortlist-id")==$(n).data("shortlist-id")});$(i).find(".tileImage").css("background-image","url("+r[0].attributes.thumb_url+")"),$(i).find("i").hide(),$(n).find(".detailFeatureTitle").text().length<=0&&e.name&&(r[0].attributes.name=e.name,N.setContent({text:e.name}),$(i).find(".blurb").text(e.name),$("#item"+$(n).data("shortlist-id")).find(".blurb").text(e.name),$(n).find(".detailFeatureTitle").removeClass("noTitle")),$(n).find(".description").text().length<=0&&e.description&&(r[0].attributes.description=e.description,C.setContent({text:e.description,convertLine:!0}));if(e.lat&&e.lng&&!r[0].attributes.locationSet){var s=a.lngLatToXY(e.lng,e.lat),u=new c(s[0],s[1],new f({wkid:app.map.spatialReference.wkid}));r[0].setGeometry(u),r[0].attributes.locationSet=1,$(i).addClass("located"),$(i).find(".unlocated").removeClass("unlocated"),$(n).find(".editLocation").show(),$(n).find(".setLocation").hide(),setTimeout(function(){x.updateShortlistExtent()},1e3)}else r[0].attributes.locationSet||$(n).find(".setLocation").show();if(r[0].attributes.locationSet){r[0].show(),app.ui.mainView.selected=r[0],app.ui.mainView.buildMapTips();var l=app.map.getLayer(app.data.getShortlistLayerId());l.redraw()}app.addFeatureBar.updateLocatedFeatures(),o.getTitle()&&d.publish("BUILDER_INCREMENT_COUNTER"),setTimeout(function(){H()},50),m[t].updating=!1},this.updateThemeSwipers=function(e){$.each($(".detailContainer"),function(e,t){$(t).remove()}),$.each(e.entries,function(e){y.addDetailPanelSwiper(e)})},this.hideSearch=function(){b&&b.hide()},this.resize=function(){if(!m.length)return;var e=$(".entry.active").index();e<0&&(e=0),setTimeout(function(){var t=app.isInBuilder?115:35;app.ui.mobileIntro.screenSize=="small"&&($("#paneLeft").css("height",$("#contentPanel").height()-$("#map").height()+10),$("#paneLeft").css("width","100%"),$("#paneLeft").css({top:$("#map").height()-10}),t=20);var n=m[e].slides[m[e].activeIndex];$(n).height($("#paneLeft").outerHeight()-5);var r=$(n).find(".detailHeader").outerHeight();$(".detailTextContainer").css({"margin-top":"10px"}),$(".detailTextContainer").height($("#paneLeft").outerHeight()-r-t+"px"),$(".detailTextContainer").width("100%"),$(".detailPictureDiv img").css("max-width",$("#paneLeft").outerWidth());var i=$("#paneLeft").outerHeight()-r-60<$("#paneLeft").outerHeight()*.6?$("#paneLeft").outerHeight()-r-60:$("#paneLeft").outerHeight()*.6;$(".detailPictureDiv img").css("max-height",parseInt(i)+"px"),$(".detailContainer").width($("#paneLeft").outerWidth()),$(".detailContainer").height($("#paneLeft").outerHeight())},75),m[e].update()},this.close=function(){}}}),define("lib-build/tpl!storymaps/tpl/builder/media/Popup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-header">\r\n			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n			<h4 class="modal-title">'+((__t=lblTitle)==null?"":__t)+'</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="viewMediaSelectorContainer"></div>\r\n				<div class="checkbox opt-select-all-container">\r\n					<label style="outline: none;">\r\n						<input type="checkbox" class="opt-checkbox-select-all">\r\n						Select all\r\n					</label>\r\n				</div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<span class="modal-footer-left"><button class="btn btn-back btn-naked">< '+((__t=btnBack)==null?"":__t)+'</button></span>\r\n			<button class="btnSubmit btn btn-primary"></button>\r\n			<button class="btnCancel btn btn-naked btn-close" data-dismiss="modal">'+((__t=btnCancel)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n";return __p}}),define("lib-build/css!storymaps/tpl/builder/media/Popup",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/MediaSelector",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="mediaSelector">\r\n	<label class="lblSelect">'+((__t=lblSelect)==null?"":__t)+':</label>\r\n	<span class="media-types">\r\n		<form>\r\n			<div class="media-type-wrapper ',hasMap||(__p+=" disabled "),__p+='">\r\n				<label class="checkbox-inline media-type">\r\n					<input type="radio" name="media-type" value="map"> '+((__t=lblMap)==null?"":__t)+'\r\n				</label>\r\n				<div class="mediaContainersArrow"></div>\r\n			</div>\r\n\r\n			<div class="media-type-wrapper">\r\n				<label class="checkbox-inline media-type">\r\n					<input type="radio" name="media-type" value="image"> '+((__t=lblImage)==null?"":__t)+'\r\n				</label>\r\n				<div class="mediaContainersArrow"></div>\r\n			</div>\r\n\r\n			<div class="media-type-wrapper ',hasVideo||(__p+=" disabled "),__p+='">\r\n				<label class="checkbox-inline media-type">\r\n					<input type="radio" name="media-type" value="video"> '+((__t=lblVideo)==null?"":__t)+'\r\n				</label>\r\n				<div class="mediaContainersArrow"></div>\r\n			</div>\r\n\r\n			<div class="media-type-wrapper ',hasWebPage||(__p+=" disabled "),__p+='">\r\n				<label class="checkbox-inline media-type">\r\n					<input type="radio" name="media-type" value="webpage"> '+((__t=lblExternal)==null?"":__t)+'\r\n				</label>\r\n				<div class="mediaContainersArrow"></div>\r\n			</div>\r\n		</form>\r\n	</span>\r\n\r\n	<div class="mediaContainers">\r\n		<div class="mainMediaTypeContainer mapMediaContainer ',hasMap||(__p+=" disabled "),__p+='"></div>\r\n		<div class="mainMediaTypeContainer imageMediaContainer"></div>\r\n		<div class="mainMediaTypeContainer videoMediaContainer"></div>\r\n		<div class="mainMediaTypeContainer webpageMediaContainer"></div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/MediaSelector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/map/WebMapSelector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="webmapSelector">\r\n	<table class="map-cfg">\r\n		<tr class="map-cfg-webmap">\r\n			<td class="map-cfg-title">\r\n				'+((__t=lblWebmap)==null?"":__t)+'\r\n			</td>\r\n			<td class="map-cfg-btns">\r\n				<div class="webmaps-list-container">\r\n					<table style="width: 100%;">\r\n						<tr>\r\n							<td>\r\n								<div class="radio-value btn-group" style="width: 100%;">\r\n									<button class="btn btn-default dropdown-toggle webmaps-list-btn" type="button" data-toggle="dropdown">\r\n										<span class="webmaps-list-btn-inner"></span>&nbsp;<span class="caret"></span>\r\n									</button>\r\n									<ul class="dropdown-menu webmaps-list"></ul>\r\n								</div>\r\n							</td>\r\n							<td class="selected-map-edit-container">\r\n								<span class="btn btn-naked selected-map-edit" style="padding-right: 0px">\r\n									<span class="glyphicon glyphicon-edit" style="margin-right: 3px;"></span>\r\n									'+((__t=lblEdit)==null?"":__t)+'\r\n								</span>\r\n								<span class="selected-map-sharing-status"></span>\r\n								<!-- \r\n								<a href="#" class="help" data-toggle="tooltip" data-placement="right" data-original-title="" title="Make sure your webmaps are shared publicly">\r\n									<img src="resources/tpl/builder/icons/builder-help.png">\r\n								</a>\r\n								 -->\r\n							</td>\r\n						</tr>\r\n					</table>\r\n				</div>\r\n			</td>\r\n		</tr>\r\n		\r\n		<tr class="map-cfg-row map-cfg-location">\r\n			<td class="map-cfg-title">\r\n				'+((__t=lblLocation)==null?"":__t)+'\r\n			</td>\r\n			<td class="map-cfg-btns">\r\n				<div class="regular-control">\r\n					<span class="btn-group">\r\n						<button type="button" class="btn btn-default btn-xs" data-value="default">\r\n							'+((__t=webmapDefault)==null?"":__t)+'\r\n						</button>\r\n						<button type="button" class="btn btn-default btn-xs" data-value="custom">\r\n							'+((__t=customCfg)==null?"":__t)+'&nbsp;\r\n						</button>\r\n					</span>\r\n					<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLocation)==null?"":__t)+'">\r\n						<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n					</a>\r\n				</div>\r\n				<div class="inherit-alt">\r\n					'+((__t=lblLocationAlt)==null?"":__t)+'\r\n					<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLocationAlt)==null?"":__t)+'">\r\n						<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n					</a>\r\n				</div>\r\n			</td>\r\n		</tr>\r\n		\r\n		<tr class="map-cfg-row map-cfg-content">\r\n			<td class="map-cfg-title">\r\n				'+((__t=lblContent)==null?"":__t)+'\r\n			</td>\r\n			<td class="map-cfg-btns">\r\n				<span class="btn-group">\r\n					<button type="button" class="btn btn-default btn-xs" data-value="default">\r\n						'+((__t=webmapDefault)==null?"":__t)+'\r\n					</button>\r\n					<button type="button" class="btn btn-default btn-xs" data-value="custom">\r\n						'+((__t=customCfg)==null?"":__t)+'&nbsp;\r\n					</button>\r\n				</span>\r\n				<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipContent)==null?"":__t)+'">\r\n					<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n				</a>\r\n			</td>\r\n		</tr>\r\n		\r\n		<tr class="map-cfg-row map-cfg-popup">\r\n			<td class="map-cfg-title">\r\n				'+((__t=lblPopup)==null?"":__t)+'\r\n			</td>\r\n			<td class="map-cfg-btns">\r\n				<span class="btn-group">\r\n					<button type="button" class="btn btn-default btn-xs" data-value="default">\r\n						'+((__t=webmapDefault)==null?"":__t)+'\r\n					</button>\r\n					<button type="button" class="btn btn-default btn-xs" data-value="custom">\r\n						'+((__t=customCfg)==null?"":__t)+'&nbsp;\r\n					</button>\r\n				</span>\r\n				<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipPopup)==null?"":__t)+'">\r\n					<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n				</a>\r\n			</td>\r\n		</tr>\r\n		\r\n		<tr class="map-cfg-row map-cfg-controls">\r\n			<td class="map-cfg-title">\r\n				'+((__t=lblControls)==null?"":__t)+'\r\n			</td>\r\n			<td class="map-cfg-btns">\r\n				<div class="checkbox map-cfg-controls-overview">\r\n					<label>\r\n						<input type="checkbox" class="opt-checkbox-overview" />\r\n						'+((__t=lblOverview)==null?"":__t)+'\r\n						<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipOverview)==null?"":__t)+'">\r\n							<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n						</a>\r\n					</label>\r\n				</div>\r\n				<div class="checkbox">\r\n					<label>\r\n						<input type="checkbox" class="opt-checkbox-legend" />\r\n						'+((__t=lblLegend)==null?"":__t)+' \r\n						<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLegend)==null?"":__t)+'">\r\n							<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\r\n						</a>\r\n					</label>\r\n				</div>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n	\r\n	<div class="webmap-loading">\r\n	\r\n	</div>\r\n	\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/map/WebMapSelector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/map/MapConfigOverlay",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="mapConfigOverlay toc">\r\n	<!--  \r\n	<div class="expandButton">\r\n		<span class="toc-title">\r\n			'+((__t=tocTitle)==null?"":__t)+'\r\n		</span>\r\n		<span class="toc-toggle"></span>\r\n	</div>\r\n	-->\r\n	<div class="header">'+((__t=tocTitle)==null?"":__t)+'</div>\r\n	<div class="explain">'+((__t=tocExplain)==null?"":__t)+'</div>\r\n	<div class="tocContainer"><!-- TOC is injected here --></div>\r\n	<div class="btns">\r\n		<button type="button" class="btn btn-primary save">'+((__t=tocSave)==null?"":__t)+'</button>\r\n		<div style="margin-top:10px">\r\n			<button type="button" class="btn btn-sm btn-naked reset">'+((__t=btnReset)==null?"":__t)+'</button> | \r\n			<button type="button" class="btn btn-sm btn-naked cancel">'+((__t=btnCancel)==null?"":__t)+'</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n	\r\n<div class="mapConfigOverlay position">\r\n	<div class="header">'+((__t=extentTitle)==null?"":__t)+'</div>\r\n	<div class="explain">'+((__t=extentExplain)==null?"":__t)+'</div>\r\n	<div class="btns">\r\n		<button type="button" class="btn btn-primary save">'+((__t=extentSave)==null?"":__t)+'</button>\r\n		<div style="margin-top:10px">\r\n			<button type="button" class="btn btn-sm btn-naked reset">'+((__t=btnReset)==null?"":__t)+'</button> | \r\n			<button type="button" class="btn btn-sm btn-naked cancel">'+((__t=btnCancel)==null?"":__t)+'</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n<div class="mapConfigOverlay popup">\r\n	<div class="header">'+((__t=popupTitle)==null?"":__t)+'</div>\r\n	<div class="explain">'+((__t=popupExplain)==null?"":__t)+'</div>\r\n	<div class="btns">\r\n		<button type="button" class="btn btn-primary save">'+((__t=popupSave)==null?"":__t)+'</button>\r\n		<div style="margin-top:10px">\r\n			<button type="button" class="btn btn-sm btn-naked reset">'+((__t=btnReset)==null?"":__t)+'</button> | \r\n			<button type="button" class="btn btn-sm btn-naked cancel">'+((__t=btnCancel)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/media/map/MapConfigOverlay",[],function(){}),define("text!lib-app/arcgis-dijit-table-of-contents/js/dijit/templates/TableOfContents.html",[],function(){return'<div class="${theme}" role="presentation">\r\n    <div class="${css.container}">\r\n          <div data-dojo-attach-point="_layersNode"></div>\r\n    </div>\r\n</div>'}),define("lib-app/arcgis-dijit-table-of-contents/js/TableOfContents",["dojo/Evented","dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/on","text!./dijit/templates/TableOfContents.html","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/event","dojo/_base/array"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=t([s,o,e],{declaredClass:"esri.dijit.TableOfContents",templateString:a,options:{theme:"TableOfContents",map:null,layers:null,visible:!0},constructor:function(e,t){var r=n.mixin({},this.options,e);this.domNode=t,this.set("map",r.map),this.set("layers",r.layers),this.set("theme",r.theme),this.set("visible",r.visible),this.watch("theme",this._updateThemeWatch),this.watch("visible",this._visible),this.watch("layers",this._refreshLayers),this.watch("map",this.refresh),this.css={container:"toc-container",layer:"toc-layer",firstLayer:"toc-first-layer",title:"toc-title",titleContainer:"toc-title-container",content:"toc-content",titleCheckbox:"toc-checkbox",checkboxCheck:"icon-check-1",titleText:"toc-text",accountText:"toc-account",visible:"toc-visible",settingsIcon:"icon-cog",settings:"toc-settings",actions:"toc-actions",account:"toc-account",clear:"clear"}},startup:function(){this.map||(this.destroy(),console.log("TableOfContents::map required")),this.map.loaded?this._init():u.once(this.map,"load",n.hitch(this,function(){this._init()}))},destroy:function(){this._removeEvents(),this.inherited(arguments)},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},refresh:function(){this._createList()},_createList:function(){var e=this.get("layers");this._nodes=[],this._removeEvents(),this._layersNode.innerHTML="";if(e&&e.length){for(var t=0;t<e.length;t++){var n=e[t],r=n.layerObject||(n.featureCollection?n.featureCollection.layers[0].layerObject:null);if(!r)continue;var i=this.css.titleCheckbox,s=this.css.layer;t===e.length-1&&(s+=" ",s+=this.css.firstLayer),r.visible&&(s+=" ",s+=this.css.visible,i+=" ",i+=this.css.checkboxCheck);var o=c.create("div",{className:s});c.place(o,this._layersNode,"first");var u=c.create("div",{className:this.css.title});c.place(u,o,"last");var a=c.create("div",{className:this.css.titleContainer});c.place(a,u,"last");var f=c.create("div",{className:i});c.place(f,a,"last");var l=c.create("div",{className:this.css.titleText,title:n.title,innerHTML:n.title});c.place(l,a,"last");var h;n.account&&(h=c.create("a",{className:this.css.accountText,id:n.account}),c.place(h,l,"last"));var p,d;n.settings&&(p=c.create("div",{className:this.css.settings,id:n.settings}),c.place(p,a,"last"),d=c.create("div",{className:this.css.settingsIcon}),c.place(d,p,"last"));var v=c.create("div",{className:this.css.clear});c.place(v,a,"last");var m={checkbox:f,title:u,titleContainer:a,titleText:l,accountText:h,settingsIcon:d,settingsDiv:p,layer:o};this._nodes.push(m),this._checkboxEvent(t)}this._setLayerEvents()}},_refreshLayers:function(){this.refresh()},_removeEvents:function(){var e;if(this._checkEvents&&this._checkEvents.length)for(e=0;e<this._checkEvents.length;e++)this._checkEvents[e].remove();if(this._layerEvents&&this._layerEvents.length)for(e=0;e<this._layerEvents.length;e++)this._layerEvents[e].remove();this._checkEvents=[],this._layerEvents=[]},_toggleVisible:function(e,t){f.toggle(this._nodes[e].layer,this.css.visible,t),f.toggle(this._nodes[e].checkbox,this.css.checkboxCheck,t),this.emit("toggle",{index:e,visible:t})},_layerEvent:function(e,t){if(!e)return;var r=u(e,"visibility-change",n.hitch(this,function(e){this._toggleVisible(t,e.visible)}));this._layerEvents.push(r)},_featureCollectionVisible:function(e,t,n){var r,i=e.visibleLayers,s=e.featureCollection.layers;i&&i.length?r=p.every(i,function(e){return s[e].layerObject.visible===n}):r=p.every(s,function(e){return e.layerObject.visible===n}),r&&this._toggleVisible(t,n)},_createFeatureLayerEvent:function(e,t,r){var i=e.featureCollection.layers,s=u(i[r].layerObject,"visibility-change",n.hitch(this,function(n){var r=n.visible;this._featureCollectionVisible(e,t,r)}));this._layerEvents.push(s)},_featureLayerEvent:function(e,t){var n=e.featureCollection.layers;if(n&&n.length)for(var r=0;r<n.length;r++)this._createFeatureLayerEvent(e,t,r)},_setLayerEvents:function(){var e=this.get("layers"),t;if(e&&e.length)for(var n=0;n<e.length;n++){var r=e[n];r.featureCollection&&r.featureCollection.layers&&r.featureCollection.layers.length?this._featureLayerEvent(r,n):(t=r.layerObject,this._layerEvent(t,n))}},_getLayerVisibility:function(e){if(this.layers&&this.layers.length){var t=this.layers[e],n=t.layerObject,r=t.featureCollection;if(r)return visibleLayers=t.visibleLayers,visibleLayers&&visibleLayers.length?r.layers[visibleLayers[0]].layerObject.visible:r.layers[0].layerObject.visible;if(n)return t.layerObject.visible}},_toggleLayer:function(e,t){if(this.layers&&this.layers.length){var n,r=this.layers[e],i=r.layerObject,s=r.featureCollection,o,u;if(s){o=r.visibleLayers;if(o&&o.length){n=!s.layers[o[0]].layerObject.visible,n=t!==undefined?t:n;for(u=0;u<o.length;u++)i=s.layers[o[u]].layerObject,i.setVisibility(n)}else{n=!s.layers[0].layerObject.visible,n=t!==undefined?t:n;for(u=0;u<s.layers.length;u++)i=s.layers[u].layerObject,i.setVisibility(n)}}else i&&(n=!r.layerObject.visible,n=t!==undefined?t:n,i.setVisibility(n))}},_checkboxEvent:function(e){var t=function(t){if(!t.ctrlKey)this._toggleLayer(e),h.stop(t);else{var n=this.get("layers"),r=this._getLayerVisibility(e);if(n&&n.length)for(var i=0;i<n.length;i++)this._toggleLayer(i,!r);h.stop(t)}};if(!this._nodes[e])return;var r=u(this._nodes[e].checkbox,"click",n.hitch(this,t));this._checkEvents.push(r);var i=u(this._nodes[e].titleText,"click",n.hitch(this,t));this._checkEvents.push(i)},_init:function(){this._visible(),this._createList(),this.set("loaded",!0),this.emit("load",{})},_updateThemeWatch:function(){var e=arguments[1],t=arguments[2];f.remove(this.domNode,e),f.add(this.domNode,t)},_visible:function(){this.get("visible")?l.set(this.domNode,"display","block"):l.set(this.domNode,"display","none")}});return r("extend-esri")&&n.setObject("dijit.TableOfContents",d,i),d}),define("lib-build/css!lib-app/arcgis-dijit-table-of-contents/css/TableOfContents",[],function(){}),define("storymaps/common/builder/media/map/MapConfigOverlay",["lib-build/tpl!./MapConfigOverlay","lib-build/css!./MapConfigOverlay","dojo/i18n!commonResources/nls/webmap.js?v="+app.version,"dojo/i18n!commonResources/nls/media.js?v="+app.version,"lib-app/arcgis-dijit-table-of-contents/js/TableOfContents","lib-build/css!lib-app/arcgis-dijit-table-of-contents/css/TableOfContents","esri/geometry/Extent","dojo/Deferred","dojo/on","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f){function C(e,t){return c=new u,h=t,m=!1,y=!1,p=app.map._params.extent,d=app.map.extent,v=t?!!t.extent:!1,g=a(app.map,"extent-change",_),f.subscribe("CORE_UPDATE_EXTENT",M),$(".mainMediaContainer.active .mapControls").addClass("hidden"),S=!1,x=app.mapItem?app.mapItem.itemData.operationalLayers:[],E=t?!!t.layers:!1,T=x?j():[],F(),v?m=JSON.stringify(app.lastExtentSet)!=JSON.stringify(t.extent):m=JSON.stringify(app.lastExtentSet)!=JSON.stringify(app.map.mapJournalInitExtent)&&JSON.stringify(app.lastExtentSet)!=JSON.stringify(p),console.log(JSON.stringify(app.lastExtentSet)!=JSON.stringify(app.map.mapJournalInitExtent),JSON.stringify(app.lastExtentSet)!=JSON.stringify(p),app.lastExtentSet,app.map.mapJournalInitExtent,p,v,E),z(e),c}function k(){$(".mainMediaContainer.active .mapControls").removeClass("hidden"),W(),g.remove();var e=j();c.resolve({extent:m?app.map.extent:null,layers:e&&e.length?e:null,popup:U()})}function L(){l.find(".position .save").click(k),l.find(".position .reset").click(A),l.find(".position .cancel").click(O),l.find(".toc .save").click(k),l.find(".toc .reset").click(P),l.find(".toc .cancel").click(H),l.find(".popup .save").click(k),l.find(".popup .reset").click(R),l.find(".popup .cancel").click(R)}function A(){app.map.setExtent(p).then(function(){m=!1})}function O(){app.ignoreNextEvent=!0,y=!0,app.map.setExtent(d).then(function(){m=v,k()})}function M(){y=!0,m=!1}function _(){y?y=!1:m=!0}function D(){b&&b.destroy();if($(".mainMediaContainer.active .mapContainer").hasClass("has-geocoder"))return}function P(){$.each(x,function(e,t){t.layerObject?t.layerObject.setVisibility(t.visibility):t.featureCollection&&$.each(t.featureCollection.layers,function(e,n){n.layerObject.setVisibility(t.visibility)})})}function H(){$.each(x,function(e,t){var n=t.layerObject||(t.featureCollection?t.featureCollection.layers[0].layerObject:null),r=$(T).filter(function(e,t){return t.id==n.id}),i=r.length?r[0].visibility:t.visibility;t.layerObject?n.setVisibility(i):$.each(t.featureCollection.layers,function(e,t){t.layerObject.setVisibility(i)})}),k()}function B(){S=j().length>0}function j(){var e=[];return $.each(x,function(t,n){var r=n.layerObject||(n.featureCollection?n.featureCollection.layers[0].layerObject:null);r&&n.visibility!=r.visible&&e.push({id:r.id,visibility:r.visible})}),e}function F(){w&&w.destroy(),l.find(".tocContainer").html('<div class="TableOfContents"></div>'),w=new i({map:app.map,layers:x},l.find(".TableOfContents")[0]),(!x||!x.length)&&l.find(".TableOfContents").html('<div style="margin-bottom: 10px;">'+n.commonWebmap.configure.tocNoData+"</div>"),a(w,"toggle",B),a(w,"load",function(){l.find(".toc-checkbox").addClass("glyphicon glyphicon-unchecked")}),w.startup()}function I(){}function q(){}function R(){app.map.infoWindow.hide(),app.map.infoWindow.clearFeatures(),k()}function U(){var e=app.map.infoWindow.getSelectedFeature();if(!e)return null;var t=e.getLayer(),n=t.fields;if(!n)return null;var r=$.grep(n,function(e){return e.type=="esriFieldTypeOID"});t&&n&&!r.length&&(r=$.grep(n,function(e){return e.name=="OBJECTID"||e.name=="FID"}),r.length||(r=$.grep(n,function(e){return e.type=="esriFieldTypeInteger"})));if(r.length){var i=r[0].name;return{layerId:t.id,fieldName:i,fieldValue:e.attributes[i],anchorPoint:app.map.infoWindow.location.toJson()}}return null}function z(e){$("body").addClass("has-builder-mask"),$(".panelEditBtn").fadeOut(),e=="LOCATION"?(l.find(".mapConfigOverlay.position").show(),D()):e=="CONTENT"?l.find(".mapConfigOverlay.toc").show():e=="POPUP"&&(l.find(".mapConfigOverlay.popup").show(),N=[app.map.infoWindow.on("show",I),app.map.infoWindow.on("hide",q)]),e!="LOCATION"&&(app.map.disableMapNavigation(),$(app.map.__container).parent().find(".esriSimpleSliderTL").hide())}function W(){$("body").removeClass("has-builder-mask"),$(".panelEditBtn").fadeIn(),l.find(".mapConfigOverlay").hide(),app.map.enableMapNavigation(),$(app.map.__container).parent().find(".esriSimpleSliderTL").show(),$(".mainMediaContainer.active .geocoder").hide(),N&&(N[0].remove(),N[1].remove(),N=null)}var l=$("#mainStagePanel"),c=null,h=null,p=null,d=null,v=null,m=null,g=null,y=null,b=null,w=null,E=null,S=null,x=null,T=null,N=null;return l.append(e({btnReset:n.commonWebmap.configure.btnReset,btnCancel:n.commonWebmap.configure.btnCancel,tocTitle:n.commonWebmap.configure.tocTitle,tocExplain:n.commonWebmap.configure.tocExplain+" "+n.commonWebmap.configure.hintNavigation,tocSave:n.commonWebmap.configure.tocSave,tocHint:n.commonWebmap.configure.hintNavigation,extentTitle:n.commonWebmap.configure.extentTitle,extentExplain:n.commonWebmap.configure.extentExplain,extentSave:n.commonWebmap.configure.extentSave,popupTitle:n.commonWebmap.configure.popupTitle,popupExplain:n.commonWebmap.configure.popupExplain+" "+n.commonWebmap.configure.hintNavigation,popupSave:n.commonWebmap.configure.popupSave})),L(),{present:C}}),define("storymaps/common/builder/media/map/MapViewerWrapperUtils",["esri/arcgis/utils"],function(e){return{isWhiteListedDomain:function(){return document.location.host.match(/\.esri\.com$/)||document.location.host.match(/\.arcgis\.com$/)},getMapViewerLink:function(e){return this.getMapViewerURL()+"?webmap="+e},getMapViewerURL:function(){return this.getPortalURL()+"/home/webmap/viewer.html"},getPortalURL:function(){var t=e.arcgisUrl.split("/sharing/")[0];return app.portal.allSSL&&(t=t.replace("http:","https:")),t},getPortalDomain:function(){var e=document.createElement("a");return e.setAttribute("href",this.getPortalURL()),e.protocol+"//"+e.hostname},viewerIsSameDomain:function(){var e=this.getPortalURL().split("//").slice(-1)[0],t=e.split("."),n=document.location.host,r=n.split(".");return e==n||e.split("/").length>1&&e.split("/")[0]==n?!0:r.length<3?n==e:r.slice(1).join(".")==t.slice(-2).join(".")}}}),define("lib-build/tpl!storymaps/common/builder/media/map/ErrorDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title"></h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="error-msg"></div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n		<span class="error"></span>\r\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnClose)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/media/map/ErrorDialog",[],function(){}),define("storymaps/common/builder/media/map/ErrorDialog",["lib-build/tpl!./ErrorDialog","lib-build/css!./ErrorDialog","dojo/topic"],function(e,t,n){return function(r){function i(){r.on("show.bs.modal",function(){$("#addEditPopup .backdrop").show()}),r.on("hide.bs.modal",function(){$("#addEditPopup .backdrop").hide()})}r.html(e({btnClose:i18n.commonCore.common.close})),i(),this.present=function(e){var t="";r.find(".modal-title").html(e.newMap?i18n.commonWebmap.editor.newTitle:i18n.commonWebmap.editor.editTitle),e.error=="DOMAIN"?t+=i18n.commonWebmap.editor.notavailable2.replace("%PRODUCT%",e.isPortal?"Portal for ArcGIS":"ArcGIS Online"):e.error=="PORTAL"?t+=i18n.commonWebmap.editor.notavailable3:e.error=="DEV_TOKEN"?t+="Sorry, creating or editing a map in development mode require some extra configuration.":e.error=="DEV_FAIL"&&(t+="Sorry, creating or editing a map is not supported in development environment."),e.error!="DEV_FAIL"&&e.error!="TOUCH_ONLY"&&(t+="<br /><br />"),e.error=="DEV_TOKEN"?t+="To enable the map editor, please read the instructions in <i>app/storymaps/common/builder/media/map/MapViewerWrapper.js</i>.":e.error=="DEV_FAIL"?t+="":e.newMap?t+=i18n.commonWebmap.editor.notavailable4.replace("%MV%",'<a href="'+e.url+'" target="_blank">'+i18n.commonWebmap.editor.notavailable6+"</a>"):t+=i18n.commonWebmap.editor.notavailable5.replace("%MV%",'<a href="'+e.url+'" target="_blank">'+i18n.commonWebmap.editor.notavailable6+"</a>").replace("%apply%",'<a class="map-reload">'+i18n.commonWebmap.editor.notavailable7+"</a>"),r.find(".error-msg").html(t),r.find(".map-reload").click(function(){n.publish("ADDEDIT_RELOAD_CURRENT_WEBMAP")}),r.modal({keyboard:!0})}}}),define("storymaps/common/builder/media/map/WebMapSelector",["lib-build/tpl!./WebMapSelector","lib-build/css!./WebMapSelector","../../browse-dialog/js/BrowseIdDlg","lib-build/css!../../browse-dialog/css/browse-dialog","lib-build/css!../../browse-dialog/storymaps-override","./MapConfigOverlay","./MapViewerWrapperUtils","./ErrorDialog","esri/geometry/Extent","dojo/Deferred","dojo/topic","dijit/registry","dojo/on","dojo/_base/lang","dojo/has"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){return function(r,i,a,f){function w(e,t){r.find(".webmaps-list").empty();var n=app.appCfg.mapsUseTermSection?i18n.commonWebmap.selector.sections:i18n.commonWebmap.selector.entries,i=app.appCfg.mapsUseTermSection?i18n.commonWebmap.selector.section:i18n.commonWebmap.selector.entry;$.each(t,function(e,t){var r=t.title||'<span class="smallLoader titleLoader"></span><span style="text-transform: uppercase">'+i18n.commonWebmap.selector.loadingTitle+"</span>",s=t.sharing?t.sharing:'<span class="smallLoader"></span>',o="";t.entries&&t.entries.length&&(t.entries.length==1?o+=i+" "+t.entries[0]:o+=n+" "+t.entries.join(", ")),t.actions&&t.actions.length&&(o+=o?" "+i18n.commonWebmap.selector.and+" ":"",t.actions.length==1?o+=i18n.commonWebmap.selector.action.toLowerCase()+" "+t.actions[0]:o+=i18n.commonWebmap.selector.actions.toLowerCase()+" "+t.actions.join(", ")),!t.entries&&!t.actions&&(o=i18n.commonWebmap.selector.originalWebmap.replace("%TPL_NAME%",app.cfg.TPL_NAME)),E("",t.id,r,o,s)}),E("action-btn browse-webmap","",i18n.commonWebmap.selector.browseMaps,""),E("action-btn create-webmap","",i18n.commonWebmap.selector.createMap,""),e?(r.find(".webmaps-list-btn-inner").data("webmap",e).html('<span class="title">'+app.data.getWebmapTitle(e)+'</span><span class="info">'+i18n.commonWebmap.selector.current+"</span>"),r.find(".selected-map-sharing-status").html(app.data.getWebmapSharing(e))):r.find(".webmaps-list-btn-inner").html(i18n.commonWebmap.selector.select),r.find(".selected-map-edit").toggle(!!e),r.find(".webmaps-list li:not(.action-btn) a").click(function(){r.find(".webmaps-list-btn-inner").data("webmap",$(this).find(".webmap-entry").data("webmap")).html($(this).find(".title").eq(0).clone()),r.find(".selected-map-sharing-status").html($(this).find(".sharing-status").html()),r.find(".map-cfg-row").fadeIn(),_(),y={}}),r.find(".browse-webmap a").click(function(){g.show()}),r.find(".create-webmap a").click(A)}function E(e,t,n,i,s){r.find(".webmaps-list").append('<li class="'+e+'">'+'<a data-href="#">'+'<span class="webmap-entry" data-webmap="'+t+'">'+'<span class="title">'+n+"</span>"+'<span class="info">'+i+"</span>"+(s?'<span class="sharing-status">'+s+"</span>":"")+"</span>"+"</a>"+"</li>")}function S(e){var t=r.find('.webmaps-list .webmap-entry[data-webmap="'+e.id+'"]');t.find(".title").html(e.title),t.find(".sharing-status").html(e.sharing)}function x(){g=new n({portal:app.portal,galleryType:"webmap"}),h(g._grid,"onItemClick",function(){g.onClose()}),h(g,"close",function(){g.get("selected")&&T(g.get("selected").id,g.get("selected").title,!1)})}function T(e,t,n){var i=n?i18n.commonWebmap.selector.newCreatedMap:i18n.commonWebmap.selector.newMap;r.find(".webmaps-list-btn-inner").data("webmap",e).html('<span class="title">'+t+"</span>"+'<span class="info">'+i+"</span>"),r.find(".selected-map-edit").toggle(!0),y={},_(),f&&f({newMedia:{type:"webmap",webmap:{id:e,title:t}}}),v.postDisplay()}function N(){r.find(".help").tooltip({trigger:"hover"}),l.subscribe("LOADED_WEBMAP_INFOS",S),r.find(".map-cfg-row .btn-group .btn").click(function(){$(this).parent().find(".btn").removeClass("btn-primary"),$(this).addClass("btn-primary")}),r.find('.map-cfg-location .btn[data-value="custom"]').click(function(){D("LOCATION")}),r.find('.map-cfg-content .btn[data-value="custom"]').click(function(){D("CONTENT")}),r.find('.map-cfg-popup .btn[data-value="custom"]').click(function(){D("POPUP")}),r.find(".selected-map-edit").click(O)}function C(){return r.find(".webmaps-list-btn-inner").data("webmap")}function k(){var e=C();return e&&e.match(/^[A-Fa-f0-9]{32}$/)}function L(){return m.media&&m.media.webmap&&m.media.webmap.id==C()}function A(){M()?b.present({newMap:!0,error:"TOUCH_ONLY",url:o.getMapViewerURL(),isPortal:app.isPortal}):!app.isPortal&&!o.isWhiteListedDomain()&&app.isProduction?b.present({newMap:!0,error:"DOMAIN",url:o.getMapViewerURL(),isPortal:app.isPortal}):app.isPortal&&!o.viewerIsSameDomain()&&app.isProduction?b.present({newMap:!0,error:"DOMAIN",url:o.getMapViewerURL(),isPortal:app.isPortal}):app.isPortal&&!app.portal.hasMyStories?b.present({newMap:!0,error:"PORTAL",url:o.getMapViewerURL(),isPortal:app.isPortal}):app.builder.openMapViewer({newMap:!0,title:app.builder.getAddEditEntryTitle()}).then(function(e){e.newMap&&T(e.newMapInfos.id,e.newMapInfos.title,!0)},function(e){(e=="DEV_TOKEN"||e=="DEV_FAIL")&&b.present({newMap:!0,error:e})})}function O(){M()?b.present({newMap:!1,error:"TOUCH_ONLY",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):!app.isPortal&&!o.isWhiteListedDomain()&&app.isProduction?b.present({newMap:!1,error:"DOMAIN",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):app.isPortal&&!o.viewerIsSameDomain()&&app.isProduction?b.present({newMap:!1,error:"DOMAIN",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):app.isPortal&&!app.portal.hasMyStories?b.present({newMap:!1,error:"PORTAL",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):app.builder.openMapViewer({id:C()}).then(function(e){e.newMap&&T(e.newMapInfos.id,e.newMapInfos.title,!0)},function(e){(e=="DEV_TOKEN"||e=="DEV_FAIL")&&b.present({newMap:!1,error:e})})}function M(){return d("touch")&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(navigator.userAgent)}function _(e,t,n){var i=e||!!y.extent,s=t||!!y.layers,o=n||!!y.popup;r.find('.map-cfg .map-cfg-location .btn[data-value="default"]').toggleClass("btn-primary",!i),r.find('.map-cfg .map-cfg-location .btn[data-value="custom"]').toggleClass("btn-primary",i),r.find('.map-cfg .map-cfg-content .btn[data-value="default"]').toggleClass("btn-primary",!s),r.find('.map-cfg .map-cfg-content .btn[data-value="custom"]').toggleClass("btn-primary",s),r.find('.map-cfg .map-cfg-popup .btn[data-value="default"]').toggleClass("btn-primary",!o),r.find('.map-cfg .map-cfg-popup .btn[data-value="custom"]').toggleClass("btn-primary",o),C()&&r.find(".map-cfg-row").show(),f&&f()}function D(e){var t=C();r.find(".map-cfg").addClass("disabled"),r.find(".map-cfg-info").hide().addClass("disabled"),r.find(".webmap-loading").show().html(i18n.commonCore.common.loading+"...");if(!t)return;if(L())P(e,y);else if($.inArray(t,m.webmaps)!=-1){var n=l.subscribe("ADDEDIT_WEBMAP_DONE",function(){n.remove(),P(e)});l.publish("ADDEDIT_SHOW_WEBMAP",t)}else{var i,s;i=l.subscribe("ADDEDIT_WEBMAP_DONE",function(){i.remove(),s.remove(),P(e)}),s=l.subscribe("ADDEDIT_LOAD_WEBMAP_FAIL",function(){i.remove(),s.remove(),_(),r.find(".webmap-loading").show().html('<div class="error">'+i18n.viewer.errors.mapLoadingFail+"</div>"),setTimeout(function(){r.find(".webmap-loading").hide(),r.find(".map-cfg").removeClass("disabled")},3e3)}),l.publish("ADDEDIT_LOAD_WEBMAP",t)}}function P(e,t){i(),s.present(e,t||{}).then(function(t){e=="LOCATION"?y.extent=t.extent?t.extent.toJson():null:e=="CONTENT"?y.layers=t.layers:e=="POPUP"&&(y.popup=t.popup),_(),a(),r.find(".webmap-loading").hide(),r.find(".map-cfg").removeClass("disabled")})}var v=this,m=null,g=null,y=null,b=new u($("#mapErrorDialog"));r.append(e({lblWebmap:i18n.commonWebmap.selector.lblWebMap,lblEdit:i18n.commonCore.common.edit,lblLocation:i18n.commonWebmap.selector.lblLocation,lblContent:i18n.commonWebmap.selector.lblContent,lblPopup:i18n.commonWebmap.selector.lblPopup,lblControls:i18n.commonWebmap.selector.lblControls,lblOverview:i18n.commonWebmap.selector.lblOverview,lblLegend:i18n.commonWebmap.selector.lblLegend,webmapDefault:i18n.commonWebmap.selector.webmapDefault,customCfg:i18n.commonWebmap.selector.customCfg,tooltipLocation:i18n.commonWebmap.selector.tooltipLocation,tooltipContent:i18n.commonWebmap.selector.tooltipContent,tooltipPopup:i18n.commonWebmap.selector.tooltipPopup,tooltipOverview:i18n.commonWebmap.selector.tooltipOverview,tooltipLegend:i18n.commonWebmap.selector.tooltipLegend,mapCfgInvite:i18n.commonWebmap.selector.mapCfgInvite,lblLocationAlt:i18n.commonWebmap.selector.lblLocationAlt,tooltipLocationAlt:i18n.commonWebmap.selector.tooltipLocationAlt})),N(),this.present=function(e){var t=e.media&&e.media.type=="webmap";e.options=e.options||{},m=e,y={},t&&(y={extent:e.media.webmap.extent,layers:e.media.webmap.layers,popup:e.media.webmap.popup,legend:e.media.webmap.legend,overview:e.media.webmap.overview},e.mode=="add"&&(y.extent=app.map?app.map.extent.toJson():null)),r.find(".webmaps-list-btn-inner").data("webmap",""),r.find(".selected-map-sharing-status").html(""),w(t?e.media.webmap.id:"",e.webmaps),r.find(".map-cfg-row").toggle(!!t&&app.data.getStoryLength()!==0);var n=!0;e.options.mapsSyncAppOption&&(n=e.options.showLocationControl),r.find(".map-cfg-location .regular-control").toggle(n),r.find(".map-cfg-location .inherit-alt").toggle(!n);var i=!1,s=!1;t&&(i=e.media.webmap.overview?e.media.webmap.overview.enable:!1,s=e.media.webmap.legend?e.media.webmap.legend.enable:!1),r.find(".opt-checkbox-overview").prop("checked",i),r.find(".opt-checkbox-legend").prop("checked",s),r.find(".map-cfg-controls-overview").toggle(!e.options.hideOverview),r.find(".lbl-configure").html(i18n.commonWebmap.selector.btnConfigure);var o=null,u=null,a=null;m.mode=="edit"&&L()&&(o=!!m.media.webmap.extent,u=!!m.media.webmap.layers,a=!!m.media.webmap.popup),r.find(".map-cfg-controls").toggleClass("disable",!!m.disableMapExtras),_(o,u,a),c.byId("browse-id-dialog")&&(c.byId("browse-id-dialog").destroy(),c.byId("browse-id-search-box").destroy(),c.byId("gallery")&&c.byId("gallery").destroy(),g=null),x(),this.postDisplay()},this.checkError=function(){var e=!k();return r.find(".webmapIdFieldContainer").toggleClass("has-feedback has-error",e),e},this.getData=function(){var e=null,t=C(),n=r.find('.map-cfg .map-cfg-location .btn[data-value="custom"]').hasClass("btn-primary"),i=r.find('.map-cfg .map-cfg-content .btn[data-value="custom"]').hasClass("btn-primary"),s=r.find('.map-cfg .map-cfg-popup .btn[data-value="custom"]').hasClass("btn-primary");return k()?(e={id:t,extent:n&&y?y.extent:null,layers:i&&y?y.layers:null,popup:s&&y?y.popup:null,legend:{enable:r.find(".opt-checkbox-legend").prop("checked"),openByDefault:y&&y.legend?y.legend.openByDefault:!1}},m.options.hideOverview||p.mixin(e,{overview:{enable:r.find(".opt-checkbox-overview").prop("checked"),openByDefault:y&&y.overview?y.overview.openByDefault:!0}}),e):null},this.activate=function(){v.postDisplay()},this.postDisplay=function(){if(r.find(".webmapSelector").width()===0)return;r.find(".selected-map-edit-container").css("width",r.find(".selected-map-edit").width())}}}),define("lib-build/tpl!storymaps/common/builder/media/image/Selector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelector">\r\n	<div class="selectorView viewHomeContainer"></div>\r\n	<div class="selectorView viewFlickrContainer"></div>\r\n	<div class="selectorView viewPicasaContainer"></div>\r\n	<div class="selectorView mediaSelectorPickerContainer"></div>\r\n	<div class="selectorView mediaSelectorConfigureContainer"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/Selector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewHome",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelectorHome">\r\n	<table class="imageSelectorTable">\r\n		<tr>\r\n			<td class="btn-container btn-select-flickr">\r\n				<span class="btn-img"></span>\r\n			</td>\r\n			<td class="btn-container btn-select-picasa">\r\n				<span class="btn-img"></span>\r\n			</td>\r\n			<td class="btn-container btn-select-url">\r\n				<span class="btn-img"></span>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n</div>\r\n<div class="facebook-warning"></div>\r\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewHome",[],function(){}),define("storymaps/common/builder/media/image/ViewHome",["lib-build/tpl!./ViewHome","lib-build/css!./ViewHome","dojo/has"],function(e,t,n){return function(r,i){function s(){r.find(".btn-select-flickr").click(function(){i("flickr")}),r.find(".btn-select-picasa").click(function(){i("picasa")}),r.find(".btn-select-url").click(function(){i("configure",{fromService:!1})}),app.cfg.AUTHORIZED_IMPORT_SOURCE.flickr||r.find(".btn-select-flickr").addClass("disabled").unbind("click"),app.cfg.AUTHORIZED_IMPORT_SOURCE.picasa||r.find(".btn-select-picasa").addClass("disabled").unbind("click"),!n("touch")&&!app.cfg.AUTHORIZED_IMPORT_SOURCE.flickr&&r.find(".btn-select-flickr").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.commonCore.common.disabledAdmin,container:"body"}),!n("touch")&&!app.cfg.AUTHORIZED_IMPORT_SOURCE.picasa&&r.find(".btn-select-picasa").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.commonCore.common.disabledAdmin,container:"body"}),n("touch")||r.find(".btn-select-url").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.commonMedia.mediaSelector.url,container:"body"}),r.find(".facebook-warning").html(i18n.commonMedia.imageSelectorFacebook.warning.replace("${learn}",'<a href="http://links.esri.com/storymaps/facebook_support" target="_blank">'+i18n.commonMedia.imageSelectorFacebook.learn+"</a>"))}r.append(e({})),s(),this.present=function(e){r.find(".imageSelectorHome").toggleClass("two-choices",e.mode=="import"),r.find(".btn-select-url").toggle(e.mode!="import"),r.show()}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewFlickr",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelectorFlickr">\r\n	<form class="form-inline" role="form" onsubmit="return false;">\r\n		<div class="form-group">\r\n			<span class="service-logo"></span>\r\n			<input type="text" class="form-control userName" value="" placeholder="'+((__t=fieldUserName)==null?"":__t)+'"/>\r\n		</div>\r\n		<button class="btn btn-primary btn-userLogin">'+((__t=btnSearch)==null?"":__t)+'</button>\r\n		<span class="loadingMsg"></span>\r\n	</form>\r\n	<div class="errorMsg"></div>\r\n	<div class="sets"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewFlickr",[],function(){}),define("storymaps/common/utils/connector/Flickr",["dojo/Deferred","dojo/_base/lang"],function(e,t){return function(r){function s(){return l("flickr.tags.getListUser",{user_id:i})}function o(){return l("flickr.photosets.getList",{user_id:i})}function u(n,r){var s=new e;r.photoSize=r.photoSize||"b",r.thumbSize=r.thumbSize||"m";var o=t.mixin({extras:"geo,description"},{user_id:i},r);return l(n,o).done(function(e){(!e||e.stat!="ok")&&s.reject();var t=[],n=[];e.photos?n=e.photos.photo:e.photoset&&(n=e.photoset.photo),$.each(n,function(e,n){t.push({name:n.title||"",description:n.description?n.description._content||"":"",pic_url:f(n,r.photoSize),thumb_url:f(n,r.thumbSize),lat:n.latitude||"",lng:n.longitude||"",is_video:!1})}),s.resolve(t)}),s}function a(e){return $.each(e,function(e,t){t._thumbnail="https://farm2.static.flickr.com/"+t.server+"/"+t.primary+"_"+t.secret+"_s"+".jpg"}),e}function f(e,t){return"https://farm"+e.farm+".static.flickr.com/"+e.server+"/"+e.id+"_"+e.secret+"_"+t+".jpg"}function l(e,t){var n="https://api.flickr.com/services/rest/?method="+e+"&format=json"+"&api_key="+r+(t?"&"+$.param(t):"")+"&jsoncallback=?";return $.getJSON(n)}var i=null;if(!r){console.error("Flickr initialization error - missing apiKey parameter");return}this.connect=function(t,n,r){var u=new e;return n=n===!1?!1:!0,r=r===!1?!1:!0,l("flickr.people.findByUsername",{username:t}).done(function(e){e&&e.stat=="ok"?(i=e.user.id,n&&r?$.when(s(),o()).done(function(e,t){u.resolve({tags:e[0].who.tags.tag,sets:a(t[0].photosets.photoset)})}):n?o().then(function(e){u.resolve({sets:a(e.photosets.photoset)})}):r?s().then(function(e){u.resolve({tags:e.who.tags.tag})}):u.resolve({})):u.reject()}),u},this.getPicturesInSet=function(e,n){return u("flickr.photosets.getPhotos",t.mixin({photoset_id:e},n))},this.getPicturesByTag=function(e,n){return u("flickr.photos.search",t.mixin({tags:e},n))}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewFlickrSet",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="set" data-id="'+((__t=id)==null?"":__t)+'" style="'+((__t=style)==null?"":__t)+'">\r\n	<img src="'+((__t=thumb)==null?"":__t)+'" />\r\n	<div>'+((__t=title)==null?"":__t)+" ("+((__t=nb)==null?"":__t)+")</div>\r\n</div>";return __p}}),define("storymaps/common/builder/media/image/ViewFlickr",["lib-build/tpl!./ViewFlickr","lib-build/css!./ViewFlickr","storymaps/common/utils/connector/Flickr","lib-build/tpl!./ViewFlickrSet"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".userName").val(),t=i.parents(".smallSize").length?3:4;f(),o.connect(e,!0,!1).then(function(e){var n="";if(!e||!e.sets||!e.sets.length){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.mediaSelector.noData);return}$.each(e.sets,function(e,i){n+=r({id:i.id,thumb:i._thumbnail,title:i.title._content,nb:i.photos,style:e%t===0?"clear:both":""})}),i.find(".sets").removeClass("disabled").show().html(n),i.find(".sets").off("click").click(a),i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>')},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorFlickr.signInMsg2)})}function a(e){f(),i.find(".sets").addClass("disabled"),o.getPicturesInSet($(e.target).data("id")||$(e.target).parents(".set").data("id"),{per_page:100}).then(function(e){i.find(".loadingMsg").html(""),i.find(".sets").removeClass("disabled");if(!e.length)return;s("picker",{data:e})},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorFlickr.loadingFailed)})}function f(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide()}function l(){i.find(".btn-userLogin").click(u),i.find(".userName").bind("input propertychange",function(){$(this).val()?i.find(".btn-userLogin").removeAttr("disabled"):i.find(".btn-userLogin").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".sets").html("")}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n(app.cfg.FLICKR_API_KEY);i.append(e({fieldUserName:i18n.commonMedia.imageSelectorFlickr.userInputLbl,btnSearch:i18n.commonMedia.mediaSelector.userLookup})),l(),this.present=function(e){if(!e||!e.isReturning)i.find(".userName").val()||i.find(".btn-userLogin").attr("disabled","disabled");i.show(),i.find(".imageSelectorFlickr").width()&&i.find(".userName").css("width",i.find(".imageSelectorFlickr").width()-85-40-i.find(".btn-userLogin").outerWidth()).focus()}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewPicasa",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelectorPicasa">\r\n	<form class="form-inline" role="form" onsubmit="return false;">\r\n		<div class="form-group">\r\n			<span class="service-logo"></span>\r\n			<input type="text" class="form-control userName" value="" placeholder="'+((__t=fieldUserName)==null?"":__t)+'"/>\r\n		</div>\r\n		<button class="btn btn-primary btn-userLogin">'+((__t=btnSearch)==null?"":__t)+'</button>\r\n		<span class="loadingMsg"></span>\r\n	</form>\r\n	<div class="errorMsg"></div>\r\n	<div class="albums"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewPicasa",[],function(){}),define("storymaps/common/utils/connector/Picasa",["dojo/Deferred"],function(e){return function(){this.getAlbums=function(t){var n=new e,r=document.location.protocol+"//picasaweb.google.com/data/feed/base/user/"+t+"?alt=json&access=public";return t?($.ajax({url:r,dataType:"jsonp",timeout:4e3}).then(function(e){var t=[];e&&e.feed&&e.feed.entry&&$.each(e.feed.entry,function(e,n){t.push({url:n.id.$t,title:n.title.$t||"",thumbnailUrl:n.media$group.media$thumbnail[0].url})}),n.resolve(t)},function(){n.reject()}),n):(n.reject(),n)},this.getAlbum=function(t,n){var r=new e,i=t.replace("/data/entry/base/","/data/feed/base/")+"&kind=photo&fields=title,subtitle,icon,entry(title,gphoto:numphotos,media:group(media:content,media:thumbnail,media:description),georss:where)";return t?(i+="&imgmax=1600",i+=n?"&max-results="+n:"",$.getJSON(i,function(e){var t=[];$.each(e.feed.entry,function(e,n){var r=n.media$group.media$content[0].url||"",i=n.media$group.media$thumbnail[2].url||"";r=r.replace("https://","http://"),i=i.replace("https://","http://");var s={name:n.media$group.media$description.$t||"",description:"",pic_url:r,thumb_url:i,lat:"",lng:"",is_video:!1};n.georss$where&&n.georss$where.gml$Point&&n.georss$where.gml$Point.gml$pos&&n.georss$where.gml$Point.gml$pos.$t&&n["georss$where"]["gml$Point"]["gml$pos"]["$t"].split(" ").length==2&&(s.lat=n.georss$where.gml$Point.gml$pos.$t.split(" ")[0],s.lng=n.georss$where.gml$Point.gml$pos.$t.split(" ")[1]),t.push(s)}),r.resolve(t)}),r):(r.reject(),r)}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewPicasaAlbum",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="album" data-id="'+((__t=id)==null?"":__t)+'" style="'+((__t=style)==null?"":__t)+'">\r\n	<img src="'+((__t=thumb)==null?"":__t)+'" class="album-thumb" />\r\n	<div>'+((__t=title)==null?"":__t)+"</div>\r\n</div>";return __p}}),define("storymaps/common/builder/media/image/ViewPicasa",["lib-build/tpl!./ViewPicasa","lib-build/css!./ViewPicasa","storymaps/common/utils/connector/Picasa","lib-build/tpl!./ViewPicasaAlbum"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".userName").val(),t=i.parents(".smallSize").length?3:4;f(),o.getAlbums(e).then(function(e){var n="";if(!e||!e.length){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.mediaSelector.noData);return}$.each(e,function(e,i){n+=r({id:i.url,thumb:i.thumbnailUrl,title:i.title,style:e%t===0?"clear:both":""})}),i.find(".albums").removeClass("disabled").show().html(n),i.find(".albums").off("click").click(a),i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>')},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorPicasa.signInMsg2)})}function a(e){f(),i.find(".albums").addClass("disabled"),o.getAlbum($(e.target).parents(".album").data("id"),200).then(function(e){i.find(".loadingMsg").html(""),i.find(".albums").removeClass("disabled");if(!e.length)return;s("picker",{data:e})},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorFlickr.loadingFailed)})}function f(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide()}function l(){i.find(".btn-userLogin").click(u),i.find(".userName").bind("input propertychange",function(){$(this).val()?i.find(".btn-userLogin").removeAttr("disabled"):i.find(".btn-userLogin").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".albums").html("")}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n(app.cfg.FLICKR_API_KEY);i.append(e({fieldUserName:i18n.commonMedia.imageSelectorPicasa.userInputLbl,btnSearch:i18n.commonMedia.mediaSelector.userLookup})),l(),this.present=function(e){if(!e||!e.isReturning)i.find(".userName").val()||i.find(".btn-userLogin").attr("disabled","disabled");i.show(),i.find(".imageSelectorPicasa").width()&&i.find(".userName").css("width",i.find(".imageSelectorPicasa").width()-85-40-i.find(".btn-userLogin").outerWidth()).focus()}}}),define("lib-build/css!storymaps/common/builder/media/ViewPicker",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/ViewPickerItem",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="mediaItem" data-id="'+((__t=id)==null?"":__t)+'" style="'+((__t=style)==null?"":__t)+'">\r\n	<img class="mediaImg" src="'+((__t=thumb)==null?"":__t)+'" />\r\n	<div>'+((__t=title)==null?"":__t)+"</div>\r\n</div>";return __p}}),define("storymaps/common/builder/media/ViewPicker",["lib-build/css!./ViewPicker","lib-build/tpl!./ViewPickerItem"],function(e,t){return function(n,r,i){var s=null;this.present=function(e){if(!e.isReturning){var o="";s=e,$.each(e.data,function(e,n){o+=t({id:e,title:n.name,thumb:n.thumb_url,style:e%2===0?"clear:both":""})}),n.html(o)}n.off("click"),n.find(".mediaItem").off("click"),e.mode=="import"?($(".opt-checkbox-select-all").attr("checked",!1),$(".opt-select-all-container").show(),n.find(".mediaItem").addClass("import"),$(".opt-checkbox-select-all").off("change").change(function(){n.find(".mediaItem").toggleClass("selected",$(this).is(":checked")),i&&i()}),n.find(".mediaItem").on("click",function(){$(this).toggleClass("selected"),i&&i()})):n.click(function(e){var t=$(e.target).parents(".mediaItem").index();t!=-1&&r("configure",{mode:s.mode,fromService:!0,media:s.data[t]})}),n.find(".mediaItem").removeClass("selected"),n.show()},this.getData=function(){var e=[];return s&&s.data&&$.each(n.find(".mediaItem.selected"),function(t,n){e.push(s.data[$(n).data("id")])}),e},this.checkError=function(){return!n.find(".mediaItem.selected").length}}}),define("lib-build/css!storymaps/common/builder/media/ViewConfigure",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/ViewConfigure",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="mediaSelectorConfigure">\r\n	<form role="form">\r\n		<div class="form-group">\r\n			<label>'+((__t=lblURL)==null?"":__t)+'</label>\r\n			<input type="text" class="form-control mediaURL" placeholder="'+((__t=lblURLPH)==null?"":__t)+'">\r\n			<p class="mediaURLError">'+((__t=lblURLError)==null?"":__t)+"</p>\r\n		</div>\r\n		",mode=="inlineText"&&(__p+='\r\n			<div class="inline-image">\r\n				<div class="form-group">\r\n					<label style="display: block">'+((__t=lblLabel)==null?"":__t)+'</label>\r\n					<textarea class="form-control mediaTitle" spellcheck="true" placeholder="'+((__t=lblLabelPH)==null?"":__t)+'" style="height: 74px; margin-top: 5px;"></textarea>\r\n				</div>\r\n				<div class="form-group">\r\n					<div class="checkbox">\r\n						<label>\r\n							<input type="checkbox" value="opt-maximize">\r\n							'+((__t=lblMaximize)==null?"":__t)+'\r\n							<a href="#" class="maximizeHelp" data-toggle="tooltip" data-placement="right" data-title="'+((__t=lblMaximizeHelp)==null?"":__t)+'">\r\n								<img src="resources/tpl/builder/icons/builder-help.png"/>\r\n							</a>\r\n						</label>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div class="inline-video">\r\n				<label style="display: block; margin-bottom: 15px; margin-left: 122px;">'+((__t=lblPosition)==null?"":__t)+'</label>\r\n				<div style="text-align: center">\r\n					<div class="media-configure-position" data-val="fit">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition3)==null?"":__t)+"</div>\r\n						<div>"+((__t=lblPosition3Explain2)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="custom">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-custom.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition5)==null?"":__t)+'</div>\r\n						<div class="position-params">\r\n							<div>\r\n								<input type="text" class="form-control input-sm posCustomW" placeholder="'+((__t=phWidth)==null?"":__t)+'" style="display: inline-block; width: 65px;">\r\n								<a href="#" class="dimHelp" data-toggle="tooltip">\r\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\r\n								</a>\r\n							</div>\r\n							<div style="margin-top: 2px;">\r\n								<input type="text" class="form-control input-sm posCustomH" placeholder="'+((__t=phHeight)==null?"":__t)+'" style="display: inline-block; width: 65px;">\r\n								<a href="#" class="dimHelp2" data-toggle="tooltip">\r\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\r\n								</a>\r\n							</div>\r\n						</div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<!--\r\n			<div class="form-group">\r\n				<label style="display: block">Alignment</label>\r\n				<label class="checkbox-inline" style="margin-left: -18px;">\r\n					<input type="radio" name="mediaDisplay" value="none"> None\r\n				</label>\r\n				<label class="checkbox-inline">\r\n					<input type="radio" name="mediaDisplay" value="left"> Left\r\n				</label>\r\n				<label class="checkbox-inline">\r\n					<input type="radio" name="mediaDisplay" value="center"> Center\r\n				</label>\r\n				<label class="checkbox-inline">\r\n					<input type="radio" name="mediaDisplay" value="right"> Right\r\n				</label>\r\n			</div>\r\n			-->\r\n		'),mode=="mainMedia"&&(__p+='\r\n			<div class="form-group position-image">\r\n				<label style="display: block; margin-bottom: 15px;">'+((__t=lblPosition)==null?"":__t)+'</label>\r\n				<div>\r\n					<div class="media-configure-position" data-val="fill">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-fill.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition2)==null?"":__t)+"</div>\r\n						<div>"+((__t=lblPosition2Explain)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="fit">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition3)==null?"":__t)+"</div>\r\n						<div>"+((__t=lblPosition3Explain)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="stretch">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-stretch.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition4)==null?"":__t)+"</div>\r\n						<div>"+((__t=lblPosition4Explain)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="center">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-center.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition1)==null?"":__t)+'</div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div class="form-group position-video">\r\n				<label style="display: block; margin-bottom: 15px; margin-left: 7px;">'+((__t=lblPosition)==null?"":__t)+'</label>\r\n				<div style="text-align: center">\r\n					<div class="media-configure-position" data-val="stretch">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-stretch.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition2)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="fit">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition3)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="center">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-center.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition1)==null?"":__t)+'</div>\r\n					</div>\r\n\r\n					<div class="media-configure-position" data-val="custom">\r\n						<div class="position-selected"></div>\r\n						<img class="position-img" src="resources/common/icons/media-configure-position-custom.png" />\r\n						<div class="position-lbl">'+((__t=lblPosition5)==null?"":__t)+'</div>\r\n						<div class="position-params">\r\n							<div>\r\n								<input type="text" class="form-control input-sm posCustomW" placeholder="'+((__t=phWidth)==null?"":__t)+'" style="display: inline-block; width: 65px;">\r\n								<a href="#" class="dimHelp" data-toggle="tooltip">\r\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\r\n								</a>\r\n							</div>\r\n							<div style="margin-top: 2px;">\r\n								<input type="text" class="form-control input-sm posCustomH" placeholder="'+((__t=phHeight)==null?"":__t)+'" style="display: inline-block; width: 65px;">\r\n								<a href="#" class="dimHelp2" data-toggle="tooltip">\r\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\r\n								</a>\r\n							</div>\r\n						</div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n\r\n		'),mode=="shortlist"&&(__p+='\r\n			<div class="form-group">\r\n				<label>'+((__t=lblThumbURL)==null?"":__t)+'</label>\r\n				<input type="text" class="form-control mediaThumbURL" placeholder="'+((__t=lblURLPH)==null?"":__t)+'">\r\n				<p class="mediaThumbURLError">'+((__t=lblURLError)==null?"":__t)+"</p>\r\n			</div>\r\n		"),__p+='\r\n\r\n		<div class="form-group mediaUnloadStrategy">\r\n			<div class="checkbox">\r\n				<label>\r\n					<input type="checkbox" class="navigateOutUnload" />\r\n					'+((__t=unloadLbl)==null?"":__t)+'\r\n					<a href="#" class="unloadHelp" data-toggle="tooltip" data-title="'+((__t=unloadHelp)==null?"":__t)+'">\r\n						<img src="resources/tpl/builder/icons/builder-help.png"/>\r\n					</a>\r\n				</label>\r\n			</div>\r\n		</div>\r\n		<div class="form-group embedProtocol">\r\n			<div class="checkbox">\r\n				<label>\r\n					<input type="checkbox" class="embedProtocolSecure" />\r\n					'+((__t=embedProtocolLabel)==null?"":__t)+'\r\n				</label>\r\n				<div class="embedProtocolHelp">\r\n					'+((__t=embedProtocolInfo)==null?"":__t)+"\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</form>\r\n</div>\r\n";return __p}}),define("storymaps/common/builder/media/ViewConfigure",["lib-build/css!./ViewConfigure","lib-build/tpl!./ViewConfigure","../../utils/CommonHelper","dojo/_base/lang","dojo/Deferred"],function(e,t,n,r,i){return function(s,o){function c(){s.find(".imageDetailsLbl").click(function(){s.find(".imageDetailsContainer").toggleClass("expanded")}),s.find(".media-configure-position").off("click").click(function(){var e=$(this).data("val");s.find(".media-configure-position").removeClass("selected"),$(this).addClass("selected"),s.find('.media-configure-position[data-val="custom"]').find(".position-params").toggleClass("disabled",e!="custom")}),s.find(".dimHelp").tooltip("destroy").tooltip({title:i18n.commonMedia.mediaConfigure.tooltipDimension,html:!0,trigger:"hover"}),s.find(".dimHelp2").tooltip("destroy").tooltip({title:i18n.commonMedia.mediaConfigure.tooltipDimension2,html:!0,trigger:"hover"}),s.find(".maximizeHelp, .unloadHelp").tooltip({html:!0,trigger:"hover"})}var u=["center","fill","fit","stretch","custom"],a=null,f=null,l=null;app.appCfg.mediaPickerConfigureForceMode&&(o.mode=app.appCfg.mediaPickerConfigureForceMode),s.append(t({mode:o.mode,lblURL:i18n.commonMedia.mediaConfigure.lblURL,lblURLPH:i18n.commonMedia.mediaConfigure.lblURLPH,lblURLError:i18n.commonMedia.mediaConfigure.lblURLError,lblLabel:i18n.commonMedia.mediaConfigure.lblLabel,lblLabelPH:i18n.commonMedia.mediaConfigure.lblLabelPH,lblMaximize:i18n.commonMedia.mediaConfigure.lblMaximize,lblMaximizeHelp:i18n.commonMedia.mediaConfigure.lblMaximizeHelp,lblPosition:i18n.commonMedia.mediaConfigure.lblPosition,lblPosition1:i18n.commonMedia.mediaConfigure.lblPosition1,lblPosition2:i18n.commonMedia.mediaConfigure.lblPosition2,lblPosition3:i18n.commonMedia.mediaConfigure.lblPosition3,lblPosition4:i18n.commonMedia.mediaConfigure.lblPosition4,lblPosition5:i18n.commonMedia.mediaConfigure.lblPosition5,phWidth:i18n.commonCore.common.width,phHeight:i18n.commonCore.common.height,lblPosition2Explain:i18n.commonMedia.mediaConfigure.lblPosition2Explain,lblPosition3Explain:i18n.commonMedia.mediaConfigure.lblPosition3Explain,lblPosition3Explain2:i18n.commonMedia.mediaConfigure.lblPosition3Explain2,lblPosition4Explain:i18n.commonMedia.mediaConfigure.lblPosition4Explain,unloadLbl:i18n.commonMedia.mediaConfigure.unloadLbl,unloadHelp:i18n.commonMedia.mediaConfigure.unloadHelp,embedProtocolLabel:i18n.commonMedia.mediaConfigure.embedProtocolLabel,embedProtocolInfo:location.protocol=="https:"?i18n.commonMedia.mediaConfigure.embedProtocolWarning1:i18n.commonMedia.mediaConfigure.embedProtocolWarning2,lblThumbURL:"Thumbnail URL"})),c(),this.present=function(e){var t=e.media,n=null;e.fromService&&(e.media.is_video?t={type:"video",video:{title:e.media.name,titleDisplay:"caption",url:e.media.pic_url}}:t={type:"image",image:{title:e.media.description||e.media.name,titleDisplay:"caption",url:e.media.pic_url}}),t&&t.type=="image"&&t.image&&(n={width:e.fromService?null:t[t.type].width,height:e.fromService?null:t[t.type].height}),f=t?t.type:"image",a=t,l=e,s.find(".mediaURL").val(t?t[t.type].url:"").keyup(function(){s.find(".mediaURLError").fadeOut()}).parent().toggle(e.fromService===!1&&f=="image"),s.find(".mediaURLError").hide(),s.find(".mediaThumbURL").val(t?t[t.type].thumb_url:"").keyup(function(){s.find(".mediaThumbURLError").fadeOut()});var r=f=="webpage"&&t[t.type].frameTag;r&&s.find(".mediaURL").val(t[t.type].frameTag),s.find(".position-image").toggle(f=="image"),s.find(".position-video").toggle(f=="video"||f=="webpage"),s.find(".media-configure-position").removeClass("selected");var i=f=="image"?u[1]:u[3],c=null,h=null;if(e.media&&e.media.type){var p=e.media[e.media.type].display;c=e.media[e.media.type].width,h=e.media[e.media.type].height,$.inArray(p,u)!=-1&&(i=p)}var d=f=="image"?".position-image":".position-video";o.mode=="inlineText"&&(f=="video"||f=="webpage")&&(d=".inline-video",!c&&!h&&(i="fit")),(f=="video"||f=="webpage")&&i=="fit"&&(c="",h=""),s.find(d).find(".media-configure-position[data-val="+i+"]").addClass("selected").click(),s.find(".posCustomW").val(c||""),s.find(".posCustomH").val(h||""),s.find(".inline-image").toggle(f=="image"),s.find(".inline-video").toggle(f=="video"||f=="webpage"),s.find(".mediaTitle").val(t?t[t.type].title:""),s.find('[value="opt-maximize"]').prop("checked",t?t[t.type].activateFullScreen:!1),s.find(".mediaUnloadStrategy").toggle(f=="webpage"),s.find(".navigateOutUnload").prop("checked",!e.media||!e.media[e.media.type]||e.media[e.media.type].unload===undefined||e.media[e.media.type].unload);if(f=="webpage"){var v=location.protocol=="https:",m;t[t.type].url?m=t[t.type].url.match(/https:\/\//):m=$(t[t.type].frameTag).attr("src").match(/https:\/\//),s.find(".embedProtocol").find("label").toggleClass("disabled",v),s.find(".embedProtocolSecure").prop("checked",m)}s.find(".embedProtocol").toggle(f=="webpage"),s.show(),s.find(".mediaURL").focus()},this.checkError=function(e){var t=!1;s.find(".mediaURLError, .mediaThumbURLError").fadeOut();if(l.fromService===!1&&f=="image"){var r=new i,o=e.html();e.html(i18n.commonMedia.mediaConfigure.lblURLCheck);var u=null;if(app.appCfg.mediaPickerConfigureForceMode=="shortlist"){var a=n.prependURLHTTP(s.find(".mediaURL").val().trim()),c=n.prependURLHTTP(s.find(".mediaThumbURL").val().trim());u=new Image,u.src=a,u.onload=function(){var t=new Image;t.src=c,t.onload=function(){e.html(o),r.resolve(!1)},t.onerror=function(){c&&s.find(".mediaThumbURLError").fadeIn(),e.html(o),r.resolve(!0)}},u.onerror=function(){a&&s.find(".mediaURLError").fadeIn();var t=new Image;t.src=c,t.onload=function(){e.html(o),r.resolve(!0)},t.onerror=function(){c&&s.find(".mediaThumbURLError").fadeIn(),e.html(o),r.resolve(!0)}}}else u=new Image,u.src=n.prependURLHTTP(s.find(".mediaURL").val().trim()),u.onload=function(){e.html(o),r.resolve(!1)},u.onerror=function(){s.find(".mediaURLError").fadeIn(),e.html(o),r.resolve(!0)};return r}return t},this.getData=function(){var e=s.find(".media-configure-position.selected").data("val"),t={url:s.find(".mediaURL").val().trim(),type:f};o.mode=="inlineText"?f=="image"?r.mixin(t,{title:s.find(".mediaTitle").val(),width:s.find(".imgActualWidth").val(),height:s.find(".imgActualHeight").val(),type:f,activateFullScreen:s.find('[value="opt-maximize"]').prop("checked")}):(r.mixin(t,{display:e}),e=="custom"&&r.mixin(t,{width:s.find(".inline-video .posCustomW").val(),height:s.find(".inline-video .posCustomH").val()})):o.mode=="shortlist"?r.mixin(t,{thumb_url:s.find(".mediaThumbURL").val()}):(r.mixin(t,{display:e}),e=="custom"&&r.mixin(t,{width:s.find(".position-video .posCustomW").val(),height:s.find(".position-video .posCustomH").val()})),f=="webpage"&&(t.unload=s.find(".navigateOutUnload").prop("checked"));if(f=="webpage"&&a.webpage.frameTag){var i=t.url,u=$(i);s.find(".embedProtocolSecure").prop("checked")?u.attr("src",n.convertURLHTTPS(u.attr("src"))):u.attr("src",n.convertURLHTTP(u.attr("src"))),t.frameTag=u.prop("outerHTML").replace(/ xmlns="[^"]*"/,""),t.url="",t.ts=(new Date).getTime()}else f=="webpage"?s.find(".embedProtocolSecure").prop("checked")?t.url=n.convertURLHTTPS(t.url):t.url=n.convertURLHTTP(t.url):(t.url=n.prependURLHTTP(t.url),t.thumb_url&&(t.thumb_url=n.prependURLHTTP(t.thumb_url)));return t}}}),define("storymaps/common/builder/media/image/Selector",["lib-build/tpl!./Selector","lib-build/css!./Selector","./ViewHome","./ViewFlickr","./ViewPicasa","../ViewPicker","../ViewConfigure"],function(e,t,n,r,i,s,o){return function(u,a,f,l){function y(e,t,n){if(!g[e])return;t=t||{},t.mode=m,e=="home"?v=!1:e!="configure"&&(d=e),n||p.push({name:c,params:h}),c=e,h=t,l.toggle(c!="home"),e!="home"&&l.off("click").click(function(){var e=p.pop()||{name:"home"};y(e.name||"home",e.params,!0)}),u.find(".selectorView").hide(),(!h||!h.fromService||!app.appCfg.mediaPickerSkipConfigure)&&g[e].present(t),app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&(e=="picker"&&m=="import"?$(".opt-select-all-container").show():$(".opt-select-all-container").hide(),u.parents(".modal-content").find(".modal-footer .btnSubmit").toggle(e=="configure"||m=="import")),f&&f()}function b(){}u.append(e({lblStep1:i18n.commonMedia.imageSelector.lblStep1,lblStep2:i18n.commonMedia.imageSelector.lblStep2,lblStep3:i18n.commonMedia.imageSelector.lblStep3}));var c=null,h=null,p=null,d=null,v=!1,m=null,g={home:new n(u.find(".viewHomeContainer"),y),flickr:new r(u.find(".viewFlickrContainer"),y),picasa:new i(u.find(".viewPicasaContainer"),y),picker:new s(u.find(".mediaSelectorPickerContainer"),y,f),configure:new o(u.find(".mediaSelectorConfigureContainer"),a.configure,y)};b(),this.present=function(e){p=[],c=null,h=null,m=e.mode,e.mode=="edit"&&e.media&&e.media.type=="image"?y("configure",{mode:e.mode,media:e.media}):e.keepLastDataSource&&v&&d!=null?y(d,{isReturning:!0}):y("home")},this.checkError=function(e){var t=!1;return c=="configure"?h.fromService&&app.appCfg.mediaPickerSkipConfigure?t=!1:t=g[c].checkError(e):m=="import"?t=g[c].checkError(e):t=!0,u.toggleClass("error",t),v=!t,t},this.getData=function(){return c=="configure"?h.fromService&&app.appCfg.mediaPickerSkipConfigure?(h.media.url=h.media.pic_url,h.media):g[c].getData():c=="picker"&&m=="import"?g[c].getData():null},this.activate=function(){l.toggle(c!="home"),c!="home"&&l.off("click").click(function(){var e=p.pop()||{name:"home"};y(e.name||"home",e.params,!0)})},this.deactivate=function(){l.hide().off("click")}}}),define("lib-build/tpl!storymaps/common/builder/media/video/Selector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelector">\r\n	<div class="selectorView viewHomeContainer"></div>\r\n	<div class="selectorView viewYoutubeContainer"></div>\r\n	<div class="selectorView viewVimeoContainer"></div>\r\n	<div class="selectorView viewOtherContainer"></div>\r\n	<div class="selectorView mediaSelectorPickerContainer"></div>\r\n	<div class="selectorView mediaSelectorConfigureContainer"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/video/Selector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewHome",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelectorHome">\r\n	<table class="videoSelectorTable">\r\n		<tr>\r\n			<td class="btn-container btn-select-youtube">\r\n				<span class="btn-img"></span>\r\n			</td>\r\n			<td class="btn-container btn-select-vimeo">\r\n				<span class="btn-img"></span>\r\n			</td>\r\n			<td class="btn-container btn-select-other">\r\n				<span class="btn-img"><span class="glyphicon glyphicon-film"></span> '+((__t=lblOther)==null?"":__t)+"</span>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/media/video/ViewHome",[],function(){}),define("storymaps/common/builder/media/video/ViewHome",["lib-build/tpl!./ViewHome","lib-build/css!./ViewHome"],function(e){return function(n,r){function i(){n.find(".btn-select-youtube").click(function(){r("youtube")}),n.find(".btn-select-vimeo").click(function(){r("vimeo")}),n.find(".btn-select-other").click(function(){r("other")})}n.append(e({lblOther:i18n.commonMedia.videoSelectorHome.other})),i(),this.present=function(){n.show()}}}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewVideoCommon",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelectorView">\r\n	<form class="form-inline" role="form" onsubmit="return false;">\r\n		<div class="form-group">\r\n			<span class="service-logo '+((__t=serviceId)==null?"":__t)+'"></span>\r\n			<input type="text" class="form-control url" value="" placeholder="'+((__t=fieldUrl)==null?"":__t)+'"/>\r\n		</div>\r\n		<button class="btn btn-primary btn-check">'+((__t=btnCheck)==null?"":__t)+'</button>\r\n		<span class="loadingMsg"></span>\r\n	</form>\r\n	<div class="errorMsg"></div>\r\n	<div class="result-container">\r\n		<div class="video-detail-container"></div>\r\n	</div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/video/ViewVideoCommon",[],function(){}),define("storymaps/common/utils/connector/Youtube",["dojo/Deferred"],function(e){return function(){function n(t){var n=new e,r="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+t+"&key="+app.cfg.YOUTUBE_API_KEY;return $.ajax({url:r,timeout:4e3}).then(function(e){e&&e.items&&e.items.length?n.resolve(e.items[0].snippet):n.reject()},function(e){n.reject(e)}),n}function r(e){var t=/(youtube\.com\/(watch\?v\=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/.exec(e);return t&&t.length==4?t[3]:null}function i(e){return"//www.youtube.com/embed/"+e+"?wmode=opaque&rel=0"}this.checkVideoUrl=function(t,s){var o=new e,u=r(t);return u?s?n(u).then(function(e){e?o.resolve({title:e.title,description:e.description,user:e.channelTitle,thumbUrl:e.thumbnails["default"].url,embedUrl:i(u),viewCount:null,likeCount:null}):o.reject()},function(e){e&&e.status==403?o.reject("NOT_AUTHORIZED"):o.reject("NOT_FOUND")}):o.resolve({title:"",description:"",user:"",thumbUrl:"",embedUrl:i(u),viewCount:null,likeCount:null,fetchVideoSnippet:!1}):o.reject("INVALID_URL"),o}}}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewVideoCommonDetail",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="video-detail">\r\n	',typeof fetchVideoSnippet=="undefined"||fetchVideoSnippet?__p+='\r\n		<table>\r\n			<tr>\r\n				<td><img src="'+((__t=thumbUrl)==null?"":__t)+'" /></td>\r\n				<td style="padding-left: 10px">\r\n					<strong>\r\n						'+((__t=title)==null?"":__t)+'\r\n					</strong>\r\n					<div style="max-height: 100px; overflow-y: auto; word-wrap: break-word; word-break: break-word;">\r\n						'+((__t=description)==null?"":__t)+"\r\n					</div>\r\n				</td>\r\n			</tr>\r\n		</table>\r\n	":__p+='\r\n		<div style="font-style: italic; margin: 15px 0 25px 0;">'+((__t=videoNotChecked)==null?"":__t)+"</div>\r\n	",__p+='\r\n	<div style="text-align: center; margin-top: 10px;">\r\n		<button class="btn btn-primary btn-select-video">'+((__t=btnSelect)==null?"":__t)+"</button>\r\n	</div>\r\n</div>";return __p}}),define("storymaps/common/builder/media/video/ViewYoutube",["lib-build/tpl!./ViewVideoCommon","lib-build/css!./ViewVideoCommon","storymaps/common/utils/connector/Youtube","lib-build/tpl!./ViewVideoCommonDetail"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".url").val(),t=!app.isPortal||!app.cfg.YOUTUBE_DISABLE_ON_PORTAL;a(),o.checkVideoUrl(e,t).then(function(e){i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>'),i.find(".video-detail-container").fadeIn().html(r({fetchVideoSnippet:t,thumbUrl:e.thumbUrl,title:e.title,description:e.description,btnSelect:i18n.commonMedia.videoSelectorCommon.select,videoNotChecked:i18n.commonMedia.videoSelectorYoutube.videoNotChecked})),i.find(".btn-select-video").click(function(){s("configure",{mode:"add",fromService:!0,media:{name:e.title||"",description:e.description||"",pic_url:e.embedUrl,thumb_url:e.thumbUrl,lat:"",lng:"",is_video:!0}})})},function(e){i.find(".loadingMsg").html(""),e=="NOT_AUTHORIZED"?i.find(".errorMsg").show().html(i18n.commonMedia.videoSelectorYoutube.checkFailedAPI):i.find(".errorMsg").show().html(i18n.commonMedia.videoSelectorCommon.notFound)})}function a(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide(),i.find(".btn-check").attr("disabled","disabled")}function f(){i.find(".btn-check").click(u),i.find(".url").bind("input propertychange",function(){$(this).val()?i.find(".btn-check").removeAttr("disabled"):i.find(".btn-check").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".video-detail-container").fadeOut().empty()}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n;i.append(e({serviceId:"youtube",fieldUrl:i18n.commonMedia.videoSelectorYoutube.url+"...",btnCheck:i18n.commonMedia.videoSelectorCommon.check})),f(),this.present=function(e){if(!e||!e.isReturning)i.find(".url").val()||i.find(".btn-check").attr("disabled","disabled");i.show(),i.find(".videoSelectorView").width()&&i.find(".url").css("width",i.find(".videoSelectorView").width()-85-40-i.find(".btn-check").outerWidth()).focus()}}}),define("storymaps/common/utils/connector/Vimeo",["dojo/Deferred"],function(e){return function(){function n(t){var n=new e,r="//vimeo.com/api/v2/video/"+t+".json";return $.ajax({type:"GET",url:r,jsonp:"callback",dataType:"jsonp",timeout:4e3}).then(function(e){e&&e[0]?n.resolve(e[0]):n.reject()},function(){n.reject()}),n}function r(e){return"//player.vimeo.com/video/"+e}this.checkVideoUrl=function(t){var i=new e,s=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/.exec(t);if(s&&s.length==6){var o=s[5];n(o).then(function(e){e?i.resolve({title:e.title,description:e.description,user:e.user_name,thumbUrl:e.thumbnail_small,embedUrl:r(o),viewCount:e.stats_number_of_plays,likeCount:e.stats_number_of_likes}):i.reject()},function(){i.reject("NOT_FOUND")})}else i.reject("INVALID_URL");return i}}}),define("storymaps/common/builder/media/video/ViewVimeo",["lib-build/tpl!./ViewVideoCommon","lib-build/css!./ViewVideoCommon","storymaps/common/utils/connector/Vimeo","lib-build/tpl!./ViewVideoCommonDetail"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".url").val();a(),o.checkVideoUrl(e).then(function(e){i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>'),i.find(".video-detail-container").fadeIn().html(r({thumbUrl:e.thumbUrl,title:e.title,description:e.description,btnSelect:i18n.commonMedia.videoSelectorCommon.select})),i.find(".btn-select-video").click(function(){s("configure",{mode:"add",fromService:!0,media:{name:e.title||"",description:e.description||"",pic_url:e.embedUrl,thumb_url:e.thumbUrl,lat:"",lng:"",is_video:!0}})})},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.videoSelectorCommon.notFound)})}function a(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide(),i.find(".btn-check").attr("disabled","disabled")}function f(){i.find(".btn-check").click(u),i.find(".url").bind("input propertychange",function(){$(this).val()?i.find(".btn-check").removeAttr("disabled"):i.find(".btn-check").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".video-detail-container").fadeOut().empty()}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n;i.append(e({serviceId:"vimeo",fieldUrl:i18n.commonMedia.videoSelectorVimeo.url+"...",btnCheck:i18n.commonMedia.videoSelectorCommon.check})),f(),this.present=function(e){if(!e||!e.isReturning)i.find(".url").val()||i.find(".btn-check").attr("disabled","disabled");i.show(),i.find(".videoSelectorView").width()&&i.find(".url").css("width",i.find(".videoSelectorView").width()-85-40-i.find(".btn-check").outerWidth()).focus()}}}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewOther",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelectorOther">\r\n	<div class="explain">'+((__t=explain)==null?"":__t)+"</div>\r\n</div>";return __p}}),define("lib-build/css!storymaps/common/builder/media/video/ViewOther",[],function(){}),define("storymaps/common/builder/media/video/ViewOther",["lib-build/tpl!./ViewOther","lib-build/css!./ViewOther"],function(e){return function(n){function r(){}n.append(e({explain:i18n.commonMedia.videoSelectorOther.explain1+" "+i18n.commonMedia.videoSelectorOther.explain2.replace("%WEBPAGE%","<strong>"+i18n.commonMedia.videoSelectorOther.webpage+"</strong>")+'<div style="width: 100%; text-align: center; margin: 5px 0 15px 0"><div class="media-video-help-embed-dailymotion"></div></div>'+i18n.commonMedia.videoSelectorOther.explain3.replace("%WEBPAGE%","<strong>"+i18n.commonMedia.videoSelectorOther.webpage+"</strong>").replace("%EXAMPLE%",'<a href="http://www.videojs.com/">Video.js</a>')})),r(),this.present=function(){n.show()}}}),define("storymaps/common/builder/media/video/Selector",["lib-build/tpl!./Selector","lib-build/css!./Selector","./ViewHome","./ViewYoutube","./ViewVimeo","./ViewOther","../ViewConfigure"],function(e,t,n,r,i,s,o){return function(u,a,f,l){function g(e,t,n){if(!m[e])return;e=="home"?v=!1:e!="configure"&&(d=e),n||p.push({name:c,params:h}),c=e,h=t,l.toggle(c!="home"),e!="home"&&l.off("click").click(function(){var e=p.pop()||{name:"home"};g(e.name||"home",e.params,!0)}),u.find(".selectorView").hide(),m[e].present(t),f&&f()}function y(){}u.append(e({}));var c=null,h=null,p=null,d=null,v=!1,m={home:new n(u.find(".viewHomeContainer"),g),youtube:new r(u.find(".viewYoutubeContainer"),g),vimeo:new i(u.find(".viewVimeoContainer"),g),other:new s(u.find(".viewOtherContainer"),g),configure:new o(u.find(".mediaSelectorConfigureContainer"),a.configure,g)};y(),this.present=function(e){p=[],c=null,h=null,e.mode=="edit"&&e.media&&e.media.type=="video"?g("configure",{mode:e.mode,media:e.media}):e.keepLastDataSource&&v&&d!=null?g(d,{isReturning:!0}):g("home")},this.checkError=function(){var e=!1;return c=="configure"?e=m[c].checkError():e=!0,u.toggleClass("error",e),v=!e,e},this.getData=function(){return c=="configure"?m[c].getData():null},this.activate=function(){l.toggle(c!="home"),c!="home"&&l.off("click").click(function(){var e=p.pop()||{name:"home"};g(e.name||"home",e.params,!0)})},this.deactivate=function(){l.hide().off("click")}}}),define("lib-build/tpl!storymaps/common/builder/media/webpage/Selector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelector">\r\n	<div class="selectorView viewHomeContainer"></div>\r\n	<div class="selectorView mediaSelectorConfigureContainer"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/webpage/Selector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/webpage/ViewHome",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="webpageSelectorHome">	\r\n	<div class="form-group">\r\n		<label>'+((__t=lblUrl)==null?"":__t)+'</label>\r\n		<input type="text" class="form-control url" placeholder="'+((__t=phURL)==null?"":__t)+'"/>\r\n		<button class="btn btn-primary btn-cfg btn-cfg-url">'+((__t=btnConfigure)==null?"":__t)+'</button>\r\n	</div>\r\n	\r\n	<div class="separator">\r\n		<span class="solidline"></span>\r\n		'+((__t=lblOR)==null?"":__t)+'\r\n		<span class="solidline"></span>\r\n	</div>\r\n	\r\n	<div class="form-group">\r\n		<label>'+((__t=lblEmbed)==null?"":__t)+'</label>\r\n		<textarea class="form-control textarea" placeholder="'+((__t=phEmbed)==null?"":__t)+'"></textarea>\r\n		<button class="btn btn-primary btn-cfg btn-cfg-embed">'+((__t=btnConfigure)==null?"":__t)+'</button>\r\n	</div>\r\n	\r\n	<div class="error"></div>\r\n</div>';return __p}}),define("lib-build/css!storymaps/common/builder/media/webpage/ViewHome",[],function(){}),define("storymaps/common/builder/media/webpage/ViewHome",["lib-build/tpl!./ViewHome","lib-build/css!./ViewHome","storymaps/common/utils/CommonHelper"],function(e,t,n){return function(r,i){function s(){var e=o(),t=u();return r.find(".error").toggle(e&&t).html(i18n.commonMedia.webpageSelectorHome.lblError1),e&&t||!e&&!t}function o(){var e=r.find(".url").val();return!!e}function u(){var e=r.find(".textarea").val();return!!e}function a(){if(s())return null;var e=r.find(".url").val(),t=r.find(".textarea").val();if(e)e=n.convertURLHTTPS(e);else{var i=$(t.trim());i.attr("src",n.convertURLHTTPS(i.attr("src"))),t=i.prop("outerHTML").replace(/ xmlns="[^"]*"/,"")}return{url:e,frameTag:t}}function f(){r.find(".btn-cfg-url").attr("disabled",!o()||u()),r.find(".btn-cfg-embed").attr("disabled",!u()||o()),s()}function l(){r.find(".url").bind("input propertychange",f),r.find(".textarea").bind("input propertychange",f),r.find(".btn-cfg-url").click(function(){i("configure",{media:{type:"webpage",webpage:a()}})}),r.find(".btn-cfg-embed").click(function(){var e=r.find(".textarea").val().trim();if(!e.match(/^<iframe.*<\/iframe>$/)||e.match(/<iframe/g).length>2){r.find(".error").show().html(i18n.commonMedia.webpageSelectorHome.lblError2.replace("%IFRAMETAG%",'"&lt;iframe&gt;"'));return}i("configure",{media:{type:"webpage",webpage:a()}})})}r.append(e({lblUrl:i18n.commonMedia.webpageSelectorHome.lblUrl,lblEmbed:i18n.commonMedia.webpageSelectorHome.lblEmbed,phURL:"http://www.esri.com",phEmbed:"<iframe width=&quot;100%&quot; height=&quot;600px&quot; src=&quot;http://...&quot;></iframe>",lblOR:i18n.commonMedia.webpageSelectorHome.lblOR,btnConfigure:i18n.commonMedia.webpageSelectorHome.configure})),l(),this.present=function(e){r.show(),e&&e.mode=="edit"&&e.media&&e.media.type=="webpage"?(r.find(".url").val(e.media.webpage.url||""),r.find(".textarea").val(e.media.webpage.frameTag||"")):(r.find(".url").val(""),r.find(".textarea").val("")),f(),this.postDisplay()},this.postDisplay=function(){r.find(".webpageSelectorHome").width()&&r.find(".url, .textarea").css("width",r.find(".webpageSelectorHome").width()-5-r.find(".btn-cfg").outerWidth()),r.find(r.find(".textarea").val()?".textarea":".url").focus()}}}),define("storymaps/common/builder/media/webpage/Selector",["lib-build/tpl!./Selector","lib-build/css!./Selector","./ViewHome","../ViewConfigure"],function(e,t,n,r){return function(i,s,o,u){function d(e,t,n){if(!p[e])return;e=="home"?h=!1:e!="configure"&&(c=e),n||l.push({name:a,params:f}),a=e,f=t,u.toggle(a!="home"),e!="home"&&u.off("click").click(function(){var e=l.pop()||{name:"home"};d(e.name||"home",e.params,!0)}),i.find(".selectorView").hide(),p[e].present(t),o&&o()}function v(){}i.append(e({}));var a=null,f=null,l=null,c=null,h=!1,p={home:new n(i.find(".viewHomeContainer"),d),configure:new r(i.find(".mediaSelectorConfigureContainer"),s.configure,d)};v(),this.present=function(e){l=[],a=null,f=null,e.mode=="edit"&&e.media&&e.media.type=="webpage"?(d("home",{mode:e.mode,media:e.media}),d("configure",{mode:e.mode,media:e.media})):e.keepLastDataSource&&h&&c!=null?d(c,{isReturning:!0}):d("home")},this.checkError=function(){var e=!1;return a=="configure"?e=p[a].checkError():e=!0,i.toggleClass("error",e),h=!e,e},this.getData=function(){return a=="configure"?p[a].getData():null},this.activate=function(){u.toggle(a!="home"),a!="home"?u.off("click").click(function(){var e=l.pop()||{name:"home"};d(e.name||"home",e.params,!0)}):p[a].postDisplay()},this.deactivate=function(){u.hide().off("click")}}}),define("storymaps/common/builder/media/MediaSelector",["lib-build/tpl!./MediaSelector","lib-build/css!./MediaSelector","./map/WebMapSelector","./image/Selector","./video/Selector","./webpage/Selector"],function(e,t,n,r,i,s){return function(o,u,a,f,l){function b(){o.find(".media-type").eq(d?0:1).click().focus().click()}function w(e){var t=$.inArray(e.media.type,["webmap","image","video","frame"]);o.find(".media-type").eq(t).click().focus().click()}function E(){o.find(".media-type").click(function(){p=h[$(this).parents(".media-type-wrapper").index()],o.find(".media-type-wrapper").removeClass("current"),$(this).parents(".media-type-wrapper").addClass("current"),o.find(".mainMediaTypeContainer").hide().removeClass("current").eq($(this).parents(".media-type-wrapper").index()).addClass("current").show(),c.activate(),f&&f(p)})}o.append(e({hasMap:!!u,lblMap:i18n.commonMedia.mediaSelector.lblMap,lblImage:i18n.commonMedia.mediaSelector.lblImage,lblVideo:i18n.commonMedia.mediaSelector.lblVideo,lblExternal:i18n.commonMedia.mediaSelector.lblExternal,lblSelect:a?i18n.commonMedia.mediaSelector.lblSelect1:i18n.commonMedia.mediaSelector.lblSelect2,notImplemented:i18n.commonMedia.mediaSelector.notImplemented,hasVideo:!app.appCfg.mediaPickerDisableVideo,hasWebPage:!app.appCfg.mediaPickerDisableWebPage}));var c=this,h=["webmap","image","video","webpage"],p=null,d=null,v=null,m=new r(o.find(".imageMediaContainer"),{configure:{mode:u?"mainMedia":"inlineText"}},f,l),g=new i(o.find(".videoMediaContainer"),{configure:{mode:u?"mainMedia":"inlineText"}},f,l),y=new s(o.find(".webpageMediaContainer"),{configure:{mode:u?"mainMedia":"inlineText"}},f,l);u&&(d=new n(o.find(".mapMediaContainer"),u.onOpenConfigure,u.onCloseConfigure,f)),o.find(".mediaSelector").toggleClass("smallSize",a),E(),this.present=function(e){d&&(d.present(e),d.activate()),m.present(e),g.present(e),y.present(e),v=e.mode,o.find(".lblSelect, .media-types").toggle(!!(u||!app.appCfg.mediaPickerDisableVideo||!app.appCfg.mediaPickerDisableWebPage)),e.mode=="add"||e.mode=="import"?b(e):w(e)},this.getData=function(){var e=o.find(".mainMediaTypeContainer.current").index();return e===0?{media:{type:"webmap",webmap:d.getData()}}:e==1&&v=="import"?m.getData():e==1?{media:{type:"image",image:m.getData()}}:e==2?{media:{type:"video",video:g.getData()}}:e==3?{media:{type:"webpage",webpage:y.getData()}}:{}},this.checkError=function(e){var t=o.find(".mainMediaTypeContainer.current").index();return t===0?d.checkError():t==1?m.checkError(e):t==2?g.checkError():t==3?y.checkError():!0},this.activate=function(){m.deactivate(),g.deactivate(),y.deactivate(),p=="webmap"&&(d.activate(),setTimeout(d.activate,0)),p=="image"?m.activate():p=="video"?g.activate():p=="webpage"&&y.activate()},this.postDisplay=function(){d.postDisplay()}}}),define("storymaps/tpl/builder/media/Popup",["lib-build/tpl!./Popup","lib-build/css!./Popup","storymaps/common/builder/media/MediaSelector","dojo/Deferred"],function(e,t,n,r){return function(i){function f(){var e,t=a.getData();e=!1,t&&t.media&&t.media.image?e=!0:t&&t.length&&(e=!0),i.find(".btnSubmit").attr("disabled",!e),e&&u=="add"&&l()}function l(){var e=a.checkError(i.find(".btnSubmit")),t=function(){var e=a.getData();u=="import"?o.resolve(e):o.resolve(e.media[e.media.type]),i.modal("toggle")};e instanceof r?e.then(function(e){e||t()}):e||t()}function c(){i.find(".btnSubmit").click(l)}i.append(e({lblTitle:"",btnCancel:i18n.commonCore.common.cancel,btnBack:i18n.commonCore.common.back}));var s=null,o=null,u=null,a=new n(i.find(".viewMediaSelectorContainer"),null,!0,f,i.find(".btn-back"));c(),this.present=function(e,t){return s=e,o=new r,u=s.mode,u=="import"?(i.find(".modal-title").text("Import images"),i.find(".btnSubmit").html("Import").show(),i.find(".btnCancel").show()):u=="add"&&(i.find(".modal-title").text("Insert an image"),i.find(".btnSubmit").html("Add").hide(),i.find(".btnCancel").hide(),i.find(".opt-select-all-container").hide()),a.present({mode:e.mode,webmaps:null,media:e.mode=="edit"?e.edit.media:null,keepLastDataSource:!0},function(){}),i.find(".modal-content").css("min-height",t),i.modal({keyboard:!0}),o},this.initLocalization=function(){}}}),define("lib-build/tpl!storymaps/tpl/builder/addedit/Popup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="backdrop"></div>\r\n<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">EDIT TAB</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<!-- Title field -->\r\n			<div class="form-group titleContainer">\r\n				<input type="text" class="form-control title clear" placeholder="" spellcheck="true"/>\r\n				<span class="glyphicon glyphicon-remove form-control-feedback"></span>\r\n			</div>\r\n\r\n			<div class="tab-pane viewMediaSelectorContainer">\r\n				<table class="tab-cfg">\r\n					<tr class="tab-cfg-row ">\r\n						<td class="tab-cfg-title" style="outline: none;">\r\n							Theme Color\r\n						</td>\r\n						<td class="tab-cfg-btns">\r\n							<div class="color-control">\r\n								<input type="text" id="colorpicker" />\r\n							</div>\r\n						</td>\r\n					</tr>\r\n					<tr class="tab-cfg-row tab-cfg-location">\r\n						<td class="tab-cfg-title" style="outline: none;">\r\n							Location\r\n						</td>\r\n						<td class="tab-cfg-btns">\r\n							<div class="regular-control" style="display: block;">\r\n								<span class="btn-group">\r\n									<button type="button" class="btn btn-default btn-xs btn-primary" data-value="default" style="">\r\n										Auto\r\n									</button>\r\n									<button type="button" class="btn btn-default btn-xs" data-value="custom" data-toggle="tooltip" title="Lets you display a specific map location when this tab is selected">\r\n										Custom configuration&nbsp;\r\n									</button>\r\n								</span>\r\n							</div>\r\n						</td>\r\n					</tr>\r\n				</table>\r\n			</div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<span class="modal-footer-left"><button class="btn btn-back btn-naked">< '+((__t=btnBack)==null?"":__t)+'</button></span>\r\n			<span class="btnSubmitWrapper" data-toggle="tooltip"">\r\n				<button class="btnSubmit btn btn-primary" ></button>\r\n			</span>\r\n			<button class="btnCancel btn btn-naked btn-close">'+((__t=btnCancel)==null?"":__t)+'</button>\r\n			<div class="btnSubmitTooltipContainer"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/addedit/Popup",[],function(){}),define("lib-build/css!storymaps/tpl/builder/addedit/ColorPickerStyle",[],function(){}),define("lib-build/css!lib-app/spectrum/spectrum",[],function(){}),function(e){"use strict";typeof define=="function"&&define.amd?define("lib-app/spectrum/spectrum",["jquery"],e):typeof exports=="object"&&typeof module=="object"?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){"use strict";function a(t,n,r,i){var o=[];for(var u=0;u<t.length;u++){var a=t[u];if(a){var f=tinycolor(a),l=f.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";l+=tinycolor.equals(n,a)?" sp-thumb-active":"";var c=f.toString(i.preferredFormat||"rgb"),h=s?"background-color:"+f.toRgbString():"filter:"+f.toFilter();o.push('<span title="'+c+'" data-color="'+f.toRgbString()+'" class="'+l+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}else{var p="sp-clear-display";o.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+p+'"></span>').attr("title",i.noColorSelectedText)).html())}}return"<div class='sp-cf "+r+"'>"+o.join("")+"</div>"}function f(){for(var e=0;e<r.length;e++)r[e]&&r[e].hide()}function l(t,r){var i=e.extend({},n,t);return i.callbacks={move:v(i.move,r),change:v(i.change,r),show:v(i.show,r),hide:v(i.hide,r),beforeShow:v(i.beforeShow,r)},i}function c(n,c){function Tt(){p.showPaletteOnly&&(p.showPalette=!0),ct.text(p.showPaletteOnly?p.togglePaletteMoreText:p.togglePaletteLessText);if(p.palette){F=p.palette.slice(0),I=e.isArray(F[0])?F:[F],q={};for(var t=0;t<I.length;t++)for(var n=0;n<I[t].length;n++){var r=tinycolor(I[t][n]).toRgbString();q[r]=!0}}Q.toggleClass("sp-flat",v),Q.toggleClass("sp-input-disabled",!p.showInput),Q.toggleClass("sp-alpha-enabled",p.showAlpha),Q.toggleClass("sp-clear-enabled",xt),Q.toggleClass("sp-buttons-disabled",!p.showButtons),Q.toggleClass("sp-palette-buttons-disabled",!p.togglePaletteOnly),Q.toggleClass("sp-palette-disabled",!p.showPalette),Q.toggleClass("sp-palette-only",p.showPaletteOnly),Q.toggleClass("sp-initial-disabled",!p.showInitial),Q.addClass(p.className).addClass(p.containerClassName),$t()}function Nt(){function n(t){return t.data&&t.data.ignore?(qt(e(t.target).closest(".sp-thumb-el").data("color")),zt()):(qt(e(t.target).closest(".sp-thumb-el").data("color")),zt(),Vt(!0),p.hideAfterPaletteSelect&&Ft()),!1}i&&Q.find("*:not(input)").attr("unselectable","on"),Tt(),dt&&J.after(vt).hide(),xt||ft.hide();if(v)J.after(Q).hide();else{var t=p.appendTo==="parent"?J.parent():e(p.appendTo);t.length!==1&&(t=e("body")),t.append(Q)}Ct(),mt.bind("click.spectrum touchstart.spectrum",function(t){K||Pt(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(J.is(":disabled")||p.disabled===!0)&&Gt(),Q.click(d),st.change(Dt),st.bind("paste",function(){setTimeout(Dt,1)}),st.keydown(function(e){e.keyCode==13&&Dt()}),at.text(p.cancelText),at.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),It(),Ft()}),ft.attr("title",p.clearText),ft.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),St=!0,zt(),v&&Vt(!0)}),lt.text(p.chooseText),lt.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),i&&st.is(":focus")&&st.trigger("change"),Ut()&&(Vt(!0),Ft())}),ct.text(p.showPaletteOnly?p.togglePaletteMoreText:p.togglePaletteLessText),ct.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),p.showPaletteOnly=!p.showPaletteOnly,!p.showPaletteOnly&&!v&&Q.css("left","-="+(G.outerWidth(!0)+5)),Tt()}),m(rt,function(e,t,n){j=e/M,St=!1,n.shiftKey&&(j=Math.round(j*10)/10),zt()},Mt,_t),m(et,function(e,t){P=parseFloat(t/A),St=!1,p.showAlpha||(j=1),zt()},Mt,_t),m(Y,function(e,t,n){if(!n.shiftKey)W=null;else if(!W){var r=H*C,i=k-B*k,s=Math.abs(e-r)>Math.abs(t-i);W=s?"x":"y"}var o=!W||W==="x",u=!W||W==="y";o&&(H=parseFloat(e/C)),u&&(B=parseFloat((k-t)/k)),St=!1,p.showAlpha||(j=1),zt()},Mt,_t),yt?(qt(yt),Wt(),wt=p.preferredFormat||tinycolor(yt).format,kt(yt)):Wt(),v&&Ht();var r=i?"mousedown.spectrum":"click.spectrum touchstart.spectrum";ot.delegate(".sp-thumb-el",r,n),ut.delegate(".sp-thumb-el:nth-child(1)",r,{ignore:!0},n)}function Ct(){if(w&&window.localStorage){try{var t=window.localStorage[w].split(",#");t.length>1&&(delete window.localStorage[w],e.each(t,function(e,t){kt(t)}))}catch(n){}try{R=window.localStorage[w].split(";")}catch(n){}}}function kt(t){if(b){var n=tinycolor(t).toRgbString();if(!q[n]&&e.inArray(n,R)===-1){R.push(n);while(R.length>U)R.shift()}if(w&&window.localStorage)try{window.localStorage[w]=R.join(";")}catch(r){}}}function Lt(){var e=[];if(p.showPalette)for(var t=0;t<R.length;t++){var n=tinycolor(R[t]).toRgbString();q[n]||e.push(R[t])}return e.reverse().slice(0,p.maxSelectionSize)}function At(){var t=Rt(),n=e.map(I,function(e,n){return a(e,t,"sp-palette-row sp-palette-row-"+n,p)});Ct(),R&&n.push(a(Lt(),t,"sp-palette-row sp-palette-row-selection",p)),ot.html(n.join(""))}function Ot(){if(p.showInitial){var e=bt,t=Rt();ut.html(a([e,t],t,"sp-palette-row-initial",p))}}function Mt(){(k<=0||C<=0||A<=0)&&$t(),N=!0,Q.addClass(z),W=null,J.trigger("dragstart.spectrum",[Rt()])}function _t(){N=!1,Q.removeClass(z),J.trigger("dragstop.spectrum",[Rt()])}function Dt(){var e=st.val();if(e!==null&&e!==""||!xt){var t=tinycolor(e);t.isValid()?(qt(t),Vt(!0)):st.addClass("sp-validation-error")}else qt(null),Vt(!0)}function Pt(){T?Ft():Ht()}function Ht(){var t=e.Event("beforeShow.spectrum");if(T){$t();return}J.trigger(t,[Rt()]);if(S.beforeShow(Rt())===!1||t.isDefaultPrevented())return;f(),T=!0,e(X).bind("keydown.spectrum",Bt),e(X).bind("click.spectrum",jt),e(window).bind("resize.spectrum",x),vt.addClass("sp-active"),Q.removeClass("sp-hidden"),$t(),Wt(),bt=Rt(),Ot(),S.show(bt),J.trigger("show.spectrum",[bt])}function Bt(e){e.keyCode===27&&Ft()}function jt(e){if(e.button==2)return;if(N)return;Et?Vt(!0):It(),Ft()}function Ft(){if(!T||v)return;T=!1,e(X).unbind("keydown.spectrum",Bt),e(X).unbind("click.spectrum",jt),e(window).unbind("resize.spectrum",x),vt.removeClass("sp-active"),Q.addClass("sp-hidden"),S.hide(Rt()),J.trigger("hide.spectrum",[Rt()])}function It(){qt(bt,!0)}function qt(e,t){if(tinycolor.equals(e,Rt())){Wt();return}var n,r;!e&&xt?St=!0:(St=!1,n=tinycolor(e),r=n.toHsv(),P=r.h%360/360,H=r.s,B=r.v,j=r.a),Wt(),n&&n.isValid()&&!t&&(wt=p.preferredFormat||n.getFormat())}function Rt(e){return e=e||{},xt&&St?null:tinycolor.fromRatio({h:P,s:H,v:B,a:Math.round(j*100)/100},{format:e.format||wt})}function Ut(){return!st.hasClass("sp-validation-error")}function zt(){Wt(),S.move(Rt()),J.trigger("move.spectrum",[Rt()])}function Wt(){st.removeClass("sp-validation-error"),Xt();var e=tinycolor.fromRatio({h:P,s:1,v:1});Y.css("background-color",e.toHexString());var t=wt;j<1&&(j!==0||t!=="name")&&(t==="hex"||t==="hex3"||t==="hex6"||t==="name")&&(t="rgb");var n=Rt({format:t}),r="";gt.removeClass("sp-clear-display"),gt.css("background-color","transparent");if(!n&&xt)gt.addClass("sp-clear-display");else{var o=n.toHexString(),u=n.toRgbString();s||n.alpha===1?gt.css("background-color",u):(gt.css("background-color","transparent"),gt.css("filter",n.toFilter()));if(p.showAlpha){var a=n.toRgb();a.a=0;var f=tinycolor(a).toRgbString(),l="linear-gradient(left, "+f+", "+o+")";i?nt.css("filter",tinycolor(f).toFilter({gradientType:1},o)):(nt.css("background","-webkit-"+l),nt.css("background","-moz-"+l),nt.css("background","-ms-"+l),nt.css("background","linear-gradient(to right, "+f+", "+o+")"))}r=n.toString(t)}p.showInput&&st.val(r),p.showPalette&&At(),Ot()}function Xt(){var e=H,t=B;if(xt&&St)it.hide(),tt.hide(),Z.hide();else{it.show(),tt.show(),Z.show();var n=e*C,r=k-t*k;n=Math.max(-L,Math.min(C-L,n-L)),r=Math.max(-L,Math.min(k-L,r-L)),Z.css({top:r+"px",left:n+"px"});var i=j*M;it.css({left:i-_/2+"px"});var s=P*A;tt.css({top:s-D+"px"})}}function Vt(e){var t=Rt(),n="",r=!tinycolor.equals(t,bt);t&&(n=t.toString(wt),kt(t)),ht&&J.val(n),e&&r&&(S.change(t),J.trigger("change",[t]))}function $t(){if(!T)return;C=Y.width(),k=Y.height(),L=Z.height(),O=et.width(),A=et.height(),D=tt.height(),M=rt.width(),_=it.width(),v||(Q.css("position","absolute"),p.offset?Q.offset(p.offset):Q.offset(h(Q,mt))),Xt(),p.showPalette&&At(),J.trigger("reflow.spectrum")}function Jt(){J.show(),mt.unbind("click.spectrum touchstart.spectrum"),Q.remove(),vt.remove(),r[Zt.id]=null}function Kt(n,r){if(n===t)return e.extend({},p);if(r===t)return p[n];p[n]=r,n==="preferredFormat"&&(wt=p.preferredFormat),Tt()}function Qt(){K=!1,J.attr("disabled",!1),mt.removeClass("sp-disabled")}function Gt(){Ft(),K=!0,J.attr("disabled",!0),mt.addClass("sp-disabled")}function Yt(e){p.offset=e,$t()}var p=l(c,n),v=p.flat,b=p.showSelectionPalette,w=p.localStorageKey,E=p.theme,S=p.callbacks,x=g($t,10),T=!1,N=!1,C=0,k=0,L=0,A=0,O=0,M=0,_=0,D=0,P=0,H=0,B=0,j=1,F=[],I=[],q={},R=p.selectionPalette.slice(0),U=p.maxSelectionSize,z="sp-dragging",W=null,X=n.ownerDocument,V=X.body,J=e(n),K=!1,Q=e(u,X).addClass(E),G=Q.find(".sp-picker-container"),Y=Q.find(".sp-color"),Z=Q.find(".sp-dragger"),et=Q.find(".sp-hue"),tt=Q.find(".sp-slider"),nt=Q.find(".sp-alpha-inner"),rt=Q.find(".sp-alpha"),it=Q.find(".sp-alpha-handle"),st=Q.find(".sp-input"),ot=Q.find(".sp-palette"),ut=Q.find(".sp-initial"),at=Q.find(".sp-cancel"),ft=Q.find(".sp-clear"),lt=Q.find(".sp-choose"),ct=Q.find(".sp-palette-toggle"),ht=J.is("input"),pt=ht&&J.attr("type")==="color"&&y(),dt=ht&&!v,vt=dt?e(o).addClass(E).addClass(p.className).addClass(p.replacerClassName):e([]),mt=dt?vt:J,gt=vt.find(".sp-preview-inner"),yt=p.color||ht&&J.val(),bt=!1,wt=p.preferredFormat,Et=!p.showButtons||p.clickoutFiresChange,St=!yt,xt=p.allowEmpty&&!pt;Nt();var Zt={show:Ht,hide:Ft,toggle:Pt,reflow:$t,option:Kt,enable:Qt,disable:Gt,offset:Yt,set:function(e){qt(e),Vt()},get:Rt,destroy:Jt,container:Q};return Zt.id=r.push(Zt)-1,Zt}function h(t,n){var r=0,i=t.outerWidth(),s=t.outerHeight(),o=n.outerHeight(),u=t[0].ownerDocument,a=u.documentElement,f=a.clientWidth+e(u).scrollLeft(),l=a.clientHeight+e(u).scrollTop(),c=n.offset();return c.top+=o,c.left-=Math.min(c.left,c.left+i>f&&f>i?Math.abs(c.left+i-f):0),c.top-=Math.min(c.top,c.top+s>l&&l>s?Math.abs(s+o-r):r),c}function p(){}function d(e){e.stopPropagation()}function v(e,t){var n=Array.prototype.slice,r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}function m(t,n,r,s){function p(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function d(e){if(u){if(i&&o.documentMode<9&&!e.button)return m();var r=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],s=r&&r.pageX||e.pageX,h=r&&r.pageY||e.pageY,d=Math.max(0,Math.min(s-a.left,l)),v=Math.max(0,Math.min(h-a.top,f));c&&p(e),n.apply(t,[d,v,e])}}function v(n){var i=n.which?n.which==3:n.button==2;!i&&!u&&r.apply(t,arguments)!==!1&&(u=!0,f=e(t).height(),l=e(t).width(),a=e(t).offset(),e(o).bind(h),e(o.body).addClass("sp-dragging"),d(n),p(n))}function m(){u&&(e(o).unbind(h),e(o.body).removeClass("sp-dragging"),setTimeout(function(){s.apply(t,arguments)},0)),u=!1}n=n||function(){},r=r||function(){},s=s||function(){};var o=document,u=!1,a={},f=0,l=0,c="ontouchstart"in window,h={};h.selectstart=p,h.dragstart=p,h["touchmove mousemove"]=d,h["touchend mouseup"]=m,e(t).bind("touchstart mousedown",v)}function g(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,e.apply(i,s)};n&&clearTimeout(r);if(n||!r)r=setTimeout(o,t)}}function y(){return e.fn.spectrum.inputTypeColorSupport()}var n={beforeShow:p,move:p,change:p,show:p,hide:p,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},r=[],i=!!/msie/i.exec(window.navigator.userAgent),s=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),n=t.style;return n.cssText="background-color:rgba(0,0,0,.5)",e(n.backgroundColor,"rgba")||e(n.backgroundColor,"hsla")}(),o=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),u=function(){var e="";if(i)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),b="spectrum.id";e.fn.spectrum=function(t,n){if(typeof t=="string"){var i=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=r[e(this).data(b)];if(n){var o=n[t];if(!o)throw new Error("Spectrum: no such method: '"+t+"'");t=="get"?i=n.get():t=="container"?i=n.container:t=="option"?i=n.option.apply(n,s):t=="destroy"?(n.destroy(),e(this).removeData(b)):o.apply(n,s)}}),i}return this.spectrum("destroy").each(function(){var n=e.extend({},t,e(this).data()),r=c(this,n);e(this).data(b,r.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=m,e.fn.spectrum.defaults=n,e.fn.spectrum.inputTypeColorSupport=function w(){if(typeof w._cachedResult=="undefined"){var t=e("<input type='color'/>")[0];w._cachedResult=t.type==="color"&&t.value!==""}return w._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var t=e("input[type=color]");t.length&&!y()&&t.spectrum({preferredFormat:"hex6"})},function(){function f(e){var t={r:0,g:0,b:0},n=1,r=!1,i=!1;return typeof e=="string"&&(e=W(e)),typeof e=="object"&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=l(e.r,e.g,e.b),r=!0,i=String(e.r).substr(-1)==="%"?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=q(e.s),e.v=q(e.v),t=d(e.h,e.s,e.v),r=!0,i="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=q(e.s),e.l=q(e.l),t=h(e.h,e.s,e.l),r=!0,i="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=D(n),{ok:r,format:e.format||i,r:s(255,o(t.r,0)),g:s(255,o(t.g,0)),b:s(255,o(t.b,0)),a:n}}function l(e,t,n){return{r:P(e,255)*255,g:P(t,255)*255,b:P(n,255)*255}}function c(e,t,n){e=P(e,255),t=P(t,255),n=P(n,255);var r=o(e,t,n),i=s(e,t,n),u,a,f=(r+i)/2;if(r==i)u=a=0;else{var l=r-i;a=f>.5?l/(2-r-i):l/(r+i);switch(r){case e:u=(t-n)/l+(t<n?6:0);break;case t:u=(n-e)/l+2;break;case n:u=(e-t)/l+4}u/=6}return{h:u,s:a,l:f}}function h(e,t,n){function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var r,i,s;e=P(e,360),t=P(t,100),n=P(n,100);if(t===0)r=i=s=n;else{var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:r*255,g:i*255,b:s*255}}function p(e,t,n){e=P(e,255),t=P(t,255),n=P(n,255);var r=o(e,t,n),i=s(e,t,n),u,a,f=r,l=r-i;a=r===0?0:l/r;if(r==i)u=0;else{switch(r){case e:u=(t-n)/l+(t<n?6:0);break;case t:u=(n-e)/l+2;break;case n:u=(e-t)/l+4}u/=6}return{h:u,s:a,v:f}}function d(e,t,n){e=P(e,360)*6,t=P(t,100),n=P(n,100);var i=r.floor(e),s=e-i,o=n*(1-t),u=n*(1-s*t),a=n*(1-(1-s)*t),f=i%6,l=[n,u,o,o,a,n][f],c=[a,n,n,u,o,o][f],h=[o,o,a,n,n,u][f];return{r:l*255,g:c*255,b:h*255}}function v(e,t,n,r){var s=[I(i(e).toString(16)),I(i(t).toString(16)),I(i(n).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function m(e,t,n,r){var s=[I(R(r)),I(i(e).toString(16)),I(i(t).toString(16)),I(i(n).toString(16))];return s.join("")}function g(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.s-=t/100,n.s=H(n.s),a(n)}function y(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.s+=t/100,n.s=H(n.s),a(n)}function b(e){return a(e).desaturate(100)}function w(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.l+=t/100,n.l=H(n.l),a(n)}function E(e,t){t=t===0?0:t||10;var n=a(e).toRgb();return n.r=o(0,s(255,n.r-i(255*-(t/100)))),n.g=o(0,s(255,n.g-i(255*-(t/100)))),n.b=o(0,s(255,n.b-i(255*-(t/100)))),a(n)}function S(e,t){t=t===0?0:t||10;var n=a(e).toHsl();return n.l-=t/100,n.l=H(n.l),a(n)}function x(e,t){var n=a(e).toHsl(),r=(i(n.h)+t)%360;return n.h=r<0?360+r:r,a(n)}function T(e){var t=a(e).toHsl();return t.h=(t.h+180)%360,a(t)}function N(e){var t=a(e).toHsl(),n=t.h;return[a(e),a({h:(n+120)%360,s:t.s,l:t.l}),a({h:(n+240)%360,s:t.s,l:t.l})]}function C(e){var t=a(e).toHsl(),n=t.h;return[a(e),a({h:(n+90)%360,s:t.s,l:t.l}),a({h:(n+180)%360,s:t.s,l:t.l}),a({h:(n+270)%360,s:t.s,l:t.l})]}function k(e){var t=a(e).toHsl(),n=t.h;return[a(e),a({h:(n+72)%360,s:t.s,l:t.l}),a({h:(n+216)%360,s:t.s,l:t.l})]}function L(e,t,n){t=t||6,n=n||30;var r=a(e).toHsl(),i=360/n,s=[a(e)];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,s.push(a(r));return s}function A(e,t){t=t||6;var n=a(e).toHsv(),r=n.h,i=n.s,s=n.v,o=[],u=1/t;while(t--)o.push(a({h:r,s:i,v:s})),s=(s+u)%1;return o}function _(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function D(e){e=parseFloat(e);if(isNaN(e)||e<0||e>1)e=1;return e}function P(e,t){j(e)&&(e="100%");var n=F(e);return e=s(t,o(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),r.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function H(e){return s(1,o(0,e))}function B(e){return parseInt(e,16)}function j(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function F(e){return typeof e=="string"&&e.indexOf("%")!=-1}function I(e){return e.length==1?"0"+e:""+e}function q(e){return e<=1&&(e=e*100+"%"),e}function R(e){return Math.round(parseFloat(e)*255).toString(16)}function U(e){return B(e)/255}function W(n){n=n.replace(e,"").replace(t,"").toLowerCase();var r=!1;if(O[n])n=O[n],r=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=z.rgb.exec(n))?{r:i[1],g:i[2],b:i[3]}:(i=z.rgba.exec(n))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=z.hsl.exec(n))?{h:i[1],s:i[2],l:i[3]}:(i=z.hsla.exec(n))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=z.hsv.exec(n))?{h:i[1],s:i[2],v:i[3]}:(i=z.hsva.exec(n))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=z.hex8.exec(n))?{a:U(i[1]),r:B(i[2]),g:B(i[3]),b:B(i[4]),format:r?"name":"hex8"}:(i=z.hex6.exec(n))?{r:B(i[1]),g:B(i[2]),b:B(i[3]),format:r?"name":"hex"}:(i=z.hex3.exec(n))?{r:B(i[1]+""+i[1]),g:B(i[2]+""+i[2]),b:B(i[3]+""+i[3]),format:r?"name":"hex"}:!1}var e=/^[\s,#]+/,t=/\s+$/,n=0,r=Math,i=r.round,s=r.min,o=r.max,u=r.random,a=function(e,t){e=e?e:"",t=t||{};if(e instanceof a)return e;if(!(this instanceof a))return new a(e,t);var r=f(e);this._originalInput=e,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=i(100*this._a)/100,this._format=t.format||r.format,this._gradientType=t.gradientType,this._r<1&&(this._r=i(this._r)),this._g<1&&(this._g=i(this._g)),this._b<1&&(this._b=i(this._b)),this._ok=r.ok,this._tc_id=n++};a.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},setAlpha:function(e){return this._a=D(e),this._roundA=i(100*this._a)/100,this},toHsv:function(){var e=p(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=p(this._r,this._g,this._b),t=i(e.h*360),n=i(e.s*100),r=i(e.v*100);return this._a==1?"hsv("+t+", "+n+"%, "+r+"%)":"hsva("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=c(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=c(this._r,this._g,this._b),t=i(e.h*360),n=i(e.s*100),r=i(e.l*100);return this._a==1?"hsl("+t+", "+n+"%, "+r+"%)":"hsla("+t+", "+n+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return v(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return m(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:i(this._r),g:i(this._g),b:i(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+i(this._r)+", "+i(this._g)+", "+i(this._b)+")":"rgba("+i(this._r)+", "+i(this._g)+", "+i(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:i(P(this._r,255)*100)+"%",g:i(P(this._g,255)*100)+"%",b:i(P(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+i(P(this._r,255)*100)+"%, "+i(P(this._g,255)*100)+"%, "+i(P(this._b,255)*100)+"%)":"rgba("+i(P(this._r,255)*100)+"%, "+i(P(this._g,255)*100)+"%, "+i(P(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:M[v(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+m(this._r,this._g,this._b,this._a),n=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=a(e);n=i.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,r=this._a<1&&this._a>=0,i=!t&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="name");if(i)return e==="name"&&this._a===0?this.toName():this.toRgbString();e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString());if(e==="hex"||e==="hex6")n=this.toHexString();return e==="hex3"&&(n=this.toHexString(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString()},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(w,arguments)},brighten:function(){return this._applyModification(E,arguments)},darken:function(){return this._applyModification(S,arguments)},desaturate:function(){return this._applyModification(g,arguments)},saturate:function(){return this._applyModification(y,arguments)},greyscale:function(){return this._applyModification(b,arguments)},spin:function(){return this._applyModification(x,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(L,arguments)},complement:function(){return this._applyCombination(T,arguments)},monochromatic:function(){return this._applyCombination(A,arguments)},splitcomplement:function(){return this._applyCombination(k,arguments)},triad:function(){return this._applyCombination(N,arguments)},tetrad:function(){return this._applyCombination(C,arguments)}},a.fromRatio=function(e,t){if(typeof e=="object"){var n={};for(var r in e)e.hasOwnProperty(r)&&(r==="a"?n[r]=e[r]:n[r]=q(e[r]));e=n}return a(e,t)},a.equals=function(e,t){return!e||!t?!1:a(e).toRgbString()==a(t).toRgbString()},a.random=function(){return a.fromRatio({r:u(),g:u(),b:u()})},a.mix=function(e,t,n){n=n===0?0:n||50;var r=a(e).toRgb(),i=a(t).toRgb(),s=n/100,o=s*2-1,u=i.a-r.a,f;o*u==-1?f=o:f=(o+u)/(1+o*u),f=(f+1)/2;var l=1-f,c={r:i.r*f+r.r*l,g:i.g*f+r.g*l,b:i.b*f+r.b*l,a:i.a*s+r.a*(1-s)};return a(c)},a.readability=function(e,t){var n=a(e),r=a(t),i=n.toRgb(),s=r.toRgb(),o=n.getBrightness(),u=r.getBrightness(),f=Math.max(i.r,s.r)-Math.min(i.r,s.r)+Math.max(i.g,s.g)-Math.min(i.g,s.g)+Math.max(i.b,s.b)-Math.min(i.b,s.b);return{brightness:Math.abs(o-u),color:f}},a.isReadable=function(e,t){var n=a.readability(e,t);return n.brightness>125&&n.color>500},a.mostReadable=function(e,t){var n=null,r=0,i=!1;for(var s=0;s<t.length;s++){var o=a.readability(e,t[s]),u=o.brightness>125&&o.color>500,f=3*(o.brightness/125)+o.color/500;if(u&&!i||u&&i&&f>r||!u&&!i&&f>r)i=u,r=f,n=a(t[s])}return n};var O=a.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},M=a.hexNames=_(O),z=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",i="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+i),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=a}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}),define("storymaps/tpl/builder/addedit/Popup",["lib-build/tpl!./Popup","lib-build/css!./Popup","lib-build/css!./ColorPickerStyle","lib-build/css!lib-app/spectrum/spectrum","lib-app/spectrum/spectrum","../../../common/builder/media/map/MapConfigOverlay","../../core/WebApplicationData","esri/geometry/Extent","dojo/Deferred","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f){return function(n,r){function p(){g(),s.present("LOCATION",!1).then(function(){g(),o.setTabs(app.data.getStory()),n.find(".webmap-loading").hide(),n.find(".map-cfg").removeClass("disabled")})}function d(){h.updateShortlistExtent()}function v(){n.find(".btnCancel").click(function(){n.modal("hide")}),n.on("shown.bs.modal",function(){m()}),$('.tab-cfg-location .btn[data-value="custom"]').click(function(){$('.tab-cfg-location .btn[data-value="custom"]').addClass("btn-primary"),$('.tab-cfg-location .btn[data-value="default"]').removeClass("btn-primary"),p()}),$('.tab-cfg-location .btn[data-value="default"]').click(function(){$('.tab-cfg-location .btn[data-value="default"]').addClass("btn-primary"),$('.tab-cfg-location .btn[data-value="custom"]').removeClass("btn-primary")}),l.click(y)}function m(){b()}function g(){n.hasClass("in")?(c=!0,n.addClass("temporaryHide")):n.removeClass("temporaryHide"),n.modal("toggle")}function y(){var e=n.find(".title").val(),t="#"+$("#colorpicker").spectrum("get").toHex(),r=$(".entry.active").index();if(t!=app.data.getStory()[r].color){$.each(app.layerCurrent.graphics,function(e,n){app.addFeatureBar.addMapIcon(n,t,!0)});var i=app.map.getLayer(app.data.getShortlistLayerId());i.redraw()}$('.tab-cfg-location .btn[data-value="default"]').hasClass("btn-primary")&&d(),app.data.setStory(r,e,t),app.data.getWebAppData().setTabs(app.data.getStory());var s={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:t,tabTextHover:"#fff",tabHover:"#666"};app.ui.navBar.init(app.data.getStory(),r,s,o),app.map.getLayer(app.data.getShortlistLayerId()).redraw(),$(".num").css("background-color",t),$("#paneLeft").css("border-top-color",t),$(".detailContainer").eq(r).find(".detailFeatureNum").css("background-color",t),f.publish("BUILDER_INCREMENT_COUNTER",1),app.layerCurrent.color=t,n.modal("hide")}function b(e){l.attr("disabled",e)}n.append(e({btnCancel:i18n.commonCore.common.cancel,btnBack:i18n.commonCore.common.back}));var i=null,u=null,l=n.find(".btnSubmit"),c=null,h=r;v(),this.present=function(e){return i=new a,u=e,app.isAddEditInProgress=!0,$("#colorpicker").spectrum()&&$("#colorpicker").spectrum("destroy"),$("#colorpicker").spectrum({color:e.entry.color,showPalette:!0,showInput:!0,palette:["#425dac","#b82323","#37921e","#874094","#000000","#dc6800","#dab70c","#A67455"],preferredFormat:"hex"}),n.find(".titleContainer input").on({change:function(){n.find(".titleContainer input").val().length?(b(!1),n.find(".titleContainer input").css("border-color","#ccc")):(b(!0),n.find(".titleContainer input").css("border-color","red"))}}),e.mode=="add"?(n.find(".modal-logo").removeClass("edit"),n.find(".modal-title").html(i18n.builder.addEditPopup.titleAdd),l.html(i18n.commonCore.common.add)):(n.find(".modal-logo").addClass("edit"),n.find(".modal-title").html(i18n.builder.addEditPopup.titleEdit),l.html(i18n.commonCore.common.save)),n.toggleClass("isAdding",e.mode=="add"),n.toggleClass("isEditing",e.mode!="add"),b(),n.find(".titleContainer").removeClass("has-feedback has-error").find(".title").val(e.mode=="edit"?e.entry.title:""),n.modal({keyboard:!0}),i},this.close=function(){n.modal("hide"),i.reject()},this.initLocalization=function(){}}}),define("lib-build/tpl!storymaps/tpl/builder/OrganizePopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n			<div class="organizeHeader"></div>\r\n\r\n			<div class="organizeTableContainer">\r\n				<table class="organizeTable table table-striped">\r\n					<thead>\r\n					<tr style="height: 39px">\r\n						<th class="moverHeader">&nbsp;</th>\r\n						<th>Title</th>\r\n						<th style="width: 44px;"></th>\r\n					</tr>\r\n					</thead>\r\n					<tbody class="rows">\r\n						<!-- rows -->\r\n					</tbody>\r\n				</table>\r\n			</div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<button type="button" class="btn btnApply btn-primary"></button>\r\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnCancel)==null?"":__t)+"</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n";return __p}}),define("lib-build/css!storymaps/tpl/builder/OrganizePopup",[],function(){}),define("lib-build/tpl!storymaps/tpl/builder/OrganizePopupEntry",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<tr class="sectionRow ui-state-highlight" data-index="'+((__t=index)==null?"":__t)+'">\r\n	<td class="mover"></td>\r\n	<td class="entryTitle">'+((__t=title)==null?"":__t)+'</td>\r\n	<td>\r\n		<button type="button" class="btn btn-default btn-md glyphicon glyphicon-trash deleteSectionBtn" data-toggle="tooltip" title="'+((__t=helpDelete)==null?"":__t)+'"></button>\r\n	</td>\r\n</tr>\r\n';return __p}}),function(e){function s(e,t){if(e.originalEvent.touches.length>1)return;e.preventDefault();var n=e.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(r)}e.support.touch="ontouchend"in document;if(!e.support.touch)return;var t=e.ui.mouse.prototype,n=t._mouseInit,r=t._mouseDestroy,i;t._touchStart=function(e){var t=this;if(i||!t._mouseCapture(e.originalEvent.changedTouches[0]))return;i=!0,t._touchMoved=!1,s(e,"mouseover"),s(e,"mousemove"),s(e,"mousedown")},t._touchMove=function(e){if(!i)return;this._touchMoved=!0,s(e,"mousemove")},t._touchEnd=function(e){if(!i)return;s(e,"mouseup"),s(e,"mouseout"),this._touchMoved||s(e,"click"),i=!1},t._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),n.call(t)},t._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)}}(jQuery),define("lib-app/jquery.ui.touch-punch",function(){}),define("storymaps/tpl/builder/OrganizePopup",["lib-build/tpl!./OrganizePopup","lib-build/css!./OrganizePopup","lib-build/tpl!./OrganizePopupEntry","lib-app/jquery.ui.touch-punch","dojo/Deferred"],function(e,t,n,r,i){return function(r){function f(){var e=$(this).closest("tr").first();e.fadeOut("fast",function(){e.remove(),a++,h()});var t=r.find(".sectionRow").get();return t.length==2&&r.find(".deleteSectionBtn").attr("disabled",!0),!1}function l(){var e=[],t=0,n=r.find(".sectionRow").get();$.each($(n),function(n,r){var i=$(r),s=i.data("index"),o=i.find(".status-list-btn").data("value"),a=u.entries[s];a.status=o,e.push(a),s===u.sectionIndex&&(t=n)}),o.resolve({entries:e,sectionIndex:t}),r.modal("hide")}function c(){r.find(".btnApply").click(l),r.on("hide.bs.modal",function(){o.reject()}),s=!0}function h(){a?r.find(".btnApply").html("Confirm deletion of %NB% %LBL_LAYOUT%".replace("%NB%",a).replace("%LBL_LAYOUT%",a>1?"tabs":"tab")).removeClass("btn-primary").addClass("btn-danger"):r.find(".btnApply").html(i18n.commonCore.common.apply).removeClass("btn-danger").addClass("btn-primary")}var s=!1,o=null,u=null,a=null;r.append(e({title:"Organize Tabs",lblColTitle:i18n.builder.organizePopup.lblColTitle,lblColStatus:i18n.builder.organizePopup.lblColStatus,btnCancel:i18n.commonCore.common.cancel})),this.present=function(e){var t="";o=new i,u=e;if(!e||!e.entries||e.sectionIndex==null)return o.reject();a=0,s||c(),r.find(".organizeHeader").html("Drag and drop tabs to organize your story"),$.each(u.entries,function(e,r){var i=r.title;t+=n({index:e,title:i,statusVal:"",statusLbl:"",helpDelete:"delete"}),"Delete"}),r.find(".rows").html(t),r.find(".deleteSectionBtn").attr("disabled",!1),r.find("*[data-toggle=tooltip]").tooltip({trigger:"hover"}),r.find(".deleteSectionBtn").click(f),r.find(".rows").toggleClass("noreorder",u.entries.length<=1);if(Object.keys(u.entries).length>1)r.find(".organizeTable tbody").sortable({axis:"y",opacity:"0.4",cursor:"move",helper:function(e,t){var n=t.children(),r=t.clone();return r.children().each(function(e){$(this).outerWidth(n.eq(e).outerWidth())}),r}});else try{r.find(".organizeTable tbody").sortable("destroy")}catch(l){}return h(),r.modal({keyboard:!0}),o},this.close=function(){r.modal("hide"),o.reject()}}}),define("lib-build/tpl!storymaps/tpl/builder/shortlistMigration/Migration",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="backdrop"></div>\r\n<div class="modal-dialog">\r\n	<div class="modal-content">\r\n		<div class="modal-logo edit"></div>\r\n		<div class="modal-header">\r\n			<h4 class="modal-title">Welcome to the Shortlist Builder</h4>\r\n		</div>\r\n\r\n		<div class="modal-body">\r\n\r\n			<div class="tab-pane viewMigrationSelectorContainer">\r\n				<div class="importQuestion">\r\n					Your web map contains point data.  Do you want to import those points into your Shortlist as places?\r\n				</div>\r\n\r\n				<div class="radio">\r\n					<label class="opt-radio-import">\r\n						<input type="radio" name="optradio" value="1" checked=true/>\r\n						Yes\r\n					</label>\r\n					<div class="importExplain">You will be able to edit, manage and add to your places in the Shorlist Builder.  A copy of your web map\r\n					is automatically created so your original data is not modified.</div>\r\n				</div>\r\n				<div class="radio">\r\n					<label class="opt-radio-import">\r\n						<input type="radio" name="optradio" value="0" />\r\n						No\r\n					</label>\r\n					<div class="importExplain">Your points will be displayed on your Shortlist map but won\'t be used as places.  Instead you\'ll add your\r\n					places into your Shortlist in the Builder.</div>\r\n				</div>\r\n\r\n			</div>\r\n		</div>\r\n\r\n		<div class="modal-footer">\r\n			<span class="modal-footer-left"><button class="btn btn-back btn-naked">< '+((__t=btnBack)==null?"":__t)+'</button></span>\r\n			<span class="btnSubmitWrapper" data-toggle="tooltip"">\r\n				<button class="btnSubmit btn btn-primary" ></button>\r\n			</span>\r\n			<div class="btnSubmitTooltipContainer"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/shortlistMigration/Migration",[],function(){}),define("lib-build/tpl!storymaps/tpl/builder/shortlistMigration/layerPicker",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="tab-pane viewMigrationLayerSelectorContainer">\r\n	<div class="importQuestion">\r\n		Choose the point layer(s) in your web map you want to use as places:\r\n	</div>\r\n\r\n	<div class="checkbox opt-container layer-picker" >\r\n\r\n	</div>\r\n\r\n	<div class="layer-info">\r\n		If you choose more than one layer, they must all have the same set of fields.\r\n		Each layer you choose will become a tab in your shortlist.\r\n	</div>\r\n\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/shortlistMigration/layerPicker",[],function(){}),define("lib-build/tpl!storymaps/tpl/builder/shortlistMigration/tabFieldPicker",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="tab-pane viewMigrationTabFieldSelectorContainer">\r\n	<div class="layer-info">\r\n		If you have a field name that divides the places in your layer into different\r\n		themes, select the appropriate field name below.\r\n	</div>\r\n\r\n	<div class="tab-field-picker">\r\n		<select id="tabFieldSelect">\r\n			<option value="none">none</option>\r\n		</select>\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/tpl!storymaps/tpl/builder/shortlistMigration/fieldPicker",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="tab-pane viewMigrationFieldSelectorContainer">\r\n\r\n	<div class="inset field-name">\r\n		Field containing the name of each place:\r\n		<div class="tab-field-name-picker">\r\n			<select id="fieldNameSelect">\r\n				<option value="none">none</option>\r\n			</select>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="inset description-info">\r\n		Field(s) that will appear in the description for each place and their order:\r\n	</div>\r\n	<div class="opt-container description-picker" >\r\n\r\n	</div>\r\n\r\n	<div class="inset url-info">\r\n		Field containing the URL for \'More info\' about each place (optional):\r\n	</div>\r\n	<div class="tab-field-url-picker">\r\n		<select id="fieldUrlSelect">\r\n			<option value="none">none</option>\r\n		</select>\r\n	</div>\r\n\r\n	<div class="inset pic-info">\r\n		Fields containing URL to images for each place (optional):\r\n	</div>\r\n	<div class="tab-field-photo-picker">\r\n		Main image:\r\n		<select class="photoSelect" id="fieldPicUrlSelect">\r\n			<option value="none">none</option>\r\n		</select>\r\n	</div>\r\n	<div class="tab-field-photo-picker">\r\n		Thumbnail:\r\n		<select class="photoSelect" id="fieldThumbUrlSelect">\r\n			<option value="none">none</option>\r\n		</select>\r\n	</div>\r\n	<div class="inset imagesOptional">\r\n		Leave these set to none if you want to add images to your places in the Builder\r\n	</div>\r\n</div>\r\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/shortlistMigration/fieldPicker",[],function(){}),define("storymaps/tpl/builder/shortlistMigration/Migration",["lib-build/tpl!./Migration","lib-build/css!./Migration","lib-build/tpl!./layerPicker","lib-build/css!./layerPicker","lib-build/tpl!./tabFieldPicker","lib-build/tpl!./fieldPicker","lib-build/css!./fieldPicker","../../core/Helper","../MapExtentSave","esri/symbols/SimpleMarkerSymbol","esri/graphic","esri/layers/FeatureLayer","dojo/topic","dojo/Deferred"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return function(r,o,a,c,d){function A(){r.find(".btnCancel").click(function(){r.modal("hide"),b.reject()}),r.on("shown.bs.modal",function(){O()}),N.click(I),C.click(q),r.find(".viewMigrationSelectorContainer input").on("change",function(){F()})}function O(){F()}function M(){r.hasClass("in")?(k=!0,r.addClass("temporaryHide")):r.removeClass("temporaryHide"),r.modal("toggle")}function _(){setTimeout(function(){r.find(".modal-body").addClass("migrateWebmap"),r.find(".modal-body").removeClass("layerSelector"),r.find(".modal-body").removeClass("migrationQuestion"),r.find(".modal-body").removeClass("tabFieldSelector")},500);var e=[];r.find(".layer-picker .opt-checkbox:checkbox:checked").each(function(){e.push($(this).attr("name"))}),E=[],T=[],$.each(e,function(e,t){var n=$.grep(w,function(e){return e.id==t});E.push(n[0])}),x=[],$.each(w,function(e,t){var n=$.grep(E,function(e){return e.id==t.id});n[0]||x.push(t)});if(E.length>1){var t=[];$.each(E[0].graphics[0].attributes,function(e){t.push(e)}),$.each(E,function(e,n){var r=[];$.each(t,function(e,i){var s=[];$.each(n.graphics[0].attributes,function(e){s.push(e)});var o=$.grep(s,function(e){return e.toLowerCase()===i.toLowerCase()});if(!o.length){var u=t.indexOf(i);r.push(u)}}),$.each(r,function(e,n){t.splice(n,1)})}),$.each(t,function(e,t){t!="__OBJECTID"&&(T.push(t),$("#fieldSelect").append($("<option></option>").attr("value",t).text(t)))})}else{$.each(E[0].graphics[0].attributes,function(e){e!="__OBJECTID"&&(T.push(e),$("#fieldSelect").append($("<option></option>").attr("value",e).text(e)))});if(r.find(".layer-picker .opt-checkbox:checkbox:checked").length==1&&r.find("#tabFieldSelect").val()!="none"){var n=r.find("#tabFieldSelect").val(),i=[],o=[];$.each(E[0].graphics,function(e,t){o.indexOf(t.attributes[n])<0&&(o.push(t.attributes[n]),i.push({name:t.attributes[n],graphics:[],alias:t.attributes[n]}))}),$.each(E[0].graphics,function(e,t){var r=$.grep(o,function(e){return e==t.attributes[n]});$.map(i,function(e,n){e.name==r[0]&&i[n].graphics.push(t)})}),E=i}}r.find(".modal-title").text("Choose the fields the Shortlist should use"),r.find(".viewMigrationLayerSelectorContainer").hide(),$(".viewMigrationFieldSelectorContainer").length?$(".viewMigrationFieldSelectorContainer").show():(r.find(".modal-body").append(s({})),r.find(".viewMigrationFieldSelector fieldNameSelect").on("change",function(){F()})),$("#fieldNameSelect").empty(),$("#fieldUrlSelect").empty(),$("#fieldPicUrlSelect").empty(),$("#fieldThumbUrlSelect").empty(),r.find(".description-picker").empty(),$("#fieldNameSelect").append($("<option></option>").attr("value","none").text("none")),$("#fieldUrlSelect").append($("<option></option>").attr("value","none").text("none")),$("#fieldPicUrlSelect").append($("<option></option>").attr("value","none").text("none")),$("#fieldThumbUrlSelect").append($("<option></option>").attr("value","none").text("none"));var u=!1;$.each(T,function(e,t){$("#fieldNameSelect").append($("<option></option>").attr("value",t).text(t)),$("#fieldUrlSelect").append($("<option></option>").attr("value",t).text(t)),$("#fieldPicUrlSelect").append($("<option></option>").attr("value",t).text(t)),$("#fieldThumbUrlSelect").append($("<option></option>").attr("value",t).text(t));var n=null;t.toLowerCase()=="short_desc"&&(n=1),t.toLowerCase()=="desc1"&&(n=2),t.toLowerCase()=="description"&&(n=2),t.toLowerCase()=="caption"&&(n=2),t.toLowerCase()=="desc2"&&(n=3),t.toLowerCase()=="desc3"&&(n=4),t.toLowerCase()=="desc4"&&(n=5),t.toLowerCase()=="desc5"&&(n=6),t.toLowerCase()=="address"&&(n=7),t.toLowerCase()=="hours"&&(n=8),n?(r.find(".description-picker").append('<div class="checkbox"><label><input type="checkbox" class="opt-checkbox" value='+n+"/>"+t+"</label></div>"),u=!0):r.find(".description-picker").append('<div class="checkbox"><label><input type="checkbox" class="opt-checkbox" />'+t+"</label></div>")}),u&&r.find(".description-picker .checkbox").sort(function(e,t){var n=$(e).find(":checkbox"),r=$(t).find(":checkbox");return n.val()<r.val()?-1:n.val()>r.val()?1:0}).appendTo(".description-picker"),D()}function D(){$.each($("#fieldNameSelect option"),function(e,t){if(t.value.toLowerCase()=="name")return $(this).prop("selected",!0),!1;t.value.toLowerCase()=="title"&&$(this).prop("selected",!0)}),$.each(r.find(".description-picker .opt-checkbox"),function(e,t){$(t).parent().text().toLowerCase()=="short_desc"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="desc1"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="description"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="caption"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="desc2"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="desc3"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="desc4"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="desc5"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="hours"&&$(this).prop("checked",!0),$(t).parent().text().toLowerCase()=="address"&&$(this).prop("checked",!0)}),$.each($("#fieldUrlSelect option"),function(e,t){if(t.value.toLowerCase()=="website")return $(this).prop("selected",!0),!1}),$.each($("#fieldPicUrlSelect option"),function(e,t){if(t.value.toLowerCase()=="pic_url")return $(this).prop("selected",!0),!1;t.value.toLowerCase()=="picture"&&$(this).prop("selected",!0),t.value.toLowerCase()=="image_url"&&$(this).prop("selected",!0)}),$.each($("#fieldThumbUrlSelect option"),function(e,t){if(t.value.toLowerCase()=="thumb_url")return $(this).prop("selected",!0),!1;t.value.toLowerCase()=="pic_url"&&$(this).prop("selected",!0),t.value.toLowerCase()=="picture"&&$(this).prop("selected",!0),t.value.toLowerCase()=="image_url"&&$(this).prop("selected",!0)}),setTimeout(function(){F()},500),r.find(".description-picker .opt-checkbox").on("click",function(){F()}),r.find("#fieldNameSelect").on("change",function(){F()}),$(".description-picker").sortable()}function P(){var e=$("input[name=optradio]:checked",".viewMigrationSelectorContainer").val();e=parseInt(e);if(!e)b.resolve(parseInt(e)),r.modal("hide");else{r.find(".modal-title").text("Choose your point Data"),C.show(),r.find(".viewMigrationSelectorContainer").hide();if($(".viewMigrationLayerSelectorContainer").length){$(".viewMigrationLayerSelectorContainer").show(),setTimeout(function(){r.find(".modal-body").addClass("layerSelector"),r.find(".modal-body").removeClass("migrateWebmap"),r.find(".modal-body").removeClass("migrationQuestion")},500);return}r.find(".modal-body").append(n({})),w.reverse(),w.length==1&&$(".layer-info").hide(),$.each(w,function(e,t){var n=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==t.id.slice(0,-2)}),i;t.layerType?i=t.layerType:i=t.type,t.url&&(i==="ArcGISFeatureLayer"||i==="Feature Layer")&&!t.id.match(/^csv_/)&&(n=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==t.id})),n=n[0]?n[0].title:t.id,t.alias=n,r.find(".layer-picker").append('<div class="checkbox"><label><input type="checkbox" class="opt-checkbox" name='+t.id+" />"+n+"</label></div>")}),r.find(".layer-picker .opt-checkbox").eq(0).prop("checked",!0)}r.find(".layer-picker .opt-checkbox").on("change",function(){F()}),setTimeout(function(){F()},500)}function H(){r.find(".modal-title").text("Does your layer contain multiple themes?"),$(".viewMigrationTabFieldSelectorContainer").length||r.find(".modal-body").append(i({})),$(".viewMigrationTabFieldSelectorContainer").show(),r.find(".modal-body").addClass("tabFieldSelector");var e=$(".layer-picker .opt-checkbox:checkbox:checked").attr("name"),t=$.grep(w,function(t){return t.id==e});$("#tabFieldSelect").empty(),$("#tabFieldSelect").append($("<option></option>").attr("value","none").text("none")),$.each(t[0].graphics[0].attributes,function(e){e!="__OBJECTID"&&$("#tabFieldSelect").append($("<option></option>").attr("value",e).text(e))}),$.each($("#tabFieldSelect option"),function(e,t){if(t.value.toLowerCase()=="tabname"||t.value.toLowerCase()=="tab_name")return $(this).prop("selected",!0),!1}),setTimeout(function(){r.find(".modal-body").removeClass("layerSelector"),r.find(".modal-body").removeClass("migrateWebmap"),r.find(".modal-body").removeClass("migrationQuestion"),r.find(".modal-body").addClass("fieldSelector"),F()},500)}function B(e,t,n,i,s){r.modal("hide"),app.isGalleryCreation=!0,g.buildAddFeatureBar(),app.data.getWebAppData().setDefaultGeneralOptions();var u=g.buildWebMap();app.data.getWebAppData().setTitle(app.data.getWebAppItem().title),u.item.title=app.data.getResponse().itemInfo.item.title+" - Shortlist builder",app.data.getResponse().itemInfo.item.title=u.item.title;if(app.data.getWebAppItem().description||app.data.getWebAppItem().snippet){var a=app.data.getWebAppItem().description?app.data.getWebAppItem().description:app.data.getWebAppItem().snippet;app.data.getWebAppData().setSubtitle(a),u.item.description=a}else if(app.data.getResponse().itemInfo.item.description||app.data.getResponse().itemInfo.item.snippet){var a=app.data.getResponse().itemInfo.item.description?app.data.getResponse().itemInfo.item.description:app.data.getResponse().itemInfo.item.snippet;app.data.getWebAppData().setSubtitle(a),u.item.description=a}app.ui.headerDesktop.setTitleAndSubtitle(app.data.getWebAppData().getTitle(),app.data.getWebAppData().getSubtitle()),u.item.extent=app.data.getResponse().itemInfo.item.extent,u.itemData.spatialReference=app.data.getResponse().itemInfo.itemData.spatialReference,u.itemData.baseMap=app.data.getResponse().itemInfo.itemData.baseMap,app.mapItem=app.data.getResponse().itemInfo,app.data.getResponse().itemInfo.itemData.bookmarks&&app.data.getResponse().itemInfo.itemData.bookmarks.length&&(u.itemData.bookmarks=app.data.getResponse().itemInfo.itemData.bookmarks);if(n!="none"){var c=app.data.getWebAppData().getGeneralOptions();c.moreInfoLink=!0,app.data.getWebAppData().setGeneralOptions(c)}app.data.getWebAppData().setOriginalWebmap(app.data.getWebAppData().getWebmap()),app.map.destroy(),app.map=null;var p=m.loadWebmap(u,"map");p.then(function(r){app.data.setResponse(r),app.map=p.results[0].map;var u=app.data.getWebAppData().getGeneralOptions();u.extentMode="customHome",app.data.getWebAppData().setGeneralOptions(u),g.storyDataReady(),app.data.getWebAppData().setDefaultMapOptions();var a=app.cfg.COLOR_ORDER.split(","),c=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==a[0]});$("#paneLeft").css("border-top-color",c[0].color);var d={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:c[0].color,tabTextHover:"#fff",tabHover:"#666"},b=0,w={};w.title="Tab 1",app.ui.navBar.init([w],b,d,app.data.getWebAppData());var T=[];$.each(S,function(e,t){var n=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==t.id.slice(0,-2)}),r;t.layerType?r=t.layerType:r=t.type,t.url&&(r==="ArcGISFeatureLayer"||r==="Feature Layer"||t.tileMap||t.tileInfo)&&!t.id.match(/^csv_/)&&(n=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==t.id})),n[0]&&(T.push(n[0]),app.map.addLayer(t))}),$.each(x,function(e,t){var n=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==t.id.slice(0,-2)}),r;t.layerType?r=t.layerType:r=t.type,t.url&&(r==="ArcGISFeatureLayer"||r==="Feature Layer")&&!t.id.match(/^csv_/)&&(n=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==t.id})),n[0]&&(T.push(n[0]),app.map.addLayer(t))}),app.data.setWebMap(p.results[0].itemInfo),app.addFeatureBar.addLayer(!0),$.each(T,function(e,t){app.data.getWebMap().itemData.operationalLayers.push(t)}),app.maps[r.itemInfo.item.id]=m.getMapConfig(r),g.updateUI(),v.appInitComplete(y);var N=app.map.getLayer(app.data.getShortlistLayerId());app.map.reorderLayer(N,app.map.graphicsLayerIds.length-2),app.map.reorderLayer(app.map.getLayer("tempIconLayer"),app.map.graphicsLayerIds.length-1),$.each(E,function(r,o){$("body").addClass("loadingPlaces"),r===0&&($(".entryLbl").eq(0).text(o.alias),app.data.setStory(0,o.alias),app.data.getWebAppData().setTabs(app.data.getStory())),r>0&&app.ui.navBar.onClickAdd(null,o.alias),$.each(o.graphics,function(o,u){var a={__OBJECTID:N.graphics.length+1,name:"",description:"",pic_url:"",thumb_url:"",shortlist_id:N.graphics.length+1,number:o+1,tab_id:r,locationSet:parseInt(1)};u.attributes.number&&(a.number=u.attributes.number),u.attributes.Number&&(a.number=u.attributes.Number),u.attributes.NUMBER&&(a.number=u.attributes.NUMBER),a.name=u.attributes[e],$.each(t,function(e,t){u.attributes[t]&&(a.description+=u.attributes[t]+"<br><br>")}),n!="none"&&u.attributes[n]&&(a.description+="<a href="+u.attributes[n]+' target="_blank">More info</a>'),i!="none"&&(a.pic_url=u.attributes[i]),s!="none"&&(a.thumb_url=u.attributes[s]),s=="none"&&i!="none"&&(a.thumb_url=u.attributes[i]);var c=new f,h=new l(u.geometry,c,a),p=app.addFeatureBar.addMapIcon(h,app.data.getStory()[r].color);N.add(p)})}),app.detailPanelBuilder.buildAllSlides(),$("#loadingIndicator").show();if(app.data.getResponse().itemInfo.itemData.bookmarks&&app.data.getResponse().itemInfo.itemData.bookmarks.length){var C={extentMode:"customHome",numberedIcons:!1,filterByExtent:!0,bookmarks:!0,bookmarksAlias:"Zoom"};app.data.getWebAppData().setGeneralOptions(C),app.ui.navBar.initBookmarks()}setTimeout(function(){$("body").removeClass("loadingPlaces"),o.displayApp(),m.activateLayer(0),app.map.setExtent(app.map._params.extent,!0),h.publish("BUILDER_INCREMENT_COUNTER",1),app.data.getWebAppItem().typeKeywords.push("Shortlist-migration")},500)})}function j(e){return{id:e.id,title:e.title,visibility:!0,opacity:1,featureCollection:{layers:[e.featureCollection],showLegend:!0}}}function F(){var e=!0;r.find("input[name=optradio]:checked",".viewMigrationSelectorContainer").length&&r.find(".viewMigrationSelectorContainer").css("display")!="none"&&(e=!1,r.find(".modal-body").addClass("migrationQuestion"),r.find(".modal-body").removeClass("layerSelector"),r.find(".modal-body").removeClass("tabFieldSelector"),r.find(".modal-body").removeClass("fieldSelector"),r.find(".modal-body").removeClass("migrateWebmap")),r.find(".layer-picker .opt-checkbox:checkbox:checked").length>0&&r.find(".viewMigrationLayerSelectorContainer").css("display")!="none"&&(e=!1,r.find(".modal-body").addClass("layerSelector"),r.find(".modal-body").removeClass("tabFieldSelector"),r.find(".modal-body").removeClass("fieldSelector"),r.find(".modal-body").removeClass("migrateWebmap"),r.find(".modal-body").removeClass("migrationQuestion")),r.find("#fieldNameSelect").val()!="none"&&r.find(".viewMigrationFieldSelectorContainer").css("display")=="block"&&(e=!1,r.find(".modal-body").addClass("migrateWebmap"),r.find(".modal-body").removeClass("layerSelector"),r.find(".modal-body").removeClass("tabFieldSelector"),r.find(".modal-body").removeClass("migrationQuestion")),r.find(".modal-body").hasClass("tabFieldSelector")&&(e=!1),N.html("Next"),N.attr("disabled",e)}function I(){if(r.find(".modal-body").hasClass("migrationQuestion")){P();return}if(r.find(".modal-body").hasClass("layerSelector")){r.find(".viewMigrationLayerSelectorContainer").hide(),r.find(".layer-picker .opt-checkbox:checkbox:checked").length==1?(H(),setTimeout(function(){F()},50)):(_(),setTimeout(function(){F()},50));return}if(r.find(".modal-body").hasClass("tabFieldSelector")){r.find(".viewMigrationTabFieldSelectorContainer").hide(),_(),setTimeout(function(){F()},50);return}if(r.find(".modal-body").hasClass("migrateWebmap")){var e=r.find("#fieldNameSelect").val(),t=[];$.each(r.find(".description-picker .opt-checkbox:checkbox:checked"),function(e,n){t.push($(n).parent().text())});var n=r.find("#fieldUrlSelect").val(),i=r.find("#fieldPicUrlSelect").val(),s=r.find("#fieldThumbUrlSelect").val();B(e,t,n,i,s)}}function q(){r.find(".modal-body").hasClass("layerSelector")&&(r.find(".modal-body").removeClass("layerSelector"),r.find(".modal-body").addClass("migrationQuestion"),r.find(".viewMigrationLayerSelectorContainer").hide(),r.find(".viewMigrationSelectorContainer").show(),r.find(".modal-title").text("Welcome to the Shortlist Builder"),C.hide(),F()),r.find(".modal-body").hasClass("tabFieldSelector")&&($(".viewMigrationTabFieldSelectorContainer").hide(),r.find(".modal-body").removeClass("tabFieldSelector"),P(),F()),r.find(".modal-body").hasClass("migrateWebmap")&&($(".viewMigrationFieldSelectorContainer").hide(),r.find(".layer-picker .opt-checkbox:checkbox:checked").length==1?H():P(),F())}r.append(e({btnCancel:i18n.commonCore.common.cancel,btnBack:i18n.commonCore.common.back}));var v=o,m=a,g=c,y=d,b=null,w=null,E=null,S=null,x=null,T=[],N=r.find(".btnSubmit"),C=r.find(".btn-back"),k=null,L=new u;A(),this.present=function(e,t){return b=new p,w=e,S=t,F(),r.modal({keyboard:!0}),b},this.close=function(){r.modal("hide"),b.reject()},this.initLocalization=function(){}}}),define("storymaps/tpl/builder/BuilderView",["lib-build/tpl!./BuilderView","lib-build/tpl!./BasemapChooser","lib-build/css!./BuilderView","lib-build/css!./Common","../core/WebApplicationData","storymaps/common/builder/settings/SettingsPopup","storymaps/common/builder/Landing","./Help","./InitPopup","storymaps/common/builder/SharePopup","../core/Helper","storymaps/common/utils/CommonHelper","./BuilderHelper","storymaps/common/utils/WebMapHelper","esri/dijit/BasemapGallery","storymaps/common/builder/browse-dialog/js/BrowseIdDlg","lib-build/css!../../common/builder/browse-dialog/css/browse-dialog","lib-build/css!../../common/builder/browse-dialog/storymaps-override","./settings/ViewGeneralOptions","./settings/ViewMapOptions","storymaps/common/builder/settings/ViewHeader","./MapExtentSave","./Workflow","./AddFeatureBar","./DetailPanelBuilder","./media/Popup","./addedit/Popup","./OrganizePopup","./shortlistMigration/Migration","esri/graphicsUtils","esri/layers/GraphicsLayer","esri/geometry/webMercatorUtils","esri/geometry/Extent","dojo/Deferred","dojo/topic","dojo/has","dojo/on","dojo/_base/lang"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j){return function(r){function X(e){s.updateUI(!0),e&&i.setTitle(e),P.publish("CORE_UPDATE_UI"),V();if(!a)return;if(app.isDirectCreationFirstSave){var t=app.cfg.COLOR_ORDER.split(","),n=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==t[0]});$("#paneLeft").css("border-top-color",n[0].color);var r={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:n[0].color,tabTextHover:"#fff",tabHover:"#666"},o=0,u={};u.title="Tab 1",app.ui.navBar.init([u],o,r,i),app.data.getWebMap().item.extent=c.serializeExtentToItem(app.map.extent),app.map._params.extent=new _(JSON.parse(JSON.stringify(app.map.extent.toJson())))}}function V(){s.updateUI(!0),$("body").removeClass("isBuilderLanding"),app.isInitializing=!1,P.publish("BUILDER_INCREMENT_COUNTER",1)}function J(){var e=!1;$(".builder-add").toggleClass("disabled",e).tooltip("destroy"),e&&$(".builder-add").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.builder.addEditPopup.disabled.replace("%LBL_LAYOUT%",app.data.getWebAppData().getLayoutProperties().itemsLbl.toLowerCase())})}function K(e){var t=new D;return b.present({mode:"edit",displayTab:e.displayTab,entry:app.data.getStoryByIndex(e.entryIndex),entryIndex:e.entryIndex,syncMaps:i.getMapOptions().mapsSync?!e.entryIndex:1}),t}function Q(){if($(".builder-organize").hasClass("disabled"))return;$(".builder-organize").addClass("active"),j.present({entries:app.data.getStory(),sectionIndex:$(".entry.active").index()}).then(function(e){console.log("builder.BuilderView.openOrganizePopup:",e),$(".builder-organize").removeClass("active"),j.close();var t={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:e.entries[e.sectionIndex].color,tabTextHover:"#fff",tabHover:"#666"};app.ui.navBar.init(e.entries,e.sectionIndex,t,i),app.detailPanelBuilder.updateThemeSwipers(e),app.addFeatureBar.updateAllFeatures(e),app.detailPanelBuilder.buildAllSlides(),U.activateLayer(e.sectionIndex),P.publish("story-update-entries"),P.publish("BUILDER_INCREMENT_COUNTER",1)},function(){s.updateUI()})}function G(){$("#loadingMessage").html('<div class="mainMessage">'+i18n.viewer.loading.long+"<br />"+i18n.viewer.loading.long2+"</div>").fadeIn("slow",function(){$("#loadingMessage").addClass("loaded")})}function Y(e){var t=e.settings[0].extentMode!=i.getGeneralOptions().extentMode,n=e.settings[0].numberedIcons!=i.getGeneralOptions().numberedIcons,r=e.settings[0].bookmarks!=i.getGeneralOptions().bookmarks,s=e.settings[0].bookmarksAlias!=i.getGeneralOptions().bookmarksAlias;i.setGeneralOptions(e.settings[0]),i.setHeader(e.settings[1]),t&&P.publish("UPDATE_EXTENT_MODE",e.settings[0].extentMode),n&&setTimeout(function(){app.addFeatureBar.updateAllFeatures(),app.detailPanelBuilder.buildAllSlides(),U.activateLayer($(".entry.active").index()),setTimeout(function(){app.ui.mainView.selected&&(app.ui.mainView.selected=null,app.mapTips&&app.mapTips.clean(!0))},50)},50),r&&(!app.ui.navBar.bookmarksLoaded&&e.settings[0].bookmarks?app.ui.navBar.initBookmarks():app.ui.navBar.bookmarksLoaded&&e.settings[0].bookmarks?app.ui.navBar.showBookmarks():app.ui.navBar.hideBookmarks()),s&&app.ui.navBar.updateBookmarksAlias(e.settings[0].bookmarksAlias),P.publish("BUILDER_INCREMENT_COUNTER",1),P.publish("CORE_UPDATE_UI"),P.publish("CORE_RESIZE"),J()}function Z(e){g.present(e,r.getHeaderUserCfg())}function et(e){var t=app.data.getWebAppData().getGeneralOptions();t.extentMode=e,app.data.getWebAppData().setGeneralOptions(t),e=="default"&&(I.initDone&&I.hideAlways(),s.updateShortlistExtent(),$(".tab-cfg-location").hide()),e=="customHome"&&(I.initDone||s.initMapExtentSave(),I.reinit(),$(".tab-cfg-location").hide()),e=="customTheme"&&(I.initDone&&I.hideAlways(),$(".tab-cfg-location").show())}function tt(){R=new v({portal:app.portal,galleryType:"webmap"}),B(R._grid,"onItemClick",function(){R.onClose()}),B(R,"close",function(){R.get("selected")&&r.loadWebMap(R.get("selected").id)})}function nt(){$("#headerDesktop").find(".title").text().length&&$("#headerDesktop").find(".title").removeClass("titleEmpty")}$("#builder-views").append(e({})),$("#map").append(t({}));var s=this,o=r,a=!0,l=null,m=new u($("#builderHelp")),g=new f($("#sharePopup")),b=new C($("#addEditPopup"),s),H=new N($("#editorDialogInlineMedia")),j=new k($("#organizePopup")),F=new S($("#initPopup")),I=new E($("#map_zoom_slider"),s),q=null,R=null,U,z=c,W;app.detailPanelBuilder=new T($("#contentPanel"),H),app.addFeatureBar=new x($("#contentPanel"),H),app.initScreenIsOpen=!0,this.init=function(e){l=e,U=app.ui.mainView,W=new L($("#migrationPopup"),o,U,s,i),P.subscribe("SETTINGS_POPUP_SAVE",Y),P.subscribe("OPEN_HELP",function(){m.present()}),P.subscribe("HEADER_EDITED",nt),P.subscribe("UPDATE_EXTENT_MODE",et),app.builder.openSharePopup=Z,app.builder.openEditPopup=K,$(".builder-add").click(function(){$(this).hasClass("disabled")||V()}).find(".builder-lbl").html(i18n.builder.addEditPopup.lblAdd),$(".builder-organize").click(Q).find(".builder-lbl").html("Organize Tabs"),s.showInitPopup()},this.appInitComplete=function(){!app.isProduction&&c.getUrlParams().debug=="add"&&V(),!app.isProduction&&c.getUrlParams().debug=="organize"&&Q(),!app.isProduction&&c.getUrlParams().debug=="settings"&&this.openSettingPopup(),!app.isProduction&&c.getUrlParams().debug=="edit"&&K({displayTab:c.getUrlParams().debugView||"content",sectionIndex:c.getUrlParams().debugIndex||0}),J()},this.storyDataReady=function(){app.initScreenIsOpen=!1;var e=dijit.byId("basemapGallery");e&&e.destroyRecursive(!0),e=new d({showArcGISBasemaps:!0,map:app.map},"basemapGallery"),e.startup(),$("#basemapChooser .dijitTitlePaneTextNode").html("Change Basemap"),$("#basemapChooser").show();var t=app.map.extent;e.on("selection-change",function(){t=app.map.extent;var n=e.getSelected(),r=[];$.each(n.layers,function(e,t){var i={id:n.id+"_"+e,opacity:1,visibility:!0,url:t.url};t.type=="reference"?i.isReference=!0:t.type=="OpenStreetMap"&&(delete i.url,i.type="OpenStreetMap"),r.push(i)}),app.data.getWebMap().itemData.baseMap={baseMapLayers:r,title:n.title},app.basemapChanged=!0,P.publish("BUILDER_INCREMENT_COUNTER",1),$("#basemapChooser").find(".dijitTitlePaneTitle").click(),setTimeout(function(){app.map.setExtent(t)},500)}),X(),a=!1;var n={};app.initScreenIsOpen=!0,s.initPopupComplete(n)},this.updateUI=function(e){var t=e||app.data.getStoryLength();$(".builder-add, .builder-organize").removeClass("active")},this.preWebmapSave=function(){var e=app.map.getLayer(app.data.getShortlistLayerId()),t=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==i.getShortlistLayerId().split("_").slice(0,-1).join("_")||e.id==app.data.getShortlistLayerId().split("_").slice(0,-1).join("_")});t[0]||(t=$.grep(app.data.getWebMap().itemData.operationalLayers,function(e){return e.id==i.getShortlistLayerId()||e.id==app.data.getShortlistLayerId()})),t[0].featureCollection=p.serializeGraphicsLayerToFeatureCollection(e)},this.buildWebMap=function(){return h.getBlankWebmapJSON()},this.getSettingsTab=function(){return[new y,new w({smallSizeOpt:app.appCfg.headerCompactOpt})]},this.openSettingPopup=function(){var e=$.isEmptyObject(app.data.getWebAppData().getHeader());if(e){var t={};t.compactSize=app.appCfg.headerCompactByDefault,i.setHeader(t)}l.present([i.getGeneralOptions(),i.getHeader()],null)},this.openMigrationPopup=function(e,t){W.present(e,t).then(function(e){if(!e){var t=app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.item;app.ui.headerDesktop.setTitleAndSubtitle(t.title,t.description),app.data.getWebAppData().setTitle(t.title),t.description&&app.data.getWebAppData().setSubtitle(t.description);if(app.data.getResponse().itemInfo.itemData.bookmarks&&app.data.getResponse().itemInfo.itemData.bookmarks.length){var n={extentMode:"customHome",numberedIcons:!1,filterByExtent:!0,bookmarks:!0,bookmarksAlias:"Zoom"};app.data.getWebAppData().setGeneralOptions(n),app.ui.navBar.initBookmarks()}s.storyDataReady(),app.detailPanelBuilder.init(app.ui.mainView),r.appInitComplete(i)}})},this.showInitPopup=function(){r.initPopupPrepare();return},this.initPopupComplete=function(e){if(e.pickWebmap)r.initPopupComplete(),$("#browse-id-dialog").css({top:"25%",left:"25%"}),$("#browse-id-dialog").show();else{r.displayApp(),r.initPopupComplete(),app.data.getWebAppData().setDefaultLayoutOptions(),s.buildAddFeatureBar(),app.isDirectCreationFirstSave&&(app.addFeatureBar.addLayer(),app.data.getWebAppData().setDefaultGeneralOptions(),app.data.getWebAppData().setDefaultMapOptions(),app.map.centerAndZoom([0,0],3),setTimeout(function(){app.data.getWebMap().item.extent=c.serializeExtentToItem(app.map.extent),app.map._params.extent=new _(JSON.parse(JSON.stringify(app.map.extent.toJson()))),app.data.getWebAppData().setMapExtent(app.map.extent)},500));if(app.isGalleryCreation){app.data.getWebAppData().setDefaultMapOptions();var t=app.cfg.COLOR_ORDER.split(","),n=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==t[0]});$("#paneLeft").css("border-top-color",n[0].color);var o={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:n[0].color,tabTextHover:"#fff",tabHover:"#666"},u=0,a={};a.title="Tab 1",app.ui.navBar.init([a],u,o,i),app.data.getWebAppData().getWebmap()||(app.addFeatureBar.addLayer(),app.data.getWebAppData().setDefaultGeneralOptions(),app.data.getWebAppData().setDefaultMapOptions(),app.map.centerAndZoom([0,0],3),setTimeout(function(){app.data.getWebMap().item.extent=c.serializeExtentToItem(app.map.extent),app.map._params.extent=new _(JSON.parse(JSON.stringify(app.map.extent.toJson()))),app.ui.headerDesktop.setTitleAndSubtitle(app.data.getWebAppItem().title,app.data.getWebAppItem().description),app.data.getWebAppData().setTitle(app.data.getWebAppItem().title),app.data.getWebAppItem().description&&app.data.getWebAppData().setSubtitle(app.data.getWebAppItem().description),P.publish("BUILDER_INCREMENT_COUNTER",1)},500))}else{var f=$.grep(app.map.graphicsLayerIds,function(e){return e.split("_").slice(0,-1).join("_")==i.getShortlistLayerId()?e:e==i.getShortlistLayerId()?e:!1});if(!f.length){var t=app.cfg.COLOR_ORDER.split(","),n=$.grep(app.cfg.COLOR_SCHEMES,function(e){return e.name==t[0]});$("#paneLeft").css("border-top-color",n[0].color);var o={header:"#444",tabText:"#d8d8d8",tab:"#666",tabTextActive:"#fff",tabActive:n[0].color,tabTextHover:"#fff",tabHover:"#666"},u=0,a={};a.title="Tab 1",app.ui.navBar.init([a],u,o,i),app.addFeatureBar.addLayer(!0),!app.data.getWebAppData().getGeneralOptions()&&!app.data.getWebAppData().getGeneralOptions().bookmarks&&app.data.getWebAppData().setDefaultGeneralOptions(),app.data.getWebAppData().setDefaultMapOptions(),s.initMapExtentSave();return}app.data.setShortlistLayerId(f[0]);var l=app.map.getLayer(app.data.getShortlistLayerId());app.layerCurrent=l,l.on("mouse-over",U.layer_onMouseOver),l.on("mouse-out",U.layer_onMouseOut),l.on("click",U.layer_onClick)}P.publish("CORE_UPDATE_UI"),$("body").addClass("switchLayout"),r.appInitComplete(i),app.data.getWebAppData().getGeneralOptions().extentMode=="customHome"&&setTimeout(function(){s.initMapExtentSave()},500)}app.detailPanelBuilder.init(U,s)},this.initMapExtentSave=function(){I.init()},this.buildAddFeatureBar=function(){app.addFeatureBar.loaded||app.addFeatureBar.init(U,s)},this.updateShortlistExtent=function(){if(app.map.getLayer(app.data.getWebAppData().getShortlistLayerId()).graphics.length==1){var e=M.webMercatorToGeographic(app.map.getLayer(app.data.getWebAppData().getShortlistLayerId()).graphics[0].geometry);app.map.centerAndZoom([e.x,e.y],13)}var t=new O;$.each(app.map.getLayer(app.data.getWebAppData().getShortlistLayerId()).graphics,function(e,n){n.attributes.locationSet&&t.graphics.push(n)});var n,r;t.graphics.length>1?(n=A.graphicsExtent(t.graphics),app.map.getLayer(app.data.getShortlistLayerId()).redraw(),r=new _(JSON.parse(JSON.stringify(n.toJson())))):t.graphics.length==1&&(r=new _(JSON.parse(JSON.stringify(app.map.extent.toJson())))),app.data.getWebAppData().getGeneralOptions().extentMode=="default"&&($.each(app.data.getStory(),function(e){app.data.setStory(e,null,null,r)}),app.data.getWebMap().item.extent=s.serializeExtentToItem(n),app.map._params.extent=r,app.data.getWebAppData().setTabs(app.data.getStory()),app.data.getWebAppData().setMapExtent(n));if(app.data.getWebAppData().getGeneralOptions().extentMode=="customTheme"){var o=$(".entry.active").index();app.data.setStory(o,null,null,r),i.setTabs(app.data.getStory())}},this.serializeExtentToItem=function(e){if(!e||!e.spatialReference)return null;var t=e.spatialReference.wkid==4326?e:M.webMercatorToGeographic(e);return[[t.xmin,t.ymin],[t.xmax,t.ymax]]},this.resize=function(e){},this.initLocalization=function(){l.initLocalization()}}}),require(["storymaps/common/Core","storymaps/common/ui/header/Desktop","storymaps/tpl/core/MainView","storymaps/common/builder/Builder","storymaps/tpl/builder/BuilderView"],function(){}),define("storymaps/tpl/BuildConfigBuilder",function(){});