/*! Storymaps-Cascade - v1.0.0 - 2016-09-06, 08:23:38 PM - This application is released under the Apache License V2.0 by Esri http://www.esri.com/ - https://github.com/Esri/story-map-cascade *//*
 *
 * Usage:
 *  require(['css!./mycssFile']);
 *
 * Tested and working in (up to latest versions as of March 2013):
 * Android
 * iOS 6
 * IE 6 - 10
 * Chome 3 - 26
 * Firefox 3.5 - 19
 * Opera 10 - 12
 * 
 * browserling.com used for virtual testing environment
 *
 * Credit to B Cavalier & J Hann for the IE 6 - 9 method,
 * refined with help from Martin Cermak
 * 
 * Sources that helped along the way:
 * - https://developer.mozilla.org/en-US/docs/Browser_detection_using_the_user_agent
 * - http://www.phpied.com/when-is-a-stylesheet-really-loaded/
 * - https://github.com/cujojs/curl/blob/master/src/curl/plugin/css.js
 *
 */

define('lib-build/css',[],function() {
  if (typeof window == 'undefined')
    return { load: function(n, r, load){ load() } };

  var head = document.getElementsByTagName('head')[0];

  var engine = window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/) || 0;

  // use <style> @import load method (IE < 9, Firefox < 18)
  var useImportLoad = false;
  
  // set to false for explicit <link> load checking when onload doesn't work perfectly (webkit)
  var useOnload = true;

  // trident / msie
  if (engine[1] || engine[7])
    useImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;
  // webkit
  else if (engine[2])
    useOnload = false;
  // gecko
  else if (engine[4])
    useImportLoad = parseInt(engine[4]) < 18;
  
  //main api object
  var cssAPI = {};
  
  cssAPI.pluginBuilder = './css-builder';

  // <style> @import load method
  var curStyle;
  var createStyle = function () {
    curStyle = document.createElement('style');
    head.appendChild(curStyle);
  }
  var importLoad = function(url, callback) {
    createStyle();

    var curSheet = curStyle.styleSheet || curStyle.sheet;

    if (curSheet && curSheet.addImport) {
      // old IE
      curSheet.addImport(url);
      curStyle.onload = callback;
    }
    else {
      // old Firefox
      curStyle.textContent = '@import "' + url + '";';

      var loadInterval = setInterval(function() {
        try {
          curStyle.sheet.cssRules;
          clearInterval(loadInterval);
          callback();
        } catch(e) {}
      }, 10);
    }
  }

  // <link> load method
  var linkLoad = function(url, callback) {
    var link = document.createElement('link');
    link.type = 'text/css';
    link.rel = 'stylesheet';
    if (useOnload)
      link.onload = function() {
        link.onload = function() {};
        // for style dimensions queries, a short delay can still be necessary
        setTimeout(callback, 7);
      }
    else
      var loadInterval = setInterval(function() {
        for (var i = 0; i < document.styleSheets.length; i++) {
          var sheet = document.styleSheets[i];
          if (sheet.href == link.href) {
            clearInterval(loadInterval);
            return callback();
          }
        }
      }, 10);
    link.href = url;
    head.appendChild(link);
  }

  cssAPI.normalize = function(name, normalize) {
    if (name.substr(name.length - 4, 4) == '.css')
      name = name.substr(0, name.length - 4);
    
    return normalize(name);
  }
  
  cssAPI.load = function(cssId, req, load, config) {

    (useImportLoad ? importLoad : linkLoad)(req.toUrl(cssId + '.css'), load);

  }

  return cssAPI;
});

define('lib-build/css!lib/calcite-bootstrap/css/calcite-bootstrap-open.min',[],function(){});
/*
 * Modified by Esri
 * lines` 63 and 83
 */

define('lib-build/less',['require'], function(require) {

  var lessAPI = {};

  lessAPI.pluginBuilder = './less-builder';

  if (typeof window == 'undefined') {
    lessAPI.load = function(n, r, load) { load(); }
    return lessAPI;
  }

  lessAPI.normalize = function(name, normalize) {
    if (name.substr(name.length - 5, 5) == '.less')
      name = name.substr(0, name.length - 5);

    name = normalize(name);

    return name;
  }

  var head = document.getElementsByTagName('head')[0];

  var base = document.getElementsByTagName('base');
  base = base && base[0] && base[0] && base[0].href;
  var pagePath = (base || window.location.href.split('#')[0].split('?')[0]).split('/');
  pagePath[pagePath.length - 1] = '';
  pagePath = pagePath.join('/');

  var styleCnt = 0;
  var curStyle;
  lessAPI.inject = function(css) {
    if (styleCnt < 31) {
      curStyle = document.createElement('style');
      curStyle.type = 'text/css';
      head.appendChild(curStyle);
      styleCnt++;
    }
    if (curStyle.styleSheet)
      curStyle.styleSheet.cssText += css;
    else
      curStyle.appendChild(document.createTextNode(css));
  }

  lessAPI.load = function(lessId, req, load, config) {
    var defaultConfig = {};
    var lessConfig = config ? (config.less || config) : defaultConfig;
    if (! ('env' in lessConfig))
      lessConfig.env = 'development';
    var globalLess = window.less;
    if (! globalLess)
        window.less = lessConfig;
    else if (! globalLess.Parser) {
        if (lessConfig === defaultConfig)
          lessConfig = globalLess;
        globalLess = null;
    }

    // Doesn't seems to help like mentioned at https://github.com/guybedford/require-less/issues/61, see below
    //lessConfig.relativeUrls = true;

    require(globalLess ? ['./normalize'] : ['./normalize', './lessc'], function(normalize, lessc) {
      if (! lessc)
        lessc = globalLess;

      if (! ("fileExt" in lessConfig))
        lessConfig.fileExt = ".less";
      var fileUrl = lessId;
      if (fileUrl.substring(fileUrl.length - 4) !== ".css" && lessConfig.fileExt)
        fileUrl += lessConfig.fileExt;
      fileUrl = normalize.absoluteURI(req.toUrl(fileUrl), pagePath);

      lessc.render('@import (' + (lessConfig.importOption || 'multiple') + ') "' + fileUrl + '";', lessConfig, function(err, output) {
        if (err)
          return load.error(err);

        //lessAPI.inject(normalize(output.css, fileUrl, pagePath));

        // Quicky CSS url path replace that bypass normalize
        output.css = output.css.replace(/..\/..\/(..\/)*resources/g, 'resources');
        lessAPI.inject(output.css);

        setTimeout(load, 7);
      }, lessConfig);

    });
  }

  return lessAPI;
});


define('lib-build/less!storymaps/common/ui/bootstrap-override',[],function(){});

define('lib-build/css!lib/font-awesome/css/font-awesome',[],function(){});

define('lib-build/css!storymaps/common/Core',[],function(){});

define('lib-build/less!storymaps/common/Core',[],function(){});
define('storymaps/common/utils/SocialSharing',[
  'dojo/Deferred',
  'esri/urlUtils'
], function(
  Deferred,
  urlUtils
) {
  return {
    shareFacebook: function(title, subtitle, optionalImageURL, url) {
      var options = 'u=' + this.cleanURL(url || document.location.href);

      window.open(
        'https://www.facebook.com/sharer/sharer.php?' + options,
        '',
        'toolbar=0,status=0,width=626,height=436'
      );
    },
    shareTwitter: function(title, url) {
      var options = 'text=' + encodeURIComponent(title || '')
              + '&url=' + this.cleanURL(url || document.location.href)
              + '&related=EsriStoryMaps'
              + '&hashtags=storymap';

      window.open(
        'https://twitter.com/intent/tweet?' + options,
        '',
        'toolbar=0,status=0,width=626,height=436'
      );
    },
    /*
    shareBitly: function(container, placement, url)
    {
      var sharebitlyindex = container.find(".share_bitly").attr('sharebitlyindex');
      if ( ! sharebitlyindex ) {
        sharebitlyindex = $(".share_bitly[sharebitlyindex]").length + 1;
        container.find(".share_bitly").attr('sharebitlyindex', sharebitlyindex);
      }

      container.find(".share_bitly").popover({
        trigger: 'manual',
        placement: placement ? placement : 'left',
        animation: false,
        html: true,
        content:
          '<div style="width:155px; min-height: 30px; text-align: center">'
          + ' <div id="bitlyLoad" style="position:absolute; top: 16px; left: 24px; width:130px; text-align:center;">'
          + '  <span class="smallLoader"></span>'
          + ' </div>'
          + ' <input id="bitlyInput" class="form-control" type="text" value="" style="display:none; height: 28px; width: 150px; margin-bottom: 0px;"/>'
          + ' <div style="font-size: 0.8em; margin-top: 2px; margin-bottom: -1px; position: absolute; top: 40px; width: 100%; left: 0px; text-align: center;">'
          + ' </div>'
          + '</div>'
          + '<script>'
          + ' setTimeout(function(){$(document).on("click touchstart", function(src) { if( ! src || ! src.target || ! $(src.target).parents(".popover").length ){ $(".share_bitly[sharebitlyindex=' + (sharebitlyindex) + ']").popover("toggle"); $(document).off("click"); } })}, 100);'
          + '</script>'
      }).popover('toggle');

      this.requestBitly(url).then(function(shortURL){
        $("#bitlyLoad").fadeOut();
        $("#bitlyInput").fadeIn();
        $("#bitlyInput").val(shortURL);
        $("#bitlyInput").select();
      });
    },
    */
    requestBitly: function(url) {
      var bitlyUrls = [
            'http://api.bitly.com/v3/shorten?callback=?',
            'https://api-ssl.bitly.com/v3/shorten?callback=?'
          ],
          bitlyUrl = location.protocol == 'http:' ? bitlyUrls[0] : bitlyUrls[1],
          targetUrl = url || document.location.href,
          resultDeferred = new Deferred();

      $.getJSON(
        bitlyUrl,
        {
          'format': 'json',
          'apiKey': app.cfg.HEADER_SOCIAL.bitly.key,
          'login': app.cfg.HEADER_SOCIAL.bitly.login,
          'longUrl': targetUrl
        },
        function(response) {
          if(! response || ! response || ! response.data.url) {
            resultDeferred.reject();
          }
          else {
            resultDeferred.resolve(response.data.url);
          }
        }
      );

      return resultDeferred;
    },
    cleanURL: function(url, noEncoding) {
      var urlParams = urlUtils.urlToObject(url);
      var newUrl = urlParams.path;

      if (urlParams.query) {
        delete urlParams.query.edit;
        delete urlParams.query.locale;
        delete urlParams.query.folderId;
        delete urlParams.query.webmap;
        delete urlParams.query.autoplay;

        $.each(Object.keys(urlParams.query), function(i, k) {
          if (i === 0) {
            newUrl += '?';
          }
          else {
            newUrl += '&';
          }

          if (urlParams.query[k] !== undefined && urlParams.query[k] !== '') {
            newUrl += k + '=' + urlParams.query[k];
          }
          else {
            newUrl += k;
          }
        });
      }

      return noEncoding ? newUrl : encodeURIComponent(newUrl);
    }
  };
});

define('storymaps/common/utils/CommonHelper',[
  'esri/urlUtils',
  'dojo/cookie',
  './SocialSharing'
],
function(
  urlUtils,
  cookie,
  SocialSharing
) {
  return {
    switchToBuilder: function() {
      if(document.location.search.match(/appid/)) {
        document.location = SocialSharing.cleanURL(document.location.protocol + '//' + document.location.host + document.location.pathname + document.location.search, true) + '&edit' + document.location.hash;
      }
      else if (document.location.search.slice(-1) == '?') {
        document.location = SocialSharing.cleanURL(document.location.protocol + '//' + document.location.host + document.location.pathname, true) + '?edit'  + document.location.hash;
      }
      else {
        document.location = SocialSharing.cleanURL(document.location.protocol + '//' + document.location.host + document.location.pathname, true) + '?edit'  + document.location.hash;
      }
    },
    getMyStoriesURL: function() {
      if (app.isPortal) {
        return this.getPortalURL() + '/apps/MyStories/';
      }
      else {
        return '//storymaps.arcgis.com/en/my-stories/';
      }
    },
    // Get URL parameters IE9 history not supported friendly
    getUrlParams: function() {
      var urlParams = urlUtils.urlToObject(document.location.search).query;

      if (urlParams) {
        return urlParams;
      }

      if (! this.browserSupportHistory() && ! urlParams) {
        return urlUtils.urlToObject(document.location.hash).query || {};
      }

      return {};
    },
    browserSupportHistory: function() {
      return !!(window.history && history.pushState);
    },
    isArcGISHosted: function() {
      // App is hosted if the URL contains /apps/XYZ/ or /home/XYZ/ or /arcgis/apps/
      return (/(\/)([a-zA-Z0-9]+(\/))*(apps\/|home\/)([a-zA-Z0-9\-\_]+\/)/).test(document.location.pathname);
    },
    getAppID: function(isProd) {
      var urlParams = this.getUrlParams();

      if (app.indexCfg && app.indexCfg.appid) {
        return app.indexCfg.appid;
      }

      if (this.isArcGISHosted() || ! isProd) {
        return urlParams.appid;
      }

      // Only authorize URL params outside of arcgis.com if a webmap/app owner is specified
      if (app.indexCfg.authorizedOwners && app.indexCfg.authorizedOwners.length > 0 && app.indexCfg.authorizedOwners[0]) {
        return urlParams.appid;
      }
    },
    getWebmapID: function(isProd) {
      var urlParams = this.getUrlParams();

      if(app.indexCfg && app.indexCfg.webmap) {
        return app.indexCfg.webmap;
      }

      if (this.isArcGISHosted() || ! isProd) {
        return urlParams.webmap;
      }

      // Only authorize URL params outside of arcgis.com if a webmap owner is specified
      if(app.indexCfg.authorizedOwners && app.indexCfg.authorizedOwners.length > 0 && app.indexCfg.authorizedOwners[0]) {
        return urlParams.webmap;
      }
    },
    getPortalUser: function() {
      var esriCookie = cookie('esri_auth');

      if(! esriCookie) {
        return;
      }

      esriCookie = JSON.parse(esriCookie.replace('"ssl":undefined','"ssl":""'));

      // Cookie has to be set on the same organization
      if(esriCookie.urlKey && esriCookie.customBaseUrl
          && (esriCookie.urlKey + '.' + esriCookie.customBaseUrl).toLowerCase() != document.location.hostname.toLowerCase()) {
        return;
      }

      return esriCookie ? esriCookie.email : null;
    },
    getCookieToken: function() {
      var esriCookie = cookie('esri_auth');

      if(! esriCookie) {
        return;
      }

      esriCookie = JSON.parse(esriCookie.replace('"ssl":undefined','"ssl":""'));

      // Cookie has to be set on the same organization
      if(esriCookie.urlKey && esriCookie.customBaseUrl
          && (esriCookie.urlKey + '.' + esriCookie.customBaseUrl).toLowerCase() != document.location.hostname.toLowerCase()) {
        return;
      }

      return esriCookie ? esriCookie.token : null;
    },
    userIsAppOwner: function() {
      var portalUser = app.portal ? app.portal.getPortalUser() : null,
          appItem = app.data.appItem ? app.data.appItem.item : null;

      return  (portalUser && appItem && portalUser.username == appItem.owner)
        || (this.getPortalUser() != null && appItem && this.getPortalUser() == appItem.owner)
        // Admin privilege
        || (portalUser && portalUser.privileges && $.inArray('portal:admin:updateItems', portalUser.privileges) > -1)
        || (appItem && appItem.itemControl == 'admin')
        // Group with shared ownership
        || (appItem && appItem.itemControl == 'update');
    },
    checkUserItemPrivileges: function() {
      var portalUser = app.portal ? app.portal.getPortalUser() : null;

      return (portalUser && ! portalUser.orgId && ! portalUser.privileges)
        || (portalUser && portalUser.privileges && $.inArray('portal:user:createItem', portalUser.privileges) > -1);
    },
    prependURLHTTP: function(url) {
      if (!url || url === '' || url.match(/^mailto:/)) {
        return url;
      }
      if (! /^(https?:\/\/)|^(\/\/)/i.test(url)) {
        return 'http://' + url;
      }

      return url;
    },
    throttle: function(fn, threshhold, scope) {
      threshhold || (threshhold = 250);
      var last,
          deferTimer;

      return function() {
        var context = scope || this;

        var now = +new Date,
            args = arguments;
        if (last && now < last + threshhold) {
          // hold on to it
          clearTimeout(deferTimer);
          deferTimer = setTimeout(function() {
            last = now;
            fn.apply(context, args);
          }, threshhold);
        }
        else {
          last = now;
          fn.apply(context, args);
        }
      };
    }
  };
});

;(function () {
	'use strict';

	/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */

	/*jslint browser:true, node:true*/
	/*global define, Event, Node*/


	/**
	 * Instantiate fast-clicking listeners on the specified layer.
	 *
	 * @constructor
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	function FastClick(layer, options) {
		var oldOnClick;

		options = options || {};

		/**
		 * Whether a click is currently being tracked.
		 *
		 * @type boolean
		 */
		this.trackingClick = false;


		/**
		 * Timestamp for when click tracking started.
		 *
		 * @type number
		 */
		this.trackingClickStart = 0;


		/**
		 * The element being tracked for a click.
		 *
		 * @type EventTarget
		 */
		this.targetElement = null;


		/**
		 * X-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartX = 0;


		/**
		 * Y-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartY = 0;


		/**
		 * ID of the last touch, retrieved from Touch.identifier.
		 *
		 * @type number
		 */
		this.lastTouchIdentifier = 0;


		/**
		 * Touchmove boundary, beyond which a click will be cancelled.
		 *
		 * @type number
		 */
		this.touchBoundary = options.touchBoundary || 10;


		/**
		 * The FastClick layer.
		 *
		 * @type Element
		 */
		this.layer = layer;

		/**
		 * The minimum time between tap(touchstart and touchend) events
		 *
		 * @type number
		 */
		this.tapDelay = options.tapDelay || 200;

		/**
		 * The maximum time for a tap
		 *
		 * @type number
		 */
		this.tapTimeout = options.tapTimeout || 700;

		if (FastClick.notNeeded(layer)) {
			return;
		}

		// Some old versions of Android don't have Function.prototype.bind
		function bind(method, context) {
			return function() { return method.apply(context, arguments); };
		}


		var methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];
		var context = this;
		for (var i = 0, l = methods.length; i < l; i++) {
			context[methods[i]] = bind(context[methods[i]], context);
		}

		// Set up event handlers as required
		if (deviceIsAndroid) {
			layer.addEventListener('mouseover', this.onMouse, true);
			layer.addEventListener('mousedown', this.onMouse, true);
			layer.addEventListener('mouseup', this.onMouse, true);
		}

		layer.addEventListener('click', this.onClick, true);
		layer.addEventListener('touchstart', this.onTouchStart, false);
		layer.addEventListener('touchmove', this.onTouchMove, false);
		layer.addEventListener('touchend', this.onTouchEnd, false);
		layer.addEventListener('touchcancel', this.onTouchCancel, false);

		// Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
		// which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick
		// layer when they are cancelled.
		if (!Event.prototype.stopImmediatePropagation) {
			layer.removeEventListener = function(type, callback, capture) {
				var rmv = Node.prototype.removeEventListener;
				if (type === 'click') {
					rmv.call(layer, type, callback.hijacked || callback, capture);
				} else {
					rmv.call(layer, type, callback, capture);
				}
			};

			layer.addEventListener = function(type, callback, capture) {
				var adv = Node.prototype.addEventListener;
				if (type === 'click') {
					adv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {
						if (!event.propagationStopped) {
							callback(event);
						}
					}), capture);
				} else {
					adv.call(layer, type, callback, capture);
				}
			};
		}

		// If a handler is already declared in the element's onclick attribute, it will be fired before
		// FastClick's onClick handler. Fix this by pulling out the user-defined handler function and
		// adding it as listener.
		if (typeof layer.onclick === 'function') {

			// Android browser on at least 3.2 requires a new reference to the function in layer.onclick
			// - the old one won't work if passed to addEventListener directly.
			oldOnClick = layer.onclick;
			layer.addEventListener('click', function(event) {
				oldOnClick(event);
			}, false);
			layer.onclick = null;
		}
	}

	/**
	* Windows Phone 8.1 fakes user agent string to look like Android and iPhone.
	*
	* @type boolean
	*/
	var deviceIsWindowsPhone = navigator.userAgent.indexOf("Windows Phone") >= 0;

	/**
	 * Android requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0 && !deviceIsWindowsPhone;


	/**
	 * iOS requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !deviceIsWindowsPhone;


	/**
	 * iOS 4 requires an exception for select elements.
	 *
	 * @type boolean
	 */
	var deviceIsIOS4 = deviceIsIOS && (/OS 4_\d(_\d)?/).test(navigator.userAgent);


	/**
	 * iOS 6.0-7.* requires the target element to be manually derived
	 *
	 * @type boolean
	 */
	var deviceIsIOSWithBadTarget = deviceIsIOS && (/OS [6-7]_\d/).test(navigator.userAgent);

	/**
	 * BlackBerry requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;

	/**
	 * Determine whether a given element requires a native click.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element needs a native click
	 */
	FastClick.prototype.needsClick = function(target) {
		switch (target.nodeName.toLowerCase()) {

		// Don't send a synthetic click to disabled inputs (issue #62)
		case 'button':
		case 'select':
		case 'textarea':
			if (target.disabled) {
				return true;
			}

			break;
		case 'input':

			// File inputs need real clicks on iOS 6 due to a browser bug (issue #68)
			if ((deviceIsIOS && target.type === 'file') || target.disabled) {
				return true;
			}

			break;
		case 'label':
		case 'iframe': // iOS8 homescreen apps can prevent events bubbling into frames
		case 'video':
			return true;
		}

		return (/\bneedsclick\b/).test(target.className);
	};


	/**
	 * Determine whether a given element requires a call to focus to simulate click into element.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.
	 */
	FastClick.prototype.needsFocus = function(target) {
		switch (target.nodeName.toLowerCase()) {
		case 'textarea':
			return true;
		case 'select':
			return !deviceIsAndroid;
		case 'input':
			switch (target.type) {
			case 'button':
			case 'checkbox':
			case 'file':
			case 'image':
			case 'radio':
			case 'submit':
				return false;
			}

			// No point in attempting to focus disabled inputs
			return !target.disabled && !target.readOnly;
		default:
			return (/\bneedsfocus\b/).test(target.className);
		}
	};


	/**
	 * Send a click event to the specified element.
	 *
	 * @param {EventTarget|Element} targetElement
	 * @param {Event} event
	 */
	FastClick.prototype.sendClick = function(targetElement, event) {
		var clickEvent, touch;

		// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)
		if (document.activeElement && document.activeElement !== targetElement) {
			document.activeElement.blur();
		}

		touch = event.changedTouches[0];

		// Synthesise a click event, with an extra attribute so it can be tracked
		clickEvent = document.createEvent('MouseEvents');
		clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
		clickEvent.forwardedTouchEvent = true;
		targetElement.dispatchEvent(clickEvent);
	};

	FastClick.prototype.determineEventType = function(targetElement) {

		//Issue #159: Android Chrome Select Box does not open with a synthetic click event
		if (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {
			return 'mousedown';
		}

		return 'click';
	};


	/**
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.focus = function(targetElement) {
		var length;

		// Issue #160: on iOS 7, some input elements (e.g. date datetime month) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.
		if (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time' && targetElement.type !== 'month') {
			length = targetElement.value.length;
			targetElement.setSelectionRange(length, length);
		} else {
			targetElement.focus();
		}
	};


	/**
	 * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.
	 *
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.updateScrollParent = function(targetElement) {
		var scrollParent, parentElement;

		scrollParent = targetElement.fastClickScrollParent;

		// Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the
		// target element was moved to another parent.
		if (!scrollParent || !scrollParent.contains(targetElement)) {
			parentElement = targetElement;
			do {
				if (parentElement.scrollHeight > parentElement.offsetHeight) {
					scrollParent = parentElement;
					targetElement.fastClickScrollParent = parentElement;
					break;
				}

				parentElement = parentElement.parentElement;
			} while (parentElement);
		}

		// Always update the scroll top tracker if possible.
		if (scrollParent) {
			scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;
		}
	};


	/**
	 * @param {EventTarget} targetElement
	 * @returns {Element|EventTarget}
	 */
	FastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {

		// On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.
		if (eventTarget.nodeType === Node.TEXT_NODE) {
			return eventTarget.parentNode;
		}

		return eventTarget;
	};


	/**
	 * On touch start, record the position and scroll offset.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchStart = function(event) {
		var targetElement, touch, selection;

		// Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).
		if (event.targetTouches.length > 1) {
			return true;
		}

		targetElement = this.getTargetElementFromEventTarget(event.target);
		touch = event.targetTouches[0];

		if (deviceIsIOS) {

			// Only trusted events will deselect text on iOS (issue #49)
			selection = window.getSelection();
			if (selection.rangeCount && !selection.isCollapsed) {
				return true;
			}

			if (!deviceIsIOS4) {

				// Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):
				// when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched
				// with the same identifier as the touch event that previously triggered the click that triggered the alert.
				// Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an
				// immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.
				// Issue 120: touch.identifier is 0 when Chrome dev tools 'Emulate touch events' is set with an iOS device UA string,
				// which causes all touch events to be ignored. As this block only applies to iOS, and iOS identifiers are always long,
				// random integers, it's safe to to continue if the identifier is 0 here.
				if (touch.identifier && touch.identifier === this.lastTouchIdentifier) {
					event.preventDefault();
					return false;
				}

				this.lastTouchIdentifier = touch.identifier;

				// If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:
				// 1) the user does a fling scroll on the scrollable layer
				// 2) the user stops the fling scroll with another tap
				// then the event.target of the last 'touchend' event will be the element that was under the user's finger
				// when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check
				// is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).
				this.updateScrollParent(targetElement);
			}
		}

		this.trackingClick = true;
		this.trackingClickStart = event.timeStamp;
		this.targetElement = targetElement;

		this.touchStartX = touch.pageX;
		this.touchStartY = touch.pageY;

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			event.preventDefault();
		}

		return true;
	};


	/**
	 * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.touchHasMoved = function(event) {
		var touch = event.changedTouches[0], boundary = this.touchBoundary;

		if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {
			return true;
		}

		return false;
	};


	/**
	 * Update the last position.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchMove = function(event) {
		if (!this.trackingClick) {
			return true;
		}

		// If the touch has moved, cancel the click tracking
		if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {
			this.trackingClick = false;
			this.targetElement = null;
		}

		return true;
	};


	/**
	 * Attempt to find the labelled control for the given label element.
	 *
	 * @param {EventTarget|HTMLLabelElement} labelElement
	 * @returns {Element|null}
	 */
	FastClick.prototype.findControl = function(labelElement) {

		// Fast path for newer browsers supporting the HTML5 control attribute
		if (labelElement.control !== undefined) {
			return labelElement.control;
		}

		// All browsers under test that support touch events also support the HTML5 htmlFor attribute
		if (labelElement.htmlFor) {
			return document.getElementById(labelElement.htmlFor);
		}

		// If no for attribute exists, attempt to retrieve the first labellable descendant element
		// the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label
		return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');
	};


	/**
	 * On touch end, determine whether to send a click event at once.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchEnd = function(event) {
		var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;

		if (!this.trackingClick) {
			return true;
		}

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			this.cancelNextClick = true;
			return true;
		}

		if ((event.timeStamp - this.trackingClickStart) > this.tapTimeout) {
			return true;
		}

		// Reset to prevent wrong click cancel on input (issue #156).
		this.cancelNextClick = false;

		this.lastClickTime = event.timeStamp;

		trackingClickStart = this.trackingClickStart;
		this.trackingClick = false;
		this.trackingClickStart = 0;

		// On some iOS devices, the targetElement supplied with the event is invalid if the layer
		// is performing a transition or scroll, and has to be re-detected manually. Note that
		// for this to function correctly, it must be called *after* the event target is checked!
		// See issue #57; also filed as rdar://13048589 .
		if (deviceIsIOSWithBadTarget) {
			touch = event.changedTouches[0];

			// In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null
			targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;
			targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;
		}

		targetTagName = targetElement.tagName.toLowerCase();
		if (targetTagName === 'label') {
			forElement = this.findControl(targetElement);
			if (forElement) {
				this.focus(targetElement);
				if (deviceIsAndroid) {
					return false;
				}

				targetElement = forElement;
			}
		} else if (this.needsFocus(targetElement)) {

			// Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.
			// Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).
			if ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {
				this.targetElement = null;
				return false;
			}

			this.focus(targetElement);
			this.sendClick(targetElement, event);

			// Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.
			// Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)
			if (!deviceIsIOS || targetTagName !== 'select') {
				this.targetElement = null;
				event.preventDefault();
			}

			return false;
		}

		if (deviceIsIOS && !deviceIsIOS4) {

			// Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled
			// and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).
			scrollParent = targetElement.fastClickScrollParent;
			if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {
				return true;
			}
		}

		// Prevent the actual click from going though - unless the target node is marked as requiring
		// real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.
		if (!this.needsClick(targetElement)) {
			event.preventDefault();
			this.sendClick(targetElement, event);
		}

		return false;
	};


	/**
	 * On touch cancel, stop tracking the click.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.onTouchCancel = function() {
		this.trackingClick = false;
		this.targetElement = null;
	};


	/**
	 * Determine mouse events which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onMouse = function(event) {

		// If a target element was never set (because a touch event was never fired) allow the event
		if (!this.targetElement) {
			return true;
		}

		if (event.forwardedTouchEvent) {
			return true;
		}

		// Programmatically generated events targeting a specific element should be permitted
		if (!event.cancelable) {
			return true;
		}

		// Derive and check the target element to see whether the mouse event needs to be permitted;
		// unless explicitly enabled, prevent non-touch click events from triggering actions,
		// to prevent ghost/doubleclicks.
		if (!this.needsClick(this.targetElement) || this.cancelNextClick) {

			// Prevent any user-added listeners declared on FastClick element from being fired.
			if (event.stopImmediatePropagation) {
				event.stopImmediatePropagation();
			} else {

				// Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
				event.propagationStopped = true;
			}

			// Cancel the event
			event.stopPropagation();
			event.preventDefault();

			return false;
		}

		// If the mouse event is permitted, return true for the action to go through.
		return true;
	};


	/**
	 * On actual clicks, determine whether this is a touch-generated click, a click action occurring
	 * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or
	 * an actual click which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onClick = function(event) {
		var permitted;

		// It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.
		if (this.trackingClick) {
			this.targetElement = null;
			this.trackingClick = false;
			return true;
		}

		// Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.
		if (event.target.type === 'submit' && event.detail === 0) {
			return true;
		}

		permitted = this.onMouse(event);

		// Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.
		if (!permitted) {
			this.targetElement = null;
		}

		// If clicks are permitted, return true for the action to go through.
		return permitted;
	};


	/**
	 * Remove all FastClick's event listeners.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.destroy = function() {
		var layer = this.layer;

		if (deviceIsAndroid) {
			layer.removeEventListener('mouseover', this.onMouse, true);
			layer.removeEventListener('mousedown', this.onMouse, true);
			layer.removeEventListener('mouseup', this.onMouse, true);
		}

		layer.removeEventListener('click', this.onClick, true);
		layer.removeEventListener('touchstart', this.onTouchStart, false);
		layer.removeEventListener('touchmove', this.onTouchMove, false);
		layer.removeEventListener('touchend', this.onTouchEnd, false);
		layer.removeEventListener('touchcancel', this.onTouchCancel, false);
	};


	/**
	 * Check whether FastClick is needed.
	 *
	 * @param {Element} layer The layer to listen on
	 */
	FastClick.notNeeded = function(layer) {
		var metaViewport;
		var chromeVersion;
		var blackberryVersion;
		var firefoxVersion;

		// Devices that don't support touch don't need FastClick
		if (typeof window.ontouchstart === 'undefined') {
			return true;
		}

		// Chrome version - zero for other browsers
		chromeVersion = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (chromeVersion) {

			if (deviceIsAndroid) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// Chrome on Android with user-scalable="no" doesn't need FastClick (issue #89)
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// Chrome 32 and above with width=device-width or less don't need FastClick
					if (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}

			// Chrome desktop doesn't need FastClick (issue #15)
			} else {
				return true;
			}
		}

		if (deviceIsBlackBerry10) {
			blackberryVersion = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);

			// BlackBerry 10.3+ does not require Fastclick library.
			// https://github.com/ftlabs/fastclick/issues/251
			if (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// user-scalable=no eliminates click delay.
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// width=device-width (or less than device-width) eliminates click delay.
					if (document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}
			}
		}

		// IE10 with -ms-touch-action: none or manipulation, which disables double-tap-to-zoom (issue #97)
		if (layer.style.msTouchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		// Firefox version - zero for other browsers
		firefoxVersion = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (firefoxVersion >= 27) {
			// Firefox 27+ does not have tap delay if the content is not zoomable - https://bugzilla.mozilla.org/show_bug.cgi?id=922896

			metaViewport = document.querySelector('meta[name=viewport]');
			if (metaViewport && (metaViewport.content.indexOf('user-scalable=no') !== -1 || document.documentElement.scrollWidth <= window.outerWidth)) {
				return true;
			}
		}

		// IE11: prefixed -ms-touch-action is no longer supported and it's recomended to use non-prefixed version
		// http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx
		if (layer.style.touchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		return false;
	};


	/**
	 * Factory method for creating a FastClick object
	 *
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	FastClick.attach = function(layer, options) {
		return new FastClick(layer, options);
	};


	if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {

		// AMD. Register as an anonymous module.
		define('lib/fastclick/lib/fastclick',[],function() {
			return FastClick;
		});
	} else if (typeof module !== 'undefined' && module.exports) {
		module.exports = FastClick.attach;
		module.exports.FastClick = FastClick;
	} else {
		window.FastClick = FastClick;
	}
}());

/*
| Copyright 2016 Esri
|
| Licensed under the Apache License, Version 2.0 (the "License");
| you may not use this file except in compliance with the License.
| You may obtain a copy of the License at
|
|    http://www.apache.org/licenses/LICENSE-2.0
|
| Unless required by applicable law or agreed to in writing, software
| distributed under the License is distributed on an "AS IS" BASIS,
| WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
| See the License for the specific language governing permissions and
| limitations under the License.
*/

define('storymaps/common/Core',[
  'lib-build/css!lib/calcite-bootstrap/css/calcite-bootstrap-open.min',
  'lib-build/less!./ui/bootstrap-override',

  'lib-build/css!../../lib/font-awesome/css/font-awesome',

  'lib-build/css!./Core',
  'lib-build/less!./Core',

  'esri/map',
  'esri/arcgis/Portal',
  'esri/arcgis/utils',
  './utils/CommonHelper',
  'esri/urlUtils',

  // Builder
  //'./builder/MyStoriesWrapper',

  // Utils
  'dojo/has',
  'esri/IdentityManager',
  'esri/arcgis/OAuthInfo',
  'esri/config',
  'esri/tasks/GeometryService',
  'esri/request',
  'dojo/topic',
  'dojo/on',
  'dojo/_base/lang',
  'dojo/_base/array',
  'dojo/_base/kernel',
  'dojo/Deferred',
  'dojo/DeferredList',
  'dojo/query',

  'lib/fastclick/lib/fastclick'
], function(
  bootstrapCss,
  bootstrapOverrideCss,

  fontAwesomeCss,

  viewCss,
  viewLess,

  Map,
  arcgisPortal,
  arcgisUtils,
  CommonHelper,
  urlUtils,

  //MyStoriesWrapper,

  has,
  IdentityManager,
  ArcGISOAuthInfo,
  esriConfig,
  GeometryService,
  esriRequest,
  topic,
  on,
  lang,
  array,
  kernel,
  Deferred,
  DeferredList,
  query,

  FastClick
) {
  // Value is replaced with TPL_ENV_PRODUCTION during build
  var CONFIG = { environment: 'TPL_ENV_PRODUCTION' },
      _mainView = null,
      _builder = null,
      _urlParams = CommonHelper.getUrlParams();

  //
  // Initialization
  //

  function init(mainView, builder) {
    console.log('common.core.Core - init', builder);

    _mainView = mainView;
    _builder = builder;

    app.userCanEdit = false;

    initLocalization();

    // If browser doesn't support history and it's direct or gallery mode where the URL will have to be rewritten later
    // Redirect to a URL that the browser will be able to overwrite
    // And put a token so that we don't loop in here
    /*
    if (! CommonHelper.browserSupportHistory() && (isDirectCreation || isGalleryCreation) && _urlParams.ieredirected == null) {
      window.location = document.location.protocol + '//' + document.location.host + document.location.pathname + '#' + document.location.search + '&ieredirected';
    }
    */

    // Ignore index.html configuration on AGOL/Portal
    if (CommonHelper.isArcGISHosted()) {
      app.indexCfg = { };
    }
    // Keep only some properties in development
    else if (!isProd()) {
      app.indexCfg = {
        proxyurl: app.indexCfg.proxyurl,
        sharingurl: app.indexCfg.sharingurl,
        username: app.indexCfg.username,
        password: app.indexCfg.password,
        oAuthAppId: app.indexCfg.oAuthAppId,
        story: app.indexCfg.story
      };
    }

    // Check the config file
    /*
    if (! _mainView.checkConfigFileIsOK()) {
      initError('invalidConfig');
      return;
    }
    */

    // Init UI

    document.title = app.cfg.TPL_NAME;

    //
    // Instantiate FastClick to make the app more responsive except on the map due to conflict with popup charts
    //

    if (has('touch')) {
      $('body').addClass('hasTouch');
    }

    // TODO
    FastClick.prototype._needsClick = FastClick.prototype.needsClick;
    FastClick.prototype.needsClick = function(target) {
      if ($(target).parents('.esriPopup').length) {
        return true;
      }
      return FastClick.prototype._needsClick.call(this, target);
    };

    FastClick.attach(document.body);

    // App is embedded
    if (window != window.top /*|| _urlParams.forceEmbed !== undefined || app.indexCfg.forceEmbed*/) {
      $('body').addClass('isEmbed');
    }

    lang.mixin(app, {
      data: {},
      appCfg: {
        supportWebmapPreviewAGOL: false,
        useWebmapInApp: false,
        useStandardHeader: false,
        useAppTitleAsPageTitle: false
      },
      portal: null,
      builder: builder,
      isLoading: true,
      loadingTimeout: null
    });

    if (app.isInBuilder && (has('ie') || has('trident') || has('ff'))) {
      $('#fatalError .error-title').html('Sorry!');
      $('#fatalError .error-msg').html('Story Map Cascade is in beta and its builder is supported only in <a href="https://www.google.com/chrome/" target="_blank">Chrome</a> and <a href="https://www.apple.com/safari/" target="_blank">Safari</a>. Cascade stories that you create and share will work on those browsers and Internet Explorer 11+ and Firefox.');
      $('#fatalError').show();
      return;
    }

    if (app.isInBuilder && has('ipad')) {
      $('#fatalError .error-title').html('Sorry!');
      $('#fatalError .error-msg').html('Story Map Cascade is in beta and its builder is not supported on iPad. Cascade stories that you create and share will work on iPad.');
      $('#fatalError').show();
      return;
    }

    if (has('ie') < 11) {
      $('#fatalError .error-title').html('Sorry!');
      $('#fatalError .error-msg').html('This story is not supported in Internet Explorer before version 11. <a href="http://browsehappy.com/" target="_blank">Please update your browser</a>');
      $('#fatalError').show();
      return;
    }

    on(IdentityManager, 'dialog-create', function() {
      if (app.isLoading) {
        initError('invalidConfignoOAuth');
      }
    });

    // Remove preview from the URL
    topic.subscribe('tpl-ready', function() {
      var urlParams = document.location.search;
      if (urlParams) {
        urlParams = urlParams.replace('&preview', '');
      }

      window.history.replaceState({}, '', 'index.html' + urlParams + document.location.hash);
    });

    // Prepare an error message in builder for small screens
    if (app.isInBuilder) {
      // Touch device
      var errMsg = 'notConfiguredMobile';

      if (has('touch')) {
        // in portrait mode with enough room in landscape for builder
        if (window.innerHeight > window.innerWidth) {
          if (window.innerHeight > 768) {
            errMsg = 'notConfiguredMobile2';
          }
        }
        // in landscape mode with enough room to fit builder but prepare in case of orientation change
        else {
          if (window.innerWidth > 768) {
            errMsg = 'notConfiguredMobile2';
          }
        }
      }

      initError(errMsg, null, true);
    }

    if (! _mainView.init(this)) {
      return;
    }

    startLoadingTimeout();

    // Sharing URL
    if (! app.indexCfg.sharingurl) {
      // Determine if hosted or on a Portal
      var appLocation = document.location.pathname.indexOf('/apps/');

      if (appLocation == -1) {
        appLocation = document.location.pathname.indexOf('/home/');
      }

      if (appLocation != -1) {
        // Get the portal instance name
        var instance = location.pathname.substr(0,appLocation);

        app.indexCfg.sharingurl = '//' + location.host + instance + '/sharing/content/items';
        app.indexCfg.proxyurl = '//' + location.host + instance + '/sharing/proxy';
      }
      else {
        app.indexCfg.sharingurl = app.cfg.DEFAULT_SHARING_URL;
      }
    }

    if (app.indexCfg.sharingurl.match(/^http/)) {
      arcgisUtils.arcgisUrl = app.indexCfg.sharingurl;
    }
    else {
      arcgisUtils.arcgisUrl = location.protocol + app.indexCfg.sharingurl;
    }

    // Proxy URL
    if (! app.indexCfg.proxyurl) {
      app.indexCfg.proxyurl = app.cfg.DEFAULT_PROXY_URL;
    }
    esriConfig.defaults.io.proxyUrl = location.protocol + app.indexCfg.proxyurl;

    // Allow IE9 to save over HTTP
    if (IdentityManager) {
      IdentityManager.setProtocolErrorHandler(function() {
        return true;
      });
    }

    // USE CORS to save the web app configuration during developement
    if (app.isInBuilder && app.cfg.CORS_SERVER) {
      $.each(app.cfg.CORS_SERVER, function(i, server) {
        esriConfig.defaults.io.corsEnabledServers.push(server);
      });
    }

    // Proxy rules
    if (app.cfg.PROXY_RULES && app.cfg.PROXY_RULES.length) {
      $.each(app.cfg.PROXY_RULES, function(i, rule) {
        if (rule && rule.urlPrefix && rule.proxyUrl) {
          urlUtils.addProxyRule(rule);
        }
      });
    }

    // Set timeout depending on the application mode
    esriConfig.defaults.io.timeout = app.isInBuilder ? app.cfg.TIMEOUT_BUILDER_REQUEST : app.cfg.TIMEOUT_VIEWER_REQUEST;

    // Fix for multiple twitter bootstrap popup to be open simultaneously
    $.fn.modal.Constructor.prototype.enforceFocus = function() { };

    // Disable form submit on enter key
    $('form').bind('keydown', function(e) {
      if (e.keyCode == 13) {
        return false;
      }
    });

    topic.subscribe('CORE_UPDATE_EXTENT', setMapExtent);

    // Load the Portal
    app.portal = new arcgisPortal.Portal(app.indexCfg.sharingurl.split('/sharing/')[0]);
    app.portal.on('load', function(response) {
      app.isPortal = !! response.isPortal;

      definePortalConfig();

      // If app is configured to use OAuth
      if (app.indexCfg.oAuthAppId) {
        var info = new ArcGISOAuthInfo({
          appId: app.indexCfg.oAuthAppId,
          popup: false,
          portalUrl: 'https:' + app.indexCfg.sharingurl.split('/sharing/')[0]
        });

        IdentityManager.registerOAuthInfos([info]);

        IdentityManager.checkSignInStatus(info.portalUrl).then(
          function() {
            // User has signed-in using oAuth
            if (! builder) {
              portalLogin().then(initStep2);
            }
            else {
              portalLogin().then(initStep2);
            }
          },
          function() {
            // Not signed-in, redirecting to OAuth sign-in page
            IdentityManager.getCredential(info.portalUrl);
          }
        );
      }
      else {
        initStep2();
      }
    });
  }

  function initStep2() {
    console.log('common.core.Core - initStep2');

    var appId = CommonHelper.getAppID(isProd()),
        webmapId = CommonHelper.getWebmapID(isProd()),
        supportWebmapPreviewAGOL = !! (app.appCfg ? app.appCfg.supportWebmapPreviewAGOL : true);

    //if (app.isInBuilder )

    // Load using static config file
    var configName = app.indexCfg.story || CommonHelper.getUrlParams().story;
    if (configName) {
      if (! isProd()) {
        setTimeout(function() {
          _mainView.getConfig(configName);
        }, 1000);
        return;
      }
      else {
        _mainView.getConfig(configName);
        return;
      }
    }

    // Load using a Web Mapping Application item
    if (appId) {
      loadWebMappingApp(appId);
      return;
    }

    // Webmap and template doesn't support preview when hosted in AGOL
    if (webmapId && ! supportWebmapPreviewAGOL) {
      if (CommonHelper.isArcGISHosted()) {
        redirectToExternalHelp();
      }
      else {
        loadWebMap(webmapId);
      }

      return;
    }

    // Direct creation and not signed-in
    if (app.isInBuilder && _builder.isDirectCreation && isProd() && ! (CommonHelper.getPortalUser() || app.portal.getPortalUser())) {
      redirectToSignIn();
      return;
    }

    // Direct creation and signed in
    if (app.isInBuilder && _builder.isDirectCreation) {
      portalLogin().then(function() {
        initializeUI();
        appInitComplete();
      });
      return;
    }

    if (CommonHelper.isArcGISHosted()) {
      redirectToExternalHelp();
    }
    else if (_urlParams.appid && (! app.indexCfg.authorizedOwners || ! app.indexCfg.authorizedOwners[0])) {
      initError('unspecifiedConfigOwner');
    }
    else if (! app.isProduction) {
      initError('invalidConfigNoAppDev');
    }
    else {
      initError('invalidConfigNoApp');
    }
  }

  function loadWebMappingApp(appId) {
    console.log('common.core.Core - loadWebMappingApp - appId:', appId);

    var forceLogin = _urlParams.forceLogin !== undefined;

    // If forceLogin parameter in URL OR builder
    if (forceLogin || app.isInBuilder) {
      portalLogin().then(
        function() {
          loadWebMappingAppStep2(appId);
        },
        function() {
          initError('notAuthorized');
        }
      );
    }
    // Production in view mode
    else {
      loadWebMappingAppStep2(appId);
    }
  }

  function loadWebMappingAppStep2(appId) {
    arcgisUtils.getItem(appId).then(
      function(response) {
        if (! response) {
          initError('appLoadingFail');
          return;
        }

        var itemRq = response.item,
            dataRq = response.itemData;

        app.data.appItem = {
          item: itemRq,
          data: dataRq
        };

        app.userCanEdit = CommonHelper.userIsAppOwner();

        // Prevent app from accessing the cookie in viewer when user is not the owner
        if (! app.isInBuilder && ! app.userCanEdit) {
          if (! document.__defineGetter__) {
            Object.defineProperty(document, 'cookie', {
              get: function() {
                return '';
              },
              set: function() {
                return true;
              }
            });
          }
          else {
            document.__defineGetter__('cookie', function() {
              return '';
            });
            document.__defineSetter__('cookie', function() {
            });
          }
        }

        if (app.indexCfg.authorizedOwners && app.indexCfg.authorizedOwners.length > 0 && app.indexCfg.authorizedOwners[0]) {
          var owner = itemRq.owner,
              ownerFound = false;

          if (owner) {
            ownerFound = $.inArray(owner, app.indexCfg.authorizedOwners) != -1;
          }

          if (! ownerFound && app.indexCfg.authorizedOwners[0] == '*') {
            ownerFound = true;
          }

          if (! ownerFound) {
            $.each(app.indexCfg.authorizedOwners, function(i, owner) {
              var test = owner.match(/^\[(.*)\]$/);

              if (test) {
                if (itemRq.orgId == test[1]) {
                  ownerFound = true;
                }
              }
            });
          }

          if (! ownerFound) {
            initError('invalidConfigOwner');
            return;
          }
        }

        // App proxies
        if (itemRq && itemRq.appProxies) {
          var layerMixins = array.map(itemRq.appProxies, function(p) {
            return {
              url: p.sourceUrl,
              mixin: {
                url: p.proxyUrl
              }
            };
          });

          app.data.appProxies = layerMixins;
        }

        // If in builder, check that user is app owner or org admin
        if (app.isInBuilder && isProd() && !app.userCanEdit) {
          initError('notAuthorized');
          return;
        }

        var isStoryBlank = _mainView.isStoryBlank();

        if (! isStoryBlank) {
          appInitComplete();
        }
        else if (app.isInBuilder) {
          appInitComplete();
        }
        // No data in view mode
        else if(CommonHelper.getAppID(isProd())) {
          if(app.userCanEdit) {
            //app.ui.loadingIndicator.setMessage(i18n.viewer.loading.loadBuilder);
            //setTimeout(function(){
            CommonHelper.switchToBuilder();
            //}, 1200);
          }
          else {
            initError('notConfiguredDesktop');
          }
        }
        // No data in preview mode (should not happen)
        else {
          initError('noLayer');
        }
      },
      function(error) {
        if (error && error.httpCode == 400) {
          initError('invalidApp');
        }
        else if (error && error.httpCode == 403) {
          initError('notAuthorized');
        }
        else {
          initError('appLoadingFail');
        }
      }
    );
  }

  function portalLogin() {
    var resultDeferred = new Deferred();

    app.portal.signIn().then(
      function() {

        // If in builder, check that user is user can create/edit item
        if (app.isInBuilder && ! CommonHelper.checkUserItemPrivileges()) {
          initError('notAuthorizedBuilder');
          return;
        }

        app.userCanEdit = CommonHelper.userIsAppOwner();

        definePortalConfig();
        resultDeferred.resolve();
      },
      function() {
        resultDeferred.reject();
      }
    );

    return resultDeferred;
  }

  function loadWebMap(webmapIdOrJSON) {
    _mainView.loadFirstWebmap(webmapIdOrJSON).then(
      lang.hitch(this, function(response) {
        webMapInitCallback(response);
      }),
      lang.hitch(this, function() {
        initError('createMap');
      })
    );
  }

  function webMapInitCallback(/*response*/) {
    console.log('common.core.Core - webMapInitCallback');

    console.error('FATAL ERROR');
    return;
    /*
    app.maps[response.itemInfo.item.id] = _mainView.getMapConfig(response);
    app.map = response.map;
    app.data.setWebMap(response.itemInfo);

    app.map.disableKeyboardNavigation();

    initializeUI();

    _mainView.firstWebmapLoaded();
    */
  }

  function redirectToExternalHelp() {
    window.location = app.isPortal && app.cfg.HELP_URL_PORTAL ? app.cfg.HELP_URL_PORTAL : app.cfg.HELP_URL;
  }

  function initializeUI() {
    //app.ui.loadingIndicator.setMessage(i18n.viewer.loading.step3);

    // Initialize header
    // Title/subtitle are the first valid string from: index.html config object, web application data, web map data
    // TODO
    var title = app.data.title;

    if (app.appCfg.useAppTitleAsPageTitle) {
      document.title = title ? $('<div>' + title + '</div>').text() : app.cfg.TPL_NAME;
    }
  }

  function appInitComplete() {
    console.log('common.core.Core - initApp');

    if (_mainView.isStoryBlank() && app.isInBuilder) {
      app.builder.appInitComplete();
      _mainView.appInitComplete();
    }
    else if (app.isInBuilder) {
      _mainView.appInitComplete();
      app.builder.appInitComplete();
    }
    else {
      _mainView.appInitComplete();
    }

    // Load My Stories in builder or viewer if user is owning the story
    if ((app.isInBuilder || app.userCanEdit) && has('ie') != 9 && ! _urlParams.preview) {
      if (has('ff')) {
        $('.builderShare #my-stories-frame').remove();
      }

      if (has('ff') || ! app.isInBuilder) {
        //$('body').append('<div id="my-stories-hidden-container"><iframe id="my-stories-frame"></iframe></div>');
      }

      //MyStoriesWrapper.loadMyStories();
    }

    // Update URL for hosted apps so that when shared it will have the proper metadata on social medias
    if (document.location.pathname.match(/\/apps\/[a-zA-Z]+\/$/)
        && document.location.search.match(/^\?appid=/)
        && (! has('ie') || has('ie') >= 10)) {
      window.history.replaceState({}, '', 'index.html' + document.location.search + document.location.hash);
    }
  }

  function initError(error, message, noDisplay) {
    var errorMsg = i18n.viewer.errors[error];

    cleanLoadingTimeout();
    $('#loadingIndicator').hide();

    errorMsg = errorMsg.replace(/{TPL_NAME}/g, app.cfg.TPL_NAME);

    if (error == 'notAuthorized' && app.indexCfg.oAuthAppId) {
      errorMsg += '<div><button class="btn btn-sm btn-default" onclick="esri.id.destroyCredentials(); window.location.reload();">' + i18n.viewer.errors.signOut + '</button></div>';
    }

    if (error == 'appLoadingFail') {
      $('#loadingMessage').html(
        '<div id="loadingRetry">'
        + ' <button type="button" class="btn btn-naked btn-sm" onclick="document.location.reload()">'
        + i18n.viewer.loading.failButton
        + ' </button>'
        + '</div>'
      ).hide().fadeIn(1200, function() {
        $('#loadingMessage').addClass('loaded');
      });
    }
    else {
      $('#loadingMessage').hide();
    }

    $('#fatalError .error-msg').html(errorMsg);

    if (! noDisplay) {
      $('#fatalError').show();
    }
  }

  function replaceInitErrorMessage(error) {
    $('#fatalError .error-msg').html(i18n.viewer.errors[error]);
  }

  //
  // Map navigation
  //

  function setMapExtent(extent) {
    if (! extent || ! extent.spatialReference || ! app.map || ! app.map.extent.spatialReference || ! app.map.spatialReference) {
      var r = new Deferred();

      r.resolve();
      return r;
    }

    if (app.map.spatialReference.wkid == extent.spatialReference.wkid) {
      return app.map.setExtent(extent/*, true*/); /* TODO */
    }
    else {
      var resultDeferred = new Deferred();

      esriConfig.defaults.geometryService.project([extent], app.map.spatialReference, function(features) {
        if (! features || ! features[0]) {
          return;
        }

        app.map.setExtent(features[0]/*, true*/); /* TODO */
        resultDeferred.resolve();
      });
      return resultDeferred;
    }
  }

  function zoomToDeviceLocation(success, geom) {
    if (success) {
      if (app.map.spatialReference.wkid != 102100 && app.map.spatialReference.wkid != 4326) {
        esriConfig.defaults.geometryService.project([geom], app.map.spatialReference, function(features) {
          if (! features || ! features[0]) {
            return;
          }

          if (! app.map.extent.contains(features[0])) {
            app.map.centerAt(features[0]);
          }
        });
      }
      else if (! app.map.extent.contains(geom)) {
        app.map.centerAt(geom);
      }
    }
  }

  //
  // UI
  //

  function hasSwitchBuilderButton() {
    return ! app.isInBuilder && (
      (! isProd() && !! CommonHelper.getAppID(isProd()))
      || isProd() && app.userCanEdit)
      && (_urlParams.preview === undefined || _urlParams.preview == 'false');
  }

  function redirectToSignIn() {
    window.location = arcgisUtils.arcgisUrl.split('/sharing/')[0]
      + '/home/signin.html?returnUrl='
      + encodeURIComponent(document.location.href);
  }

  /*
  function redirectToBuilderFromGallery() {
    // TODO display another redirect message
    //app.ui.loadingIndicator.setMessage(i18n.viewer.loading.loadBuilder);
    //setTimeout(function(){
    window.location = document.location.href + '&fromGallery';
    //}, 1200);
  }
  */

  //
  // App init
  //

  function startLoadingTimeout() {
    app.loadingTimeout = setTimeout(appLoadingTimeout, app.cfg.TIMEOUT_VIEWER_LOAD);
  }

  function cleanLoadingTimeout() {
    if (typeof app != 'undefined' && app.loadingTimeout) {
      clearTimeout(app.loadingTimeout);
      app.loadingTimeout = null;
    }
  }

  function appLoadingTimeout() {
    // Restart the timeout if the dialog is shown or has been shown and the timeout hasn't been fired after it has been closed
    if (IdentityManager && IdentityManager.dialog && IdentityManager.dialog._alreadyInitialized && ! IdentityManager.loadingTimeoutAlreadyFired) {
      clearTimeout(app.loadingTimeout);
      startLoadingTimeout();
      // Set a flag only if the dialog isn't showned now
      if (! IdentityManager._busy) {
        IdentityManager.loadingTimeoutAlreadyFired = true;
      }
      return;
    }

    /*
    //$("#loadingIndicator").fadeOut();
    $('#loadingMessage').html(
      '<div class="mainMessage">'
      + i18n.viewer.loading.long
      + '<br />'
      + i18n.viewer.loading.long2
      + '</div>'
    ).fadeIn('slow', function() {
      $('#loadingMessage').addClass('loaded');
    });
    */

    //app.map && app.map.destroy();
  }

  function initLocalization() {
    document.documentElement.lang = kernel.locale;
    query('#fatalError .error-title')[0].innerHTML = i18n.viewer.errors.boxTitle;
  }

  function isProd() {
    // Prevent the string from being replaced
    return CONFIG.environment != ['TPL','ENV','DEV'].join('_');
  }

  function definePortalConfig() {
    console.log('common.core.Core - parsePortalConfig');

    if (! app.portal) {
      return;
    }

    // Use geocode service from the portal if none declared in config
    if (! app.cfg.HELPER_SERVICES.geocode.length && app.portal.helperServices) {
      if (app.portal.helperServices.geocode && app.portal.helperServices.geocode.length && app.portal.helperServices.geocode[0].url) {
        $.each(app.portal.helperServices.geocode, function(index, geocoder) {
          app.cfg.HELPER_SERVICES.geocode.push(geocoder);
        });
      }
    }

    // Use geometry service from the portal if none declared in config
    var geometryServiceURL;

    if (app.cfg.HELPER_SERVICES.geometry && app.cfg.HELPER_SERVICES.geometry.url) {
      geometryServiceURL = app.cfg.HELPER_SERVICES.geometry.url;
    }
    else if (app.portal.helperServices.geometry && app.portal.helperServices.geometry.url) {
      geometryServiceURL = app.portal.helperServices.geometry.url;
    }
    esriConfig.defaults.geometryService = new GeometryService(geometryServiceURL);

    // Use bing key from the portal if none declared in config
    if (! app.cfg.BING_MAPS_KEY && app.portal.bingKey) {
      app.cfg.BING_MAPS_KEY = app.portal.bingKey;
    }

    // Disable feature service creation as Portal for ArcGIS 10.2 doesn't support that yet
    if (app.portal.isPortal && app.cfg && app.cfg.AUTHORIZED_IMPORT_SOURCE) {
      app.cfg.AUTHORIZED_IMPORT_SOURCE.featureService = false;
    }

    app.isPortal = !! app.portal.isPortal;

    // Help URL on Portal for ArcGIS
    if (app.isPortal && app.portal.helpBase && app.portal.portalHostname) {
      // app.cfg.HELP_URL_PORTAL contains the page in the help doc
      // app.portal.helpBase contains the path to the home of help
      // app.portal.helpBase should always be relative to the hostname and include the optional portal instance name
      // app.portal.portalHostname also include the portal instance name so we remove it first

      // Skip if the URL is already a full path
      if (! app.cfg.HELP_URL_PORTAL.match('^//')) {
        var portalHost = app.portal.portalHostname.split('/')[0];

        app.cfg.HELP_URL_PORTAL = '//' + portalHost + app.portal.helpBase + app.cfg.HELP_URL_PORTAL;
      }
    }
  }

  return {
    init: init,
    isProd: isProd,
    appInitComplete: appInitComplete,

    loadWebMap: loadWebMap,
    hasSwitchBuilderButton: hasSwitchBuilderButton,

    zoomToDeviceLocation: zoomToDeviceLocation,

    cleanLoadingTimeout: cleanLoadingTimeout,
    initError: initError,
    replaceInitErrorMessage: replaceInitErrorMessage,
    portalLogin: portalLogin
  };
});


define('lib-build/less!storymaps-react/tpl/view/media/Text',[],function(){});
define('storymaps-react/tpl/view/media/Text',['module', 'exports', 'lib-build/less!./Text'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Text = function () {
    function Text(text) {
      _classCallCheck(this, Text);

      this.type = 'text';
      this._text = text;
    }

    _createClass(Text, [{
      key: 'check',
      value: function check(context) {
        if (!this._text || !context) {
          console.log('Could not render text block in section');
          return false;
        }

        if (context.placement != 'block') {
          console.log('Could not render text block in section');
          return false;
        }

        return true;
      }
    }, {
      key: 'render',
      value: function render(context) {
        if (!this.check(context)) {
          return null;
        }

        return this._text.value;
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        //
      }
    }, {
      key: 'update',
      value: function update() {
        //
      }
    }, {
      key: 'load',
      value: function load() {
        //
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        //
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        return [];
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        return $(this._text.value).html();
      }
    }]);

    return Text;
  }();

  exports.default = Text;
  module.exports = exports['default'];
});
//# sourceMappingURL=Text.js.map
;
define('storymaps/tpl/utils/UI',[

], function(

) {
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
    .toString(16)
    .substring(1);
  }

  return {
    isMobileBrowser: function() {
      return (/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i).test(navigator.userAgent);
    },
    hasWebGL: function(returnContext) {
      if (!!window.WebGLRenderingContext) {
        var canvas = document.createElement('canvas'),
            names = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d'],
            context = false;

        for (var i = 0;i < 4;i++) {
          try {
            context = canvas.getContext(names[i]);
            if (context && typeof context.getParameter == 'function') {
              // WebGL is enabled
              if (returnContext) {
                // return WebGL object if the function's argument is present
                return {name: names[i], gl: context};
              }
              // else, return just true
              return true;
            }
          }
          catch (e) {
            //
          }
        }

        // WebGL is supported, but disabled
        return false;
      }

      // WebGL not supported
      return false;
    },
    addCSSRule: function(style, styleNodeIdAttr, targetIframeNode) {
      var target = 'head';

      //if( has("ie") <= 8 )
      //  return;

      if (targetIframeNode) {
        target = targetIframeNode.contents().find('head');
      }

      if (styleNodeIdAttr) {
        var styleNode = $(target).find('#' + styleNodeIdAttr).eq(0);

        if (styleNode.length) {
          styleNode.html(style);
          return;
        }
      }

      $('<style>')
        .prop('type', 'text/css')
        .attr('id', styleNodeIdAttr)
        .html(style)
        .appendTo(target);
    },
    getUID: function() {
      return Date.now()
        + '-' + s4() + s4()
        + '-' + s4()
        + '-' + s4()
        + '-' + s4()
        + '-' + s4() + s4() + s4();
    }
  };
});

define('text',{});
/*!

 handlebars v2.0.0

Copyright (C) 2011-2014 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

define(
  'handlebars/safe-string',["exports"],
  function(__exports__) {
    
    // Build out our basic SafeString type
    function SafeString(string) {
      this.string = string;
    }

    SafeString.prototype.toString = function() {
      return "" + this.string;
    };

    __exports__["default"] = SafeString;
  });
define(
  'handlebars/utils',["./safe-string","exports"],
  function(__dependency1__, __exports__) {
    
    /*jshint -W004 */
    var SafeString = __dependency1__["default"];

    var escape = {
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      '"': "&quot;",
      "'": "&#x27;",
      "`": "&#x60;"
    };

    var badChars = /[&<>"'`]/g;
    var possible = /[&<>"'`]/;

    function escapeChar(chr) {
      return escape[chr];
    }

    function extend(obj /* , ...source */) {
      for (var i = 1; i < arguments.length; i++) {
        for (var key in arguments[i]) {
          if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {
            obj[key] = arguments[i][key];
          }
        }
      }

      return obj;
    }

    __exports__.extend = extend;var toString = Object.prototype.toString;
    __exports__.toString = toString;
    // Sourced from lodash
    // https://github.com/bestiejs/lodash/blob/master/LICENSE.txt
    var isFunction = function(value) {
      return typeof value === 'function';
    };
    // fallback for older versions of Chrome and Safari
    /* istanbul ignore next */
    if (isFunction(/x/)) {
      isFunction = function(value) {
        return typeof value === 'function' && toString.call(value) === '[object Function]';
      };
    }
    var isFunction;
    __exports__.isFunction = isFunction;
    /* istanbul ignore next */
    var isArray = Array.isArray || function(value) {
      return (value && typeof value === 'object') ? toString.call(value) === '[object Array]' : false;
    };
    __exports__.isArray = isArray;

    function escapeExpression(string) {
      // don't escape SafeStrings, since they're already safe
      if (string instanceof SafeString) {
        return string.toString();
      } else if (string == null) {
        return "";
      } else if (!string) {
        return string + '';
      }

      // Force a string conversion as this will be done by the append regardless and
      // the regex test will do this transparently behind the scenes, causing issues if
      // an object's to string has escaped characters in it.
      string = "" + string;

      if(!possible.test(string)) { return string; }
      return string.replace(badChars, escapeChar);
    }

    __exports__.escapeExpression = escapeExpression;function isEmpty(value) {
      if (!value && value !== 0) {
        return true;
      } else if (isArray(value) && value.length === 0) {
        return true;
      } else {
        return false;
      }
    }

    __exports__.isEmpty = isEmpty;function appendContextPath(contextPath, id) {
      return (contextPath ? contextPath + '.' : '') + id;
    }

    __exports__.appendContextPath = appendContextPath;
  });
define(
  'handlebars/exception',["exports"],
  function(__exports__) {
    

    var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];

    function Exception(message, node) {
      var line;
      if (node && node.firstLine) {
        line = node.firstLine;

        message += ' - ' + line + ':' + node.firstColumn;
      }

      var tmp = Error.prototype.constructor.call(this, message);

      // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.
      for (var idx = 0; idx < errorProps.length; idx++) {
        this[errorProps[idx]] = tmp[errorProps[idx]];
      }

      if (line) {
        this.lineNumber = line;
        this.column = node.firstColumn;
      }
    }

    Exception.prototype = new Error();

    __exports__["default"] = Exception;
  });
define(
  'handlebars/base',["./utils","./exception","exports"],
  function(__dependency1__, __dependency2__, __exports__) {
    
    var Utils = __dependency1__;
    var Exception = __dependency2__["default"];

    var VERSION = "2.0.0";
    __exports__.VERSION = VERSION;var COMPILER_REVISION = 6;
    __exports__.COMPILER_REVISION = COMPILER_REVISION;
    var REVISION_CHANGES = {
      1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it
      2: '== 1.0.0-rc.3',
      3: '== 1.0.0-rc.4',
      4: '== 1.x.x',
      5: '== 2.0.0-alpha.x',
      6: '>= 2.0.0-beta.1'
    };
    __exports__.REVISION_CHANGES = REVISION_CHANGES;
    var isArray = Utils.isArray,
        isFunction = Utils.isFunction,
        toString = Utils.toString,
        objectType = '[object Object]';

    function HandlebarsEnvironment(helpers, partials) {
      this.helpers = helpers || {};
      this.partials = partials || {};

      registerDefaultHelpers(this);
    }

    __exports__.HandlebarsEnvironment = HandlebarsEnvironment;HandlebarsEnvironment.prototype = {
      constructor: HandlebarsEnvironment,

      logger: logger,
      log: log,

      registerHelper: function(name, fn) {
        if (toString.call(name) === objectType) {
          if (fn) { throw new Exception('Arg not supported with multiple helpers'); }
          Utils.extend(this.helpers, name);
        } else {
          this.helpers[name] = fn;
        }
      },
      unregisterHelper: function(name) {
        delete this.helpers[name];
      },

      registerPartial: function(name, partial) {
        if (toString.call(name) === objectType) {
          Utils.extend(this.partials,  name);
        } else {
          this.partials[name] = partial;
        }
      },
      unregisterPartial: function(name) {
        delete this.partials[name];
      }
    };

    function registerDefaultHelpers(instance) {
      instance.registerHelper('helperMissing', function(/* [args, ]options */) {
        if(arguments.length === 1) {
          // A missing field in a {{foo}} constuct.
          return undefined;
        } else {
          // Someone is actually trying to call something, blow up.
          throw new Exception("Missing helper: '" + arguments[arguments.length-1].name + "'");
        }
      });

      instance.registerHelper('blockHelperMissing', function(context, options) {
        var inverse = options.inverse,
            fn = options.fn;

        if(context === true) {
          return fn(this);
        } else if(context === false || context == null) {
          return inverse(this);
        } else if (isArray(context)) {
          if(context.length > 0) {
            if (options.ids) {
              options.ids = [options.name];
            }

            return instance.helpers.each(context, options);
          } else {
            return inverse(this);
          }
        } else {
          if (options.data && options.ids) {
            var data = createFrame(options.data);
            data.contextPath = Utils.appendContextPath(options.data.contextPath, options.name);
            options = {data: data};
          }

          return fn(context, options);
        }
      });

      instance.registerHelper('each', function(context, options) {
        if (!options) {
          throw new Exception('Must pass iterator to #each');
        }

        var fn = options.fn, inverse = options.inverse;
        var i = 0, ret = "", data;

        var contextPath;
        if (options.data && options.ids) {
          contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';
        }

        if (isFunction(context)) { context = context.call(this); }

        if (options.data) {
          data = createFrame(options.data);
        }

        if(context && typeof context === 'object') {
          if (isArray(context)) {
            for(var j = context.length; i<j; i++) {
              if (data) {
                data.index = i;
                data.first = (i === 0);
                data.last  = (i === (context.length-1));

                if (contextPath) {
                  data.contextPath = contextPath + i;
                }
              }
              ret = ret + fn(context[i], { data: data });
            }
          } else {
            for(var key in context) {
              if(context.hasOwnProperty(key)) {
                if(data) {
                  data.key = key;
                  data.index = i;
                  data.first = (i === 0);

                  if (contextPath) {
                    data.contextPath = contextPath + key;
                  }
                }
                ret = ret + fn(context[key], {data: data});
                i++;
              }
            }
          }
        }

        if(i === 0){
          ret = inverse(this);
        }

        return ret;
      });

      instance.registerHelper('if', function(conditional, options) {
        if (isFunction(conditional)) { conditional = conditional.call(this); }

        // Default behavior is to render the positive path if the value is truthy and not empty.
        // The `includeZero` option may be set to treat the condtional as purely not empty based on the
        // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.
        if ((!options.hash.includeZero && !conditional) || Utils.isEmpty(conditional)) {
          return options.inverse(this);
        } else {
          return options.fn(this);
        }
      });

      instance.registerHelper('unless', function(conditional, options) {
        return instance.helpers['if'].call(this, conditional, {fn: options.inverse, inverse: options.fn, hash: options.hash});
      });

      instance.registerHelper('with', function(context, options) {
        if (isFunction(context)) { context = context.call(this); }

        var fn = options.fn;

        if (!Utils.isEmpty(context)) {
          if (options.data && options.ids) {
            var data = createFrame(options.data);
            data.contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]);
            options = {data:data};
          }

          return fn(context, options);
        } else {
          return options.inverse(this);
        }
      });

      instance.registerHelper('log', function(message, options) {
        var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;
        instance.log(level, message);
      });

      instance.registerHelper('lookup', function(obj, field) {
        return obj && obj[field];
      });
    }

    var logger = {
      methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },

      // State enum
      DEBUG: 0,
      INFO: 1,
      WARN: 2,
      ERROR: 3,
      level: 3,

      // can be overridden in the host environment
      log: function(level, message) {
        if (logger.level <= level) {
          var method = logger.methodMap[level];
          if (typeof console !== 'undefined' && console[method]) {
            console[method].call(console, message);
          }
        }
      }
    };
    __exports__.logger = logger;
    var log = logger.log;
    __exports__.log = log;
    var createFrame = function(object) {
      var frame = Utils.extend({}, object);
      frame._parent = object;
      return frame;
    };
    __exports__.createFrame = createFrame;
  });
define(
  'handlebars/runtime',["./utils","./exception","./base","exports"],
  function(__dependency1__, __dependency2__, __dependency3__, __exports__) {
    
    var Utils = __dependency1__;
    var Exception = __dependency2__["default"];
    var COMPILER_REVISION = __dependency3__.COMPILER_REVISION;
    var REVISION_CHANGES = __dependency3__.REVISION_CHANGES;
    var createFrame = __dependency3__.createFrame;

    function checkRevision(compilerInfo) {
      var compilerRevision = compilerInfo && compilerInfo[0] || 1,
          currentRevision = COMPILER_REVISION;

      if (compilerRevision !== currentRevision) {
        if (compilerRevision < currentRevision) {
          var runtimeVersions = REVISION_CHANGES[currentRevision],
              compilerVersions = REVISION_CHANGES[compilerRevision];
          throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. "+
                "Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").");
        } else {
          // Use the embedded version info since the runtime doesn't know about this revision yet
          throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. "+
                "Please update your runtime to a newer version ("+compilerInfo[1]+").");
        }
      }
    }

    __exports__.checkRevision = checkRevision;// TODO: Remove this line and break up compilePartial

    function template(templateSpec, env) {
      /* istanbul ignore next */
      if (!env) {
        throw new Exception("No environment passed to template");
      }
      if (!templateSpec || !templateSpec.main) {
        throw new Exception('Unknown template object: ' + typeof templateSpec);
      }

      // Note: Using env.VM references rather than local var references throughout this section to allow
      // for external users to override these as psuedo-supported APIs.
      env.VM.checkRevision(templateSpec.compiler);

      var invokePartialWrapper = function(partial, indent, name, context, hash, helpers, partials, data, depths) {
        if (hash) {
          context = Utils.extend({}, context, hash);
        }

        var result = env.VM.invokePartial.call(this, partial, name, context, helpers, partials, data, depths);

        if (result == null && env.compile) {
          var options = { helpers: helpers, partials: partials, data: data, depths: depths };
          partials[name] = env.compile(partial, { data: data !== undefined, compat: templateSpec.compat }, env);
          result = partials[name](context, options);
        }
        if (result != null) {
          if (indent) {
            var lines = result.split('\n');
            for (var i = 0, l = lines.length; i < l; i++) {
              if (!lines[i] && i + 1 === l) {
                break;
              }

              lines[i] = indent + lines[i];
            }
            result = lines.join('\n');
          }
          return result;
        } else {
          throw new Exception("The partial " + name + " could not be compiled when running in runtime-only mode");
        }
      };

      // Just add water
      var container = {
        lookup: function(depths, name) {
          var len = depths.length;
          for (var i = 0; i < len; i++) {
            if (depths[i] && depths[i][name] != null) {
              return depths[i][name];
            }
          }
        },
        lambda: function(current, context) {
          return typeof current === 'function' ? current.call(context) : current;
        },

        escapeExpression: Utils.escapeExpression,
        invokePartial: invokePartialWrapper,

        fn: function(i) {
          return templateSpec[i];
        },

        programs: [],
        program: function(i, data, depths) {
          var programWrapper = this.programs[i],
              fn = this.fn(i);
          if (data || depths) {
            programWrapper = program(this, i, fn, data, depths);
          } else if (!programWrapper) {
            programWrapper = this.programs[i] = program(this, i, fn);
          }
          return programWrapper;
        },

        data: function(data, depth) {
          while (data && depth--) {
            data = data._parent;
          }
          return data;
        },
        merge: function(param, common) {
          var ret = param || common;

          if (param && common && (param !== common)) {
            ret = Utils.extend({}, common, param);
          }

          return ret;
        },

        noop: env.VM.noop,
        compilerInfo: templateSpec.compiler
      };

      var ret = function(context, options) {
        options = options || {};
        var data = options.data;

        ret._setup(options);
        if (!options.partial && templateSpec.useData) {
          data = initData(context, data);
        }
        var depths;
        if (templateSpec.useDepths) {
          depths = options.depths ? [context].concat(options.depths) : [context];
        }

        return templateSpec.main.call(container, context, container.helpers, container.partials, data, depths);
      };
      ret.isTop = true;

      ret._setup = function(options) {
        if (!options.partial) {
          container.helpers = container.merge(options.helpers, env.helpers);

          if (templateSpec.usePartial) {
            container.partials = container.merge(options.partials, env.partials);
          }
        } else {
          container.helpers = options.helpers;
          container.partials = options.partials;
        }
      };

      ret._child = function(i, data, depths) {
        if (templateSpec.useDepths && !depths) {
          throw new Exception('must pass parent depths');
        }

        return program(container, i, templateSpec[i], data, depths);
      };
      return ret;
    }

    __exports__.template = template;function program(container, i, fn, data, depths) {
      var prog = function(context, options) {
        options = options || {};

        return fn.call(container, context, container.helpers, container.partials, options.data || data, depths && [context].concat(depths));
      };
      prog.program = i;
      prog.depth = depths ? depths.length : 0;
      return prog;
    }

    __exports__.program = program;function invokePartial(partial, name, context, helpers, partials, data, depths) {
      var options = { partial: true, helpers: helpers, partials: partials, data: data, depths: depths };

      if(partial === undefined) {
        throw new Exception("The partial " + name + " could not be found");
      } else if(partial instanceof Function) {
        return partial(context, options);
      }
    }

    __exports__.invokePartial = invokePartial;function noop() { return ""; }

    __exports__.noop = noop;function initData(context, data) {
      if (!data || !('root' in data)) {
        data = data ? createFrame(data) : {};
        data.root = context;
      }
      return data;
    }
  });
define(
  'handlebars.runtime',["./handlebars/base","./handlebars/safe-string","./handlebars/exception","./handlebars/utils","./handlebars/runtime","exports"],
  function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__, __exports__) {
    
    /*globals Handlebars: true */
    var base = __dependency1__;

    // Each of these augment the Handlebars object. No need to setup here.
    // (This is done to easily share code between commonjs and browse envs)
    var SafeString = __dependency2__["default"];
    var Exception = __dependency3__["default"];
    var Utils = __dependency4__;
    var runtime = __dependency5__;

    // For compatibility and usage outside of module systems, make the Handlebars object a namespace
    var create = function() {
      var hb = new base.HandlebarsEnvironment();

      Utils.extend(hb, base);
      hb.SafeString = SafeString;
      hb.Exception = Exception;
      hb.Utils = Utils;
      hb.escapeExpression = Utils.escapeExpression;

      hb.VM = runtime;
      hb.template = function(spec) {
        return runtime.template(spec, hb);
      };

      return hb;
    };

    var Handlebars = create();
    Handlebars.create = create;

    Handlebars['default'] = Handlebars;

    __exports__ = Handlebars['default'];
	return __exports__;
  });
// RequireJS Handlebars template plugin
// http://github.com/jfparadis/requirejs-handlebars
//
// An alternative to http://github.com/SlexAxton/require-handlebars-plugin/blob/master/hbs.js
//
// Using Handlebars Semantic templates at http://handlebarsjs.com
// Using and RequireJS text.js at http://requirejs.org/docs/api.html#text
// @author JF Paradis
// @version 0.0.2
//
// Released under the MIT license
//
// Usage:
//   require(['backbone', 'hbar!mytemplate'], function (Backbone, mytemplate) {
//     return Backbone.View.extend({
//       initialize: function(){
//         this.render();
//       },
//       render: function(){
//         this.$el.html(mytemplate({message: 'hello'}));
//     });
//   });
//
// Configuration: (optional)
//   require.config({
//     hbars: {
//       extension: '.hbar' // default = '.html'
//     }
//   });

/*jslint nomen: true */
/*global define: false */

define('lib-build/hbars',['text', 'Handlebars'], function (text, Handlebars) {
    'use strict';

    var buildMap = {},
        buildTemplateSource = "define('{pluginName}!{moduleName}', ['Handlebars'], function (Handlebars) { return Handlebars.template({content}); });\n";

    return {
        version: '0.0.2',

        load: function (moduleName, parentRequire, onload, config) {
            config = config || {};
			if (buildMap[moduleName]) {
                onload(buildMap[moduleName]);

            } else {
                var ext = (config.hbars && config.hbars.extension) || '.hbs',
                    path = (config.hbars && config.hbars.path) || '',
                    compileOptions = (config.hbars && config.hbars.compileOptions) || {},
                    textOnload = function (source) {
                        if (config.isBuild) {
                            // We store the precompiled template so we can use the
                            // handlebars.runtime after build.
                            buildMap[moduleName] = Handlebars.precompile(source, compileOptions);
                            // Don't bother doing anything else during build.
                            onload();
                        } else {
                            // We store the compiled template for reuse
                            buildMap[moduleName] = Handlebars.compile(source);
                            onload(buildMap[moduleName]);
                        }
                    };

                textOnload.error = onload.error;
                text.load(path + moduleName + ext, parentRequire, textOnload, config);
            }
        },

        write: function (pluginName, moduleName, write, config) {
            var content = buildMap[moduleName];
            if (content) {
                write.asModule(pluginName + '!' + moduleName,
                    buildTemplateSource
                    .replace('{pluginName}', pluginName)
                    .replace('{moduleName}', moduleName)
                    .replace('{content}', content));
            }
        }
    };
});

define('lib-build/hbars!storymaps-react/tpl/view/media/MediaError', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<div class=\"loading-error\">\r\n  <div class=\"loading-error-wrapper\">\r\n    <i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\r\n    Sorry, this content is not accessible\r\n  </div>\r\n</div>\r\n";
  },"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/MediaError',[],function(){});
define('storymaps-react/tpl/view/media/Media',['module', 'exports', 'storymaps/tpl/utils/UI', 'storymaps/common/utils/CommonHelper', 'dojo/topic', 'esri/IdentityManager', 'lib-build/hbars!./MediaError', 'lib-build/less!./MediaError'], function (module, exports, _UI, _CommonHelper, _topic, _IdentityManager, _MediaError) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _UI2 = _interopRequireDefault(_UI);

  var _CommonHelper2 = _interopRequireDefault(_CommonHelper);

  var _topic2 = _interopRequireDefault(_topic);

  var _IdentityManager2 = _interopRequireDefault(_IdentityManager);

  var _MediaError2 = _interopRequireDefault(_MediaError);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Media = function () {
    function Media() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, Media);

      this.type = params.type;
      this.id = params.id;

      this.previewThumb = params.previewThumb;
      this.previewIcon = params.previewIcon;

      /*
       * Cache store media resources to optimize performance when a media can be reused
       * - in an immersive section: all background are sharing the same cache: so a webmap/webscene is only loaded once
       * - in a sequential section: block media are not using the cache yet
       *   - this could be implemented for webscene using 4.x: the map is common but the view are specific
       *     - if media placement is background -> the map and view are saved in the cache
       *     - if media placement is block -> the map is saved but in the cache but the view is not
       *   - this is not doable for webmap before 4.x
       */
      this._cache = {};
      this._isLoaded = false;
      this._alternateMedia = null;

      this._node = null;
      this._domID = _UI2.default.getUID();

      /*
       * Builder
       */

      this._isUploadPending = false;
      this._builderConfigurationTabs = [];
      this._onConfigAction = null;
    }

    _createClass(Media, [{
      key: 'postCreate',
      value: function postCreate(params) {
        // TODO: should find the node here?

        this._builderConfigurationTabs = params.builderConfigurationTabs || [];
        this._onConfigAction = params.onConfigAction;
        this._onConfigChangeCallback = params.onConfigChange;
      }
    }, {
      key: 'setCache',
      value: function setCache(cache) {
        this._cache = cache;
      }
    }, {
      key: 'setAlternate',
      value: function setAlternate(alternateMedia) {
        this._alternateMedia = alternateMedia;
      }
    }, {
      key: 'getAlternate',
      value: function getAlternate() {
        return this._alternateMedia;
      }
    }, {
      key: 'getPreviewThumbnail',
      value: function getPreviewThumbnail() {
        return Media.addToken(this.previewThumb);
      }
    }, {
      key: 'getPreviewIcon',
      value: function getPreviewIcon() {
        return this.previewIcon;
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig(options) {
        if (this._placement == 'block') {
          options.size = options.size || 'medium';

          var classes = $.map(this._node.attr('class').split(' '), function (l) {
            return l.match(/block-size-/) ? l : null;
          }).join(' ');

          this._node.removeClass(classes).addClass('block-size-' + options.size);
        }
      }
    }, {
      key: '_onEnableButtonClick',
      value: function _onEnableButtonClick(e) {
        var btn = $(e.currentTarget);

        btn.toggleClass('enabled');
        this._node.toggleClass('interaction-enabled');
      }
    }, {
      key: 'showLoadingError',
      value: function showLoadingError() {
        this._node.append((0, _MediaError2.default)({})).addClass('has-loading-error bg-danger');
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        var arcgisContent = [];

        if (this.type == 'webmap' || this.type == 'webscene') {
          arcgisContent = [{
            type: this.type,
            id: this.id
          }];
        } else if (this.type == 'image') {
          var arcgisResourceURL = Media.getArcGISItemResourceURL(this._url);

          if (arcgisResourceURL) {
            arcgisContent = [{
              type: 'item-resource',
              mediaType: this.type,
              url: arcgisResourceURL.url,
              file: arcgisResourceURL.file
            }];
          }
        } else if (this.type == 'image-gallery') {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = this._images.images[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var image = _step.value;

              var _arcgisResourceURL = Media.getArcGISItemResourceURL(image.url);

              if (_arcgisResourceURL) {
                arcgisContent.push({
                  type: 'item-resource',
                  mediaType: this.type,
                  url: _arcgisResourceURL.url,
                  file: _arcgisResourceURL.file
                });
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        }

        return arcgisContent;
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }, {
      key: 'postLoad',
      value: function postLoad() {}
      //


      /*
       * Builder
       */

    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'getAuthorizedTransitionsWith',
      value: function getAuthorizedTransitionsWith() {
        return [];
      }
    }, {
      key: 'initBuilderUI',
      value: function initBuilderUI() {
        if (this._placement == 'block') {
          this._node.find('.media-delete').html('<div class="media-delete-background"></div><i class="media-delete-icon config-icon fa fa-trash-o"></i>');
          this._node.find('.media-delete-icon').click(function () {
            this._onAction('remove');
          }.bind(this));
        }
      }
    }, {
      key: 'isConfigActive',
      value: function isConfigActive() {
        return this._node.hasClass('config-panel-active');
      }
    }, {
      key: 'closeConfigPanel',
      value: function closeConfigPanel() {
        this._node.removeClass('config-panel-active');
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        this._node.remove();
      }
    }, {
      key: 'remove',
      value: function remove() {
        this._node.remove();
      }
    }, {
      key: 'isPlaceholder',
      value: function isPlaceholder() {
        return false;
      }
    }, {
      key: '_onAction',
      value: function _onAction(action, newMedia) {
        // TODO: does that need to be checked?
        if (action == 'remove' || action == 'swap' || action == 'image-to-image-gallery' || action == 'image-gallery-to-image') {
          this._onConfigAction({
            action: action,
            media: this,
            newMedia: newMedia
          });
        }

        this._onConfigChange();
      }
    }, {
      key: '_onConfigChange',
      value: function _onConfigChange() {
        _topic2.default.publish('builder-media-update');

        if (this._onConfigChangeCallback) {
          this._onConfigChangeCallback();
        }
      }
    }], [{
      key: 'getArcGISItemResourceURL',
      value: function getArcGISItemResourceURL() {
        var url = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];

        var urlClean = decodeURIComponent(url);

        var urlMatch = urlClean.match(new RegExp('\/sharing\/rest\/content\/items\/' + app.data.appItem.item.id + '\/resources\/(.*)$'));
        if (urlMatch && urlMatch.length == 2) {
          return {
            url: urlClean,
            file: urlMatch[1]
          };
        }

        return null;
      }
    }, {
      key: 'addToken',
      value: function addToken(url) {
        var mayNeedToken = app.data.appItem && app.data.appItem.item.access != 'public' && app.data.appItem.item.id && url;

        if (!mayNeedToken) {
          return url;
        }

        var token = '';

        if (app.portal && app.portal.getPortalUser()) {
          token = app.portal.getPortalUser().credential.token;
        } else if (_IdentityManager2.default.findCredential(document.location.origin)) {
          token = _IdentityManager2.default.findCredential(document.location.origin).token;
        } else {
          token = _CommonHelper2.default.getCookieToken();
        }

        if (url.match(new RegExp('\/sharing\/rest\/content\/items\/' + app.data.appItem.item.id + '\/resources\/'))) {
          return url + '?token=' + token;
        }

        return url;
      }
    }, {
      key: 'findCropDistance',
      value: function findCropDistance(item, container, offsetRatio) {
        var containerWidth = container.width();
        var containerHeight = container.height();
        var containerAspectRatio = containerWidth / containerHeight;
        var itemAspectRatio = item.width / item.height;
        var transferBy = {
          x: 0,
          y: 0
        };
        var amountToMove = 0;

        // transfer the item over...
        // if the item's width-height ratio is less than the target element (target is wider), height is cropped and width fills (so we don't want to change the x-offset).
        var shouldPanX = itemAspectRatio > containerAspectRatio;
        var shouldPanY = itemAspectRatio < containerAspectRatio;

        if (shouldPanY) {
          // transfer it by that much (so it's in top left), then do it by the center
          // the item is as wide as the container, as tall as container * aspectRatio...
          var itemTargetHeight = containerWidth / itemAspectRatio;
          amountToMove = this.getDimensionAmount(itemTargetHeight, containerHeight, offsetRatio.y);

          transferBy.x = 0;
          transferBy.y = amountToMove;
        }
        // if it's greater (target is taller), height fills and width is cropped (so we won't want to change y-offset).
        else if (shouldPanX) {
            var itemTargetWidth = containerHeight * itemAspectRatio;
            amountToMove = this.getDimensionAmount(itemTargetWidth, containerWidth, offsetRatio.x);

            transferBy.x = amountToMove;
            transferBy.y = 0;
          }
          // if it's the same, we don't want to offset at all.
          else {
              transferBy.x = 0;
              transferBy.y = 0;
            }

        return transferBy;
      }
    }, {
      key: 'getDimensionAmount',
      value: function getDimensionAmount(itemTargetDimension, containerDimension, offsetRatio) {
        // find the focus point on the target item, in pixels
        var focusPoint = itemTargetDimension * offsetRatio;
        // to have that point centered, you'd have to translate the item by the amount here:
        var amountToMove = (focusPoint - containerDimension / 2) * -1;

        // but if centering it would make the item translate "into" the container so it's not all showing, have it move to the near edge only.
        if (amountToMove > 0) {
          amountToMove = 0;
        }
        // conversely, if centering would make the item translate "through" the container so far that some of it would not be showing, have it move so it's translated through only to the far edge (and no more).
        else if (itemTargetDimension - amountToMove * -1 < containerDimension) {
            amountToMove = (itemTargetDimension - containerDimension) * -1;
          }
        return amountToMove;
      }
    }, {
      key: 'getTargetDimensions',
      value: function getTargetDimensions(rawItemDimensions, containerDimensions) {
        var itemDimensions = {
          width: 0,
          height: 0
        };
        var rawItemAspectRatio = rawItemDimensions.width / rawItemDimensions.height;
        var containerAspectRatio = containerDimensions.width / containerDimensions.height;

        if (rawItemAspectRatio > containerAspectRatio) {
          // it's wider, so the height is the same
          itemDimensions.height = containerDimensions.height;
          itemDimensions.width = containerDimensions.height * rawItemAspectRatio;
        } else {
          // it's taller, so the widths are the same..
          itemDimensions.width = containerDimensions.width;
          itemDimensions.height = containerDimensions.width / rawItemAspectRatio;
        }

        return itemDimensions;
      }
    }]);

    return Media;
  }();

  exports.default = Media;
  module.exports = exports['default'];
});
//# sourceMappingURL=Media.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/ImageBlock', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\"false\">\r\n  <div class=\"block-media\">\r\n    <div class=\"media-loading\">\r\n      <span class=\"large-loader\"></span>\r\n    </div>\r\n    <div class=\"image-container\" style=\"padding-top: "
    + escapeExpression(((helper = (helper = helpers.padding || (depth0 != null ? depth0.padding : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"padding","hash":{},"data":data}) : helper)))
    + "%\"></div>\r\n    <div class=\"builder-ui media-cfg-invite\"></div>\r\n    <div class=\"builder-ui img-gallery-invite\">\r\n      <div class=\"img-gallery-invite-background\"></div>\r\n      <i class=\"img-gallery-add fa fa-plus\" aria-hidden=\"true\" data-toggle=\"tooltip\"></i>\r\n    </div>\r\n    <div class=\"builder-ui media-delete\"></div>\r\n  </div>\r\n  <div class=\"block-caption\" data-placeholder=\""
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\""
    + escapeExpression(((helper = (helper = helpers.captionEditable || (depth0 != null ? depth0.captionEditable : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"captionEditable","hash":{},"data":data}) : helper)))
    + "\">";
  stack1 = ((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n  <div class=\"builder-ui media-cfg-panel\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/ImageBackground', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div class=\"media-loading\">\r\n  <span class=\"large-loader\"></span>\r\n</div>\r\n<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n<!--<div class=\"caption\">"
    + escapeExpression(((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper)))
    + "</div>-->\r\n<div class=\"builder-ui media-cfg-invite\"></div>\r\n<div class=\"builder-ui media-cfg-panel\"></div>\r\n";
},"useData":true}); });

define('resources/tpl/builder/nls/app',{
	root: ({
		builder: {
			dialog: {
				apply: "Apply",
				close: "Close"
			},
			header: {
				defaultTagline: "A ${STORY_MAP}",
				sharingNotAvailable: "This is not available until you share the story",
				edit: "Edit"
			},
			headerConfig: {
				toggles: {
					bookmarks: "Bookmarks",
					logoSharing: "Logo & Sharing"
				},
				bookmarks: {
					title: "Section",
					bookmark: "Bookmark",
					intro: "Bookmarks are links to story sections that are shown in the header. Creating concise bookmarks for the main sections of your story helps readers get oriented.",
					sequentialDefault: "Sequential section (no text found)",
					immersiveDefault: "Immersive section (no text found)",
					titleDefault: "Title section (no text found)",
					coverDefault: "Cover section (no text found)",
					coverAppendage: "(Cover)"
				},
				logoSharing: {
					logo: "Logo",
					logoButton: "Use ${ESRI} Logo",
					logoLink: "Logo link",
					logoUploadProgress: "Logo upload in progress",
					logoUploadSuccess: "Logo uploaded successfully",
					logoUploadError: "Logo upload failed, switching back to ${ESRI} logo",
					customHeaderText: "Tagline",
					taglineLinkDisabledTooltip: "Enter a tagline to enable the link",
					link: "Tagline link",
					enableSocialSharing: "Display sharing button"
				}
			},
			builderPanel: {
				coverLabel: "Cover",
				creditsLabel: "Credits",
				betaFeedback: "Beta feedback",
				betaNote: "${APP_NAME} is in beta. Please let us know what you think or if something is not working as you expected.",
				notSharedNote: "Your story isn't shared, only you can see it",
				organizationWarning: "To ensure this story can be seen by others when shared with your organization, you must also share its maps, scenes, layers, or apps with your organization using the check story button below.",
				publicWarning: "To ensure this story can be seen by others when shared publicly, you must also share its maps, scenes, layers, or apps publicly using the check story button below.",
				addTitleNote: "Add a title for your story on the cover to save",
				saveError: "There was an error saving your story.",
				organize: "Organize",
				done: "Done"
			},
			immersiveViewPanel: {
				transition: "Transition",
				fade: "Fade",
				fadeSlow: "Fade Slow",
				swipeVertical: "Swipe Vertical",
				swipeHorizontal: "Swipe Horizontal",
				none: "None",
				disabledConsecutiveSameMedia: "Not available when consecutive views use the same media",
				disabledTooltipMap: "To use this transition the visible layers in both views must be different and the other map properties must be the same",
				disabledConsecutiveSameMap: "Not available when consecutive views use the same map",
				disabledNotInBeta: "Not available in beta",
				disabledNonConsecutive: "Not available as there is another occurence of this media that is non consecutive",
				addMedia: "Add media"
			},
			mediaConfig: {
				tabs: {
					appearance: "Appearance",
					manage: "Manage",
					size: "Size",
					background: "Background"
				},
				manage: {
					changeMedia: "Change media",
					edit: "Edit",
					editAside: "Opens in a new browser tab. After saving your edits, save and reload this story to see your changes.",
					remove: "Remove"
				},
				appearance: {
					homeView: "Initial view",
					audio: "Audio",
					on: "On",
					muted: "Muted",
					volumeAside: "The video will autoplay when a reader arrives at this view. If you mute the sound, the reader will not be able to enable it.",
					view: "View",
					resetLocation: "Reset Location",
					resetLayers: "Reset Layers",
					clearPopup: "Clear Pop-Up",
					interaction: "Interaction",
					interactionDisabled: "Interaction Disabled",
					buttonToEnable: "Button to Enable",
					interactionEnabled: "Interaction Enabled",
					interactionAside: "*Touch devices will show an interaction button.",
					slide: "Slide",
					noSlides: "No slides available."
				},
				mediaAppearance: {
					layout: "Layout"
				},
				size: {
					small: "Small",
					medium: "Medium",
					large: "Large"
				},
				background: {
					noCrop: "Do not crop image",
					mostImportantPart: "Choose the most important point",
					cropExplanationImmersive: "Select a point on the image to choose how your image will be cropped at different screen sizes. The point you select will always be visible. Check the box below if your media needs to be fully visible.",
					cropExplanation: "Select a point on the image to choose how your image will be cropped at different screen sizes. The point you select will always be visible.",
					previews: "Previews"
				}
			},
			imageGallery: {
				reachedLimit: "Only four images are allowed in a row. To start a new row, add another image below.",
				addImage: "Add another image to this row"
			},
			cover: {
				titlePrompt: "Enter your story title...",
				subtitlePrompt: "Scroll down to get started or enter an optional subtitle",
				mediaPlaceholder: "Add your image or video",
				saveError: "Save failed, you already have an item with this title"
			},
			credits: {
				warning: "Both fields must be filled out",
				content: "Content...",
				source: "Source...",
				linkPrompt: "Optional link...",
				introductionPlaceholder: "Enter an optional introduction to your credits section..."
			},
			media: {
				captionPlaceholder: "Your caption here..."
			}
    }
  }),
	"ar": 1,
	"cs": 1,
	"da": 1,
	"de": 1,
	"el": 1,
	"es": 1,
	"et": 1,
	"fi": 1,
	"fr": 1,
	"he": 1,
	"hr": 1,
	"it": 1,
	"ja": 1,
	"ko": 1,
	"lt": 1,
	"lv": 1,
	"nl": 1,
	"nb": 1,
	"pl": 1,
	"pt-br": 1,
	"pt-pt": 1,
	"ro": 1,
	"ru": 1,
	"sr": 1,
	"sv": 1,
	"th": 1,
	"tr": 1,
	"vi": 1,
	"zh-cn": 1,
	"zh-hk": 1,
	"zh-tw": 1
});



define('lib-build/less!storymaps-react/tpl/view/media/Image',[],function(){});
define('storymaps-react/tpl/view/media/Image',['module', 'exports', './Media', 'lib-build/hbars!./ImageBlock', 'lib-build/hbars!./ImageBackground', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'storymaps/tpl/utils/UI', 'dojo/Deferred', 'lib-build/less!./Image'], function (module, exports, _Media2, _ImageBlock, _ImageBackground, _app, _UI, _Deferred) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _ImageBlock2 = _interopRequireDefault(_ImageBlock);

  var _ImageBackground2 = _interopRequireDefault(_ImageBackground);

  var _app2 = _interopRequireDefault(_app);

  var _UI2 = _interopRequireDefault(_UI);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var PREVIEW_THUMB = 'resources/tpl/builder/icons/media-placeholder/image.jpg';
  var PREVIEW_ICON = 'resources/tpl/builder/icons/immersive-panel/image.png';

  var BLOCK_WIDTH_SMALL = 0.4;
  var BLOCK_WIDTH_MEDIUM = 0.8;
  var BLOCK_HEIGHT_FOR_CAPTION = 200;

  var Image = function (_Media) {
    _inherits(Image, _Media);

    function Image(image) {
      _classCallCheck(this, Image);

      // sizes is an array of objects with {height, width, url}.
      if (image.sizes) {
        (function () {
          var screenWidth = window.screen.width;

          // sort sizes arr by longestSide, with largest first.
          image.sizes.forEach(function (sizeObj) {
            sizeObj.longestSide = Math.max(sizeObj.width, sizeObj.height);
          });
          image.sizes.sort(function (a, b) {
            if (b.longestSide === a.longestSide) {
              return Math.min(b.width, b.height) - Math.min(a.width, a.height);
            }
            // what if they're the same? then compare shorter side...?
            return b.longestSide - a.longestSide;
          });

          // find the size who's longest side is closest to, without going too far over,
          // the screen width. (remember, image.sizes is already sorted, descending order)
          var mainTarget = void 0,
              previewTarget = void 0;
          image.sizes.every(function (sizeObj) {
            if (sizeObj.longestSide > screenWidth - 50) {
              mainTarget = sizeObj;
              return true;
            }
            return false;
          });

          // find the size who's longest side is closest to 250px
          image.sizes.every(function (sizeObj) {
            if (sizeObj.longestSide >= 250) {
              previewTarget = sizeObj;
              return true;
            }
            return false;
          });

          // just in case the sizes object wasn't properly formatted, check for mainTarget.
          if (mainTarget) {
            image.url = mainTarget.url;
            image.width = mainTarget.width;
            image.height = mainTarget.height;
          }
          if (previewTarget) {
            image.thumbUrl = previewTarget.url;
          }
        })();
      }
      var id = image.url;

      if (image.dataUrl && image.uploadDeferred) {
        id = _UI2.default.getUID();
      }

      var _this = _possibleConstructorReturn(this, (Image.__proto__ || Object.getPrototypeOf(Image)).call(this, {
        type: 'image',
        id: id,
        previewThumb: image.thumbUrl || image.dataUrl || image.url || PREVIEW_THUMB,
        previewIcon: PREVIEW_ICON
      }));

      _this._image = image;
      _this._url = image.url;
      _this._placement = null;

      // TODO: shouldn't be needed
      if (!_this._image.options) {
        _this._image.options = {};
      }

      if (image.dataUrl && image.uploadDeferred) {
        _this._isUploadPending = true;
        _this._url = image.dataUrl;

        delete _this._image.dataUrl;

        image.uploadDeferred.then(_this._onUploadSuccess.bind(_this), _this._onUploadFail.bind(_this));
      }
      return _this;
    }

    _createClass(Image, [{
      key: 'render',
      value: function render(context) {
        var output = '',
            options = [];

        if (!this._image || !context) {
          console.log('Could not render image in section');
          return output;
        }

        this._placement = context.placement;

        /*
        if (this._image.href) {
          options.push('has-link');
        }
        */

        if (this._placement == 'block') {
          var style = this._computeBlockStyle();

          options.push('block-size-' + style.size);

          // This set a max-height in CSS that is needed for large image
          if (style.fitHeight) {
            options.push('fit-height');
          }
          output += (0, _ImageBlock2.default)({
            id: this._domID,
            classes: ['block', 'image'].concat(options).join(' '),
            padding: style.padding,
            caption: this._image.caption,
            placeholder: _app2.default.builder.media.captionPlaceholder,
            captionEditable: app.isInBuilder
          });
        } else if (context.placement == 'background') {
          if (_UI2.default.isMobileBrowser() && this._image.alternate) {
            this._image.url = this._image.alternate;
            this._url = this._image.url;
          }

          output += (0, _ImageBackground2.default)({
            id: this._domID,
            classes: ['image', 'image-background'].join(' '),
            caption: this._image.caption
          });
        }

        return output;
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(Image.prototype.__proto__ || Object.getPrototypeOf(Image.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        /*
         * Background Image behave a little differently than other medias because
         *  - they can be in the story while they are getting uploaded and we need to support duplicate of it's view/section
         *  - in Immersive you may want to use the same image twice in the section and have different transition
         * So background Image are always duplicated inside the section
         * That's ok as browser will cache them
         */
        if (this._placement == 'block') {
          this._node = params.container.find('#' + this._domID);
        } else {
          this._node = params.container.find('#' + this._domID).parent();
        }

        if (this._isUploadPending) {
          this._onUploadStart();
        }

        this._applyConfig();
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        var options = this._image.options;

        this._applyPlacement();

        // Test
        options.size = options.size || 'small';

        _get(Image.prototype.__proto__ || Object.getPrototypeOf(Image.prototype), '_applyConfig', this).call(this, options);
      }
    }, {
      key: '_applyPlacement',
      value: function _applyPlacement() {
        if (this._image.options && this._image.options.placement) {
          var backgroundImage = this._node.find('.image-background');
          var placement = this._image.options.placement;
          // only things with these properties explicitly set should be applied
          if (placement.type === 'fill') {
            backgroundImage.css('background-size', 'cover');

            // if there's also a particular placement of the image, apply that (else just center the image)
            if (placement.fill) {
              var containerDimensions = {
                width: backgroundImage.width(),
                height: backgroundImage.height()
              };
              var rawItemDimensions = {
                width: this._image.width,
                height: this._image.height
              };
              var itemDimensions = _Media3.default.getTargetDimensions(rawItemDimensions, containerDimensions);
              var cropDistance = _Media3.default.findCropDistance(itemDimensions, backgroundImage, placement.fill);

              backgroundImage.css('background-position', cropDistance.x + 'px ' + cropDistance.y + 'px');
            } else {
              backgroundImage.css('background-position', '50% 50%');
            }
          } else if (placement.type === 'fit') {
            backgroundImage.css('background-color', placement.fit.color);
            backgroundImage.css('background-size', 'contain');
            backgroundImage.css('background-position', '50% 50%');
          }
        }
      }
    }, {
      key: 'preload',
      value: function preload() {
        var resultDeferred = new _Deferred2.default();

        var im = new window.Image();

        im.onload = function (e) {
          var width = e.currentTarget.naturalWidth,
              height = e.currentTarget.naturalHeight;

          resultDeferred.resolve({
            width: width,
            height: height
          });
        }.bind(this);

        im.onerror = this.showLoadingError.bind(this);

        im.src = _Media3.default.addToken(this._url);

        return resultDeferred;
      }
    }, {
      key: 'load',
      value: function load() {
        var resultDeferred = new _Deferred2.default();

        if (this._isLoaded || !this._node) {
          //resultDeferred.reject();
          return resultDeferred;
        }

        this._isLoaded = true;

        // Preload to get/update image dimension and hide loading indicator
        this.preload().then(function (p) {
          if (p && p.width && p.height) {
            this._image.width = p.width;
            this._image.height = p.height;

            this._node.find('.image-container').css('padding-top', this._computeBlockStyle().padding + '%');
          }
          this._node.find('.media-loading').hide();
        }.bind(this));

        if (this._placement == 'block') {
          this._node.find('.image-container').css('backgroundImage', 'url("' + _Media3.default.addToken(this._url) + '")');

          /*
          if (this._image.href) {
            this._node.find('img').click(function() {
              window.open(this._image.href, '_blank');
            });
          }
          else {
            var img = node.find('img'),
                fluidbox = img.parent();
              var onImageMaximized = function() {
              fluidbox.trigger('close.fluidbox');
              $(window).off('scroll', onImageMaximized);
            };
              fluidbox
              .on('openend.fluidbox', function() {
                $(window).scroll(onImageMaximized);
              })
              .fluidbox();
          }*/
        } else {
          this._node.find('.image-background').css('backgroundImage', 'url("' + _Media3.default.addToken(this._url) + '")');

          if (this._image['mobile-pos'] && _UI2.default.isMobileBrowser()) {
            this._node.find('.image-background').css('backgroundPositionX', this._image['mobile-pos']);
          }
        }

        resultDeferred.resolve();
        return resultDeferred;
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        if (!this._isLoaded) {
          this.load();
        }
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
        this._applyPlacement();
      }
    }, {
      key: 'isLoaded',
      value: function isLoaded() {
        return true; // TODO need to load image async
      }
    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'update',
      value: function update() {
        //
      }
    }, {
      key: 'isPlaceholder',
      value: function isPlaceholder() {
        return !!this._image.isPlaceholder;
      }
    }, {
      key: '_computeBlockStyle',
      value: function _computeBlockStyle() {
        var size = 'small',
            fitHeight = true;

        if (this._image.options) {
          if (this._image.options.size) {
            size = this._image.options.size;
          }

          if (this._image.options.fitHeight !== undefined) {
            fitHeight = this._image.options.fitHeight;
          }

          //options.push(this._image.options.filter ? ('filter-' + this._image.options.filter) : '');
        }

        /*
         * The image sizing in block using the padding technique
         * The vertical padding is relative to the width so this offer
         *  when coupled with background-image a really convenient way to avoid
         *  any JS running when resizing the app
         */
        var imHeight = this._image.height,
            avaWidth = this._image.width,
            imPadding = null;

        // Small and medium are constrained in width
        // So first need to apply that and recompute the height
        if (size == 'small' || size == 'medium') {
          var imRatio = this._image.width / imHeight;

          if (size == 'small') {
            avaWidth = app.display.windowWidth * BLOCK_WIDTH_SMALL;
          } else {
            avaWidth = app.display.windowWidth * BLOCK_WIDTH_MEDIUM;
          }

          imHeight = Math.round(avaWidth / imRatio);
          // Assuming fitHeight = true
          imHeight = Math.min(imHeight, app.display.windowHeight - BLOCK_HEIGHT_FOR_CAPTION);
        }

        // If the image is smaller than available width and
        //  - user doesn't want it to fit browser height
        //  - or the image height is smaller than browser height
        if (this._image.width < avaWidth && (!fitHeight || this._image.height < app.display.windowHeight - BLOCK_HEIGHT_FOR_CAPTION)) {
          imPadding = this._image.height / this._image.width * (this._image.width / avaWidth) * 100;
        } else {
          imPadding = imHeight / Math.min(this._image.width, avaWidth) * 100;
        }

        imPadding = Math.round(imPadding * 10) / 10;

        return {
          size: size,
          fitHeight: fitHeight,
          padding: imPadding
        };
      }
    }]);

    return Image;
  }(_Media3.default);

  exports.default = Image;
  module.exports = exports['default'];
});
//# sourceMappingURL=Image.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/ImageGallery', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.dataUrl : depth0), {"name":"if","hash":{},"fn":this.program(2, data),"inverse":this.program(4, data),"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "      <div class=\"image-gallery-item-wrapper\" style=\"height: "
    + escapeExpression(((helper = (helper = helpers.adjustedHeight || (depth0 != null ? depth0.adjustedHeight : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"adjustedHeight","hash":{},"data":data}) : helper)))
    + "px;\">\r\n        <div class=\"media-loading\">\r\n          <span class=\"large-loader\"></span>\r\n        </div>\r\n\r\n";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.dataUrl : depth0), {"name":"if","hash":{},"fn":this.program(6, data),"inverse":this.program(8, data),"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n          <img class=\"image-gallery-img-hidden\" />\r\n        </a>\r\n        <!--<div class=\"image-gallery-img\"></div>-->\r\n        <div class=\"builder-ui ig-item hidden\">\r\n          <i class=\"ig-action-icon ig-settings fa fa-pencil\"></i>\r\n          <i class=\"ig-action-icon ig-remove fa fa-trash\"></i>\r\n        </div>\r\n        <div class=\"builder-ui ig-add\" data-toggle=\"tooltip\">\r\n          <span class=\"ig-action-icon ig-add-icon glyphicon glyphicon-plus\"></span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n";
},"2":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, lambda=this.lambda;
  return "      <div class=\"image-gallery-item\" data-src=\""
    + escapeExpression(((helper = (helper = helpers.dataUrl || (depth0 != null ? depth0.dataUrl : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"dataUrl","hash":{},"data":data}) : helper)))
    + "\" data-index=\""
    + escapeExpression(lambda((data && data.index), depth0))
    + "\">\r\n";
},"4":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, lambda=this.lambda;
  return "      <div class=\"image-gallery-item\" data-src=\""
    + escapeExpression(((helper = (helper = helpers.url || (depth0 != null ? depth0.url : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"url","hash":{},"data":data}) : helper)))
    + "\" data-index=\""
    + escapeExpression(lambda((data && data.index), depth0))
    + "\">\r\n";
},"6":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "          <a href=\""
    + escapeExpression(((helper = (helper = helpers.dataUrl || (depth0 != null ? depth0.dataUrl : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"dataUrl","hash":{},"data":data}) : helper)))
    + "\" class=\"image-gallery-image-link\" data-disable-preview=\"true\" contenteditable=\"false\">\r\n";
},"8":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "          <a href=\""
    + escapeExpression(((helper = (helper = helpers.url || (depth0 != null ? depth0.url : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"url","hash":{},"data":data}) : helper)))
    + "\" class=\"image-gallery-image-link\" data-disable-preview=\"true\" contenteditable=\"false\">\r\n";
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div class=\"image-gallery-wrapper\" contenteditable=\"false\">\r\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.images : depth0), {"name":"each","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "</div>\r\n<div class=\"block-caption\" data-placeholder=\""
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\""
    + escapeExpression(((helper = (helper = helpers.captionEditable || (depth0 != null ? depth0.captionEditable : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"captionEditable","hash":{},"data":data}) : helper)))
    + "\">";
  stack1 = ((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/ImageGallery',[],function(){});
/*! jQuery v2.2.4 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="2.2.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(n.isPlainObject(d)||(e=n.isArray(d)))?(e?(e=!1,f=c&&n.isArray(c)?c:[]):f=c&&n.isPlainObject(c)?c:{},g[b]=n.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isPlainObject:function(a){var b;if("object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype||{},"isPrototypeOf"))return!1;for(b in a);return void 0===b||k.call(a,b)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=d.createElement("script"),b.text=a,d.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:h.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(c=a[b],b=a,a=c),n.isFunction(a)?(d=e.call(arguments,2),f=function(){return a.apply(b||this,d.concat(e.call(arguments)))},f.guid=a.guid=a.guid||n.guid++,f):void 0},now:Date.now,support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return h.call(b,a)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;c>b;b++)if(n.contains(e[b],this))return!0}));for(b=0;c>b;b++)n.find(a,e[b],d);return d=this.pushStack(c>1?n.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}return f=d.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?void 0!==c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b=n(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(n.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?h.call(n(a),this[0]):h.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){while((a=a[b])&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return a.contentDocument||n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||n.uniqueSort(e),D.test(a)&&e.reverse()),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=g=[],c||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.removeEventListener("DOMContentLoaded",J),a.removeEventListener("load",J),n.ready()}n.ready.promise=function(b){return I||(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll?a.setTimeout(n.ready):(d.addEventListener("DOMContentLoaded",J),a.addEventListener("load",J))),I.promise(b)},n.ready.promise();var K=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)K(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},L=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};function M(){this.expando=n.expando+M.uid++}M.uid=1,M.prototype={register:function(a,b){var c=b||{};return a.nodeType?a[this.expando]=c:Object.defineProperty(a,this.expando,{value:c,writable:!0,configurable:!0}),a[this.expando]},cache:function(a){if(!L(a))return{};var b=a[this.expando];return b||(b={},L(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[b]=c;else for(d in b)e[d]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,n.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=a[this.expando];if(void 0!==f){if(void 0===b)this.register(a);else{n.isArray(b)?d=b.concat(b.map(n.camelCase)):(e=n.camelCase(b),b in f?d=[b,e]:(d=e,d=d in f?[d]:d.match(G)||[])),c=d.length;while(c--)delete f[d[c]]}(void 0===b||n.isEmptyObject(f))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!n.isEmptyObject(b)}};var N=new M,O=new M,P=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Q=/[A-Z]/g;function R(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Q,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:P.test(c)?n.parseJSON(c):c;
}catch(e){}O.set(a,b,c)}else c=void 0;return c}n.extend({hasData:function(a){return O.hasData(a)||N.hasData(a)},data:function(a,b,c){return O.access(a,b,c)},removeData:function(a,b){O.remove(a,b)},_data:function(a,b,c){return N.access(a,b,c)},_removeData:function(a,b){N.remove(a,b)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=O.get(f),1===f.nodeType&&!N.get(f,"hasDataAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),R(f,d,e[d])));N.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){O.set(this,a)}):K(this,function(b){var c,d;if(f&&void 0===b){if(c=O.get(f,a)||O.get(f,a.replace(Q,"-$&").toLowerCase()),void 0!==c)return c;if(d=n.camelCase(a),c=O.get(f,d),void 0!==c)return c;if(c=R(f,d,void 0),void 0!==c)return c}else d=n.camelCase(a),this.each(function(){var c=O.get(this,d);O.set(this,d,b),a.indexOf("-")>-1&&void 0!==c&&O.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){O.remove(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=N.get(a,b),c&&(!d||n.isArray(c)?d=N.access(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return N.get(a,c)||N.access(a,c,{empty:n.Callbacks("once memory").add(function(){N.remove(a,[b+"queue",c])})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=N.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),U=["Top","Right","Bottom","Left"],V=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function W(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&T.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var X=/^(?:checkbox|radio)$/i,Y=/<([\w:-]+)/,Z=/^$|\/(?:java|ecma)script/i,$={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};$.optgroup=$.option,$.tbody=$.tfoot=$.colgroup=$.caption=$.thead,$.th=$.td;function _(a,b){var c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&n.nodeName(a,b)?n.merge([a],c):c}function aa(a,b){for(var c=0,d=a.length;d>c;c++)N.set(a[c],"globalEval",!b||N.get(b[c],"globalEval"))}var ba=/<|&#?\w+;/;function ca(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],o=0,p=a.length;p>o;o++)if(f=a[o],f||0===f)if("object"===n.type(f))n.merge(m,f.nodeType?[f]:f);else if(ba.test(f)){g=g||l.appendChild(b.createElement("div")),h=(Y.exec(f)||["",""])[1].toLowerCase(),i=$[h]||$._default,g.innerHTML=i[1]+n.htmlPrefilter(f)+i[2],k=i[0];while(k--)g=g.lastChild;n.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));l.textContent="",o=0;while(f=m[o++])if(d&&n.inArray(f,d)>-1)e&&e.push(f);else if(j=n.contains(f.ownerDocument,f),g=_(l.appendChild(f),"script"),j&&aa(g),c){k=0;while(f=g[k++])Z.test(f.type||"")&&c.push(f)}return l}!function(){var a=d.createDocumentFragment(),b=a.appendChild(d.createElement("div")),c=d.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var da=/^key/,ea=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,fa=/^([^.]*)(?:\.(.+)|)/;function ga(){return!0}function ha(){return!1}function ia(){try{return d.activeElement}catch(a){}}function ja(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)ja(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=ha;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.get(a);if(r){c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=n.guid++),(i=r.events)||(i=r.events={}),(g=r.handle)||(g=r.handle=function(b){return"undefined"!=typeof n&&n.event.triggered!==b.type?n.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(G)||[""],j=b.length;while(j--)h=fa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o&&(l=n.event.special[o]||{},o=(e?l.delegateType:l.bindType)||o,l=n.event.special[o]||{},k=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},f),(m=i[o])||(m=i[o]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,p,g)!==!1||a.addEventListener&&a.addEventListener(o,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),n.event.global[o]=!0)}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=N.hasData(a)&&N.get(a);if(r&&(i=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=fa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=i[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;while(f--)k=m[f],!e&&q!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete i[o])}else for(o in i)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(i)&&N.remove(a,"handle events")}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(N.get(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!==this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||d,e=c.documentElement,f=c.body,a.pageX=b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ea.test(f)?this.mouseHooks:da.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=d),3===a.target.nodeType&&(a.target=a.target.parentNode),h.filter?h.filter(a,g):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==ia()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===ia()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},n.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ga:ha):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:ha,isPropagationStopped:ha,isImmediatePropagationStopped:ha,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ga,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ga,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ga,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),n.fn.extend({on:function(a,b,c,d){return ja(this,a,b,c,d)},one:function(a,b,c,d){return ja(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=ha),this.each(function(){n.event.remove(this,a,c,b)})}});var ka=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,la=/<script|<style|<link/i,ma=/checked\s*(?:[^=]|=\s*.checked.)/i,na=/^true\/(.*)/,oa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function pa(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function qa(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function ra(a){var b=na.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function sa(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(N.hasData(a)&&(f=N.access(a),g=N.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)n.event.add(b,e,j[e][c])}O.hasData(a)&&(h=O.access(a),i=n.extend({},h),O.set(b,i))}}function ta(a,b){var c=b.nodeName.toLowerCase();"input"===c&&X.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function ua(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&ma.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),ua(f,b,c,d)});if(o&&(e=ca(b,a[0].ownerDocument,!1,a,d),g=e.firstChild,1===e.childNodes.length&&(e=g),g||d)){for(h=n.map(_(e,"script"),qa),i=h.length;o>m;m++)j=e,m!==p&&(j=n.clone(j,!0,!0),i&&n.merge(h,_(j,"script"))),c.call(a[m],j,m);if(i)for(k=h[h.length-1].ownerDocument,n.map(h,ra),m=0;i>m;m++)j=h[m],Z.test(j.type||"")&&!N.access(j,"globalEval")&&n.contains(k,j)&&(j.src?n._evalUrl&&n._evalUrl(j.src):n.globalEval(j.textContent.replace(oa,"")))}return a}function va(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(_(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&aa(_(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(ka,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=n.contains(a.ownerDocument,a);if(!(l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(g=_(h),f=_(a),d=0,e=f.length;e>d;d++)ta(f[d],g[d]);if(b)if(c)for(f=f||_(a),g=g||_(h),d=0,e=f.length;e>d;d++)sa(f[d],g[d]);else sa(a,h);return g=_(h,"script"),g.length>0&&aa(g,!i&&_(a,"script")),h},cleanData:function(a){for(var b,c,d,e=n.event.special,f=0;void 0!==(c=a[f]);f++)if(L(c)){if(b=c[N.expando]){if(b.events)for(d in b.events)e[d]?n.event.remove(c,d):n.removeEvent(c,d,b.handle);c[N.expando]=void 0}c[O.expando]&&(c[O.expando]=void 0)}}}),n.fn.extend({domManip:ua,detach:function(a){return va(this,a,!0)},remove:function(a){return va(this,a)},text:function(a){return K(this,function(a){return void 0===a?n.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.appendChild(a)}})},prepend:function(){return ua(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=pa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return ua(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(n.cleanData(_(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return K(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!la.test(a)&&!$[(Y.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(_(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return ua(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(_(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=[],e=n(a),f=e.length-1,h=0;f>=h;h++)c=h===f?this:this.clone(!0),n(e[h])[b](c),g.apply(d,c.get());return this.pushStack(d)}});var wa,xa={HTML:"block",BODY:"block"};function ya(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function za(a){var b=d,c=xa[a];return c||(c=ya(a,b),"none"!==c&&c||(wa=(wa||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=wa[0].contentDocument,b.write(),b.close(),c=ya(a,b),wa.detach()),xa[a]=c),c}var Aa=/^margin/,Ba=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ca=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Da=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Ea=d.documentElement;!function(){var b,c,e,f,g=d.createElement("div"),h=d.createElement("div");if(h.style){h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===h.style.backgroundClip,g.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",g.appendChild(h);function i(){h.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",h.innerHTML="",Ea.appendChild(g);var d=a.getComputedStyle(h);b="1%"!==d.top,f="2px"===d.marginLeft,c="4px"===d.width,h.style.marginRight="50%",e="4px"===d.marginRight,Ea.removeChild(g)}n.extend(l,{pixelPosition:function(){return i(),b},boxSizingReliable:function(){return null==c&&i(),c},pixelMarginRight:function(){return null==c&&i(),e},reliableMarginLeft:function(){return null==c&&i(),f},reliableMarginRight:function(){var b,c=h.appendChild(d.createElement("div"));return c.style.cssText=h.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",h.style.width="1px",Ea.appendChild(g),b=!parseFloat(a.getComputedStyle(c).marginRight),Ea.removeChild(g),h.removeChild(c),b}})}}();function Fa(a,b,c){var d,e,f,g,h=a.style;return c=c||Ca(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Ba.test(g)&&Aa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0!==g?g+"":g}function Ga(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Ha=/^(none|table(?!-c[ea]).+)/,Ia={position:"absolute",visibility:"hidden",display:"block"},Ja={letterSpacing:"0",fontWeight:"400"},Ka=["Webkit","O","Moz","ms"],La=d.createElement("div").style;function Ma(a){if(a in La)return a;var b=a[0].toUpperCase()+a.slice(1),c=Ka.length;while(c--)if(a=Ka[c]+b,a in La)return a}function Na(a,b,c){var d=T.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function Oa(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+U[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+U[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+U[f]+"Width",!0,e))):(g+=n.css(a,"padding"+U[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+U[f]+"Width",!0,e)));return g}function Pa(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ca(a),g="border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Fa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ba.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Oa(a,b,c||(g?"border":"content"),d,f)+"px"}function Qa(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=N.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&V(d)&&(f[g]=N.access(d,"olddisplay",za(d.nodeName)))):(e=V(d),"none"===c&&e||N.set(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Fa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=T.exec(c))&&e[1]&&(c=W(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Ma(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=Fa(a,b,d)),"normal"===e&&b in Ja&&(e=Ja[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Ha.test(n.css(a,"display"))&&0===a.offsetWidth?Da(a,Ia,function(){return Pa(a,b,d)}):Pa(a,b,d):void 0},set:function(a,c,d){var e,f=d&&Ca(a),g=d&&Oa(a,b,d,"border-box"===n.css(a,"boxSizing",!1,f),f);return g&&(e=T.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=n.css(a,b)),Na(a,c,g)}}}),n.cssHooks.marginLeft=Ga(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Fa(a,"marginLeft"))||a.getBoundingClientRect().left-Da(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px":void 0}),n.cssHooks.marginRight=Ga(l.reliableMarginRight,function(a,b){return b?Da(a,{display:"inline-block"},Fa,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Aa.test(a)||(n.cssHooks[a+b].set=Na)}),n.fn.extend({css:function(a,b){return K(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ca(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return Qa(this,!0)},hide:function(){return Qa(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}});function Ra(a,b,c,d,e){return new Ra.prototype.init(a,b,c,d,e)}n.Tween=Ra,Ra.prototype={constructor:Ra,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=Ra.propHooks[this.prop];return a&&a.get?a.get(this):Ra.propHooks._default.get(this)},run:function(a){var b,c=Ra.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Ra.propHooks._default.set(this),this}},Ra.prototype.init.prototype=Ra.prototype,Ra.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},Ra.propHooks.scrollTop=Ra.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=Ra.prototype.init,n.fx.step={};var Sa,Ta,Ua=/^(?:toggle|show|hide)$/,Va=/queueHooks$/;function Wa(){return a.setTimeout(function(){Sa=void 0}),Sa=n.now()}function Xa(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=U[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function Ya(a,b,c){for(var d,e=(_a.tweeners[b]||[]).concat(_a.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function Za(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},o=a.style,p=a.nodeType&&V(a),q=N.get(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=n.css(a,"display"),k="none"===j?N.get(a,"olddisplay")||za(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(o.display="inline-block")),c.overflow&&(o.overflow="hidden",l.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],Ua.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(p?"hide":"show")){if("show"!==e||!q||void 0===q[d])continue;p=!0}m[d]=q&&q[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(m))"inline"===("none"===j?za(a.nodeName):j)&&(o.display=j);else{q?"hidden"in q&&(p=q.hidden):q=N.access(a,"fxshow",{}),f&&(q.hidden=!p),p?n(a).show():l.done(function(){n(a).hide()}),l.done(function(){var b;N.remove(a,"fxshow");for(b in m)n.style(a,b,m[b])});for(d in m)g=Ya(p?q[d]:0,d,l),d in q||(q[d]=g.start,p&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function $a(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function _a(a,b,c){var d,e,f=0,g=_a.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Sa||Wa(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:Sa||Wa(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for($a(k,j.opts.specialEasing);g>f;f++)if(d=_a.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,Ya,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(_a,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return W(c.elem,a,T.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],_a.tweeners[c]=_a.tweeners[c]||[],_a.tweeners[c].unshift(b)},prefilters:[Za],prefilter:function(a,b){b?_a.prefilters.unshift(a):_a.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=_a(this,n.extend({},a),f);(e||N.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=N.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&Va.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=N.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Xa(b,!0),a,d,e)}}),n.each({slideDown:Xa("show"),slideUp:Xa("hide"),slideToggle:Xa("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=0,c=n.timers;for(Sa=n.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||n.fx.stop(),Sa=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Ta||(Ta=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(Ta),Ta=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=d.createElement("input"),b=d.createElement("select"),c=b.appendChild(d.createElement("option"));a.type="checkbox",l.checkOn=""!==a.value,l.optSelected=c.selected,b.disabled=!0,l.optDisabled=!c.disabled,a=d.createElement("input"),a.value="t",a.type="radio",l.radioValue="t"===a.value}();var ab,bb=n.expr.attrHandle;n.fn.extend({attr:function(a,b){return K(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ab:void 0)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)}}),ab={set:function(a,b,c){return b===!1?n.removeAttr(a,c):a.setAttribute(c,c),c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=bb[b]||n.find.attr;bb[b]=function(a,b,d){var e,f;return d||(f=bb[b],bb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,bb[b]=f),e}});var cb=/^(?:input|select|textarea|button)$/i,db=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return K(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[n.propFix[a]||a]})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),
void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):cb.test(a.nodeName)||db.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var eb=/[\t\r\n\f]/g;function fb(a){return a.getAttribute&&a.getAttribute("class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,fb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=fb(c),d=1===c.nodeType&&(" "+e+" ").replace(eb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&c.setAttribute("class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,fb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=fb(c),d=1===c.nodeType&&(" "+e+" ").replace(eb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&c.setAttribute("class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,fb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=fb(this),b&&N.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":N.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+fb(c)+" ").replace(eb," ").indexOf(b)>-1)return!0;return!1}});var gb=/\r/g,hb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(gb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(hb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)d=e[g],(d.selected=n.inArray(n.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var ib=/^(?:focusinfocus|focusoutblur)$/;n.extend(n.event,{trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(h=i=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!ib.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),l=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),o=n.event.special[q]||{},f||!o.trigger||o.trigger.apply(e,c)!==!1)){if(!f&&!o.noBubble&&!n.isWindow(e)){for(j=o.delegateType||q,ib.test(j+q)||(h=h.parentNode);h;h=h.parentNode)p.push(h),i=h;i===(e.ownerDocument||d)&&p.push(i.defaultView||i.parentWindow||a)}g=0;while((h=p[g++])&&!b.isPropagationStopped())b.type=g>1?j:o.bindType||q,m=(N.get(h,"events")||{})[b.type]&&N.get(h,"handle"),m&&m.apply(h,c),m=l&&h[l],m&&m.apply&&L(h)&&(b.result=m.apply(h,c),b.result===!1&&b.preventDefault());return b.type=q,f||b.isDefaultPrevented()||o._default&&o._default.apply(p.pop(),c)!==!1||!L(e)||l&&n.isFunction(e[q])&&!n.isWindow(e)&&(i=e[l],i&&(e[l]=null),n.event.triggered=q,e[q](),n.event.triggered=void 0,i&&(e[l]=i)),b.result}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b)}}),n.fn.extend({trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),l.focusin="onfocusin"in a,l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=N.access(d,b);e||d.addEventListener(a,c,!0),N.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=N.access(d,b)-1;e?N.access(d,b,e):(d.removeEventListener(a,c,!0),N.remove(d,b))}}});var jb=a.location,kb=n.now(),lb=/\?/;n.parseJSON=function(a){return JSON.parse(a+"")},n.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return c&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var mb=/#.*$/,nb=/([?&])_=[^&]*/,ob=/^(.*?):[ \t]*([^\r\n]*)$/gm,pb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,qb=/^(?:GET|HEAD)$/,rb=/^\/\//,sb={},tb={},ub="*/".concat("*"),vb=d.createElement("a");vb.href=jb.href;function wb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function xb(a,b,c,d){var e={},f=a===tb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function yb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&n.extend(!0,a,d),a}function zb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Ab(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:jb.href,type:"GET",isLocal:pb.test(jb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?yb(yb(a,n.ajaxSettings),b):yb(n.ajaxSettings,a)},ajaxPrefilter:wb(sb),ajaxTransport:wb(tb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m=n.ajaxSetup({},c),o=m.context||m,p=m.context&&(o.nodeType||o.jquery)?n(o):n.event,q=n.Deferred(),r=n.Callbacks("once memory"),s=m.statusCode||{},t={},u={},v=0,w="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(2===v){if(!h){h={};while(b=ob.exec(g))h[b[1].toLowerCase()]=b[2]}b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===v?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return v||(a=u[c]=u[c]||a,t[a]=b),this},overrideMimeType:function(a){return v||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>v)for(b in a)s[b]=[s[b],a[b]];else x.always(a[x.status]);return this},abort:function(a){var b=a||w;return e&&e.abort(b),z(0,b),this}};if(q.promise(x).complete=r.add,x.success=x.done,x.error=x.fail,m.url=((b||m.url||jb.href)+"").replace(mb,"").replace(rb,jb.protocol+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=n.trim(m.dataType||"*").toLowerCase().match(G)||[""],null==m.crossDomain){j=d.createElement("a");try{j.href=m.url,j.href=j.href,m.crossDomain=vb.protocol+"//"+vb.host!=j.protocol+"//"+j.host}catch(y){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=n.param(m.data,m.traditional)),xb(sb,m,c,x),2===v)return x;k=n.event&&m.global,k&&0===n.active++&&n.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!qb.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(lb.test(f)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=nb.test(f)?f.replace(nb,"$1_="+kb++):f+(lb.test(f)?"&":"?")+"_="+kb++)),m.ifModified&&(n.lastModified[f]&&x.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&x.setRequestHeader("If-None-Match",n.etag[f])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",m.contentType),x.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+ub+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)x.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(o,x,m)===!1||2===v))return x.abort();w="abort";for(l in{success:1,error:1,complete:1})x[l](m[l]);if(e=xb(tb,m,c,x)){if(x.readyState=1,k&&p.trigger("ajaxSend",[x,m]),2===v)return x;m.async&&m.timeout>0&&(i=a.setTimeout(function(){x.abort("timeout")},m.timeout));try{v=1,e.send(t,z)}catch(y){if(!(2>v))throw y;z(-1,y)}}else z(-1,"No Transport");function z(b,c,d,h){var j,l,t,u,w,y=c;2!==v&&(v=2,i&&a.clearTimeout(i),e=void 0,g=h||"",x.readyState=b>0?4:0,j=b>=200&&300>b||304===b,d&&(u=zb(m,x,d)),u=Ab(m,u,x,j),j?(m.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(n.lastModified[f]=w),w=x.getResponseHeader("etag"),w&&(n.etag[f]=w)),204===b||"HEAD"===m.type?y="nocontent":304===b?y="notmodified":(y=u.state,l=u.data,t=u.error,j=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),x.status=b,x.statusText=(c||y)+"",j?q.resolveWith(o,[l,y,x]):q.rejectWith(o,[x,y,t]),x.statusCode(s),s=void 0,k&&p.trigger(j?"ajaxSuccess":"ajaxError",[x,m,j?l:t]),r.fireWith(o,[x,y]),k&&(p.trigger("ajaxComplete",[x,m]),--n.active||n.event.trigger("ajaxStop")))}return x},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){var b;return n.isFunction(a)?this.each(function(b){n(this).wrapAll(a.call(this,b))}):(this[0]&&(b=n(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstElementChild)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return!n.expr.filters.visible(a)},n.expr.filters.visible=function(a){return a.offsetWidth>0||a.offsetHeight>0||a.getClientRects().length>0};var Bb=/%20/g,Cb=/\[\]$/,Db=/\r?\n/g,Eb=/^(?:submit|button|image|reset|file)$/i,Fb=/^(?:input|select|textarea|keygen)/i;function Gb(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Cb.test(a)?d(a,e):Gb(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Gb(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Gb(c,a[c],b,e);return d.join("&").replace(Bb,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Fb.test(this.nodeName)&&!Eb.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Db,"\r\n")}}):{name:b.name,value:c.replace(Db,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Hb={0:200,1223:204},Ib=n.ajaxSettings.xhr();l.cors=!!Ib&&"withCredentials"in Ib,l.ajax=Ib=!!Ib,n.ajaxTransport(function(b){var c,d;return l.cors||Ib&&!b.crossDomain?{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Hb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(e,f){b=n("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&f("error"===a.type?404:200,a.type)}),d.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Jb=[],Kb=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Jb.pop()||n.expando+"_"+kb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Kb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Kb,"$1"+e):b.jsonp!==!1&&(b.url+=(lb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Jb.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ca([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var Lb=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&Lb)return Lb.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function Mb(a){return n.isWindow(a)?a:9===a.nodeType&&a.defaultView}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,n.contains(b,d)?(e=d.getBoundingClientRect(),c=Mb(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===n.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(d=a.offset()),d.top+=n.css(a[0],"borderTopWidth",!0),d.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-n.css(c,"marginTop",!0),left:b.left-d.left-n.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Ea})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;n.fn[a]=function(d){return K(this,function(a,d,e){var f=Mb(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ga(l.pixelPosition,function(a,c){return c?(c=Fa(a,b),Ba.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return K(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},size:function(){return this.length}}),n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Nb=a.jQuery,Ob=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=Ob),b&&a.jQuery===n&&(a.jQuery=Nb),n},b||(a.jQuery=a.$=n),n});

define("lib/jquery/dist/jquery.min", function(){});

!function(a,b,c,d){"use strict";function e(b,c){this.element=b;var d={};a.each(a(this.element).data(),function(a,b){var c=function(a){return a&&a[0].toLowerCase()+a.slice(1)},e=c(a.replace("fluidbox",""));(""!==e||null!==e)&&(b="false"==b?!1:!0,d[e]=b)}),this.settings=a.extend({},h,c,d),this.settings.viewportFill=Math.max(Math.min(parseFloat(this.settings.viewportFill),1),0),this.settings.stackIndex<this.settings.stackIndexDelta&&(settings.stackIndexDelta=settings.stackIndex),this._name=g,this.init()}var f=a(b),g=(a(c),"fluidbox"),h={immediateOpen:!1,loader:!1,maxWidth:0,maxHeight:0,resizeThrottle:500,stackIndex:1e3,stackIndexDelta:10,viewportFill:.95},i={},j=0;("undefined"==typeof console||"undefined"===console.warn)&&(console={},console.warn=function(){}),a.isFunction(a.throttle)||console.warn("Fluidbox: The jQuery debounce/throttle plugin is not found/loaded. Even though Fluidbox works without it, the window resize event will fire extremely rapidly in browsers, resulting in significant degradation in performance upon viewport resize.");var k=function(){var a,b=c.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in e)if(b.style[a]!==d)return e[a]},l=k(),m={dom:function(){var b=a("<div />",{"class":"fluidbox__wrap",css:{zIndex:this.settings.stackIndex-this.settings.stackIndexDelta}});if(a(this.element).addClass("fluidbox--closed").wrapInner(b).find("img").first().css({opacity:1}).addClass("fluidbox__thumb").after('<div class="fluidbox__ghost" />'),this.settings.loader){var c=a("<div />",{"class":"fluidbox__loader",css:{zIndex:2}});a(this.element).find(".fluidbox__wrap").append(c)}},prepareFb:function(){var b=this,c=a(this.element);c.trigger("thumbloaddone.fluidbox"),m.measure.fbElements.call(this),b.bindEvents(),c.addClass("fluidbox--ready"),b.bindListeners(),c.trigger("ready.fluidbox")},measure:{viewport:function(){i.viewport={w:f.width(),h:f.height()}},fbElements:function(){var b=this,c=a(this.element),d=c.find("img").first(),e=c.find(".fluidbox__ghost"),f=c.find(".fluidbox__wrap");b.instanceData.thumb={natW:d[0].naturalWidth,natH:d[0].naturalHeight,w:d.width(),h:d.height()},e.css({width:d.width(),height:d.height(),top:d.offset().top-f.offset().top+parseInt(d.css("borderTopWidth"))+parseInt(d.css("paddingTop")),left:d.offset().left-f.offset().left+parseInt(d.css("borderLeftWidth"))+parseInt(d.css("paddingLeft"))})}},checkURL:function(a){var b=0;return/[\s+]/g.test(a)?(console.warn("Fluidbox: Fluidbox opening is halted because it has detected characters in your URL string that need to be properly encoded/escaped. Whitespace(s) have to be escaped manually. See RFC3986 documentation."),b=1):/[\"\'\(\)]/g.test(a)&&(console.warn("Fluidbox: Fluidbox opening will proceed, but it has detected characters in your URL string that need to be properly encoded/escaped. These will be escaped for you. See RFC3986 documentation."),b=0),b},formatURL:function(a){return a.replace(/"/g,"%22").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}};a.extend(e.prototype,{init:function(){var b=this,c=a(this.element),d=c.find("img").first();if(m.measure.viewport(),(!b.instanceData||!b.instanceData.initialized)&&c.is("a")&&1===c.children().length&&(c.children().is("img")||c.children().is("picture")&&1===c.find("img").length)&&"none"!==c.css("display")&&"none"!==c.children().css("display")&&"none"!==c.parents().css("display")){c.removeClass("fluidbox--destroyed"),b.instanceData={},b.instanceData.initialized=!0,b.instanceData.originalNode=c.html(),j+=1,b.instanceData.id=j,c.addClass("fluidbox__instance-"+j),c.addClass("fluidbox--initialized"),m.dom.call(b),c.trigger("init.fluidbox");var e=new Image;d.width()>0&&d.height()>0?m.prepareFb.call(b):(e.onload=function(){m.prepareFb.call(b)},e.onerror=function(){c.trigger("thumbloadfail.fluidbox")},e.src=d.attr("src"))}},open:function(){var b=this,c=a(this.element),d=c.find("img").first(),e=c.find(".fluidbox__ghost"),f=c.find(".fluidbox__wrap");b.instanceData.state=1,e.off(l),a(".fluidbox--opened").fluidbox("close");var g=a("<div />",{"class":"fluidbox__overlay",css:{zIndex:-1}});if(f.append(g),c.removeClass("fluidbox--closed").addClass("fluidbox--loading"),m.checkURL(d.attr("src")))return b.close(),!1;e.css({"background-image":"url("+m.formatURL(d.attr("src"))+")",opacity:1}),m.measure.fbElements.call(b);var h;b.settings.immediateOpen?(c.addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:b.settings.stackIndex+b.settings.stackIndexDelta}),c.trigger("openstart.fluidbox"),b.compute(),d.css({opacity:0}),a(".fluidbox__overlay").css({opacity:1}),e.one(l,function(){c.trigger("openend.fluidbox")}),h=new Image,h.onload=function(){if(1===b.instanceData.state){if(b.instanceData.thumb.natW=h.naturalWidth,b.instanceData.thumb.natH=h.naturalHeight,c.removeClass("fluidbox--loading"),m.checkURL(h.src))return b.close(),!1;e.css({"background-image":"url("+m.formatURL(h.src)+")"}),b.compute()}},h.onerror=function(){b.close(),c.trigger("imageloadfail.fluidbox"),c.trigger("delayedloadfail.fluidbox")},h.src=c.attr("href")):(h=new Image,h.onload=function(){return c.removeClass("fluidbox--loading").addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:b.settings.stackIndex+b.settings.stackIndexDelta}),c.trigger("openstart.fluidbox"),m.checkURL(h.src)?(b.close(),!1):(e.css({"background-image":"url("+m.formatURL(h.src)+")"}),b.instanceData.thumb.natW=h.naturalWidth,b.instanceData.thumb.natH=h.naturalHeight,b.compute(),d.css({opacity:0}),a(".fluidbox__overlay").css({opacity:1}),void e.one(l,function(){c.trigger("openend.fluidbox")}))},h.onerror=function(){b.close(),c.trigger("imageloadfail.fluidbox")},h.src=c.attr("href"))},compute:function(){var b=this,c=a(this.element),d=c.find("img").first(),e=c.find(".fluidbox__ghost"),g=c.find(".fluidbox__wrap"),h=b.instanceData.thumb.natW,j=b.instanceData.thumb.natH,k=b.instanceData.thumb.w,l=b.instanceData.thumb.h,m=h/j,n=i.viewport.w/i.viewport.h;b.settings.maxWidth>0?(h=b.settings.maxWidth,j=h/m):b.settings.maxHeight>0&&(j=b.settings.maxHeight,h=j*m);var o,p,q,r,s;n>m?(o=j<i.viewport.h?j:i.viewport.h*b.settings.viewportFill,q=o/l,r=h*(l*q/j)/k,s=q):(p=h<i.viewport.w?h:i.viewport.w*b.settings.viewportFill,r=p/k,q=j*(k*r/h)/l,s=r),b.settings.maxWidth&&b.settings.maxHeight&&console.warn("Fluidbox: Both maxHeight and maxWidth are specified. You can only specify one. If both are specified, only the maxWidth property will be respected. This will not generate any error, but may cause unexpected sizing behavior.");var t=f.scrollTop()-d.offset().top+.5*(l*(s-1))+.5*(f.height()-l*s),u=.5*(k*(s-1))+.5*(f.width()-k*s)-d.offset().left,v=parseInt(100*r)/100+","+parseInt(100*q)/100;e.css({transform:"translate("+parseInt(100*u)/100+"px,"+parseInt(100*t)/100+"px) scale("+v+")",top:d.offset().top-g.offset().top,left:d.offset().left-g.offset().left}),c.find(".fluidbox__loader").css({transform:"translate("+parseInt(100*u)/100+"px,"+parseInt(100*t)/100+"px) scale("+v+")"}),c.trigger("computeend.fluidbox")},recompute:function(){this.compute()},close:function(){var b=this,c=a(this.element),e=c.find("img").first(),f=c.find(".fluidbox__ghost"),g=c.find(".fluidbox__wrap"),h=c.find(".fluidbox__overlay");return null===b.instanceData.state||typeof b.instanceData.state==typeof d||0===b.instanceData.state?!1:(b.instanceData.state=0,c.trigger("closestart.fluidbox"),c.removeClass(function(a,b){return(b.match(/(^|\s)fluidbox--(opened|loaded|loading)+/g)||[]).join(" ")}).addClass("fluidbox--closed"),f.css({transform:"translate(0,0) scale(1,1)",top:e.offset().top-g.offset().top+parseInt(e.css("borderTopWidth"))+parseInt(e.css("paddingTop")),left:e.offset().left-g.offset().left+parseInt(e.css("borderLeftWidth"))+parseInt(e.css("paddingLeft"))}),c.find(".fluidbox__loader").css({transform:"none"}),f.one(l,function(){f.css({opacity:0}),e.css({opacity:1}),h.remove(),g.css({zIndex:b.settings.stackIndex-b.settings.stackIndexDelta}),c.trigger("closeend.fluidbox")}),void h.css({opacity:0}))},bindEvents:function(){var b=this,c=a(this.element);c.on("click.fluidbox",function(a){a.preventDefault(),b.instanceData.state&&0!==b.instanceData.state?b.close():b.open()})},bindListeners:function(){var b=this,c=a(this.element),d=function(){m.measure.viewport(),m.measure.fbElements.call(b),c.hasClass("fluidbox--opened")&&b.compute()};a.isFunction(a.throttle)?f.on("resize.fluidbox"+b.instanceData.id,a.throttle(b.settings.resizeThrottle,d)):f.on("resize.fluidbox"+b.instanceData.id,d),c.on("reposition.fluidbox",function(){b.reposition()}),c.on("recompute.fluidbox, compute.fluidbox",function(){b.compute()}),c.on("destroy.fluidbox",function(){b.destroy()}),c.on("close.fluidbox",function(){b.close()})},unbind:function(){a(this.element).off("click.fluidbox reposition.fluidbox recompute.fluidbox compute.fluidbox destroy.fluidbox close.fluidbox"),f.off("resize.fluidbox"+this.instanceData.id)},reposition:function(){m.measure.fbElements.call(this)},destroy:function(){var b=this.instanceData.originalNode;this.unbind(),a.data(this.element,"plugin_"+g,null),a(this.element).removeClass(function(a,b){return(b.match(/(^|\s)fluidbox[--|__]\S+/g)||[]).join(" ")}).empty().html(b).addClass("fluidbox--destroyed").trigger("destroyed.fluidbox")},getMetadata:function(){return this.instanceData}}),a.fn[g]=function(b){var c=arguments;if(b===d||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+g)||a.data(this,"plugin_"+g,new e(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var f;return this.each(function(){var d=a.data(this,"plugin_"+g);d instanceof e&&"function"==typeof d[b]?f=d[b].apply(d,Array.prototype.slice.call(c,1)):console.warn('Fluidbox: The method "'+b+'" used is not defined in Fluidbox. Please make sure you are calling the correct public method.')}),f!==d?f:this}return this}}(jQuery,window,document);
define("lib/fluidbox/dist/js/jquery.fluidbox.min", function(){});


define('lib-build/css!lib/fluidbox/dist/css/fluidbox.min',[],function(){});
define('storymaps-react/tpl/view/media/ImageGallery',['module', 'exports', './Media', 'lib-build/hbars!./ImageGallery', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'dojo/_base/lang', 'lib-build/less!./ImageGallery', 'lib/jquery/dist/jquery.min', 'lib/fluidbox/dist/js/jquery.fluidbox.min', 'lib-build/css!lib/fluidbox/dist/css/fluidbox.min'], function (module, exports, _Media2, _ImageGallery, _app, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _ImageGallery2 = _interopRequireDefault(_ImageGallery);

  var _app2 = _interopRequireDefault(_app);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var ImageGallery = function (_Media) {
    _inherits(ImageGallery, _Media);

    function ImageGallery(images) {
      _classCallCheck(this, ImageGallery);

      var _this = _possibleConstructorReturn(this, (ImageGallery.__proto__ || Object.getPrototypeOf(ImageGallery)).call(this, {
        type: 'image-gallery',
        id: null,
        previewThumb: null,
        previewIcon: null
      }));

      _this._images = images;
      _this._placement = null;
      return _this;
    }

    _createClass(ImageGallery, [{
      key: 'render',
      value: function render(context) {
        if (!this._images || !context || context.placement != 'block') {
          console.log('Could not render image gallery in section');
          return '';
        }

        this._placement = context.placement;

        return this._render(true);
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(ImageGallery.prototype.__proto__ || Object.getPrototypeOf(ImageGallery.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        this._node = params.container.find('#' + this._domID);
      }
    }, {
      key: 'load',
      value: function load() {
        if (this._isLoaded) {
          return;
        }

        this._isLoaded = true;

        this._node.find('.image-gallery-item').each(function () {
          var node = $(this),
              imgHidden = node.find('.image-gallery-img-hidden'),
              img = node.find('.image-gallery-img'),
              fluidbox = imgHidden.parent();

          imgHidden.attr('src', node.data('src'));
          img.css('backgroundImage', 'url("' + node.data('src') + '"');

          //
          // Image maximize
          //

          var onImageMaximized = function onImageMaximized() {
            fluidbox.trigger('close.fluidbox');
            $(window).off('scroll', onImageMaximized);
          };

          fluidbox.on('openend.fluidbox', function () {
            $(window).scroll(onImageMaximized);
          }).fluidbox({
            maxWidth: app.display.windowWidth
          });

          //
          // Loading indicator
          //
          var im = new window.Image();

          im.onload = function () {
            node.find('.media-loading').hide();
          }.bind(this);

          im.src = node.data('src');
        });
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        //
      }
    }, {
      key: '_update',
      value: function _update() {
        this._node.html(this._render(false));
        this._isLoaded = false;
        this.load();
      }
    }, {
      key: '_calculateImageHeights',
      value: function _calculateImageHeights() {
        var isMobile = app.display.windowWidth < 768;

        var spaceBetweenImage = 15;
        // total image gutter space
        var spaceBetweenImages = spaceBetweenImage * (this._images.images.length - 1);
        // width allowed for block
        var blockWidth = app.display.windowWidth * (isMobile ? 0.9 : 0.8);
        // width for images is that minus what's needed for image gutters
        var widthForImages = blockWidth - spaceBetweenImages;

        // if mobile, each image gets 50% of the width (minus a padding of course)
        var widthForMobileImage = (blockWidth - spaceBetweenImage) / 2;

        var widthForDesktopImage = widthForImages / this._images.images.length;
        // each one gets an equal amount of width to use
        var widthForEachImage = isMobile ? widthForMobileImage : widthForDesktopImage;

        for (var i = 0; i < this._images.images.length; i++) {
          var image = this._images.images[i];
          var imageHeight = 0;
          var imageRatio = image.width / image.height;
          // the adjusted height is based on the width it can take in the gallery
          // if the image natural width is less than the width allotted for it, use its natural height

          if (image.width < widthForEachImage) {
            imageHeight = image.height;
          } else {
            imageHeight = Math.round(widthForEachImage / imageRatio);
          }
          image.adjustedHeight = imageHeight;
        }
      }
    }, {
      key: '_render',
      value: function _render(initialRender) {

        this._calculateImageHeights();

        var template = (0, _ImageGallery2.default)({
          images: this._addTokens(this._images.images),
          caption: this._images.caption,
          placeholder: _app2.default.builder.media.captionPlaceholder,
          captionEditable: app.isInBuilder
        });

        // if initial render, set the wrapper div and the height with the template. If not, just set the height and the template.
        if (initialRender) {
          return '<div id="' + this._domID + '" class="block image-gallery" contenteditable="false">' + template + '</div>';
        } else {
          return template;
        }
      }
    }, {
      key: '_addTokens',
      value: function _addTokens(imagesOrig) {
        var images = _lang2.default.clone(imagesOrig);

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = images[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var image = _step.value;

            image.url = _Media3.default.addToken(image.url);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return images;
      }
    }]);

    return ImageGallery;
  }(_Media3.default);

  exports.default = ImageGallery;
  module.exports = exports['default'];
});
//# sourceMappingURL=ImageGallery.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/VideoBlock', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.domId || (depth0 != null ? depth0.domId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"domId","hash":{},"data":data}) : helper)))
    + "\" class=\"block block-type-video\" contenteditable=\"false\">\r\n  <div class=\"block-media\">\r\n    <div class=\"media-loading\">\r\n      <span class=\"large-loader\"></span>\r\n    </div>\r\n    <div class=\"media-media video video-fg video-player\" data-id=\""
    + escapeExpression(((helper = (helper = helpers.videoId || (depth0 != null ? depth0.videoId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"videoId","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n    <div class=\"builder-ui media-cfg-invite\"></div>\r\n    <div class=\"builder-ui media-delete\"></div>\r\n  </div>\r\n  <div class=\"block-caption\" data-placeholder=\""
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\""
    + escapeExpression(((helper = (helper = helpers.captionEditable || (depth0 != null ? depth0.captionEditable : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"captionEditable","hash":{},"data":data}) : helper)))
    + "\">";
  stack1 = ((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n  <div class=\"builder-ui media-cfg-panel\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/VideoBackground', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div class=\"media-loading\">\r\n  <span class=\"large-loader\"></span>\r\n</div>\r\n<div id=\""
    + escapeExpression(((helper = (helper = helpers.domId || (depth0 != null ? depth0.domId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"domId","hash":{},"data":data}) : helper)))
    + "\" class=\"video-viewport\">\r\n  <div class=\"media-media video video-player\" data-id=\""
    + escapeExpression(((helper = (helper = helpers.videoId || (depth0 != null ? depth0.videoId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"videoId","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n</div>\r\n<div class=\"builder-ui media-cfg-invite\"></div>\r\n<div class=\"builder-ui media-cfg-panel\"></div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/VideoVimeo', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<iframe id=\""
    + escapeExpression(((helper = (helper = helpers.domId || (depth0 != null ? depth0.domId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"domId","hash":{},"data":data}) : helper)))
    + "\" class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" src=\""
    + escapeExpression(((helper = (helper = helpers.url || (depth0 != null ? depth0.url : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"url","hash":{},"data":data}) : helper)))
    + "\" style=\""
    + escapeExpression(((helper = (helper = helpers.options || (depth0 != null ? depth0.options : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"options","hash":{},"data":data}) : helper)))
    + "\"></iframe>\r\n"
    + escapeExpression(((helper = (helper = helpers.playerControls || (depth0 != null ? depth0.playerControls : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"playerControls","hash":{},"data":data}) : helper)))
    + "\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/Video',[],function(){});
// Init style shamelessly stolen from jQuery http://jquery.com
var Froogaloop = (function(){
    // Define a local copy of Froogaloop
    function Froogaloop(iframe) {
        // The Froogaloop object is actually just the init constructor
        return new Froogaloop.fn.init(iframe);
    }

    var eventCallbacks = {},
        hasWindowEvent = false,
        isReady = false,
        slice = Array.prototype.slice,
        playerOrigin = '*';

    Froogaloop.fn = Froogaloop.prototype = {
        element: null,

        init: function(iframe) {
            if (typeof iframe === "string") {
                iframe = document.getElementById(iframe);
            }

            this.element = iframe;

            return this;
        },

        /*
         * Calls a function to act upon the player.
         *
         * @param {string} method The name of the Javascript API method to call. Eg: 'play'.
         * @param {Array|Function} valueOrCallback params Array of parameters to pass when calling an API method
         *                                or callback function when the method returns a value.
         */
        api: function(method, valueOrCallback) {
            if (!this.element || !method) {
                return false;
            }

            var self = this,
                element = self.element,
                target_id = element.id !== '' ? element.id : null,
                params = !isFunction(valueOrCallback) ? valueOrCallback : null,
                callback = isFunction(valueOrCallback) ? valueOrCallback : null;

            // Store the callback for get functions
            if (callback) {
                storeCallback(method, callback, target_id);
            }

            postMessage(method, params, element);
            return self;
        },

        /*
         * Registers an event listener and a callback function that gets called when the event fires.
         *
         * @param eventName (String): Name of the event to listen for.
         * @param callback (Function): Function that should be called when the event fires.
         */
        addEvent: function(eventName, callback) {
            if (!this.element) {
                return false;
            }

            var self = this,
                element = self.element,
                target_id = element.id !== '' ? element.id : null;


            storeCallback(eventName, callback, target_id);

            // The ready event is not registered via postMessage. It fires regardless.
            if (eventName != 'ready') {
                postMessage('addEventListener', eventName, element);
            }
            else if (eventName == 'ready' && isReady) {
                callback.call(null, target_id);
            }

            return self;
        },

        /*
         * Unregisters an event listener that gets called when the event fires.
         *
         * @param eventName (String): Name of the event to stop listening for.
         */
        removeEvent: function(eventName) {
            if (!this.element) {
                return false;
            }

            var self = this,
                element = self.element,
                target_id = element.id !== '' ? element.id : null,
                removed = removeCallback(eventName, target_id);

            // The ready event is not registered
            if (eventName != 'ready' && removed) {
                postMessage('removeEventListener', eventName, element);
            }
        }
    };

    /**
     * Handles posting a message to the parent window.
     *
     * @param method (String): name of the method to call inside the player. For api calls
     * this is the name of the api method (api_play or api_pause) while for events this method
     * is api_addEventListener.
     * @param params (Object or Array): List of parameters to submit to the method. Can be either
     * a single param or an array list of parameters.
     * @param target (HTMLElement): Target iframe to post the message to.
     */
    function postMessage(method, params, target) {
        if (!target.contentWindow.postMessage) {
            return false;
        }

        var data = JSON.stringify({
            method: method,
            value: params
        });

        target.contentWindow.postMessage(data, playerOrigin);
    }

    /**
     * Event that fires whenever the window receives a message from its parent
     * via window.postMessage.
     */
    function onMessageReceived(event) {
        var data, method;

        try {
            data = JSON.parse(event.data);
            method = data.event || data.method;
        }
        catch(e)  {
            //fail silently... like a ninja!
        }

        if (method == 'ready' && !isReady) {
            isReady = true;
        }

        // Handles messages from the vimeo player only
        if (!(/^https?:\/\/player.vimeo.com/).test(event.origin)) {
            return false;
        }

        if (playerOrigin === '*') {
            playerOrigin = event.origin;
        }

        var value = data.value,
            eventData = data.data,
            target_id = target_id === '' ? null : data.player_id,

            callback = getCallback(method, target_id),
            params = [];

        if (!callback) {
            return false;
        }

        if (value !== undefined) {
            params.push(value);
        }

        if (eventData) {
            params.push(eventData);
        }

        if (target_id) {
            params.push(target_id);
        }

        return params.length > 0 ? callback.apply(null, params) : callback.call();
    }


    /**
     * Stores submitted callbacks for each iframe being tracked and each
     * event for that iframe.
     *
     * @param eventName (String): Name of the event. Eg. api_onPlay
     * @param callback (Function): Function that should get executed when the
     * event is fired.
     * @param target_id (String) [Optional]: If handling more than one iframe then
     * it stores the different callbacks for different iframes based on the iframe's
     * id.
     */
    function storeCallback(eventName, callback, target_id) {
        if (target_id) {
            if (!eventCallbacks[target_id]) {
                eventCallbacks[target_id] = {};
            }
            eventCallbacks[target_id][eventName] = callback;
        }
        else {
            eventCallbacks[eventName] = callback;
        }
    }

    /**
     * Retrieves stored callbacks.
     */
    function getCallback(eventName, target_id) {
        if (target_id) {
            return eventCallbacks[target_id][eventName];
        }
        else {
            return eventCallbacks[eventName];
        }
    }

    function removeCallback(eventName, target_id) {
        if (target_id && eventCallbacks[target_id]) {
            if (!eventCallbacks[target_id][eventName]) {
                return false;
            }
            eventCallbacks[target_id][eventName] = null;
        }
        else {
            if (!eventCallbacks[eventName]) {
                return false;
            }
            eventCallbacks[eventName] = null;
        }

        return true;
    }

    function isFunction(obj) {
        return !!(obj && obj.constructor && obj.call && obj.apply);
    }

    function isArray(obj) {
        return toString.call(obj) === '[object Array]';
    }

    // Give the init function the Froogaloop prototype for later instantiation
    Froogaloop.fn.init.prototype = Froogaloop.fn;

    // Listens for the message event.
    // W3C
    if (window.addEventListener) {
        window.addEventListener('message', onMessageReceived, false);
    }
    // IE
    else {
        window.attachEvent('onmessage', onMessageReceived);
    }

    // Expose froogaloop to the global object
    return (window.Froogaloop = window.$f = Froogaloop);

})();

define("lib/froogaloop/froogaloop", function(){});


if (!window['YT']) {var YT = {loading: 0,loaded: 0};}if (!window['YTConfig']) {var YTConfig = {'host': 'http://www.youtube.com'};}if (!YT.loading) {YT.loading = 1;(function(){var l = [];YT.ready = function(f) {if (YT.loaded) {f();} else {l.push(f);}};window.onYTReady = function() {YT.loaded = 1;for (var i = 0; i < l.length; i++) {try {l[i]();} catch (e) {}}};YT.setConfig = function(c) {for (var k in c) {if (c.hasOwnProperty(k)) {YTConfig[k] = c[k];}}};var a = document.createElement('script');a.type = 'text/javascript';a.id = 'www-widgetapi-script';a.src = 'https:' + '//s.ytimg.com/yts/jsbin/www-widgetapi-vflQ3JBIv/www-widgetapi.js';a.async = true;var b = document.getElementsByTagName('script')[0];b.parentNode.insertBefore(a, b);})();};
define("lib/youtube-api/index", function(){});

define('storymaps-react/tpl/view/media/Video',['module', 'exports', './Media', 'lib-build/hbars!./VideoBlock', 'lib-build/hbars!./VideoBackground', 'lib-build/hbars!./VideoVimeo', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'dojo/Deferred', 'lib-build/less!./Video', 'lib/froogaloop/froogaloop', 'lib/youtube-api/index'], function (module, exports, _Media2, _VideoBlock, _VideoBackground, _VideoVimeo, _app, _Deferred) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _VideoBlock2 = _interopRequireDefault(_VideoBlock);

  var _VideoBackground2 = _interopRequireDefault(_VideoBackground);

  var _VideoVimeo2 = _interopRequireDefault(_VideoVimeo);

  var _app2 = _interopRequireDefault(_app);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var CONFIG = {
    ratio: 16 / 9
  };

  /*
  window.onYouTubeIframeAPIReady = function() {
    //console.log("Youtube ready!");
    // TODO not handled yet
    //YOUTUPE_API_READY = true;
  };
  
  function onYoutubePlayerReady(e, videoId)
  {
    //console.log(e);
    //e.target.playVideo();
  
    e.target.mute();
    e.target.loadPlaylist(videoId);
    e.target.setLoop(true);
  
    resizeVideo();
  }
  */

  var PREVIEW_THUMB = 'resources/tpl/builder/icons/media-placeholder/video.png';
  var PREVIEW_ICON = 'resources/tpl/builder/icons/immersive-panel/video.png';

  var Video = function (_Media) {
    _inherits(Video, _Media);

    function Video(video) {
      _classCallCheck(this, Video);

      var _this = _possibleConstructorReturn(this, (Video.__proto__ || Object.getPrototypeOf(Video)).call(this, {
        type: 'video',
        id: video.source + '-' + video.id,
        previewThumb: PREVIEW_THUMB,
        previewIcon: PREVIEW_ICON
      }));

      _this._video = video;
      _this._source = video.source;
      _this._videoid = video.id;

      _this._soundLevelPreImmersive = null;
      _this._placement = null;
      _this._videoPlayer = null;
      _this._loadDeferred = null;
      _this._isVideoLoaded = false;
      _this._pendingAction = null;

      // If video has just been added in builder
      // TODO: section have to declare the default behavior for the media
      _this._sectionType = 'sequence';
      _this._isBuilderAdd = false;

      // TODO: shouldn't be needed
      if (!_this._video.options) {
        _this._video.options = {};
      }
      return _this;
    }

    _createClass(Video, [{
      key: 'render',
      value: function render(params) {
        var output = '';

        if (!this._video || !params) {
          console.log('Could not render video in section');
          return output;
        }

        this._placement = params.placement;

        if (this._placement == 'block') {
          output += (0, _VideoBlock2.default)({
            domId: this._domID,
            videoId: this.id,
            caption: this._video.caption,
            placeholder: _app2.default.builder.media.captionPlaceholder,
            captionEditable: app.isInBuilder
          });
        } else if (this._placement == 'background') {
          output += (0, _VideoBackground2.default)({
            domId: this._domID,
            videoId: this.id
          });
        }

        return output;
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(Video.prototype.__proto__ || Object.getPrototypeOf(Video.prototype), 'postCreate', this).call(this, params);

        this._sectionType = params.sectionType;

        if (!params.container) {
          return;
        }

        if (this._placement == 'block') {
          this._node = params.container.find('#' + this._domID);
        } else {
          this._node = params.container.find('.video[data-id="' + this.id + '"]').parent().parent();
        }

        this._nodeMedia = this._node.find('.video-player');

        this._applyConfig();
      }
    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        var options = this._video.options;

        // Test
        if (typeof options == 'string') {
          options = {};
        }

        options.size = options.size || 'small';

        if (this._isVideoLoaded && options.audio) {
          var isMuted = this._video.options.audio == 'muted',
              volume = isMuted ? 0 : 1;

          try {
            if (this._video.source == 'vimeo') {
              this._videoPlayer.api('setVolume', volume);
            } else {
              this._videoPlayer.setVolume(volume * 100);
            }
          } catch (e) {
            console.error(e);
          }
        }

        _get(Video.prototype.__proto__ || Object.getPrototypeOf(Video.prototype), '_applyConfig', this).call(this, options);
      }
    }, {
      key: 'load',
      value: function load() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        this._loadDeferred = new _Deferred2.default();

        if (this._isLoaded) {
          this._loadDeferred.resolve();
          return this._loadDeferred;
        }

        this._isLoaded = true;

        this._isBuilderAdd = params.isBuilderAdd;

        // https://developers.google.com/youtube/iframe_api_reference
        // https://developer.vimeo.com/player/js-api

        var opt = '0';
        var controls = '';

        if (this._placement == 'background') {
          opt = '1';
        } else if (this._video.options && this._video.options.ui == 'simple') {
          opt = '1';
          controls = '<div class="player-controls"><button class="play">play/pause</button>&nbsp;&nbsp;&nbsp;<button class="mute">mute/unmute</button></div>';
        }

        if (this._source == 'vimeo') {
          var classes = this._placement == 'foreground' ? 'video-fg video-player' : 'video';

          var newMedia = $((0, _VideoVimeo2.default)({
            domId: 'player-' + this._domID,
            classes: classes + ' initialized',
            url: 'https://player.vimeo.com/video/' + this._videoid + '?api=1&background=' + opt + '&player_id=player-' + this._domID,
            options: this._video.options,
            playerControls: controls
          }));

          this._nodeMedia.replaceWith(newMedia);
          this._nodeMedia = newMedia;

          /*
          $('#' + _id).siblings().find('.play').click(function() {
            _videoPlayer.api('paused', function(paused) {
              if (paused) {
                _videoPlayer.api('play');
              }
              else {
                _videoPlayer.api('pause');
              }
            });
          });
            $('#' + _id).siblings().find('.mute').click(function() {
            _videoPlayer.api('getVolume', function(volume) {
              if (volume == '0') {
                _videoPlayer.api('setVolume', '1');
              }
              else {
                _videoPlayer.api('setVolume', '0');
              }
            });
          });
          */

          this._videoPlayer = $f(newMedia[0]); // eslint-disable-line no-undef

          try {
            this._videoPlayer.addEvent('ready', this._onVimeoPlayerReady.bind(this));
          } catch (e) {
            console.error(e);
          }
        } else if (this._video.source == 'youtube') {
          this._videoPlayer = new window.YT.Player(this._node.find('.video-player[data-id=' + this.id + ']')[0], {
            height: '',
            width: '',
            loop: 1,
            videoId: this._videoid,
            playerVars: {
              rel: 0,
              modestbranding: 1
            },
            events: {
              onReady: function (e) {
                try {
                  this._onYoutubePlayerReady(e, this._video.id);
                } catch (e) {
                  console.error(e);
                }
              }.bind(this)
            }
          });
        }

        return this._loadDeferred;
      }
    }, {
      key: 'resize',
      value: function resize(params) {
        if (this._placement == 'background') {
          this._resizeVideoBackground(params);
        }
        /*
        else {
          this._resizeVideoForeground();
        }
        */
      }
    }, {
      key: 'performAction',
      value: function performAction(params) {
        if (!this._videoPlayer) {
          return;
        }

        if (!this._isVideoLoaded) {
          this._pendingAction = params;
          return;
        }

        // Is Immersive background - On Cover we do nothing about sound
        // TODO: should just store the proper property...
        var isImmersiveBg = params.viewIndex !== undefined,
            isMuted = this._video.options.audio == 'muted';

        try {
          if (this._video.source == 'vimeo') {
            if (params.isActive) {
              // Sound
              if (this._placement == 'background') {
                if (isImmersiveBg && !isMuted) {
                  this._videoPlayer.api('getVolume', function (volume) {
                    if (volume != 1) {
                      this._soundLevelPreImmersive = volume;
                    }
                  }.bind(this));

                  if (params.visibilityProgress) {
                    this._videoPlayer.api('setVolume', params.visibilityProgress);
                  }
                }
              }

              this._videoPlayer.api('play');
            } else {
              //_videoPlayer.api('pause');

              //if (params.visibilityProgress > 0.1) {
              //this._videoPlayer.api('setVolume', params.visibilityProgress);
              //}
              if (this._placement == 'background') {
                if (this._soundLevelPreImmersive != null) {
                  this._videoPlayer.api('setVolume', this._soundLevelPreImmersive);
                }
                this._videoPlayer.api('pause');
              } else {
                this._videoPlayer.api('pause');
              }
            }
          } else if (this._video.source == 'youtube') {
            if (params.isActive) {
              // Sound
              if (this._placement == 'background') {
                if (isImmersiveBg && !isMuted) {
                  var volume = this._videoPlayer.getVolume();
                  if (volume != 100) {
                    this._soundLevelPreImmersive = volume;
                  }

                  //if (params.visibilityProgress) {
                  //this._videoPlayer.setVolume(params.visibilityProgress * 100);
                  //}
                  this._videoPlayer.setVolume(100);
                }
              }

              this._videoPlayer.playVideo();
            } else {
              if (this._placement == 'background') {
                if (this._soundLevelPreImmersive != null) {
                  this._videoPlayer.setVolume(params.visibilityProgress * 100);
                }
                this._videoPlayer.pauseVideo();
              } else {
                this._videoPlayer.pauseVideo();
              }
            }
          }
        } catch (e) {
          console.error(e);
        }
      }
    }, {
      key: '_onVimeoPlayerReady',
      value: function _onVimeoPlayerReady() {
        this._isVideoLoaded = true;

        this._node.find('.media-loading').hide();

        if (this._placement == 'block') {
          this._videoPlayer.api('pause');
        } else {
          var isMuted = this._video.options.audio == 'muted';

          if (!this._isBuilderAdd) {
            this._videoPlayer.api('setVolume', 0);

            if (this._sectionType == 'immersive') {
              this._videoPlayer.api('pause');
            }
          } else {
            if (this._sectionType == 'immersive' && !isMuted) {
              this._videoPlayer.api('setVolume', 1);
            } else {
              this._videoPlayer.api('setVolume', 0);
            }

            this._videoPlayer.api('play');

            // this is called twice when adding in Immersive so can't do that
            //this._isBuilderAdd = false;
          }

          this._videoPlayer.api('setLoop', true);
        }

        this._loadDeferred.resolve();
        this.resize();
        this._applyConfig();

        if (this._pendingAction) {
          this.performAction(this._pendingAction);
          this._pendingAction = null;
        }
      }
    }, {
      key: '_onYoutubePlayerReady',
      value: function _onYoutubePlayerReady() {
        this._isVideoLoaded = true;

        this._node.find('.media-loading').hide();

        if (this._placement == 'background') {
          this._videoPlayer.setLoop(true);

          if (!this._isBuilderAdd) {
            this._videoPlayer.setVolume(0);
          } else {
            if (this._sectionType == 'immersive') {
              this._videoPlayer.setVolume(100);
            } else {
              this._videoPlayer.setVolume(0);
            }
            this._videoPlayer.playVideo();
          }
        }

        // The node change from a div to an iframe during loading
        this._nodeMedia = this._node.find('.video-player');

        this._loadDeferred.resolve();
        this.resize();
        this._applyConfig();

        if (this._pendingAction) {
          this.performAction(this._pendingAction);
          this._pendingAction = null;
        }
      }
    }, {
      key: '_resizeVideoBackground',
      value: function _resizeVideoBackground(params) {
        params = params || {
          windowWidth: app.display.windowWidth,
          windowHeight: app.display.windowHeight
        };

        if (!this._nodeMedia) {
          return;
        }

        var videoWidth = -1,
            videoHeight = -1,
            windowWidth = app.display.windowWidth,
            windowHeight = app.display.windowHeight + /* add margin so that vimeo controls aren't visible */60,
            windowRatio = windowWidth / windowHeight;

        if (windowRatio < CONFIG.ratio) {
          videoWidth = windowHeight * CONFIG.ratio;
          videoHeight = windowHeight;
        } else {
          videoWidth = windowWidth;
          videoHeight = videoWidth / CONFIG.ratio;
        }

        this._nodeMedia.css({
          width: videoWidth,
          height: videoHeight
        });

        this._nodeMedia.parent().css({
          width: windowWidth,
          height: windowHeight
        });

        this._nodeMedia.parent().scrollLeft((videoWidth - windowWidth) / 2);
        this._nodeMedia.parent().scrollTop((videoHeight - windowHeight) / 2);
      }
    }]);

    return Video;
  }(_Media3.default);

  exports.default = Video;
  module.exports = exports['default'];
});
//# sourceMappingURL=Video.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/WebMapBlock', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\"false\">\r\n  <div class=\"block-media\">\r\n    <div class=\"media-loading\">\r\n      <span class=\"large-loader\"></span>\r\n    </div>\r\n    <div class=\"media-media map\" data-builder-invite=\"\" data-id=\""
    + escapeExpression(((helper = (helper = helpers.webmapId || (depth0 != null ? depth0.webmapId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"webmapId","hash":{},"data":data}) : helper)))
    + "\" data-options=\""
    + escapeExpression(((helper = (helper = helpers.options || (depth0 != null ? depth0.options : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"options","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n    <div class=\"interaction-container\">\r\n      <button class=\"btn btn-default btn-sm\">\r\n        <span class=\"int-container-disabled\">\r\n          <span class=\"glyphicon glyphicon-fullscreen\"></span>\r\n          Explore Map\r\n        </span>\r\n        <span class=\"int-container-enabled\">\r\n          Stop Exploring\r\n        </span>\r\n      </button>\r\n    </div>\r\n    <div class=\"builder-ui media-cfg-invite\"></div>\r\n    <div class=\"builder-ui media-delete\"></div>\r\n    <div class=\"layer-list-container\"></div>\r\n  </div>\r\n  <div class=\"block-caption\" data-placeholder=\""
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\""
    + escapeExpression(((helper = (helper = helpers.captionEditable || (depth0 != null ? depth0.captionEditable : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"captionEditable","hash":{},"data":data}) : helper)))
    + "\">";
  stack1 = ((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n  <div class=\"builder-ui media-cfg-panel\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/WebMapBackground', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div class=\"media-loading\">\r\n  <span class=\"large-loader\"></span>\r\n</div>\r\n<div class=\"media-media map\" data-id=\""
    + escapeExpression(((helper = (helper = helpers.webmapId || (depth0 != null ? depth0.webmapId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"webmapId","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n<div class=\"interaction-container\">\r\n  <button class=\"btn btn-default btn-sm\">\r\n    <span class=\"int-container-disabled\">\r\n      <span class=\"glyphicon glyphicon-fullscreen\"></span>\r\n      Explore Map\r\n    </span>\r\n    <span class=\"int-container-enabled\">\r\n      Stop Exploring\r\n    </span>\r\n  </button>\r\n</div>\r\n<div class=\"builder-ui media-cfg-invite\"></div>\r\n<div class=\"builder-ui media-cfg-panel\"></div>\r\n<div class=\"layer-list-container\"></div>\r\n";
},"useData":true}); });


define('lib-build/css!storymaps/tpl/view/media/arcgis/WebMapCommand',[],function(){});
define('storymaps/tpl/view/media/arcgis/WebMapCommand',[
  'lib-build/css!./WebMapCommand',
  'dojo/has',
  'esri/geometry/Point',
  'dojo/on',
  'esri/symbols/PictureMarkerSymbol',
  'esri/layers/GraphicsLayer',
  'esri/graphic',
  'esri/config'
],
function(
	viewCss,
	has,
	Point,
	on,
	PictureMarkerSymbol,
	GraphicsLayer,
	Graphic,
	esriConfig
) {
  /**
   * MapCommand
   * @class MapCommand
   *
   * UI component that control the map display with +/home/- buttons and optional location button
   * On touch device button are bigger
   */
  return function MapCommand(map, homeClickCallback, locationButtonCallback, locationButtonEnabled) {
    //
    // Home/wait button
    //
    var tsUpdateStart = 0;
    var homeButton = $('<div class="esriSimpleSliderIncrementButton"><div class="mapCommandHomeBtn"><i class="fa fa-home" aria-hidden="true"></i></div></div>');
    var locateSymbol = new PictureMarkerSymbol('resources/common/icons/mapcommand-location-marker.png', 21, 21);
    var locateLayer = new GraphicsLayer({id: 'locateLayer'});

    homeButton.click(function() {
      // Prevent using the home button while it's spinning
      if (tsUpdateStart !== 0 && $('body').hasClass('mobile-view'))
        return;

      if (homeClickCallback && typeof homeClickCallback == 'function')
        homeClickCallback(map._params.extent);
      else
        map.setExtent(map._params.extent);
    });

    $(map.container).find('.esriSimpleSlider div:nth-child(1)').after(homeButton);

		/*
    on(map, 'update-start', function() {
      if (tsUpdateStart === 0)
        toggleLoadingStatus(true);
    });

    on(map, 'update-end', function() {
      toggleLoadingStatus(false);
    });
		*/

    this.setMobile = function(isMobile) {
      $('.esriSimpleSlider, .mapCommandHomeBtn', map.container).toggleClass('touch', isMobile);
    };

    this.destroy = function() {
      $(map.container).find('.esriSimpleSliderIncrementButton').remove();
      $(map.container).find('.mapCommandLocation').remove();
    };

    this.startLoading = function() {
      toggleLoadingStatus(true);
    };

    this.stopLoading = function() {
      toggleLoadingStatus(false);
    };

    this.toggleLocationButton = function(enable) {
      $('.mapCommandLocation', map.container).toggleClass('hidden', ! enable);
    };

    function toggleLoadingStatus(start) {
      if(start) {
        $(map.container).find('.mapCommandHomeBtn').addClass('loading');
        tsUpdateStart = Date.now();
      }
      else {
        var elapsed = Date.now() - tsUpdateStart;
        var delay = 0;

        if(elapsed < 450) {
          delay = 450 - elapsed;
        }

        setTimeout(function() {
          $(map.container).find('.mapCommandHomeBtn').removeClass('loading');
          tsUpdateStart = 0;
        }, delay);
      }
    }

    function getDeviceLocation() {
      navigator.geolocation.getCurrentPosition(
        function(e) {
          var geom = new Point(e.coords.longitude, e.coords.latitude);

          // User callback
          if (locationButtonCallback && typeof locationButtonCallback == 'function')
            locationButtonCallback(true, geom, e);

          if (map.spatialReference.wkid != 102100 && map.spatialReference.wkid != 4326) {
            esriConfig.defaults.geometryService.project([geom], map.spatialReference, function(features) {
              if(! features || ! features[0]) {
                return;
              }

              displayLocationPin(features[0]);
            });
            return;
          }
          else
            displayLocationPin(geom);
        },
        getDeviceLocationError,
        { timeout: 2000 }
      );
    }

    function displayLocationPin(point) {
      locateLayer.clear();
      locateLayer.add(new Graphic(point, locateSymbol));
      setTimeout(function() {
        $('#locateLayer_layer image').fadeOut({
          duration: 800
        });
      }, 10000);
    }

    function getDeviceLocationError(error) {
      locationButtonCallback(false, error);
    }

    // Geolocate button
    if(navigator && navigator.geolocation) {
      // TODO: to be done in CSS
      $('.esriSimpleSlider', map.container).after('<div class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"><i class="fa fa-crosshairs" aria-hidden="true"></i></div>');
      $('.mapCommandLocation', map.container).click(getDeviceLocation);
      this.toggleLocationButton(locationButtonEnabled);
      map.addLayer(locateLayer);
    }

    // Use bigger icon on touch devices
    this.setMobile(!! has('touch'));
  };
});


define('lib-build/less!storymaps-react/tpl/view/media/WebMap',[],function(){});
define('storymaps-react/tpl/view/media/WebMap',['module', 'exports', './Media', 'lib-build/hbars!./WebMapBlock', 'lib-build/hbars!./WebMapBackground', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'storymaps/tpl/view/media/arcgis/WebMapCommand', 'esri/arcgis/utils', 'esri/geometry/Extent', 'esri/symbols/SimpleMarkerSymbol', 'esri/geometry/webMercatorUtils', 'esri/geometry/Point', 'esri/tasks/query', 'esri/tasks/QueryTask', 'esri/config', 'dojo/_base/lang', 'dojo/Deferred', 'storymaps/tpl/utils/UI', 'lib-build/less!./WebMap'], function (module, exports, _Media2, _WebMapBlock, _WebMapBackground, _app, _WebMapCommand, _utils, _Extent, _SimpleMarkerSymbol, _webMercatorUtils, _Point, _query, _QueryTask, _config, _lang, _Deferred, _UI) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _WebMapBlock2 = _interopRequireDefault(_WebMapBlock);

  var _WebMapBackground2 = _interopRequireDefault(_WebMapBackground);

  var _app2 = _interopRequireDefault(_app);

  var _WebMapCommand2 = _interopRequireDefault(_WebMapCommand);

  var _utils2 = _interopRequireDefault(_utils);

  var _Extent2 = _interopRequireDefault(_Extent);

  var _SimpleMarkerSymbol2 = _interopRequireDefault(_SimpleMarkerSymbol);

  var _webMercatorUtils2 = _interopRequireDefault(_webMercatorUtils);

  var _Point2 = _interopRequireDefault(_Point);

  var _query2 = _interopRequireDefault(_query);

  var _QueryTask2 = _interopRequireDefault(_QueryTask);

  var _config2 = _interopRequireDefault(_config);

  var _lang2 = _interopRequireDefault(_lang);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  var _UI2 = _interopRequireDefault(_UI);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var PREVIEW_THUMB = 'resources/tpl/builder/icons/media-placeholder/map.png';
  var PREVIEW_ICON = 'resources/tpl/builder/icons/immersive-panel/map.png';

  var WebMap = function (_Media) {
    _inherits(WebMap, _Media);

    function WebMap(webmap) {
      _classCallCheck(this, WebMap);

      var _this = _possibleConstructorReturn(this, (WebMap.__proto__ || Object.getPrototypeOf(WebMap)).call(this, {
        type: 'webmap',
        id: webmap.id,
        previewThumb: PREVIEW_THUMB,
        previewIcon: PREVIEW_ICON
      }));

      _this._webmap = webmap;
      _this._bookmarks = null;

      _this._placement = null;

      // The transition in Immersive, null otherwise
      _this._transition = null;
      // DOM node of the layers that are swiped
      _this._swipeLayersNodes = [];
      // Store the previous maap configuration that layer may be swiped against
      //  while the map is loading
      _this._swipePreviousWebMapLayers = null;
      _this._lastScrollPosition = null;

      if (!_this._webmap.options) {
        _this._webmap.options = {
          interaction: 'enabled'
        };
      }

      if (!_this._webmap.extras) {
        _this._webmap.extras = {
          locate: {
            enabled: false
          },
          search: {
            enabled: false
          },
          legend: {
            enabled: false
          }
        };
      }
      return _this;
    }

    _createClass(WebMap, [{
      key: 'render',
      value: function render(context) {
        var output = '';

        if (!this._webmap || !context) {
          console.log('Could not render webmap in section');
          return output;
        }

        this._placement = context.placement;

        if (this._placement == 'block') {
          var options = JSON.stringify({
            extent: this._webmap.extent,
            layers: this._webmap.layers,
            legend: this._webmap.legend,
            layers2: this._webmap.layers2
          });

          var classes = ['block', 'block-type-webmap'];

          output += (0, _WebMapBlock2.default)({
            id: this._domID,
            webmapId: this.id,
            classes: classes.join(' '),
            options: options,
            caption: this._webmap.caption,
            placeholder: _app2.default.builder.media.captionPlaceholder,
            captionEditable: app.isInBuilder
          });
        } else {
          output += (0, _WebMapBackground2.default)({
            webmapId: this.id
          });
        }

        return output;
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        var options = this._webmap.options;

        _get(WebMap.prototype.__proto__ || Object.getPrototypeOf(WebMap.prototype), '_applyConfig', this).call(this, options);

        this._applyInteraction();

        // In viewer: update map extent if defined
        // In builder: update map extent only on reset
        var allowExtentUpdate = !!(this._webmap.extent || app.isInBuilder);
        /*
        if (app.isInBuilder) {
          allowExtentUpdate = this._webmap.extent == null;
        }
        */

        // TODO: background - swipe need scrollPosition
        this.performAction({
          allowExtentUpdate: allowExtentUpdate
        }).then(function () {
          if (app.isInBuilder && this._configTabWebMap) {
            this._configTabWebMap.attachEvents();
          }
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: '_applyInteraction',
      value: function _applyInteraction() {
        var interaction = this._webmap.options.interaction;

        if (app.isMobileView || _UI2.default.isMobileBrowser()) {
          interaction = 'button';
        }

        // TODO: duplicate between map/scene/page should be in Media
        //  store an object for options or always use _media.options???

        if (this._webmap.options.interaction) {
          var classes = $.map(this._node.attr('class').split(' '), function (l) {
            return l.match(/interaction-/) ? l : null;
          }).join(' ');

          this._node.removeClass(classes).addClass('interaction-' + interaction);

          this._node.find('.interaction-container').removeClass('enabled');
        }
      }
    }, {
      key: 'load',
      value: function load() {
        var resultDeferred = new _Deferred2.default();

        if (!this._node || this._isLoaded) {
          return;
        }

        this._isLoaded = true;

        this.loadMap(this._node.find('.map')[0], resultDeferred);

        return resultDeferred;
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(WebMap.prototype.__proto__ || Object.getPrototypeOf(WebMap.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        if (this._placement == 'block') {
          this._node = params.container.find('#' + this._domID);
        } else {
          this._node = params.container.find('.map[data-id="' + this.id + '"]').parent();
        }

        this._applyConfig();
      }
    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var resultDeferred = new _Deferred2.default();
        var map = this._cache[this.id] ? this._cache[this.id].map : null;

        if (!map) {
          resultDeferred.reject();
          return resultDeferred;
        }

        if (params.scrollPositionView) {
          this._lastScrollPosition = params.scrollPositionView;
        }

        if (params.transition) {
          this._transition = params.transition;
        }

        /*
        if (! _bookmarks) {
          return;
        }
        */

        /*
        if (_bookmarks && _currentBookmarkIndex != params.slideIndex) {
          var bookmark = _bookmarks[params.slideIndex - 1];
            if (bookmark && bookmark.extent) {
            map.setExtent(new Extent(bookmark.extent), false);
          }
            _currentBookmarkIndex = params.slideIndex;
        }
        */

        // TODO: Should only apply changes when changing slide

        if (map.infoWindow) {
          map.infoWindow.hide();
        }

        // Apply view configuration
        var viewInfo = this._webmap;

        var hasChangedExtent = false;

        // In viewer if viewInfo.extent is set it's applied
        // In builder it's always ignored except if forceExtentUpdate
        // True when come from inside the class ; undefined from the section
        if (params.allowExtentUpdate === true || params.allowExtentUpdate === undefined) {
          var extent = null;

          if (viewInfo.extent) {
            extent = new _Extent2.default(viewInfo.extent);
          } else {
            // Initial extent
            extent = this._getWebMapExtentFromItemExtent(this._cache[this.id].itemInfo.item.extent);
          }

          // Only apply if last extent applied was different
          if (JSON.stringify(extent.toJson()) != this._cache[this.id].lastExtentApplied || params.forceSetExtent) {
            this._cache[this.id].lastExtentApplied = JSON.stringify(extent.toJson());

            hasChangedExtent = true;

            var setExtent = function (extent) {
              map.setExtent(extent, false).then(function () {
                if (viewInfo.popup) {
                  this._applyPopupConfiguration(map, viewInfo.popup);
                }

                resultDeferred.resolve();
              }.bind(this), function () {
                resultDeferred.resolve();
              });
            }.bind(this);

            if (map.spatialReference.wkid == extent.spatialReference.wkid) {
              setExtent(extent);
            } else {
              _config2.default.defaults.geometryService.project([extent], map.spatialReference, function (features) {
                if (!features || !features[0]) {
                  return;
                }

                setExtent(features[0]);
              }.bind(this));
            }
          }
        } else {
          resultDeferred.resolve();
        }

        // Popup
        if (viewInfo.popup && !hasChangedExtent) {
          this._applyPopupConfiguration(map, viewInfo.popup);
        }

        // Apply layer config if it's a new view
        //if (params.isNewView) {
        //if (viewInfo.layers) {
        //if (false) {
        if (JSON.stringify(viewInfo.layers) != this._cache[this.id].lastLayersApplied) {
          this._cache[this.id].lastLayersApplied = JSON.stringify(viewInfo.layers);

          //  - Array of {id:'', visible:''} for the overrided layers (compared to the webmap initial state)
          //  - Only overrided layers are present there to allow the webmap to evolve outside of the app
          //     - If default visibility of layers are changed outside of the app, all view that didn't override the value will see the change
          //     - if the webmap evolve the array may reference deleted layers. That's cleaned anytime user open the Configure map View and Save
          var layerCfg = viewInfo.layers || [];
          var mapDefault = this._cache[viewInfo.id].itemInfo.itemData.operationalLayers;

          // Loop through webmap layers and set the visibility
          // The visibility is set to the section definition when defined or to the webmap initial visibility
          $.each(mapDefault, function (i, layer) {
            var override;

            if (layer.layerObject) {
              override = $(layerCfg).filter(function (i, l) {
                return l.id == layer.layerObject.id;
              });
              layer.layerObject.setVisibility(override.length ? override[0].visibility : layer.visibility);
            } else if (layer.featureCollection && layer.featureCollection.layers) {
              $.each(layer.featureCollection.layers, function (i, fcLayer) {
                override = $(layerCfg).filter(function (i, l) {
                  // Because the configuration store the map layerObject id like "mapNotes_914_0" instead of "mapNotes_914"
                  // Should change that and keep V1.0 compatibility
                  return l.id.split('_').slice(0, -1).join('_') == fcLayer.layerObject.id.split('_').slice(0, -1).join('_');
                });
                fcLayer.layerObject.setVisibility(override.length ? override[0].visibility : fcLayer.visibility);
              });
            }
          });
        }

        if (this._transition == 'swipe-vertical' || this._transition == 'swipe-horizontal') {
          if (this._swipeLayersNodes && this._swipeLayersNodes.length) {
            // TODO: refactor to be common with Immersive???

            var swipePos = app.display.windowHeight - this._lastScrollPosition;

            var BUILDER_PANEL_HEIGHT = 125;
            if (app.isInBuilder) {
              swipePos -= BUILDER_PANEL_HEIGHT;
            }

            /*
            if (! params.isActive) {
              swipePos = app.display.windowHeight;
            }
            */
            /*
            else {
              swipePos += app.display.windowHeight / 2 - 90;
            }
            */

            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
              for (var _iterator = this._swipeLayersNodes[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var layer = _step.value;

                var layerNode = layer.node,
                    top = swipePos,
                    right = app.display.windowWidth,
                    bottom = app.display.windowHeight,
                    left = 0;

                if (!layer.isSVGLayer) {
                  var layerPos = layerNode.position();

                  top += -layerPos.top;
                  right += -layerPos.left;
                  bottom += -layerPos.top;
                  left += -layerPos.left;
                }

                layerNode.css('clip', 'rect(' + top + 'px,' + right + 'px,' + bottom + 'px,' + left + 'px)');

                // Keep track of the swipe position for pan
                layerNode.data('sm-swipe-pos', swipePos);
              }
            } catch (err) {
              _didIteratorError = true;
              _iteratorError = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion && _iterator.return) {
                  _iterator.return();
                }
              } finally {
                if (_didIteratorError) {
                  throw _iteratorError;
                }
              }
            }
          }
        } else {
          this.resetSwipe();
        }

        if (!params.doNotApplyInteraction) {
          this._applyInteraction();
        }

        // Locate
        var enableLocate = false;
        if (this._webmap.extras && this._webmap.extras.locate && this._webmap.extras.locate.enabled) {
          enableLocate = true;
        }
        this._cache[this.id].mapCommand.toggleLocationButton(enableLocate);

        return resultDeferred;
      }
    }, {
      key: 'resetSwipe',
      value: function resetSwipe() {
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._swipeLayersNodes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var layer = _step2.value;

            var layerNode = layer.node;

            layerNode.css('clip', '');

            layerNode.data('sm-swipe-pos', '');
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    }, {
      key: 'loadMap',
      value: function loadMap(mapElem, resultDeferred) {
        console.log('Loading map');

        var options = {
          mapOptions: {
            smartNavigation: false
          },
          usePopupManager: true,
          editable: false,
          bingMapsKey: app.cfg.BING_MAPS_KEY,
          layerMixins: app.data.appProxies || null
        };

        if (this._webmap.extent) {
          options.mapOptions.extent = new _Extent2.default(this._webmap.extent);
        }

        this._node.addClass('media-is-loading');

        // Prevent mouse wheel while map is partialy loaded
        $(mapElem).css('pointer-events', 'none');

        _utils2.default.createMap(this.id, mapElem, options).then(_lang2.default.hitch(this, function (response) {
          var map = response.map;

          console.log('createMap ok', response);

          this._node.removeClass('media-is-loading').find('.media-loading').hide();

          //response.map.disableMapNavigation();
          // Prevent mouse wheel while map is partialy loaded
          $(mapElem).css('pointer-events', '');
          map.disableScrollWheelZoom();
          map.disableKeyboardNavigation();

          map.reposition();
          map.resize();

          this._cache[this.id] = response;

          if (app.isInBuilder) {
            this._onWebMapLoaded();
          }

          this._bookmarks = response.itemInfo.itemData.bookmarks;

          if (map.infoWindow) {
            map.infoWindow.markerSymbol = new _SimpleMarkerSymbol2.default().setSize(0);
          }

          // Let the section knows the map is loaded
          resultDeferred.resolve(this.id);

          // The event is only registered once for all views in immersive
          this._node.find('.interaction-container').click(this._onEnableButtonClick.bind(this));

          // Customize map commands +/home/- & location
          this._cache[this.id].mapCommand = new _WebMapCommand2.default(map, this._onMapCommandHomeClick.bind(this), this._zoomToBrowserLocation.bind(this), false);

          this._cache[this.id].lastExtentApplied = null;
          this._cache[this.id].lastLayersApplied = null;

          this._applyConfig();
        }));
      }
    }, {
      key: 'postLoad',
      value: function postLoad() {
        var map = this._cache[this.id].map;

        this.computeSwipeLayers(this._swipePreviousWebMapLayers);

        // Pan handler to update swiped layer(s)
        map.on('pan', function () {
          // TODO: this._isActive should be set when performAction is called properly
          // but we don't have performAction when it's becoming not visible :/
          if (!this._swipeLayersNodes || !this._isActive) {
            return;
          }

          var _iteratorNormalCompletion3 = true;
          var _didIteratorError3 = false;
          var _iteratorError3 = undefined;

          try {
            for (var _iterator3 = this._swipeLayersNodes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
              var layer = _step3.value;

              var layerNode = layer.node,
                  swipePos = layerNode.data('sm-swipe-pos');

              var top = swipePos,
                  right = app.display.windowWidth,
                  bottom = app.display.windowHeight,
                  left = 0;

              if (!layer.isSVGLayer) {
                var layerPos = layerNode.position();

                top += -layerPos.top;
                right += -layerPos.left;
                bottom += -layerPos.top;
                left += -layerPos.left;
              }

              layerNode.css('clip', 'rect(' + top + 'px,' + right + 'px,' + bottom + 'px,' + left + 'px)');
            }
          } catch (err) {
            _didIteratorError3 = true;
            _iteratorError3 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion3 && _iterator3.return) {
                _iterator3.return();
              }
            } finally {
              if (_didIteratorError3) {
                throw _iteratorError3;
              }
            }
          }
        });
      }
    }, {
      key: '_zoomToBrowserLocation',
      value: function _zoomToBrowserLocation(success, geom) {
        var map = this._cache[this.id] ? this._cache[this.id].map : null;

        if (success) {
          if (map.spatialReference.wkid != 102100 && map.spatialReference.wkid != 4326) {
            _config2.default.defaults.geometryService.project([geom], map.spatialReference, function (features) {
              if (!features || !features[0]) {
                return;
              }

              if (!map.extent.contains(features[0])) {
                map.centerAt(features[0]);
              }
            });
          } else if (!map.extent.contains(geom)) {
            map.centerAt(geom);
          }
        }
      }
    }, {
      key: '_onMapCommandHomeClick',
      value: function _onMapCommandHomeClick() {
        this.performAction({
          doNotApplyInteraction: true,
          forceSetExtent: true
        });
      }
    }, {
      key: 'computeSwipeLayers',
      value: function computeSwipeLayers(previousWebMapLayers) {
        this._swipeLayersNodes = [];
        this._swipePreviousWebMapLayers = [];

        previousWebMapLayers = previousWebMapLayers || [];
        this._webmap.layers = this._webmap.layers || [];

        // The map hasn't loaded yet, save the list of previousWebMapLayers for after map has loaded
        if (!this._cache[this.id]) {
          this._swipePreviousWebMapLayers = _lang2.default.clone(previousWebMapLayers);
          return;
        }

        /*
         * Stringify the layers config so they are comparable
         */
        var previousLayersComparable = [],
            currentLayersComparable = [];

        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = previousWebMapLayers[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            var layer = _step4.value;

            previousLayersComparable.push(JSON.stringify(layer));
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4.return) {
              _iterator4.return();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }

        var _iteratorNormalCompletion5 = true;
        var _didIteratorError5 = false;
        var _iteratorError5 = undefined;

        try {
          for (var _iterator5 = this._webmap.layers[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
            var _layer = _step5.value;

            currentLayersComparable.push(JSON.stringify(_layer));
          }

          // Add opposite entry for layer override set to false for previous map
          // This allow to use a webmap that has all it's layer visible and the first map is setting
          //  the visibility of one layer to false
        } catch (err) {
          _didIteratorError5 = true;
          _iteratorError5 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion5 && _iterator5.return) {
              _iterator5.return();
            }
          } finally {
            if (_didIteratorError5) {
              throw _iteratorError5;
            }
          }
        }

        var _iteratorNormalCompletion6 = true;
        var _didIteratorError6 = false;
        var _iteratorError6 = undefined;

        try {
          for (var _iterator6 = previousLayersComparable[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
            var _layer2 = _step6.value;

            // If the layer is not present
            if (currentLayersComparable.indexOf(_layer2) == -1) {
              var layerObj = JSON.parse(_layer2);
              if (layerObj.visibility === false) {
                currentLayersComparable.push(JSON.stringify({
                  id: layerObj.id,
                  visibility: true
                }));
              }
            }
          }

          /*
           * Get the difference between arrays
           */
        } catch (err) {
          _didIteratorError6 = true;
          _iteratorError6 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion6 && _iterator6.return) {
              _iterator6.return();
            }
          } finally {
            if (_didIteratorError6) {
              throw _iteratorError6;
            }
          }
        }

        var previousLayersSet = new Set(previousLayersComparable);
        var difference = currentLayersComparable.filter(function (layer) {
          return !previousLayersSet.has(layer);
        });

        /*
         * Find the DOM node for those
         */

        var isFirstSVGLayer = true;

        var _iteratorNormalCompletion7 = true;
        var _didIteratorError7 = false;
        var _iteratorError7 = undefined;

        try {
          for (var _iterator7 = difference[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
            var _layer3 = _step7.value;

            var layerId = JSON.parse(_layer3).id,
                layerNode = this._cache[this.id].map.getLayer(layerId)._div,
                isSVGLayer = false;

            // A graphics Layer drawned as SVG
            // Those behave a little differently as there is only one swippeable
            //   container for all of them in the map
            // So those are only initialized once
            if (layerNode.rawNode) {
              if (!isFirstSVGLayer) {
                continue;
              }

              layerNode = $(layerNode.rawNode).parent()[0];
              isSVGLayer = true;
              isFirstSVGLayer = false;
            }

            this._swipeLayersNodes.push({
              node: $(layerNode),
              isSVGLayer: isSVGLayer
            });
          }
        } catch (err) {
          _didIteratorError7 = true;
          _iteratorError7 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion7 && _iterator7.return) {
              _iterator7.return();
            }
          } finally {
            if (_didIteratorError7) {
              throw _iteratorError7;
            }
          }
        }

        console.log('**', this._swipeLayersNodes);
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        return _lang2.default.clone({
          type: 'webmap',
          webmap: this._webmap
        });
      }
    }, {
      key: 'getAuthorizedTransitionsWith',
      value: function getAuthorizedTransitionsWith(media) {
        if (!media || media.id != this.id) {
          return [];
        }

        var mediaData = this.serialize().webmap,
            mediaExtent = JSON.stringify(mediaData.extent) || 'null',
            mediaLayers = JSON.stringify(mediaData.layers) || '[]',
            mediaPopup = JSON.stringify(mediaData.popup) || 'null';

        var otherMediaData = media.serialize().webmap,
            otherMediaExtent = JSON.stringify(otherMediaData.extent) || 'null',
            otherMediaLayers = JSON.stringify(otherMediaData.layers) || '[]',
            otherMediaPopup = JSON.stringify(otherMediaData.popup) || 'null';

        // If popup or location are different, can't swipe
        if (mediaPopup != otherMediaPopup || mediaExtent != otherMediaExtent) {
          return [];
        }

        // Do not allow swipe if extent is not configured
        if (mediaLayers == otherMediaLayers) {
          return [];
        }

        return ['swipe-vertical' /*, 'swipe-horizontal'*/];
      }
    }, {
      key: 'getLayersConfiguration',
      value: function getLayersConfiguration() {
        return this._webmap.layers;
      }
    }, {
      key: '_getWebMapExtentFromItemExtent',
      value: function _getWebMapExtentFromItemExtent(itemExtent) {
        if (!itemExtent || itemExtent.length != 2) {
          return null;
        }

        var bottomLeft = _webMercatorUtils2.default.geographicToWebMercator(new _Point2.default(itemExtent[0][0], itemExtent[0][1]));

        var topRight = _webMercatorUtils2.default.geographicToWebMercator(new _Point2.default(itemExtent[1][0], itemExtent[1][1]));

        // TODO: if map is not in Mercator -> reproject

        return new _Extent2.default({
          xmax: topRight.x,
          xmin: bottomLeft.x,
          ymax: topRight.y,
          ymin: bottomLeft.y,
          spatialReference: {
            wkid: 102100
          }
        });
      }
    }, {
      key: '_applyPopupConfiguration',
      value: function _applyPopupConfiguration(map, popupCfg) {
        // When an action is performed the popup will be closed
        // But features aren't cleared so it can be restored
        map.infoWindow.hide();

        if (popupCfg) {
          var layer = map.getLayer(popupCfg.layerId),

          // TODO some MapService layer seems to require this
          // need to investigate more to make sure there is no other way
          // also if the popup contains multiple features, only the first feature will be displayed
          serviceId = popupCfg.layerId ? popupCfg.layerId.split('_').slice(0, -1).join('_') : '',
              layer2 = map.getLayer(serviceId);

          map.infoWindow.clearFeatures();

          if (layer) {
            this._applyPopupConfigurationStep2(map, popupCfg);
          }
          // TODO
          else if (layer2) {
              var layerIdx = popupCfg.layerId.split('_').slice(-1).join('_'),
                  layerUrl = layer2.url + '/' + layerIdx;

              this._applyPopupConfigurationStep2Alt(map, popupCfg, serviceId, layerIdx, layerUrl);
            }
            // On FS the layer will be null until loaded...
            else var handle = map.on('update-end', function () {
                this._applyPopupConfiguration(map, popupCfg);
                handle.remove();
              });
        }
      }
    }, {
      key: '_applyPopupConfigurationStep2',
      value: function _applyPopupConfigurationStep2(map, popupCfg) {
        var query = new _query2.default(),
            layer = map.getLayer(popupCfg.layerId);

        if (!layer) {
          return;
        }

        query.objectIds = [popupCfg.fieldValue];

        // Feature Service
        if (!layer._collection) {
          query.returnGeometry = true;
          query.outFields = ['*']; // popupCfg.fieldName ?
          query.outSpatialReference = map.spatialReference;
        }

        // TODO: Image Services
        if (!layer.queryFeatures) {
          return;
        }

        layer.queryFeatures(query).then(function (featureSet) {
          this._applyPopupConfigurationStep3(map, popupCfg, featureSet.features);
        }.bind(this));
      }
    }, {
      key: '_applyPopupConfigurationStep2Alt',
      value: function _applyPopupConfigurationStep2Alt(map, popupCfg, serviceId, layerIdx, layerUrl) {
        var queryTask = new _QueryTask2.default(layerUrl),
            query = new _query2.default(),
            layer = map.getLayer(serviceId);

        if (!layer) {
          return;
        }

        query.objectIds = [popupCfg.fieldValue];
        query.returnGeometry = true;
        query.outFields = ['*']; // popupCfg.fieldName ?
        query.outSpatialReference = map.spatialReference;

        queryTask.execute(query, function (featureSet) {
          this._applyPopupConfigurationStep3(map, popupCfg, featureSet.features, serviceId, layerIdx);
        }.bind(this));
      }
    }, {
      key: '_applyPopupConfigurationStep3',
      value: function _applyPopupConfigurationStep3(map, popupCfg, features, serviceId, layerIdx) {
        if (!map || !popupCfg || !features || !features.length) {
          return;
        }

        var geom = features[0].geometry,
            center = null;

        if (popupCfg.anchorPoint) {
          center = new _Point2.default(popupCfg.anchorPoint);
        } else {
          center = geom.getExtent() ? geom.getExtent().getCenter() : geom;
        }

        if (serviceId) {
          features[0].infoTemplate = map.getLayer(serviceId).infoTemplates[layerIdx].infoTemplate;
          map.infoWindow.setContent(features[0].getContent());
        } else {
          map.infoWindow.setFeatures(features);
        }

        map.infoWindow.show(center);

        // Center the map is the geometry isn't visible
        if (!map.extent.contains(center)) {
          map.centerAt(center);
        }
      }
    }]);

    return WebMap;
  }(_Media3.default);

  exports.default = WebMap;
  module.exports = exports['default'];
});
//# sourceMappingURL=WebMap.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/WebSceneBlock', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"block block-type-webscene\" contenteditable=\"false\">\r\n  <div class=\"block-media\">\r\n    <div class=\"media-loading\">\r\n      <span class=\"large-loader\"></span>\r\n    </div>\r\n    <div class=\"media-media scene\" data-id=\""
    + escapeExpression(((helper = (helper = helpers.websceneId || (depth0 != null ? depth0.websceneId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"websceneId","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n    <div class=\"interaction-container\">\r\n      <button class=\"btn btn-default btn-sm\">\r\n        <span class=\"int-container-disabled\">\r\n          <span class=\"glyphicon glyphicon-fullscreen\"></span>\r\n          Explore Map\r\n        </span>\r\n        <span class=\"int-container-enabled\">\r\n          Stop Exploring\r\n        </span>\r\n      </button>\r\n    </div>\r\n    <div class=\"builder-ui media-cfg-invite\"></div>\r\n    <div class=\"builder-ui media-delete\"></div>\r\n  </div>\r\n  <div class=\"block-caption\" data-placeholder=\""
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\""
    + escapeExpression(((helper = (helper = helpers.captionEditable || (depth0 != null ? depth0.captionEditable : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"captionEditable","hash":{},"data":data}) : helper)))
    + "\">";
  stack1 = ((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n  <div class=\"builder-ui media-cfg-panel\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/WebSceneBackground', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div class=\"media-loading\">\r\n  <span class=\"large-loader\"></span>\r\n</div>\r\n<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"media-media scene\" data-id=\""
    + escapeExpression(((helper = (helper = helpers.websceneId || (depth0 != null ? depth0.websceneId : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"websceneId","hash":{},"data":data}) : helper)))
    + "\"></div>\r\n<div class=\"interaction-container\">\r\n  <button class=\"btn btn-default btn-sm\">\r\n    <span class=\"int-container-disabled\">\r\n      <span class=\"glyphicon glyphicon-fullscreen\"></span>\r\n      Explore Map\r\n    </span>\r\n    <span class=\"int-container-enabled\">\r\n      Stop Exploring\r\n    </span>\r\n  </button>\r\n</div>\r\n<div class=\"builder-ui media-cfg-invite\"></div>\r\n<div class=\"builder-ui media-cfg-panel\"></div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/WebSceneBlockError', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"block block-type-webscene media-error\" contenteditable=\"false\">\r\n  Sorry this 3D map is not supported on your device.\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/WebSceneBackgroundError', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"media-media scene media-error\">\r\n  Sorry this 3D map is not supported on your device.\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/WebScene',[],function(){});
define('storymaps-react/tpl/view/media/WebScene',['module', 'exports', './Media', 'lib-build/hbars!./WebSceneBlock', 'lib-build/hbars!./WebSceneBackground', 'lib-build/hbars!./WebSceneBlockError', 'lib-build/hbars!./WebSceneBackgroundError', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'storymaps/tpl/utils/UI', 'esri/IdentityManager', 'lib-build/less!./WebScene'], function (module, exports, _Media2, _WebSceneBlock, _WebSceneBackground, _WebSceneBlockError, _WebSceneBackgroundError, _app, _UI, _IdentityManager) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _WebSceneBlock2 = _interopRequireDefault(_WebSceneBlock);

  var _WebSceneBackground2 = _interopRequireDefault(_WebSceneBackground);

  var _WebSceneBlockError2 = _interopRequireDefault(_WebSceneBlockError);

  var _WebSceneBackgroundError2 = _interopRequireDefault(_WebSceneBackgroundError);

  var _app2 = _interopRequireDefault(_app);

  var _UI2 = _interopRequireDefault(_UI);

  var _IdentityManager2 = _interopRequireDefault(_IdentityManager);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var PREVIEW_THUMB = 'resources/tpl/builder/icons/media-placeholder/scene.png';
  var PREVIEW_ICON = 'resources/tpl/builder/icons/immersive-panel/scene.png';

  var NEED_PORTAL_INIT = true;

  var WebScene = function (_Media) {
    _inherits(WebScene, _Media);

    function WebScene(webscene) {
      _classCallCheck(this, WebScene);

      var _this = _possibleConstructorReturn(this, (WebScene.__proto__ || Object.getPrototypeOf(WebScene)).call(this, {
        type: 'webscene',
        id: webscene.id,
        previewThumb: PREVIEW_THUMB,
        previewIcon: PREVIEW_ICON
      }));

      _this._webscene = webscene;

      _this._placement = null;

      _this._isSupported = _UI2.default.hasWebGL() && !_UI2.default.isMobileBrowser();

      if (!_this._isSupported) {
        app.data.errorWebGL = true;
      }

      if (!_this._webscene.options) {
        _this._webscene.options = {
          interaction: 'enabled'
        };
      }

      if (_this._webscene.slide === undefined) {
        _this._webscene.slide = -1;
      }
      return _this;
    }

    _createClass(WebScene, [{
      key: 'render',
      value: function render(context) {
        var output = '';

        if (!this._webscene || !context) {
          console.log('Could not render webscene in section');
          return output;
        }

        this._placement = context.placement;

        if (context.placement == 'background') {

          /*
          if (! UIUtils.hasWebGL() || UIUtils.isMobileBrowser()) {
            throw 'RUNTIME-NO-WEBGL';
          }
          */

          if (this._isSupported) {
            output += (0, _WebSceneBackground2.default)({
              id: this._domID,
              websceneId: this.id
            });
          } else {
            output += (0, _WebSceneBackgroundError2.default)({
              id: this._domID
            });
          }
        } else {
          if (this._isSupported) {
            output += (0, _WebSceneBlock2.default)({
              id: this._domID,
              websceneId: this.id,
              caption: this._webscene.caption,
              placeholder: _app2.default.builder.media.captionPlaceholder,
              captionEditable: app.isInBuilder
            });
          } else {
            output += (0, _WebSceneBlockError2.default)({
              id: this._domID
            });
          }
        }

        return output;
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        var options = this._webscene.options;

        if (!this._isSupported) {
          return;
        }

        _get(WebScene.prototype.__proto__ || Object.getPrototypeOf(WebScene.prototype), '_applyConfig', this).call(this, options);

        this._applyInteraction();

        this.performAction({});

        if (app.isInBuilder && this._configTabWebScene) {
          this._configTabWebScene.attachEvents();
        }
      }
    }, {
      key: '_applyInteraction',
      value: function _applyInteraction() {
        // TODO: duplicate between map/scene/page should be in Media
        //  store an object for options or always use _media.options???
        if (this._webscene.options.interaction) {
          var classes = $.map(this._node.attr('class').split(' '), function (l) {
            return l.match(/interaction-/) ? l : null;
          }).join(' ');

          this._node.removeClass(classes).addClass('interaction-' + this._webscene.options.interaction);

          this._node.find('.interaction-container').removeClass('enabled');
        }
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(WebScene.prototype.__proto__ || Object.getPrototypeOf(WebScene.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        if (this._placement == 'block') {
          this._node = params.container.find('#' + this._domID);
        } else {
          this._node = params.container.find('.scene[data-id="' + this.id + '"]').parent();
        }

        this._applyConfig();
      }
    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'load',
      value: function load() {
        if (!this._node || this._isLoaded || !this._isSupported) {
          return;
        }

        this._isLoaded = true;

        console.log('scene: ' + this.id);

        this._node.addClass('media-is-loading');

        var userCredentials = _IdentityManager2.default.toJson();

        // For some reason if the require is not done there, it won't load...
        require(['esri4/config', 'esri4/core/urlUtils', 'esri4/identity/IdentityManager', 'esri4/identity/OAuthInfo', 'esri4/portal/Portal', 'esri4/views/SceneView', 'esri4/portal/PortalItem', 'esri4/WebScene', 'esri4/core/watchUtils', 'lib-build/css!esri4/css/main.css'], function (esriConfig, urlUtils, esriId, OAuthInfo, Portal, SceneView, PortalItem, WebScene, watchUtils) {
          var portalUrl = app.indexCfg.sharingurl.split('/sharing/')[0];
          esriConfig.portalUrl = portalUrl;

          // Proxy rules
          esriConfig.request.proxyUrl = location.protocol + app.indexCfg.proxyurl;

          if (app.cfg.PROXY_RULES && app.cfg.PROXY_RULES.length) {
            $.each(app.cfg.PROXY_RULES, function (i, rule) {
              if (rule && rule.urlPrefix && rule.proxyUrl) {
                urlUtils.addProxyRule(rule);
              }
            });
          }

          if (NEED_PORTAL_INIT) {
            if (app.indexCfg.oAuthAppId) {
              var info = new OAuthInfo({
                appId: app.indexCfg.oAuthAppId,
                popup: false,
                portalUrl: 'https:' + portalUrl
              });

              esriId.registerOAuthInfos([info]);

              esriId.checkSignInStatus('https:' + app.indexCfg.sharingurl.split('/sharing/')[0] + '/sharing').then(loadStep2.bind(this), function () {
                console.error('Error during oAuth process for web scene');
                loadStep2.bind(this)();
              }.bind(this));
            } else {
              var _iteratorNormalCompletion = true;
              var _didIteratorError = false;
              var _iteratorError = undefined;

              try {
                // initialize also add a serverInfo with www.arcgis.com
                //esriId.initialize(userCredentials);

                for (var _iterator = userCredentials.credentials[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                  var _info = _step.value;

                  esriId.registerToken(_info);
                }
              } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion && _iterator.return) {
                    _iterator.return();
                  }
                } finally {
                  if (_didIteratorError) {
                    throw _iteratorError;
                  }
                }
              }

              var portal = new Portal({
                url: app.indexCfg.sharingurl.split('/sharing/')[0],
                authMode: 'immediate'
              });

              portal.load().then(loadStep2.bind(this));
            }

            NEED_PORTAL_INIT = false;
          } else {
            loadStep2.bind(this)();
          }

          // Web Scene loading
          function loadStep2() {
            console.log('web scene IdentityManager:', esriId);

            var scene = new WebScene({
              portalItem: new PortalItem({
                id: this.id
              })
            });

            var view = new SceneView({
              map: scene,
              container: this._node.find('.scene')[0]
            });

            // Store in the section cache
            this._cache[this.id] = {
              scene: scene,
              view: view
            };

            view.then(function () {
              this._cache[this.id].initialViewpoint = view.viewpoint;

              view.ui.move('zoom', 'bottom-right');
              view.ui.move('compass', 'bottom-right');

              this._node.find('.media-loading').hide();
            }.bind(this));

            // Disable wheel
            view.surface.addEventListener('wheel', function (event) {
              event.stopImmediatePropagation();
            }, true);

            // Apply the slide
            if (this._webscene.slide !== undefined && this._webscene.slide !== -1) {
              watchUtils.init(scene, 'presentation.slides', function (slides) {
                if (slides && slides.items && slides.items.length) {
                  slides.items[this._webscene.slide].applyTo(view);
                }

                if (app.isInBuilder) {
                  this._onWebSceneLoaded();
                }
              }.bind(this));
            } else {
              if (app.isInBuilder) {
                this._onWebSceneLoaded();
              }
            }

            // The event is only registered once for all views in immersive
            this._node.removeClass('media-is-loading').find('.interaction-container').click(this._onEnableButtonClick.bind(this));
          }
        }.bind(this));
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        var media = this._cache[this.id],
            scene = media ? media.scene : null,
            view = media ? media.view : null;

        if (!scene || !view || !view.ready || !this._isSupported) {
          return;
        }

        console.log('performAction', this._webscene.slide);

        if (this._webscene.slide === -1) {
          if (this._cache[this.id].initialViewpoint) {
            view.goTo(this._cache[this.id].initialViewpoint);
          }
        } else if (this._webscene.slide !== undefined && this._webscene.slide <= scene.presentation.slides.items.length) {
          scene.presentation.slides.items[this._webscene.slide].applyTo(view);
        }

        this._applyInteraction();
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }]);

    return WebScene;
  }(_Media3.default);

  exports.default = WebScene;
  module.exports = exports['default'];
});
//# sourceMappingURL=WebScene.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/WebPageBlock', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"block block-webpage scroll-off\" contenteditable=\"false\">\r\n  <div class=\"block-media\">\r\n    <div class=\"media-loading\">\r\n      <span class=\"large-loader\"></span>\r\n    </div>\r\n    <iframe class=\"media-media webpage\" src=\""
    + escapeExpression(((helper = (helper = helpers.url || (depth0 != null ? depth0.url : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"url","hash":{},"data":data}) : helper)))
    + "\"></iframe>\r\n    <div class=\"interaction-container\">\r\n      <button class=\"btn btn-default btn-sm\">\r\n        <span class=\"int-container-disabled\">\r\n          <span class=\"glyphicon glyphicon-fullscreen\"></span>\r\n          Explore\r\n        </span>\r\n        <span class=\"int-container-enabled\">\r\n          Stop Exploring\r\n        </span>\r\n      </button>\r\n    </div>\r\n    <div class=\"builder-ui media-cfg-invite\"></div>\r\n    <div class=\"builder-ui media-delete\"></div>\r\n  </div>\r\n  <div class=\"block-caption\" data-placeholder=\""
    + escapeExpression(((helper = (helper = helpers.placeholder || (depth0 != null ? depth0.placeholder : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"placeholder","hash":{},"data":data}) : helper)))
    + "\" contenteditable=\""
    + escapeExpression(((helper = (helper = helpers.captionEditable || (depth0 != null ? depth0.captionEditable : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"captionEditable","hash":{},"data":data}) : helper)))
    + "\">";
  stack1 = ((helper = (helper = helpers.caption || (depth0 != null ? depth0.caption : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"caption","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n  <div class=\"builder-ui media-cfg-panel\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/WebPageBackground', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div class=\"media-loading\">\r\n  <span class=\"large-loader\"></span>\r\n</div>\r\n<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\">\r\n  <iframe class=\"media-media webpage\" data-src=\""
    + escapeExpression(((helper = (helper = helpers.url || (depth0 != null ? depth0.url : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"url","hash":{},"data":data}) : helper)))
    + "\" style=\"width: 100%; height: 100%;\"></iframe>\r\n  <div class=\"interaction-container\">\r\n    <button class=\"btn btn-default btn-sm\">\r\n      <span class=\"int-container-disabled\">\r\n        <span class=\"glyphicon glyphicon-fullscreen\"></span>\r\n        Explore\r\n      </span>\r\n      <span class=\"int-container-enabled\">\r\n        Stop Exploring\r\n      </span>\r\n    </button>\r\n  </div>\r\n</div>\r\n<div class=\"builder-ui media-cfg-invite\"></div>\r\n<div class=\"builder-ui media-cfg-panel\"></div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/WebPage',[],function(){});
define('storymaps-react/tpl/view/media/WebPage',['module', 'exports', './Media', 'lib-build/hbars!./WebPageBlock', 'lib-build/hbars!./WebPageBackground', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'dojo/Deferred', 'storymaps/tpl/utils/UI', 'lib-build/less!./WebPage'], function (module, exports, _Media2, _WebPageBlock, _WebPageBackground, _app, _Deferred, _UI) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _WebPageBlock2 = _interopRequireDefault(_WebPageBlock);

  var _WebPageBackground2 = _interopRequireDefault(_WebPageBackground);

  var _app2 = _interopRequireDefault(_app);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  var _UI2 = _interopRequireDefault(_UI);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var PREVIEW_THUMB = 'resources/tpl/builder/icons/media-placeholder/webpage.png';
  var PREVIEW_ICON = 'resources/tpl/builder/icons/immersive-panel/webpage.png';

  var WebPage = function (_Media) {
    _inherits(WebPage, _Media);

    function WebPage(webpage) {
      _classCallCheck(this, WebPage);

      var _this = _possibleConstructorReturn(this, (WebPage.__proto__ || Object.getPrototypeOf(WebPage)).call(this, {
        type: 'webpage',
        id: webpage.url,
        previewThumb: PREVIEW_THUMB,
        previewIcon: PREVIEW_ICON
      }));

      _this._webpage = webpage;
      _this._url = webpage.url;

      _this._nodeMedia = null;
      _this._placement = null;

      // TODO: shouldn't be needed
      if (!_this._webpage.options) {
        _this._webpage.options = {
          interaction: 'enabled'
        };
      }
      return _this;
    }

    _createClass(WebPage, [{
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'render',
      value: function render(context) {
        var output = '';

        if (!this._webpage || !context) {
          console.log('Could not render webpage in section');
          return output;
        }

        this._placement = context.placement;

        if (this._placement == 'block') {
          output += (0, _WebPageBlock2.default)({
            id: this._domID,
            url: this._url,
            caption: this._webpage.caption,
            placeholder: _app2.default.builder.media.captionPlaceholder,
            captionEditable: app.isInBuilder
          });
        } else if (context.placement == 'background') {
          var optClass = '';

          /*
          if (this._webpage.requirements) {
            if (this._webpage.requirements.indexOf('WEBGL') > -1) {
              if (! UIUtils.hasWebGL() || UIUtils.isMobileBrowser()) {
                throw 'RUNTIME-NO-WEBGL';
              }
            }
          }
          */

          output += (0, _WebPageBackground2.default)({
            id: this._domID,
            url: this._url,
            classes: 'webpage-container' + optClass
          });
        }

        return output;
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(WebPage.prototype.__proto__ || Object.getPrototypeOf(WebPage.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        if (this._placement == 'block') {
          this._node = params.container.find('#' + this._domID);
          this._nodeMedia = this._node.find('iframe');
        } else {
          this._nodeMedia = params.container.find('.webpage[data-src="' + this._url + '"]');
          this._node = this._nodeMedia.parents('.background').eq(0);
        }

        this._applyConfig();
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        var options = this._webpage.options;

        _get(WebPage.prototype.__proto__ || Object.getPrototypeOf(WebPage.prototype), '_applyConfig', this).call(this, options);

        var interaction = this._webpage.options.interaction;

        if (app.isMobileView || _UI2.default.isMobileBrowser()) {
          interaction = 'button';
        }

        // TODO: duplicate between map/scene/page should be in Media
        //  store an object for options or always use _media.options???
        if (this._webpage.options.interaction) {
          var classes = $.map(this._node.attr('class').split(' '), function (l) {
            return l.match(/interaction-/) ? l : null;
          }).join(' ');

          this._node.removeClass(classes).addClass('interaction-' + interaction);
        }
      }
    }, {
      key: 'load',
      value: function load() {
        var resultDeferred = new _Deferred2.default();

        if (!this._nodeMedia || this._isLoaded) {
          //resultDeferred.reject();
          return resultDeferred;
        }

        this._isLoaded = true;

        this._nodeMedia.parent('.webpage-container').addClass('initialized');

        console.log('webpage: ' + this._nodeMedia.data('src'));

        this._nodeMedia.attr('src', this._nodeMedia.data('src')).load(function () {
          this._node.find('.media-loading').hide();
        }.bind(this));
        this._node.find('.interaction-container').click(this._onEnableButtonClick.bind(this));

        this._node.on('mouseup touchstart', function () {
          this._node.addClass('scroll-off');
        }.bind(this));

        this._node.on('mousedown touchend', function () {
          this._node.removeClass('scroll-off');
        }.bind(this));

        this._node.mouseleave(function () {
          this._node.addClass('scroll-off');
        }.bind(this));

        this._nodeMedia.mouseleave(function () {
          this._node.addClass('scroll-off');
        }.bind(this));

        resultDeferred.resolve();

        return resultDeferred;
      }
    }, {
      key: 'performAction',
      value: function performAction(params) {
        if (!params || !params.viewIndex || !params.isActive) {
          return;
        }

        try {
          this._nodeMedia[0].contentWindow.performCascadeAction(params);
        } catch (e) {
          //
        }
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }]);

    return WebPage;
  }(_Media3.default);

  exports.default = WebPage;
  module.exports = exports['default'];
});
//# sourceMappingURL=WebPage.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/Empty', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"media-empty\">\r\n  <div class=\"me-placeholder\"></div>\r\n  <div class=\"media-empty-add\">\r\n    <img class=\"media-empty-icon-all\" src=\"resources/tpl/builder/icons/text-editor/Media.png\" />\r\n    <div class=\"media-empty-icon-image\">\r\n      <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\r\n    </div>\r\n    <div class=\"media-empty-label\">"
    + escapeExpression(((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper)))
    + "</div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/Empty',[],function(){});
define('storymaps-react/tpl/view/media/Empty',['module', 'exports', './Media', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'lib-build/hbars!./Empty', 'dojo/_base/lang', 'lib-build/less!./Empty'], function (module, exports, _Media2, _app, _Empty, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _app2 = _interopRequireDefault(_app);

  var _Empty2 = _interopRequireDefault(_Empty);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var PREVIEW_THUMB = 'resources/tpl/builder/icons/media-placeholder/image.jpg';
  var PREVIEW_ICON = 'resources/tpl/builder/icons/immersive-panel/image.png';

  var Empty = function (_Media) {
    _inherits(Empty, _Media);

    function Empty() {
      _classCallCheck(this, Empty);

      var _this = _possibleConstructorReturn(this, (Empty.__proto__ || Object.getPrototypeOf(Empty)).call(this, {
        type: 'empty',
        id: null,
        previewThumb: PREVIEW_THUMB,
        previewIcon: PREVIEW_ICON
      }));

      _this._onEdit = null;
      return _this;
    }

    _createClass(Empty, [{
      key: 'render',
      value: function render(context) {
        if (!context) {
          console.log('Could not render webmap in section');
          return '';
        }

        if (context.placement == 'block') {
          return '';
        } else {
          return (0, _Empty2.default)({
            id: this._domID,
            label: _app2.default.builder.immersiveViewPanel.addMedia
          });
        }
      }
    }, {
      key: 'load',
      value: function load() {
        //
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(Empty.prototype.__proto__ || Object.getPrototypeOf(Empty.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        this._node = params.container.find('#' + this._domID).parent();

        this._node.find('.me-placeholder').css('backgroundImage', 'url("resources/tpl/builder/icons/immersive/background-placeholder.jpg")');
        this._node.find('.media-empty-add').addClass('authorized-' + (params.mediaIcon || 'all')).click(this.onPickMedia.bind(this));
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'performAction',
      value: function performAction() {}
      //


      //
      // Builder
      //

    }, {
      key: 'serialize',
      value: function serialize() {
        return _lang2.default.clone({
          type: 'empty',
          empty: 'empty'
        });
      }
    }, {
      key: 'onPickMedia',
      value: function onPickMedia() {
        this._onAction('swap');
      }
    }]);

    return Empty;
  }(_Media3.default);

  exports.default = Empty;
  module.exports = exports['default'];
});
//# sourceMappingURL=Empty.js.map
;

define('lib-build/less!storymaps-react/tpl/view/media/Color',[],function(){});
define('storymaps-react/tpl/view/media/Color',['module', 'exports', './Media', 'dojo/_base/lang', 'lib-build/less!./Color'], function (module, exports, _Media2, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var Color = function (_Media) {
    _inherits(Color, _Media);

    function Color(color) {
      _classCallCheck(this, Color);

      var _this = _possibleConstructorReturn(this, (Color.__proto__ || Object.getPrototypeOf(Color)).call(this, {
        type: 'color',
        id: null,
        previewThumb: '',
        previewIcon: ''
      }));

      _this._color = color;
      return _this;
    }

    _createClass(Color, [{
      key: 'render',
      value: function render(context) {
        if (!this._color || !context) {
          console.log('Could not render color in section');
          return '';
        }

        return '<div class="media-color" style="background-color: ' + this._color.value + '"></div>';
      }
    }, {
      key: 'load',
      value: function load() {
        //
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        return _lang2.default.clone({
          type: 'color',
          color: this._color
        });
      }
    }]);

    return Color;
  }(_Media3.default);

  exports.default = Color;
  module.exports = exports['default'];
});
//# sourceMappingURL=Color.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/CreditsItemViewer', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "        <a href=\""
    + escapeExpression(((helper = (helper = helpers.link || (depth0 != null ? depth0.link : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"link","hash":{},"data":data}) : helper)))
    + "\" class=\"cr-item-input cr-source cr-link\" target=\"_blank\">"
    + escapeExpression(((helper = (helper = helpers.source || (depth0 != null ? depth0.source : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"source","hash":{},"data":data}) : helper)))
    + "</a>\r\n";
},"3":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "        <div class=\"cr-item-input cr-source\">"
    + escapeExpression(((helper = (helper = helpers.source || (depth0 != null ? depth0.source : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"source","hash":{},"data":data}) : helper)))
    + "</div>\r\n";
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<li class=\"cr-item viewer\">\r\n  <div class=\"cr-item-main\">\r\n    <div class=\"cr-input-container first\">\r\n      <div class=\"cr-item-input cr-content\">"
    + escapeExpression(((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper)))
    + "</div>\r\n    </div>\r\n    <span class=\"cr-pipe\"></span>\r\n    <div class=\"cr-input-container\">\r\n";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.link : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.program(3, data),"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "  </div>\r\n</li>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/Credits',[],function(){});
define('storymaps-react/tpl/view/media/Credits',['module', 'exports', './Media', 'lib-build/hbars!./CreditsItemViewer', 'lib-build/less!./Credits'], function (module, exports, _Media2, _CreditsItemViewer) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media3 = _interopRequireDefault(_Media2);

  var _CreditsItemViewer2 = _interopRequireDefault(_CreditsItemViewer);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var Credits = function (_Media) {
    _inherits(Credits, _Media);

    function Credits(credits) {
      _classCallCheck(this, Credits);

      var _this = _possibleConstructorReturn(this, (Credits.__proto__ || Object.getPrototypeOf(Credits)).call(this, {
        type: 'credits',
        id: null,
        previewThumb: '',
        previewIcon: ''
      }));

      _this._credits = credits;
      return _this;
    }

    _createClass(Credits, [{
      key: 'render',
      value: function render(context) {
        if (!this._credits || !context) {
          console.log('Could not render credits block in section');
          return '';
        }

        var markup = '<div id="' + this._domID + '" class="block block-type-credits"><ul class="cr-list">';

        if (this._credits.length) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = this._credits[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var credit = _step.value;

              markup += (0, _CreditsItemViewer2.default)({
                label: credit.label,
                link: credit.link,
                source: credit.source,
                empty: false,
                incomplete: false
              });
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        }

        markup += '</ul></div>';

        return markup;
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(Credits.prototype.__proto__ || Object.getPrototypeOf(Credits.prototype), 'postCreate', this).call(this, params);

        if (!params.container) {
          return;
        }

        this._node = params.container.find('#' + this._domID);
      }
    }, {
      key: 'load',
      value: function load() {
        //
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }, {
      key: 'getNode',
      value: function getNode() {
        return this._node;
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        //
      }
    }]);

    return Credits;
  }(_Media3.default);

  exports.default = Credits;
  module.exports = exports['default'];
});
//# sourceMappingURL=Credits.js.map
;

define('lib-build/css!storymaps/tpl/view/media/Discover',[],function(){});
define('storymaps/tpl/view/media/Discover',[
  'lib-build/css!./Discover'
], function(
  //viewCss
) {
  return function Discover(discover) {
    this.render = function(context) {
      var output = '';

      if (! discover || ! context) {
        console.log('Could not render Discover block in section');
        return output;
      }

      output += '<div class="discover">';
      output += ' <strong>' + discover.title + '</strong>';
      output += ' <table><tr>';
      $.each(discover.items, function(i, item) {
        output += '<td><div class="discover-item"><a href="' + item.url + '" target="_blank"><img src="' + item.thumbnail + '" /><div>' + item.title + '</div></a></div></td>';
      });
      output += ' </tr></table>';
      output += '</div>';

      return output;
    };
  };
});

define('storymaps-react/tpl/view/media/FactoryViewer',['module', 'exports', './Text', './Image', './ImageGallery', './Video', './WebMap', './WebScene', './WebPage', './Empty', './Color', './Credits', 'storymaps/tpl/view/media/Discover'], function (module, exports, _Text, _Image, _ImageGallery, _Video, _WebMap, _WebScene, _WebPage, _Empty, _Color, _Credits, _Discover) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Text2 = _interopRequireDefault(_Text);

  var _Image2 = _interopRequireDefault(_Image);

  var _ImageGallery2 = _interopRequireDefault(_ImageGallery);

  var _Video2 = _interopRequireDefault(_Video);

  var _WebMap2 = _interopRequireDefault(_WebMap);

  var _WebScene2 = _interopRequireDefault(_WebScene);

  var _WebPage2 = _interopRequireDefault(_WebPage);

  var _Empty2 = _interopRequireDefault(_Empty);

  var _Color2 = _interopRequireDefault(_Color);

  var _Credits2 = _interopRequireDefault(_Credits);

  var _Discover2 = _interopRequireDefault(_Discover);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var FactoryViewer = function () {
    function FactoryViewer() {
      _classCallCheck(this, FactoryViewer);
    }

    _createClass(FactoryViewer, null, [{
      key: 'getClasses',
      value: function getClasses() {
        return {
          Text: _Text2.default,

          Image: _Image2.default,
          ImageGallery: _ImageGallery2.default,
          Video: _Video2.default,
          WebMap: _WebMap2.default,
          WebScene: _WebScene2.default,
          WebPage: _WebPage2.default,

          Empty: _Empty2.default,

          Color: _Color2.default,
          Credits: _Credits2.default,
          Discover: _Discover2.default
        };
      }
    }, {
      key: 'createInstance',
      value: function createInstance(mediaJSON, mediaCache) {
        var media = this._parseMedia(mediaJSON.type, mediaJSON, mediaCache);

        if (media.setCache && mediaCache) {
          media.setCache(mediaCache);
        }

        if (mediaJSON.alternate) {
          var alternateMedia = this._parseMedia(mediaJSON.alternate, mediaJSON, mediaCache);

          if (alternateMedia.setCache && mediaCache) {
            alternateMedia.setCache(mediaCache);
          }

          media.setAlternate(alternateMedia);
        }

        return media;
      }
    }, {
      key: '_parseMedia',
      value: function _parseMedia(type, mediaJSON) {
        var media = null;

        if (type && !mediaJSON[type]) {
          console.error('Invalid json for: ', mediaJSON);
          return media;
        }

        var classes = this.getClasses();

        if (type == 'text') {
          media = new classes.Text(mediaJSON.text);
        } else if (type == 'image') {
          media = new classes.Image(mediaJSON.image);
        } else if (type == 'image-gallery') {
          media = new classes.ImageGallery(mediaJSON['image-gallery']);
        } else if (type == 'video') {
          media = new classes.Video(mediaJSON.video);
        } else if (type == 'webmap') {
          media = new classes.WebMap(mediaJSON.webmap);
        } else if (type == 'webscene') {
          media = new classes.WebScene(mediaJSON.webscene);
        } else if (type == 'webpage') {
          media = new classes.WebPage(mediaJSON.webpage);
        } else if (type == 'color') {
          media = new classes.Color(mediaJSON.color);
        } else if (type == 'credits') {
          media = new classes.Credits(mediaJSON.credits);
        } else if (type == 'discover') {
          media = new classes.Discover(mediaJSON.discover);
        } else if (type == 'empty') {
          media = new classes.Empty(mediaJSON.empty);
        } else {
          console.error('Could not find corresponding media for: ', mediaJSON);
        }

        return media;
      }
    }]);

    return FactoryViewer;
  }();

  exports.default = FactoryViewer;
  module.exports = exports['default'];
});
//# sourceMappingURL=FactoryViewer.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/PanelInvite', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<div class=\"builder-invite-background\"></div>\r\n<i class=\"builder-invite-open fa fa-pencil\" aria-hidden=\"true\"></i>\r\n<i class=\"builder-invite-close fa fa-check\" aria-hidden=\"true\"></i>\r\n";
  },"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/media/builder/PanelConfig', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<div class=\"builder-config\">\r\n  <div class=\"config-main\">\r\n    <ul class=\"builder-tabs\"></ul>\r\n    <div class=\"config-content\">\r\n      <div class=\"builder-active-tab\"></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n";
  },"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/builder/Panel',[],function(){});
define('storymaps-react/tpl/view/media/builder/Panel',['module', 'exports', 'lib-build/hbars!./PanelInvite', 'lib-build/hbars!./PanelConfig', 'lib-build/less!./Panel'], function (module, exports, _PanelInvite, _PanelConfig) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _PanelInvite2 = _interopRequireDefault(_PanelInvite);

  var _PanelConfig2 = _interopRequireDefault(_PanelConfig);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
    return typeof obj;
  } : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj;
  };

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var ACTIVE_CLASS = 'config-panel-active';

  var BuilderConfig = function () {
    function BuilderConfig(params) {
      _classCallCheck(this, BuilderConfig);

      params = params || {};

      if (!params.containerMedia || !params.tabs || !params.media || !params.onChange || !params.onAction) {
        return;
      }

      this._nodeMedia = params.containerMedia;
      this._nodeInvite = this._nodeMedia.find('.media-cfg-invite');
      this._nodePanel = this._nodeMedia.find('.media-cfg-panel');

      this._tabs = params.tabs;
      this._media = params.media;
      this._onChange = params.onChange;
      this._onToggle = params.onToggle;
      this._onAction = params.onAction;
      this._closeBtnStyle = params.closeBtnStyle;

      this.selectedClass = 'selected';

      this._init();
    }

    //
    // Private
    //

    _createClass(BuilderConfig, [{
      key: '_init',
      value: function _init() {
        var _this = this;

        this._nodeMedia.removeClass(ACTIVE_CLASS);
        this._nodeInvite.html((0, _PanelInvite2.default)({}));
        this._nodePanel.html((0, _PanelConfig2.default)({}));

        // Open/close button
        this._nodeInvite.off('click').click(this._toggleConfigPanel.bind(this));

        // List of tabs
        var tabsContainer = this._nodePanel.find('.builder-tabs');
        for (var i = 0; i < this._tabs.length; i++) {
          var tab = this._tabs[i];
          tabsContainer.append('<li class="tab btn-clear lighter' + (i === 0 ? ' selected' : '') + '" data-tab="' + tab.type + '">' + ('<span class="config-tab-icon fa ' + tab.icon + '"></span>') + ('' + tab.title) + '</li>');
        }

        // set one as selected.
        // attach onclick events
        var tabs = tabsContainer.find('.tab');
        // for some reason, "this" breaks
        var self = this;
        tabs.on('click', function (e) {
          // render the new tab, destroy the old one
          var target = $(e.currentTarget);
          var newTabType = target.data('tab');
          var oldTabType = tabsContainer.find('.tab.' + _this.selectedClass).data('tab');
          var newTab = self._tabs.find(function (tab) {
            return newTabType === tab.type;
          });
          var oldTab = self._tabs.find(function (tab) {
            return oldTabType === tab.type;
          });

          tabs.removeClass(_this.selectedClass);
          target.addClass(_this.selectedClass);

          oldTab && self.destroyTab(oldTab);
          newTab && self.renderTab(newTab);
        });

        //this._onChange();
      }
    }, {
      key: 'destroyTab',
      value: function destroyTab(tab) {
        tab.destroy();
      }
    }, {
      key: 'renderTab',
      value: function renderTab(tab) {
        var container = this._nodePanel.find('.builder-active-tab');

        container.html(tab.render());
        tab.postCreate({
          container: container,
          media: this._media,
          onChange: this._onChange,
          onAction: this._onAction,
          rootNode: this._nodePanel
        });
      }
    }, {
      key: '_toggleConfigPanel',
      value: function _toggleConfigPanel(e) {
        var _this2 = this;

        // if shutting, destroy the active panel as well
        if (this._nodeMedia.hasClass(ACTIVE_CLASS)) {
          var _ret = function () {
            // when used for background media, only the x allow to close close
            if (_this2._closeBtnStyle == 'light' && $(e.target).hasClass('builder-invite-background')) {
              return {
                v: void 0
              };
            }

            // destroy the existing tab
            var tabNode = _this2._nodePanel.find('.builder-tabs .tab.' + _this2.selectedClass);
            var tabType = tabNode.data('tab');
            var openTab = _this2._tabs.find(function (tab) {
              return tabType === tab.type;
            });

            // before the panel is destoyed, we may want to make data model changes...
            openTab && openTab.beforePanelDestroy();

            openTab && _this2.destroyTab(openTab);
          }();

          if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === "object") return _ret.v;
        } else {
          (function () {
            var tabNode = _this2._nodePanel.find('.builder-tabs .tab.' + _this2.selectedClass);
            var tabType = tabNode.data('tab');
            var openTab = _this2._tabs.find(function (tab) {
              return tabType === tab.type;
            });

            openTab && _this2.renderTab(openTab);

            //this._onChange();
          })();
        }

        this._nodeMedia.toggleClass(ACTIVE_CLASS);

        if (this._onToggle) {
          this._onToggle();
        }
      }
    }]);

    return BuilderConfig;
  }();

  exports.default = BuilderConfig;
  module.exports = exports['default'];
});
//# sourceMappingURL=Panel.js.map
;
define('storymaps-react/tpl/view/media/builder/Tab',['module', 'exports'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Tab = function () {
    function Tab(params) {
      _classCallCheck(this, Tab);

      this.title = '';
      this.selectedClass = 'selected';

      this._isActive = false;
      this._options = params;
      this._sectionOptions = params ? params.sectionOptions : null;
      this._onSectionChange = params ? params.onSectionChange : null;
    }

    _createClass(Tab, [{
      key: 'onChange',
      value: function onChange() {
        this._onChange();
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.container || !params.media || !params.onChange || !params.rootNode) {
          return;
        }

        this._isActive = true;

        this._node = params.container;
        this._media = params.media;
        this._onChange = params.onChange;
        this._onAction = params.onAction;
        this._rootNode = params.rootNode;
      }
    }, {
      key: 'beforePanelDestroy',
      value: function beforePanelDestroy() {}
    }, {
      key: 'destroy',
      value: function destroy() {
        this._isActive = false;
      }
    }, {
      key: 'setConfig',
      value: function setConfig(name, value) {
        this._media.options[name] = value;
        this.onChange();
      }
    }, {
      key: 'setMedia',
      value: function setMedia(name, value) {
        this._media[name] = value;
        this.onChange();
      }
    }, {
      key: 'setSectionConfig',
      value: function setSectionConfig(name, value) {
        this._sectionOptions[name] = value;
        this._onSectionChange();
      }
    }]);

    return Tab;
  }();

  exports.default = Tab;
  module.exports = exports['default'];
});
//# sourceMappingURL=Tab.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabSize', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section\">\r\n  <ul class=\"section-content horizontal\">\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"small\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/small.png\">\r\n      <span class=\"config-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.small : stack1), depth0))
    + "</span>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"medium\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/medium.png\">\r\n      <span class=\"config-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.medium : stack1), depth0))
    + "</span>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"large\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/large.png\">\r\n      <span class=\"config-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.large : stack1), depth0))
    + "</span>\r\n    </li>\r\n    <!--<li class=\"config-item\" data-type=\"size\" data-value=\"immersive\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/immersive.png\">\r\n      <span class=\"config-label\">Immersive...</span>\r\n    </li>-->\r\n  </ul>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/media/builder/Common',[],function(){});
define('storymaps-react/tpl/view/media/builder/TabSize',['module', 'exports', './Tab', 'lib-build/hbars!./TabSize', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'lib-build/less!./Common'], function (module, exports, _Tab2, _TabSize, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabSize2 = _interopRequireDefault(_TabSize);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabSize = function (_Tab) {
    _inherits(TabSize, _Tab);

    function TabSize() {
      _classCallCheck(this, TabSize);

      var _this = _possibleConstructorReturn(this, (TabSize.__proto__ || Object.getPrototypeOf(TabSize)).call(this));

      _this.title = _app2.default.builder.mediaConfig.tabs.size;
      _this.type = 'size';
      _this.icon = 'fa-arrows-alt';
      return _this;
    }

    _createClass(TabSize, [{
      key: 'render',
      value: function render() {
        return (0, _TabSize2.default)({
          strings: _app2.default.builder.mediaConfig.size
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(TabSize.prototype.__proto__ || Object.getPrototypeOf(TabSize.prototype), 'postCreate', this).call(this, params);

        var size = this._media.options.size || 'large';
        var sizeItems = this._node.find('.config-item[data-type="size"]');

        this._node.find('.config-item[data-value="' + size + '"]').addClass(this.selectedClass);
        sizeItems.on('click', function (e) {
          var target = $(e.currentTarget);

          _this2.setConfig('size', target.data('value'));
          sizeItems.removeClass(_this2.selectedClass);
          target.addClass(_this2.selectedClass);
        });
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabSize.prototype.__proto__ || Object.getPrototypeOf(TabSize.prototype), 'destroy', this).call(this);

        var sizeItems = this._node.find('.config-item[data-type="size"]');

        sizeItems.off('click');
      }
    }]);

    return TabSize;
  }(_Tab3.default);

  exports.default = TabSize;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabSize.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabSizeImage', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section\">\r\n  <ul class=\"section-content horizontal\">\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"small\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/small.png\">\r\n      <span class=\"config-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.small : stack1), depth0))
    + "</span>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"medium\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/medium.png\">\r\n      <span class=\"config-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.medium : stack1), depth0))
    + "</span>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"large\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/large.png\">\r\n      <span class=\"config-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.large : stack1), depth0))
    + "</span>\r\n    </li>\r\n    <!--<li class=\"config-item\" data-type=\"size\" data-value=\"title\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/title.png\">\r\n      <span class=\"config-label\">Title</span>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"size\" data-value=\"immersive\">\r\n      <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/immersive.png\">\r\n      <span class=\"config-label\">Immersive...</span>\r\n    </li>-->\r\n  </ul>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabSizeImage',['module', 'exports', './TabSize', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'lib-build/hbars!./TabSizeImage', 'lib-build/less!./Common'], function (module, exports, _TabSize2, _app, _TabSizeImage) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _TabSize3 = _interopRequireDefault(_TabSize2);

  var _app2 = _interopRequireDefault(_app);

  var _TabSizeImage2 = _interopRequireDefault(_TabSizeImage);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabSizeImage = function (_TabSize) {
    _inherits(TabSizeImage, _TabSize);

    function TabSizeImage() {
      _classCallCheck(this, TabSizeImage);

      return _possibleConstructorReturn(this, (TabSizeImage.__proto__ || Object.getPrototypeOf(TabSizeImage)).call(this));
    }

    _createClass(TabSizeImage, [{
      key: 'render',
      value: function render() {
        return (0, _TabSizeImage2.default)({
          strings: _app2.default.builder.mediaConfig.size
        });
      }
    }]);

    return TabSizeImage;
  }(_TabSize3.default);

  exports.default = TabSizeImage;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabSizeImage.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabBackground', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.cropExplanationImmersive : stack1), depth0));
  },"3":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.cropExplanation : stack1), depth0));
  },"5":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "    <div class=\"section-content crop-check\">\r\n      <label class=\"check\"><input class=\"fit-fill\" type=\"checkbox\" value=\"fit\"> "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.noCrop : stack1), depth0))
    + "</label>\r\n    </div>\r\n";
},"7":function(depth0,helpers,partials,data) {
  return " preview-title";
  },"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression, buffer = "<div class=\"builder-config-section\">\r\n  <div class=\"section-content vertical-list fit-fill\">\r\n    <div class=\"section-content two-pane\" data-mode=\"fill\">\r\n      <div class=\"content-pane\">\r\n        <p class=\"config-label overview-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.mostImportantPart : stack1), depth0))
    + "</p>\r\n        <span class=\"crop-info fa fa-info-circle\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.isImmersive : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.program(3, data),"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\"></span>\r\n      </div>\r\n      <div class=\"content-pane overview-thumbnail-pane\">\r\n        <img class=\"overview-thumbnail\" src=\"\"/>\r\n        <div class=\"overview-dot\"></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"section-content\" data-mode=\"fit\">\r\n      <div class=\"content-pane fit-content\">\r\n        <ul class=\"fit-palette\"></ul>\r\n      </div>\r\n      <div class=\"content-pane fit-content\">\r\n        <div class=\"fit-color-picker not-alone\">\r\n          <div class=\"color-picker-icons\">\r\n            <i class=\"fit-brush fa fa-paint-brush\"></i>\r\n            <i class=\"fit-down-arrow fa fa-chevron-down\"></i>\r\n          </div>\r\n          <span class=\"fit-color-picker-color\"></span>\r\n        </div>\r\n        <div class=\"fit-color-picker-color\"></div>\r\n      </div>\r\n      <div class=\"content-pane fit-loading\">\r\n        <span class=\"fit-loading-icon large-loader\"></span>\r\n      </div>\r\n    </div>\r\n";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.isImmersive : depth0), {"name":"if","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "  </div>\r\n</div>\r\n<div class=\"builder-config-section larger\">\r\n  <ul class=\"section-content horizontal preview-section\">\r\n    <li class=\"config-item preview-item horizontal\">\r\n      <h4 class=\"responsive-preview-title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.previews : stack1), depth0))
    + "</h4>\r\n      <div class=\"responsive-frame-container\">\r\n        <div class=\"responsive-backing backing-horizontal\"></div>\r\n        <div class=\"responsive-preview preview-horizontal";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.isTitle : depth0), {"name":"if","hash":{},"fn":this.program(7, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\"></div>\r\n        <img class=\"responsive-frame frame-horizontal\" src=\"resources/tpl/builder/icons/media-config/previewLandscape.png\" />\r\n      </div>\r\n    </li>\r\n    <li class=\"config-item preview-item\">\r\n      <div class=\"responsive-frame-container\">\r\n        <div class=\"responsive-backing backing-vertical\"></div>\r\n        <div class=\"responsive-preview preview-vertical";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.isTitle : depth0), {"name":"if","hash":{},"fn":this.program(7, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\"></div>\r\n        <img class=\"responsive-frame frame-vertical\" src=\"resources/tpl/builder/icons/media-config/previewPortrait.png\" />\r\n      </div>\r\n    </li>\r\n  </ul>\r\n</div>\r\n";
},"useData":true}); });

// Spectrum Colorpicker v1.8.0
// https://github.com/bgrins/spectrum
// Author: Brian Grinstead
// License: MIT

(function (factory) {
    "use strict";

    if (typeof define === 'function' && define.amd) { // AMD
        define('lib/spectrum/spectrum',['jquery'], factory);
    }
    else if (typeof exports == "object" && typeof module == "object") { // CommonJS
        module.exports = factory(require('jquery'));
    }
    else { // Browser
        factory(jQuery);
    }
})(function($, undefined) {
    "use strict";

    var defaultOpts = {

        // Callbacks
        beforeShow: noop,
        move: noop,
        change: noop,
        show: noop,
        hide: noop,

        // Options
        color: false,
        flat: false,
        showInput: false,
        allowEmpty: false,
        showButtons: true,
        clickoutFiresChange: true,
        showInitial: false,
        showPalette: false,
        showPaletteOnly: false,
        hideAfterPaletteSelect: false,
        togglePaletteOnly: false,
        showSelectionPalette: true,
        localStorageKey: false,
        appendTo: "body",
        maxSelectionSize: 7,
        cancelText: "cancel",
        chooseText: "choose",
        togglePaletteMoreText: "more",
        togglePaletteLessText: "less",
        clearText: "Clear Color Selection",
        noColorSelectedText: "No Color Selected",
        preferredFormat: false,
        className: "", // Deprecated - use containerClassName and replacerClassName instead.
        containerClassName: "",
        replacerClassName: "",
        showAlpha: false,
        theme: "sp-light",
        palette: [["#ffffff", "#000000", "#ff0000", "#ff8000", "#ffff00", "#008000", "#0000ff", "#4b0082", "#9400d3"]],
        selectionPalette: [],
        disabled: false,
        offset: null
    },
    spectrums = [],
    IE = !!/msie/i.exec( window.navigator.userAgent ),
    rgbaSupport = (function() {
        function contains( str, substr ) {
            return !!~('' + str).indexOf(substr);
        }

        var elem = document.createElement('div');
        var style = elem.style;
        style.cssText = 'background-color:rgba(0,0,0,.5)';
        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');
    })(),
    replaceInput = [
        "<div class='sp-replacer'>",
            "<div class='sp-preview'><div class='sp-preview-inner'></div></div>",
            "<div class='sp-dd'>&#9660;</div>",
        "</div>"
    ].join(''),
    markup = (function () {

        // IE does not support gradients with multiple stops, so we need to simulate
        //  that for the rainbow slider with 8 divs that each have a single gradient
        var gradientFix = "";
        if (IE) {
            for (var i = 1; i <= 6; i++) {
                gradientFix += "<div class='sp-" + i + "'></div>";
            }
        }

        return [
            "<div class='sp-container sp-hidden'>",
                "<div class='sp-palette-container'>",
                    "<div class='sp-palette sp-thumb sp-cf'></div>",
                    "<div class='sp-palette-button-container sp-cf'>",
                        "<button type='button' class='sp-palette-toggle'></button>",
                    "</div>",
                "</div>",
                "<div class='sp-picker-container'>",
                    "<div class='sp-top sp-cf'>",
                        "<div class='sp-fill'></div>",
                        "<div class='sp-top-inner'>",
                            "<div class='sp-color'>",
                                "<div class='sp-sat'>",
                                    "<div class='sp-val'>",
                                        "<div class='sp-dragger'></div>",
                                    "</div>",
                                "</div>",
                            "</div>",
                            "<div class='sp-clear sp-clear-display'>",
                            "</div>",
                            "<div class='sp-hue'>",
                                "<div class='sp-slider'></div>",
                                gradientFix,
                            "</div>",
                        "</div>",
                        "<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>",
                    "</div>",
                    "<div class='sp-input-container sp-cf'>",
                        "<input class='sp-input' type='text' spellcheck='false'  />",
                    "</div>",
                    "<div class='sp-initial sp-thumb sp-cf'></div>",
                    "<div class='sp-button-container sp-cf'>",
                        "<a class='sp-cancel' href='#'></a>",
                        "<button type='button' class='sp-choose'></button>",
                    "</div>",
                "</div>",
            "</div>"
        ].join("");
    })();

    function paletteTemplate (p, color, className, opts) {
        var html = [];
        for (var i = 0; i < p.length; i++) {
            var current = p[i];
            if(current) {
                var tiny = tinycolor(current);
                var c = tiny.toHsl().l < 0.5 ? "sp-thumb-el sp-thumb-dark" : "sp-thumb-el sp-thumb-light";
                c += (tinycolor.equals(color, current)) ? " sp-thumb-active" : "";
                var formattedString = tiny.toString(opts.preferredFormat || "rgb");
                var swatchStyle = rgbaSupport ? ("background-color:" + tiny.toRgbString()) : "filter:" + tiny.toFilter();
                html.push('<span title="' + formattedString + '" data-color="' + tiny.toRgbString() + '" class="' + c + '"><span class="sp-thumb-inner" style="' + swatchStyle + ';" /></span>');
            } else {
                var cls = 'sp-clear-display';
                html.push($('<div />')
                    .append($('<span data-color="" style="background-color:transparent;" class="' + cls + '"></span>')
                        .attr('title', opts.noColorSelectedText)
                    )
                    .html()
                );
            }
        }
        return "<div class='sp-cf " + className + "'>" + html.join('') + "</div>";
    }

    function hideAll() {
        for (var i = 0; i < spectrums.length; i++) {
            if (spectrums[i]) {
                spectrums[i].hide();
            }
        }
    }

    function instanceOptions(o, callbackContext) {
        var opts = $.extend({}, defaultOpts, o);
        opts.callbacks = {
            'move': bind(opts.move, callbackContext),
            'change': bind(opts.change, callbackContext),
            'show': bind(opts.show, callbackContext),
            'hide': bind(opts.hide, callbackContext),
            'beforeShow': bind(opts.beforeShow, callbackContext)
        };

        return opts;
    }

    function spectrum(element, o) {

        var opts = instanceOptions(o, element),
            flat = opts.flat,
            showSelectionPalette = opts.showSelectionPalette,
            localStorageKey = opts.localStorageKey,
            theme = opts.theme,
            callbacks = opts.callbacks,
            resize = throttle(reflow, 10),
            visible = false,
            isDragging = false,
            dragWidth = 0,
            dragHeight = 0,
            dragHelperHeight = 0,
            slideHeight = 0,
            slideWidth = 0,
            alphaWidth = 0,
            alphaSlideHelperWidth = 0,
            slideHelperHeight = 0,
            currentHue = 0,
            currentSaturation = 0,
            currentValue = 0,
            currentAlpha = 1,
            palette = [],
            paletteArray = [],
            paletteLookup = {},
            selectionPalette = opts.selectionPalette.slice(0),
            maxSelectionSize = opts.maxSelectionSize,
            draggingClass = "sp-dragging",
            shiftMovementDirection = null;

        var doc = element.ownerDocument,
            body = doc.body,
            boundElement = $(element),
            disabled = false,
            container = $(markup, doc).addClass(theme),
            pickerContainer = container.find(".sp-picker-container"),
            dragger = container.find(".sp-color"),
            dragHelper = container.find(".sp-dragger"),
            slider = container.find(".sp-hue"),
            slideHelper = container.find(".sp-slider"),
            alphaSliderInner = container.find(".sp-alpha-inner"),
            alphaSlider = container.find(".sp-alpha"),
            alphaSlideHelper = container.find(".sp-alpha-handle"),
            textInput = container.find(".sp-input"),
            paletteContainer = container.find(".sp-palette"),
            initialColorContainer = container.find(".sp-initial"),
            cancelButton = container.find(".sp-cancel"),
            clearButton = container.find(".sp-clear"),
            chooseButton = container.find(".sp-choose"),
            toggleButton = container.find(".sp-palette-toggle"),
            isInput = boundElement.is("input"),
            isInputTypeColor = isInput && boundElement.attr("type") === "color" && inputTypeColorSupport(),
            shouldReplace = isInput && !flat,
            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),
            offsetElement = (shouldReplace) ? replacer : boundElement,
            previewElement = replacer.find(".sp-preview-inner"),
            initialColor = opts.color || (isInput && boundElement.val()),
            colorOnShow = false,
            currentPreferredFormat = opts.preferredFormat,
            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,
            isEmpty = !initialColor,
            allowEmpty = opts.allowEmpty && !isInputTypeColor;

        function applyOptions() {

            if (opts.showPaletteOnly) {
                opts.showPalette = true;
            }

            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);

            if (opts.palette) {
                palette = opts.palette.slice(0);
                paletteArray = $.isArray(palette[0]) ? palette : [palette];
                paletteLookup = {};
                for (var i = 0; i < paletteArray.length; i++) {
                    for (var j = 0; j < paletteArray[i].length; j++) {
                        var rgb = tinycolor(paletteArray[i][j]).toRgbString();
                        paletteLookup[rgb] = true;
                    }
                }
            }

            container.toggleClass("sp-flat", flat);
            container.toggleClass("sp-input-disabled", !opts.showInput);
            container.toggleClass("sp-alpha-enabled", opts.showAlpha);
            container.toggleClass("sp-clear-enabled", allowEmpty);
            container.toggleClass("sp-buttons-disabled", !opts.showButtons);
            container.toggleClass("sp-palette-buttons-disabled", !opts.togglePaletteOnly);
            container.toggleClass("sp-palette-disabled", !opts.showPalette);
            container.toggleClass("sp-palette-only", opts.showPaletteOnly);
            container.toggleClass("sp-initial-disabled", !opts.showInitial);
            container.addClass(opts.className).addClass(opts.containerClassName);

            reflow();
        }

        function initialize() {

            if (IE) {
                container.find("*:not(input)").attr("unselectable", "on");
            }

            applyOptions();

            if (shouldReplace) {
                boundElement.after(replacer).hide();
            }

            if (!allowEmpty) {
                clearButton.hide();
            }

            if (flat) {
                boundElement.after(container).hide();
            }
            else {

                var appendTo = opts.appendTo === "parent" ? boundElement.parent() : $(opts.appendTo);
                if (appendTo.length !== 1) {
                    appendTo = $("body");
                }

                appendTo.append(container);
            }

            updateSelectionPaletteFromStorage();

            offsetElement.bind("click.spectrum touchstart.spectrum", function (e) {
                if (!disabled) {
                    toggle();
                }

                e.stopPropagation();

                if (!$(e.target).is("input")) {
                    e.preventDefault();
                }
            });

            if(boundElement.is(":disabled") || (opts.disabled === true)) {
                disable();
            }

            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.
            container.click(stopPropagation);

            // Handle user typed input
            textInput.change(setFromTextInput);
            textInput.bind("paste", function () {
                setTimeout(setFromTextInput, 1);
            });
            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });

            cancelButton.text(opts.cancelText);
            cancelButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                revert();
                hide();
            });

            clearButton.attr("title", opts.clearText);
            clearButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                isEmpty = true;
                move();

                if(flat) {
                    //for the flat style, this is a change event
                    updateOriginalInput(true);
                }
            });

            chooseButton.text(opts.chooseText);
            chooseButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                if (IE && textInput.is(":focus")) {
                    textInput.trigger('change');
                }

                if (isValid()) {
                    updateOriginalInput(true);
                    hide();
                }
            });

            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);
            toggleButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                opts.showPaletteOnly = !opts.showPaletteOnly;

                // To make sure the Picker area is drawn on the right, next to the
                // Palette area (and not below the palette), first move the Palette
                // to the left to make space for the picker, plus 5px extra.
                // The 'applyOptions' function puts the whole container back into place
                // and takes care of the button-text and the sp-palette-only CSS class.
                if (!opts.showPaletteOnly && !flat) {
                    container.css('left', '-=' + (pickerContainer.outerWidth(true) + 5));
                }
                applyOptions();
            });

            draggable(alphaSlider, function (dragX, dragY, e) {
                currentAlpha = (dragX / alphaWidth);
                isEmpty = false;
                if (e.shiftKey) {
                    currentAlpha = Math.round(currentAlpha * 10) / 10;
                }

                move();
            }, dragStart, dragStop);

            draggable(slider, function (dragX, dragY) {
                currentHue = parseFloat(dragY / slideHeight);
                isEmpty = false;
                if (!opts.showAlpha) {
                    currentAlpha = 1;
                }
                move();
            }, dragStart, dragStop);

            draggable(dragger, function (dragX, dragY, e) {

                // shift+drag should snap the movement to either the x or y axis.
                if (!e.shiftKey) {
                    shiftMovementDirection = null;
                }
                else if (!shiftMovementDirection) {
                    var oldDragX = currentSaturation * dragWidth;
                    var oldDragY = dragHeight - (currentValue * dragHeight);
                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);

                    shiftMovementDirection = furtherFromX ? "x" : "y";
                }

                var setSaturation = !shiftMovementDirection || shiftMovementDirection === "x";
                var setValue = !shiftMovementDirection || shiftMovementDirection === "y";

                if (setSaturation) {
                    currentSaturation = parseFloat(dragX / dragWidth);
                }
                if (setValue) {
                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);
                }

                isEmpty = false;
                if (!opts.showAlpha) {
                    currentAlpha = 1;
                }

                move();

            }, dragStart, dragStop);

            if (!!initialColor) {
                set(initialColor);

                // In case color was black - update the preview UI and set the format
                // since the set function will not run (default color is black).
                updateUI();
                currentPreferredFormat = opts.preferredFormat || tinycolor(initialColor).format;

                addColorToSelectionPalette(initialColor);
            }
            else {
                updateUI();
            }

            if (flat) {
                show();
            }

            function paletteElementClick(e) {
                if (e.data && e.data.ignore) {
                    set($(e.target).closest(".sp-thumb-el").data("color"));
                    move();
                }
                else {
                    set($(e.target).closest(".sp-thumb-el").data("color"));
                    move();
                    updateOriginalInput(true);
                    if (opts.hideAfterPaletteSelect) {
                      hide();
                    }
                }

                return false;
            }

            var paletteEvent = IE ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
            paletteContainer.delegate(".sp-thumb-el", paletteEvent, paletteElementClick);
            initialColorContainer.delegate(".sp-thumb-el:nth-child(1)", paletteEvent, { ignore: true }, paletteElementClick);
        }

        function updateSelectionPaletteFromStorage() {

            if (localStorageKey && window.localStorage) {

                // Migrate old palettes over to new format.  May want to remove this eventually.
                try {
                    var oldPalette = window.localStorage[localStorageKey].split(",#");
                    if (oldPalette.length > 1) {
                        delete window.localStorage[localStorageKey];
                        $.each(oldPalette, function(i, c) {
                             addColorToSelectionPalette(c);
                        });
                    }
                }
                catch(e) { }

                try {
                    selectionPalette = window.localStorage[localStorageKey].split(";");
                }
                catch (e) { }
            }
        }

        function addColorToSelectionPalette(color) {
            if (showSelectionPalette) {
                var rgb = tinycolor(color).toRgbString();
                if (!paletteLookup[rgb] && $.inArray(rgb, selectionPalette) === -1) {
                    selectionPalette.push(rgb);
                    while(selectionPalette.length > maxSelectionSize) {
                        selectionPalette.shift();
                    }
                }

                if (localStorageKey && window.localStorage) {
                    try {
                        window.localStorage[localStorageKey] = selectionPalette.join(";");
                    }
                    catch(e) { }
                }
            }
        }

        function getUniqueSelectionPalette() {
            var unique = [];
            if (opts.showPalette) {
                for (var i = 0; i < selectionPalette.length; i++) {
                    var rgb = tinycolor(selectionPalette[i]).toRgbString();

                    if (!paletteLookup[rgb]) {
                        unique.push(selectionPalette[i]);
                    }
                }
            }

            return unique.reverse().slice(0, opts.maxSelectionSize);
        }

        function drawPalette() {

            var currentColor = get();

            var html = $.map(paletteArray, function (palette, i) {
                return paletteTemplate(palette, currentColor, "sp-palette-row sp-palette-row-" + i, opts);
            });

            updateSelectionPaletteFromStorage();

            if (selectionPalette) {
                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, "sp-palette-row sp-palette-row-selection", opts));
            }

            paletteContainer.html(html.join(""));
        }

        function drawInitial() {
            if (opts.showInitial) {
                var initial = colorOnShow;
                var current = get();
                initialColorContainer.html(paletteTemplate([initial, current], current, "sp-palette-row-initial", opts));
            }
        }

        function dragStart() {
            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {
                reflow();
            }
            isDragging = true;
            container.addClass(draggingClass);
            shiftMovementDirection = null;
            boundElement.trigger('dragstart.spectrum', [ get() ]);
        }

        function dragStop() {
            isDragging = false;
            container.removeClass(draggingClass);
            boundElement.trigger('dragstop.spectrum', [ get() ]);
        }

        function setFromTextInput() {

            var value = textInput.val();

            if ((value === null || value === "") && allowEmpty) {
                set(null);
                updateOriginalInput(true);
            }
            else {
                var tiny = tinycolor(value);
                if (tiny.isValid()) {
                    set(tiny);
                    updateOriginalInput(true);
                }
                else {
                    textInput.addClass("sp-validation-error");
                }
            }
        }

        function toggle() {
            if (visible) {
                hide();
            }
            else {
                show();
            }
        }

        function show() {
            var event = $.Event('beforeShow.spectrum');

            if (visible) {
                reflow();
                return;
            }

            boundElement.trigger(event, [ get() ]);

            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {
                return;
            }

            hideAll();
            visible = true;

            $(doc).bind("keydown.spectrum", onkeydown);
            $(doc).bind("click.spectrum", clickout);
            $(window).bind("resize.spectrum", resize);
            replacer.addClass("sp-active");
            container.removeClass("sp-hidden");

            reflow();
            updateUI();

            colorOnShow = get();

            drawInitial();
            callbacks.show(colorOnShow);
            boundElement.trigger('show.spectrum', [ colorOnShow ]);
        }

        function onkeydown(e) {
            // Close on ESC
            if (e.keyCode === 27) {
                hide();
            }
        }

        function clickout(e) {
            // Return on right click.
            if (e.button == 2) { return; }

            // If a drag event was happening during the mouseup, don't hide
            // on click.
            if (isDragging) { return; }

            if (clickoutFiresChange) {
                updateOriginalInput(true);
            }
            else {
                revert();
            }
            hide();
        }

        function hide() {
            // Return if hiding is unnecessary
            if (!visible || flat) { return; }
            visible = false;

            $(doc).unbind("keydown.spectrum", onkeydown);
            $(doc).unbind("click.spectrum", clickout);
            $(window).unbind("resize.spectrum", resize);

            replacer.removeClass("sp-active");
            container.addClass("sp-hidden");

            callbacks.hide(get());
            boundElement.trigger('hide.spectrum', [ get() ]);
        }

        function revert() {
            set(colorOnShow, true);
        }

        function set(color, ignoreFormatChange) {
            if (tinycolor.equals(color, get())) {
                // Update UI just in case a validation error needs
                // to be cleared.
                updateUI();
                return;
            }

            var newColor, newHsv;
            if (!color && allowEmpty) {
                isEmpty = true;
            } else {
                isEmpty = false;
                newColor = tinycolor(color);
                newHsv = newColor.toHsv();

                currentHue = (newHsv.h % 360) / 360;
                currentSaturation = newHsv.s;
                currentValue = newHsv.v;
                currentAlpha = newHsv.a;
            }
            updateUI();

            if (newColor && newColor.isValid() && !ignoreFormatChange) {
                currentPreferredFormat = opts.preferredFormat || newColor.getFormat();
            }
        }

        function get(opts) {
            opts = opts || { };

            if (allowEmpty && isEmpty) {
                return null;
            }

            return tinycolor.fromRatio({
                h: currentHue,
                s: currentSaturation,
                v: currentValue,
                a: Math.round(currentAlpha * 100) / 100
            }, { format: opts.format || currentPreferredFormat });
        }

        function isValid() {
            return !textInput.hasClass("sp-validation-error");
        }

        function move() {
            updateUI();

            callbacks.move(get());
            boundElement.trigger('move.spectrum', [ get() ]);
        }

        function updateUI() {

            textInput.removeClass("sp-validation-error");

            updateHelperLocations();

            // Update dragger background color (gradients take care of saturation and value).
            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });
            dragger.css("background-color", flatColor.toHexString());

            // Get a format that alpha will be included in (hex and names ignore alpha)
            var format = currentPreferredFormat;
            if (currentAlpha < 1 && !(currentAlpha === 0 && format === "name")) {
                if (format === "hex" || format === "hex3" || format === "hex6" || format === "name") {
                    format = "rgb";
                }
            }

            var realColor = get({ format: format }),
                displayColor = '';

             //reset background info for preview element
            previewElement.removeClass("sp-clear-display");
            previewElement.css('background-color', 'transparent');

            if (!realColor && allowEmpty) {
                // Update the replaced elements background with icon indicating no color selection
                previewElement.addClass("sp-clear-display");
            }
            else {
                var realHex = realColor.toHexString(),
                    realRgb = realColor.toRgbString();

                // Update the replaced elements background color (with actual selected color)
                if (rgbaSupport || realColor.alpha === 1) {
                    previewElement.css("background-color", realRgb);
                }
                else {
                    previewElement.css("background-color", "transparent");
                    previewElement.css("filter", realColor.toFilter());
                }

                if (opts.showAlpha) {
                    var rgb = realColor.toRgb();
                    rgb.a = 0;
                    var realAlpha = tinycolor(rgb).toRgbString();
                    var gradient = "linear-gradient(left, " + realAlpha + ", " + realHex + ")";

                    if (IE) {
                        alphaSliderInner.css("filter", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));
                    }
                    else {
                        alphaSliderInner.css("background", "-webkit-" + gradient);
                        alphaSliderInner.css("background", "-moz-" + gradient);
                        alphaSliderInner.css("background", "-ms-" + gradient);
                        // Use current syntax gradient on unprefixed property.
                        alphaSliderInner.css("background",
                            "linear-gradient(to right, " + realAlpha + ", " + realHex + ")");
                    }
                }

                displayColor = realColor.toString(format);
            }

            // Update the text entry input as it changes happen
            if (opts.showInput) {
                textInput.val(displayColor);
            }

            if (opts.showPalette) {
                drawPalette();
            }

            drawInitial();
        }

        function updateHelperLocations() {
            var s = currentSaturation;
            var v = currentValue;

            if(allowEmpty && isEmpty) {
                //if selected color is empty, hide the helpers
                alphaSlideHelper.hide();
                slideHelper.hide();
                dragHelper.hide();
            }
            else {
                //make sure helpers are visible
                alphaSlideHelper.show();
                slideHelper.show();
                dragHelper.show();

                // Where to show the little circle in that displays your current selected color
                var dragX = s * dragWidth;
                var dragY = dragHeight - (v * dragHeight);
                dragX = Math.max(
                    -dragHelperHeight,
                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)
                );
                dragY = Math.max(
                    -dragHelperHeight,
                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)
                );
                dragHelper.css({
                    "top": dragY + "px",
                    "left": dragX + "px"
                });

                var alphaX = currentAlpha * alphaWidth;
                alphaSlideHelper.css({
                    "left": (alphaX - (alphaSlideHelperWidth / 2)) + "px"
                });

                // Where to show the bar that displays your current selected hue
                var slideY = (currentHue) * slideHeight;
                slideHelper.css({
                    "top": (slideY - slideHelperHeight) + "px"
                });
            }
        }

        function updateOriginalInput(fireCallback) {
            var color = get(),
                displayColor = '',
                hasChanged = !tinycolor.equals(color, colorOnShow);

            if (color) {
                displayColor = color.toString(currentPreferredFormat);
                // Update the selection palette with the current color
                addColorToSelectionPalette(color);
            }

            if (isInput) {
                boundElement.val(displayColor);
            }

            if (fireCallback && hasChanged) {
                callbacks.change(color);
                boundElement.trigger('change', [ color ]);
            }
        }

        function reflow() {
            if (!visible) {
                return; // Calculations would be useless and wouldn't be reliable anyways
            }
            dragWidth = dragger.width();
            dragHeight = dragger.height();
            dragHelperHeight = dragHelper.height();
            slideWidth = slider.width();
            slideHeight = slider.height();
            slideHelperHeight = slideHelper.height();
            alphaWidth = alphaSlider.width();
            alphaSlideHelperWidth = alphaSlideHelper.width();

            if (!flat) {
                container.css("position", "absolute");
                if (opts.offset) {
                    container.offset(opts.offset);
                } else {
                    container.offset(getOffset(container, offsetElement));
                }
            }

            updateHelperLocations();

            if (opts.showPalette) {
                drawPalette();
            }

            boundElement.trigger('reflow.spectrum');
        }

        function destroy() {
            boundElement.show();
            offsetElement.unbind("click.spectrum touchstart.spectrum");
            container.remove();
            replacer.remove();
            spectrums[spect.id] = null;
        }

        function option(optionName, optionValue) {
            if (optionName === undefined) {
                return $.extend({}, opts);
            }
            if (optionValue === undefined) {
                return opts[optionName];
            }

            opts[optionName] = optionValue;

            if (optionName === "preferredFormat") {
                currentPreferredFormat = opts.preferredFormat;
            }
            applyOptions();
        }

        function enable() {
            disabled = false;
            boundElement.attr("disabled", false);
            offsetElement.removeClass("sp-disabled");
        }

        function disable() {
            hide();
            disabled = true;
            boundElement.attr("disabled", true);
            offsetElement.addClass("sp-disabled");
        }

        function setOffset(coord) {
            opts.offset = coord;
            reflow();
        }

        initialize();

        var spect = {
            show: show,
            hide: hide,
            toggle: toggle,
            reflow: reflow,
            option: option,
            enable: enable,
            disable: disable,
            offset: setOffset,
            set: function (c) {
                set(c);
                updateOriginalInput();
            },
            get: get,
            destroy: destroy,
            container: container
        };

        spect.id = spectrums.push(spect) - 1;

        return spect;
    }

    /**
    * checkOffset - get the offset below/above and left/right element depending on screen position
    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js
    */
    function getOffset(picker, input) {
        var extraY = 0;
        var dpWidth = picker.outerWidth();
        var dpHeight = picker.outerHeight();
        var inputHeight = input.outerHeight();
        var doc = picker[0].ownerDocument;
        var docElem = doc.documentElement;
        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();
        var viewHeight = docElem.clientHeight + $(doc).scrollTop();
        var offset = input.offset();
        offset.top += inputHeight;

        offset.left -=
            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
            Math.abs(offset.left + dpWidth - viewWidth) : 0);

        offset.top -=
            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
            Math.abs(dpHeight + inputHeight - extraY) : extraY));

        return offset;
    }

    /**
    * noop - do nothing
    */
    function noop() {

    }

    /**
    * stopPropagation - makes the code only doing this a little easier to read in line
    */
    function stopPropagation(e) {
        e.stopPropagation();
    }

    /**
    * Create a function bound to a given object
    * Thanks to underscore.js
    */
    function bind(func, obj) {
        var slice = Array.prototype.slice;
        var args = slice.call(arguments, 2);
        return function () {
            return func.apply(obj, args.concat(slice.call(arguments)));
        };
    }

    /**
    * Lightweight drag helper.  Handles containment within the element, so that
    * when dragging, the x is within [0,element.width] and y is within [0,element.height]
    */
    function draggable(element, onmove, onstart, onstop) {
        onmove = onmove || function () { };
        onstart = onstart || function () { };
        onstop = onstop || function () { };
        var doc = document;
        var dragging = false;
        var offset = {};
        var maxHeight = 0;
        var maxWidth = 0;
        var hasTouch = ('ontouchstart' in window);

        var duringDragEvents = {};
        duringDragEvents["selectstart"] = prevent;
        duringDragEvents["dragstart"] = prevent;
        duringDragEvents["touchmove mousemove"] = move;
        duringDragEvents["touchend mouseup"] = stop;

        function prevent(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.returnValue = false;
        }

        function move(e) {
            if (dragging) {
                // Mouseup happened outside of window
                if (IE && doc.documentMode < 9 && !e.button) {
                    return stop();
                }

                var t0 = e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0];
                var pageX = t0 && t0.pageX || e.pageX;
                var pageY = t0 && t0.pageY || e.pageY;

                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));
                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));

                if (hasTouch) {
                    // Stop scrolling in iOS
                    prevent(e);
                }

                onmove.apply(element, [dragX, dragY, e]);
            }
        }

        function start(e) {
            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);

            if (!rightclick && !dragging) {
                if (onstart.apply(element, arguments) !== false) {
                    dragging = true;
                    maxHeight = $(element).height();
                    maxWidth = $(element).width();
                    offset = $(element).offset();

                    $(doc).bind(duringDragEvents);
                    $(doc.body).addClass("sp-dragging");

                    move(e);

                    prevent(e);
                }
            }
        }

        function stop() {
            if (dragging) {
                $(doc).unbind(duringDragEvents);
                $(doc.body).removeClass("sp-dragging");

                // Wait a tick before notifying observers to allow the click event
                // to fire in Chrome.
                setTimeout(function() {
                    onstop.apply(element, arguments);
                }, 0);
            }
            dragging = false;
        }

        $(element).bind("touchstart mousedown", start);
    }

    function throttle(func, wait, debounce) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var throttler = function () {
                timeout = null;
                func.apply(context, args);
            };
            if (debounce) clearTimeout(timeout);
            if (debounce || !timeout) timeout = setTimeout(throttler, wait);
        };
    }

    function inputTypeColorSupport() {
        return $.fn.spectrum.inputTypeColorSupport();
    }

    /**
    * Define a jQuery plugin
    */
    var dataID = "spectrum.id";
    $.fn.spectrum = function (opts, extra) {

        if (typeof opts == "string") {

            var returnValue = this;
            var args = Array.prototype.slice.call( arguments, 1 );

            this.each(function () {
                var spect = spectrums[$(this).data(dataID)];
                if (spect) {
                    var method = spect[opts];
                    if (!method) {
                        throw new Error( "Spectrum: no such method: '" + opts + "'" );
                    }

                    if (opts == "get") {
                        returnValue = spect.get();
                    }
                    else if (opts == "container") {
                        returnValue = spect.container;
                    }
                    else if (opts == "option") {
                        returnValue = spect.option.apply(spect, args);
                    }
                    else if (opts == "destroy") {
                        spect.destroy();
                        $(this).removeData(dataID);
                    }
                    else {
                        method.apply(spect, args);
                    }
                }
            });

            return returnValue;
        }

        // Initializing a new instance of spectrum
        return this.spectrum("destroy").each(function () {
            var options = $.extend({}, opts, $(this).data());
            var spect = spectrum(this, options);
            $(this).data(dataID, spect.id);
        });
    };

    $.fn.spectrum.load = true;
    $.fn.spectrum.loadOpts = {};
    $.fn.spectrum.draggable = draggable;
    $.fn.spectrum.defaults = defaultOpts;
    $.fn.spectrum.inputTypeColorSupport = function inputTypeColorSupport() {
        if (typeof inputTypeColorSupport._cachedResult === "undefined") {
            var colorInput = $("<input type='color'/>")[0]; // if color element is supported, value will default to not null
            inputTypeColorSupport._cachedResult = colorInput.type === "color" && colorInput.value !== "";
        }
        return inputTypeColorSupport._cachedResult;
    };

    $.spectrum = { };
    $.spectrum.localization = { };
    $.spectrum.palettes = { };

    $.fn.spectrum.processNativeColorInputs = function () {
        var colorInputs = $("input[type=color]");
        if (colorInputs.length && !inputTypeColorSupport()) {
            colorInputs.spectrum({
                preferredFormat: "hex6"
            });
        }
    };

    // TinyColor v1.1.2
    // https://github.com/bgrins/TinyColor
    // Brian Grinstead, MIT License

    (function() {

    var trimLeft = /^[\s,#]+/,
        trimRight = /\s+$/,
        tinyCounter = 0,
        math = Math,
        mathRound = math.round,
        mathMin = math.min,
        mathMax = math.max,
        mathRandom = math.random;

    var tinycolor = function(color, opts) {

        color = (color) ? color : '';
        opts = opts || { };

        // If input is already a tinycolor, return itself
        if (color instanceof tinycolor) {
           return color;
        }
        // If we are called as a function, call using new instead
        if (!(this instanceof tinycolor)) {
            return new tinycolor(color, opts);
        }

        var rgb = inputToRGB(color);
        this._originalInput = color,
        this._r = rgb.r,
        this._g = rgb.g,
        this._b = rgb.b,
        this._a = rgb.a,
        this._roundA = mathRound(100*this._a) / 100,
        this._format = opts.format || rgb.format;
        this._gradientType = opts.gradientType;

        // Don't let the range of [0,255] come back in [0,1].
        // Potentially lose a little bit of precision here, but will fix issues where
        // .5 gets interpreted as half of the total, instead of half of 1
        // If it was supposed to be 128, this was already taken care of by `inputToRgb`
        if (this._r < 1) { this._r = mathRound(this._r); }
        if (this._g < 1) { this._g = mathRound(this._g); }
        if (this._b < 1) { this._b = mathRound(this._b); }

        this._ok = rgb.ok;
        this._tc_id = tinyCounter++;
    };

    tinycolor.prototype = {
        isDark: function() {
            return this.getBrightness() < 128;
        },
        isLight: function() {
            return !this.isDark();
        },
        isValid: function() {
            return this._ok;
        },
        getOriginalInput: function() {
          return this._originalInput;
        },
        getFormat: function() {
            return this._format;
        },
        getAlpha: function() {
            return this._a;
        },
        getBrightness: function() {
            var rgb = this.toRgb();
            return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
        },
        setAlpha: function(value) {
            this._a = boundAlpha(value);
            this._roundA = mathRound(100*this._a) / 100;
            return this;
        },
        toHsv: function() {
            var hsv = rgbToHsv(this._r, this._g, this._b);
            return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };
        },
        toHsvString: function() {
            var hsv = rgbToHsv(this._r, this._g, this._b);
            var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);
            return (this._a == 1) ?
              "hsv("  + h + ", " + s + "%, " + v + "%)" :
              "hsva(" + h + ", " + s + "%, " + v + "%, "+ this._roundA + ")";
        },
        toHsl: function() {
            var hsl = rgbToHsl(this._r, this._g, this._b);
            return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };
        },
        toHslString: function() {
            var hsl = rgbToHsl(this._r, this._g, this._b);
            var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);
            return (this._a == 1) ?
              "hsl("  + h + ", " + s + "%, " + l + "%)" :
              "hsla(" + h + ", " + s + "%, " + l + "%, "+ this._roundA + ")";
        },
        toHex: function(allow3Char) {
            return rgbToHex(this._r, this._g, this._b, allow3Char);
        },
        toHexString: function(allow3Char) {
            return '#' + this.toHex(allow3Char);
        },
        toHex8: function() {
            return rgbaToHex(this._r, this._g, this._b, this._a);
        },
        toHex8String: function() {
            return '#' + this.toHex8();
        },
        toRgb: function() {
            return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };
        },
        toRgbString: function() {
            return (this._a == 1) ?
              "rgb("  + mathRound(this._r) + ", " + mathRound(this._g) + ", " + mathRound(this._b) + ")" :
              "rgba(" + mathRound(this._r) + ", " + mathRound(this._g) + ", " + mathRound(this._b) + ", " + this._roundA + ")";
        },
        toPercentageRgb: function() {
            return { r: mathRound(bound01(this._r, 255) * 100) + "%", g: mathRound(bound01(this._g, 255) * 100) + "%", b: mathRound(bound01(this._b, 255) * 100) + "%", a: this._a };
        },
        toPercentageRgbString: function() {
            return (this._a == 1) ?
              "rgb("  + mathRound(bound01(this._r, 255) * 100) + "%, " + mathRound(bound01(this._g, 255) * 100) + "%, " + mathRound(bound01(this._b, 255) * 100) + "%)" :
              "rgba(" + mathRound(bound01(this._r, 255) * 100) + "%, " + mathRound(bound01(this._g, 255) * 100) + "%, " + mathRound(bound01(this._b, 255) * 100) + "%, " + this._roundA + ")";
        },
        toName: function() {
            if (this._a === 0) {
                return "transparent";
            }

            if (this._a < 1) {
                return false;
            }

            return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;
        },
        toFilter: function(secondColor) {
            var hex8String = '#' + rgbaToHex(this._r, this._g, this._b, this._a);
            var secondHex8String = hex8String;
            var gradientType = this._gradientType ? "GradientType = 1, " : "";

            if (secondColor) {
                var s = tinycolor(secondColor);
                secondHex8String = s.toHex8String();
            }

            return "progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")";
        },
        toString: function(format) {
            var formatSet = !!format;
            format = format || this._format;

            var formattedString = false;
            var hasAlpha = this._a < 1 && this._a >= 0;
            var needsAlphaFormat = !formatSet && hasAlpha && (format === "hex" || format === "hex6" || format === "hex3" || format === "name");

            if (needsAlphaFormat) {
                // Special case for "transparent", all other non-alpha formats
                // will return rgba when there is transparency.
                if (format === "name" && this._a === 0) {
                    return this.toName();
                }
                return this.toRgbString();
            }
            if (format === "rgb") {
                formattedString = this.toRgbString();
            }
            if (format === "prgb") {
                formattedString = this.toPercentageRgbString();
            }
            if (format === "hex" || format === "hex6") {
                formattedString = this.toHexString();
            }
            if (format === "hex3") {
                formattedString = this.toHexString(true);
            }
            if (format === "hex8") {
                formattedString = this.toHex8String();
            }
            if (format === "name") {
                formattedString = this.toName();
            }
            if (format === "hsl") {
                formattedString = this.toHslString();
            }
            if (format === "hsv") {
                formattedString = this.toHsvString();
            }

            return formattedString || this.toHexString();
        },

        _applyModification: function(fn, args) {
            var color = fn.apply(null, [this].concat([].slice.call(args)));
            this._r = color._r;
            this._g = color._g;
            this._b = color._b;
            this.setAlpha(color._a);
            return this;
        },
        lighten: function() {
            return this._applyModification(lighten, arguments);
        },
        brighten: function() {
            return this._applyModification(brighten, arguments);
        },
        darken: function() {
            return this._applyModification(darken, arguments);
        },
        desaturate: function() {
            return this._applyModification(desaturate, arguments);
        },
        saturate: function() {
            return this._applyModification(saturate, arguments);
        },
        greyscale: function() {
            return this._applyModification(greyscale, arguments);
        },
        spin: function() {
            return this._applyModification(spin, arguments);
        },

        _applyCombination: function(fn, args) {
            return fn.apply(null, [this].concat([].slice.call(args)));
        },
        analogous: function() {
            return this._applyCombination(analogous, arguments);
        },
        complement: function() {
            return this._applyCombination(complement, arguments);
        },
        monochromatic: function() {
            return this._applyCombination(monochromatic, arguments);
        },
        splitcomplement: function() {
            return this._applyCombination(splitcomplement, arguments);
        },
        triad: function() {
            return this._applyCombination(triad, arguments);
        },
        tetrad: function() {
            return this._applyCombination(tetrad, arguments);
        }
    };

    // If input is an object, force 1 into "1.0" to handle ratios properly
    // String input requires "1.0" as input, so 1 will be treated as 1
    tinycolor.fromRatio = function(color, opts) {
        if (typeof color == "object") {
            var newColor = {};
            for (var i in color) {
                if (color.hasOwnProperty(i)) {
                    if (i === "a") {
                        newColor[i] = color[i];
                    }
                    else {
                        newColor[i] = convertToPercentage(color[i]);
                    }
                }
            }
            color = newColor;
        }

        return tinycolor(color, opts);
    };

    // Given a string or object, convert that input to RGB
    // Possible string inputs:
    //
    //     "red"
    //     "#f00" or "f00"
    //     "#ff0000" or "ff0000"
    //     "#ff000000" or "ff000000"
    //     "rgb 255 0 0" or "rgb (255, 0, 0)"
    //     "rgb 1.0 0 0" or "rgb (1, 0, 0)"
    //     "rgba (255, 0, 0, 1)" or "rgba 255, 0, 0, 1"
    //     "rgba (1.0, 0, 0, 1)" or "rgba 1.0, 0, 0, 1"
    //     "hsl(0, 100%, 50%)" or "hsl 0 100% 50%"
    //     "hsla(0, 100%, 50%, 1)" or "hsla 0 100% 50%, 1"
    //     "hsv(0, 100%, 100%)" or "hsv 0 100% 100%"
    //
    function inputToRGB(color) {

        var rgb = { r: 0, g: 0, b: 0 };
        var a = 1;
        var ok = false;
        var format = false;

        if (typeof color == "string") {
            color = stringInputToObject(color);
        }

        if (typeof color == "object") {
            if (color.hasOwnProperty("r") && color.hasOwnProperty("g") && color.hasOwnProperty("b")) {
                rgb = rgbToRgb(color.r, color.g, color.b);
                ok = true;
                format = String(color.r).substr(-1) === "%" ? "prgb" : "rgb";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("v")) {
                color.s = convertToPercentage(color.s);
                color.v = convertToPercentage(color.v);
                rgb = hsvToRgb(color.h, color.s, color.v);
                ok = true;
                format = "hsv";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("l")) {
                color.s = convertToPercentage(color.s);
                color.l = convertToPercentage(color.l);
                rgb = hslToRgb(color.h, color.s, color.l);
                ok = true;
                format = "hsl";
            }

            if (color.hasOwnProperty("a")) {
                a = color.a;
            }
        }

        a = boundAlpha(a);

        return {
            ok: ok,
            format: color.format || format,
            r: mathMin(255, mathMax(rgb.r, 0)),
            g: mathMin(255, mathMax(rgb.g, 0)),
            b: mathMin(255, mathMax(rgb.b, 0)),
            a: a
        };
    }


    // Conversion Functions
    // --------------------

    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:
    // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>

    // `rgbToRgb`
    // Handle bounds / percentage checking to conform to CSS color spec
    // <http://www.w3.org/TR/css3-color/>
    // *Assumes:* r, g, b in [0, 255] or [0, 1]
    // *Returns:* { r, g, b } in [0, 255]
    function rgbToRgb(r, g, b){
        return {
            r: bound01(r, 255) * 255,
            g: bound01(g, 255) * 255,
            b: bound01(b, 255) * 255
        };
    }

    // `rgbToHsl`
    // Converts an RGB color value to HSL.
    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]
    // *Returns:* { h, s, l } in [0,1]
    function rgbToHsl(r, g, b) {

        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);

        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, l = (max + min) / 2;

        if(max == min) {
            h = s = 0; // achromatic
        }
        else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }

            h /= 6;
        }

        return { h: h, s: s, l: l };
    }

    // `hslToRgb`
    // Converts an HSL color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
    function hslToRgb(h, s, l) {
        var r, g, b;

        h = bound01(h, 360);
        s = bound01(s, 100);
        l = bound01(l, 100);

        function hue2rgb(p, q, t) {
            if(t < 0) t += 1;
            if(t > 1) t -= 1;
            if(t < 1/6) return p + (q - p) * 6 * t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }

        if(s === 0) {
            r = g = b = l; // achromatic
        }
        else {
            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
        }

        return { r: r * 255, g: g * 255, b: b * 255 };
    }

    // `rgbToHsv`
    // Converts an RGB color value to HSV
    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]
    // *Returns:* { h, s, v } in [0,1]
    function rgbToHsv(r, g, b) {

        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);

        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, v = max;

        var d = max - min;
        s = max === 0 ? 0 : d / max;

        if(max == min) {
            h = 0; // achromatic
        }
        else {
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return { h: h, s: s, v: v };
    }

    // `hsvToRgb`
    // Converts an HSV color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
     function hsvToRgb(h, s, v) {

        h = bound01(h, 360) * 6;
        s = bound01(s, 100);
        v = bound01(v, 100);

        var i = math.floor(h),
            f = h - i,
            p = v * (1 - s),
            q = v * (1 - f * s),
            t = v * (1 - (1 - f) * s),
            mod = i % 6,
            r = [v, q, p, p, t, v][mod],
            g = [t, v, v, q, p, p][mod],
            b = [p, p, t, v, v, q][mod];

        return { r: r * 255, g: g * 255, b: b * 255 };
    }

    // `rgbToHex`
    // Converts an RGB color to hex
    // Assumes r, g, and b are contained in the set [0, 255]
    // Returns a 3 or 6 character hex
    function rgbToHex(r, g, b, allow3Char) {

        var hex = [
            pad2(mathRound(r).toString(16)),
            pad2(mathRound(g).toString(16)),
            pad2(mathRound(b).toString(16))
        ];

        // Return a 3 character hex if possible
        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {
            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);
        }

        return hex.join("");
    }
        // `rgbaToHex`
        // Converts an RGBA color plus alpha transparency to hex
        // Assumes r, g, b and a are contained in the set [0, 255]
        // Returns an 8 character hex
        function rgbaToHex(r, g, b, a) {

            var hex = [
                pad2(convertDecimalToHex(a)),
                pad2(mathRound(r).toString(16)),
                pad2(mathRound(g).toString(16)),
                pad2(mathRound(b).toString(16))
            ];

            return hex.join("");
        }

    // `equals`
    // Can be called with any tinycolor input
    tinycolor.equals = function (color1, color2) {
        if (!color1 || !color2) { return false; }
        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();
    };
    tinycolor.random = function() {
        return tinycolor.fromRatio({
            r: mathRandom(),
            g: mathRandom(),
            b: mathRandom()
        });
    };


    // Modification Functions
    // ----------------------
    // Thanks to less.js for some of the basics here
    // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>

    function desaturate(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s -= amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    }

    function saturate(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s += amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    }

    function greyscale(color) {
        return tinycolor(color).desaturate(100);
    }

    function lighten (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l += amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    }

    function brighten(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var rgb = tinycolor(color).toRgb();
        rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));
        rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));
        rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));
        return tinycolor(rgb);
    }

    function darken (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l -= amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    }

    // Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.
    // Values outside of this range will be wrapped into this range.
    function spin(color, amount) {
        var hsl = tinycolor(color).toHsl();
        var hue = (mathRound(hsl.h) + amount) % 360;
        hsl.h = hue < 0 ? 360 + hue : hue;
        return tinycolor(hsl);
    }

    // Combination Functions
    // ---------------------
    // Thanks to jQuery xColor for some of the ideas behind these
    // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>

    function complement(color) {
        var hsl = tinycolor(color).toHsl();
        hsl.h = (hsl.h + 180) % 360;
        return tinycolor(hsl);
    }

    function triad(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })
        ];
    }

    function tetrad(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })
        ];
    }

    function splitcomplement(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),
            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})
        ];
    }

    function analogous(color, results, slices) {
        results = results || 6;
        slices = slices || 30;

        var hsl = tinycolor(color).toHsl();
        var part = 360 / slices;
        var ret = [tinycolor(color)];

        for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {
            hsl.h = (hsl.h + part) % 360;
            ret.push(tinycolor(hsl));
        }
        return ret;
    }

    function monochromatic(color, results) {
        results = results || 6;
        var hsv = tinycolor(color).toHsv();
        var h = hsv.h, s = hsv.s, v = hsv.v;
        var ret = [];
        var modification = 1 / results;

        while (results--) {
            ret.push(tinycolor({ h: h, s: s, v: v}));
            v = (v + modification) % 1;
        }

        return ret;
    }

    // Utility Functions
    // ---------------------

    tinycolor.mix = function(color1, color2, amount) {
        amount = (amount === 0) ? 0 : (amount || 50);

        var rgb1 = tinycolor(color1).toRgb();
        var rgb2 = tinycolor(color2).toRgb();

        var p = amount / 100;
        var w = p * 2 - 1;
        var a = rgb2.a - rgb1.a;

        var w1;

        if (w * a == -1) {
            w1 = w;
        } else {
            w1 = (w + a) / (1 + w * a);
        }

        w1 = (w1 + 1) / 2;

        var w2 = 1 - w1;

        var rgba = {
            r: rgb2.r * w1 + rgb1.r * w2,
            g: rgb2.g * w1 + rgb1.g * w2,
            b: rgb2.b * w1 + rgb1.b * w2,
            a: rgb2.a * p  + rgb1.a * (1 - p)
        };

        return tinycolor(rgba);
    };


    // Readability Functions
    // ---------------------
    // <http://www.w3.org/TR/AERT#color-contrast>

    // `readability`
    // Analyze the 2 colors and returns an object with the following properties:
    //    `brightness`: difference in brightness between the two colors
    //    `color`: difference in color/hue between the two colors
    tinycolor.readability = function(color1, color2) {
        var c1 = tinycolor(color1);
        var c2 = tinycolor(color2);
        var rgb1 = c1.toRgb();
        var rgb2 = c2.toRgb();
        var brightnessA = c1.getBrightness();
        var brightnessB = c2.getBrightness();
        var colorDiff = (
            Math.max(rgb1.r, rgb2.r) - Math.min(rgb1.r, rgb2.r) +
            Math.max(rgb1.g, rgb2.g) - Math.min(rgb1.g, rgb2.g) +
            Math.max(rgb1.b, rgb2.b) - Math.min(rgb1.b, rgb2.b)
        );

        return {
            brightness: Math.abs(brightnessA - brightnessB),
            color: colorDiff
        };
    };

    // `readable`
    // http://www.w3.org/TR/AERT#color-contrast
    // Ensure that foreground and background color combinations provide sufficient contrast.
    // *Example*
    //    tinycolor.isReadable("#000", "#111") => false
    tinycolor.isReadable = function(color1, color2) {
        var readability = tinycolor.readability(color1, color2);
        return readability.brightness > 125 && readability.color > 500;
    };

    // `mostReadable`
    // Given a base color and a list of possible foreground or background
    // colors for that base, returns the most readable color.
    // *Example*
    //    tinycolor.mostReadable("#123", ["#fff", "#000"]) => "#000"
    tinycolor.mostReadable = function(baseColor, colorList) {
        var bestColor = null;
        var bestScore = 0;
        var bestIsReadable = false;
        for (var i=0; i < colorList.length; i++) {

            // We normalize both around the "acceptable" breaking point,
            // but rank brightness constrast higher than hue.

            var readability = tinycolor.readability(baseColor, colorList[i]);
            var readable = readability.brightness > 125 && readability.color > 500;
            var score = 3 * (readability.brightness / 125) + (readability.color / 500);

            if ((readable && ! bestIsReadable) ||
                (readable && bestIsReadable && score > bestScore) ||
                ((! readable) && (! bestIsReadable) && score > bestScore)) {
                bestIsReadable = readable;
                bestScore = score;
                bestColor = tinycolor(colorList[i]);
            }
        }
        return bestColor;
    };


    // Big List of Colors
    // ------------------
    // <http://www.w3.org/TR/css3-color/#svg-color>
    var names = tinycolor.names = {
        aliceblue: "f0f8ff",
        antiquewhite: "faebd7",
        aqua: "0ff",
        aquamarine: "7fffd4",
        azure: "f0ffff",
        beige: "f5f5dc",
        bisque: "ffe4c4",
        black: "000",
        blanchedalmond: "ffebcd",
        blue: "00f",
        blueviolet: "8a2be2",
        brown: "a52a2a",
        burlywood: "deb887",
        burntsienna: "ea7e5d",
        cadetblue: "5f9ea0",
        chartreuse: "7fff00",
        chocolate: "d2691e",
        coral: "ff7f50",
        cornflowerblue: "6495ed",
        cornsilk: "fff8dc",
        crimson: "dc143c",
        cyan: "0ff",
        darkblue: "00008b",
        darkcyan: "008b8b",
        darkgoldenrod: "b8860b",
        darkgray: "a9a9a9",
        darkgreen: "006400",
        darkgrey: "a9a9a9",
        darkkhaki: "bdb76b",
        darkmagenta: "8b008b",
        darkolivegreen: "556b2f",
        darkorange: "ff8c00",
        darkorchid: "9932cc",
        darkred: "8b0000",
        darksalmon: "e9967a",
        darkseagreen: "8fbc8f",
        darkslateblue: "483d8b",
        darkslategray: "2f4f4f",
        darkslategrey: "2f4f4f",
        darkturquoise: "00ced1",
        darkviolet: "9400d3",
        deeppink: "ff1493",
        deepskyblue: "00bfff",
        dimgray: "696969",
        dimgrey: "696969",
        dodgerblue: "1e90ff",
        firebrick: "b22222",
        floralwhite: "fffaf0",
        forestgreen: "228b22",
        fuchsia: "f0f",
        gainsboro: "dcdcdc",
        ghostwhite: "f8f8ff",
        gold: "ffd700",
        goldenrod: "daa520",
        gray: "808080",
        green: "008000",
        greenyellow: "adff2f",
        grey: "808080",
        honeydew: "f0fff0",
        hotpink: "ff69b4",
        indianred: "cd5c5c",
        indigo: "4b0082",
        ivory: "fffff0",
        khaki: "f0e68c",
        lavender: "e6e6fa",
        lavenderblush: "fff0f5",
        lawngreen: "7cfc00",
        lemonchiffon: "fffacd",
        lightblue: "add8e6",
        lightcoral: "f08080",
        lightcyan: "e0ffff",
        lightgoldenrodyellow: "fafad2",
        lightgray: "d3d3d3",
        lightgreen: "90ee90",
        lightgrey: "d3d3d3",
        lightpink: "ffb6c1",
        lightsalmon: "ffa07a",
        lightseagreen: "20b2aa",
        lightskyblue: "87cefa",
        lightslategray: "789",
        lightslategrey: "789",
        lightsteelblue: "b0c4de",
        lightyellow: "ffffe0",
        lime: "0f0",
        limegreen: "32cd32",
        linen: "faf0e6",
        magenta: "f0f",
        maroon: "800000",
        mediumaquamarine: "66cdaa",
        mediumblue: "0000cd",
        mediumorchid: "ba55d3",
        mediumpurple: "9370db",
        mediumseagreen: "3cb371",
        mediumslateblue: "7b68ee",
        mediumspringgreen: "00fa9a",
        mediumturquoise: "48d1cc",
        mediumvioletred: "c71585",
        midnightblue: "191970",
        mintcream: "f5fffa",
        mistyrose: "ffe4e1",
        moccasin: "ffe4b5",
        navajowhite: "ffdead",
        navy: "000080",
        oldlace: "fdf5e6",
        olive: "808000",
        olivedrab: "6b8e23",
        orange: "ffa500",
        orangered: "ff4500",
        orchid: "da70d6",
        palegoldenrod: "eee8aa",
        palegreen: "98fb98",
        paleturquoise: "afeeee",
        palevioletred: "db7093",
        papayawhip: "ffefd5",
        peachpuff: "ffdab9",
        peru: "cd853f",
        pink: "ffc0cb",
        plum: "dda0dd",
        powderblue: "b0e0e6",
        purple: "800080",
        rebeccapurple: "663399",
        red: "f00",
        rosybrown: "bc8f8f",
        royalblue: "4169e1",
        saddlebrown: "8b4513",
        salmon: "fa8072",
        sandybrown: "f4a460",
        seagreen: "2e8b57",
        seashell: "fff5ee",
        sienna: "a0522d",
        silver: "c0c0c0",
        skyblue: "87ceeb",
        slateblue: "6a5acd",
        slategray: "708090",
        slategrey: "708090",
        snow: "fffafa",
        springgreen: "00ff7f",
        steelblue: "4682b4",
        tan: "d2b48c",
        teal: "008080",
        thistle: "d8bfd8",
        tomato: "ff6347",
        turquoise: "40e0d0",
        violet: "ee82ee",
        wheat: "f5deb3",
        white: "fff",
        whitesmoke: "f5f5f5",
        yellow: "ff0",
        yellowgreen: "9acd32"
    };

    // Make it easy to access colors via `hexNames[hex]`
    var hexNames = tinycolor.hexNames = flip(names);


    // Utilities
    // ---------

    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`
    function flip(o) {
        var flipped = { };
        for (var i in o) {
            if (o.hasOwnProperty(i)) {
                flipped[o[i]] = i;
            }
        }
        return flipped;
    }

    // Return a valid alpha value [0,1] with all invalid values being set to 1
    function boundAlpha(a) {
        a = parseFloat(a);

        if (isNaN(a) || a < 0 || a > 1) {
            a = 1;
        }

        return a;
    }

    // Take input from [0, n] and return it as [0, 1]
    function bound01(n, max) {
        if (isOnePointZero(n)) { n = "100%"; }

        var processPercent = isPercentage(n);
        n = mathMin(max, mathMax(0, parseFloat(n)));

        // Automatically convert percentage into number
        if (processPercent) {
            n = parseInt(n * max, 10) / 100;
        }

        // Handle floating point rounding errors
        if ((math.abs(n - max) < 0.000001)) {
            return 1;
        }

        // Convert into [0, 1] range if it isn't already
        return (n % max) / parseFloat(max);
    }

    // Force a number between 0 and 1
    function clamp01(val) {
        return mathMin(1, mathMax(0, val));
    }

    // Parse a base-16 hex value into a base-10 integer
    function parseIntFromHex(val) {
        return parseInt(val, 16);
    }

    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1
    // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>
    function isOnePointZero(n) {
        return typeof n == "string" && n.indexOf('.') != -1 && parseFloat(n) === 1;
    }

    // Check to see if string passed in is a percentage
    function isPercentage(n) {
        return typeof n === "string" && n.indexOf('%') != -1;
    }

    // Force a hex value to have 2 characters
    function pad2(c) {
        return c.length == 1 ? '0' + c : '' + c;
    }

    // Replace a decimal with it's percentage value
    function convertToPercentage(n) {
        if (n <= 1) {
            n = (n * 100) + "%";
        }

        return n;
    }

    // Converts a decimal to a hex value
    function convertDecimalToHex(d) {
        return Math.round(parseFloat(d) * 255).toString(16);
    }
    // Converts a hex value to a decimal
    function convertHexToDecimal(h) {
        return (parseIntFromHex(h) / 255);
    }

    var matchers = (function() {

        // <http://www.w3.org/TR/css3-values/#integers>
        var CSS_INTEGER = "[-\\+]?\\d+%?";

        // <http://www.w3.org/TR/css3-values/#number-value>
        var CSS_NUMBER = "[-\\+]?\\d*\\.\\d+%?";

        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.
        var CSS_UNIT = "(?:" + CSS_NUMBER + ")|(?:" + CSS_INTEGER + ")";

        // Actual matching.
        // Parentheses and commas are optional, but not required.
        // Whitespace can take the place of commas or opening paren
        var PERMISSIVE_MATCH3 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";
        var PERMISSIVE_MATCH4 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";

        return {
            rgb: new RegExp("rgb" + PERMISSIVE_MATCH3),
            rgba: new RegExp("rgba" + PERMISSIVE_MATCH4),
            hsl: new RegExp("hsl" + PERMISSIVE_MATCH3),
            hsla: new RegExp("hsla" + PERMISSIVE_MATCH4),
            hsv: new RegExp("hsv" + PERMISSIVE_MATCH3),
            hsva: new RegExp("hsva" + PERMISSIVE_MATCH4),
            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/
        };
    })();

    // `stringInputToObject`
    // Permissive string parsing.  Take in a number of formats, and output an object
    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`
    function stringInputToObject(color) {

        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();
        var named = false;
        if (names[color]) {
            color = names[color];
            named = true;
        }
        else if (color == 'transparent') {
            return { r: 0, g: 0, b: 0, a: 0, format: "name" };
        }

        // Try to match string input using regular expressions.
        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]
        // Just return an object and let the conversion functions handle that.
        // This way the result will be the same whether the tinycolor is initialized with string or object.
        var match;
        if ((match = matchers.rgb.exec(color))) {
            return { r: match[1], g: match[2], b: match[3] };
        }
        if ((match = matchers.rgba.exec(color))) {
            return { r: match[1], g: match[2], b: match[3], a: match[4] };
        }
        if ((match = matchers.hsl.exec(color))) {
            return { h: match[1], s: match[2], l: match[3] };
        }
        if ((match = matchers.hsla.exec(color))) {
            return { h: match[1], s: match[2], l: match[3], a: match[4] };
        }
        if ((match = matchers.hsv.exec(color))) {
            return { h: match[1], s: match[2], v: match[3] };
        }
        if ((match = matchers.hsva.exec(color))) {
            return { h: match[1], s: match[2], v: match[3], a: match[4] };
        }
        if ((match = matchers.hex8.exec(color))) {
            return {
                a: convertHexToDecimal(match[1]),
                r: parseIntFromHex(match[2]),
                g: parseIntFromHex(match[3]),
                b: parseIntFromHex(match[4]),
                format: named ? "name" : "hex8"
            };
        }
        if ((match = matchers.hex6.exec(color))) {
            return {
                r: parseIntFromHex(match[1]),
                g: parseIntFromHex(match[2]),
                b: parseIntFromHex(match[3]),
                format: named ? "name" : "hex"
            };
        }
        if ((match = matchers.hex3.exec(color))) {
            return {
                r: parseIntFromHex(match[1] + '' + match[1]),
                g: parseIntFromHex(match[2] + '' + match[2]),
                b: parseIntFromHex(match[3] + '' + match[3]),
                format: named ? "name" : "hex"
            };
        }

        return false;
    }

    window.tinycolor = tinycolor;
    })();

    $(function () {
        if ($.fn.spectrum.load) {
            $.fn.spectrum.processNativeColorInputs();
        }
    });

});


define('lib-build/css!lib/spectrum/spectrum',[],function(){});

define('lib-build/less!storymaps-react/common/builder/ColorPicker',[],function(){});
define('storymaps-react/common/builder/ColorPicker',['module', 'exports', 'lib/spectrum/spectrum', 'lib-build/css!lib/spectrum/spectrum', 'lib-build/less!./ColorPicker'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var ColorPicker = function () {
    function ColorPicker() {
      _classCallCheck(this, ColorPicker);
    }

    _createClass(ColorPicker, null, [{
      key: 'initPicker',
      value: function initPicker(options) {
        $(options.element).spectrum({
          allowEmpty: false,
          color: options.color || '#000',
          showInput: true,
          showAlpha: options.showAlpha || false,
          showPalette: options.palette ? true : false,
          showInitial: false,
          // TODO: track colors across the story and feed them to all color pickers
          showSelectionPalette: false,
          hideAfterPaletteSelect: false,
          preferredFormat: 'hex3',
          change: options.onChangeCallback || function () {},
          move: options.onMoveCallback || function () {},
          palette: options.palette || null,
          beforeShow: options.beforeShowCallback || function () {},
          appendTo: options.appendTo || 'body'
        });
      }
    }]);

    return ColorPicker;
  }();

  exports.default = ColorPicker;
  module.exports = exports['default'];
});
//# sourceMappingURL=ColorPicker.js.map
;
/*!
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 * License
 * -------
 * Copyright 2011, 2015 Lokesh Dhakar
 * Released under the MIT license
 * https://raw.githubusercontent.com/lokesh/color-thief/master/LICENSE
 *
 */
var CanvasImage=function(a){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=a.width,this.height=this.canvas.height=a.height,this.context.drawImage(a,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(a){this.context.putImageData(a,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};/*!
 * quantize.js Copyright 2008 Nick Rabinowitz.
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * Block below copied from Protovis: http://mbostock.github.com/protovis/
 * Copyright 2010 Stanford Visualization Group
 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
 */
if(ColorThief.prototype.getColor=function(a,b){var c=this.getPalette(a,5,b),d=c[0];return d},ColorThief.prototype.getPalette=function(a,b,c){"undefined"==typeof b&&(b=10),("undefined"==typeof c||1>c)&&(c=10);for(var d,e,f,g,h,i=new CanvasImage(a),j=i.getImageData(),k=j.data,l=i.getPixelCount(),m=[],n=0;l>n;n+=c)d=4*n,e=k[d+0],f=k[d+1],g=k[d+2],h=k[d+3],h>=125&&(e>250&&f>250&&g>250||m.push([e,f,g]));var o=MMCQ.quantize(m,b),p=o?o.palette():null;return i.removeCanvas(),p},!pv)var pv={map:function(a,b){var c={};return b?a.map(function(a,d){return c.index=d,b.call(c,a)}):a.slice()},naturalOrder:function(a,b){return b>a?-1:a>b?1:0},sum:function(a,b){var c={};return a.reduce(b?function(a,d,e){return c.index=e,a+b.call(c,d)}:function(a,b){return a+b},0)},max:function(a,b){return Math.max.apply(null,b?pv.map(a,b):a)}};var MMCQ=function(){function a(a,b,c){return(a<<2*i)+(b<<i)+c}function b(a){function b(){c.sort(a),d=!0}var c=[],d=!1;return{push:function(a){c.push(a),d=!1},peek:function(a){return d||b(),void 0===a&&(a=c.length-1),c[a]},pop:function(){return d||b(),c.pop()},size:function(){return c.length},map:function(a){return c.map(a)},debug:function(){return d||b(),c}}}function c(a,b,c,d,e,f,g){var h=this;h.r1=a,h.r2=b,h.g1=c,h.g2=d,h.b1=e,h.b2=f,h.histo=g}function d(){this.vboxes=new b(function(a,b){return pv.naturalOrder(a.vbox.count()*a.vbox.volume(),b.vbox.count()*b.vbox.volume())})}function e(b){var c,d,e,f,g=1<<3*i,h=new Array(g);return b.forEach(function(b){d=b[0]>>j,e=b[1]>>j,f=b[2]>>j,c=a(d,e,f),h[c]=(h[c]||0)+1}),h}function f(a,b){var d,e,f,g=1e6,h=0,i=1e6,k=0,l=1e6,m=0;return a.forEach(function(a){d=a[0]>>j,e=a[1]>>j,f=a[2]>>j,g>d?g=d:d>h&&(h=d),i>e?i=e:e>k&&(k=e),l>f?l=f:f>m&&(m=f)}),new c(g,h,i,k,l,m,b)}function g(b,c){function d(a){var b,d,e,f,g,h=a+"1",j=a+"2",k=0;for(i=c[h];i<=c[j];i++)if(o[i]>n/2){for(e=c.copy(),f=c.copy(),b=i-c[h],d=c[j]-i,g=d>=b?Math.min(c[j]-1,~~(i+d/2)):Math.max(c[h],~~(i-1-b/2));!o[g];)g++;for(k=p[g];!k&&o[g-1];)k=p[--g];return e[j]=g,f[h]=e[j]+1,[e,f]}}if(c.count()){var e=c.r2-c.r1+1,f=c.g2-c.g1+1,g=c.b2-c.b1+1,h=pv.max([e,f,g]);if(1==c.count())return[c.copy()];var i,j,k,l,m,n=0,o=[],p=[];if(h==e)for(i=c.r1;i<=c.r2;i++){for(l=0,j=c.g1;j<=c.g2;j++)for(k=c.b1;k<=c.b2;k++)m=a(i,j,k),l+=b[m]||0;n+=l,o[i]=n}else if(h==f)for(i=c.g1;i<=c.g2;i++){for(l=0,j=c.r1;j<=c.r2;j++)for(k=c.b1;k<=c.b2;k++)m=a(j,i,k),l+=b[m]||0;n+=l,o[i]=n}else for(i=c.b1;i<=c.b2;i++){for(l=0,j=c.r1;j<=c.r2;j++)for(k=c.g1;k<=c.g2;k++)m=a(j,k,i),l+=b[m]||0;n+=l,o[i]=n}return o.forEach(function(a,b){p[b]=n-a}),d(h==e?"r":h==f?"g":"b")}}function h(a,c){function h(a,b){for(var c,d=1,e=0;k>e;)if(c=a.pop(),c.count()){var f=g(i,c),h=f[0],j=f[1];if(!h)return;if(a.push(h),j&&(a.push(j),d++),d>=b)return;if(e++>k)return}else a.push(c),e++}if(!a.length||2>c||c>256)return!1;var i=e(a),j=0;i.forEach(function(){j++});var m=f(a,i),n=new b(function(a,b){return pv.naturalOrder(a.count(),b.count())});n.push(m),h(n,l*c);for(var o=new b(function(a,b){return pv.naturalOrder(a.count()*a.volume(),b.count()*b.volume())});n.size();)o.push(n.pop());h(o,c-o.size());for(var p=new d;o.size();)p.push(o.pop());return p}var i=5,j=8-i,k=1e3,l=.75;return c.prototype={volume:function(a){var b=this;return(!b._volume||a)&&(b._volume=(b.r2-b.r1+1)*(b.g2-b.g1+1)*(b.b2-b.b1+1)),b._volume},count:function(b){var c=this,d=c.histo;if(!c._count_set||b){var e,f,g,h=0;for(e=c.r1;e<=c.r2;e++)for(f=c.g1;f<=c.g2;f++)for(g=c.b1;g<=c.b2;g++)index=a(e,f,g),h+=d[index]||0;c._count=h,c._count_set=!0}return c._count},copy:function(){var a=this;return new c(a.r1,a.r2,a.g1,a.g2,a.b1,a.b2,a.histo)},avg:function(b){var c=this,d=c.histo;if(!c._avg||b){var e,f,g,h,j,k=0,l=1<<8-i,m=0,n=0,o=0;for(f=c.r1;f<=c.r2;f++)for(g=c.g1;g<=c.g2;g++)for(h=c.b1;h<=c.b2;h++)j=a(f,g,h),e=d[j]||0,k+=e,m+=e*(f+.5)*l,n+=e*(g+.5)*l,o+=e*(h+.5)*l;k?c._avg=[~~(m/k),~~(n/k),~~(o/k)]:c._avg=[~~(l*(c.r1+c.r2+1)/2),~~(l*(c.g1+c.g2+1)/2),~~(l*(c.b1+c.b2+1)/2)]}return c._avg},contains:function(a){var b=this,c=a[0]>>j;return gval=a[1]>>j,bval=a[2]>>j,c>=b.r1&&c<=b.r2&&gval>=b.g1&&gval<=b.g2&&bval>=b.b1&&bval<=b.b2}},d.prototype={push:function(a){this.vboxes.push({vbox:a,color:a.avg()})},palette:function(){return this.vboxes.map(function(a){return a.color})},size:function(){return this.vboxes.size()},map:function(a){for(var b=this.vboxes,c=0;c<b.size();c++)if(b.peek(c).vbox.contains(a))return b.peek(c).color;return this.nearest(a)},nearest:function(a){for(var b,c,d,e=this.vboxes,f=0;f<e.size();f++)c=Math.sqrt(Math.pow(a[0]-e.peek(f).color[0],2)+Math.pow(a[1]-e.peek(f).color[1],2)+Math.pow(a[2]-e.peek(f).color[2],2)),(b>c||void 0===b)&&(b=c,d=e.peek(f).color);return d},forcebw:function(){var a=this.vboxes;a.sort(function(a,b){return pv.naturalOrder(pv.sum(a.color),pv.sum(b.color))});var b=a[0].color;b[0]<5&&b[1]<5&&b[2]<5&&(a[0].color=[0,0,0]);var c=a.length-1,d=a[c].color;d[0]>251&&d[1]>251&&d[2]>251&&(a[c].color=[255,255,255])}},{quantize:h}}();
define("lib/color-thief/dist/color-thief.min", function(){});

/*
Functions adapted from Color Thief
Color Thief:
https://github.com/lokesh/color-thief
Copyright (c) 2015 Lokesh Dhakar, released under the MIT license
*/
/*
Steven Kitterman note (8-2016)
Modified the following code:

-----------------
| GET PALETTE  |
----------------
if (!imageData) {
  return null;
}

LATER DOWN...
if (!(r > 250 && g > 250 && b > 250)) -> if (!(r > 255 && g > 255 && b > 255))

------------------
| GET IMAGE DATA |
------------------
wrapped getImageData in a try-catch and return null if there's an error caught.
This is because IE will load a non-CORS image even with crossOrigin="anonymous" set, so we need to try-catch in color-thief when it tries to read from the canvas.
*/

/* eslint-disable */
ColorThief.prototype.getPalette = function(sourceImage, colorCount, quality) {

  if (typeof colorCount === 'undefined') {
    colorCount = 10;
  }
  if (typeof quality === 'undefined' || quality < 1) {
    quality = 10;
  }

  // Create custom CanvasImage object
  var image      = new CanvasImage(sourceImage);
  var imageData  = image.getImageData();

  if (!imageData) {
    return null;
  }

  var pixels     = imageData.data;
  var pixelCount = image.getPixelCount();

  // Store the RGB values in an array format suitable for quantize function
  var pixelArray = [];
  for (var i = 0, offset, r, g, b, a; i < pixelCount; i = i + quality) {
    offset = i * 4;
    r = pixels[offset + 0];
    g = pixels[offset + 1];
    b = pixels[offset + 2];
    a = pixels[offset + 3];

    // If pixel is mostly opaque and not white
    if (a >= 125) {
      if (!(r > 255 && g > 255 && b > 255)) {
        pixelArray.push([r, g, b]);
      }
    }
  }

  // Send array to quantize function which clusters values
  // using median cut algorithm
  var cmap    = MMCQ.quantize(pixelArray, colorCount);
  var palette = cmap? cmap.palette() : null;

  // Clean up
  image.removeCanvas();

  return palette;
};


CanvasImage.prototype.getImageData = function () {
  var data = null;
  try {
    data = this.context.getImageData(0, 0, this.width, this.height);
  }

  catch(e) {
    data = null;
  }

  return data;
};

define("storymaps/common/utils/ColorThiefOverrides", function(){});

define('storymaps-react/tpl/view/media/builder/TabBackground',['module', 'exports', './Tab', './../Media', 'lib-build/hbars!./TabBackground', 'storymaps-react/common/builder/ColorPicker', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'lib-build/less!./Common', 'lib/color-thief/dist/color-thief.min', 'storymaps/common/utils/ColorThiefOverrides'], function (module, exports, _Tab2, _Media, _TabBackground, _ColorPicker, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _Media2 = _interopRequireDefault(_Media);

  var _TabBackground2 = _interopRequireDefault(_TabBackground);

  var _ColorPicker2 = _interopRequireDefault(_ColorPicker);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabBackground = function (_Tab) {
    _inherits(TabBackground, _Tab);

    function TabBackground(params) {
      _classCallCheck(this, TabBackground);

      var _this = _possibleConstructorReturn(this, (TabBackground.__proto__ || Object.getPrototypeOf(TabBackground)).call(this, params));

      _this.title = _app2.default.builder.mediaConfig.tabs.background;
      _this.type = 'background';
      _this.icon = 'fa-arrows-alt';
      _this.placement = null;
      _this.focusDot = null;
      _this.previewThumbnail = null;
      _this.checkbox = null;
      _this.responsivePreview = null;
      _this.colorPickerTrigger = null;
      _this.colorPickerThumbnail = null;
      _this.sectionType = params.sectionType;
      _this.imageUrl = '';
      _this.colors = null;
      return _this;
    }

    _createClass(TabBackground, [{
      key: 'render',
      value: function render() {
        return (0, _TabBackground2.default)({
          isTitle: this.sectionType === 'title',
          isImmersive: this.sectionType === 'immersive',
          strings: _app2.default.builder.mediaConfig.background
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(TabBackground.prototype.__proto__ || Object.getPrototypeOf(TabBackground.prototype), 'postCreate', this).call(this, params);

        this.imageUrl = params.media.url ? _Media2.default.addToken(params.media.url) : '';

        this.placement = params.media.options.placement || {
          type: 'fill',
          fit: {
            color: ''
          },
          fill: {
            x: .5,
            y: .5
          }
        };
        // we delete the un-selected property when we close the tab. We'll want both while here, however.
        if (!this.placement.fit) {
          this.placement.fit = {
            color: ''
          };
        }
        if (!this.placement.fill) {
          this.placement.fill = {
            x: .5,
            y: .5
          };
        }
        this.setConfig('placement', this.placement);

        this.focusDot = this._node.find('.overview-dot');
        this.previewThumbnail = this._node.find('.overview-thumbnail');
        this.checkbox = this._node.find('input.fit-fill');
        this.responsivePreview = this._node.find('.responsive-preview');
        this.colorPickerTrigger = this._node.find('.color-picker-icons');
        this.colorPickerThumbnail = this._node.find('.fit-color-picker-color');

        this._applyInitialUI();

        this._node.find('[data-toggle="tooltip"]').tooltip();
        this._node.closest('.config-content').addClass('placement-config');

        this._initColorPicker();

        this.addEvents();
      }
    }, {
      key: '_applyInitialUI',
      value: function _applyInitialUI() {
        var hiddenClass = 'content-hidden';

        this.responsivePreview.css('background-image', 'url(\'' + this.imageUrl + '\')');

        this.previewThumbnail.attr('src', this.imageUrl);
        this.focusDot.css('left', this.placement.fill.x * 100 + '%');
        this.focusDot.css('top', this.placement.fill.y * 100 + '%');

        this._getColorPalette();

        if (this.placement.type === 'fill') {
          this.checkbox.prop('checked', false);
          this._node.find('.section-content[data-mode="fit"]').addClass(hiddenClass);
          this._node.find('.section-content[data-mode="fill"]').removeClass(hiddenClass);
        } else {
          this.checkbox.prop('checked', true);
          this._node.find('.section-content[data-mode="fill"]').addClass(hiddenClass);
          this._node.find('.section-content[data-mode="fit"]').removeClass(hiddenClass);
        }

        this._applyResponsivePreview();
      }
    }, {
      key: '_showFitLoading',
      value: function _showFitLoading() {
        this._node.find('.content-pane.fit-content').hide();
        this._node.find('.content-pane.fit-loading').show();
      }
    }, {
      key: '_hideFitLoading',
      value: function _hideFitLoading() {
        this._node.find('.content-pane.fit-loading').hide();
        this._node.find('.content-pane.fit-content').show();
      }
    }, {
      key: '_getColorPalette',
      value: function _getColorPalette() {
        var _this2 = this;

        // if we already have the colors, no need to get them again...
        if (this.colors) {
          return;
        }
        this._showFitLoading();

        // we load an image so we can pass it to the colorthief to get the color palette
        var image = new Image();

        image.onload = function () {
          _this2._onImageLoaded(image);
        };
        image.onerror = this._onImageError.bind(this);

        image.crossOrigin = 'anonymous';
        image.src = this.imageUrl;
      }
    }, {
      key: '_onImageLoaded',
      value: function _onImageLoaded(image) {
        // numcolors is the amount of colors to have in our palette. For some reason it is one off...
        // quality ranges from 1-10. 1 is best (looks at every pixel), 10 is worst (looks at every 10th pixel) but is fastest
        var NUM_COLORS = 10;
        var QUALITY = 10;
        var colorThief = new window.ColorThief();

        this.colors = colorThief.getPalette(image, NUM_COLORS, QUALITY);

        if (!this.colors) {
          this._onImageError();
          return;
        }

        this._hideFitLoading();

        this._renderPalette(this._node.find('.fit-palette'));
        this._addPaletteEvents();

        // apply the first color in the palette.
        if (!this.placement.fit.color) {
          var firstPaletteColor = this._node.find('.fit-palette-item:first-child');
          this._applyColor(firstPaletteColor.css('background-color'));
          firstPaletteColor.addClass('palette-selected');
        }
      }
    }, {
      key: '_onImageError',
      value: function _onImageError() {
        // only show the color picker in this case, not the palette.
        this._node.find('.fit-color-picker').removeClass('not-alone');
        // show a default color
        this._applyColorPickerColor('rgb(0,0,0)');
        this._hideFitLoading();
      }
    }, {
      key: '_initColorPicker',
      value: function _initColorPicker() {
        _ColorPicker2.default.initPicker({
          element: this.colorPickerTrigger,
          color: this.placement.fit.color,
          appendTo: this._node.find('.fit-color-picker'),
          onChangeCallback: function (results) {
            var colorString = results.toRgbString();

            this._applyColorPickerColor(colorString);
          }.bind(this),
          onMoveCallback: function (results) {
            var colorString = results.toRgbString();

            this._applyColorPickerColor(colorString);
          }.bind(this)
        });

        this.colorPickerThumbnail.css('background-color', this.placement.fit.color);
      }
    }, {
      key: '_applyColorPickerColor',
      value: function _applyColorPickerColor(colorString) {
        this._applyColor(colorString);

        this.colorPickerThumbnail.css('background-color', colorString);
        this.colorPickerThumbnail.css('visibility', 'visible');
      }
    }, {
      key: '_renderPalette',
      value: function _renderPalette(container) {
        var storedColor = '';

        if (this.placement.fit && this.placement.fit.color) {
          storedColor = this.placement.fit.color.replace(/ |;/g, '');
        }

        for (var i = 0; i < this.colors.length; i++) {
          var color = this.colors[i];
          var extraClass = '';
          var colorString = 'rgb(' + color.join(',') + ')';

          // if the currently-selected color is in the palette, show that palette item selected and the color picker chosen color deselected.
          if (colorString === storedColor) {
            extraClass = 'palette-selected';

            this.colorPickerThumbnail.css('visibility', 'hidden');
          }

          container.append('<li class="fit-palette-item ' + extraClass + '" style="background-color:' + colorString + ';"></li>');
        }
      }
    }, {
      key: '_addPaletteEvents',
      value: function _addPaletteEvents() {
        var _this3 = this;

        var paletteItems = this._node.find('.fit-palette-item');
        paletteItems.on('click', function (event) {
          // grab the color found here.
          var color = $(event.currentTarget).css('background-color');
          _this3._applyColor(color);
          $(event.currentTarget).addClass('palette-selected');
        });
      }
    }, {
      key: '_applyColor',
      value: function _applyColor(color) {
        var paletteItems = this._node.find('.fit-palette-item');
        paletteItems.removeClass('palette-selected');
        this.colorPickerThumbnail.css('visibility', 'hidden');

        this.colorPickerTrigger.spectrum('set', color);

        this.placement.fit = {
          color: color
        };

        this.setConfig('placement', this.placement);
        this._applyResponsivePreview();
      }
    }, {
      key: 'addEvents',
      value: function addEvents() {
        var _this4 = this;

        var thumbnailContainer = this._node.find('.overview-thumbnail-pane');

        this.checkbox.on('click', function () {
          _this4._onCheckboxClicked();
        });

        this.previewThumbnail.on('click', function (event) {
          _this4._onThumbnailClicked(event);
        });

        this.focusDot.on('mousedown', function () {
          thumbnailContainer.on('mousemove', function (event) {
            _this4._onDotDragged(event);
          });
        });

        thumbnailContainer.on('mouseup mouseleave', function () {
          thumbnailContainer.off('mousemove');
        });
      }
    }, {
      key: '_onCheckboxClicked',
      value: function _onCheckboxClicked() {
        var hiddenClass = 'content-hidden';

        if (this.placement.type === 'fill') {
          this._node.find('.section-content[data-mode="fill"]').addClass(hiddenClass);
          this._node.find('.section-content[data-mode="fit"]').removeClass(hiddenClass);
          this.placement.type = 'fit';
        } else {
          this._node.find('.section-content[data-mode="fit"]').addClass(hiddenClass);
          this._node.find('.section-content[data-mode="fill"]').removeClass(hiddenClass);
          this.placement.type = 'fill';
        }

        this.setConfig('placement', this.placement);
        this._applyResponsivePreview();
      }
    }, {
      key: '_applyResponsivePreview',
      value: function _applyResponsivePreview() {
        var _this5 = this;

        if (this.placement.type === 'fill') {
          (function () {
            var rawItemDimensions = {
              width: _this5._media.width,
              height: _this5._media.height
            };

            _this5.responsivePreview.each(function (index, element) {
              var jqElement = $(element);
              var containerDimensions = {
                width: jqElement.width(),
                height: jqElement.height()
              };
              var itemDimensions = _Media2.default.getTargetDimensions(rawItemDimensions, containerDimensions);
              var cropDistance = _Media2.default.findCropDistance(itemDimensions, jqElement, _this5.placement.fill);

              jqElement.css('background-position', cropDistance.x + 'px ' + cropDistance.y + 'px');
            });

            _this5.responsivePreview.css('background-size', 'cover');
          })();
        } else {
          this.responsivePreview.css('background-color', this.placement.fit.color);
          this.responsivePreview.css('background-size', 'contain');
          this.responsivePreview.css('background-position', '50% 50%');
        }
      }
    }, {
      key: '_onThumbnailClicked',
      value: function _onThumbnailClicked(event) {
        var fromLeft = event.pageX - this.previewThumbnail.offset().left;
        var fromTop = event.pageY - this.previewThumbnail.offset().top;

        // then we'll transfer that to percentage.
        var ratioLeft = fromLeft / this.previewThumbnail.width();
        var ratioTop = fromTop / this.previewThumbnail.height();

        this._applyCrop(ratioLeft, ratioTop);
      }
    }, {
      key: '_onDotDragged',
      value: function _onDotDragged(event) {
        var fromLeft = event.pageX - this.previewThumbnail.offset().left;
        var fromTop = event.pageY - this.previewThumbnail.offset().top;

        var rightBound = this.previewThumbnail.offset().left + this.previewThumbnail.width();
        var bottomBound = this.previewThumbnail.offset().top + this.previewThumbnail.height();

        // bounds checks
        if (fromLeft < 0) {
          fromLeft = 0;
        }
        if (fromTop < 0) {
          fromTop = 0;
        }
        if (event.pageX > rightBound) {
          fromLeft = this.previewThumbnail.width();
        }
        if (event.pageY > bottomBound) {
          fromTop = this.previewThumbnail.height();
        }

        var ratioLeft = fromLeft / this.previewThumbnail.width();
        var ratioTop = fromTop / this.previewThumbnail.height();

        this._applyCrop(ratioLeft, ratioTop);
      }
    }, {
      key: '_applyCrop',
      value: function _applyCrop(left, top) {
        var percentLeft = left * 100;
        var percentTop = top * 100;

        this.focusDot.css('left', percentLeft + '%');
        this.focusDot.css('top', percentTop + '%');

        var fillObj = { x: left, y: top };

        this.placement.fill = fillObj;

        this.setConfig('placement', this.placement);
        this._applyResponsivePreview();
      }
    }, {
      key: 'beforePanelDestroy',
      value: function beforePanelDestroy() {
        // remove the non-selected settings
        if (this.placement.type === 'fill') {
          delete this.placement.fit;
        } else {
          delete this.placement.fill;
        }

        this.setConfig('placement', this.placement);
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabBackground.prototype.__proto__ || Object.getPrototypeOf(TabBackground.prototype), 'destroy', this).call(this);

        this.checkbox.off('click');
        this.previewThumbnail.off('click');
        this.focusDot.off('mousedown');
        this.focusDot.off('mouseup mouseleave');
        this._node.find('.fit-palette-item').off('click');

        this._node.find('[data-toggle="tooltip"]').tooltip('destroy');
        this.colorPickerTrigger.spectrum('destroy');
        this._node.closest('.config-content').removeClass('placement-config');

        this.colors = null;
      }
    }]);

    return TabBackground;
  }(_Tab3.default);

  exports.default = TabBackground;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabBackground.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabManageImage', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section centered\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"swap\">\r\n      <img class=\"edit-media-icon\" src=\"resources/tpl/builder/icons/media-config/edit-media.png\" />\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.changeMedia : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"builder-config-section centered\">\r\n  <div class=\"section-content button centered\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"remove\">\r\n      <i class=\"config-icon fa fa-trash-o\"></i>\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.remove : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabManageImage',['module', 'exports', './Tab', 'lib-build/hbars!./TabManageImage', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app'], function (module, exports, _Tab2, _TabManageImage, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabManageImage2 = _interopRequireDefault(_TabManageImage);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabManageImage = function (_Tab) {
    _inherits(TabManageImage, _Tab);

    function TabManageImage(params) {
      _classCallCheck(this, TabManageImage);

      var _this = _possibleConstructorReturn(this, (TabManageImage.__proto__ || Object.getPrototypeOf(TabManageImage)).call(this, params));

      _this.title = _app2.default.builder.mediaConfig.tabs.manage;
      _this.type = 'manage';
      _this.icon = 'fa-wrench';
      return _this;
    }

    _createClass(TabManageImage, [{
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(TabManageImage.prototype.__proto__ || Object.getPrototypeOf(TabManageImage.prototype), 'postCreate', this).call(this, params);

        if (this._options) {
          if (this._options.hideRemove) {
            this._node.find('.config-item[data-action="remove"]').parents('.builder-config-section').hide();
          }
        }

        //
        // Events
        //

        this._node.find('.config-item[data-action="remove"]').on('click', function () {
          this._onAction('remove');
        }.bind(this));

        this._node.find('.config-item[data-action="swap"]').on('click', function () {
          _this2._onAction('swap');
        });
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabManageImage.prototype.__proto__ || Object.getPrototypeOf(TabManageImage.prototype), 'destroy', this).call(this);

        this._node.find('.config-item[data-action="remove"]').off('click');
        this._node.find('.config-item[data-action="swap"]').off('click');
      }
    }, {
      key: 'render',
      value: function render() {
        return (0, _TabManageImage2.default)({
          strings: _app2.default.builder.mediaConfig.manage
        });
      }
    }]);

    return TabManageImage;
  }(_Tab3.default);

  exports.default = TabManageImage;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabManageImage.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabAppearance', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section media-appearance no-spread\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.layout : stack1), depth0))
    + "</h4>\r\n  <ul class=\"section-content horizontal\">\r\n    <li class=\"config-item\" data-type=\"style\" data-value=\"shadow-light\" data-shadow=\"true\" data-text=\"light\">\r\n      <div class=\"config-item\">\r\n        <i class=\"check-mark fa fa-check active\"></i>\r\n        <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/shadowTextLight.png\"/>\r\n      </div>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"style\" data-value=\"shadow-dark\" data-shadow=\"true\" data-text=\"dark\">\r\n      <div class=\"config-item\">\r\n        <i class=\"check-mark fa fa-check active\"></i>\r\n        <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/shadowTextDark.png\"/>\r\n      </div>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"style\" data-value=\"background-dark\" data-background=\"dark\" data-text=\"light\">\r\n      <div class=\"config-item\">\r\n        <i class=\"check-mark fa fa-check active\"></i>\r\n        <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/backgroundDark.png\"/>\r\n      </div>\r\n    </li>\r\n    <li class=\"config-item\" data-type=\"style\" data-value=\"background-light\" data-background=\"light\" data-text=\"dark\">\r\n      <div class=\"config-item\">\r\n        <i class=\"check-mark fa fa-check active\"></i>\r\n        <img class=\"config-image\" src=\"resources/tpl/builder/icons/media-config/backgroundLight.png\"/>\r\n      </div>\r\n    </li>\r\n  </ul>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabAppearance',['module', 'exports', './Tab', 'lib-build/hbars!./TabAppearance', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'lib-build/less!./Common'], function (module, exports, _Tab2, _TabAppearance, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabAppearance2 = _interopRequireDefault(_TabAppearance);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabAppearance = function (_Tab) {
    _inherits(TabAppearance, _Tab);

    function TabAppearance(params) {
      _classCallCheck(this, TabAppearance);

      var _this = _possibleConstructorReturn(this, (TabAppearance.__proto__ || Object.getPrototypeOf(TabAppearance)).call(this, params));

      _this.title = _app2.default.builder.mediaConfig.tabs.appearance;
      _this.type = 'media-appearance';
      _this.icon = 'fa-magic';
      return _this;
    }

    _createClass(TabAppearance, [{
      key: 'render',
      value: function render() {
        return (0, _TabAppearance2.default)({
          strings: _app2.default.builder.mediaConfig.mediaAppearance
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(TabAppearance.prototype.__proto__ || Object.getPrototypeOf(TabAppearance.prototype), 'postCreate', this).call(this, params);
        var styleItems = this._node.find('.config-item[data-type="style"]');
        var style = this._getTitleStyle();

        this._node.find('.config-item[data-value="' + style + '"]').addClass(this.selectedClass);
        styleItems.on('click', function (e) {
          var target = $(e.currentTarget);

          // now, populate with one of three things:
          var value = {
            shadow: target.data('shadow') ? true : false,
            text: target.data('text'),
            background: target.data('background') || null
          };

          _this2.setSectionConfig('titleStyle', value);
          styleItems.removeClass(_this2.selectedClass);
          target.addClass(_this2.selectedClass);
        });
      }
    }, {
      key: '_getTitleStyle',
      value: function _getTitleStyle() {
        var titleStyle = this._sectionOptions.titleStyle;

        if (!titleStyle) {
          return 'shadow-light';
        }

        if (titleStyle.background) {
          if (titleStyle.background === 'dark') {
            return 'background-dark';
          } else {
            return 'background-light';
          }
        } else {
          if (titleStyle.shadow && titleStyle.text === 'dark') {
            return 'shadow-dark';
          } else {
            return 'shadow-light';
          }
        }
      }
    }, {
      key: 'beforePanelDestroy',
      value: function beforePanelDestroy() {}
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabAppearance.prototype.__proto__ || Object.getPrototypeOf(TabAppearance.prototype), 'destroy', this).call(this);
      }
    }]);

    return TabAppearance;
  }(_Tab3.default);

  exports.default = TabAppearance;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabAppearance.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/notification/Notification',[],function(){});
define('storymaps-react/tpl/builder/notification/Notification',['module', 'exports', 'storymaps/tpl/utils/UI', 'dojo/Deferred', 'lib-build/less!./Notification'], function (module, exports, _UI, _Deferred) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _UI2 = _interopRequireDefault(_UI);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Notification = function () {
    function Notification(params) {
      _classCallCheck(this, Notification);

      this._id = _UI2.default.getUID();
      this._container = $('.notification-container');
      this._label = params.label;
      this._positionTop = params.positionTop;

      this._resultDeferred = null;
      this._node = null;
    }

    _createClass(Notification, [{
      key: 'display',
      value: function display() {
        var p = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        this._resultDeferred = new _Deferred2.default();

        if (!this._container || !this._label) {
          this._resultDeferred.reject();
          return this._resultDeferred;
        }

        if (p.clearPreviousUndo) {
          // TODO: should only remove undo once there is more notification type
          this._container.empty();
        }

        this._container.append(this.render());
        this._node = $('#' + this._id);

        this._node.fadeIn();

        this.postCreate();

        return this._resultDeferred;
      }
    }, {
      key: 'update',
      value: function update(params) {
        this._label = params.label;

        if (this._node) {
          this._node.replaceWith(this.render());
          this._node = $('#' + this._id);
          this._node.show();

          this.postCreate();
        }
      }
    }]);

    return Notification;
  }();

  exports.default = Notification;
  module.exports = exports['default'];
});
//# sourceMappingURL=Notification.js.map
;

define('lib-build/hbars!storymaps-react/tpl/builder/notification/Cancel', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  return "has-notification-btn";
  },"3":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "      <button class=\"btn btn-primary btn-sm btn-cancel\">"
    + escapeExpression(((helper = (helper = helpers.labelCancel || (depth0 != null ? depth0.labelCancel : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"labelCancel","hash":{},"data":data}) : helper)))
    + "</button>\r\n";
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"builder-notification notification-cancel ";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.displayCancel : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\">\r\n  <div class=\"alert alert-dismissible\" role=\"alert\">\r\n    "
    + escapeExpression(((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper)))
    + "\r\n";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.displayCancel : depth0), {"name":"if","hash":{},"fn":this.program(3, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\r\n      <span aria-hidden=\"true\">&times;</span>\r\n    </button>\r\n    <div class=\"info-icon\">\r\n      <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/builder/notification/Cancel',[],function(){});
define('storymaps-react/tpl/builder/notification/Cancel',['module', 'exports', './Notification', 'lib-build/hbars!./Cancel', 'lib-build/less!./Cancel'], function (module, exports, _Notification2, _Cancel) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Notification3 = _interopRequireDefault(_Notification2);

  var _Cancel2 = _interopRequireDefault(_Cancel);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var DEFAULT_DELAY = 5000;

  var Cancel = function (_Notification) {
    _inherits(Cancel, _Notification);

    function Cancel() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, Cancel);

      var _this = _possibleConstructorReturn(this, (Cancel.__proto__ || Object.getPrototypeOf(Cancel)).call(this, params));

      _this._type = 'start';
      return _this;
    }

    _createClass(Cancel, [{
      key: 'render',
      value: function render() {
        return (0, _Cancel2.default)({
          id: this._id,
          label: this._label,
          displayCancel: this._type == 'start',
          labelCancel: 'Cancel' // TODO
        });
      }
    }, {
      key: 'update',
      value: function update() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        this._type = params.type;

        _get(Cancel.prototype.__proto__ || Object.getPrototypeOf(Cancel.prototype), 'update', this).call(this, params);
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        this._initEvents();
      }
    }, {
      key: '_initEvents',
      value: function _initEvents() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var delay = params.delay || DEFAULT_DELAY;

        if (this._type != 'start') {
          setTimeout(function () {
            this._node.fadeOut({
              complete: function () {
                this._node.remove();
              }.bind(this) });

            this._resultDeferred.reject();
          }.bind(this), delay);
        }

        this._node.find('.btn-cancel').click(function () {
          this._node.remove();
          this._resultDeferred.resolve();
        }.bind(this));
      }
    }]);

    return Cancel;
  }(_Notification3.default);

  exports.default = Cancel;
  module.exports = exports['default'];
});
//# sourceMappingURL=Cancel.js.map
;

define('lib-build/less!storymaps-react/tpl/view/media/ImageBuilder',[],function(){});
define('storymaps-react/tpl/view/media/ImageBuilder',['module', 'exports', './Image', './builder/Panel', './builder/TabSizeImage', './builder/TabBackground', './builder/TabManageImage', './builder/TabAppearance', '../../builder/notification/Cancel', 'dojo/_base/lang', 'dojo/topic', 'lib-build/less!./ImageBuilder'], function (module, exports, _Image2, _Panel, _TabSizeImage, _TabBackground, _TabManageImage, _TabAppearance, _Cancel, _lang, _topic) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Image3 = _interopRequireDefault(_Image2);

  var _Panel2 = _interopRequireDefault(_Panel);

  var _TabSizeImage2 = _interopRequireDefault(_TabSizeImage);

  var _TabBackground2 = _interopRequireDefault(_TabBackground);

  var _TabManageImage2 = _interopRequireDefault(_TabManageImage);

  var _TabAppearance2 = _interopRequireDefault(_TabAppearance);

  var _Cancel2 = _interopRequireDefault(_Cancel);

  var _lang2 = _interopRequireDefault(_lang);

  var _topic2 = _interopRequireDefault(_topic);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var ImageBuilder = function (_Image) {
    _inherits(ImageBuilder, _Image);

    function ImageBuilder(image) {
      _classCallCheck(this, ImageBuilder);

      var _this = _possibleConstructorReturn(this, (ImageBuilder.__proto__ || Object.getPrototypeOf(ImageBuilder)).call(this, image));

      _this._uploadNotification = null;
      return _this;
    }

    _createClass(ImageBuilder, [{
      key: 'postCreate',
      value: function postCreate(params) {
        _get(ImageBuilder.prototype.__proto__ || Object.getPrototypeOf(ImageBuilder.prototype), 'postCreate', this).call(this, params);

        // Placeholder image are managed by the section
        if (this._image.isPlaceholder) {
          this._node.find('.media-cfg-invite').hide();
        } else {
          var tabs = [];

          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = this._builderConfigurationTabs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var tab = _step.value;

              if (tab == 'size') {
                tabs.push(new _TabSizeImage2.default());
              } else if (tab == 'media-appearance') {
                tabs.push(new _TabAppearance2.default({
                  sectionOptions: params.foregroundOptions,
                  onSectionChange: params.applySectionConfig
                }));
              } else if (tab == 'background') {
                tabs.push(new _TabBackground2.default({
                  sectionType: params.sectionType
                }));
              } else if (tab == 'manage') {
                tabs.push(new _TabManageImage2.default({
                  hideRemove: this._placement == 'background'
                }));
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }

          new _Panel2.default({
            containerMedia: this._node,
            tabs: tabs,
            media: this._image,
            onChange: this._onConfigChange.bind(this),
            onAction: this._onAction.bind(this),
            onToggle: function () {
              params.onToggleMediaConfig(this);
            }.bind(this),
            closeBtnStyle: this._placement == 'background' ? 'light' : 'standard'
          });

          //
          // Image gallery invite
          //
          this._node.find('.img-gallery-invite').click(this._onCreateImageGallery.bind(this));

          this._node.find('.img-gallery-add').tooltip({
            container: 'body',
            title: i18n.builder.imageGallery.addImage
          });
        }

        this.initBuilderUI();
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._image.uploadDeferred) {
          delete this._image.uploadDeferred;
        }

        if (this._node) {
          this._image.caption = this._node.find('.block-caption').html();
        }

        return _lang2.default.clone({
          type: 'image',
          image: this._image
        });
      }
    }, {
      key: '_onConfigChange',
      value: function _onConfigChange() {
        this._applyConfig();
        _get(ImageBuilder.prototype.__proto__ || Object.getPrototypeOf(ImageBuilder.prototype), '_onConfigChange', this).call(this);
      }
    }, {
      key: '_onUploadStart',
      value: function _onUploadStart() {
        this._uploadNotification = new _Cancel2.default({
          container: this._node.parents('.section').eq(0),
          label: 'Image upload in progress...' // TODO
        });

        this._node.find('.img-gallery-invite').addClass('disabled');

        this._uploadNotification.display().then(function () {
          this._onAction('remove');
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: '_onUploadSuccess',
      value: function _onUploadSuccess(image) {
        this._image.url = image.url;
        this._url = image.url;
        if (image.thumbUrl) {
          this._image.thumbUrl = image.thumbUrl;
          this.previewThumb = image.thumbUrl;
        }
        if (this._image.dataUrl) {
          this._image.dataUrl = null;
        }

        if (this._uploadNotification) {
          this._uploadNotification.update({
            type: 'success',
            label: 'Image uploaded successfully'
          });
        }

        this._isLoaded = false;

        // Preload the image so that there is no flashing
        this.preload().then(this.load.bind(this));

        _topic2.default.publish('builder-media-update');
        this._node.find('.img-gallery-invite').removeClass('disabled');
      }
    }, {
      key: '_onUploadFail',
      value: function _onUploadFail() {
        if (this._uploadNotification) {
          this._uploadNotification.update({
            type: 'error',
            label: 'Image upload failed'
          });
        }

        if (this._placement == 'block') {
          this._onAction('remove');
        } else {
          this._onAction('swap', {
            type: 'empty',
            empty: 'empty'
          });
        }
      }
    }, {
      key: '_onCreateImageGallery',
      value: function _onCreateImageGallery() {
        this._onAction('image-to-image-gallery');
      }
    }]);

    return ImageBuilder;
  }(_Image3.default);

  exports.default = ImageBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=ImageBuilder.js.map
;

define('lib-build/less!storymaps-react/tpl/view/media/ImageGalleryBuilder',[],function(){});
define('storymaps-react/tpl/view/media/ImageGalleryBuilder',['module', 'exports', './Media', './ImageGallery', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', '../../builder/notification/Cancel', 'dojo/_base/lang', 'dojo/topic', 'lib-build/less!./ImageGalleryBuilder'], function (module, exports, _Media, _ImageGallery2, _app, _Cancel, _lang, _topic) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media2 = _interopRequireDefault(_Media);

  var _ImageGallery3 = _interopRequireDefault(_ImageGallery2);

  var _app2 = _interopRequireDefault(_app);

  var _Cancel2 = _interopRequireDefault(_Cancel);

  var _lang2 = _interopRequireDefault(_lang);

  var _topic2 = _interopRequireDefault(_topic);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var ImageGalleryBuilder = function (_ImageGallery) {
    _inherits(ImageGalleryBuilder, _ImageGallery);

    function ImageGalleryBuilder(images) {
      _classCallCheck(this, ImageGalleryBuilder);

      var _this = _possibleConstructorReturn(this, (ImageGalleryBuilder.__proto__ || Object.getPrototypeOf(ImageGalleryBuilder)).call(this, images));

      _this.MAX_NUMBER_IMAGES = 4;
      return _this;
    }

    _createClass(ImageGalleryBuilder, [{
      key: 'postCreate',
      value: function postCreate(params) {
        _get(ImageGalleryBuilder.prototype.__proto__ || Object.getPrototypeOf(ImageGalleryBuilder.prototype), 'postCreate', this).call(this, params);

        // Creating with an ArcGIS Upload
        if (this._images.images.length == 2) {
          var secondImage = this._images.images[1];

          if (secondImage.dataUrl && secondImage.uploadDeferred) {
            this._addImageAtIndex(secondImage, 1);
          }
        }

        this._updateTooltip();
      }
    }, {
      key: 'getPreviewThumbnail',
      value: function getPreviewThumbnail() {
        if (this._images.images && this._images.images.length) {
          var img = this._images.images[0];
          if (img.previewThumb) {
            return _Media2.default.addToken(img.previewThumb);
          }
          return _Media2.default.addToken(img.url);
        }

        return null;
      }
    }, {
      key: 'addEditEvent',
      value: function addEditEvent() {
        var _this2 = this;

        this._node.find('.ig-settings').off('click').on('click', function (event) {
          var itemNode = $(event.currentTarget).closest('.image-gallery-item');
          var index = itemNode.data('index');

          _this2._openMediaPickerForIndex(index);
        });
      }
    }, {
      key: 'addAddEvent',
      value: function addAddEvent() {
        var _this3 = this;

        this._node.find('.ig-add').off('click').on('click', function (event) {
          var index = _this3._images.images.length;
          var target = $(event.currentTarget);

          // if button is disabled, don't open!
          if (!target.hasClass('disabled')) {
            _this3._openMediaPickerForIndex(index);
          }
        });
      }
    }, {
      key: '_openMediaPickerForIndex',
      value: function _openMediaPickerForIndex(index) {
        var _this4 = this;

        // TODO: edit - need to change data model to store image source

        app.builder.mediaPicker.open({
          mode: 'add',
          authorizedMedia: ['image']
        }).then(function (selection) {
          if (selection.type === 'image') {
            _this4._addImageAtIndex(selection.image, index);
          }
        }, function () {
          //
        });
      }
    }, {
      key: '_addImageAtIndex',
      value: function _addImageAtIndex(image, index) {
        var url = image.url;

        if (image.dataUrl && image.uploadDeferred) {
          image.uploadDeferred.then(function (image2) {
            this._onUploadSuccess(image2.url, index);
          }.bind(this), function () {
            this._onUploadFail(index);
          }.bind(this));

          // Add image with dataUrl
          this._images.images[index] = {
            url: url,
            dataUrl: image.dataUrl
          };
          this._update();

          this._onUploadStart(index);
        } else {
          this._loadImage(url, index);
        }
      }
    }, {
      key: '_loadImage',
      value: function _loadImage(url, index) {
        var _this5 = this;

        var image = new window.Image();

        image.onload = function (e) {
          var width = e.currentTarget.naturalWidth;
          var height = e.currentTarget.naturalHeight;

          if (width && height) {
            _this5._images.images[index] = {
              height: height,
              width: width,
              url: url
            };

            _this5._update();
          }
        };

        image.src = _Media2.default.addToken(url);
      }
    }, {
      key: '_onUploadStart',
      value: function _onUploadStart(index) {
        this._uploadNotification = new _Cancel2.default({
          label: 'Image upload in progress...' // TODO
        });

        this._uploadNotification.display().then(function () {
          this._images.images.splice(index, 1);
          this._update();
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: '_onUploadSuccess',
      value: function _onUploadSuccess(url, index) {
        if (this._uploadNotification) {
          this._uploadNotification.update({
            type: 'success',
            label: 'Image uploaded successfully'
          });
        }

        _topic2.default.publish('builder-media-update');
        this._loadImage(url, index);
      }
    }, {
      key: '_onUploadFail',
      value: function _onUploadFail(index) {
        if (this._uploadNotification) {
          this._uploadNotification.update({
            type: 'error',
            label: 'Image upload failed'
          });
        }

        // Remove the last
        this._images.images.splice(index, 1);
        this._update();
      }
    }, {
      key: 'addRemoveEvent',
      value: function addRemoveEvent() {
        var _this6 = this;

        this._node.find('.ig-remove').off('click').on('click', function (event) {
          if (_this6._images.images.length == 2) {
            _this6._onAction('image-gallery-to-image');
            return;
          }

          var itemNode = $(event.currentTarget).closest('.image-gallery-item');
          // find which item it is that you should remove...
          var index = itemNode.data('index');

          _this6._images.images.splice(index, 1);
          _this6._update();
        });
      }
    }, {
      key: '_update',
      value: function _update() {
        _get(ImageGalleryBuilder.prototype.__proto__ || Object.getPrototypeOf(ImageGalleryBuilder.prototype), '_update', this).call(this);
        this._updateTooltip();
      }
    }, {
      key: '_updateTooltip',
      value: function _updateTooltip() {
        var addButton = this._node.find('.ig-add');
        // disable the plus button and show a tooltip if the max limit for the image gallery has been reached.
        if (this._images.images.length === this.MAX_NUMBER_IMAGES) {
          addButton.addClass('disabled');
          addButton.tooltip({
            container: 'body',
            title: _app2.default.builder.imageGallery.reachedLimit
          });
        } else {
          addButton.removeClass('disabled');
          addButton.tooltip({
            container: 'body',
            title: _app2.default.builder.imageGallery.addImage
          });
        }
      }
    }, {
      key: 'load',
      value: function load() {
        var _this7 = this;

        _get(ImageGalleryBuilder.prototype.__proto__ || Object.getPrototypeOf(ImageGalleryBuilder.prototype), 'load', this).call(this);

        this._node.find('.image-gallery-image-link').on('click', function () {
          _this7._node.find('.builder-ui.ig-item').addClass('hidden');
        });

        this._node.find('.image-gallery-item-wrapper').hover(function (event) {
          // if caused by hovering over the add button, disregard.
          if ($(event.target).closest('.ig-add').length) {
            return;
          }

          $(event.currentTarget).find('.builder-ui.ig-item').removeClass('hidden');
        }, function (event) {
          $(event.currentTarget).find('.builder-ui.ig-item').addClass('hidden');
        });

        this.addRemoveEvent();
        this.addEditEvent();
        this.addAddEvent();
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._node) {
          this._images.caption = this._node.find('.block-caption').html();
        }

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._images.images[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var image = _step.value;

            delete image.dataUrl;
            // That would mean game over if saving while an upload is in progress
            //delete image.uploadDeferred;
            delete image.adjustedHeight;
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return _lang2.default.clone({
          type: 'image-gallery',
          'image-gallery': this._images
        });
      }
    }]);

    return ImageGalleryBuilder;
  }(_ImageGallery3.default);

  exports.default = ImageGalleryBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=ImageGalleryBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabVideo', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<!--\r\n<div class=\"builder-config-section larger\">\r\n  <h4 class=\"title\">Play</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"play\" data-value=\"automatic\">Play Automatically</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"play\" data-value=\"click\">Play on Click</li>\r\n  </ul>\r\n</div>\r\n-->\r\n<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.audio : stack1), depth0))
    + "</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"audio\" data-value=\"on\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.on : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"audio\" data-value=\"muted\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.muted : stack1), depth0))
    + "</li>\r\n  </ul>\r\n  <span class=\"aside\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.volumeAside : stack1), depth0))
    + "</span>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabVideo',['module', 'exports', './Tab', 'lib-build/hbars!./TabVideo', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app'], function (module, exports, _Tab2, _TabVideo, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabVideo2 = _interopRequireDefault(_TabVideo);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabVideo = function (_Tab) {
    _inherits(TabVideo, _Tab);

    function TabVideo() {
      _classCallCheck(this, TabVideo);

      var _this = _possibleConstructorReturn(this, (TabVideo.__proto__ || Object.getPrototypeOf(TabVideo)).call(this));

      _this.title = _app2.default.builder.mediaConfig.tabs.appearance;
      _this.type = 'appearance';
      _this.icon = 'fa-sliders';
      return _this;
    }

    _createClass(TabVideo, [{
      key: 'render',
      value: function render() {
        return (0, _TabVideo2.default)({
          strings: _app2.default.builder.mediaConfig.appearance
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(TabVideo.prototype.__proto__ || Object.getPrototypeOf(TabVideo.prototype), 'postCreate', this).call(this, params);

        this.bindPlayOptions();
        this.bindAudioOptions();
      }
    }, {
      key: 'bindPlayOptions',
      value: function bindPlayOptions() {
        var _this2 = this;

        var playOptions = this._node.find('.config-item[data-type="play"]');
        var selectedPlayOption = this._media.play || 'automatic';

        this._node.find('.config-item[data-type="play"][data-value="' + selectedPlayOption + '"]').addClass(this.selectedClass);
        playOptions.on('click', function (e) {
          var target = $(e.currentTarget);
          var playOption = target.data('value');

          playOptions.removeClass(_this2.selectedClass);
          target.addClass(_this2.selectedClass);
          _this2.setConfig('play', playOption);
        });
      }
    }, {
      key: 'bindAudioOptions',
      value: function bindAudioOptions() {
        var _this3 = this;

        var audioOptions = this._node.find('.config-item[data-type="audio"]');
        var selectedAudioOption = this._media.options && this._media.options.audio || 'on';

        this._node.find('.config-item[data-type="audio"][data-value="' + selectedAudioOption + '"]').addClass(this.selectedClass);
        audioOptions.on('click', function (e) {
          var target = $(e.currentTarget);
          var audioOption = target.data('value');

          audioOptions.removeClass(_this3.selectedClass);
          target.addClass(_this3.selectedClass);
          _this3.setConfig('audio', audioOption);
        });
      }
    }, {
      key: 'unbindPlayOptions',
      value: function unbindPlayOptions() {
        var playOptions = this._node.find('.config-item[data-type="play"]');
        playOptions.off('click');
      }
    }, {
      key: 'unbindAudioOptions',
      value: function unbindAudioOptions() {
        var audioOptions = this._node.find('.config-item[data-type="audio"]');
        audioOptions.off('click');
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabVideo.prototype.__proto__ || Object.getPrototypeOf(TabVideo.prototype), 'destroy', this).call(this);

        this.unbindPlayOptions();
        this.unbindAudioOptions();
      }
    }]);

    return TabVideo;
  }(_Tab3.default);

  exports.default = TabVideo;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabVideo.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabManageMedia', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<!--<div class=\"builder-config-section centered\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"upload-image\">\r\n      Upload Alternate Image for Mobile\r\n    </div>\r\n    <div class=\"image-preview\">\r\n      <div class=\"overlay\">\r\n        <span class=\"icon\">Edit</span>\r\n        <span class=\"icon\">Remove</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>-->\r\n<div class=\"builder-config-section centered\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"swap\">\r\n      <img class=\"edit-media-icon\" src=\"resources/tpl/builder/icons/media-config/edit-media.png\" />\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.changeMedia : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"builder-config-section centered\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"remove\">\r\n      <i class=\"config-icon fa fa-trash-o\"></i>\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.remove : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabManageMedia',['module', 'exports', './Tab', 'lib-build/hbars!./TabManageMedia', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app'], function (module, exports, _Tab2, _TabManageMedia, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabManageMedia2 = _interopRequireDefault(_TabManageMedia);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabManageMedia = function (_Tab) {
    _inherits(TabManageMedia, _Tab);

    function TabManageMedia(params) {
      _classCallCheck(this, TabManageMedia);

      var _this = _possibleConstructorReturn(this, (TabManageMedia.__proto__ || Object.getPrototypeOf(TabManageMedia)).call(this, params));

      _this.title = _app2.default.builder.mediaConfig.tabs.manage;
      _this.type = 'manage';
      _this.icon = 'fa-wrench';
      return _this;
    }

    _createClass(TabManageMedia, [{
      key: 'render',
      value: function render() {
        return (0, _TabManageMedia2.default)({
          strings: _app2.default.builder.mediaConfig.manage
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(TabManageMedia.prototype.__proto__ || Object.getPrototypeOf(TabManageMedia.prototype), 'postCreate', this).call(this, params);

        if (this._options) {
          if (this._options.hideRemove) {
            this._node.find('.config-item[data-action="remove"]').parents('.builder-config-section').hide();
          }
        }

        //
        // Events
        //

        this._node.find('.config-item[data-action="remove"]').on('click', function () {
          _this2._onAction('remove');
        });

        this._node.find('.config-item[data-action="upload-image"]').on('click', function () {
          // TODO: Send action
          console.log('action');
        });

        this._node.find('.config-item[data-action="swap"]').on('click', function () {
          _this2._onAction('swap');
        });
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabManageMedia.prototype.__proto__ || Object.getPrototypeOf(TabManageMedia.prototype), 'destroy', this).call(this);

        this._node.find('.config-item[data-action="remove"]').off('click');
        this._node.find('.config-item[data-action="upload-image"]').off('click');
        this._node.find('.config-item[data-action="swap"]').off('click');
      }
    }]);

    return TabManageMedia;
  }(_Tab3.default);

  exports.default = TabManageMedia;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabManageMedia.js.map
;

define('lib-build/less!storymaps-react/tpl/view/media/VideoBuilder',[],function(){});
define('storymaps-react/tpl/view/media/VideoBuilder',['module', 'exports', './Video', './builder/Panel', './builder/TabSizeImage', './builder/TabVideo', './builder/TabManageMedia', './builder/TabAppearance', 'dojo/_base/lang', 'lib-build/less!./VideoBuilder'], function (module, exports, _Video2, _Panel, _TabSizeImage, _TabVideo, _TabManageMedia, _TabAppearance, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Video3 = _interopRequireDefault(_Video2);

  var _Panel2 = _interopRequireDefault(_Panel);

  var _TabSizeImage2 = _interopRequireDefault(_TabSizeImage);

  var _TabVideo2 = _interopRequireDefault(_TabVideo);

  var _TabManageMedia2 = _interopRequireDefault(_TabManageMedia);

  var _TabAppearance2 = _interopRequireDefault(_TabAppearance);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var VideoBuilder = function (_Video) {
    _inherits(VideoBuilder, _Video);

    function VideoBuilder() {
      _classCallCheck(this, VideoBuilder);

      return _possibleConstructorReturn(this, (VideoBuilder.__proto__ || Object.getPrototypeOf(VideoBuilder)).apply(this, arguments));
    }

    _createClass(VideoBuilder, [{
      key: 'render',
      value: function render() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (params.placement == 'block' && this._video.title) {
          this._video.caption = this._video.title;
        }

        delete this._video.title;
        delete this._video.description;

        return _get(VideoBuilder.prototype.__proto__ || Object.getPrototypeOf(VideoBuilder.prototype), 'render', this).call(this, params);
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(VideoBuilder.prototype.__proto__ || Object.getPrototypeOf(VideoBuilder.prototype), 'postCreate', this).call(this, params);

        var tabs = [];

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._builderConfigurationTabs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var tab = _step.value;

            if (tab == 'size') {
              tabs.push(new _TabSizeImage2.default());
            } else if (tab == 'appearance') {
              if (this._sectionType == 'immersive') {
                tabs.push(new _TabVideo2.default());
              }
            } else if (tab == 'media-appearance') {
              tabs.push(new _TabAppearance2.default({
                sectionOptions: params.foregroundOptions,
                onSectionChange: params.applySectionConfig
              }));
            } else if (tab == 'manage') {
              tabs.push(new _TabManageMedia2.default({
                hideRemove: this._placement == 'background'
              }));
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        new _Panel2.default({
          containerMedia: this._node,
          tabs: tabs,
          media: this._video,
          onChange: this._onConfigChange.bind(this),
          onAction: this._onAction.bind(this),
          onToggle: function () {
            params.onToggleMediaConfig(this);
          }.bind(this),
          closeBtnStyle: this._placement == 'background' ? 'light' : 'standard'
        });

        this.initBuilderUI();
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        // TODO: those shoul dbe filtered before
        delete this._video.user;
        delete this._video.thumbUrl;
        delete this._video.viewCount;
        delete this._video.likeCount;

        if (this._node) {
          this._video.caption = this._node.find('.block-caption').html();
        }

        return _lang2.default.clone({
          type: 'video',
          video: this._video
        });
      }
    }, {
      key: '_onConfigChange',
      value: function _onConfigChange() {
        console.log('onConfigChange: ', this._video);
        this._applyConfig();
        _get(VideoBuilder.prototype.__proto__ || Object.getPrototypeOf(VideoBuilder.prototype), '_onConfigChange', this).call(this);
      }
    }]);

    return VideoBuilder;
  }(_Video3.default);

  exports.default = VideoBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=VideoBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabManage', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<!--<div class=\"builder-config-section\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"upload-image\">\r\n      Upload Alternate Image for Mobile\r\n    </div>\r\n    <div class=\"image-preview\">\r\n      <div class=\"overlay\">\r\n        <span class=\"icon\">Edit</span>\r\n        <span class=\"icon\">Remove</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>-->\r\n<div class=\"builder-config-section\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"swap\">\r\n      <img class=\"edit-media-icon\" src=\"resources/tpl/builder/icons/media-config/edit-media.png\" />\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.changeMedia : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"builder-config-section larger\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"edit\">\r\n      <i class=\"config-icon fa fa-external-link\"></i>\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.edit : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n  <span class=\"aside\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.editAside : stack1), depth0))
    + "</span>\r\n</div>\r\n<div class=\"builder-config-section\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"remove\">\r\n      <i class=\"config-icon fa fa-trash-o\"></i>\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.remove : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps/common/builder/BuilderHelper',[
  'dojo/_base/lang',
  'dojo/_base/array',
  'esri/arcgis/utils',
  'esri/IdentityManager',
  'esri/request'
], function(
  lang,
  array,
  arcgisUtils,
  IdentityManager,
  esriRequest
) {
  /**
   * BuilderHelper
   * @class BuilderHelper
   *
   * Collection of helper functions for Builder
   */

  function getPortalURL() {
    return arcgisUtils.arcgisUrl.split('/sharing/')[0];
  }

  function saveApp(doNotOverwriteTitle) {
    var portalUrl = getPortalURL(),
        appItem = lang.clone(app.data.appItem.item),
        appData = lang.clone(app.data.appItem.data),
        uid = appItem.owner || IdentityManager.findCredential(portalUrl).userId,
        token = IdentityManager.findCredential(portalUrl).token;

    // Remove properties that don't have to be committed
    delete appItem.avgRating;
    delete appItem.modified;
    delete appItem.numComments;
    delete appItem.numRatings;
    delete appItem.numViews;
    delete appItem.size;

    //
    // Add/edit the typeKeyword property to be able to identify the app and the layout
    //

    if (! appItem.typeKeywords) {
      appItem.typeKeywords = [];
    }

    // App not created through the builder fromScratch mode don't get those keywords
    appItem.typeKeywords = appItem.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_APP);

    // Those should only be necessary to be able to convert an appid that wasn't already selfConfigured
    appItem.typeKeywords = appItem.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_GENERIC);

    // Layout
    var layouts = $.map(app.cfg.LAYOUTS, function(layout) {
      return 'layout-' + layout.id;
    });
    // Filter previous layout keyword
    appItem.typeKeywords = $.grep(appItem.typeKeywords, function(keyword) {
      return $.inArray(keyword, layouts) == -1;
    });
    // Add actual layout keyword
    appItem.typeKeywords.push('layout-cascade-1');

    // Make the typeKeywords array unique
    appItem.typeKeywords = $.grep(appItem.typeKeywords, function(keyword, index) {
      return index == $.inArray(keyword, appItem.typeKeywords);
    });

    // Transform arrays
    appItem.tags = appItem.tags ? appItem.tags.join(',') : '';
    appItem.typeKeywords = appItem.typeKeywords.join(',');

    // App proxies
    appItem.serviceProxyParams = JSON.stringify(appItem.serviceProxyParams);

    // Title
    if (! doNotOverwriteTitle) {
      appItem.title = app.data.title;
    }

    if (appItem.properties) {
      appItem.properties = JSON.stringify(appItem.properties);
    }

    // Edit URL of hosted apps to always include index.html
    if (appItem.url && appItem.url.match(/apps\/[a-zA-Z]+\/\?appid=/)) {
      appItem.url = appItem.url.replace('/?appid=', '/index.html?appid=');
    }

    appItem = lang.mixin(appItem, {
      f: 'json',
      token: token,
      overwrite: true,
      text: JSON.stringify(appData)
    });

    var url = portalUrl + '/sharing/content/users/' + uid + (appItem.ownerFolder ? ('/' + appItem.ownerFolder) : '');

    // Updating
    if (appItem.id) {
      url += '/items/' + appItem.id + '/update';
    }
    // creating
    else {
      url += '/addItem';
    }

    return esriRequest(
      {
        url: url,
        handleAs: 'json',
        content: appItem
      },
      {
        usePost: true
      }
    );
  }

  function shareItems(items, sharing) {
    var portalUrl = getPortalURL(),
        uid = IdentityManager.findCredential(portalUrl).userId,
        token = IdentityManager.findCredential(portalUrl).token;

    var params = {
      f: 'json',
      token: token,
      items: items,
      groups: '',
      everyone: false,
      account: false
    };

    if (sharing == 'public') {
      params.everyone = true;
    }
    else if (sharing == 'account') {
      params.account = true;
    }

    return esriRequest(
      {
        url: portalUrl + '/sharing/content/users/' + uid + '/shareItems',
        handleAs: 'json',
        content: params
      },
      {
        usePost: true
      }
    );
  }

  function cleanApp() {
    if (! app.portal) {
      console.error('Fatal error - not signed in');
      return;
    }

    return;
    // TODO
    /*
    app.portal.signIn().then(
      function() {
        var portalUrl = getPortalURL(),
            uid = IdentityManager.findCredential(portalUrl).userId,
            token = IdentityManager.findCredential(portalUrl).token,
            appItem = lang.clone(app.data.getWebAppItem());

        // Remove properties that don't have to be committed
        delete appItem.avgRating;
        delete appItem.modified;
        delete appItem.numComments;
        delete appItem.numRatings;
        delete appItem.numViews;
        delete appItem.size;

        appItem = lang.mixin(appItem, {
          f: 'json',
          token: token,
          overwrite: true,
          text: JSON.stringify(app.data.getWebAppData().getBlank())
        });

        var saveRq = esriRequest(
          {
            url: portalUrl + '/sharing/content/users/' + uid + (appItem.ownerFolder ? ('/' + appItem.ownerFolder) : '') + '/addItem',
            handleAs: 'json',
            content: appItem
          },
          {
            usePost: true
          }
        );

        saveRq.then(
          function() {
            console.log('Web Application data cleaned successfully');
          },
          function() {
            console.log('Web Application data cleaning has failed');
          }
        );
      },
      function(error) {
        console.error('Web Application data cleaning has failed', error);
      }
    );

    return 'Cleaning ...';
    */
  }

  /*eslint-disable */
  function getBlankAppJSON() {
    return {
      "itemType": "text",
      "guid": null,
      "name": null,
      "type": "Web Mapping Application",
      "typeKeywords": app.cfg.WEBAPP_KEYWORD_GENERIC.concat(app.cfg.WEBAPP_KEYWORD_APP),
      "description": null,
      "tags": app.cfg.WEBAPP_TAG,
      "snippet": null,
      "thumbnail": null,
      "documentation": null,
      "extent": [],
      "lastModified": -1,
      "spatialReference": null,
      "accessInformation": null,
      "licenseInfo": null,
      "culture": "en-us", // TODO
      "properties": null,
      "size": 1,
      "appCategories": [],
      "industries": [],
      "languages": [],
      "largeThumbnail": null,
      "banner": null,
      "screenshots": [],
      "listed": false,
      "ownerFolder": null,
      "protected": false,
      "commentsEnabled": true,
      "numComments": 0,
      "numRatings": 0,
      "avgRating": 0,
      "numViews": 1
    };
  }
  /*eslint-enable */

  /*
  function getMyContentURL() {
    return this.getPortalURL() + '/home/content.html';
  }
  */

  function getMapViewerLink(webmapId) {
    return this.getPortalURL() + '/home/webmap/viewer.html' + '?webmap=' + webmapId;
  }

  function getSceneViewerLink(websceneId) {
    return this.getPortalURL() + '/home/webscene/viewer.html' + '?webscene=' + websceneId;
  }

  function getMyStoriesURL() {
    if (app.isPortal) {
      return this.getPortalURL() + '/apps/MyStories/';
    }
    else {
      return '//storymaps.arcgis.com/en/my-stories/';
    }
  }

  return {
    getPortalURL: getPortalURL,
    saveApp: saveApp,
    shareItems: shareItems,
    getBlankAppJSON: getBlankAppJSON,
    cleanApp: cleanApp,
    getMapViewerLink: getMapViewerLink,
    getSceneViewerLink: getSceneViewerLink,
    getMyStoriesURL: getMyStoriesURL
  };
});

define('storymaps-react/tpl/view/media/builder/TabManage',['module', 'exports', './Tab', 'lib-build/hbars!./TabManage', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'storymaps/common/builder/BuilderHelper'], function (module, exports, _Tab2, _TabManage, _app, _BuilderHelper) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabManage2 = _interopRequireDefault(_TabManage);

  var _app2 = _interopRequireDefault(_app);

  var _BuilderHelper2 = _interopRequireDefault(_BuilderHelper);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabManage = function (_Tab) {
    _inherits(TabManage, _Tab);

    function TabManage() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, TabManage);

      var _this = _possibleConstructorReturn(this, (TabManage.__proto__ || Object.getPrototypeOf(TabManage)).call(this, params));

      _this.title = _app2.default.builder.mediaConfig.tabs.manage;
      _this.type = 'manage';
      _this.icon = 'fa-wrench';

      _this._mediaType = params.mediaType;
      _this._mediaId = params.mediaId;
      return _this;
    }

    _createClass(TabManage, [{
      key: 'render',
      value: function render() {
        return (0, _TabManage2.default)({
          strings: _app2.default.builder.mediaConfig.manage
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(TabManage.prototype.__proto__ || Object.getPrototypeOf(TabManage.prototype), 'postCreate', this).call(this, params);

        if (this._options) {
          if (this._options.hideRemove) {
            this._node.find('.config-item[data-action="remove"]').parents('.builder-config-section').hide();
          }
        }

        //
        // Events
        //

        this._node.find('.config-item[data-action="remove"]').on('click', function () {
          _this2._onAction('remove');
        });

        this._node.find('.config-item[data-action="upload-image"]').on('click', function () {
          // TODO: Send action
          console.log('action');
        });

        this._node.find('.config-item[data-action="edit"]').on('click', function () {
          if (!_this2._mediaType || !_this2._mediaId) {
            return;
          }

          if (_this2._mediaType == 'webmap') {
            window.open(_BuilderHelper2.default.getMapViewerLink(_this2._mediaId), '_blank');
          } else if (_this2._mediaType == 'webscene') {
            window.open(_BuilderHelper2.default.getSceneViewerLink(_this2._mediaId), '_blank');
          }
        });

        this._node.find('.config-item[data-action="swap"]').on('click', function () {
          _this2._onAction('swap');
        });
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabManage.prototype.__proto__ || Object.getPrototypeOf(TabManage.prototype), 'destroy', this).call(this);

        this._node.find('.config-item[data-action="remove"]').off('click');
        this._node.find('.config-item[data-action="upload-image"]').off('click');
        this._node.find('.config-item[data-action="edit"]').off('click');
        this._node.find('.config-item[data-action="swap"]').off('click');
      }
    }]);

    return TabManage;
  }(_Tab3.default);

  exports.default = TabManage;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabManage.js.map
;
define('storymaps-react/tpl/view/media/builder/TabArcGIS',['module', 'exports', './Tab', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app'], function (module, exports, _Tab2, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabArcGIS = function (_Tab) {
    _inherits(TabArcGIS, _Tab);

    function TabArcGIS() {
      _classCallCheck(this, TabArcGIS);

      var _this = _possibleConstructorReturn(this, (TabArcGIS.__proto__ || Object.getPrototypeOf(TabArcGIS)).call(this));

      _this.title = _app2.default.builder.mediaConfig.tabs.appearance;
      _this.type = 'appearance';
      _this.icon = 'fa-sliders';
      return _this;
    }

    _createClass(TabArcGIS, [{
      key: 'postCreate',
      value: function postCreate(params) {
        _get(TabArcGIS.prototype.__proto__ || Object.getPrototypeOf(TabArcGIS.prototype), 'postCreate', this).call(this, params);

        this.bindPopup();
        this.bindInteraction();
        this.bindView();
        this.bindExtras();
      }
    }, {
      key: 'bindPopup',
      value: function bindPopup() {
        var _this2 = this;

        var popups = this._node.find('.config-item[data-type="popup"]');
        var popupsEnabled = this._media.popup || true;
        var dataValue = popupsEnabled ? 'enabled' : 'disabled';

        this._node.find('.config-item[data-type="popup"][data-value="' + dataValue + '"]').addClass(this.selectedClass);
        // on click or something....
        popups.on('click', function (e) {
          var target = $(e.currentTarget);
          var isEnabled = target.data('value') === 'enabled';

          popups.removeClass(_this2.selectedClass);
          target.addClass(_this2.selectedClass);
          _this2.setMedia('popup', isEnabled);
        });
      }
    }, {
      key: 'unbindPopup',
      value: function unbindPopup() {
        var popups = this._node.find('.config-item[data-type="popup"]');
        popups.off('click');
      }
    }, {
      key: 'bindInteraction',
      value: function bindInteraction() {
        var _this3 = this;

        var interactions = this._node.find('.config-item[data-type="interaction"]');
        var selectedInteraction = this._media.options.interaction || 'enabled';

        this._node.find('.config-item[data-type="interaction"][data-value="' + selectedInteraction + '"]').addClass(this.selectedClass);
        interactions.on('click', function (e) {
          var target = $(e.currentTarget);
          var interaction = target.data('value');

          interactions.removeClass(_this3.selectedClass);
          target.addClass(_this3.selectedClass);
          _this3.setConfig('interaction', interaction);
        });
      }
    }, {
      key: 'unbindInteraction',
      value: function unbindInteraction() {
        var interactions = this._node.find('.config-item[data-type="interaction"]');
        interactions.off('click');
      }
    }, {
      key: 'bindView',
      value: function bindView() {}
    }, {
      key: 'unbindView',
      value: function unbindView() {}
    }, {
      key: 'bindExtras',
      value: function bindExtras() {
        var extras = this._node.find('.config-item[data-type="extra"]');

        var legendEnabled = false;
        var searchEnabled = false;
        var locateEnabled = false;

        if (this._media.extras) {
          legendEnabled = this._media.extras.legend && this._media.extras.legend.enabled;
          searchEnabled = this._media.extras.search && this._media.extras.search.enabled;
          locateEnabled = this._media.extras.locate && this._media.extras.locate.enabled;
        }

        this._node.find('.config-item[data-type="extra"][data-value="legend"] input[type="checkbox"]').prop('checked', legendEnabled);
        this._node.find('.config-item[data-type="extra"][data-value="search"] input[type="checkbox"]').prop('checked', searchEnabled);
        this._node.find('.config-item[data-type="extra"][data-value="locate"] input[type="checkbox"]').prop('checked', locateEnabled);

        var self = this;
        extras.on('click', function (e) {
          var target = $(e.currentTarget);
          var type = target.data('value');
          var checked = target.find('input[type="checkbox"]').is(':checked');
          // read out the value
          self.setExtras(type, checked);
        });
      }
    }, {
      key: 'unbindExtras',
      value: function unbindExtras() {
        var extras = this._node.find('.config-item[data-type="extra"]');
        extras.off('click');
      }
    }, {
      key: 'setExtras',
      value: function setExtras(name, value) {
        if (!this._media.extras) {
          this._media.extras = {};
        }

        if (!this._media.extras[name]) {
          this._media.extras[name] = {};
        }

        this._media.extras[name]['enabled'] = value;

        this.onChange();
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabArcGIS.prototype.__proto__ || Object.getPrototypeOf(TabArcGIS.prototype), 'destroy', this).call(this);

        this.unbindPopup();
        this.unbindInteraction();
        this.unbindView();
        this.unbindExtras();
      }
    }]);

    return TabArcGIS;
  }(_Tab3.default);

  exports.default = TabArcGIS;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabArcGIS.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabWebMap', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.view : stack1), depth0))
    + "</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray disabled\" data-type=\"reset\" data-value=\"location\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.resetLocation : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray disabled\" data-type=\"reset\" data-value=\"layers\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.resetLayers : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray disabled\" data-type=\"reset\" data-value=\"popup\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.clearPopup : stack1), depth0))
    + "</li>\r\n  </ul>\r\n</div>\r\n<div class=\"builder-config-section larger\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interaction : stack1), depth0))
    + "</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"disabled\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionDisabled : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"button\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.buttonToEnable : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"enabled\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionEnabled : stack1), depth0))
    + " <sup style=\"vertical-align: 0;\">*</sup></li>\r\n  </ul>\r\n  <span class=\"aside\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionAside : stack1), depth0))
    + "</span>\r\n</div>\r\n<!--<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">Pop-Ups</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"popup\" data-value=\"disabled\">Disabled</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"popup\" data-value=\"enabled\">Enabled</li>\r\n  </ul>\r\n</div>\r\n<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">Extras</h4>\r\n  <ul class=\"section-content vertical-list checkmarks\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"extra\" data-value=\"legend\">\r\n      <label class=\"check\"><input type=\"checkbox\" value=\"legend\"> Legend</label>\r\n    </li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"extra\" data-value=\"search\">\r\n      <label class=\"check\"><input type=\"checkbox\" value=\"search\"> Search</label>\r\n    </li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"extra\" data-value=\"locate\">\r\n      <label class=\"check\"><input type=\"checkbox\" value=\"locate\"> Locate</label>\r\n    </li>\r\n  </ul>\r\n</div>-->\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabWebMap',['module', 'exports', './TabArcGIS', 'esri/dijit/LayerList', 'esri/arcgis/utils', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'lib-build/hbars!./TabWebMap'], function (module, exports, _TabArcGIS2, _LayerList, _utils, _app, _TabWebMap) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _TabArcGIS3 = _interopRequireDefault(_TabArcGIS2);

  var _LayerList2 = _interopRequireDefault(_LayerList);

  var _utils2 = _interopRequireDefault(_utils);

  var _app2 = _interopRequireDefault(_app);

  var _TabWebMap2 = _interopRequireDefault(_TabWebMap);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabWebMap = function (_TabArcGIS) {
    _inherits(TabWebMap, _TabArcGIS);

    function TabWebMap(params) {
      _classCallCheck(this, TabWebMap);

      var _this = _possibleConstructorReturn(this, (TabWebMap.__proto__ || Object.getPrototypeOf(TabWebMap)).call(this));

      _this.map = params.map;
      _this.layerList = null;

      _this._layerListNode = params.layerListNode;
      _this._eventExtent = null;
      _this._eventPopup = null;
      _this._eventPopup2 = null;
      _this._ignoreNextExtentChangeEvent = false;
      _this._isFirstOpening = true;

      //this.addMapEvents = this.addMapEvents.bind(this);
      // may need the original extent and the original layers list... not after all is done... that is too late!
      return _this;
    }

    _createClass(TabWebMap, [{
      key: 'setMap',
      value: function setMap(map) {
        if (map) {
          this.map = map;
        }

        this.attachEvents();

        if (this._node) {
          this.initLayerList();
        }
      }
    }, {
      key: 'attachEvents',
      value: function attachEvents() {
        // If the panel hasn't been opened yet
        if (!this._media || !this.map) {
          return;
        }

        if (!this._eventExtent) {
          this._eventExtent = this.map.map.on('extent-change', function (event) {
            if (!this._isActive) {
              return;
            }

            if (!this._ignoreNextExtentChangeEvent) {
              this._ignoreNextExtentChangeEvent = true;
              this.setMedia('extent', event.extent.toJson());
              this._updateLocationReset();
            } else {
              this._ignoreNextExtentChangeEvent = false;
            }
          }.bind(this));
        }

        if (!this._eventPopup) {
          this._eventPopup = this.map.map.on('click', function () {
            if (!this._isActive) {
              return;
            }

            var popupInfo = this.getSelectedFeatureInfo();

            if (popupInfo) {
              var disabledClass = 'disabled';
              var popupButton = this._node.find('.config-item[data-type="reset"][data-value="popup"]');
              // enable the button.
              popupButton.removeClass(disabledClass);
              this.setMedia('popup', popupInfo);
            }
          }.bind(this));
        }

        if (!this._eventPopup2) {
          this._eventPopup2 = $(this.map.map.infoWindow.domNode).find('.titleButton.close').click(function () {
            if (!this._isActive) {
              return;
            }

            var popupButton = this._node.find('.config-item[data-type="reset"][data-value="popup"]');
            popupButton.addClass('disabled');
            this.setMedia('popup', null);
          }.bind(this));
        }
      }
    }, {
      key: 'detachEvents',
      value: function detachEvents() {
        if (this._eventExtent) {
          this._eventExtent.remove();
          this._eventExtent = null;
        }

        if (this._eventPopup) {
          this._eventPopup.remove();
          this._eventPopup = null;
        }

        if (this._eventPopup2) {
          this._eventPopup2.remove();
          this._eventPopup2 = null;
        }
      }
    }, {
      key: 'initLayerList',
      value: function initLayerList() {
        var _this2 = this;

        if (this.layerList || !this._rootNode || !this._media || !this.map) {
          return;
        }

        // create a node for this!
        this._layerListNode.html('<div class="layer-list"></div>');

        var layerListNode = this._layerListNode.find('.layer-list')[0];
        var disabledClass = 'disabled';
        var layersButton = this._node.find('.config-item[data-type="reset"][data-value="layers"]');

        var layers = _utils2.default.getLayerList(this.map);

        // loop through and set visibility to the overrides
        if (this._media.layers) {
          var _loop = function _loop(i) {
            // see if matches
            var mediaLayer = _this2._media.layers[i];

            var layerListlayer = layers.find(function (item) {
              var layerId = item.id;

              if (item.layer && item.layer.id) {
                layerId = item.layer.id;
              }

              if (item.featureCollection) {
                layerId = item.featureCollection.layers[0].id;
              }

              return mediaLayer.id === layerId;
            });

            if (layerListlayer) {
              layerListlayer.visibility = mediaLayer.visibility;
            }
          };

          for (var i = 0; i < this._media.layers.length; i++) {
            _loop(i);
          }
        }

        this.layerList = new _LayerList2.default({
          map: this.map.map,
          layers: layers,
          showSubLayers: false
        }, layerListNode);

        this.layerList.startup();

        // enable if over 0, disable if under.
        if (this._media.layers && this._media.layers.length > 0) {
          layersButton.removeClass(disabledClass);
        }

        var self = this;
        this.layerList.on('toggle', function (event) {
          if (!_this2._isActive) {
            return;
          }

          if (!_this2._media.layers) {
            _this2._media.layers = [];
          }
          // see if the layer is already in the list of overridden layers.
          // We need its id, but all we get is the index.
          // find it by the operationalLayer

          var operationalLayer = self.layerList.layers[event.layerIndex];
          // and then see if the layer is in the overrides list
          var index = self._media.layers.findIndex(function (item) {
            var layerId = operationalLayer.id;

            if (item.layer && item.layer.id) {
              layerId = item.layer.id;
            }

            if (operationalLayer.featureCollection) {
              layerId = operationalLayer.featureCollection.layers[0].id;
            }

            return item.id === layerId;
          });

          // if it's in there, remove it. Otherwise add it.
          if (index !== -1) {
            self._media.layers.splice(index, 1);
          } else {
            var layerId = operationalLayer.id;

            if (operationalLayer.layer && operationalLayer.layer.id) {
              layerId = operationalLayer.layer.id;
            }

            if (operationalLayer.featureCollection) {
              layerId = operationalLayer.featureCollection.layers[0].id;
            }

            self._media.layers.push({
              id: layerId,
              visibility: operationalLayer.visibility
            });
          }

          // let media know about the changes
          _this2.onChange();

          if (self._media.layers.length > 0) {
            layersButton.removeClass(disabledClass);
          } else {
            layersButton.addClass(disabledClass);
          }
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this3 = this;

        if (params.container.parents('.section-immersive').length) {
          this._ignoreNextExtentChangeEvent = true;
        } else {
          this._ignoreNextExtentChangeEvent = !this._isFirstOpening;
        }

        this._isFirstOpening = false;

        _get(TabWebMap.prototype.__proto__ || Object.getPrototypeOf(TabWebMap.prototype), 'postCreate', this).call(this, params);

        if (this.map) {
          this.initLayerList();
        }

        var disabledClass = 'disabled';
        var locationButton = this._node.find('.config-item[data-type="reset"][data-value="location"]');
        var popupButton = this._node.find('.config-item[data-type="reset"][data-value="popup"]');
        var layersButton = this._node.find('.config-item[data-type="reset"][data-value="layers"]');

        if (this._media.popup) {
          popupButton.removeClass(disabledClass);
        }

        locationButton.on('click', function () {
          _this3.detachEvents();
          _this3.setMedia('extent', null);
          _this3._updateLocationReset();
        });

        popupButton.on('click', function () {
          // disable button
          popupButton.addClass(disabledClass);
          _this3.setMedia('popup', null);
        });

        layersButton.on('click', function () {
          // to get the layers to be correctly synced, we will destroy the layerList and rebuild it.
          _this3.layerList.destroy();
          _this3.layerList = null;

          layersButton.addClass(disabledClass);

          _this3._ignoreNextExtentChangeEvent = true;
          _this3.setMedia('layers', []);
        });

        this._updateLocationReset();

        this.attachEvents();

        $(this.map.map.container).addClass('appearance-invite');
      }
    }, {
      key: '_updateLocationReset',
      value: function _updateLocationReset() {
        var locationButton = this._node.find('.config-item[data-type="reset"][data-value="location"]');
        locationButton.toggleClass('disabled', !this._media.extent);
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabWebMap.prototype.__proto__ || Object.getPrototypeOf(TabWebMap.prototype), 'destroy', this).call(this);

        var locationButton = this._node.find('.config-item[data-type="reset"][data-value="location"]');
        locationButton.off('click');

        if (this.layerList) {
          this.layerList.destroy();
          this.layerList = null;
        }

        $(this.map.map.container).removeClass('appearance-invite');
      }
    }, {
      key: 'render',
      value: function render() {
        return (0, _TabWebMap2.default)({
          strings: _app2.default.builder.mediaConfig.appearance
        });
      }
    }, {
      key: 'getSelectedFeatureInfo',
      value: function getSelectedFeatureInfo() {
        var feature = this.map.map.infoWindow.getSelectedFeature();

        if (!feature) {
          return null;
        }

        /*
         * The popup's feature is saved through an attribute and it's value
         * Try to find an object id through type or field name
         * Default to the first Integer field
         */

        // TODO should have an error message if not found

        var layer = feature.getLayer();
        var fields = layer.fields;

        if (!fields) {
          return null;
        }

        var objectIdFields = $.grep(fields, function (field) {
          return field.type === 'esriFieldTypeOID';
        });

        if (layer && fields && !objectIdFields.length) {
          objectIdFields = $.grep(fields, function (field) {
            return field.name === 'OBJECTID' || field.name === 'FID';
          });

          if (!objectIdFields.length) {
            objectIdFields = $.grep(fields, function (field) {
              return field.type === 'esriFieldTypeInteger';
            });
          }
        }

        if (objectIdFields.length) {
          var fieldName = objectIdFields[0].name;
          return {
            layerId: layer.id,
            fieldName: fieldName,
            fieldValue: feature.attributes[fieldName],
            anchorPoint: this.map.map.infoWindow.location.toJson()
          };
        }

        return null;
      }
    }]);

    return TabWebMap;
  }(_TabArcGIS3.default);

  exports.default = TabWebMap;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabWebMap.js.map
;

define('lib-build/less!storymaps-react/tpl/view/media/WebMapBuilder',[],function(){});
define('storymaps-react/tpl/view/media/WebMapBuilder',['module', 'exports', './WebMap', './builder/Panel', './builder/TabSize', './builder/TabManage', './builder/TabWebMap', 'dojo/_base/lang', 'lib-build/less!./WebMapBuilder'], function (module, exports, _WebMap2, _Panel, _TabSize, _TabManage, _TabWebMap, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _WebMap3 = _interopRequireDefault(_WebMap2);

  var _Panel2 = _interopRequireDefault(_Panel);

  var _TabSize2 = _interopRequireDefault(_TabSize);

  var _TabManage2 = _interopRequireDefault(_TabManage);

  var _TabWebMap2 = _interopRequireDefault(_TabWebMap);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var WebMapBuilder = function (_WebMap) {
    _inherits(WebMapBuilder, _WebMap);

    function WebMapBuilder(webmap) {
      _classCallCheck(this, WebMapBuilder);

      var _this = _possibleConstructorReturn(this, (WebMapBuilder.__proto__ || Object.getPrototypeOf(WebMapBuilder)).call(this, webmap));

      _this._configTabWebMap = null;
      _this._isMultiViewSection = false;
      _this._onToggleMediaConfig = null;
      return _this;
    }

    _createClass(WebMapBuilder, [{
      key: 'postCreate',
      value: function postCreate(params) {
        _get(WebMapBuilder.prototype.__proto__ || Object.getPrototypeOf(WebMapBuilder.prototype), 'postCreate', this).call(this, params);

        this._onToggleMediaConfig = params.onToggleMediaConfig;

        if (!params.delayBuilderInit) {
          this._initConfigPanel();
        }

        this.initBuilderUI();

        this._node.find('.media-media').attr('data-builder-invite', 'Update the map to tell your story, click the checkmark to save the changes');
      }
    }, {
      key: 'performAction',
      value: function performAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (params.performBuilderInit) {
          this._initConfigPanel();
        }

        return _get(WebMapBuilder.prototype.__proto__ || Object.getPrototypeOf(WebMapBuilder.prototype), 'performAction', this).call(this, params);
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._node) {
          this._webmap.caption = this._node.find('.block-caption').html();
        }

        return _lang2.default.clone({
          type: 'webmap',
          webmap: this._webmap
        });
      }
    }, {
      key: '_initConfigPanel',
      value: function _initConfigPanel() {
        var tabs = [];

        this._configTabWebMap = new _TabWebMap2.default({
          map: this._cache[this.id],
          layerListNode: this._node.find('.layer-list-container')
        });

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._builderConfigurationTabs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var tab = _step.value;

            if (tab == 'size') {
              tabs.push(new _TabSize2.default());
            } else if (tab == 'appearance') {
              tabs.push(this._configTabWebMap);
            } else if (tab == 'manage') {
              tabs.push(new _TabManage2.default({
                hideRemove: this._placement == 'background',
                mediaType: 'webmap',
                mediaId: this.id
              }));
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        new _Panel2.default({
          containerMedia: this._node,
          tabs: tabs,
          media: this._webmap,
          onChange: this._onConfigChange.bind(this),
          onAction: this._onAction.bind(this),
          onToggle: function () {
            // TODO: this could be in BuilderConfig
            this._node.toggleClass('builder-config-open');
            this._onToggleMediaConfig(this);

            // Reset extent has user may have move the map prior opening
            // User cannot modify any other properties outside of map config
            // TODO: would be good tha tall media have a nice way to implement such pattern
            if (this._node.hasClass('builder-config-open')) {
              this.performAction({
                forceSetExtent: true
              });
            }
          }.bind(this),
          closeBtnStyle: this._placement == 'background' ? 'light' : 'standard'
        });
      }
    }, {
      key: '_onWebMapLoaded',
      value: function _onWebMapLoaded() {
        if (this._configTabWebMap) {
          this._configTabWebMap.setMap(this._cache[this.id]);
        }
      }
    }, {
      key: '_onConfigChange',
      value: function _onConfigChange() {
        this._applyConfig();

        if (!this._webmap.layers || this._webmap.layers.length == 0) {
          this._configTabWebMap.initLayerList();
        }

        _get(WebMapBuilder.prototype.__proto__ || Object.getPrototypeOf(WebMapBuilder.prototype), '_onConfigChange', this).call(this);
      }
    }]);

    return WebMapBuilder;
  }(_WebMap3.default);

  exports.default = WebMapBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=WebMapBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabManageScene', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"swap\">\r\n      <img class=\"edit-media-icon\" src=\"resources/tpl/builder/icons/media-config/edit-media.png\" />\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.changeMedia : stack1), depth0))
    + "\r\n    </div>\r\n    <div class=\"image-preview\">\r\n      <div class=\"overlay\">\r\n        <span class=\"icon\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.edit : stack1), depth0))
    + "</span>\r\n        <span class=\"icon\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.remove : stack1), depth0))
    + "</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"builder-config-section larger\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"edit\">\r\n      <i class=\"config-icon fa fa-external-link\"></i>\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.edit : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n  <span class=\"aside\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.editAside : stack1), depth0))
    + "</span>\r\n</div>\r\n<div class=\"builder-config-section\">\r\n  <div class=\"section-content button\">\r\n    <div class=\"config-item button btn btn-bw\" data-action=\"remove\">\r\n      <i class=\"config-icon fa fa-trash-o\"></i>\r\n      "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.remove : stack1), depth0))
    + "\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabManageScene',['module', 'exports', './Tab', 'lib-build/hbars!./TabManageScene', 'storymaps/common/builder/BuilderHelper', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app'], function (module, exports, _Tab2, _TabManageScene, _BuilderHelper, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabManageScene2 = _interopRequireDefault(_TabManageScene);

  var _BuilderHelper2 = _interopRequireDefault(_BuilderHelper);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabManageScene = function (_Tab) {
    _inherits(TabManageScene, _Tab);

    function TabManageScene() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, TabManageScene);

      var _this = _possibleConstructorReturn(this, (TabManageScene.__proto__ || Object.getPrototypeOf(TabManageScene)).call(this, params));

      _this.title = _app2.default.builder.mediaConfig.tabs.manage;
      _this.type = 'manage';
      _this.icon = 'fa-wrench';

      _this._mediaType = params.mediaType;
      _this._mediaId = params.mediaId;
      return _this;
    }

    _createClass(TabManageScene, [{
      key: 'render',
      value: function render() {
        return (0, _TabManageScene2.default)({
          strings: _app2.default.builder.mediaConfig.manage
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(TabManageScene.prototype.__proto__ || Object.getPrototypeOf(TabManageScene.prototype), 'postCreate', this).call(this, params);

        if (this._options) {
          if (this._options.hideRemove) {
            this._node.find('.config-item[data-action="remove"]').parents('.builder-config-section').hide();
          }
        }

        //
        // Events
        //

        this._node.find('.config-item[data-action="remove"]').on('click', function () {
          _this2._onAction('remove');
        });

        this._node.find('.config-item[data-action="upload-image"]').on('click', function () {
          // TODO: Send action
          console.log('action');
        });

        this._node.find('.config-item[data-action="edit"]').on('click', function () {
          if (!_this2._mediaType || !_this2._mediaId) {
            return;
          }

          if (_this2._mediaType == 'webmap') {
            window.open(_BuilderHelper2.default.getMapViewerLink(_this2._mediaId), '_blank');
          } else if (_this2._mediaType == 'webscene') {
            window.open(_BuilderHelper2.default.getSceneViewerLink(_this2._mediaId), '_blank');
          }
        });

        this._node.find('.config-item[data-action="swap"]').on('click', function () {
          _this2._onAction('swap');
        });
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabManageScene.prototype.__proto__ || Object.getPrototypeOf(TabManageScene.prototype), 'destroy', this).call(this);

        this._node.find('.config-item[data-action="remove"]').off('click');
        this._node.find('.config-item[data-action="upload-image"]').off('click');
        this._node.find('.config-item[data-action="edit"]').off('click');
        this._node.find('.config-item[data-action="swap"]').off('click');
      }
    }]);

    return TabManageScene;
  }(_Tab3.default);

  exports.default = TabManageScene;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabManageScene.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabWebScene', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.slide : stack1), depth0))
    + "</h4>\r\n  <select class=\"section-content\" name=\"slides\"></select>\r\n  <div class=\"section-content no-slides\">\r\n    <span class=\"\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.noSlides : stack1), depth0))
    + "</span>\r\n  </div>\r\n</div>\r\n<div class=\"builder-config-section larger\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interaction : stack1), depth0))
    + "</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"disabled\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionDisabled : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"button\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.buttonToEnable : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"enabled\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionEnabled : stack1), depth0))
    + " <sup style=\"vertical-align: 0;\">*</sup></li>\r\n  </ul>\r\n  <span class=\"aside\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionAside : stack1), depth0))
    + "</span>\r\n</div>\r\n<!--\r\n<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">Pop-Ups</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"popup\" data-value=\"disabled\">Disabled</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"popup\" data-value=\"enabled\">Enabled</li>\r\n  </ul>\r\n</div>\r\n<div class=\"builder-config-section\">\r\n  <h4 class=\"title\">Extras</h4>\r\n  <ul class=\"section-content vertical-list checkmarks\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"extra\" data-value=\"legend\">\r\n      <label class=\"check\"><input type=\"checkbox\" value=\"legend\"> Legend</label>\r\n    </li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"extra\" data-value=\"search\">\r\n      <label class=\"check\"><input type=\"checkbox\" value=\"search\"> Search</label>\r\n    </li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"extra\" data-value=\"locate\">\r\n      <label class=\"check\"><input type=\"checkbox\" value=\"locate\"> Locate</label>\r\n    </li>\r\n  </ul>\r\n</div>\r\n-->\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabWebScene',['module', 'exports', './TabArcGIS', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'lib-build/hbars!./TabWebScene'], function (module, exports, _TabArcGIS2, _app, _TabWebScene) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _TabArcGIS3 = _interopRequireDefault(_TabArcGIS2);

  var _app2 = _interopRequireDefault(_app);

  var _TabWebScene2 = _interopRequireDefault(_TabWebScene);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabWebScene = function (_TabArcGIS) {
    _inherits(TabWebScene, _TabArcGIS);

    function TabWebScene(params) {
      _classCallCheck(this, TabWebScene);

      var _this = _possibleConstructorReturn(this, (TabWebScene.__proto__ || Object.getPrototypeOf(TabWebScene)).call(this));

      _this.scene = params.scene;
      return _this;
    }

    _createClass(TabWebScene, [{
      key: 'setScene',
      value: function setScene(scene) {
        // Contains the Map (scene) and SceneView (view)
        // Called twice during the initialization as the slides are loaded async
        this.scene = scene;

        if (this._node) {
          this.renderSceneSection();
        }
      }
    }, {
      key: 'renderSceneSection',
      value: function renderSceneSection() {
        var _this2 = this;

        var scene = this.scene.scene;
        var slidesDropdown = this._node.find('.section-content[name="slides"]');
        var noSlidesMessage = this._node.find('.section-content.no-slides');

        if (scene.presentation && scene.presentation.slides && scene.presentation.slides.items && scene.presentation.slides.items.length > 0) {
          // hide if there aren't any, otherwise show.
          var slides = scene.presentation.slides.items;

          noSlidesMessage.hide();
          slidesDropdown.show();

          // append options to the dropdown
          // the first one will be the "home view"
          slidesDropdown.append('<option class="config-item" data-type="slides" value="-1">' + _app2.default.builder.mediaConfig.appearance.homeView + '</option>');

          for (var i = 0; i < slides.length; i++) {
            slidesDropdown.append('<option class="config-item" data-type="slides" value="' + i + '">' + slides[i].title.text + '</option>');
          }

          // if there's a selected slide (that's a number greater than or equal to zero), start off with that one selected
          if (this._media.slide >= 0) {
            slidesDropdown.val(this._media.slide);
          }

          // attach events
          slidesDropdown.on('change', function (event) {
            var indexStr = $(event.currentTarget).val();
            var index = parseInt(indexStr, 10);

            if (!isNaN(index)) {
              _this2.setMedia('slide', index);
            }
          });
        } else {
          slidesDropdown.hide();
          noSlidesMessage.show();
        }
      }
    }, {
      key: 'attachEvents',
      value: function attachEvents() {
        // If the panel hasn't been opened yet
        if (!this._media) {
          return;
        }

        // TODO on extent change
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(TabWebScene.prototype.__proto__ || Object.getPrototypeOf(TabWebScene.prototype), 'postCreate', this).call(this, params);

        if (this.scene) {
          this.renderSceneSection();
        }
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabWebScene.prototype.__proto__ || Object.getPrototypeOf(TabWebScene.prototype), 'destroy', this).call(this);
      }
    }, {
      key: 'render',
      value: function render() {
        return (0, _TabWebScene2.default)({
          strings: _app2.default.builder.mediaConfig.appearance
        });
      }
    }]);

    return TabWebScene;
  }(_TabArcGIS3.default);

  exports.default = TabWebScene;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabWebScene.js.map
;
define('storymaps-react/tpl/view/media/WebSceneBuilder',['module', 'exports', './WebScene', './builder/Panel', './builder/TabSize', './builder/TabManageScene', './builder/TabWebScene', 'dojo/_base/lang'], function (module, exports, _WebScene2, _Panel, _TabSize, _TabManageScene, _TabWebScene, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _WebScene3 = _interopRequireDefault(_WebScene2);

  var _Panel2 = _interopRequireDefault(_Panel);

  var _TabSize2 = _interopRequireDefault(_TabSize);

  var _TabManageScene2 = _interopRequireDefault(_TabManageScene);

  var _TabWebScene2 = _interopRequireDefault(_TabWebScene);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var WebSceneBuilder = function (_WebScene) {
    _inherits(WebSceneBuilder, _WebScene);

    function WebSceneBuilder(webscene) {
      _classCallCheck(this, WebSceneBuilder);

      var _this = _possibleConstructorReturn(this, (WebSceneBuilder.__proto__ || Object.getPrototypeOf(WebSceneBuilder)).call(this, webscene));

      _this._configTabWebScene = null;
      _this._onToggleMediaConfig = null;
      return _this;
    }

    _createClass(WebSceneBuilder, [{
      key: 'postCreate',
      value: function postCreate(params) {
        _get(WebSceneBuilder.prototype.__proto__ || Object.getPrototypeOf(WebSceneBuilder.prototype), 'postCreate', this).call(this, params);

        this._onToggleMediaConfig = params.onToggleMediaConfig;

        if (!params.delayBuilderInit) {
          this._initConfigPanel();
        }

        this.initBuilderUI();
      }
    }, {
      key: 'performAction',
      value: function performAction(params) {
        if (params.performBuilderInit) {
          this._initConfigPanel();
        }

        return _get(WebSceneBuilder.prototype.__proto__ || Object.getPrototypeOf(WebSceneBuilder.prototype), 'performAction', this).call(this, params);
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._node) {
          this._webscene.caption = this._node.find('.block-caption').html();
        }

        return _lang2.default.clone({
          type: 'webscene',
          webscene: this._webscene
        });
      }
    }, {
      key: '_initConfigPanel',
      value: function _initConfigPanel() {
        var tabs = [];

        this._configTabWebScene = new _TabWebScene2.default({
          scene: this._cache[this.id]
        });

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._builderConfigurationTabs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var tab = _step.value;

            if (tab == 'size') {
              tabs.push(new _TabSize2.default());
            } else if (tab == 'appearance') {
              tabs.push(this._configTabWebScene);
            } else if (tab == 'manage') {
              tabs.push(new _TabManageScene2.default({
                hideRemove: this._placement == 'background',
                mediaType: 'webscene',
                mediaId: this.id
              }));
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        new _Panel2.default({
          containerMedia: this._node,
          tabs: tabs,
          media: this._webscene,
          onChange: this._onConfigChange.bind(this),
          onAction: this._onAction.bind(this),
          onToggle: function () {
            // TODO: this could be in BuilderConfig
            this._node.toggleClass('builder-config-open');
            this._onToggleMediaConfig(this);
          }.bind(this),
          closeBtnStyle: this._placement == 'background' ? 'light' : 'standard'
        });
      }
    }, {
      key: '_onWebSceneLoaded',
      value: function _onWebSceneLoaded() {
        this._initConfigPanel();
        this._configTabWebScene.setScene(this._cache[this.id]);
      }
    }, {
      key: '_onConfigChange',
      value: function _onConfigChange() {
        console.log('onConfigChange: ', this._webscene);
        this._applyConfig();
        _get(WebSceneBuilder.prototype.__proto__ || Object.getPrototypeOf(WebSceneBuilder.prototype), '_onConfigChange', this).call(this);
      }
    }]);

    return WebSceneBuilder;
  }(_WebScene3.default);

  exports.default = WebSceneBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=WebSceneBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/builder/TabWebPage', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"builder-config-section no-spread\">\r\n  <h4 class=\"title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interaction : stack1), depth0))
    + "</h4>\r\n  <ul class=\"section-content vertical-list\">\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"disabled\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionDisabled : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"button\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.buttonToEnable : stack1), depth0))
    + "</li>\r\n    <li class=\"config-item btn btn-gray\" data-type=\"interaction\" data-value=\"enabled\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionEnabled : stack1), depth0))
    + " <sup style=\"vertical-align: 0;\">*</sup></li>\r\n  </ul>\r\n  <span class=\"aside\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.interactionAside : stack1), depth0))
    + "</span>\r\n</div>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/builder/TabWebPage',['module', 'exports', './Tab', 'lib-build/hbars!./TabWebPage', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app'], function (module, exports, _Tab2, _TabWebPage, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Tab3 = _interopRequireDefault(_Tab2);

  var _TabWebPage2 = _interopRequireDefault(_TabWebPage);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TabWebPage = function (_Tab) {
    _inherits(TabWebPage, _Tab);

    function TabWebPage() {
      _classCallCheck(this, TabWebPage);

      var _this = _possibleConstructorReturn(this, (TabWebPage.__proto__ || Object.getPrototypeOf(TabWebPage)).call(this));

      _this.title = _app2.default.builder.mediaConfig.tabs.appearance;
      _this.type = 'appearance';
      _this.icon = 'fa-sliders';
      return _this;
    }

    _createClass(TabWebPage, [{
      key: 'render',
      value: function render() {
        return (0, _TabWebPage2.default)({
          strings: _app2.default.builder.mediaConfig.appearance
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(TabWebPage.prototype.__proto__ || Object.getPrototypeOf(TabWebPage.prototype), 'postCreate', this).call(this, params);

        this.bindInteraction();
      }
    }, {
      key: 'bindInteraction',
      value: function bindInteraction() {
        var _this2 = this;

        var interactions = this._node.find('.config-item[data-type="interaction"]');
        var selectedInteraction = this._media.options.interaction || 'enabled';

        this._node.find('.config-item[data-type="interaction"][data-value="' + selectedInteraction + '"]').addClass(this.selectedClass);
        interactions.on('click', function (e) {
          var target = $(e.currentTarget);
          var interaction = target.data('value');

          interactions.removeClass(_this2.selectedClass);
          target.addClass(_this2.selectedClass);
          _this2.setConfig('interaction', interaction);
        });
      }
    }, {
      key: 'unbindInteraction',
      value: function unbindInteraction() {
        var interactions = this._node.find('.config-item[data-type="interaction"]');
        interactions.off('click');
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        _get(TabWebPage.prototype.__proto__ || Object.getPrototypeOf(TabWebPage.prototype), 'destroy', this).call(this);

        this.unbindInteraction();
      }
    }]);

    return TabWebPage;
  }(_Tab3.default);

  exports.default = TabWebPage;
  module.exports = exports['default'];
});
//# sourceMappingURL=TabWebPage.js.map
;
define('storymaps-react/tpl/view/media/WebPageBuilder',['module', 'exports', './WebPage', './builder/Panel', './builder/TabSize', './builder/TabManageMedia', './builder/TabWebPage', 'dojo/_base/lang'], function (module, exports, _WebPage2, _Panel, _TabSize, _TabManageMedia, _TabWebPage, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _WebPage3 = _interopRequireDefault(_WebPage2);

  var _Panel2 = _interopRequireDefault(_Panel);

  var _TabSize2 = _interopRequireDefault(_TabSize);

  var _TabManageMedia2 = _interopRequireDefault(_TabManageMedia);

  var _TabWebPage2 = _interopRequireDefault(_TabWebPage);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var WebPageBuilder = function (_WebPage) {
    _inherits(WebPageBuilder, _WebPage);

    function WebPageBuilder() {
      _classCallCheck(this, WebPageBuilder);

      return _possibleConstructorReturn(this, (WebPageBuilder.__proto__ || Object.getPrototypeOf(WebPageBuilder)).apply(this, arguments));
    }

    _createClass(WebPageBuilder, [{
      key: 'postCreate',
      value: function postCreate(params) {
        _get(WebPageBuilder.prototype.__proto__ || Object.getPrototypeOf(WebPageBuilder.prototype), 'postCreate', this).call(this, params);

        var tabs = [];

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._builderConfigurationTabs[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var tab = _step.value;

            if (tab == 'size') {
              tabs.push(new _TabSize2.default());
            } else if (tab == 'appearance') {
              tabs.push(new _TabWebPage2.default());
            } else if (tab == 'manage') {
              tabs.push(new _TabManageMedia2.default({
                hideRemove: this._placement == 'background'
              }));
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        new _Panel2.default({
          containerMedia: this._node,
          tabs: tabs,
          media: this._webpage,
          onChange: this._onConfigChange.bind(this),
          onAction: this._onAction.bind(this),
          onToggle: function () {
            // TODO: this could be in BuilderConfig
            this._node.toggleClass('builder-config-open');
            params.onToggleMediaConfig(this);
          }.bind(this),
          closeBtnStyle: this._placement == 'background' ? 'light' : 'standard'
        });

        this.initBuilderUI();
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._node) {
          this._webpage.caption = this._node.find('.block-caption').html();
        }

        return _lang2.default.clone({
          type: 'webpage',
          webpage: this._webpage
        });
      }
    }, {
      key: '_onConfigChange',
      value: function _onConfigChange() {
        console.log('onConfigChange: ', this._webpage);
        this._applyConfig();
        _get(WebPageBuilder.prototype.__proto__ || Object.getPrototypeOf(WebPageBuilder.prototype), '_onConfigChange', this).call(this);
      }
    }]);

    return WebPageBuilder;
  }(_WebPage3.default);

  exports.default = WebPageBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=WebPageBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/media/CreditsItemBuilder', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  return " cr-empty";
  },"3":function(depth0,helpers,partials,data) {
  return " cr-incomplete";
  },"5":function(depth0,helpers,partials,data) {
  return " cr-link";
  },"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "<li class=\"cr-item builder";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.empty : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.incomplete : depth0), {"name":"if","hash":{},"fn":this.program(3, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\">\r\n  <div class=\"cr-item-main\">\r\n    <div class=\"cr-input-container first\">\r\n      <div class=\"cr-validation-warning cr-hidden\">\r\n        "
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.text : depth0)) != null ? stack1.warning : stack1), depth0))
    + "\r\n      </div>\r\n      <div class=\"cr-item-input cr-content\" contenteditable=\"true\" placeholder=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.text : depth0)) != null ? stack1.content : stack1), depth0))
    + "\">"
    + escapeExpression(((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper)))
    + "</div>\r\n    </div>\r\n    <span class=\"cr-pipe\"></span>\r\n    <div class=\"cr-input-container\">\r\n      <div class=\"cr-item-input cr-source";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.link : depth0), {"name":"if","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\" contenteditable=\"true\" placeholder=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.text : depth0)) != null ? stack1.source : stack1), depth0))
    + "\" data-toggle=\"popover\" data-link=\""
    + escapeExpression(((helper = (helper = helpers.link || (depth0 != null ? depth0.link : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"link","hash":{},"data":data}) : helper)))
    + "\">"
    + escapeExpression(((helper = (helper = helpers.source || (depth0 != null ? depth0.source : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"source","hash":{},"data":data}) : helper)))
    + "</div>\r\n      <div class=\"cr-item-remove cr-hidden\">\r\n        <i class=\"cr-remove-icon fa fa-trash\"></i>\r\n      </div>\r\n  </div>\r\n  <div class=\"cr-builder-ui cr-hidden\">\r\n    <div class=\"cr-add-line\">\r\n      <div class=\"cr-add-button cr-hidden\">\r\n        <i class=\"cr-add-icon fa fa-plus\"></i>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</li>\r\n";
},"useData":true}); });

define('storymaps-react/tpl/view/media/CreditsBuilder',['module', 'exports', './Credits', 'storymaps/common/utils/CommonHelper', 'lib-build/hbars!./CreditsItemBuilder', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'dojo/_base/lang'], function (module, exports, _Credits2, _CommonHelper, _CreditsItemBuilder, _app, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Credits3 = _interopRequireDefault(_Credits2);

  var _CommonHelper2 = _interopRequireDefault(_CommonHelper);

  var _CreditsItemBuilder2 = _interopRequireDefault(_CreditsItemBuilder);

  var _app2 = _interopRequireDefault(_app);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var CreditsBuilder = function (_Credits) {
    _inherits(CreditsBuilder, _Credits);

    function CreditsBuilder(credits) {
      _classCallCheck(this, CreditsBuilder);

      return _possibleConstructorReturn(this, (CreditsBuilder.__proto__ || Object.getPrototypeOf(CreditsBuilder)).call(this, credits));
    }

    _createClass(CreditsBuilder, [{
      key: 'render',
      value: function render(context) {
        if (!this._credits || !context) {
          console.log('Could not render credits block in section');
          return '';
        }

        var markup = '<div id="' + this._domID + '" class="block block-type-credits" contenteditable="false"><ul class="cr-list">';

        if (this._credits.length) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = this._credits[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var credit = _step.value;

              markup += (0, _CreditsItemBuilder2.default)({
                label: credit.label,
                link: credit.link,
                source: credit.source,
                text: _app2.default.builder.credits,
                empty: false,
                incomplete: false
              });
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        } else {
          markup += (0, _CreditsItemBuilder2.default)({
            label: null,
            link: null,
            source: null,
            text: _app2.default.builder.credits,
            empty: true,
            incomplete: true
          });
        }

        markup += '</ul></div>';

        return markup;
      }
    }, {
      key: 'addPopoverEvents',
      value: function addPopoverEvents(element) {
        element.find('.cr-item-input[data-toggle="popover"]').popover({
          html: true,
          // don't use arrow function because it messes up the "this" that bootstrap uses
          content: function content() {
            var link = $(this).data('link');
            return '<div class="form-group form-group-sm"><input type="text" class="credit-link" placeholder="' + _app2.default.builder.credits.linkPrompt + '" value="' + link + '"></div>';
          },
          trigger: 'manual',
          placement: 'top'
        });

        element.find('.cr-item-input[data-toggle="popover"]').focus(function (event) {
          var target = $(event.currentTarget);

          // show the popover if it's not already shown
          if (!target.data('bs.popover').$tip) {
            target.popover('show');
          } else if (!target.data('bs.popover').$tip.hasClass('in')) {
            target.popover('show');
          }
        });

        element.find('.cr-item-input[data-toggle="popover"]').blur(function (event) {
          var target = $(event.currentTarget);

          setTimeout(function () {
            // see if the input in the popover is focused, if not, dismiss
            var popover = target.data('bs.popover');
            if (popover.$tip && !popover.$tip.find('.credit-link').is(':focus')) {
              target.popover('hide');
            }
          }, 50);
        });

        var self = this;
        element.find('.cr-item-input[data-toggle="popover"]').on('shown.bs.popover', function () {
          var trigger = $(this);
          var popover = $(this).data('bs.popover');

          popover.$tip && popover.$tip.find('.credit-link').blur(function () {
            // see if the input is now focused on. If not, hide it.
            setTimeout(function () {
              if (!trigger.is(':focus')) {
                trigger.popover('hide');
              }
            }, 50);
            self.validate(element, trigger);
          });

          popover.$tip && popover.$tip.find('.credit-link').on('paste', function (event) {
            var target = $(event.currentTarget);
            setTimeout(function () {
              var text = self.sanitizeText(target[0].value);

              target[0].value = text;
            }, 0);
          });
        });

        // we need to persist the value of the input field, so when it's hiding, read the value and write it to the triggering element.
        element.find('.cr-item-input[data-toggle="popover"]').on('hide.bs.popover', function () {
          var popover = $(this).data('bs.popover');

          if (popover.$tip) {
            var value = popover.$tip.find('.credit-link').val();
            // set it back to the data-link that we are using to create the popover
            var trimmedValue = value.trim();
            // add/remove link-like styling if there is or isn't a link here
            if (!trimmedValue) {
              $(this).removeClass('cr-link');
            } else {
              $(this).addClass('cr-link');
            }

            var urlTrimmedValue = _CommonHelper2.default.prependURLHTTP(trimmedValue);
            $(this).data('link', urlTrimmedValue);
          }
        });
      }
    }, {
      key: 'showValidationError',
      value: function showValidationError(element) {
        element.find('.cr-item-input').addClass('cr-error');
        element.find('.cr-validation-warning').removeClass('cr-hidden');
      }
    }, {
      key: 'hideValidationError',
      value: function hideValidationError(element) {
        element.find('.cr-item-input').removeClass('cr-error');
        element.find('.cr-validation-warning').addClass('cr-hidden');
      }
    }, {
      key: 'addEvents',
      value: function addEvents(element) {
        var _this2 = this;

        this.addPopoverEvents(element);
        // builder stuff
        element.find('.cr-builder-ui').hover(function (event) {
          var target = $(event.currentTarget);

          target.removeClass('cr-hidden');
          target.find('.cr-add-button').removeClass('cr-hidden');
        }, function (event) {
          var target = $(event.currentTarget);
          target.addClass('cr-hidden');
          target.find('.cr-add-button').addClass('cr-hidden');
        });

        element.find('.cr-item-main').hover(function (event) {
          var target = $(event.currentTarget);
          var parent = target.closest('.cr-item');
          var numCreditsNodes = _this2._node.find('.cr-item').length;

          // if there is more than one credit OR there's only one but it's not empty, allow for removing it.
          if (!parent.hasClass('cr-empty') || numCreditsNodes > 1) {
            target.find('.cr-item-remove').removeClass('cr-hidden');
          }
        }, function (event) {
          var target = $(event.currentTarget);

          target.find('.cr-item-remove').addClass('cr-hidden');
        });

        element.find('.cr-add-button').on('click', function (event) {
          var target = $(event.currentTarget);
          var itemContainer = target.closest('.cr-item');
          // insert it after this item.
          itemContainer.after(_this2.renderEmptyCredit());
          // and then add its events
          _this2.addEvents(itemContainer.next('.cr-item'));
        });

        element.find('.cr-item-remove').on('click', function (event) {
          var target = $(event.currentTarget);
          var itemContainer = target.closest('.cr-item');

          // destroy the attached popover, and remove the element from the DOM
          itemContainer.find('.cr-item-input[data-toggle="popover"]').popover('destroy');
          itemContainer.remove();

          // see how many items there are now. If none, then add an empty one in its place.
          var numCredits = _this2._node.find('.cr-item').length;
          if (numCredits === 0) {
            var newCredit = _this2.renderEmptyCredit();
            var creditsListNode = _this2._node.find('.cr-list');
            creditsListNode.append(newCredit);
            // and add an event to it (it is the "last" child there -- should be the only child there)
            _this2.addEvents(creditsListNode.children(':last'));
          }
        });

        element.find('.cr-item-input').on('keyup', function (event) {
          var parent = $(event.currentTarget).closest('.cr-item');
          var contentInputValue = parent.find('.cr-item-input.cr-content')[0];
          var sourceInputValue = parent.find('.cr-item-input.cr-source')[0];

          if (contentInputValue && sourceInputValue) {
            var contentText = contentInputValue.textContent;
            var sourceText = sourceInputValue.textContent;

            // if EITHER input is non-empty, take off the empty tag.
            if (contentText.length > 0 || sourceText.length > 0) {
              parent.removeClass('cr-empty');
            } else {
              parent.addClass('cr-empty');
            }

            // if BOTH inputs are non-empty, we deem the element complete.
            if (contentText.length > 0 && sourceText.length > 0) {
              parent.removeClass('cr-incomplete');
              _this2.hideValidationError(parent);
            }
            // if they're BOTH empty, we'll remove the errors.
            else if (contentText.length === 0 && sourceText.length === 0) {
                _this2.hideValidationError(parent);
              } else {
                parent.addClass('cr-incomplete');
              }
          }
        });

        // if hit enter on a filled-out row, put in a new credit row beneath it.
        element.find('.cr-item-input').on('keydown', function (event) {
          if (event.keyCode === 13) {
            var parent = $(event.currentTarget).closest('.cr-item');

            if (!parent.hasClass('cr-incomplete')) {
              parent.after(_this2.renderEmptyCredit());
              // and then add its events
              _this2.addEvents(parent.next('.cr-item'));
            }
            // but don't allow enter to make a newline in the credits.
            event.preventDefault();
          }

          // Prevent ctrl + B/I/U or ctrl + b/i/u
          if (event.ctrlKey || event.metaKey) {
            var key = event.keyCode;
            if (key == 66 || key == 98 || key == 73 || key == 105 || key == 85 || key == 117) {
              return false;
            }
          }
        });

        element.find('.cr-item-input').on('paste', function (event) {
          var target = $(event.currentTarget);
          setTimeout(function () {
            var text = _this2.sanitizeText(target[0].textContent);

            target[0].innerHTML = text;
          }, 0);
        });

        element.find('.cr-item-input').blur(function (event) {
          var target = $(event.currentTarget);

          _this2.validate(element, target);
        });
      }
    }, {
      key: 'validate',
      value: function validate(element, target) {
        var _this3 = this;

        setTimeout(function () {
          var item = target.closest('.cr-item');
          // if the text inputs are in focus
          var inputsInFocus = element.find('.cr-item-input').is(':focus');
          // if the popover in focus
          var popoverInFocus = element.find('.popover .credit-link').is(':focus');
          // if the item is partially filled out (but not empty)
          var dirty = item.hasClass('cr-incomplete') && !item.hasClass('cr-empty');
          // if none of the editing fields are in focus and the item is partially filled out, show the error.
          if (!inputsInFocus && !popoverInFocus && dirty) {
            _this3.showValidationError(item);
          } else {
            _this3.hideValidationError(item);
          }
        }, 50);
      }
    }, {
      key: 'renderEmptyCredit',
      value: function renderEmptyCredit() {
        return (0, _CreditsItemBuilder2.default)({
          label: '',
          link: '',
          source: '',
          text: _app2.default.builder.credits,
          empty: true,
          incomplete: true
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(CreditsBuilder.prototype.__proto__ || Object.getPrototypeOf(CreditsBuilder.prototype), 'postCreate', this).call(this, params);

        this.addEvents(this._node.find('.cr-item'));
      }
    }, {
      key: 'sanitizeText',
      value: function sanitizeText(rawValue) {
        var sanitizedText = $('<div>' + rawValue + '</div>').text();

        return sanitizedText;
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        // clear the credits list
        this._credits = [];

        // get all the non-empty credit items
        var creditNodes = this._node.find('.cr-item:not(.cr-empty)');

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = creditNodes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var node = _step2.value;

            var $node = $(node);
            // sanitize each input
            var sanitizedLabel = this.sanitizeText($node.find('.cr-item-input.cr-content').text());
            var sanitizedSource = this.sanitizeText($node.find('.cr-item-input.cr-source').text());
            var sanitizedLink = this.sanitizeText($node.find('.cr-item-input.cr-source').data('link'));

            var credit = {
              label: sanitizedLabel,
              source: sanitizedSource,
              link: sanitizedLink
            };

            this._credits.push(credit);
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        return _lang2.default.clone({
          type: 'credits',
          credits: this._credits
        });
      }
    }]);

    return CreditsBuilder;
  }(_Credits3.default);

  exports.default = CreditsBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=CreditsBuilder.js.map
;
define('storymaps-react/tpl/view/media/FactoryBuilder',['module', 'exports', './FactoryViewer', './Text', './ImageBuilder', './ImageGalleryBuilder', './VideoBuilder', './WebMapBuilder', './WebSceneBuilder', './WebPageBuilder', './Empty', './Color', './CreditsBuilder', 'storymaps/tpl/view/media/Discover'], function (module, exports, _FactoryViewer2, _Text, _ImageBuilder, _ImageGalleryBuilder, _VideoBuilder, _WebMapBuilder, _WebSceneBuilder, _WebPageBuilder, _Empty, _Color, _CreditsBuilder, _Discover) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _FactoryViewer3 = _interopRequireDefault(_FactoryViewer2);

  var _Text2 = _interopRequireDefault(_Text);

  var _ImageBuilder2 = _interopRequireDefault(_ImageBuilder);

  var _ImageGalleryBuilder2 = _interopRequireDefault(_ImageGalleryBuilder);

  var _VideoBuilder2 = _interopRequireDefault(_VideoBuilder);

  var _WebMapBuilder2 = _interopRequireDefault(_WebMapBuilder);

  var _WebSceneBuilder2 = _interopRequireDefault(_WebSceneBuilder);

  var _WebPageBuilder2 = _interopRequireDefault(_WebPageBuilder);

  var _Empty2 = _interopRequireDefault(_Empty);

  var _Color2 = _interopRequireDefault(_Color);

  var _CreditsBuilder2 = _interopRequireDefault(_CreditsBuilder);

  var _Discover2 = _interopRequireDefault(_Discover);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var FactoryBuilder = function (_FactoryViewer) {
    _inherits(FactoryBuilder, _FactoryViewer);

    function FactoryBuilder() {
      _classCallCheck(this, FactoryBuilder);

      return _possibleConstructorReturn(this, (FactoryBuilder.__proto__ || Object.getPrototypeOf(FactoryBuilder)).apply(this, arguments));
    }

    _createClass(FactoryBuilder, null, [{
      key: 'getClasses',
      value: function getClasses() {
        return {
          Text: _Text2.default,

          Image: _ImageBuilder2.default,
          ImageGallery: _ImageGalleryBuilder2.default,
          Video: _VideoBuilder2.default,
          WebMap: _WebMapBuilder2.default,
          WebScene: _WebSceneBuilder2.default,
          WebPage: _WebPageBuilder2.default,

          Empty: _Empty2.default,

          Color: _Color2.default,
          Credits: _CreditsBuilder2.default,
          Discover: _Discover2.default
        };
      }
    }]);

    return FactoryBuilder;
  }(_FactoryViewer3.default);

  exports.default = FactoryBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=FactoryBuilder.js.map
;

define('lib-build/less!storymaps/tpl/view/section/Common',[],function(){});
define('storymaps/tpl/view/section/Common',[
  '../../utils/UI',
  'lib-build/less!./Common'
],
function(
  UIUtils
) {

  /*
  function resizeSnapSection2(sectionIndex, sectionTop)
  {
    var posY = sectionTop.toString().slice(-2),
        sectionPos = sectionIndex + 1;

      console.log(sectionIndex, sectionTop, posY);

    if (posY > 50) {
      posY -= 50;
    }

    posY -= 33;

    if (posY < 0) {
      posY = 0;
    }

    // TODO: should use an ID for builder
    UIUtils.addCSSRule(
      '.section:nth-child(' + sectionPos + ').active .background { top: ' + posY + 'px; }',
      'section-bg-' + sectionPos
    );

    // TODO
    if ($(this).hasClass('section-layout-snap-click-action')) {
      UIUtils.addCSSRule(
        '.section:nth-child(' + sectionPos + ').active .foreground { top: ' + posY + 'px; }',
        'section-fg-' + sectionPos
      );
    }
  }
  */

  /*
  function resizeSnapSection(sectionNode)
  {
    var sectionIndex = sectionNode.index() + 1,
        posY = parseInt(sectionNode.position().top).toString().slice(-2);

    console.log(sectionIndex, sectionNode.position().top, posY);

    if (posY > 50) {
      posY -= 50;
    }

    posY -= 37;

    if (posY < 0) {
      posY = 0;
    }

    UIUtils.addCSSRule(
      '.section:nth-child(' + sectionIndex + ').active .background { top: ' + posY + 'px; }',
      'section-bg-' + sectionIndex
    );

    // TODO
    if ($(this).hasClass('section-layout-snap-click-action')) {
      UIUtils.addCSSRule(
        '.section:nth-child(' + sectionIndex + ').active .foreground { top: ' + posY + 'px; }',
        'section-fg-' + sectionIndex
      );
    }
  }
  */

  return {
    initMedia: function(media, mediaCache) {
      return app.ui.MediaFactory.createInstance(media, mediaCache);
    },
    checkErrors: function(config, section, index) {
      var hasError = false;

      //
      // TODO for the prototype, would be best if the message was displayed on screen
      //  instead of in the console
      //

      // cover, sequence, snap-caption, credits
      if (section.background && section.foreground) {
        if (config.backgroundMedia.indexOf(section.background.type) < 0) {
          console.error('Section ', index, ' is using invalid background');
          hasError = true;
        }

        if (section.foreground.layout) {
          if (! config.foregroundLayout || ! config.foregroundLayout.length || config.foregroundLayout.indexOf(section.foreground.layout) < 0) {
            console.error('Section ', index, ' is using invalid foreground');
            hasError = true;
          }
        }
      }
      // Other snap
      else if (section.views) {
        $.each(section.views, function(i, view) {
          if (config.backgroundMedia.indexOf(view.background.type) < 0) {
            console.error('Section ', index, ' - view ' + i + 'is using invalid background');
            hasError = true;
          }
        });
      }
      else {
        console.error('Section ', index, ' is not using a proper background/foreground configuration');
      }

      if (hasError) {
        console.error('Section', index, ' ignored');
        return;
      }
    },
    renderBlocks: function(blocksJSON) {
      var resMarkup = '',
          lastBlockType = null,
          blocks = [],
          block = null,
          style = '';

      $.each(blocksJSON, function(i, blockJSON) {
        block = app.ui.MediaFactory.createInstance(blockJSON);
        style = blockJSON[blockJSON.type].style || [];

        if (! block) {
          return;
        }

        if (! lastBlockType || lastBlockType != 'text') {
          style.push('first-letter-huge');
        }

        resMarkup += block.render({
          placement: 'block',
          style: style
        });

        lastBlockType = blockJSON.type;

        blocks.push(block);
      });

      return {
        output: resMarkup,
        blocks: blocks
      };
    },

    createBlock: function(media) {
      var block = app.ui.MediaFactory.createInstance(media);
      return block;
    },

    // TODO: should renderBackground also init the media?
    renderBackground: function(params) {
      var output = '';

      params = params || {};

      if (! params.media) {
        return output;
      }

      // from now alternate is only for mobile
      if (UIUtils.isMobileBrowser() && params.media.getAlternate && params.media.getAlternate()) {
        params.media = params.media.getAlternate();
      }

      if (! params.noBackgroundTag) {
        var bgOptions = ' ' + (params.media.options || '');

        var optClass = [];
        if (params.transition) {
          optClass.push(' transition-' + params.transition);
        }

        output += '<div class="background background-type-' + params.media.type + ' ' + optClass.join(' ') + '" style="' + bgOptions + '">';
      }

      output += params.media.render({
        placement: 'background'
      });

      if (! params.noBackgroundTag) {
        output += '</div>';
      }

      return output;
    },

    getMediaIndexes: function(medias, mediaSearched, fromObject) {
      if (! medias || ! medias.length || ! mediaSearched) {
        return -1;
      }

      var mediaSearchedType = mediaSearched.type,
          mediaSearchedInfos = null;

      if (fromObject) {
        mediaSearchedInfos = mediaSearched;
      }
      else {
        mediaSearchedInfos = mediaSearched[mediaSearchedType];
      }

      var foundMediaIndexes = [];

      $.each(medias, function(index, media) {
        if (media.type == mediaSearchedType) {
          /*
           * There is no test for image: they are always duplicated
           */
          if (media.type == 'webmap' || media.type == 'webscene') {
            if (media.id == mediaSearchedInfos.id) {
              foundMediaIndexes.push(index);
            }
          }
          else if (media.type == 'webpage') {
            if (media.id == mediaSearchedInfos.url) {
              foundMediaIndexes.push(index);
            }
          }
          else if (media.type == 'video') {
            if (media.id == mediaSearchedInfos.source + '-' + mediaSearchedInfos.id) {
              foundMediaIndexes.push(index);
            }
          }
          else if (media.type == 'image') {
            if (media.id == mediaSearchedInfos.id) {
              foundMediaIndexes.push(index);
            }
          }
        }
      });

      return foundMediaIndexes;
    },

    //resizeSnapSection2: resizeSnapSection2,
    resize: function() {
      /*
       * Set the correct snapping position for Snap section
       */
      // TODO snap baseclass
      /*$('.section-immersive').each(function() {
        resizeSnapSection($(this));
      });*/

      /*
      $('.section-immersive .background-type-image').each(function(i, screen) {
        var bgCaption = $(this).find('.background .caption');

        if (bgCaption.length) {
          bgCaption.css('top', app.display.sectionHeight - 200);
        }
      });
      */

      /*
      UIUtils.addCSSRule(
        // - 100 to make sure in all scroll condition, all the image would be visible
        '.image.block.size-small { max-height: ' + (app.display.sectionHeight - 100) + 'px; }',
        'image-block'
      );
      */
    },

    applyAppearance: function(section, rootNode) {
      let foregroundOptions = section.foreground.options;

      if (!foregroundOptions) {
        return;
      }

      let titleStyle = foregroundOptions.titleStyle;

      if (titleStyle) {
        let titleNode = rootNode.find('.title-text');
        let textBackground = rootNode.find('.text-background');

        if (titleStyle.background) {
          if (titleStyle.background === 'light') {
            textBackground.addClass('background-light');
            textBackground.removeClass('background-dark');
          }
          else {
            textBackground.addClass('background-dark');
            textBackground.removeClass('background-light');
          }
        }
        else {
          textBackground.removeClass('background-dark');
          textBackground.removeClass('background-light');
        }

        if (titleStyle.text) {
          if (titleStyle.text === 'light') {
            titleNode.addClass('text-light');
            titleNode.removeClass('text-dark');
          }
          else {
            titleNode.addClass('text-dark');
            titleNode.removeClass('text-light');
          }
        }

        if (titleStyle.shadow) {
          titleNode.addClass('text-shadow');
        }
        else {
          titleNode.removeClass('text-shadow');
        }
      }
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverCommonEffects',[], function() {

  var TEMP_OFFSET = 900;

  function scaleFadeInCover(params) {
    var foregroundNode = params.$currentSection.find('.foreground'),
        background = params.$currentSection.find('.background');

    setTimeout(function() {
      background.addClass('scale-out');
    }, TEMP_OFFSET);

    setTimeout(function() {
      background.css('transform', 'scale(1)');
      background.css('opacity', 1);
      background.removeClass('scale-out');
    }, TEMP_OFFSET + 1500);

    setTimeout(function() {
      foregroundNode.addClass('slide-text');
    }, TEMP_OFFSET + 200);

    setTimeout(function() {
      foregroundNode.css('transform', 'translateY(0)');
      foregroundNode.css('opacity', 1);
      foregroundNode.removeClass('slide-text');
    }, TEMP_OFFSET + 1700);
  }

  function fadeInBackground(params) {
    var background = params.$currentSection.find('.background');

    setTimeout(function() {
      background.addClass('fade-in-background');
    }, TEMP_OFFSET);

    setTimeout(function() {
      params.$currentSection.find('.cover-title').addClass('fade-in-cover-title');
    }, TEMP_OFFSET + 500);

    setTimeout(function() {
      params.$currentSection.find('.cover-subtitle').addClass('fade-in-cover-subtitle');
    }, TEMP_OFFSET + 1200);

    setTimeout(function() {
      params.$currentSection.find('.cover-title').css('opacity', 1);
    }, TEMP_OFFSET + 2500);

    setTimeout(function() {
      params.$currentSection.find('.cover-subtitle').css('opacity', 1);
    }, TEMP_OFFSET + 3000);

  }

  function fadeOutForeground(params, smallSection) {
    var numViewports = params.$currentSection.data('views'),
        sectionHeight = numViewports * app.display.windowHeight,
        scrollRatio = params.currentSectionScroll / sectionHeight,
        exponent = smallSection ? 1.5 : 2.5,
        // we want to fade the foreground out faster than the background so the title/subtitle/etc don't visually conflict with the upcoming section
        opacity = Math.pow(1 - scrollRatio, exponent);

    params.$currentSection.find('.foreground, .scroll-invite').css('opacity', opacity);
  }

  function translateForeground(params, slow) {
    var translateFactor = slow ? -1 : -5,
        foregroundNode = params.$currentSection.find('.foreground'),
        amtToScroll = (params.currentSectionScroll / 100) * translateFactor;

    amtToScroll = parseInt(amtToScroll, 10);

    foregroundNode.css('transform', 'translateY(' + amtToScroll + 'px)');
  }

  function translateForegroundDown(params) {
    var numViewports = params.$currentSection.data('views'),
        sectionHeight = numViewports * app.display.windowHeight,
        // how far down the cover we have scrolled
        scrollCoverRatio = params.currentSectionScroll / sectionHeight,
        translateFactor = 1 - scrollCoverRatio,
        amtToScroll = params.currentSectionScroll * translateFactor,
        scrollSubtitle = (params.currentSectionScroll - 100) / sectionHeight,
        translateSubtitle = (1 - scrollSubtitle) * params.currentSectionScroll;

    amtToScroll = parseInt(amtToScroll, 10);
    translateSubtitle = parseInt(translateSubtitle, 10);

    params.$currentSection.find('.cover-title').css('transform', 'translateY(' + amtToScroll + 'px)');
    params.$currentSection.find('.cover-subtitle').css('transform', 'translateY(' + translateSubtitle + 'px)');
  }

  function blurBackground(params, shortSection) {
    var background = params.$currentSection.find('.background'),
        numViewports = params.$currentSection.data('views'),
        sectionHeight = numViewports * app.display.windowHeight,
        amtToBlur = 0,
        blurFactor = shortSection ? 6 : 10;

    // make a ratio of how much to blur, based on how far the section is scrolled compared to how tall it is.
    if (sectionHeight > 0) {
      amtToBlur = (params.currentSectionScroll / sectionHeight) * blurFactor;
    }

    // blur the image.
    background.css({
      webkitFilter: 'blur(' + amtToBlur + 'px)',
      filter: 'blur(' + amtToBlur + 'px)'
    });
  }

  function scaleBackground(params, scaleMore, foregroundAlso) {
    var background = params.$currentSection.find('.background'),
        amtToScale = 1,
        topRatio = 0,
        scaleDividend = scaleMore ? 4 : 20,
        foreground = params.$currentSection.find('.foreground');

    if (params.currentSectionScroll > 0) {
      // how far down the page the cover has been scrolled
      topRatio = params.currentSectionScroll / app.display.windowHeight;
      // take this ratio and normalize it so we're not scaling too far in.
      amtToScale = 1 + (topRatio / scaleDividend);
    }
    background.css('transform', 'scale(' + amtToScale + ')');

    // if we want everything to scale, we can scale the foreground as well.
    if (foregroundAlso) {
      foreground.css('transform', 'scale(' + amtToScale + ')');
    }
  }

  function blendCoverWithHeader(params) {
    var wrapper = params.$currentSection.find('.wrapper'),
        opacity = 1;

    if (params.currentSectionScroll > 0) {
      // the opacity is how far down the cover has scrolled. If it's scrolled 9/10 of the way down the page, it'll only be 1/10 opaque.
      opacity = 1 - params.currentSectionScroll / app.display.windowHeight;
    }

    wrapper.css('opacity', opacity);
  }

  function darkenCover(params, partialPage) {
    var numViewports = params.$currentSection.data('views'),
        sectionHeight = numViewports * app.display.windowHeight,
        wrapper = params.$currentSection.find('.wrapper'),
        maxBrightnessValue = 100,
        brightness = maxBrightnessValue,
        cssValue = '';

    if (params.currentSectionScroll > 0) {
      if (partialPage) {
        // if the page isn't the full height
        // make it a percentage of how far the person has scrolled through the section
        brightness = (1 - params.currentSectionScroll / sectionHeight) * 100;
      }
      else {
        // brightness is a percentage of how much of the viewport is showing the cover. If most of the window shows the cover it will be lighter, if less is showing, darker.
        brightness = ((sectionHeight - params.currentSectionScroll) / app.display.windowHeight) * 100;
      }

      if (brightness > maxBrightnessValue) {
        brightness = maxBrightnessValue;
      }
    }

    cssValue = 'brightness(' + brightness.toFixed(1) + '%)';
    wrapper.css({
      webkitFilter: cssValue,
      filter: cssValue
    });
  }

  function fadeOutCover(params) {
    var background = params.$currentSection.find('.background'),
        numViewports = params.$currentSection.data('views'),
        sectionHeight = numViewports * app.display.windowHeight,
        // the point at which to start fading -- when .1 of the section has scrolled, start fading. This allows us to show the cover as unfaded for a bit before starting.
        fadePoint = 0.1,
        // when the next section takes up 7/10 of the viewport, we'll want the cover to be completely faded.
        coverFadedCompletelyPoint = 0.7,
        readyToFade = params.currentSectionScroll >= sectionHeight * fadePoint,
        opacityValue = 1;

    if (readyToFade) {
      // is a differential between the amount scorlled and the ratio.
      opacityValue = 1 - (params.currentSectionScroll - sectionHeight * fadePoint) / (sectionHeight * (1 - fadePoint) * coverFadedCompletelyPoint);
    }

    background.css('opacity', opacityValue);
  }

  return {
    scaleFadeInCover: scaleFadeInCover,
    fadeInBackground: fadeInBackground,
    fadeOutForeground: fadeOutForeground,
    translateForeground: translateForeground,
    translateForegroundDown: translateForegroundDown,
    blurBackground: blurBackground,
    scaleBackground: scaleBackground,
    blendCoverWithHeader: blendCoverWithHeader,
    darkenCover: darkenCover,
    fadeOutCover: fadeOutCover
  };
});

define('storymaps/tpl/view/section/Cover/CoverStatic',[
  './CoverCommonEffects'
], function(
  //CoverCommonEffects
) {
  return function ScaleCover() {
    this.dataViews = 1;
    this.layoutType = 'static';

    this.displayCover = function() {
      //
    };

    this.onScroll = function() {
      //
    };
  };
});

define('storymaps/tpl/view/section/Cover/CoverScale',[
  './CoverCommonEffects'
], function(
  CoverCommonEffects
) {
  return function ScaleCover() {
    this.dataViews = 1.25;
    this.layoutType = 'scale';

    this.displayCover = function(params) {
      CoverCommonEffects.scaleFadeInCover(params);
    };

    this.onScroll = function(params) {
      updateBackground(params);
      updateForeground(params);
    };

    function updateBackground(params) {
      CoverCommonEffects.scaleBackground(params, false);
      CoverCommonEffects.fadeOutCover(params);
    }

    function updateForeground(params) {
      CoverCommonEffects.translateForeground(params, true);
      CoverCommonEffects.fadeOutForeground(params);
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverBlur',[
  './CoverCommonEffects'
], function(
  CoverCommonEffects
) {
  return function BlurCover() {
    this.dataViews = 1.5;
    this.layoutType = 'blur';

    this.displayCover = function(params) {
      CoverCommonEffects.scaleFadeInCover(params);
    };

    this.onScroll = function(params) {
      updateBackground(params);
      updateForeground(params);
    };

    function updateBackground(params) {
      CoverCommonEffects.blurBackground(params, false);
    }

    function updateForeground(params) {
      CoverCommonEffects.fadeOutForeground(params);
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverPartialPage',[
  './CoverCommonEffects'
], function(
  CoverCommonEffects
) {
  return function BlurCover() {
    this.dataViews = 0.7;
    this.layoutType = 'partial-page';

    this.displayCover = function() {
      //
    };

    this.onScroll = function(params) {
      updateBackground(params);
      updateForeground(params);
    };

    function updateBackground(params) {
      CoverCommonEffects.blurBackground(params, true);
      CoverCommonEffects.darkenCover(params, true);
    }

    function updateForeground(params) {
      CoverCommonEffects.translateForeground(params, false);
      CoverCommonEffects.fadeOutForeground(params, true);
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverDelay',[
  './CoverCommonEffects'
], function(
  CoverCommonEffects
) {
  return function DelayCover() {
    this.dataViews = 1.5;
    this.layoutType = 'delay';

    this.displayCover = function(params) {
      CoverCommonEffects.fadeInBackground(params);
    };

    this.onScroll = function(params) {
      updateBackground(params);
      updateForeground(params);
    };

    function updateBackground(params) {
      CoverCommonEffects.scaleBackground(params, false);
      CoverCommonEffects.darkenCover(params, false);
    }

    function updateForeground(params) {
      CoverCommonEffects.translateForeground(params, false);
      CoverCommonEffects.fadeOutForeground(params, false);
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverBlendHeader',[
  './CoverCommonEffects'
], function(
  CoverCommonEffects
) {
  return function BlendHeaderCover() {
    this.dataViews = 1;
    this.layoutType = 'blend-header';

    this.displayCover = function(params) {
      setCoverBackgroundColor(params);
    };

    this.onScroll = function(params) {
      updateBackground(params);
    };

    function updateBackground(params) {
      CoverCommonEffects.scaleBackground(params, true, true);
      CoverCommonEffects.blendCoverWithHeader(params);
    }

    function setCoverBackgroundColor(params) {
      params.$currentSection.css('background-color', 'rgba(0,0,0,1)');
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverCurtain',[
  './CoverCommonEffects'
], function(
  CoverCommonEffects
) {
  return function CurtainCover() {
    this.dataViews = 1;
    this.layoutType = 'curtain';

    this.displayCover = function(params) {
      CoverCommonEffects.fadeInBackground(params);
    };

    this.onScroll = function(params) {
      updateBackground(params);
      updateForeground(params);
    };

    function updateBackground(params) {
      CoverCommonEffects.darkenCover(params, false);
    }

    function updateForeground(params) {
      CoverCommonEffects.translateForegroundDown(params);
    }
  };
});

define('storymaps/tpl/view/section/Cover/CoverStyleFactory',[
  './CoverStatic',
  './CoverScale',
  './CoverBlur',
  './CoverPartialPage',
  './CoverDelay',
  './CoverBlendHeader',
  './CoverCurtain'
], function(
  CoverStatic,
  CoverScale,
  CoverBlur,
  CoverPartialPage,
  CoverDelay,
  CoverBlendHeader,
  CoverCurtain
) {

  function createInstance(style) {
    var cover = null;

    cover = overrideWithUrlParam();

    if (!cover) {
      switch (style) {
        case 'scale': {
          cover = new CoverScale();
          break;
        }
        case 'blur': {
          cover = new CoverBlur();
          break;
        }
        case 'partial-page': {
          cover = new CoverPartialPage();
          break;
        }
        case 'delay': {
          cover = new CoverDelay();
          break;
        }
        case 'blend-header': {
          cover = new CoverBlendHeader();
          break;
        }
        case 'curtain': {
          cover = new CoverCurtain();
          break;
        }
        default: {
          cover = new CoverStatic();
          break;
        }
      }
    }

    return cover;
  }

  function overrideWithUrlParam() {
    var url = window.location.href,
        cover = null;

    if (url.indexOf('coverStyle=blur') !== -1) {
      cover = new CoverBlur();
    }
    else if (url.indexOf('coverStyle=scale') !== -1) {
      cover = new CoverScale();
    }
    else if (url.indexOf('coverStyle=partial-page') !== -1) {
      cover = new CoverPartialPage();
    }
    else if (url.indexOf('coverStyle=delay') !== -1) {
      cover = new CoverDelay();
    }
    else if (url.indexOf('coverStyle=blend-header') !== -1) {
      cover = new CoverBlendHeader();
    }
    else if (url.indexOf('coverStyle=curtain') !== -1) {
      cover = new CoverCurtain();
    }

    return cover;
  }

  return {
    createInstance: createInstance
  };
});


define('lib-build/hbars!storymaps-react/tpl/view/section/Cover/Cover', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "            <h2 class=\"cover-subtitle title-text text-shadow\">"
    + escapeExpression(((helper = (helper = helpers.subtitle || (depth0 != null ? depth0.subtitle : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"subtitle","hash":{},"data":data}) : helper)))
    + "</h2>            \r\n";
},"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, lambda=this.lambda, buffer = "<div class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" data-views=\""
    + escapeExpression(((helper = (helper = helpers.nbViews || (depth0 != null ? depth0.nbViews : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"nbViews","hash":{},"data":data}) : helper)))
    + "\">\r\n  <div class=\"wrapper\">\r\n\r\n    ";
  stack1 = ((helper = (helper = helpers.background || (depth0 != null ? depth0.background : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"background","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  buffer += "\r\n\r\n    <div class=\"foreground\">\r\n      <div class=\"foo\">\r\n        <div class=\"title-error-container hidden\">\r\n          <div class=\"title-error-message\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.saveError : stack1), depth0))
    + "</div>\r\n        </div>\r\n        <div class=\"text-background\">\r\n          <h1 class=\"cover-title title-text text-shadow\">"
    + escapeExpression(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"title","hash":{},"data":data}) : helper)))
    + "</h1>\r\n          <!--<span class=\"cover-title-mock-cursor\"></span>-->\r\n";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.showSubtitle : depth0), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "        </div>\r\n      </div>\r\n\r\n      <div class=\"cover-media-placeholder\">\r\n        <div class=\"cover-media-placeholder-wrapper\">\r\n          <i class=\"fa fa-picture-o ph-icon-media\" aria-hidden=\"true\"></i>\r\n          <div class=\"cover-media-placeholder-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.mediaPlaceholder : stack1), depth0))
    + "</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"scroll-invite\">\r\n      <div class=\"scroll-invite-btn\"></div>\r\n    </div>\r\n\r\n    <div class=\"cover-credits-left\">"
    + escapeExpression(((helper = (helper = helpers.creditsLeft || (depth0 != null ? depth0.creditsLeft : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"creditsLeft","hash":{},"data":data}) : helper)))
    + "</div>\r\n    <div class=\"cover-credits-right\">"
    + escapeExpression(((helper = (helper = helpers.creditsRight || (depth0 != null ? depth0.creditsRight : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"creditsRight","hash":{},"data":data}) : helper)))
    + "</div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/Cover/Cover',[],function(){});
define('storymaps-react/tpl/view/section/Cover/Cover',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'storymaps/tpl/view/section/Cover/CoverStyleFactory', 'lib-build/hbars!./Cover', 'lib-build/less!./Cover'], function (module, exports, _Common, _UI, _app, _CoverStyleFactory, _Cover) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  var _app2 = _interopRequireDefault(_app);

  var _CoverStyleFactory2 = _interopRequireDefault(_CoverStyleFactory);

  var _Cover2 = _interopRequireDefault(_Cover);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Cover = function () {
    function Cover(section) {
      _classCallCheck(this, Cover);

      this.type = 'cover';
      this.id = _UI2.default.getUID();

      this._section = section;
      this._section.options = this._section.options || {};

      this._node = null;
      this._isLoaded = false;
      this._backgroundMedia = null;

      this._cover = _CoverStyleFactory2.default.createInstance(this._section.layout);
    }

    _createClass(Cover, [{
      key: 'render',
      value: function render() {
        this._backgroundMedia = _Common2.default.initMedia(this._section.background);

        return (0, _Cover2.default)({
          classes: ['section', 'section-layout-cover', this._section.layout, this._cover.layoutType].join(' '),
          nbViews: this._cover.dataViews,
          background: _Common2.default.renderBackground({
            media: this._backgroundMedia
          }),
          title: this._section.foreground.title,
          subtitle: this._section.foreground.subtitle,
          showSubtitle: this._section.foreground.subtitle || app.isInBuilder,
          creditsLeft: this._section.foreground['credits-left'],
          creditsRight: this._section.foreground['credits-right'],
          strings: _app2.default.builder.cover
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(sectionContainer) {
        this._node = sectionContainer;

        this._backgroundMedia.postCreate({
          container: sectionContainer,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          foregroundOptions: this._section.foreground.options,
          applySectionConfig: app.isInBuilder ? this._applySectionConfig.bind(this) : null,
          // TODO: for video, need to goes away
          sectionType: 'cover'
        });

        $('.scroll-invite').click(function () {
          app.Controller.navigateToSection({
            index: 1,
            animate: true
          });
        });

        this._applyConfig();
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        _Common2.default.applyAppearance(this._section, this._node);
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        if (params.status == 'unload') {
          this._backgroundMedia.performAction({
            visible: false
          });
        } else if (params.status == 'preload') {
          return;
        } else if (params.status == 'current') {
          if (!this._isLoaded) {
            this._isLoaded = true;
            this._backgroundMedia.load().then(function () {
              this._backgroundMedia.performAction({
                isActive: true
              });
            }.bind(this));
          } else {
            this._backgroundMedia.performAction({
              isActive: true
            });
          }

          this._cover.displayCover(params);
          this.updateContent(params, true);
        } else if (!this._isLoaded) {
          return;
        } else {
          this.updateContent(params, false);
        }
      }
    }, {
      key: 'getBookmark',
      value: function getBookmark() {
        var bookmark = this._section.bookmark || {};

        return {
          status: bookmark.enabled ? 'visible' : 'disabled',
          title: this.getPreviewText ? this.getPreviewText() : '',
          bookmark: bookmark.title || this.getPreviewText && this.getPreviewText()
        };
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        return this._section.foreground.title;
      }
    }, {
      key: 'updateContent',
      value: function updateContent(params, initial) {
        if (params.currentSectionIndex == 0) {
          if (params.currentSectionScroll > app.display.sectionHeight / 2) {
            $('.story-header').css('background-color', 'rgba(0,0,0,' + params.currentSectionScroll / app.display.sectionHeight + ')');
          } else {
            $('.story-header').css('background-color', 'rgba(0,0,0,0)');
          }
        }

        if (!initial && params.status === 'current') {
          this._cover.onScroll(params);
        }
      }
    }, {
      key: 'resize',
      value: function resize(params) {
        this._backgroundMedia.resize(params);
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        return this._backgroundMedia.getArcGISContent();
      }
    }]);

    return Cover;
  }();

  exports.default = Cover;
  module.exports = exports['default'];
});
//# sourceMappingURL=Cover.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/Sequence',[],function(){});
define('storymaps-react/tpl/view/section/Sequence',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', 'lib-build/less!./Sequence'], function (module, exports, _Common, _UI) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var CONFIG = {
    backgroundMedia: ['color', 'image'],
    foregroundLayout: ['sequence-1'],
    foregroundMedia: ['image', 'video', 'webscene', 'webpage']
  };

  var Sequence = function () {
    function Sequence(section) {
      _classCallCheck(this, Sequence);

      this.type = 'sequence';
      this.id = _UI2.default.getUID();

      this._section = section;

      this._node = null;
      this._isLoaded = false;
      this._blocks = null;
      this._backgroundMedia = null;
      this._isActive = false;
      this._sectionIndex = null;
    }

    _createClass(Sequence, [{
      key: 'render',
      value: function render(index) {

        var output = '',
            foreground = this._section.foreground;

        if (_Common2.default.checkErrors(CONFIG, this._section, index)) {
          return output;
        }

        this._sectionIndex = index;

        output += '<div class="section section-layout-sequence ' + this._section.layout + '">';

        //
        // Background
        //

        this._backgroundMedia = _Common2.default.initMedia(this._section.background);
        output += _Common2.default.renderBackground({
          media: this._backgroundMedia
        });

        //
        // Foreground
        //

        output += '<div class="foreground">';
        if (foreground.blocks) {
          var blocksRenderer = _Common2.default.renderBlocks(foreground.blocks);

          this._blocks = blocksRenderer.blocks;

          output += blocksRenderer.output;
        }
        output += '</div>';

        output += '</div>';

        return output;
      }
    }, {
      key: 'postCreate',
      value: function postCreate(node) {
        this._node = node;

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._blocks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var block = _step.value;

            if (block.postCreate) {
              block.postCreate({
                container: node,
                onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
                onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
                builderConfigurationTabs: this.MEDIA_BUILDER_TABS
              });
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }, {
      key: 'getBookmark',
      value: function getBookmark() {
        var bookmark = this._section.bookmark || {};

        return {
          status: bookmark.enabled ? 'visible' : 'disabled',
          title: this.getPreviewText ? this.getPreviewText() : '',
          bookmark: bookmark.title || this.getPreviewText && this.getPreviewText()
        };
      }
    }, {
      key: 'getNumberOfBlocks',
      value: function getNumberOfBlocks() {
        return this._section.foreground && this._section.foreground.blocks ? this._section.foreground.blocks.length : 0;
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        if (params.status == 'unload') {
          this._isActive = false;

          $.each(this._blocks, function (i, block) {
            block.performAction({
              isActive: false
            });
          });
        } else if (params.status == 'preload') {
          if (this._isLoaded) {
            return;
          }

          this._isLoaded = true;

          this._backgroundMedia.load();
          $.each(this._blocks, function (i, block) {
            block.load();
          });
        } else if (params.status == 'visible' || params.status == 'current') {
          //_backgroundMedia.load();
          //if (_isActive) {
          /*$.each(_blocks, function(i, block) {
              if (block.type != 'video') {
              block.load();
              block.performAction({
                visible: true
              });
            }
          });*/

          if (!this._isLoaded) {
            $.each(this._blocks, function (i, block) {
              block.load();
            });
          }

          this._isLoaded = true;

          /*
          // Video autoplay
          $.each(app.display.inlineVideos, function(i, video) {
            if (video.sectionIndex == this._sectionIndex) {
              if (video.bottom <= params.viewportBottom && video.top > params.viewportTop) {
                this._blocks[video.blockIndex].performAction({
                  isActive: true
                });
              }
              else {
                this._blocks[video.blockIndex].performAction({
                  isActive: false
                });
              }
            }
          });
          */
          //}
        }
        /*
        else if (! this._isLoaded) {
          this._isActive = true;
          this._isLoaded = true;
            this._backgroundMedia.load();
          $.each(this._blocks, function(i, block) {
            block.load();
          });
            this._isLoaded = true;
        }
        else {
          this._isActive = true;
        }
        */
      }
    }, {
      key: 'resize',
      value: function resize() /*params*/{
        // TODO: how to resize foreground blocks?
        //_backgroundMedia.resize(params);
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        var arcgisContent = [];

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._blocks[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var block = _step2.value;

            arcgisContent.push.apply(arcgisContent, _toConsumableArray(block.getArcGISContent()));
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        return arcgisContent;
      }
    }]);

    return Sequence;
  }();

  exports.default = Sequence;
  module.exports = exports['default'];
});
//# sourceMappingURL=Sequence.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/Title', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\">\r\n\r\n  ";
  stack1 = ((helper = (helper = helpers.background || (depth0 != null ? depth0.background : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"background","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n\r\n  <div class=\"foreground\">\r\n    <div class=\"text-background\">\r\n      <h1 class=\"fg-title title-text text-shadow\">"
    + escapeExpression(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"title","hash":{},"data":data}) : helper)))
    + "</h1>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"fg-credits\">"
    + escapeExpression(((helper = (helper = helpers.credits || (depth0 != null ? depth0.credits : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"credits","hash":{},"data":data}) : helper)))
    + "</div>\r\n  <div class=\"builder-section-add-menu\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/Title',[],function(){});
define('storymaps-react/tpl/view/section/Title',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', 'lib-build/hbars!./Title', 'lib-build/less!./Title'], function (module, exports, _Common, _UI, _Title) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  var _Title2 = _interopRequireDefault(_Title);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Title = function () {
    function Title(section) {
      _classCallCheck(this, Title);

      this.type = 'title';
      this.id = _UI2.default.getUID();

      this._section = section;

      this._node = null;
      this._isLoaded = false;
      this._backgroundMedia = null;
    }

    _createClass(Title, [{
      key: 'getBookmark',
      value: function getBookmark() {
        var bookmark = this._section.bookmark || {};

        return {
          status: bookmark.enabled ? 'visible' : 'disabled',
          title: this.getPreviewText ? this.getPreviewText() : '',
          bookmark: bookmark.title || this.getPreviewText && this.getPreviewText()
        };
      }
    }, {
      key: 'getPreviewThumbnail',
      value: function getPreviewThumbnail() {
        return this._backgroundMedia.getPreviewThumbnail();
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        return this._section.foreground ? this._section.foreground.title : '';
      }
    }, {
      key: 'getPreviewIcon',
      value: function getPreviewIcon() {
        return '';
      }
    }, {
      key: 'render',
      value: function render() {
        var background = this._section.background,
            foreground = this._section.foreground,
            classes = [];

        //
        // Options
        //

        var options = this._section.options,
            size = 'medium';

        if (options && options.size) {
          size = options.size;
        }

        classes.push('size-' + size);

        //
        // Background
        //

        // TODO: this is broken, only cover and Thin implement
        this._backgroundMedia = _Common2.default.initMedia(background);

        return (0, _Title2.default)({
          classes: ['section', 'section-layout-title'].concat(classes).join(' '),
          id: this.id,
          background: _Common2.default.renderBackground({
            media: this._backgroundMedia
          }),
          title: foreground.title,
          credits: foreground.credits
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(sectionContainer) {
        this._node = sectionContainer;
        this._backgroundMedia.postCreate({
          container: sectionContainer,
          mediaIcon: 'image',
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          foregroundOptions: this._section.foreground.options,
          applySectionConfig: app.isInBuilder ? this._applySectionConfig.bind(this) : null,
          sectionType: 'title'
        });

        /*
        $(window).scroll(function() {
          if (this._isElementInViewport($('#' + this.id))) {
            if (this._section.background.type != 'color') {
              var pos = this._getElementPos($('#' + this.id));
                if (pos > document.documentElement.clientHeight - 270) {
                pos = document.documentElement.clientHeight - 270;
              }
                //$('#' + _id).find('.image').css('backgroundPositionY', - pos);
              //$('#' + _id).find('.map').css('marginTop', - pos);
              //$('#' + _id).find('.video').css('marginTop', - pos);
            }
          }
        }.bind(this));
        */

        this._applyConfig();
      }
    }, {
      key: '_applyConfig',
      value: function _applyConfig() {
        _Common2.default.applyAppearance(this._section, this._node);
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        if (params.status == 'unload') {
          return;
        } else if (params.status == 'preload') {
          if (!this._isLoaded) {
            this._backgroundMedia.load();
            this._isLoaded = true;
          }
        } else {
          this._backgroundMedia.performAction({
            isActive: true,
            progress: 0
          });
        }
      }
    }, {
      key: 'resize',
      value: function resize(params) {
        this._backgroundMedia.resize(params);
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        return this._backgroundMedia.getArcGISContent();
      }
    }]);

    return Title;
  }();

  exports.default = Title;
  module.exports = exports['default'];
});
//# sourceMappingURL=Title.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/Immersive/Immersive', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" data-views=\""
    + escapeExpression(((helper = (helper = helpers.viewsCount || (depth0 != null ? depth0.viewsCount : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"viewsCount","hash":{},"data":data}) : helper)))
    + "\">\r\n  <div class=\"background-title\"><h2>"
    + escapeExpression(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"title","hash":{},"data":data}) : helper)))
    + "</h2></div>\r\n  <div class=\"background-credits\">"
    + escapeExpression(((helper = (helper = helpers.credits || (depth0 != null ? depth0.credits : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"credits","hash":{},"data":data}) : helper)))
    + "</div>\r\n  <div class=\"background-filler\"></div>\r\n\r\n  ";
  stack1 = ((helper = (helper = helpers.background || (depth0 != null ? depth0.background : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"background","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  buffer += "\r\n\r\n  <div class=\"background-swipe-trans-extras\">\r\n    <div class=\"separator-vertical\"></div>\r\n    <div class=\"separator-horizontal\"></div>\r\n  </div>\r\n\r\n  <div class=\"foreground\">\r\n    ";
  stack1 = ((helper = (helper = helpers.foreground || (depth0 != null ? depth0.foreground : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"foreground","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n  </div>\r\n\r\n  <div class=\"builder-panel\"></div>\r\n  <div class=\"builder-section-add-menu\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/Immersive/Immersive',[],function(){});
define('storymaps-react/tpl/view/section/Immersive/Immersive',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', 'lib-build/hbars!./Immersive', 'lib-build/less!./Immersive'], function (module, exports, _Common, _UI, _Immersive) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  var _Immersive2 = _interopRequireDefault(_Immersive);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  /*
  var CONFIG = {
    backgroundMedia: ['image', 'video', 'color', 'webscene', 'webpage']
  };
  */

  var BUILDER_PANEL_HEIGHT = 125;

  var Immersive = function () {
    function Immersive(section) {
      _classCallCheck(this, Immersive);

      this.type = 'immersive';
      this.id = _UI2.default.getUID();

      this._section = section;
      this._section.options = this._section.options || {};

      this._nbViews = 0;
      this._isLoaded = false;
      this._isActive = false;
      this._currentViewIndex = -1;
      this._isNavigatingAway = false;
      this._currentViewScrollPosition = -1;
      this._swipeTransitionExtrasNode = null;
      this._previousMedia = null;

      // An immersive section is a series of view
      // There is no specific view object, instead we have
      //  - an array of media => background of each view
      //  - an array of panel => foreground of each view
      //  - an array of transitions
      // When a media is reused accross multiple views, different object are created
      //   and hold configuration specific to each view ;
      //   the media is only rendered once and that's decided here
      // TODO: Should there be a view object? Sounds like it would make part of builder easier
      //  But it won't be as convenient to know if a media is used across multiple views
      this._medias = [];
      this._panels = [];
      this._transitions = [];

      // Media cache - a media only get loaded once per section
      this._mediaCache = {};
    }

    _createClass(Immersive, [{
      key: 'render',
      value: function render() {
        var views = this._section.views,
            options = this._section.options;

        views = views || [];
        options = options || {};

        this._nbViews = views.length;

        /*
        if ( Renderer.checkErrors(config, section, index) ){
          return output;
        }
        */

        var config = [],
            title = '',
            credits = '',
            background = '',
            foreground = '';

        /*
         * Options
         */

        // One view on mobile
        /*
        if (this._nbViews == 1 && UIUtils.isMobileBrowser() && ! options['events-btn']) {
          config.push('disable-snap');
        }
        */

        if (options.style) {
          config.push(options.style);
        }

        /* from now we can't mix scrolling type in a section */
        if (views.length && views[0].foreground.panels && views[0].foreground.panels[0]) {
          config.push('layout-' + views[0].foreground.panels[0].layout);
        }

        if (options.events) {
          config.push('events-' + options.events);
        }

        if (options['events-btn']) {
          config.push('events-' + options['events-btn']);
        }

        /* hack for alternate content */
        if (_UI2.default.isMobileBrowser() && options['events-btn']) {
          this._nbViews = 1.2;
        }

        //
        // Title and credits
        //

        if (views.length && views[0].foreground.title) {
          title = views[0].foreground.title.value;
        }

        if (options.credits) {
          credits = options.credits;
        }

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = views[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var view = _step.value;

            //
            // Background
            //

            var isMediaAlreadyLoaded = this.isMediaAlreadyLoaded(view.background);

            // A new media is created for every view even if the media is used multiple times
            // This allow builder to modify it's option easily
            var media = _Common2.default.initMedia(view.background, this._mediaCache);

            // But a media is rendered only once per section
            if (!isMediaAlreadyLoaded) {
              background += _Common2.default.renderBackground({
                media: media,
                transition: view.transition
              });
            }

            this._medias.push(media);

            //
            // Foreground
            //

            var panelJSON = view.foreground.panels ? view.foreground.panels[0] : null;

            if (panelJSON) {
              var panel = app.ui.ImmersivePanelFactory.createInstance(panelJSON, {
                onUpdateLayout: app.isInBuilder ? this.onUpdatePanelLayout.bind(this) : null,
                onChange: app.isInBuilder ? this._onContentChange.bind(this) : null
              });
              this._panels.push(panel);
              foreground += panel.render();
            }

            //
            // Transition
            //

            this._transitions.push(view.transition);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return (0, _Immersive2.default)({
          classes: ['section', 'section-immersive'].concat(config).join(' '),
          viewsCount: this._nbViews + 1,
          title: title,
          credits: credits,
          background: background,
          foreground: foreground
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(sectionContainer) {
        this._node = sectionContainer;
        this._swipeTransitionExtrasNode = this._node.find('.background-swipe-trans-extras');

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._medias[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var media = _step2.value;

            media.postCreate({
              container: sectionContainer,
              delayBuilderInit: true,
              onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
              onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
              onConfigChange: app.isInBuilder ? this._onMediaConfigChange.bind(this) : null,
              builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
              // TODO: for video, need to goes away
              sectionType: 'immersive'
            });
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        var _iteratorNormalCompletion3 = true;
        var _didIteratorError3 = false;
        var _iteratorError3 = undefined;

        try {
          for (var _iterator3 = this._panels[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
            var panel = _step3.value;

            panel.postCreate({
              container: sectionContainer,
              mediaConfigurationTabs: this.MEDIA_BUILDER_TABS_PANEL
            });
          }
        } catch (err) {
          _didIteratorError3 = true;
          _iteratorError3 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion3 && _iterator3.return) {
              _iterator3.return();
            }
          } finally {
            if (_didIteratorError3) {
              throw _iteratorError3;
            }
          }
        }

        this._update();
      }
    }, {
      key: 'update',
      value: function update() {
        this._update();
      }
    }, {
      key: '_update',
      value: function _update() {
        this._nbViews = this._medias.length;

        var numberOfViews = this._nbViews + 1;

        if (numberOfViews == 1 && this._node.find('.background').hasClass('background-type-image')) {
          numberOfViews *= 1.1;
        }

        this._node.css('min-height', numberOfViews * 100 + 'vh');

        // Will affect the transition by checking the rules
        // TODO: in builder only?
        this._applyTransitionRules();

        // Update the webmap so they know if they have layers to swipe
        this._computeWebMapsSwipeLayers();
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        var viewIndex = parseInt(params.currentSectionScroll / app.display.windowHeight, 10) + 1;

        this._isNavigatingAway = viewIndex > this._nbViews;
        this._currentViewScrollPosition = params.currentSectionScroll % app.display.windowHeight;

        // Bound viewIndex to handle navigating away
        viewIndex = Math.min(viewIndex, this._nbViews);

        // Section not active yet
        if (params.viewportTop <= 0) {
          viewIndex = 1;
        }

        if (params.status == 'unload') {
          this._isActive = false;

          var _iteratorNormalCompletion4 = true;
          var _didIteratorError4 = false;
          var _iteratorError4 = undefined;

          try {
            for (var _iterator4 = this._medias[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
              var media = _step4.value;

              media.performAction({
                isActive: false
              });
            }
          } catch (err) {
            _didIteratorError4 = true;
            _iteratorError4 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion4 && _iterator4.return) {
                _iterator4.return();
              }
            } finally {
              if (_didIteratorError4) {
                throw _iteratorError4;
              }
            }
          }

          if (this._medias[0]) {
            this._medias[0].getNode().nextAll().removeClass('active');
            this._medias[0].getNode().addClass('active');
            this._medias[0].performAction({
              isActive: false,
              transition: this._transitions[0],
              isNewView: true,
              viewIndex: 0,
              visibilityProgress: 0,
              scrollPositionSection: 0,
              scrollPositionView: 0,
              performBuilderInit: false
            });
          }

          if (this._panels[0]) {
            this._panels[0].updatePosition(params);
          }

          this._node.toggleClass('hide-title hide-credits', true);

          this._currentViewIndex = -1;
          this._previousMedia = null;
          return;
        }

        var currentMedia = this._medias[viewIndex - 1];

        // Sometimes when moving away status is current and viewIndex == _nbViews + 1
        if (!currentMedia) {
          return;
        }

        if (!this._isLoaded) {
          this._isLoaded = true;

          this.loadMedias();

          var _iteratorNormalCompletion5 = true;
          var _didIteratorError5 = false;
          var _iteratorError5 = undefined;

          try {
            for (var _iterator5 = this._panels[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
              var _panel = _step5.value;

              _panel.load();
            }
          } catch (err) {
            _didIteratorError5 = true;
            _iteratorError5 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion5 && _iterator5.return) {
                _iterator5.return();
              }
            } finally {
              if (_didIteratorError5) {
                throw _iteratorError5;
              }
            }
          }

          this._node.find('.background').eq(0).addClass('active');
        }

        // visible was creation a conflict with video when navigating away
        // visible was fired right before current for some reason...
        if ( /*params.status != 'visible' &&*/params.status != 'current') {
          return;
        }

        var mediaUpdate = {
          isActive: params.status == 'current',
          transition: this._transitions[viewIndex - 1],
          // TODO: remove or make more explicit what this will do?
          isNewView: this._currentViewIndex != viewIndex,
          viewIndex: viewIndex,
          visibilityProgress: 1,
          scrollPositionSection: params.currentSectionScroll,
          scrollPositionView: this._currentViewScrollPosition,
          performBuilderInit: this._currentViewIndex != viewIndex
        };

        this._currentViewIndex = viewIndex;

        /*
        if (params.status == 'visible' && viewIndex == 1) {
          mediaUpdate.visibilityProgress = Math.round((params.viewportBottom - app.display.sectionHeight / 2) / app.display.sectionHeight * 100) / 100 * 1;
        } else if (isNavigatingAway) {
          mediaUpdate.visibilityProgress = 1 - Math.round((params.currentSectionScroll + 90) % app.display.sectionHeight / app.display.sectionHeight * 100) / 100 * 2.5;
          if (mediaUpdate.visibilityProgress > 0.6) {
            mediaUpdate.visibilityProgress = 0;
          }
        }
          mediaUpdate.visibilityProgress = Math.max(mediaUpdate.visibilityProgress, 0);
        mediaUpdate.visibilityProgress = Math.min(mediaUpdate.visibilityProgress, 1);
        */

        // Compute if the media performing the transition to next view himself
        var mediaPerformTransition = false;
        if (params.status == 'current') {
          var transition = this._transitions[viewIndex - 1],
              previousMedia = this._medias[viewIndex - 2];

          mediaPerformTransition = this._isTransitionDoneByMedia(transition, currentMedia, previousMedia);
        }

        // Media usually only need update when changing view
        var mediaNeedUpdate = mediaUpdate.isNewView;
        // Except if it's a webmap that has a swipe transition managed by the map
        if (!mediaNeedUpdate && currentMedia.type == 'webmap' && !this._isNavigatingAway) {
          mediaNeedUpdate = mediaPerformTransition;
        }

        // Refresh media only when needed
        if (mediaNeedUpdate) {
          currentMedia.performAction(mediaUpdate);
        }

        if (params.status == 'current') {
          /*
           * Background
           */

          if (mediaUpdate.isNewView) {
            //this._node.find('.background').removeClass('active');
            currentMedia.getNode().nextAll().removeClass('active');

            currentMedia.getNode().addClass('active');

            // TODO: for all media type
            // this._previousMedia is the previously visited view background (can be backward or fwd)
            if (this._previousMedia && this._previousMedia.type == 'video') {
              this._previousMedia.performAction({
                isActive: false
              });
            }

            this._previousMedia = currentMedia;

            /*
            if (transition == 'swipe-vertical' || transition == 'swipe-horizontal') {
              if (previousMedia) {
                previousMedia.getNode().addClass('active');
              }
            }
            */

            /*
            var nextMedia = this._medias[viewIndex];
            if (nextMedia) {
              var nextMediaTransition = this._transitions[viewIndex];
              if (nextMediaTransition == 'swipe-vertical' || nextMediaTransition == 'swipe-horizontal') {
                var prepareForNextTransition = ! this._isTransitionDoneByMedia(nextMediaTransition, currentMedia, nextMedia);
                if (prepareForNextTransition) {
                  nextMedia.getNode().addClass('active');
                }
              }
            }
            */
          }

          /*
           * Transition
           */

          if (!this._isNavigatingAway) {
            if (transition == 'swipe-vertical' || transition == 'swipe-horizontal') {
              if (!mediaPerformTransition) {
                var swipePosition = null,
                    mediaWidth = app.display.windowWidth,
                    mediaHeight = app.display.windowHeight;

                if (app.isInBuilder) {
                  mediaHeight -= BUILDER_PANEL_HEIGHT;
                }

                if (transition == 'swipe-vertical') {
                  /* todo: should be more so that the cut is not right above scroll-full panel
                     but this require to have the media visible outside of it's view */
                  //mediaHeight -= 20;

                  swipePosition = mediaHeight - this._currentViewScrollPosition;

                  currentMedia.getNode().css('clip', 'rect(' + swipePosition + 'px,' + mediaWidth + 'px,' + app.display.windowHeight + 'px,0px)');

                  // Swipe shadow
                  this._swipeTransitionExtrasNode.css({
                    top: swipePosition,
                    left: ''
                  }).toggleClass('trans-vertical', true).toggleClass('trans-horizontal', false).addClass('active');
                } else if (transition == 'swipe-horizontal') {
                  swipePosition = mediaWidth - this._currentViewScrollPosition / mediaHeight * mediaWidth;

                  currentMedia.getNode().css('clip', 'rect(0px,' + mediaWidth + 'px,' + app.display.windowHeight + 'px,' + swipePosition + 'px)');

                  // Swipe shadow
                  this._swipeTransitionExtrasNode.css({
                    top: '',
                    left: swipePosition
                  }).toggleClass('trans-vertical', false).toggleClass('trans-horizontal', true).addClass('active');
                }
              } else {
                this._swipeTransitionExtrasNode.removeClass('active');
              }
            } else {
              this._swipeTransitionExtrasNode.removeClass('active');
            }
          }

          /*
           * Panel
           */
          var panel = this._panels && this._panels.length ? this._panels[viewIndex - 1] : null;

          panel.updatePosition(params);

          if (mediaUpdate.isNewView) {
            var previousPanel = this._panels[viewIndex - 2];
            if (previousPanel) {
              previousPanel.updatePosition({
                isNewView: true
              });
            }
          }

          /*
           * Title and credits
           */
          if (viewIndex == this._nbViews) {
            this._node.toggleClass('hide-title hide-credits', this._isNavigatingAway);

            if (panel.layout == 'scroll-partial' && this._isNavigatingAway) {
              this._node.find('.imm-panel').css('opacity', 0);
            }
          }
        }
      }
    }, {
      key: 'loadMedias',
      value: function loadMedias() {
        var arcgisContent = [];

        var _iteratorNormalCompletion6 = true;
        var _didIteratorError6 = false;
        var _iteratorError6 = undefined;

        try {
          for (var _iterator6 = this._medias[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
            var media = _step6.value;

            var alreadyLoaded = false;

            // TODO should use getIndexes like others...
            if (media.type == 'webmap' || media.type == 'webscene') {
              if (arcgisContent.indexOf(media.id) > -1) {
                alreadyLoaded = true;
              } else {
                arcgisContent.push(media.id);
              }
            }

            if (!alreadyLoaded) {
              var loadDeferred = media.load();

              if (loadDeferred) {
                // TODO: is that necessary or can use media.id?
                loadDeferred.then(function (id) {
                  var _iteratorNormalCompletion7 = true;
                  var _didIteratorError7 = false;
                  var _iteratorError7 = undefined;

                  try {
                    for (var _iterator7 = this._medias[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
                      var _media = _step7.value;

                      if (_media.id == id) {
                        _media.postLoad();
                      }
                    }
                  } catch (err) {
                    _didIteratorError7 = true;
                    _iteratorError7 = err;
                  } finally {
                    try {
                      if (!_iteratorNormalCompletion7 && _iterator7.return) {
                        _iterator7.return();
                      }
                    } finally {
                      if (_didIteratorError7) {
                        throw _iteratorError7;
                      }
                    }
                  }
                }.bind(this));
              }
            }
          }
        } catch (err) {
          _didIteratorError6 = true;
          _iteratorError6 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion6 && _iterator6.return) {
              _iterator6.return();
            }
          } finally {
            if (_didIteratorError6) {
              throw _iteratorError6;
            }
          }
        }
      }
    }, {
      key: 'navigateToViewByIndex',
      value: function navigateToViewByIndex() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (params.index == undefined || params.animate == undefined) {
          return;
        }

        var sectionTop = this._node.position().top,
            viewHeight = app.display.windowHeight,
            viewsOffset = params.index * viewHeight,

        // TODO is this stable in viewer
        viewOffset = viewHeight - 250;

        if (app.isInBuilder) {
          viewOffset += BUILDER_PANEL_HEIGHT;
        }

        var scrollPos = Math.floor(sectionTop + viewsOffset + viewOffset);

        // TODO: animate will fire intermediate view navigation event which the view panel doesn't like
        if (params.animate) {
          $('html,body').animate({
            scrollTop: scrollPos
          });
        } else {
          document.body.scrollTop = scrollPos;
          // Firefox
          document.documentElement.scrollTop = scrollPos;
        }
      }
    }, {
      key: 'isMediaAlreadyLoaded',
      value: function isMediaAlreadyLoaded(media) {
        return _Common2.default.getMediaIndexes(this._medias, media).length > 0;
      }
    }, {
      key: 'isMediaUniqueInSection',
      value: function isMediaUniqueInSection(media) {
        return _Common2.default.getMediaIndexes(this._medias, media).length == 1;
      }
    }, {
      key: 'resize',
      value: function resize(params) {
        var _iteratorNormalCompletion8 = true;
        var _didIteratorError8 = false;
        var _iteratorError8 = undefined;

        try {
          for (var _iterator8 = this._medias[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {
            var media = _step8.value;

            media.resize(params);
          }
        } catch (err) {
          _didIteratorError8 = true;
          _iteratorError8 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion8 && _iterator8.return) {
              _iterator8.return();
            }
          } finally {
            if (_didIteratorError8) {
              throw _iteratorError8;
            }
          }
        }
      }
    }, {
      key: 'getBookmark',
      value: function getBookmark() {
        var bookmark = this._section.bookmark || {};

        return {
          status: bookmark.enabled ? 'visible' : 'disabled',
          title: this.getPreviewText ? this.getPreviewText() : '',
          bookmark: bookmark.title || this.getPreviewText && this.getPreviewText()
        };
      }
    }, {
      key: '_computeWebMapsSwipeLayers',
      value: function _computeWebMapsSwipeLayers() {
        for (var i = 0; i < this._medias.length; i++) {
          var transitionInfo = this._getTransitionInfo(i),
              media = this._medias[i];

          // First view of a section is limited to fade
          if (i == 0) {
            continue;
          }

          if (media.type != 'webmap') {
            continue;
          }

          if (transitionInfo.isDuplicateConsecutive) {
            this._medias[i].computeSwipeLayers(this._medias[i - 1].getLayersConfiguration());
          }
        }
      }
    }, {
      key: '_isTransitionDoneByMedia',
      value: function _isTransitionDoneByMedia(transition, currentMedia, previousMedia) {
        return transition && currentMedia && previousMedia && (transition == 'swipe-vertical' || transition == 'swipe-horizontal') && currentMedia.type == 'webmap' && previousMedia.type == 'webmap' && currentMedia.id == previousMedia.id;
      }
    }, {
      key: '_applyTransitionRules',
      value: function _applyTransitionRules() {
        for (var i = 0; i < this._medias.length; i++) {
          var transitionInfo = this._getTransitionInfo(i);

          // First view of a section is limited to fade
          if (i == 0) {
            this._transitions[i] = 'fade-fast';
            continue;
          }

          // Two views using the same media consecutivly
          // Authorized transitions are None and those listed in config.duplicateConsecutiveTransitions
          if (transitionInfo.isDuplicateConsecutive) {
            if (transitionInfo.duplicateConsecutiveTransitions.indexOf(this._transitions[i]) == -1) {
              this._transitions[i] = 'none';
            }
          }
          // Duplicate and non consecutive section
          // Only the transition from the first occurence of the media is authorized
          // Except for image where all transition are authorized (images are always duplicated)
          else if (transitionInfo.isDuplicate && transitionInfo.firstOccurenceTransition && this._medias[i].type != 'image') {
              //this._transitions[i] = transitionInfo.firstOccurenceTransition;
              // Temporary workaround
              this._transitions[i] = 'none';
            }
        }
      }
    }, {
      key: '_getTransitionInfo',
      value: function _getTransitionInfo(index) {
        var media = this._medias[index],

        // The indexes of the occurence of that media in the section
        mediaIndexes = _Common2.default.getMediaIndexes(this._medias, media, true),

        // If the media is not the first occurence in the section
        isDuplicate = false,

        // The transition chosen for the first occurence of the media in the section
        firstOccurenceTransition = null,

        // If the media is not the first occurence and a duplicate of previous media
        // i.e: the previous view use the same media
        isDuplicateConsecutive = false,

        // Transitions that may be authorized for consecutive medias
        duplicateConsecutiveTransitions = [];

        if (mediaIndexes.length > 1) {
          if (mediaIndexes[0] < index) {
            isDuplicate = true;

            firstOccurenceTransition = this._transitions[mediaIndexes[0]];

            if (mediaIndexes[mediaIndexes.indexOf(index) - 1] == index - 1) {
              isDuplicateConsecutive = true;

              duplicateConsecutiveTransitions = media.getAuthorizedTransitionsWith(this._medias[index - 1]);
            }
          }
        }

        return {
          isDuplicate: isDuplicate,
          isDuplicateConsecutive: isDuplicateConsecutive,
          firstOccurenceTransition: firstOccurenceTransition,
          duplicateConsecutiveTransitions: duplicateConsecutiveTransitions
        };
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        var arcgisContent = [];

        var _iteratorNormalCompletion9 = true;
        var _didIteratorError9 = false;
        var _iteratorError9 = undefined;

        try {
          for (var _iterator9 = this._medias[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {
            var media = _step9.value;

            arcgisContent.push.apply(arcgisContent, _toConsumableArray(media.getArcGISContent()));
          }
        } catch (err) {
          _didIteratorError9 = true;
          _iteratorError9 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion9 && _iterator9.return) {
              _iterator9.return();
            }
          } finally {
            if (_didIteratorError9) {
              throw _iteratorError9;
            }
          }
        }

        var _iteratorNormalCompletion10 = true;
        var _didIteratorError10 = false;
        var _iteratorError10 = undefined;

        try {
          for (var _iterator10 = this._panels[Symbol.iterator](), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {
            var panel = _step10.value;

            arcgisContent.push.apply(arcgisContent, _toConsumableArray(panel.getArcGISContent()));
          }
        } catch (err) {
          _didIteratorError10 = true;
          _iteratorError10 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion10 && _iterator10.return) {
              _iterator10.return();
            }
          } finally {
            if (_didIteratorError10) {
              throw _iteratorError10;
            }
          }
        }

        return arcgisContent;
      }
    }]);

    return Immersive;
  }();

  exports.default = Immersive;
  module.exports = exports['default'];
});
//# sourceMappingURL=Immersive.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/Credits', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, buffer = "<div class=\"section section-layout-credits\">\r\n\r\n  ";
  stack1 = ((helper = (helper = helpers.background || (depth0 != null ? depth0.background : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"background","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  buffer += "\r\n\r\n  <div class=\"foreground\">\r\n    <div class=\"credits\">\r\n      ";
  stack1 = ((helper = (helper = helpers.credits || (depth0 != null ? depth0.credits : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"credits","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n    </div>\r\n  </div>\r\n  <div class=\"builder-section-add-menu\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/Credits',[],function(){});

define('lib-build/css!storymaps-react/tpl/view/ui/AuthorInfo',[],function(){});
define('storymaps-react/tpl/view/section/Credits',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', 'lib-build/hbars!./Credits', 'lib-build/less!./Credits', 'lib-build/css!../ui/AuthorInfo'], function (module, exports, _Common, _UI, _Credits) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  var _Credits2 = _interopRequireDefault(_Credits);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var CONFIG = {
    backgroundMedia: ['color'],
    foregroundLayout: ['credits-1']
  };

  var Credits = function () {
    function Credits(section) {
      _classCallCheck(this, Credits);

      this.type = 'credits';
      this.id = _UI2.default.getUID();

      this._section = section;

      this._node = null;
      this._backgroundMedia = null;
      this._panels = [];
    }

    _createClass(Credits, [{
      key: 'render',
      value: function render(index) {
        var background = this._section.background;
        var foreground = this._section.foreground;
        var creditsOutput = '';

        if (_Common2.default.checkErrors(CONFIG, this._section, index)) {
          return '';
        }

        this._backgroundMedia = _Common2.default.initMedia(background);

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = foreground.panels[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var panel = _step.value;

            if (panel.type === 'blocks') {
              var blockRenderer = _Common2.default.renderBlocks(panel.blocks);

              this._panels.push({
                type: 'blocks',
                blocks: blockRenderer.blocks,
                editor: null
              });

              var blockOutput = '<div class="blocks">' + blockRenderer.output + '</div>';
              creditsOutput += blockOutput;
            } else if (panel.type === 'credits') {
              var credits = _Common2.default.initMedia(panel, null);

              this._panels.push({
                type: 'credits',
                credits: credits,
                editor: null
              });

              creditsOutput += credits.render({
                placement: 'block'
              });
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return (0, _Credits2.default)({
          background: _Common2.default.renderBackground({
            media: this._backgroundMedia
          }),
          credits: creditsOutput
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(sectionContainer) {
        this._node = sectionContainer;

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._panels[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var panel = _step2.value;

            if (panel.type === 'blocks') {
              var _iteratorNormalCompletion3 = true;
              var _didIteratorError3 = false;
              var _iteratorError3 = undefined;

              try {
                for (var _iterator3 = panel.blocks[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                  var block = _step3.value;

                  block.postCreate({
                    container: sectionContainer
                  });
                }
              } catch (err) {
                _didIteratorError3 = true;
                _iteratorError3 = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion3 && _iterator3.return) {
                    _iterator3.return();
                  }
                } finally {
                  if (_didIteratorError3) {
                    throw _iteratorError3;
                  }
                }
              }
            } else if (panel.type === 'credits') {
              panel.credits.postCreate({
                container: sectionContainer
              });
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    }, {
      key: 'getPreviewThumbnail',
      value: function getPreviewThumbnail() {
        return '';
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        return '';
      }
    }, {
      key: 'getPreviewIcon',
      value: function getPreviewIcon() {
        return '';
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        return [];
      }
    }, {
      key: 'onScroll',
      value: function onScroll() {
        //
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }]);

    return Credits;
  }();

  exports.default = Credits;
  module.exports = exports['default'];
});
//# sourceMappingURL=Credits.js.map
;
define('storymaps-react/tpl/view/section/FactoryViewer',['module', 'exports', './Cover/Cover', './Sequence', './Title', './Immersive/Immersive', './Credits'], function (module, exports, _Cover, _Sequence, _Title, _Immersive, _Credits) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Cover2 = _interopRequireDefault(_Cover);

  var _Sequence2 = _interopRequireDefault(_Sequence);

  var _Title2 = _interopRequireDefault(_Title);

  var _Immersive2 = _interopRequireDefault(_Immersive);

  var _Credits2 = _interopRequireDefault(_Credits);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var FactoryViewer = function () {
    function FactoryViewer() {
      _classCallCheck(this, FactoryViewer);
    }

    _createClass(FactoryViewer, null, [{
      key: 'getClasses',
      value: function getClasses() {
        return {
          Cover: _Cover2.default,
          Sequence: _Sequence2.default,
          Title: _Title2.default,
          Immersive: _Immersive2.default,
          Credits: _Credits2.default,
          CreditsPlaceholder: function CreditsPlaceholder() {}
        };
      }
    }, {
      key: 'createInstance',
      value: function createInstance() {
        var sectionJSON = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var section = null,
            type = sectionJSON.type;

        if (!type) {
          console.error('Invalid json for: ', sectionJSON);
          return section;
        }

        var classes = this.getClasses();

        if (type == 'cover') {
          section = new classes.Cover(sectionJSON);
        } else if (type == 'sequence') {
          section = new classes.Sequence(sectionJSON);
        } else if (type == 'title') {
          section = new classes.Title(sectionJSON);
        } else if (type == 'immersive') {
          section = new classes.Immersive(sectionJSON);
        } else if (type == 'credits') {
          section = new classes.Credits(sectionJSON);
        } else if (type == 'credits-placeholder') {
          section = new classes.CreditsPlaceholder(sectionJSON);
        } else {
          console.error('Could not find corresponding layout for: ', sectionJSON);
        }

        return section;
      }
    }]);

    return FactoryViewer;
  }();

  exports.default = FactoryViewer;
  module.exports = exports['default'];
});
//# sourceMappingURL=FactoryViewer.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/Cover/CoverBuilder',[],function(){});
define('storymaps-react/tpl/view/section/Cover/CoverBuilder',['module', 'exports', './Cover', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'storymaps/tpl/view/section/Common', 'dojo/topic', 'dojo/_base/lang', 'lib-build/less!./CoverBuilder'], function (module, exports, _Cover2, _app, _Common, _topic, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Cover3 = _interopRequireDefault(_Cover2);

  var _app2 = _interopRequireDefault(_app);

  var _Common2 = _interopRequireDefault(_Common);

  var _topic2 = _interopRequireDefault(_topic);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var CoverBuilder = function (_Cover) {
    _inherits(CoverBuilder, _Cover);

    function CoverBuilder(section) {
      _classCallCheck(this, CoverBuilder);

      var _this = _possibleConstructorReturn(this, (CoverBuilder.__proto__ || Object.getPrototypeOf(CoverBuilder)).call(this, section));

      _this.MEDIA_BUILDER_TABS_BACKGROUND = ['media-appearance', 'background', 'manage'];
      return _this;
    }

    _createClass(CoverBuilder, [{
      key: 'render',
      value: function render() {
        // Creating a new section
        if (!this._section.background) {
          this._section.layout = 'cover-1';
          this._section.background = {
            type: 'image',
            image: {
              url: this._getCoverPlaceholderImage(),
              isPlaceholder: true
            }
          };
        }

        if (!this._section.foreground.options) {
          this._section.foreground.options = {};
        }

        return _get(CoverBuilder.prototype.__proto__ || Object.getPrototypeOf(CoverBuilder.prototype), 'render', this).call(this);
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        var _this2 = this;

        _get(CoverBuilder.prototype.__proto__ || Object.getPrototypeOf(CoverBuilder.prototype), 'postCreate', this).call(this, params);

        //
        // Title/subtitle inline editing
        //

        this._node.find('.cover-title').attr('contenteditable', true).attr('placeholder', _app2.default.builder.cover.titlePrompt).on('blur keyup', function (e) {
          var newTitle = $('<div>' + $(e.target).text() + '</div>').text();

          if (newTitle != app.Controller.getStoryTitle()) {
            this._section.foreground.title = newTitle;
            _topic2.default.publish('builder-story-title-update', newTitle);
            this._onContentChange();
          }
        }.bind(this)).on('paste', function () {
          setTimeout(function () {
            this._node.find('.cover-title').html($('<div>' + this._node.find('.cover-title').text() + '</div>').text());
            var newTitle = this._node.find('.cover-title').text();
            this._section.foreground.title = newTitle;
            _topic2.default.publish('builder-story-title-update', newTitle);
            this._onContentChange();
          }.bind(this), 0);
        }.bind(this)).keydown(function (e) {
          // Do not allow enter key
          if (e.keyCode === 13) {
            return false;
          }

          // Prevent ctrl + B/I/U or ctrl + b/i/u
          if (e.ctrlKey || e.metaKey) {
            var key = e.keyCode;
            if (key == 66 || key == 98 || key == 73 || key == 105 || key == 85 || key == 117) {
              return false;
            }
          }

          _this2._node.find('.cover-title').removeClass('title-error');
          _this2._node.find('.title-error-container').addClass('hidden');
        });

        this._node.find('.cover-subtitle').attr('contenteditable', true).attr('placeholder', _app2.default.builder.cover.subtitlePrompt).on('blur keyup', function (e) {
          var newValue = $('<div>' + $(e.target).text() + '</div>').text();

          if (newValue != this._section.foreground.subtitle) {
            this._section.foreground.subtitle = newValue;
            this._onContentChange();
          }
        }.bind(this)).keydown(function (e) {
          // Do not allow enter key
          if (e.keyCode === 13) {
            return false;
          }

          // Prevent ctrl + B/I/U or ctrl + b/i/u
          if (e.ctrlKey || e.metaKey) {
            var key = e.keyCode;
            if (key == 66 || key == 98 || key == 73 || key == 105 || key == 85 || key == 117) {
              return false;
            }
          }
        }).on('paste', function () {
          setTimeout(function () {
            this._node.find('.cover-subtitle').html($('<div>' + this._node.find('.cover-subtitle').text() + '</div>').text());
          }.bind(this), 0);
        }.bind(this));

        if (this._backgroundMedia.isPlaceholder()) {
          this._node.find('.cover-media-placeholder').addClass('active');
          this._node.find('.cover-media-placeholder-wrapper').click(this._onEditPlaceholderMedia.bind(this));
        }

        /*
        if (! this._section.foreground.title) {
          setTimeout(function() {
            this._node.find('.cover-title').focus().focus();
          }.bind(this), 100);
        }
        */
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._node) {
          this._section.foreground.title = $('<div>' + this._node.find('.cover-title').text() + '</div>').text();
          this._section.foreground.subtitle = $('<div>' + this._node.find('.cover-subtitle').text() + '</div>').text();
          this._section.background = this._backgroundMedia.serialize();
        }

        return _lang2.default.clone(this._section);
      }
    }, {
      key: 'setBookmark',
      value: function setBookmark(bookmark) {
        this._section.bookmark = {
          enabled: bookmark.status == 'visible',
          title: bookmark.bookmark
        };
      }
    }, {
      key: 'showTitleError',
      value: function showTitleError() {
        this._node.find('.cover-title').addClass('title-error');
        this._node.find('.title-error-container').removeClass('hidden');
      }
    }, {
      key: '_onContentChange',
      value: function _onContentChange() {
        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: '_onToggleMediaConfig',
      value: function _onToggleMediaConfig() {
        this._node.toggleClass('hide-scroll-invite');
      }
    }, {
      key: '_onEditPlaceholderMedia',
      value: function _onEditPlaceholderMedia() {
        app.builder.mediaPicker.open({
          mode: 'add',
          authorizedMedia: ['image', 'video']
        }).then(function (newMedia) {
          this._onEditMedia(this._backgroundMedia, newMedia);
          this._node.find('.cover-media-placeholder').removeClass('active');

          this._onContentChange();
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: '_onMediaConfigAction',
      value: function _onMediaConfigAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.action || !params.media) {
          return;
        }

        if (params.action == 'swap') {
          app.builder.mediaPicker.open({
            mode: 'edit',
            media: params.media.serialize(),
            authorizedMedia: ['image', 'video']
          }).then(function (newMedia) {
            this._onToggleMediaConfig();
            this._onEditMedia(params.media, newMedia);
          }.bind(this), function () {
            //
          });
        }

        this._onContentChange();
      }
    }, {
      key: '_applySectionConfig',
      value: function _applySectionConfig() {
        this._applyConfig();
        this._onContentChange();
      }
    }, {
      key: '_onEditMedia',
      value: function _onEditMedia(media, newMediaJSON) {
        var newMedia = _Common2.default.initMedia(newMediaJSON);

        // Delete actual background
        this._node.find('.background').remove();

        // TODO: only if media not already rendered
        this._node.find('.wrapper').prepend(_Common2.default.renderBackground({
          media: newMedia
        }));

        newMedia.postCreate({
          container: this._node,
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          foregroundOptions: this._section.foreground.options,
          applySectionConfig: app.isInBuilder ? this._applySectionConfig.bind(this) : null,
          // TODO: for video, need to goes away
          sectionType: 'cover'
        });

        // TODO: this may be an issue if picking a map/scene already present
        newMedia.load({
          isBuilderAdd: true
        });

        media.destroy();

        this._backgroundMedia = newMedia;

        this._applySectionConfig();
      }
    }, {
      key: '_getCoverPlaceholderImage',
      value: function _getCoverPlaceholderImage() {
        var images = ['EandNPhotographies.jpg', 'ErolAhmed.jpg', 'FrancesGunn.jpg', 'JeremyThomas.jpg', 'JonathanBean.jpg', 'NASA.jpg', 'PatrickFore.jpg', 'PatrickTomasso.jpg', 'PhilippeWuyts.jpg', 'SamuelScrimshaw.jpg', 'SujanSundareswaran.jpg', 'SusanneFeldt.jpg'];

        var image = images[Math.floor(Math.random() * images.length)];

        return 'resources/tpl/viewer/cover-placeholder/' + image;
      }
    }]);

    return CoverBuilder;
  }(_Cover3.default);

  exports.default = CoverBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=CoverBuilder.js.map
;
/*global self, document, DOMException */

/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */

// Full polyfill for browsers with no classList support
if (!("classList" in document.createElement("_"))) {
  (function (view) {

  "use strict";

  if (!('Element' in view)) return;

  var
      classListProp = "classList"
    , protoProp = "prototype"
    , elemCtrProto = view.Element[protoProp]
    , objCtr = Object
    , strTrim = String[protoProp].trim || function () {
      return this.replace(/^\s+|\s+$/g, "");
    }
    , arrIndexOf = Array[protoProp].indexOf || function (item) {
      var
          i = 0
        , len = this.length
      ;
      for (; i < len; i++) {
        if (i in this && this[i] === item) {
          return i;
        }
      }
      return -1;
    }
    // Vendors: please allow content code to instantiate DOMExceptions
    , DOMEx = function (type, message) {
      this.name = type;
      this.code = DOMException[type];
      this.message = message;
    }
    , checkTokenAndGetIndex = function (classList, token) {
      if (token === "") {
        throw new DOMEx(
            "SYNTAX_ERR"
          , "An invalid or illegal string was specified"
        );
      }
      if (/\s/.test(token)) {
        throw new DOMEx(
            "INVALID_CHARACTER_ERR"
          , "String contains an invalid character"
        );
      }
      return arrIndexOf.call(classList, token);
    }
    , ClassList = function (elem) {
      var
          trimmedClasses = strTrim.call(elem.getAttribute("class") || "")
        , classes = trimmedClasses ? trimmedClasses.split(/\s+/) : []
        , i = 0
        , len = classes.length
      ;
      for (; i < len; i++) {
        this.push(classes[i]);
      }
      this._updateClassName = function () {
        elem.setAttribute("class", this.toString());
      };
    }
    , classListProto = ClassList[protoProp] = []
    , classListGetter = function () {
      return new ClassList(this);
    }
  ;
  // Most DOMException implementations don't allow calling DOMException's toString()
  // on non-DOMExceptions. Error's toString() is sufficient here.
  DOMEx[protoProp] = Error[protoProp];
  classListProto.item = function (i) {
    return this[i] || null;
  };
  classListProto.contains = function (token) {
    token += "";
    return checkTokenAndGetIndex(this, token) !== -1;
  };
  classListProto.add = function () {
    var
        tokens = arguments
      , i = 0
      , l = tokens.length
      , token
      , updated = false
    ;
    do {
      token = tokens[i] + "";
      if (checkTokenAndGetIndex(this, token) === -1) {
        this.push(token);
        updated = true;
      }
    }
    while (++i < l);

    if (updated) {
      this._updateClassName();
    }
  };
  classListProto.remove = function () {
    var
        tokens = arguments
      , i = 0
      , l = tokens.length
      , token
      , updated = false
      , index
    ;
    do {
      token = tokens[i] + "";
      index = checkTokenAndGetIndex(this, token);
      while (index !== -1) {
        this.splice(index, 1);
        updated = true;
        index = checkTokenAndGetIndex(this, token);
      }
    }
    while (++i < l);

    if (updated) {
      this._updateClassName();
    }
  };
  classListProto.toggle = function (token, force) {
    token += "";

    var
        result = this.contains(token)
      , method = result ?
        force !== true && "remove"
      :
        force !== false && "add"
    ;

    if (method) {
      this[method](token);
    }

    if (force === true || force === false) {
      return force;
    } else {
      return !result;
    }
  };
  classListProto.toString = function () {
    return this.join(" ");
  };

  if (objCtr.defineProperty) {
    var classListPropDesc = {
        get: classListGetter
      , enumerable: true
      , configurable: true
    };
    try {
      objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);
    } catch (ex) { // IE 8 doesn't support enumerable:true
      if (ex.number === -0x7FF5EC54) {
        classListPropDesc.enumerable = false;
        objCtr.defineProperty(elemCtrProto, classListProp, classListPropDesc);
      }
    }
  } else if (objCtr[protoProp].__defineGetter__) {
    elemCtrProto.__defineGetter__(classListProp, classListGetter);
  }

  }(self));
}

/* Blob.js
 * A Blob implementation.
 * 2014-07-24
 *
 * By Eli Grey, http://eligrey.com
 * By Devin Samarin, https://github.com/dsamarin
 * License: X11/MIT
 *   See https://github.com/eligrey/Blob.js/blob/master/LICENSE.md
 */

/*global self, unescape */
/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,
  plusplus: true */

/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */

(function (view) {
  "use strict";

  view.URL = view.URL || view.webkitURL;

  if (view.Blob && view.URL) {
    try {
      new Blob;
      return;
    } catch (e) {}
  }

  // Internally we use a BlobBuilder implementation to base Blob off of
  // in order to support older browsers that only have BlobBuilder
  var BlobBuilder = view.BlobBuilder || view.WebKitBlobBuilder || view.MozBlobBuilder || (function(view) {
    var
        get_class = function(object) {
        return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1];
      }
      , FakeBlobBuilder = function BlobBuilder() {
        this.data = [];
      }
      , FakeBlob = function Blob(data, type, encoding) {
        this.data = data;
        this.size = data.length;
        this.type = type;
        this.encoding = encoding;
      }
      , FBB_proto = FakeBlobBuilder.prototype
      , FB_proto = FakeBlob.prototype
      , FileReaderSync = view.FileReaderSync
      , FileException = function(type) {
        this.code = this[this.name = type];
      }
      , file_ex_codes = (
          "NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR "
        + "NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR"
      ).split(" ")
      , file_ex_code = file_ex_codes.length
      , real_URL = view.URL || view.webkitURL || view
      , real_create_object_URL = real_URL.createObjectURL
      , real_revoke_object_URL = real_URL.revokeObjectURL
      , URL = real_URL
      , btoa = view.btoa
      , atob = view.atob

      , ArrayBuffer = view.ArrayBuffer
      , Uint8Array = view.Uint8Array

      , origin = /^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/
    ;
    FakeBlob.fake = FB_proto.fake = true;
    while (file_ex_code--) {
      FileException.prototype[file_ex_codes[file_ex_code]] = file_ex_code + 1;
    }
    // Polyfill URL
    if (!real_URL.createObjectURL) {
      URL = view.URL = function(uri) {
        var
            uri_info = document.createElementNS("http://www.w3.org/1999/xhtml", "a")
          , uri_origin
        ;
        uri_info.href = uri;
        if (!("origin" in uri_info)) {
          if (uri_info.protocol.toLowerCase() === "data:") {
            uri_info.origin = null;
          } else {
            uri_origin = uri.match(origin);
            uri_info.origin = uri_origin && uri_origin[1];
          }
        }
        return uri_info;
      };
    }
    URL.createObjectURL = function(blob) {
      var
          type = blob.type
        , data_URI_header
      ;
      if (type === null) {
        type = "application/octet-stream";
      }
      if (blob instanceof FakeBlob) {
        data_URI_header = "data:" + type;
        if (blob.encoding === "base64") {
          return data_URI_header + ";base64," + blob.data;
        } else if (blob.encoding === "URI") {
          return data_URI_header + "," + decodeURIComponent(blob.data);
        } if (btoa) {
          return data_URI_header + ";base64," + btoa(blob.data);
        } else {
          return data_URI_header + "," + encodeURIComponent(blob.data);
        }
      } else if (real_create_object_URL) {
        return real_create_object_URL.call(real_URL, blob);
      }
    };
    URL.revokeObjectURL = function(object_URL) {
      if (object_URL.substring(0, 5) !== "data:" && real_revoke_object_URL) {
        real_revoke_object_URL.call(real_URL, object_URL);
      }
    };
    FBB_proto.append = function(data/*, endings*/) {
      var bb = this.data;
      // decode data to a binary string
      if (Uint8Array && (data instanceof ArrayBuffer || data instanceof Uint8Array)) {
        var
            str = ""
          , buf = new Uint8Array(data)
          , i = 0
          , buf_len = buf.length
        ;
        for (; i < buf_len; i++) {
          str += String.fromCharCode(buf[i]);
        }
        bb.push(str);
      } else if (get_class(data) === "Blob" || get_class(data) === "File") {
        if (FileReaderSync) {
          var fr = new FileReaderSync;
          bb.push(fr.readAsBinaryString(data));
        } else {
          // async FileReader won't work as BlobBuilder is sync
          throw new FileException("NOT_READABLE_ERR");
        }
      } else if (data instanceof FakeBlob) {
        if (data.encoding === "base64" && atob) {
          bb.push(atob(data.data));
        } else if (data.encoding === "URI") {
          bb.push(decodeURIComponent(data.data));
        } else if (data.encoding === "raw") {
          bb.push(data.data);
        }
      } else {
        if (typeof data !== "string") {
          data += ""; // convert unsupported types to strings
        }
        // decode UTF-16 to binary string
        bb.push(unescape(encodeURIComponent(data)));
      }
    };
    FBB_proto.getBlob = function(type) {
      if (!arguments.length) {
        type = null;
      }
      return new FakeBlob(this.data.join(""), type, "raw");
    };
    FBB_proto.toString = function() {
      return "[object BlobBuilder]";
    };
    FB_proto.slice = function(start, end, type) {
      var args = arguments.length;
      if (args < 3) {
        type = null;
      }
      return new FakeBlob(
          this.data.slice(start, args > 1 ? end : this.data.length)
        , type
        , this.encoding
      );
    };
    FB_proto.toString = function() {
      return "[object Blob]";
    };
    FB_proto.close = function() {
      this.size = 0;
      delete this.data;
    };
    return FakeBlobBuilder;
  }(view));

  view.Blob = function(blobParts, options) {
    var type = options ? (options.type || "") : "";
    var builder = new BlobBuilder();
    if (blobParts) {
      for (var i = 0, len = blobParts.length; i < len; i++) {
        if (Uint8Array && blobParts[i] instanceof Uint8Array) {
          builder.append(blobParts[i].buffer);
        }
        else {
          builder.append(blobParts[i]);
        }
      }
    }
    var blob = builder.getBlob(type);
    if (!blob.slice && blob.webkitSlice) {
      blob.slice = blob.webkitSlice;
    }
    return blob;
  };

  var getPrototypeOf = Object.getPrototypeOf || function(object) {
    return object.__proto__;
  };
  view.Blob.prototype = getPrototypeOf(new view.Blob());
}(typeof self !== "undefined" && self || typeof window !== "undefined" && window || this.content || this));

(function (root, factory) {
    'use strict';
    var isElectron = typeof module === 'object' && process && process.versions && process.versions.electron;
    if (!isElectron && typeof module === 'object') {
        module.exports = factory;
    } else if (typeof define === 'function' && define.amd) {
        define('lib/medium-editor/dist/js/medium-editor',[],function () {
            return factory;
        });
    } else {
        root.MediumEditor = factory;
    }
}(this, function () {

    'use strict';

function MediumEditor(elements, options) {
    'use strict';
    return this.init(elements, options);
}

MediumEditor.extensions = {};
/*jshint unused: true */
(function (window) {
    'use strict';

    function copyInto(overwrite, dest) {
        var prop,
            sources = Array.prototype.slice.call(arguments, 2);
        dest = dest || {};
        for (var i = 0; i < sources.length; i++) {
            var source = sources[i];
            if (source) {
                for (prop in source) {
                    if (source.hasOwnProperty(prop) &&
                        typeof source[prop] !== 'undefined' &&
                        (overwrite || dest.hasOwnProperty(prop) === false)) {
                        dest[prop] = source[prop];
                    }
                }
            }
        }
        return dest;
    }

    // https://developer.mozilla.org/en-US/docs/Web/API/Node/contains
    // Some browsers (including phantom) don't return true for Node.contains(child)
    // if child is a text node.  Detect these cases here and use a fallback
    // for calls to Util.isDescendant()
    var nodeContainsWorksWithTextNodes = false;
    try {
        var testParent = document.createElement('div'),
            testText = document.createTextNode(' ');
        testParent.appendChild(testText);
        nodeContainsWorksWithTextNodes = testParent.contains(testText);
    } catch (exc) {}

    var Util = {

        // http://stackoverflow.com/questions/17907445/how-to-detect-ie11#comment30165888_17907562
        // by rg89
        isIE: ((navigator.appName === 'Microsoft Internet Explorer') || ((navigator.appName === 'Netscape') && (new RegExp('Trident/.*rv:([0-9]{1,}[.0-9]{0,})').exec(navigator.userAgent) !== null))),

        isEdge: (/Edge\/\d+/).exec(navigator.userAgent) !== null,

        // if firefox
        isFF: (navigator.userAgent.toLowerCase().indexOf('firefox') > -1),

        // http://stackoverflow.com/a/11752084/569101
        isMac: (window.navigator.platform.toUpperCase().indexOf('MAC') >= 0),

        // https://github.com/jashkenas/underscore
        // Lonely letter MUST USE the uppercase code
        keyCode: {
            BACKSPACE: 8,
            TAB: 9,
            ENTER: 13,
            ESCAPE: 27,
            SPACE: 32,
            DELETE: 46,
            K: 75, // K keycode, and not k
            M: 77,
            V: 86
        },

        /**
         * Returns true if it's metaKey on Mac, or ctrlKey on non-Mac.
         * See #591
         */
        isMetaCtrlKey: function (event) {
            if ((Util.isMac && event.metaKey) || (!Util.isMac && event.ctrlKey)) {
                return true;
            }

            return false;
        },

        /**
         * Returns true if the key associated to the event is inside keys array
         *
         * @see : https://github.com/jquery/jquery/blob/0705be475092aede1eddae01319ec931fb9c65fc/src/event.js#L473-L484
         * @see : http://stackoverflow.com/q/4471582/569101
         */
        isKey: function (event, keys) {
            var keyCode = Util.getKeyCode(event);

            // it's not an array let's just compare strings!
            if (false === Array.isArray(keys)) {
                return keyCode === keys;
            }

            if (-1 === keys.indexOf(keyCode)) {
                return false;
            }

            return true;
        },

        getKeyCode: function (event) {
            var keyCode = event.which;

            // getting the key code from event
            if (null === keyCode) {
                keyCode = event.charCode !== null ? event.charCode : event.keyCode;
            }

            return keyCode;
        },

        blockContainerElementNames: [
            // elements our editor generates
            'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'li', 'ol',
            // all other known block elements
            'address', 'article', 'aside', 'audio', 'canvas', 'dd', 'dl', 'dt', 'fieldset',
            'figcaption', 'figure', 'footer', 'form', 'header', 'hgroup', 'main', 'nav',
            'noscript', 'output', 'section', 'video',
            'table', 'thead', 'tbody', 'tfoot', 'tr', 'th', 'td'
        ],

        emptyElementNames: ['br', 'col', 'colgroup', 'hr', 'img', 'input', 'source', 'wbr'],

        extend: function extend(/* dest, source1, source2, ...*/) {
            var args = [true].concat(Array.prototype.slice.call(arguments));
            return copyInto.apply(this, args);
        },

        defaults: function defaults(/*dest, source1, source2, ...*/) {
            var args = [false].concat(Array.prototype.slice.call(arguments));
            return copyInto.apply(this, args);
        },

        /*
         * Create a link around the provided text nodes which must be adjacent to each other and all be
         * descendants of the same closest block container. If the preconditions are not met, unexpected
         * behavior will result.
         */
        createLink: function (document, textNodes, href, target) {
            var anchor = document.createElement('a');
            Util.moveTextRangeIntoElement(textNodes[0], textNodes[textNodes.length - 1], anchor);
            anchor.setAttribute('href', href);
            if (target) {
                anchor.setAttribute('target', target);
            }
            return anchor;
        },

        /*
         * Given the provided match in the format {start: 1, end: 2} where start and end are indices into the
         * textContent of the provided element argument, modify the DOM inside element to ensure that the text
         * identified by the provided match can be returned as text nodes that contain exactly that text, without
         * any additional text at the beginning or end of the returned array of adjacent text nodes.
         *
         * The only DOM manipulation performed by this function is splitting the text nodes, non-text nodes are
         * not affected in any way.
         */
        findOrCreateMatchingTextNodes: function (document, element, match) {
            var treeWalker = document.createTreeWalker(element, NodeFilter.SHOW_ALL, null, false),
                matchedNodes = [],
                currentTextIndex = 0,
                startReached = false,
                currentNode = null,
                newNode = null;

            while ((currentNode = treeWalker.nextNode()) !== null) {
                if (currentNode.nodeType > 3) {
                    continue;
                } else if (currentNode.nodeType === 3) {
                    if (!startReached && match.start < (currentTextIndex + currentNode.nodeValue.length)) {
                        startReached = true;
                        newNode = Util.splitStartNodeIfNeeded(currentNode, match.start, currentTextIndex);
                    }
                    if (startReached) {
                        Util.splitEndNodeIfNeeded(currentNode, newNode, match.end, currentTextIndex);
                    }
                    if (startReached && currentTextIndex === match.end) {
                        break; // Found the node(s) corresponding to the link. Break out and move on to the next.
                    } else if (startReached && currentTextIndex > (match.end + 1)) {
                        throw new Error('PerformLinking overshot the target!'); // should never happen...
                    }

                    if (startReached) {
                        matchedNodes.push(newNode || currentNode);
                    }

                    currentTextIndex += currentNode.nodeValue.length;
                    if (newNode !== null) {
                        currentTextIndex += newNode.nodeValue.length;
                        // Skip the newNode as we'll already have pushed it to the matches
                        treeWalker.nextNode();
                    }
                    newNode = null;
                } else if (currentNode.tagName.toLowerCase() === 'img') {
                    if (!startReached && (match.start <= currentTextIndex)) {
                        startReached = true;
                    }
                    if (startReached) {
                        matchedNodes.push(currentNode);
                    }
                }
            }
            return matchedNodes;
        },

        /*
         * Given the provided text node and text coordinates, split the text node if needed to make it align
         * precisely with the coordinates.
         *
         * This function is intended to be called from Util.findOrCreateMatchingTextNodes.
         */
        splitStartNodeIfNeeded: function (currentNode, matchStartIndex, currentTextIndex) {
            if (matchStartIndex !== currentTextIndex) {
                return currentNode.splitText(matchStartIndex - currentTextIndex);
            }
            return null;
        },

        /*
         * Given the provided text node and text coordinates, split the text node if needed to make it align
         * precisely with the coordinates. The newNode argument should from the result of Util.splitStartNodeIfNeeded,
         * if that function has been called on the same currentNode.
         *
         * This function is intended to be called from Util.findOrCreateMatchingTextNodes.
         */
        splitEndNodeIfNeeded: function (currentNode, newNode, matchEndIndex, currentTextIndex) {
            var textIndexOfEndOfFarthestNode,
                endSplitPoint;
            textIndexOfEndOfFarthestNode = currentTextIndex + (newNode || currentNode).nodeValue.length +
                    (newNode ? currentNode.nodeValue.length : 0) -
                    1;
            endSplitPoint = (newNode || currentNode).nodeValue.length -
                    (textIndexOfEndOfFarthestNode + 1 - matchEndIndex);
            if (textIndexOfEndOfFarthestNode >= matchEndIndex &&
                    currentTextIndex !== textIndexOfEndOfFarthestNode &&
                    endSplitPoint !== 0) {
                (newNode || currentNode).splitText(endSplitPoint);
            }
        },

        /*
        * Take an element, and break up all of its text content into unique pieces such that:
         * 1) All text content of the elements are in separate blocks. No piece of text content should span
         *    across multiple blocks. This means no element return by this function should have
         *    any blocks as children.
         * 2) The union of the textcontent of all of the elements returned here covers all
         *    of the text within the element.
         *
         *
         * EXAMPLE:
         * In the event that we have something like:
         *
         * <blockquote>
         *   <p>Some Text</p>
         *   <ol>
         *     <li>List Item 1</li>
         *     <li>List Item 2</li>
         *   </ol>
         * </blockquote>
         *
         * This function would return these elements as an array:
         *   [ <p>Some Text</p>, <li>List Item 1</li>, <li>List Item 2</li> ]
         *
         * Since the <blockquote> and <ol> elements contain blocks within them they are not returned.
         * Since the <p> and <li>'s don't contain block elements and cover all the text content of the
         * <blockquote> container, they are the elements returned.
         */
        splitByBlockElements: function (element) {
            if (element.nodeType !== 3 && element.nodeType !== 1) {
                return [];
            }

            var toRet = [],
                blockElementQuery = MediumEditor.util.blockContainerElementNames.join(',');

            if (element.nodeType === 3 || element.querySelectorAll(blockElementQuery).length === 0) {
                return [element];
            }

            for (var i = 0; i < element.childNodes.length; i++) {
                var child = element.childNodes[i];
                if (child.nodeType === 3) {
                    toRet.push(child);
                } else if (child.nodeType === 1) {
                    var blockElements = child.querySelectorAll(blockElementQuery);
                    if (blockElements.length === 0) {
                        toRet.push(child);
                    } else {
                        toRet = toRet.concat(MediumEditor.util.splitByBlockElements(child));
                    }
                }
            }

            return toRet;
        },

        // Find the next node in the DOM tree that represents any text that is being
        // displayed directly next to the targetNode (passed as an argument)
        // Text that appears directly next to the current node can be:
        //  - A sibling text node
        //  - A descendant of a sibling element
        //  - A sibling text node of an ancestor
        //  - A descendant of a sibling element of an ancestor
        findAdjacentTextNodeWithContent: function findAdjacentTextNodeWithContent(rootNode, targetNode, ownerDocument) {
            var pastTarget = false,
                nextNode,
                nodeIterator = ownerDocument.createNodeIterator(rootNode, NodeFilter.SHOW_TEXT, null, false);

            // Use a native NodeIterator to iterate over all the text nodes that are descendants
            // of the rootNode.  Once past the targetNode, choose the first non-empty text node
            nextNode = nodeIterator.nextNode();
            while (nextNode) {
                if (nextNode === targetNode) {
                    pastTarget = true;
                } else if (pastTarget) {
                    if (nextNode.nodeType === 3 && nextNode.nodeValue && nextNode.nodeValue.trim().length > 0) {
                        break;
                    }
                }
                nextNode = nodeIterator.nextNode();
            }

            return nextNode;
        },

        // Find an element's previous sibling within a medium-editor element
        // If one doesn't exist, find the closest ancestor's previous sibling
        findPreviousSibling: function (node) {
            if (!node || Util.isMediumEditorElement(node)) {
                return false;
            }

            var previousSibling = node.previousSibling;
            while (!previousSibling && !Util.isMediumEditorElement(node.parentNode)) {
                node = node.parentNode;
                previousSibling = node.previousSibling;
            }

            return previousSibling;
        },

        isDescendant: function isDescendant(parent, child, checkEquality) {
            if (!parent || !child) {
                return false;
            }
            if (parent === child) {
                return !!checkEquality;
            }
            // If parent is not an element, it can't have any descendants
            if (parent.nodeType !== 1) {
                return false;
            }
            if (nodeContainsWorksWithTextNodes || child.nodeType !== 3) {
                return parent.contains(child);
            }
            var node = child.parentNode;
            while (node !== null) {
                if (node === parent) {
                    return true;
                }
                node = node.parentNode;
            }
            return false;
        },

        // https://github.com/jashkenas/underscore
        isElement: function isElement(obj) {
            return !!(obj && obj.nodeType === 1);
        },

        // https://github.com/jashkenas/underscore
        throttle: function (func, wait) {
            var THROTTLE_INTERVAL = 50,
                context,
                args,
                result,
                timeout = null,
                previous = 0,
                later = function () {
                    previous = Date.now();
                    timeout = null;
                    result = func.apply(context, args);
                    if (!timeout) {
                        context = args = null;
                    }
                };

            if (!wait && wait !== 0) {
                wait = THROTTLE_INTERVAL;
            }

            return function () {
                var now = Date.now(),
                    remaining = wait - (now - previous);

                context = this;
                args = arguments;
                if (remaining <= 0 || remaining > wait) {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                    previous = now;
                    result = func.apply(context, args);
                    if (!timeout) {
                        context = args = null;
                    }
                } else if (!timeout) {
                    timeout = setTimeout(later, remaining);
                }
                return result;
            };
        },

        traverseUp: function (current, testElementFunction) {
            if (!current) {
                return false;
            }

            do {
                if (current.nodeType === 1) {
                    if (testElementFunction(current)) {
                        return current;
                    }
                    // do not traverse upwards past the nearest containing editor
                    if (Util.isMediumEditorElement(current)) {
                        return false;
                    }
                }

                current = current.parentNode;
            } while (current);

            return false;
        },

        htmlEntities: function (str) {
            // converts special characters (like <) into their escaped/encoded values (like &lt;).
            // This allows you to show to display the string without the browser reading it as HTML.
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        },

        // http://stackoverflow.com/questions/6690752/insert-html-at-caret-in-a-contenteditable-div
        insertHTMLCommand: function (doc, html) {
            var selection, range, el, fragment, node, lastNode, toReplace,
                res = false,
                ecArgs = ['insertHTML', false, html];

            /* Edge's implementation of insertHTML is just buggy right now:
             * - Doesn't allow leading white space at the beginning of an element
             * - Found a case when a <font size="2"> tag was inserted when calling alignCenter inside a blockquote
             *
             * There are likely other bugs, these are just the ones we found so far.
             * For now, let's just use the same fallback we did for IE
             */
            if (!MediumEditor.util.isEdge && doc.queryCommandSupported('insertHTML')) {
                try {
                    return doc.execCommand.apply(doc, ecArgs);
                } catch (ignore) {}
            }

            selection = doc.getSelection();
            if (selection.rangeCount) {
                range = selection.getRangeAt(0);
                toReplace = range.commonAncestorContainer;

                // https://github.com/yabwe/medium-editor/issues/748
                // If the selection is an empty editor element, create a temporary text node inside of the editor
                // and select it so that we don't delete the editor element
                if (Util.isMediumEditorElement(toReplace) && !toReplace.firstChild) {
                    range.selectNode(toReplace.appendChild(doc.createTextNode('')));
                } else if ((toReplace.nodeType === 3 && range.startOffset === 0 && range.endOffset === toReplace.nodeValue.length) ||
                        (toReplace.nodeType !== 3 && toReplace.innerHTML === range.toString())) {
                    // Ensure range covers maximum amount of nodes as possible
                    // By moving up the DOM and selecting ancestors whose only child is the range
                    while (!Util.isMediumEditorElement(toReplace) &&
                            toReplace.parentNode &&
                            toReplace.parentNode.childNodes.length === 1 &&
                            !Util.isMediumEditorElement(toReplace.parentNode)) {
                        toReplace = toReplace.parentNode;
                    }
                    range.selectNode(toReplace);
                }
                range.deleteContents();

                el = doc.createElement('div');
                el.innerHTML = html;
                fragment = doc.createDocumentFragment();
                while (el.firstChild) {
                    node = el.firstChild;
                    lastNode = fragment.appendChild(node);
                }
                range.insertNode(fragment);

                // Preserve the selection:
                if (lastNode) {
                    range = range.cloneRange();
                    range.setStartAfter(lastNode);
                    range.collapse(true);
                    MediumEditor.selection.selectRange(doc, range);
                }
                res = true;
            }

            // https://github.com/yabwe/medium-editor/issues/992
            // If we're monitoring calls to execCommand, notify listeners as if a real call had happened
            if (doc.execCommand.callListeners) {
                doc.execCommand.callListeners(ecArgs, res);
            }
            return res;
        },

        execFormatBlock: function (doc, tagName) {
            // Get the top level block element that contains the selection
            var blockContainer = Util.getTopBlockContainer(MediumEditor.selection.getSelectionStart(doc)),
                childNodes;

            // Special handling for blockquote
            if (tagName === 'blockquote') {
                if (blockContainer) {
                    childNodes = Array.prototype.slice.call(blockContainer.childNodes);
                    // Check if the blockquote has a block element as a child (nested blocks)
                    if (childNodes.some(function (childNode) {
                        return Util.isBlockContainer(childNode);
                    })) {
                        // FF handles blockquote differently on formatBlock
                        // allowing nesting, we need to use outdent
                        // https://developer.mozilla.org/en-US/docs/Rich-Text_Editing_in_Mozilla
                        return doc.execCommand('outdent', false, null);
                    }
                }

                // When IE blockquote needs to be called as indent
                // http://stackoverflow.com/questions/1816223/rich-text-editor-with-blockquote-function/1821777#1821777
                if (Util.isIE) {
                    return doc.execCommand('indent', false, tagName);
                }
            }

            // If the blockContainer is already the element type being passed in
            // treat it as 'undo' formatting and just convert it to a <p>
            if (blockContainer && tagName === blockContainer.nodeName.toLowerCase()) {
                tagName = 'p';
            }

            // When IE we need to add <> to heading elements
            // http://stackoverflow.com/questions/10741831/execcommand-formatblock-headings-in-ie
            if (Util.isIE) {
                tagName = '<' + tagName + '>';
            }

            // When FF, IE and Edge, we have to handle blockquote node seperately as 'formatblock' does not work.
            // https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand#Commands
            if (blockContainer && blockContainer.nodeName.toLowerCase() === 'blockquote') {
                // For IE, just use outdent
                if (Util.isIE && tagName === '<p>') {
                    return doc.execCommand('outdent', false, tagName);
                }

                // For Firefox and Edge, make sure there's a nested block element before calling outdent
                if ((Util.isFF || Util.isEdge) && tagName === 'p') {
                    childNodes = Array.prototype.slice.call(blockContainer.childNodes);
                    // If there are some non-block elements we need to wrap everything in a <p> before we outdent
                    if (childNodes.some(function (childNode) {
                        return !Util.isBlockContainer(childNode);
                    })) {
                        doc.execCommand('formatBlock', false, tagName);
                    }
                    return doc.execCommand('outdent', false, tagName);
                }
            }

            return doc.execCommand('formatBlock', false, tagName);
        },

        /**
         * Set target to blank on the given el element
         *
         * TODO: not sure if this should be here
         *
         * When creating a link (using core -> createLink) the selection returned by Firefox will be the parent of the created link
         * instead of the created link itself (as it is for Chrome for example), so we retrieve all "a" children to grab the good one by
         * using `anchorUrl` to ensure that we are adding target="_blank" on the good one.
         * This isn't a bulletproof solution anyway ..
         */
        setTargetBlank: function (el, anchorUrl) {
            var i, url = anchorUrl || false;
            if (el.nodeName.toLowerCase() === 'a') {
                el.target = '_blank';
            } else {
                el = el.getElementsByTagName('a');

                for (i = 0; i < el.length; i += 1) {
                    if (false === url || url === el[i].attributes.href.value) {
                        el[i].target = '_blank';
                    }
                }
            }
        },

        /*
         * this function is called to explicitly remove the target='_blank' as FF holds on to _blank value even
         * after unchecking the checkbox on anchor form
         */
        removeTargetBlank: function (el, anchorUrl) {
            var i;
            if (el.nodeName.toLowerCase() === 'a') {
                el.removeAttribute('target');
            } else {
                el = el.getElementsByTagName('a');

                for (i = 0; i < el.length; i += 1) {
                    if (anchorUrl === el[i].attributes.href.value) {
                        el[i].removeAttribute('target');
                    }
                }
            }
        },

        addClassToAnchors: function (el, buttonClass) {
            var classes = buttonClass.split(' '),
                i,
                j;
            if (el.nodeName.toLowerCase() === 'a') {
                for (j = 0; j < classes.length; j += 1) {
                    el.classList.add(classes[j]);
                }
            } else {
                el = el.getElementsByTagName('a');
                for (i = 0; i < el.length; i += 1) {
                    for (j = 0; j < classes.length; j += 1) {
                        el[i].classList.add(classes[j]);
                    }
                }
            }
        },

        isListItem: function (node) {
            if (!node) {
                return false;
            }
            if (node.nodeName.toLowerCase() === 'li') {
                return true;
            }

            var parentNode = node.parentNode,
                tagName = parentNode.nodeName.toLowerCase();
            while (tagName === 'li' || (!Util.isBlockContainer(parentNode) && tagName !== 'div')) {
                if (tagName === 'li') {
                    return true;
                }
                parentNode = parentNode.parentNode;
                if (parentNode) {
                    tagName = parentNode.nodeName.toLowerCase();
                } else {
                    return false;
                }
            }
            return false;
        },

        cleanListDOM: function (ownerDocument, element) {
            if (element.nodeName.toLowerCase() !== 'li') {
                return;
            }

            var list = element.parentElement;

            if (list.parentElement.nodeName.toLowerCase() === 'p') { // yes we need to clean up
                Util.unwrap(list.parentElement, ownerDocument);

                // move cursor at the end of the text inside the list
                // for some unknown reason, the cursor is moved to end of the "visual" line
                MediumEditor.selection.moveCursor(ownerDocument, element.firstChild, element.firstChild.textContent.length);
            }
        },

        /* splitDOMTree
         *
         * Given a root element some descendant element, split the root element
         * into its own element containing the descendant element and all elements
         * on the left or right side of the descendant ('right' is default)
         *
         * example:
         *
         *         <div>
         *      /    |   \
         *  <span> <span> <span>
         *   / \    / \    / \
         *  1   2  3   4  5   6
         *
         *  If I wanted to split this tree given the <div> as the root and "4" as the leaf
         *  the result would be (the prime ' marks indicates nodes that are created as clones):
         *
         *   SPLITTING OFF 'RIGHT' TREE       SPLITTING OFF 'LEFT' TREE
         *
         *     <div>            <div>'              <div>'      <div>
         *      / \              / \                 / \          |
         * <span> <span>   <span>' <span>       <span> <span>   <span>
         *   / \    |        |      / \           /\     /\       /\
         *  1   2   3        4     5   6         1  2   3  4     5  6
         *
         *  The above example represents splitting off the 'right' or 'left' part of a tree, where
         *  the <div>' would be returned as an element not appended to the DOM, and the <div>
         *  would remain in place where it was
         *
        */
        splitOffDOMTree: function (rootNode, leafNode, splitLeft) {
            var splitOnNode = leafNode,
                createdNode = null,
                splitRight = !splitLeft;

            // loop until we hit the root
            while (splitOnNode !== rootNode) {
                var currParent = splitOnNode.parentNode,
                    newParent = currParent.cloneNode(false),
                    targetNode = (splitRight ? splitOnNode : currParent.firstChild),
                    appendLast;

                // Create a new parent element which is a clone of the current parent
                if (createdNode) {
                    if (splitRight) {
                        // If we're splitting right, add previous created element before siblings
                        newParent.appendChild(createdNode);
                    } else {
                        // If we're splitting left, add previous created element last
                        appendLast = createdNode;
                    }
                }
                createdNode = newParent;

                while (targetNode) {
                    var sibling = targetNode.nextSibling;
                    // Special handling for the 'splitNode'
                    if (targetNode === splitOnNode) {
                        if (!targetNode.hasChildNodes()) {
                            targetNode.parentNode.removeChild(targetNode);
                        } else {
                            // For the node we're splitting on, if it has children, we need to clone it
                            // and not just move it
                            targetNode = targetNode.cloneNode(false);
                        }
                        // If the resulting split node has content, add it
                        if (targetNode.textContent) {
                            createdNode.appendChild(targetNode);
                        }

                        targetNode = (splitRight ? sibling : null);
                    } else {
                        // For general case, just remove the element and only
                        // add it to the split tree if it contains something
                        targetNode.parentNode.removeChild(targetNode);
                        if (targetNode.hasChildNodes() || targetNode.textContent) {
                            createdNode.appendChild(targetNode);
                        }

                        targetNode = sibling;
                    }
                }

                // If we had an element we wanted to append at the end, do that now
                if (appendLast) {
                    createdNode.appendChild(appendLast);
                }

                splitOnNode = currParent;
            }

            return createdNode;
        },

        moveTextRangeIntoElement: function (startNode, endNode, newElement) {
            if (!startNode || !endNode) {
                return false;
            }

            var rootNode = Util.findCommonRoot(startNode, endNode);
            if (!rootNode) {
                return false;
            }

            if (endNode === startNode) {
                var temp = startNode.parentNode,
                    sibling = startNode.nextSibling;
                temp.removeChild(startNode);
                newElement.appendChild(startNode);
                if (sibling) {
                    temp.insertBefore(newElement, sibling);
                } else {
                    temp.appendChild(newElement);
                }
                return newElement.hasChildNodes();
            }

            // create rootChildren array which includes all the children
            // we care about
            var rootChildren = [],
                firstChild,
                lastChild,
                nextNode;
            for (var i = 0; i < rootNode.childNodes.length; i++) {
                nextNode = rootNode.childNodes[i];
                if (!firstChild) {
                    if (Util.isDescendant(nextNode, startNode, true)) {
                        firstChild = nextNode;
                    }
                } else {
                    if (Util.isDescendant(nextNode, endNode, true)) {
                        lastChild = nextNode;
                        break;
                    } else {
                        rootChildren.push(nextNode);
                    }
                }
            }

            var afterLast = lastChild.nextSibling,
                fragment = rootNode.ownerDocument.createDocumentFragment();

            // build up fragment on startNode side of tree
            if (firstChild === startNode) {
                firstChild.parentNode.removeChild(firstChild);
                fragment.appendChild(firstChild);
            } else {
                fragment.appendChild(Util.splitOffDOMTree(firstChild, startNode));
            }

            // add any elements between firstChild & lastChild
            rootChildren.forEach(function (element) {
                element.parentNode.removeChild(element);
                fragment.appendChild(element);
            });

            // build up fragment on endNode side of the tree
            if (lastChild === endNode) {
                lastChild.parentNode.removeChild(lastChild);
                fragment.appendChild(lastChild);
            } else {
                fragment.appendChild(Util.splitOffDOMTree(lastChild, endNode, true));
            }

            // Add fragment into passed in element
            newElement.appendChild(fragment);

            if (lastChild.parentNode === rootNode) {
                // If last child is in the root, insert newElement in front of it
                rootNode.insertBefore(newElement, lastChild);
            } else if (afterLast) {
                // If last child was removed, but it had a sibling, insert in front of it
                rootNode.insertBefore(newElement, afterLast);
            } else {
                // lastChild was removed and was the last actual element just append
                rootNode.appendChild(newElement);
            }

            return newElement.hasChildNodes();
        },

        /* based on http://stackoverflow.com/a/6183069 */
        depthOfNode: function (inNode) {
            var theDepth = 0,
                node = inNode;
            while (node.parentNode !== null) {
                node = node.parentNode;
                theDepth++;
            }
            return theDepth;
        },

        findCommonRoot: function (inNode1, inNode2) {
            var depth1 = Util.depthOfNode(inNode1),
                depth2 = Util.depthOfNode(inNode2),
                node1 = inNode1,
                node2 = inNode2;

            while (depth1 !== depth2) {
                if (depth1 > depth2) {
                    node1 = node1.parentNode;
                    depth1 -= 1;
                } else {
                    node2 = node2.parentNode;
                    depth2 -= 1;
                }
            }

            while (node1 !== node2) {
                node1 = node1.parentNode;
                node2 = node2.parentNode;
            }

            return node1;
        },
        /* END - based on http://stackoverflow.com/a/6183069 */

        isElementAtBeginningOfBlock: function (node) {
            var textVal,
                sibling;
            while (!Util.isBlockContainer(node) && !Util.isMediumEditorElement(node)) {
                sibling = node;
                while (sibling = sibling.previousSibling) {
                    textVal = sibling.nodeType === 3 ? sibling.nodeValue : sibling.textContent;
                    if (textVal.length > 0) {
                        return false;
                    }
                }
                node = node.parentNode;
            }
            return true;
        },

        isMediumEditorElement: function (element) {
            return element && element.getAttribute && !!element.getAttribute('data-medium-editor-element');
        },

        getContainerEditorElement: function (element) {
            return Util.traverseUp(element, function (node) {
                return Util.isMediumEditorElement(node);
            });
        },

        isBlockContainer: function (element) {
            return element && element.nodeType !== 3 && Util.blockContainerElementNames.indexOf(element.nodeName.toLowerCase()) !== -1;
        },

        /* Finds the closest ancestor which is a block container element
         * If element is within editor element but not within any other block element,
         * the editor element is returned
         */
        getClosestBlockContainer: function (node) {
            return Util.traverseUp(node, function (node) {
                return Util.isBlockContainer(node) || Util.isMediumEditorElement(node);
            });
        },

        /* Finds highest level ancestor element which is a block container element
         * If element is within editor element but not within any other block element,
         * the editor element is returned
         */
        getTopBlockContainer: function (element) {
            var topBlock = Util.isBlockContainer(element) ? element : false;
            Util.traverseUp(element, function (el) {
                if (Util.isBlockContainer(el)) {
                    topBlock = el;
                }
                if (!topBlock && Util.isMediumEditorElement(el)) {
                    topBlock = el;
                    return true;
                }
                return false;
            });
            return topBlock;
        },

        getFirstSelectableLeafNode: function (element) {
            while (element && element.firstChild) {
                element = element.firstChild;
            }

            // We don't want to set the selection to an element that can't have children, this messes up Gecko.
            element = Util.traverseUp(element, function (el) {
                return Util.emptyElementNames.indexOf(el.nodeName.toLowerCase()) === -1;
            });
            // Selecting at the beginning of a table doesn't work in PhantomJS.
            if (element.nodeName.toLowerCase() === 'table') {
                var firstCell = element.querySelector('th, td');
                if (firstCell) {
                    element = firstCell;
                }
            }
            return element;
        },

        // TODO: remove getFirstTextNode AND _getFirstTextNode when jumping in 6.0.0 (no code references)
        getFirstTextNode: function (element) {
            Util.warn('getFirstTextNode is deprecated and will be removed in version 6.0.0');
            return Util._getFirstTextNode(element);
        },

        _getFirstTextNode: function (element) {
            if (element.nodeType === 3) {
                return element;
            }

            for (var i = 0; i < element.childNodes.length; i++) {
                var textNode = Util._getFirstTextNode(element.childNodes[i]);
                if (textNode !== null) {
                    return textNode;
                }
            }
            return null;
        },

        ensureUrlHasProtocol: function (url) {
            if (url.indexOf('://') === -1) {
                return 'http://' + url;
            }
            return url;
        },

        warn: function () {
            if (window.console !== undefined && typeof window.console.warn === 'function') {
                window.console.warn.apply(window.console, arguments);
            }
        },

        deprecated: function (oldName, newName, version) {
            // simple deprecation warning mechanism.
            var m = oldName + ' is deprecated, please use ' + newName + ' instead.';
            if (version) {
                m += ' Will be removed in ' + version;
            }
            Util.warn(m);
        },

        deprecatedMethod: function (oldName, newName, args, version) {
            // run the replacement and warn when someone calls a deprecated method
            Util.deprecated(oldName, newName, version);
            if (typeof this[newName] === 'function') {
                this[newName].apply(this, args);
            }
        },

        cleanupAttrs: function (el, attrs) {
            attrs.forEach(function (attr) {
                el.removeAttribute(attr);
            });
        },

        cleanupTags: function (el, tags) {
            tags.forEach(function (tag) {
                if (el.nodeName.toLowerCase() === tag) {
                    el.parentNode.removeChild(el);
                }
            });
        },

        // get the closest parent
        getClosestTag: function (el, tag) {
            return Util.traverseUp(el, function (element) {
                return element.nodeName.toLowerCase() === tag.toLowerCase();
            });
        },

        unwrap: function (el, doc) {
            var fragment = doc.createDocumentFragment(),
                nodes = Array.prototype.slice.call(el.childNodes);

            // cast nodeList to array since appending child
            // to a different node will alter length of el.childNodes
            for (var i = 0; i < nodes.length; i++) {
                fragment.appendChild(nodes[i]);
            }

            if (fragment.childNodes.length) {
                el.parentNode.replaceChild(fragment, el);
            } else {
                el.parentNode.removeChild(el);
            }
        },

        guid: function () {
            function _s4() {
                return Math
                    .floor((1 + Math.random()) * 0x10000)
                    .toString(16)
                    .substring(1);
            }

            return _s4() + _s4() + '-' + _s4() + '-' + _s4() + '-' + _s4() + '-' + _s4() + _s4() + _s4();
        }
    };

    MediumEditor.util = Util;
}(window));

(function () {
    'use strict';

    var Extension = function (options) {
        MediumEditor.util.extend(this, options);
    };

    Extension.extend = function (protoProps) {
        // magic extender thinger. mostly borrowed from backbone/goog.inherits
        // place this function on some thing you want extend-able.
        //
        // example:
        //
        //      function Thing(args){
        //          this.options = args;
        //      }
        //
        //      Thing.prototype = { foo: "bar" };
        //      Thing.extend = extenderify;
        //
        //      var ThingTwo = Thing.extend({ foo: "baz" });
        //
        //      var thingOne = new Thing(); // foo === "bar"
        //      var thingTwo = new ThingTwo(); // foo === "baz"
        //
        //      which seems like some simply shallow copy nonsense
        //      at first, but a lot more is going on there.
        //
        //      passing a `constructor` to the extend props
        //      will cause the instance to instantiate through that
        //      instead of the parent's constructor.

        var parent = this,
            child;

        // The constructor function for the new subclass is either defined by you
        // (the "constructor" property in your `extend` definition), or defaulted
        // by us to simply call the parent's constructor.

        if (protoProps && protoProps.hasOwnProperty('constructor')) {
            child = protoProps.constructor;
        } else {
            child = function () {
                return parent.apply(this, arguments);
            };
        }

        // das statics (.extend comes over, so your subclass can have subclasses too)
        MediumEditor.util.extend(child, parent);

        // Set the prototype chain to inherit from `parent`, without calling
        // `parent`'s constructor function.
        var Surrogate = function () {
            this.constructor = child;
        };
        Surrogate.prototype = parent.prototype;
        child.prototype = new Surrogate();

        if (protoProps) {
            MediumEditor.util.extend(child.prototype, protoProps);
        }

        // todo: $super?

        return child;
    };

    Extension.prototype = {
        /* init: [function]
         *
         * Called by MediumEditor during initialization.
         * The .base property will already have been set to
         * current instance of MediumEditor when this is called.
         * All helper methods will exist as well
         */
        init: function () {},

        /* base: [MediumEditor instance]
         *
         * If not overriden, this will be set to the current instance
         * of MediumEditor, before the init method is called
         */
        base: undefined,

        /* name: [string]
         *
         * 'name' of the extension, used for retrieving the extension.
         * If not set, MediumEditor will set this to be the key
         * used when passing the extension into MediumEditor via the
         * 'extensions' option
         */
        name: undefined,

        /* checkState: [function (node)]
         *
         * If implemented, this function will be called one or more times
         * the state of the editor & toolbar are updated.
         * When the state is updated, the editor does the following:
         *
         * 1) Find the parent node containing the current selection
         * 2) Call checkState on the extension, passing the node as an argument
         * 3) Get the parent node of the previous node
         * 4) Repeat steps #2 and #3 until we move outside the parent contenteditable
         */
        checkState: undefined,

        /* destroy: [function ()]
         *
         * This method should remove any created html, custom event handlers
         * or any other cleanup tasks that should be performed.
         * If implemented, this function will be called when MediumEditor's
         * destroy method has been called.
         */
        destroy: undefined,

        /* As alternatives to checkState, these functions provide a more structured
         * path to updating the state of an extension (usually a button) whenever
         * the state of the editor & toolbar are updated.
         */

        /* queryCommandState: [function ()]
         *
         * If implemented, this function will be called once on each extension
         * when the state of the editor/toolbar is being updated.
         *
         * If this function returns a non-null value, the extension will
         * be ignored as the code climbs the dom tree.
         *
         * If this function returns true, and the setActive() function is defined
         * setActive() will be called
         */
        queryCommandState: undefined,

        /* isActive: [function ()]
         *
         * If implemented, this function will be called when MediumEditor
         * has determined that this extension is 'active' for the current selection.
         * This may be called when the editor & toolbar are being updated,
         * but only if queryCommandState() or isAlreadyApplied() functions
         * are implemented, and when called, return true.
         */
        isActive: undefined,

        /* isAlreadyApplied: [function (node)]
         *
         * If implemented, this function is similar to checkState() in
         * that it will be called repeatedly as MediumEditor moves up
         * the DOM to update the editor & toolbar after a state change.
         *
         * NOTE: This function will NOT be called if checkState() has
         * been implemented. This function will NOT be called if
         * queryCommandState() is implemented and returns a non-null
         * value when called
         */
        isAlreadyApplied: undefined,

        /* setActive: [function ()]
         *
         * If implemented, this function is called when MediumEditor knows
         * that this extension is currently enabled.  Currently, this
         * function is called when updating the editor & toolbar, and
         * only if queryCommandState() or isAlreadyApplied(node) return
         * true when called
         */
        setActive: undefined,

        /* setInactive: [function ()]
         *
         * If implemented, this function is called when MediumEditor knows
         * that this extension is currently disabled.  Curently, this
         * is called at the beginning of each state change for
         * the editor & toolbar. After calling this, MediumEditor
         * will attempt to update the extension, either via checkState()
         * or the combination of queryCommandState(), isAlreadyApplied(node),
         * isActive(), and setActive()
         */
        setInactive: undefined,

        /* getInteractionElements: [function ()]
         *
         * If the extension renders any elements that the user can interact with,
         * this method should be implemented and return the root element or an array
         * containing all of the root elements. MediumEditor will call this function
         * during interaction to see if the user clicked on something outside of the editor.
         * The elements are used to check if the target element of a click or
         * other user event is a descendant of any extension elements.
         * This way, the editor can also count user interaction within editor elements as
         * interactions with the editor, and thus not trigger 'blur'
         */
        getInteractionElements: undefined,

        /************************ Helpers ************************
         * The following are helpers that are either set by MediumEditor
         * during initialization, or are helper methods which either
         * route calls to the MediumEditor instance or provide common
         * functionality for all extensions
         *********************************************************/

        /* window: [Window]
         *
         * If not overriden, this will be set to the window object
         * to be used by MediumEditor and its extensions.  This is
         * passed via the 'contentWindow' option to MediumEditor
         * and is the global 'window' object by default
         */
        'window': undefined,

        /* document: [Document]
         *
         * If not overriden, this will be set to the document object
         * to be used by MediumEditor and its extensions. This is
         * passed via the 'ownerDocument' optin to MediumEditor
         * and is the global 'document' object by default
         */
        'document': undefined,

        /* getEditorElements: [function ()]
         *
         * Helper function which returns an array containing
         * all the contenteditable elements for this instance
         * of MediumEditor
         */
        getEditorElements: function () {
            return this.base.elements;
        },

        /* getEditorId: [function ()]
         *
         * Helper function which returns a unique identifier
         * for this instance of MediumEditor
         */
        getEditorId: function () {
            return this.base.id;
        },

        /* getEditorOptions: [function (option)]
         *
         * Helper function which returns the value of an option
         * used to initialize this instance of MediumEditor
         */
        getEditorOption: function (option) {
            return this.base.options[option];
        }
    };

    /* List of method names to add to the prototype of Extension
     * Each of these methods will be defined as helpers that
     * just call directly into the MediumEditor instance.
     *
     * example for 'on' method:
     * Extension.prototype.on = function () {
     *     return this.base.on.apply(this.base, arguments);
     * }
     */
    [
        // general helpers
        'execAction',

        // event handling
        'on',
        'off',
        'subscribe',
        'trigger'

    ].forEach(function (helper) {
        Extension.prototype[helper] = function () {
            return this.base[helper].apply(this.base, arguments);
        };
    });

    MediumEditor.Extension = Extension;
})();

(function () {
    'use strict';

    function filterOnlyParentElements(node) {
        if (MediumEditor.util.isBlockContainer(node)) {
            return NodeFilter.FILTER_ACCEPT;
        } else {
            return NodeFilter.FILTER_SKIP;
        }
    }

    var Selection = {
        findMatchingSelectionParent: function (testElementFunction, contentWindow) {
            var selection = contentWindow.getSelection(),
                range,
                current;

            if (selection.rangeCount === 0) {
                return false;
            }

            range = selection.getRangeAt(0);
            current = range.commonAncestorContainer;

            return MediumEditor.util.traverseUp(current, testElementFunction);
        },

        getSelectionElement: function (contentWindow) {
            return this.findMatchingSelectionParent(function (el) {
                return MediumEditor.util.isMediumEditorElement(el);
            }, contentWindow);
        },

        // http://stackoverflow.com/questions/17678843/cant-restore-selection-after-html-modify-even-if-its-the-same-html
        // Tim Down
        exportSelection: function (root, doc) {
            if (!root) {
                return null;
            }

            var selectionState = null,
                selection = doc.getSelection();

            if (selection.rangeCount > 0) {
                var range = selection.getRangeAt(0),
                    preSelectionRange = range.cloneRange(),
                    start;

                preSelectionRange.selectNodeContents(root);
                preSelectionRange.setEnd(range.startContainer, range.startOffset);
                start = preSelectionRange.toString().length;

                selectionState = {
                    start: start,
                    end: start + range.toString().length
                };

                // Check to see if the selection starts with any images
                // if so we need to make sure the the beginning of the selection is
                // set correctly when importing selection
                if (this.doesRangeStartWithImages(range, doc)) {
                    selectionState.startsWithImage = true;
                }

                // Check to see if the selection has any trailing images
                // if so, this this means we need to look for them when we import selection
                var trailingImageCount = this.getTrailingImageCount(root, selectionState, range.endContainer, range.endOffset);
                if (trailingImageCount) {
                    selectionState.trailingImageCount = trailingImageCount;
                }

                // If start = 0 there may still be an empty paragraph before it, but we don't care.
                if (start !== 0) {
                    var emptyBlocksIndex = this.getIndexRelativeToAdjacentEmptyBlocks(doc, root, range.startContainer, range.startOffset);
                    if (emptyBlocksIndex !== -1) {
                        selectionState.emptyBlocksIndex = emptyBlocksIndex;
                    }
                }
            }

            return selectionState;
        },

        // http://stackoverflow.com/questions/17678843/cant-restore-selection-after-html-modify-even-if-its-the-same-html
        // Tim Down
        //
        // {object} selectionState - the selection to import
        // {DOMElement} root - the root element the selection is being restored inside of
        // {Document} doc - the document to use for managing selection
        // {boolean} [favorLaterSelectionAnchor] - defaults to false. If true, import the cursor immediately
        //      subsequent to an anchor tag if it would otherwise be placed right at the trailing edge inside the
        //      anchor. This cursor positioning, even though visually equivalent to the user, can affect behavior
        //      in MS IE.
        importSelection: function (selectionState, root, doc, favorLaterSelectionAnchor) {
            if (!selectionState || !root) {
                return;
            }

            var range = doc.createRange();
            range.setStart(root, 0);
            range.collapse(true);

            var node = root,
                nodeStack = [],
                charIndex = 0,
                foundStart = false,
                foundEnd = false,
                trailingImageCount = 0,
                stop = false,
                nextCharIndex,
                allowRangeToStartAtEndOfNode = false,
                lastTextNode = null;

            // When importing selection, the start of the selection may lie at the end of an element
            // or at the beginning of an element.  Since visually there is no difference between these 2
            // we will try to move the selection to the beginning of an element since this is generally
            // what users will expect and it's a more predictable behavior.
            //
            // However, there are some specific cases when we don't want to do this:
            //  1) We're attempting to move the cursor outside of the end of an anchor [favorLaterSelectionAnchor = true]
            //  2) The selection starts with an image, which is special since an image doesn't have any 'content'
            //     as far as selection and ranges are concerned
            //  3) The selection starts after a specified number of empty block elements (selectionState.emptyBlocksIndex)
            //
            // For these cases, we want the selection to start at a very specific location, so we should NOT
            // automatically move the cursor to the beginning of the first actual chunk of text
            if (favorLaterSelectionAnchor || selectionState.startsWithImage || typeof selectionState.emptyBlocksIndex !== 'undefined') {
                allowRangeToStartAtEndOfNode = true;
            }

            while (!stop && node) {
                // Only iterate over elements and text nodes
                if (node.nodeType > 3) {
                    node = nodeStack.pop();
                    continue;
                }

                // If we hit a text node, we need to add the amount of characters to the overall count
                if (node.nodeType === 3 && !foundEnd) {
                    nextCharIndex = charIndex + node.length;
                    // Check if we're at or beyond the start of the selection we're importing
                    if (!foundStart && selectionState.start >= charIndex && selectionState.start <= nextCharIndex) {
                        // NOTE: We only want to allow a selection to start at the END of an element if
                        //  allowRangeToStartAtEndOfNode is true
                        if (allowRangeToStartAtEndOfNode || selectionState.start < nextCharIndex) {
                            range.setStart(node, selectionState.start - charIndex);
                            foundStart = true;
                        }
                        // We're at the end of a text node where the selection could start but we shouldn't
                        // make the selection start here because allowRangeToStartAtEndOfNode is false.
                        // However, we should keep a reference to this node in case there aren't any more
                        // text nodes after this, so that we have somewhere to import the selection to
                        else {
                            lastTextNode = node;
                        }
                    }
                    // We've found the start of the selection, check if we're at or beyond the end of the selection we're importing
                    if (foundStart && selectionState.end >= charIndex && selectionState.end <= nextCharIndex) {
                        if (!selectionState.trailingImageCount) {
                            range.setEnd(node, selectionState.end - charIndex);
                            stop = true;
                        } else {
                            foundEnd = true;
                        }
                    }
                    charIndex = nextCharIndex;
                } else {
                    if (selectionState.trailingImageCount && foundEnd) {
                        if (node.nodeName.toLowerCase() === 'img') {
                            trailingImageCount++;
                        }
                        if (trailingImageCount === selectionState.trailingImageCount) {
                            // Find which index the image is in its parent's children
                            var endIndex = 0;
                            while (node.parentNode.childNodes[endIndex] !== node) {
                                endIndex++;
                            }
                            range.setEnd(node.parentNode, endIndex + 1);
                            stop = true;
                        }
                    }

                    if (!stop && node.nodeType === 1) {
                        // this is an element
                        // add all its children to the stack
                        var i = node.childNodes.length - 1;
                        while (i >= 0) {
                            nodeStack.push(node.childNodes[i]);
                            i -= 1;
                        }
                    }
                }

                if (!stop) {
                    node = nodeStack.pop();
                }
            }

            // If we've gone through the entire text but didn't find the beginning of a text node
            // to make the selection start at, we should fall back to starting the selection
            // at the END of the last text node we found
            if (!foundStart && lastTextNode) {
                range.setStart(lastTextNode, lastTextNode.length);
                range.setEnd(lastTextNode, lastTextNode.length);
            }

            if (typeof selectionState.emptyBlocksIndex !== 'undefined') {
                range = this.importSelectionMoveCursorPastBlocks(doc, root, selectionState.emptyBlocksIndex, range);
            }

            // If the selection is right at the ending edge of a link, put it outside the anchor tag instead of inside.
            if (favorLaterSelectionAnchor) {
                range = this.importSelectionMoveCursorPastAnchor(selectionState, range);
            }

            this.selectRange(doc, range);
        },

        // Utility method called from importSelection only
        importSelectionMoveCursorPastAnchor: function (selectionState, range) {
            var nodeInsideAnchorTagFunction = function (node) {
                return node.nodeName.toLowerCase() === 'a';
            };
            if (selectionState.start === selectionState.end &&
                    range.startContainer.nodeType === 3 &&
                    range.startOffset === range.startContainer.nodeValue.length &&
                    MediumEditor.util.traverseUp(range.startContainer, nodeInsideAnchorTagFunction)) {
                var prevNode = range.startContainer,
                    currentNode = range.startContainer.parentNode;
                while (currentNode !== null && currentNode.nodeName.toLowerCase() !== 'a') {
                    if (currentNode.childNodes[currentNode.childNodes.length - 1] !== prevNode) {
                        currentNode = null;
                    } else {
                        prevNode = currentNode;
                        currentNode = currentNode.parentNode;
                    }
                }
                if (currentNode !== null && currentNode.nodeName.toLowerCase() === 'a') {
                    var currentNodeIndex = null;
                    for (var i = 0; currentNodeIndex === null && i < currentNode.parentNode.childNodes.length; i++) {
                        if (currentNode.parentNode.childNodes[i] === currentNode) {
                            currentNodeIndex = i;
                        }
                    }
                    range.setStart(currentNode.parentNode, currentNodeIndex + 1);
                    range.collapse(true);
                }
            }
            return range;
        },

        // Uses the emptyBlocksIndex calculated by getIndexRelativeToAdjacentEmptyBlocks
        // to move the cursor back to the start of the correct paragraph
        importSelectionMoveCursorPastBlocks: function (doc, root, index, range) {
            var treeWalker = doc.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, filterOnlyParentElements, false),
                startContainer = range.startContainer,
                startBlock,
                targetNode,
                currIndex = 0;
            index = index || 1; // If index is 0, we still want to move to the next block

            // Chrome counts newlines and spaces that separate block elements as actual elements.
            // If the selection is inside one of these text nodes, and it has a previous sibling
            // which is a block element, we want the treewalker to start at the previous sibling
            // and NOT at the parent of the textnode
            if (startContainer.nodeType === 3 && MediumEditor.util.isBlockContainer(startContainer.previousSibling)) {
                startBlock = startContainer.previousSibling;
            } else {
                startBlock = MediumEditor.util.getClosestBlockContainer(startContainer);
            }

            // Skip over empty blocks until we hit the block we want the selection to be in
            while (treeWalker.nextNode()) {
                if (!targetNode) {
                    // Loop through all blocks until we hit the starting block element
                    if (startBlock === treeWalker.currentNode) {
                        targetNode = treeWalker.currentNode;
                    }
                } else {
                    targetNode = treeWalker.currentNode;
                    currIndex++;
                    // We hit the target index, bail
                    if (currIndex === index) {
                        break;
                    }
                    // If we find a non-empty block, ignore the emptyBlocksIndex and just put selection here
                    if (targetNode.textContent.length > 0) {
                        break;
                    }
                }
            }

            if (!targetNode) {
                targetNode = startBlock;
            }

            // We're selecting a high-level block node, so make sure the cursor gets moved into the deepest
            // element at the beginning of the block
            range.setStart(MediumEditor.util.getFirstSelectableLeafNode(targetNode), 0);

            return range;
        },

        // Returns -1 unless the cursor is at the beginning of a paragraph/block
        // If the paragraph/block is preceeded by empty paragraphs/block (with no text)
        // it will return the number of empty paragraphs before the cursor.
        // Otherwise, it will return 0, which indicates the cursor is at the beginning
        // of a paragraph/block, and not at the end of the paragraph/block before it
        getIndexRelativeToAdjacentEmptyBlocks: function (doc, root, cursorContainer, cursorOffset) {
            // If there is text in front of the cursor, that means there isn't only empty blocks before it
            if (cursorContainer.textContent.length > 0 && cursorOffset > 0) {
                return -1;
            }

            // Check if the block that contains the cursor has any other text in front of the cursor
            var node = cursorContainer;
            if (node.nodeType !== 3) {
                node = cursorContainer.childNodes[cursorOffset];
            }
            if (node) {
                // The element isn't at the beginning of a block, so it has content before it
                if (!MediumEditor.util.isElementAtBeginningOfBlock(node)) {
                    return -1;
                }

                var previousSibling = MediumEditor.util.findPreviousSibling(node);
                // If there is no previous sibling, this is the first text element in the editor
                if (!previousSibling) {
                    return -1;
                }
                // If the previous sibling has text, then there are no empty blocks before this
                else if (previousSibling.nodeValue) {
                    return -1;
                }
            }

            // Walk over block elements, counting number of empty blocks between last piece of text
            // and the block the cursor is in
            var closestBlock = MediumEditor.util.getClosestBlockContainer(cursorContainer),
                treeWalker = doc.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, filterOnlyParentElements, false),
                emptyBlocksCount = 0;
            while (treeWalker.nextNode()) {
                var blockIsEmpty = treeWalker.currentNode.textContent === '';
                if (blockIsEmpty || emptyBlocksCount > 0) {
                    emptyBlocksCount += 1;
                }
                if (treeWalker.currentNode === closestBlock) {
                    return emptyBlocksCount;
                }
                if (!blockIsEmpty) {
                    emptyBlocksCount = 0;
                }
            }

            return emptyBlocksCount;
        },

        // Returns true if the selection range begins with an image tag
        // Returns false if the range starts with any non empty text nodes
        doesRangeStartWithImages: function (range, doc) {
            if (range.startOffset !== 0 || range.startContainer.nodeType !== 1) {
                return false;
            }

            if (range.startContainer.nodeName.toLowerCase() === 'img') {
                return true;
            }

            var img = range.startContainer.querySelector('img');
            if (!img) {
                return false;
            }

            var treeWalker = doc.createTreeWalker(range.startContainer, NodeFilter.SHOW_ALL, null, false);
            while (treeWalker.nextNode()) {
                var next = treeWalker.currentNode;
                // If we hit the image, then there isn't any text before the image so
                // the image is at the beginning of the range
                if (next === img) {
                    break;
                }
                // If we haven't hit the iamge, but found text that contains content
                // then the range doesn't start with an image
                if (next.nodeValue) {
                    return false;
                }
            }

            return true;
        },

        getTrailingImageCount: function (root, selectionState, endContainer, endOffset) {
            // If the endOffset of a range is 0, the endContainer doesn't contain images
            // If the endContainer is a text node, there are no trailing images
            if (endOffset === 0 || endContainer.nodeType !== 1) {
                return 0;
            }

            // If the endContainer isn't an image, and doesn't have an image descendants
            // there are no trailing images
            if (endContainer.nodeName.toLowerCase() !== 'img' && !endContainer.querySelector('img')) {
                return 0;
            }

            var lastNode = endContainer.childNodes[endOffset - 1];
            while (lastNode.hasChildNodes()) {
                lastNode = lastNode.lastChild;
            }

            var node = root,
                nodeStack = [],
                charIndex = 0,
                foundStart = false,
                foundEnd = false,
                stop = false,
                nextCharIndex,
                trailingImages = 0;

            while (!stop && node) {
                // Only iterate over elements and text nodes
                if (node.nodeType > 3) {
                    node = nodeStack.pop();
                    continue;
                }

                if (node.nodeType === 3 && !foundEnd) {
                    trailingImages = 0;
                    nextCharIndex = charIndex + node.length;
                    if (!foundStart && selectionState.start >= charIndex && selectionState.start <= nextCharIndex) {
                        foundStart = true;
                    }
                    if (foundStart && selectionState.end >= charIndex && selectionState.end <= nextCharIndex) {
                        foundEnd = true;
                    }
                    charIndex = nextCharIndex;
                } else {
                    if (node.nodeName.toLowerCase() === 'img') {
                        trailingImages++;
                    }

                    if (node === lastNode) {
                        stop = true;
                    } else if (node.nodeType === 1) {
                        // this is an element
                        // add all its children to the stack
                        var i = node.childNodes.length - 1;
                        while (i >= 0) {
                            nodeStack.push(node.childNodes[i]);
                            i -= 1;
                        }
                    }
                }

                if (!stop) {
                    node = nodeStack.pop();
                }
            }

            return trailingImages;
        },

        // determine if the current selection contains any 'content'
        // content being any non-white space text or an image
        selectionContainsContent: function (doc) {
            var sel = doc.getSelection();

            // collapsed selection or selection withour range doesn't contain content
            if (!sel || sel.isCollapsed || !sel.rangeCount) {
                return false;
            }

            // if toString() contains any text, the selection contains some content
            if (sel.toString().trim() !== '') {
                return true;
            }

            // if selection contains only image(s), it will return empty for toString()
            // so check for an image manually
            var selectionNode = this.getSelectedParentElement(sel.getRangeAt(0));
            if (selectionNode) {
                if (selectionNode.nodeName.toLowerCase() === 'img' ||
                    (selectionNode.nodeType === 1 && selectionNode.querySelector('img'))) {
                    return true;
                }
            }

            return false;
        },

        selectionInContentEditableFalse: function (contentWindow) {
            // determine if the current selection is exclusively inside
            // a contenteditable="false", though treat the case of an
            // explicit contenteditable="true" inside a "false" as false.
            var sawtrue,
                sawfalse = this.findMatchingSelectionParent(function (el) {
                    var ce = el && el.getAttribute('contenteditable');
                    if (ce === 'true') {
                        sawtrue = true;
                    }
                    return el.nodeName !== '#text' && ce === 'false';
                }, contentWindow);

            return !sawtrue && sawfalse;
        },

        // http://stackoverflow.com/questions/4176923/html-of-selected-text
        // by Tim Down
        getSelectionHtml: function getSelectionHtml(doc) {
            var i,
                html = '',
                sel = doc.getSelection(),
                len,
                container;
            if (sel.rangeCount) {
                container = doc.createElement('div');
                for (i = 0, len = sel.rangeCount; i < len; i += 1) {
                    container.appendChild(sel.getRangeAt(i).cloneContents());
                }
                html = container.innerHTML;
            }
            return html;
        },

        /**
         *  Find the caret position within an element irrespective of any inline tags it may contain.
         *
         *  @param {DOMElement} An element containing the cursor to find offsets relative to.
         *  @param {Range} A Range representing cursor position. Will window.getSelection if none is passed.
         *  @return {Object} 'left' and 'right' attributes contain offsets from begining and end of Element
         */
        getCaretOffsets: function getCaretOffsets(element, range) {
            var preCaretRange, postCaretRange;

            if (!range) {
                range = window.getSelection().getRangeAt(0);
            }

            preCaretRange = range.cloneRange();
            postCaretRange = range.cloneRange();

            preCaretRange.selectNodeContents(element);
            preCaretRange.setEnd(range.endContainer, range.endOffset);

            postCaretRange.selectNodeContents(element);
            postCaretRange.setStart(range.endContainer, range.endOffset);

            return {
                left: preCaretRange.toString().length,
                right: postCaretRange.toString().length
            };
        },

        // http://stackoverflow.com/questions/15867542/range-object-get-selection-parent-node-chrome-vs-firefox
        rangeSelectsSingleNode: function (range) {
            var startNode = range.startContainer;
            return startNode === range.endContainer &&
                startNode.hasChildNodes() &&
                range.endOffset === range.startOffset + 1;
        },

        getSelectedParentElement: function (range) {
            if (!range) {
                return null;
            }

            // Selection encompasses a single element
            if (this.rangeSelectsSingleNode(range) && range.startContainer.childNodes[range.startOffset].nodeType !== 3) {
                return range.startContainer.childNodes[range.startOffset];
            }

            // Selection range starts inside a text node, so get its parent
            if (range.startContainer.nodeType === 3) {
                return range.startContainer.parentNode;
            }

            // Selection starts inside an element
            return range.startContainer;
        },

        getSelectedElements: function (doc) {
            var selection = doc.getSelection(),
                range,
                toRet,
                currNode;

            if (!selection.rangeCount || selection.isCollapsed || !selection.getRangeAt(0).commonAncestorContainer) {
                return [];
            }

            range = selection.getRangeAt(0);

            if (range.commonAncestorContainer.nodeType === 3) {
                toRet = [];
                currNode = range.commonAncestorContainer;
                while (currNode.parentNode && currNode.parentNode.childNodes.length === 1) {
                    toRet.push(currNode.parentNode);
                    currNode = currNode.parentNode;
                }

                return toRet;
            }

            return [].filter.call(range.commonAncestorContainer.getElementsByTagName('*'), function (el) {
                return (typeof selection.containsNode === 'function') ? selection.containsNode(el, true) : true;
            });
        },

        selectNode: function (node, doc) {
            var range = doc.createRange();
            range.selectNodeContents(node);
            this.selectRange(doc, range);
        },

        select: function (doc, startNode, startOffset, endNode, endOffset) {
            var range = doc.createRange();
            range.setStart(startNode, startOffset);
            if (endNode) {
                range.setEnd(endNode, endOffset);
            } else {
                range.collapse(true);
            }
            this.selectRange(doc, range);
            return range;
        },

        /**
         *  Clear the current highlighted selection and set the caret to the start or the end of that prior selection, defaults to end.
         *
         *  @param {DomDocument} doc            Current document
         *  @param {boolean} moveCursorToStart  A boolean representing whether or not to set the caret to the beginning of the prior selection.
         */
        clearSelection: function (doc, moveCursorToStart) {
            if (moveCursorToStart) {
                doc.getSelection().collapseToStart();
            } else {
                doc.getSelection().collapseToEnd();
            }
        },

        /**
         * Move cursor to the given node with the given offset.
         *
         * @param  {DomDocument} doc     Current document
         * @param  {DomElement}  node    Element where to jump
         * @param  {integer}     offset  Where in the element should we jump, 0 by default
         */
        moveCursor: function (doc, node, offset) {
            this.select(doc, node, offset);
        },

        getSelectionRange: function (ownerDocument) {
            var selection = ownerDocument.getSelection();
            if (selection.rangeCount === 0) {
                return null;
            }
            return selection.getRangeAt(0);
        },

        selectRange: function (ownerDocument, range) {
            var selection = ownerDocument.getSelection();

            selection.removeAllRanges();
            selection.addRange(range);
        },

        // http://stackoverflow.com/questions/1197401/how-can-i-get-the-element-the-caret-is-in-with-javascript-when-using-contentedi
        // by You
        getSelectionStart: function (ownerDocument) {
            var node = ownerDocument.getSelection().anchorNode,
                startNode = (node && node.nodeType === 3 ? node.parentNode : node);

            return startNode;
        }
    };

    MediumEditor.selection = Selection;
}());

(function () {
    'use strict';

    function isElementDescendantOfExtension(extensions, element) {
        return extensions.some(function (extension) {
            if (typeof extension.getInteractionElements !== 'function') {
                return false;
            }

            var extensionElements = extension.getInteractionElements();
            if (!extensionElements) {
                return false;
            }

            if (!Array.isArray(extensionElements)) {
                extensionElements = [extensionElements];
            }
            return extensionElements.some(function (el) {
                return MediumEditor.util.isDescendant(el, element, true);
            });
        });
    }

    var Events = function (instance) {
        this.base = instance;
        this.options = this.base.options;
        this.events = [];
        this.disabledEvents = {};
        this.customEvents = {};
        this.listeners = {};
    };

    Events.prototype = {
        InputEventOnContenteditableSupported: !MediumEditor.util.isIE && !MediumEditor.util.isEdge,

        // Helpers for event handling

        attachDOMEvent: function (targets, event, listener, useCapture) {
            targets = MediumEditor.util.isElement(targets) || [window, document].indexOf(targets) > -1 ? [targets] : targets;

            Array.prototype.forEach.call(targets, function (target) {
                target.addEventListener(event, listener, useCapture);
                this.events.push([target, event, listener, useCapture]);
            }.bind(this));
        },

        detachDOMEvent: function (targets, event, listener, useCapture) {
            var index, e;
            targets = MediumEditor.util.isElement(targets) || [window, document].indexOf(targets) > -1 ? [targets] : targets;

            Array.prototype.forEach.call(targets, function (target) {
                index = this.indexOfListener(target, event, listener, useCapture);
                if (index !== -1) {
                    e = this.events.splice(index, 1)[0];
                    e[0].removeEventListener(e[1], e[2], e[3]);
                }
            }.bind(this));
        },

        indexOfListener: function (target, event, listener, useCapture) {
            var i, n, item;
            for (i = 0, n = this.events.length; i < n; i = i + 1) {
                item = this.events[i];
                if (item[0] === target && item[1] === event && item[2] === listener && item[3] === useCapture) {
                    return i;
                }
            }
            return -1;
        },

        detachAllDOMEvents: function () {
            var e = this.events.pop();
            while (e) {
                e[0].removeEventListener(e[1], e[2], e[3]);
                e = this.events.pop();
            }
        },

        detachAllEventsFromElement: function (element) {
            var filtered = this.events.filter(function (e) {
                return e && e[0].getAttribute && e[0].getAttribute('medium-editor-index') === element.getAttribute('medium-editor-index');
            });

            for (var i = 0, len = filtered.length; i < len; i++) {
                var e = filtered[i];
                this.detachDOMEvent(e[0], e[1], e[2], e[3]);
            }
        },

        // Attach all existing handlers to a new element
        attachAllEventsToElement: function (element) {
            if (this.listeners['editableInput']) {
                this.contentCache[element.getAttribute('medium-editor-index')] = element.innerHTML;
            }

            if (this.eventsCache) {
                this.eventsCache.forEach(function (e) {
                    this.attachDOMEvent(element, e['name'], e['handler'].bind(this));
                }, this);
            }
        },

        enableCustomEvent: function (event) {
            if (this.disabledEvents[event] !== undefined) {
                delete this.disabledEvents[event];
            }
        },

        disableCustomEvent: function (event) {
            this.disabledEvents[event] = true;
        },

        // custom events
        attachCustomEvent: function (event, listener) {
            this.setupListener(event);
            if (!this.customEvents[event]) {
                this.customEvents[event] = [];
            }
            this.customEvents[event].push(listener);
        },

        detachCustomEvent: function (event, listener) {
            var index = this.indexOfCustomListener(event, listener);
            if (index !== -1) {
                this.customEvents[event].splice(index, 1);
                // TODO: If array is empty, should detach internal listeners via destroyListener()
            }
        },

        indexOfCustomListener: function (event, listener) {
            if (!this.customEvents[event] || !this.customEvents[event].length) {
                return -1;
            }

            return this.customEvents[event].indexOf(listener);
        },

        detachAllCustomEvents: function () {
            this.customEvents = {};
            // TODO: Should detach internal listeners here via destroyListener()
        },

        triggerCustomEvent: function (name, data, editable) {
            if (this.customEvents[name] && !this.disabledEvents[name]) {
                this.customEvents[name].forEach(function (listener) {
                    listener(data, editable);
                });
            }
        },

        // Cleaning up

        destroy: function () {
            this.detachAllDOMEvents();
            this.detachAllCustomEvents();
            this.detachExecCommand();

            if (this.base.elements) {
                this.base.elements.forEach(function (element) {
                    element.removeAttribute('data-medium-focused');
                });
            }
        },

        // Listening to calls to document.execCommand

        // Attach a listener to be notified when document.execCommand is called
        attachToExecCommand: function () {
            if (this.execCommandListener) {
                return;
            }

            // Store an instance of the listener so:
            // 1) We only attach to execCommand once
            // 2) We can remove the listener later
            this.execCommandListener = function (execInfo) {
                this.handleDocumentExecCommand(execInfo);
            }.bind(this);

            // Ensure that execCommand has been wrapped correctly
            this.wrapExecCommand();

            // Add listener to list of execCommand listeners
            this.options.ownerDocument.execCommand.listeners.push(this.execCommandListener);
        },

        // Remove our listener for calls to document.execCommand
        detachExecCommand: function () {
            var doc = this.options.ownerDocument;
            if (!this.execCommandListener || !doc.execCommand.listeners) {
                return;
            }

            // Find the index of this listener in the array of listeners so it can be removed
            var index = doc.execCommand.listeners.indexOf(this.execCommandListener);
            if (index !== -1) {
                doc.execCommand.listeners.splice(index, 1);
            }

            // If the list of listeners is now empty, put execCommand back to its original state
            if (!doc.execCommand.listeners.length) {
                this.unwrapExecCommand();
            }
        },

        // Wrap document.execCommand in a custom method so we can listen to calls to it
        wrapExecCommand: function () {
            var doc = this.options.ownerDocument;

            // Ensure all instance of MediumEditor only wrap execCommand once
            if (doc.execCommand.listeners) {
                return;
            }

            // Helper method to call all listeners to execCommand
            var callListeners = function (args, result) {
                    if (doc.execCommand.listeners) {
                        doc.execCommand.listeners.forEach(function (listener) {
                            listener({
                                command: args[0],
                                value: args[2],
                                args: args,
                                result: result
                            });
                        });
                    }
                },

            // Create a wrapper method for execCommand which will:
            // 1) Call document.execCommand with the correct arguments
            // 2) Loop through any listeners and notify them that execCommand was called
            //    passing extra info on the call
            // 3) Return the result
                wrapper = function () {
                    var result = doc.execCommand.orig.apply(this, arguments);

                    if (!doc.execCommand.listeners) {
                        return result;
                    }

                    var args = Array.prototype.slice.call(arguments);
                    callListeners(args, result);

                    return result;
                };

            // Store a reference to the original execCommand
            wrapper.orig = doc.execCommand;

            // Attach an array for storing listeners
            wrapper.listeners = [];

            // Helper for notifying listeners
            wrapper.callListeners = callListeners;

            // Overwrite execCommand
            doc.execCommand = wrapper;
        },

        // Revert document.execCommand back to its original self
        unwrapExecCommand: function () {
            var doc = this.options.ownerDocument;
            if (!doc.execCommand.orig) {
                return;
            }

            // Use the reference to the original execCommand to revert back
            doc.execCommand = doc.execCommand.orig;
        },

        // Listening to browser events to emit events medium-editor cares about
        setupListener: function (name) {
            if (this.listeners[name]) {
                return;
            }

            switch (name) {
                case 'externalInteraction':
                    // Detecting when user has interacted with elements outside of MediumEditor
                    this.attachDOMEvent(this.options.ownerDocument.body, 'mousedown', this.handleBodyMousedown.bind(this), true);
                    this.attachDOMEvent(this.options.ownerDocument.body, 'click', this.handleBodyClick.bind(this), true);
                    this.attachDOMEvent(this.options.ownerDocument.body, 'focus', this.handleBodyFocus.bind(this), true);
                    break;
                case 'blur':
                    // Detecting when focus is lost
                    this.setupListener('externalInteraction');
                    break;
                case 'focus':
                    // Detecting when focus moves into some part of MediumEditor
                    this.setupListener('externalInteraction');
                    break;
                case 'editableInput':
                    // setup cache for knowing when the content has changed
                    this.contentCache = {};
                    this.base.elements.forEach(function (element) {
                        this.contentCache[element.getAttribute('medium-editor-index')] = element.innerHTML;
                    }, this);

                    // Attach to the 'oninput' event, handled correctly by most browsers
                    if (this.InputEventOnContenteditableSupported) {
                        this.attachToEachElement('input', this.handleInput);
                    }

                    // For browsers which don't support the input event on contenteditable (IE)
                    // we'll attach to 'selectionchange' on the document and 'keypress' on the editables
                    if (!this.InputEventOnContenteditableSupported) {
                        this.setupListener('editableKeypress');
                        this.keypressUpdateInput = true;
                        this.attachDOMEvent(document, 'selectionchange', this.handleDocumentSelectionChange.bind(this));
                        // Listen to calls to execCommand
                        this.attachToExecCommand();
                    }
                    break;
                case 'editableClick':
                    // Detecting click in the contenteditables
                    this.attachToEachElement('click', this.handleClick);
                    break;
                case 'editableBlur':
                    // Detecting blur in the contenteditables
                    this.attachToEachElement('blur', this.handleBlur);
                    break;
                case 'editableKeypress':
                    // Detecting keypress in the contenteditables
                    this.attachToEachElement('keypress', this.handleKeypress);
                    break;
                case 'editableKeyup':
                    // Detecting keyup in the contenteditables
                    this.attachToEachElement('keyup', this.handleKeyup);
                    break;
                case 'editableKeydown':
                    // Detecting keydown on the contenteditables
                    this.attachToEachElement('keydown', this.handleKeydown);
                    break;
                case 'editableKeydownSpace':
                    // Detecting keydown for SPACE on the contenteditables
                    this.setupListener('editableKeydown');
                    break;
                case 'editableKeydownEnter':
                    // Detecting keydown for ENTER on the contenteditables
                    this.setupListener('editableKeydown');
                    break;
                case 'editableKeydownTab':
                    // Detecting keydown for TAB on the contenteditable
                    this.setupListener('editableKeydown');
                    break;
                case 'editableKeydownDelete':
                    // Detecting keydown for DELETE/BACKSPACE on the contenteditables
                    this.setupListener('editableKeydown');
                    break;
                case 'editableMouseover':
                    // Detecting mouseover on the contenteditables
                    this.attachToEachElement('mouseover', this.handleMouseover);
                    break;
                case 'editableDrag':
                    // Detecting dragover and dragleave on the contenteditables
                    this.attachToEachElement('dragover', this.handleDragging);
                    this.attachToEachElement('dragleave', this.handleDragging);
                    break;
                case 'editableDrop':
                    // Detecting drop on the contenteditables
                    this.attachToEachElement('drop', this.handleDrop);
                    break;
                // TODO: We need to have a custom 'paste' event separate from 'editablePaste'
                // Need to think about the way to introduce this without breaking folks
                case 'editablePaste':
                    // Detecting paste on the contenteditables
                    this.attachToEachElement('paste', this.handlePaste);
                    break;
            }
            this.listeners[name] = true;
        },

        attachToEachElement: function (name, handler) {
            // build our internal cache to know which element got already what handler attached
            if (!this.eventsCache) {
                this.eventsCache = [];
            }

            this.base.elements.forEach(function (element) {
                this.attachDOMEvent(element, name, handler.bind(this));
            }, this);

            this.eventsCache.push({ 'name': name, 'handler': handler });
        },

        cleanupElement: function (element) {
            var index = element.getAttribute('medium-editor-index');
            if (index) {
                this.detachAllEventsFromElement(element);
                if (this.contentCache) {
                    delete this.contentCache[index];
                }
            }
        },

        focusElement: function (element) {
            element.focus();
            this.updateFocus(element, { target: element, type: 'focus' });
        },

        updateFocus: function (target, eventObj) {
            var hadFocus = this.base.getFocusedElement(),
                toFocus;

            // For clicks, we need to know if the mousedown that caused the click happened inside the existing focused element
            // or one of the extension elements.  If so, we don't want to focus another element
            if (hadFocus &&
                    eventObj.type === 'click' &&
                    this.lastMousedownTarget &&
                    (MediumEditor.util.isDescendant(hadFocus, this.lastMousedownTarget, true) ||
                     isElementDescendantOfExtension(this.base.extensions, this.lastMousedownTarget))) {
                toFocus = hadFocus;
            }

            if (!toFocus) {
                this.base.elements.some(function (element) {
                    // If the target is part of an editor element, this is the element getting focus
                    if (!toFocus && (MediumEditor.util.isDescendant(element, target, true))) {
                        toFocus = element;
                    }

                    // bail if we found an element that's getting focus
                    return !!toFocus;
                }, this);
            }

            // Check if the target is external (not part of the editor, toolbar, or any other extension)
            var externalEvent = !MediumEditor.util.isDescendant(hadFocus, target, true) &&
                                !isElementDescendantOfExtension(this.base.extensions, target);

            if (toFocus !== hadFocus) {
                // If element has focus, and focus is going outside of editor
                // Don't blur focused element if clicking on editor, toolbar, or anchorpreview
                if (hadFocus && externalEvent) {
                    // Trigger blur on the editable that has lost focus
                    hadFocus.removeAttribute('data-medium-focused');
                    this.triggerCustomEvent('blur', eventObj, hadFocus);
                }

                // If focus is going into an editor element
                if (toFocus) {
                    // Trigger focus on the editable that now has focus
                    toFocus.setAttribute('data-medium-focused', true);
                    this.triggerCustomEvent('focus', eventObj, toFocus);
                }
            }

            if (externalEvent) {
                this.triggerCustomEvent('externalInteraction', eventObj);
            }
        },

        updateInput: function (target, eventObj) {
            if (!this.contentCache) {
                return;
            }
            // An event triggered which signifies that the user may have changed someting
            // Look in our cache of input for the contenteditables to see if something changed
            var index = target.getAttribute('medium-editor-index'),
                html = target.innerHTML;

            if (html !== this.contentCache[index]) {
                // The content has changed since the last time we checked, fire the event
                this.triggerCustomEvent('editableInput', eventObj, target);
            }
            this.contentCache[index] = html;
        },

        handleDocumentSelectionChange: function (event) {
            // When selectionchange fires, target and current target are set
            // to document, since this is where the event is handled
            // However, currentTarget will have an 'activeElement' property
            // which will point to whatever element has focus.
            if (event.currentTarget && event.currentTarget.activeElement) {
                var activeElement = event.currentTarget.activeElement,
                    currentTarget;
                // We can look at the 'activeElement' to determine if the selectionchange has
                // happened within a contenteditable owned by this instance of MediumEditor
                this.base.elements.some(function (element) {
                    if (MediumEditor.util.isDescendant(element, activeElement, true)) {
                        currentTarget = element;
                        return true;
                    }
                    return false;
                }, this);

                // We know selectionchange fired within one of our contenteditables
                if (currentTarget) {
                    this.updateInput(currentTarget, { target: activeElement, currentTarget: currentTarget });
                }
            }
        },

        handleDocumentExecCommand: function () {
            // document.execCommand has been called
            // If one of our contenteditables currently has focus, we should
            // attempt to trigger the 'editableInput' event
            var target = this.base.getFocusedElement();
            if (target) {
                this.updateInput(target, { target: target, currentTarget: target });
            }
        },

        handleBodyClick: function (event) {
            this.updateFocus(event.target, event);
        },

        handleBodyFocus: function (event) {
            this.updateFocus(event.target, event);
        },

        handleBodyMousedown: function (event) {
            this.lastMousedownTarget = event.target;
        },

        handleInput: function (event) {
            this.updateInput(event.currentTarget, event);
        },

        handleClick: function (event) {
            this.triggerCustomEvent('editableClick', event, event.currentTarget);
        },

        handleBlur: function (event) {
            this.triggerCustomEvent('editableBlur', event, event.currentTarget);
        },

        handleKeypress: function (event) {
            this.triggerCustomEvent('editableKeypress', event, event.currentTarget);

            // If we're doing manual detection of the editableInput event we need
            // to check for input changes during 'keypress'
            if (this.keypressUpdateInput) {
                var eventObj = { target: event.target, currentTarget: event.currentTarget };

                // In IE, we need to let the rest of the event stack complete before we detect
                // changes to input, so using setTimeout here
                setTimeout(function () {
                    this.updateInput(eventObj.currentTarget, eventObj);
                }.bind(this), 0);
            }
        },

        handleKeyup: function (event) {
            this.triggerCustomEvent('editableKeyup', event, event.currentTarget);
        },

        handleMouseover: function (event) {
            this.triggerCustomEvent('editableMouseover', event, event.currentTarget);
        },

        handleDragging: function (event) {
            this.triggerCustomEvent('editableDrag', event, event.currentTarget);
        },

        handleDrop: function (event) {
            this.triggerCustomEvent('editableDrop', event, event.currentTarget);
        },

        handlePaste: function (event) {
            this.triggerCustomEvent('editablePaste', event, event.currentTarget);
        },

        handleKeydown: function (event) {

            this.triggerCustomEvent('editableKeydown', event, event.currentTarget);

            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.SPACE)) {
                return this.triggerCustomEvent('editableKeydownSpace', event, event.currentTarget);
            }

            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER) || (event.ctrlKey && MediumEditor.util.isKey(event, MediumEditor.util.keyCode.M))) {
                return this.triggerCustomEvent('editableKeydownEnter', event, event.currentTarget);
            }

            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.TAB)) {
                return this.triggerCustomEvent('editableKeydownTab', event, event.currentTarget);
            }

            if (MediumEditor.util.isKey(event, [MediumEditor.util.keyCode.DELETE, MediumEditor.util.keyCode.BACKSPACE])) {
                return this.triggerCustomEvent('editableKeydownDelete', event, event.currentTarget);
            }
        }
    };

    MediumEditor.Events = Events;
}());

(function () {
    'use strict';

    var Button = MediumEditor.Extension.extend({

        /* Button Options */

        /* action: [string]
         * The action argument to pass to MediumEditor.execAction()
         * when the button is clicked
         */
        action: undefined,

        /* aria: [string]
         * The value to add as the aria-label attribute of the button
         * element displayed in the toolbar.
         * This is also used as the tooltip for the button
         */
        aria: undefined,

        /* tagNames: [Array]
         * NOTE: This is not used if useQueryState is set to true.
         *
         * Array of element tag names that would indicate that this
         * button has already been applied. If this action has already
         * been applied, the button will be displayed as 'active' in the toolbar
         *
         * Example:
         * For 'bold', if the text is ever within a <b> or <strong>
         * tag that indicates the text is already bold. So the array
         * of tagNames for bold would be: ['b', 'strong']
         */
        tagNames: undefined,

        /* style: [Object]
         * NOTE: This is not used if useQueryState is set to true.
         *
         * A pair of css property & value(s) that indicate that this
         * button has already been applied. If this action has already
         * been applied, the button will be displayed as 'active' in the toolbar
         * Properties of the object:
         *   prop [String]: name of the css property
         *   value [String]: value(s) of the css property
         *                   multiple values can be separated by a '|'
         *
         * Example:
         * For 'bold', if the text is ever within an element with a 'font-weight'
         * style property set to '700' or 'bold', that indicates the text
         * is already bold.  So the style object for bold would be:
         * { prop: 'font-weight', value: '700|bold' }
         */
        style: undefined,

        /* useQueryState: [boolean]
         * Enables/disables whether this button should use the built-in
         * document.queryCommandState() method to determine whether
         * the action has already been applied.  If the action has already
         * been applied, the button will be displayed as 'active' in the toolbar
         *
         * Example:
         * For 'bold', if this is set to true, the code will call:
         * document.queryCommandState('bold') which will return true if the
         * browser thinks the text is already bold, and false otherwise
         */
        useQueryState: undefined,

        /* contentDefault: [string]
         * Default innerHTML to put inside the button
         */
        contentDefault: undefined,

        /* contentFA: [string]
         * The innerHTML to use for the content of the button
         * if the `buttonLabels` option for MediumEditor is set to 'fontawesome'
         */
        contentFA: undefined,

        /* classList: [Array]
         * An array of classNames (strings) to be added to the button
         */
        classList: undefined,

        /* attrs: [object]
         * A set of key-value pairs to add to the button as custom attributes
         */
        attrs: undefined,

        // The button constructor can optionally accept the name of a built-in button
        // (ie 'bold', 'italic', etc.)
        // When the name of a button is passed, it will initialize itself with the
        // configuration for that button
        constructor: function (options) {
            if (Button.isBuiltInButton(options)) {
                MediumEditor.Extension.call(this, this.defaults[options]);
            } else {
                MediumEditor.Extension.call(this, options);
            }
        },

        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.button = this.createButton();
            this.on(this.button, 'click', this.handleClick.bind(this));
        },

        /* getButton: [function ()]
         *
         * If implemented, this function will be called when
         * the toolbar is being created.  The DOM Element returned
         * by this function will be appended to the toolbar along
         * with any other buttons.
         */
        getButton: function () {
            return this.button;
        },

        getAction: function () {
            return (typeof this.action === 'function') ? this.action(this.base.options) : this.action;
        },

        getAria: function () {
            return (typeof this.aria === 'function') ? this.aria(this.base.options) : this.aria;
        },

        getTagNames: function () {
            return (typeof this.tagNames === 'function') ? this.tagNames(this.base.options) : this.tagNames;
        },

        createButton: function () {
            var button = this.document.createElement('button'),
                content = this.contentDefault,
                ariaLabel = this.getAria(),
                buttonLabels = this.getEditorOption('buttonLabels');
            // Add class names
            button.classList.add('medium-editor-action');
            button.classList.add('medium-editor-action-' + this.name);
            if (this.classList) {
                this.classList.forEach(function (className) {
                    button.classList.add(className);
                });
            }

            // Add attributes
            button.setAttribute('data-action', this.getAction());
            if (ariaLabel) {
                button.setAttribute('title', ariaLabel);
                button.setAttribute('aria-label', ariaLabel);
            }
            if (this.attrs) {
                Object.keys(this.attrs).forEach(function (attr) {
                    button.setAttribute(attr, this.attrs[attr]);
                }, this);
            }

            if (buttonLabels === 'fontawesome' && this.contentFA) {
                content = this.contentFA;
            }
            button.innerHTML = content;
            return button;
        },

        handleClick: function (event) {
            event.preventDefault();
            event.stopPropagation();

            var action = this.getAction();

            if (action) {
                this.execAction(action);
            }
        },

        isActive: function () {
            return this.button.classList.contains(this.getEditorOption('activeButtonClass'));
        },

        setInactive: function () {
            this.button.classList.remove(this.getEditorOption('activeButtonClass'));
            delete this.knownState;
        },

        setActive: function () {
            this.button.classList.add(this.getEditorOption('activeButtonClass'));
            delete this.knownState;
        },

        queryCommandState: function () {
            var queryState = null;
            if (this.useQueryState) {
                queryState = this.base.queryCommandState(this.getAction());
            }
            return queryState;
        },

        isAlreadyApplied: function (node) {
            var isMatch = false,
                tagNames = this.getTagNames(),
                styleVals,
                computedStyle;

            if (this.knownState === false || this.knownState === true) {
                return this.knownState;
            }

            if (tagNames && tagNames.length > 0) {
                isMatch = tagNames.indexOf(node.nodeName.toLowerCase()) !== -1;
            }

            if (!isMatch && this.style) {
                styleVals = this.style.value.split('|');
                computedStyle = this.window.getComputedStyle(node, null).getPropertyValue(this.style.prop);
                styleVals.forEach(function (val) {
                    if (!this.knownState) {
                        isMatch = (computedStyle.indexOf(val) !== -1);
                        // text-decoration is not inherited by default
                        // so if the computed style for text-decoration doesn't match
                        // don't write to knownState so we can fallback to other checks
                        if (isMatch || this.style.prop !== 'text-decoration') {
                            this.knownState = isMatch;
                        }
                    }
                }, this);
            }

            return isMatch;
        }
    });

    Button.isBuiltInButton = function (name) {
        return (typeof name === 'string') && MediumEditor.extensions.button.prototype.defaults.hasOwnProperty(name);
    };

    MediumEditor.extensions.button = Button;
}());

(function () {
    'use strict';

    /* MediumEditor.extensions.button.defaults: [Object]
     * Set of default config options for all of the built-in MediumEditor buttons
     */
    MediumEditor.extensions.button.prototype.defaults = {
        'bold': {
            name: 'bold',
            action: 'bold',
            aria: 'bold',
            tagNames: ['b', 'strong'],
            style: {
                prop: 'font-weight',
                value: '700|bold'
            },
            useQueryState: true,
            contentDefault: '<b>B</b>',
            contentFA: '<i class="fa fa-bold"></i>'
        },
        'italic': {
            name: 'italic',
            action: 'italic',
            aria: 'italic',
            tagNames: ['i', 'em'],
            style: {
                prop: 'font-style',
                value: 'italic'
            },
            useQueryState: true,
            contentDefault: '<b><i>I</i></b>',
            contentFA: '<i class="fa fa-italic"></i>'
        },
        'underline': {
            name: 'underline',
            action: 'underline',
            aria: 'underline',
            tagNames: ['u'],
            style: {
                prop: 'text-decoration',
                value: 'underline'
            },
            useQueryState: true,
            contentDefault: '<b><u>U</u></b>',
            contentFA: '<i class="fa fa-underline"></i>'
        },
        'strikethrough': {
            name: 'strikethrough',
            action: 'strikethrough',
            aria: 'strike through',
            tagNames: ['strike'],
            style: {
                prop: 'text-decoration',
                value: 'line-through'
            },
            useQueryState: true,
            contentDefault: '<s>A</s>',
            contentFA: '<i class="fa fa-strikethrough"></i>'
        },
        'superscript': {
            name: 'superscript',
            action: 'superscript',
            aria: 'superscript',
            tagNames: ['sup'],
            /* firefox doesn't behave the way we want it to, so we CAN'T use queryCommandState for superscript
               https://github.com/guardian/scribe/blob/master/BROWSERINCONSISTENCIES.md#documentquerycommandstate */
            // useQueryState: true
            contentDefault: '<b>x<sup>1</sup></b>',
            contentFA: '<i class="fa fa-superscript"></i>'
        },
        'subscript': {
            name: 'subscript',
            action: 'subscript',
            aria: 'subscript',
            tagNames: ['sub'],
            /* firefox doesn't behave the way we want it to, so we CAN'T use queryCommandState for subscript
               https://github.com/guardian/scribe/blob/master/BROWSERINCONSISTENCIES.md#documentquerycommandstate */
            // useQueryState: true
            contentDefault: '<b>x<sub>1</sub></b>',
            contentFA: '<i class="fa fa-subscript"></i>'
        },
        'image': {
            name: 'image',
            action: 'image',
            aria: 'image',
            tagNames: ['img'],
            contentDefault: '<b>image</b>',
            contentFA: '<i class="fa fa-picture-o"></i>'
        },
        'orderedlist': {
            name: 'orderedlist',
            action: 'insertorderedlist',
            aria: 'ordered list',
            tagNames: ['ol'],
            useQueryState: true,
            contentDefault: '<b>1.</b>',
            contentFA: '<i class="fa fa-list-ol"></i>'
        },
        'unorderedlist': {
            name: 'unorderedlist',
            action: 'insertunorderedlist',
            aria: 'unordered list',
            tagNames: ['ul'],
            useQueryState: true,
            contentDefault: '<b>&bull;</b>',
            contentFA: '<i class="fa fa-list-ul"></i>'
        },
        'indent': {
            name: 'indent',
            action: 'indent',
            aria: 'indent',
            tagNames: [],
            contentDefault: '<b>&rarr;</b>',
            contentFA: '<i class="fa fa-indent"></i>'
        },
        'outdent': {
            name: 'outdent',
            action: 'outdent',
            aria: 'outdent',
            tagNames: [],
            contentDefault: '<b>&larr;</b>',
            contentFA: '<i class="fa fa-outdent"></i>'
        },
        'justifyCenter': {
            name: 'justifyCenter',
            action: 'justifyCenter',
            aria: 'center justify',
            tagNames: [],
            style: {
                prop: 'text-align',
                value: 'center'
            },
            contentDefault: '<b>C</b>',
            contentFA: '<i class="fa fa-align-center"></i>'
        },
        'justifyFull': {
            name: 'justifyFull',
            action: 'justifyFull',
            aria: 'full justify',
            tagNames: [],
            style: {
                prop: 'text-align',
                value: 'justify'
            },
            contentDefault: '<b>J</b>',
            contentFA: '<i class="fa fa-align-justify"></i>'
        },
        'justifyLeft': {
            name: 'justifyLeft',
            action: 'justifyLeft',
            aria: 'left justify',
            tagNames: [],
            style: {
                prop: 'text-align',
                value: 'left'
            },
            contentDefault: '<b>L</b>',
            contentFA: '<i class="fa fa-align-left"></i>'
        },
        'justifyRight': {
            name: 'justifyRight',
            action: 'justifyRight',
            aria: 'right justify',
            tagNames: [],
            style: {
                prop: 'text-align',
                value: 'right'
            },
            contentDefault: '<b>R</b>',
            contentFA: '<i class="fa fa-align-right"></i>'
        },
        // Known inline elements that are not removed, or not removed consistantly across browsers:
        // <span>, <label>, <br>
        'removeFormat': {
            name: 'removeFormat',
            aria: 'remove formatting',
            action: 'removeFormat',
            contentDefault: '<b>X</b>',
            contentFA: '<i class="fa fa-eraser"></i>'
        },

        /***** Buttons for appending block elements (append-<element> action) *****/

        'quote': {
            name: 'quote',
            action: 'append-blockquote',
            aria: 'blockquote',
            tagNames: ['blockquote'],
            contentDefault: '<b>&ldquo;</b>',
            contentFA: '<i class="fa fa-quote-right"></i>'
        },
        'pre': {
            name: 'pre',
            action: 'append-pre',
            aria: 'preformatted text',
            tagNames: ['pre'],
            contentDefault: '<b>0101</b>',
            contentFA: '<i class="fa fa-code fa-lg"></i>'
        },
        'h1': {
            name: 'h1',
            action: 'append-h1',
            aria: 'header type one',
            tagNames: ['h1'],
            contentDefault: '<b>H1</b>',
            contentFA: '<i class="fa fa-header"><sup>1</sup>'
        },
        'h2': {
            name: 'h2',
            action: 'append-h2',
            aria: 'header type two',
            tagNames: ['h2'],
            contentDefault: '<b>H2</b>',
            contentFA: '<i class="fa fa-header"><sup>2</sup>'
        },
        'h3': {
            name: 'h3',
            action: 'append-h3',
            aria: 'header type three',
            tagNames: ['h3'],
            contentDefault: '<b>H3</b>',
            contentFA: '<i class="fa fa-header"><sup>3</sup>'
        },
        'h4': {
            name: 'h4',
            action: 'append-h4',
            aria: 'header type four',
            tagNames: ['h4'],
            contentDefault: '<b>H4</b>',
            contentFA: '<i class="fa fa-header"><sup>4</sup>'
        },
        'h5': {
            name: 'h5',
            action: 'append-h5',
            aria: 'header type five',
            tagNames: ['h5'],
            contentDefault: '<b>H5</b>',
            contentFA: '<i class="fa fa-header"><sup>5</sup>'
        },
        'h6': {
            name: 'h6',
            action: 'append-h6',
            aria: 'header type six',
            tagNames: ['h6'],
            contentDefault: '<b>H6</b>',
            contentFA: '<i class="fa fa-header"><sup>6</sup>'
        }
    };

})();
(function () {
    'use strict';

    /* Base functionality for an extension which will display
     * a 'form' inside the toolbar
     */
    var FormExtension = MediumEditor.extensions.button.extend({

        init: function () {
            MediumEditor.extensions.button.prototype.init.apply(this, arguments);
        },

        // default labels for the form buttons
        formSaveLabel: '&#10003;',
        formCloseLabel: '&times;',

        /* activeClass: [string]
         * set class which added to shown form
         */
        activeClass: 'medium-editor-toolbar-form-active',

        /* hasForm: [boolean]
         *
         * Setting this to true will cause getForm() to be called
         * when the toolbar is created, so the form can be appended
         * inside the toolbar container
         */
        hasForm: true,

        /* getForm: [function ()]
         *
         * When hasForm is true, this function must be implemented
         * and return a DOM Element which will be appended to
         * the toolbar container. The form should start hidden, and
         * the extension can choose when to hide/show it
         */
        getForm: function () {},

        /* isDisplayed: [function ()]
         *
         * This function should return true/false reflecting
         * whether the form is currently displayed
         */
        isDisplayed: function () {
            if (this.hasForm) {
                return this.getForm().classList.contains(this.activeClass);
            }
            return false;
        },

        /* hideForm: [function ()]
         *
         * This function should show the form element inside
         * the toolbar container
         */
        showForm: function () {
            if (this.hasForm) {
                this.getForm().classList.add(this.activeClass);
            }
        },

        /* hideForm: [function ()]
         *
         * This function should hide the form element inside
         * the toolbar container
         */
        hideForm: function () {
            if (this.hasForm) {
                this.getForm().classList.remove(this.activeClass);
            }
        },

        /************************ Helpers ************************
         * The following are helpers that are either set by MediumEditor
         * during initialization, or are helper methods which either
         * route calls to the MediumEditor instance or provide common
         * functionality for all form extensions
         *********************************************************/

        /* showToolbarDefaultActions: [function ()]
         *
         * Helper method which will turn back the toolbar after canceling
         * the customized form
         */
        showToolbarDefaultActions: function () {
            var toolbar = this.base.getExtensionByName('toolbar');
            if (toolbar) {
                toolbar.showToolbarDefaultActions();
            }
        },

        /* hideToolbarDefaultActions: [function ()]
         *
         * Helper function which will hide the default contents of the
         * toolbar, but leave the toolbar container in the same state
         * to allow a form to display its custom contents inside the toolbar
         */
        hideToolbarDefaultActions: function () {
            var toolbar = this.base.getExtensionByName('toolbar');
            if (toolbar) {
                toolbar.hideToolbarDefaultActions();
            }
        },

        /* setToolbarPosition: [function ()]
         *
         * Helper function which will update the size and position
         * of the toolbar based on the toolbar content and the current
         * position of the user's selection
         */
        setToolbarPosition: function () {
            var toolbar = this.base.getExtensionByName('toolbar');
            if (toolbar) {
                toolbar.setToolbarPosition();
            }
        }
    });

    MediumEditor.extensions.form = FormExtension;
})();
(function () {
    'use strict';

    var AnchorForm = MediumEditor.extensions.form.extend({
        /* Anchor Form Options */

        /* customClassOption: [string]  (previously options.anchorButton + options.anchorButtonClass)
         * Custom class name the user can optionally have added to their created links (ie 'button').
         * If passed as a non-empty string, a checkbox will be displayed allowing the user to choose
         * whether to have the class added to the created link or not.
         */
        customClassOption: null,

        /* customClassOptionText: [string]
         * text to be shown in the checkbox when the __customClassOption__ is being used.
         */
        customClassOptionText: 'Button',

        /* linkValidation: [boolean]  (previously options.checkLinkFormat)
         * enables/disables check for common URL protocols on anchor links.
         */
        linkValidation: false,

        /* placeholderText: [string]  (previously options.anchorInputPlaceholder)
         * text to be shown as placeholder of the anchor input.
         */
        placeholderText: 'Paste or type a link',

        /* targetCheckbox: [boolean]  (previously options.anchorTarget)
         * enables/disables displaying a "Open in new window" checkbox, which when checked
         * changes the `target` attribute of the created link.
         */
        targetCheckbox: false,

        /* targetCheckboxText: [string]  (previously options.anchorInputCheckboxLabel)
         * text to be shown in the checkbox enabled via the __targetCheckbox__ option.
         */
        targetCheckboxText: 'Open in new window',

        // Options for the Button base class
        name: 'anchor',
        action: 'createLink',
        aria: 'link',
        tagNames: ['a'],
        contentDefault: '<b>#</b>',
        contentFA: '<i class="fa fa-link"></i>',

        init: function () {
            MediumEditor.extensions.form.prototype.init.apply(this, arguments);

            this.subscribe('editableKeydown', this.handleKeydown.bind(this));
        },

        // Called when the button the toolbar is clicked
        // Overrides ButtonExtension.handleClick
        handleClick: function (event) {
            event.preventDefault();
            event.stopPropagation();

            var range = MediumEditor.selection.getSelectionRange(this.document);

            if (range.startContainer.nodeName.toLowerCase() === 'a' ||
                range.endContainer.nodeName.toLowerCase() === 'a' ||
                MediumEditor.util.getClosestTag(MediumEditor.selection.getSelectedParentElement(range), 'a')) {
                return this.execAction('unlink');
            }

            if (!this.isDisplayed()) {
                this.showForm();
            }

            return false;
        },

        // Called when user hits the defined shortcut (CTRL / COMMAND + K)
        handleKeydown: function (event) {
            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.K) && MediumEditor.util.isMetaCtrlKey(event) && !event.shiftKey) {
                this.handleClick(event);
            }
        },

        // Called by medium-editor to append form to the toolbar
        getForm: function () {
            if (!this.form) {
                this.form = this.createForm();
            }
            return this.form;
        },

        getTemplate: function () {
            var template = [
                '<input type="text" class="medium-editor-toolbar-input" placeholder="', this.placeholderText, '">'
            ];

            template.push(
                '<a href="#" class="medium-editor-toolbar-save">',
                this.getEditorOption('buttonLabels') === 'fontawesome' ? '<i class="fa fa-check"></i>' : this.formSaveLabel,
                '</a>'
            );

            template.push('<a href="#" class="medium-editor-toolbar-close">',
                this.getEditorOption('buttonLabels') === 'fontawesome' ? '<i class="fa fa-times"></i>' : this.formCloseLabel,
                '</a>');

            // both of these options are slightly moot with the ability to
            // override the various form buildup/serialize functions.

            if (this.targetCheckbox) {
                // fixme: ideally, this targetCheckboxText would be a formLabel too,
                // figure out how to deprecate? also consider `fa-` icon default implcations.
                template.push(
                    '<div class="medium-editor-toolbar-form-row">',
                    '<input type="checkbox" class="medium-editor-toolbar-anchor-target">',
                    '<label>',
                    this.targetCheckboxText,
                    '</label>',
                    '</div>'
                );
            }

            if (this.customClassOption) {
                // fixme: expose this `Button` text as a formLabel property, too
                // and provide similar access to a `fa-` icon default.
                template.push(
                    '<div class="medium-editor-toolbar-form-row">',
                    '<input type="checkbox" class="medium-editor-toolbar-anchor-button">',
                    '<label>',
                    this.customClassOptionText,
                    '</label>',
                    '</div>'
                );
            }

            return template.join('');

        },

        // Used by medium-editor when the default toolbar is to be displayed
        isDisplayed: function () {
            return MediumEditor.extensions.form.prototype.isDisplayed.apply(this);
        },

        hideForm: function () {
            MediumEditor.extensions.form.prototype.hideForm.apply(this);
            this.getInput().value = '';
        },

        showForm: function (opts) {
            var input = this.getInput(),
                targetCheckbox = this.getAnchorTargetCheckbox(),
                buttonCheckbox = this.getAnchorButtonCheckbox();

            opts = opts || { value: '' };
            // TODO: This is for backwards compatability
            // We don't need to support the 'string' argument in 6.0.0
            if (typeof opts === 'string') {
                opts = {
                    value: opts
                };
            }

            this.base.saveSelection();
            this.hideToolbarDefaultActions();
            MediumEditor.extensions.form.prototype.showForm.apply(this);
            this.setToolbarPosition();

            input.value = opts.value;
            input.focus();

            // If we have a target checkbox, we want it to be checked/unchecked
            // based on whether the existing link has target=_blank
            if (targetCheckbox) {
                targetCheckbox.checked = opts.target === '_blank';
            }

            // If we have a custom class checkbox, we want it to be checked/unchecked
            // based on whether an existing link already has the class
            if (buttonCheckbox) {
                var classList = opts.buttonClass ? opts.buttonClass.split(' ') : [];
                buttonCheckbox.checked = (classList.indexOf(this.customClassOption) !== -1);
            }
        },

        // Called by core when tearing down medium-editor (destroy)
        destroy: function () {
            if (!this.form) {
                return false;
            }

            if (this.form.parentNode) {
                this.form.parentNode.removeChild(this.form);
            }

            delete this.form;
        },

        // core methods

        getFormOpts: function () {
            // no notion of private functions? wanted `_getFormOpts`
            var targetCheckbox = this.getAnchorTargetCheckbox(),
                buttonCheckbox = this.getAnchorButtonCheckbox(),
                opts = {
                    value: this.getInput().value.trim()
                };

            if (this.linkValidation) {
                opts.value = this.checkLinkFormat(opts.value);
            }

            opts.target = '_self';
            if (targetCheckbox && targetCheckbox.checked) {
                opts.target = '_blank';
            }

            if (buttonCheckbox && buttonCheckbox.checked) {
                opts.buttonClass = this.customClassOption;
            }

            return opts;
        },

        doFormSave: function () {
            var opts = this.getFormOpts();
            this.completeFormSave(opts);
        },

        completeFormSave: function (opts) {
            this.base.restoreSelection();
            this.execAction(this.action, opts);
            this.base.checkSelection();
        },

        checkLinkFormat: function (value) {
            // Matches any alphabetical characters followed by ://
            // Matches protocol relative "//"
            // Matches common external protocols "mailto:" "tel:" "maps:"
            // Matches relative hash link, begins with "#"
            var urlSchemeRegex = /^([a-z]+:)?\/\/|^(mailto|tel|maps):|^\#/i,
            // var te is a regex for checking if the string is a telephone number
            telRegex = /^\+?\s?\(?(?:\d\s?\-?\)?){3,20}$/;
            if (telRegex.test(value)) {
                return 'tel:' + value;
            } else {
                // Check for URL scheme and default to http:// if none found
                return (urlSchemeRegex.test(value) ? '' : 'http://') + encodeURI(value);
            }
        },

        doFormCancel: function () {
            this.base.restoreSelection();
            this.base.checkSelection();
        },

        // form creation and event handling
        attachFormEvents: function (form) {
            var close = form.querySelector('.medium-editor-toolbar-close'),
                save = form.querySelector('.medium-editor-toolbar-save'),
                input = form.querySelector('.medium-editor-toolbar-input');

            // Handle clicks on the form itself
            this.on(form, 'click', this.handleFormClick.bind(this));

            // Handle typing in the textbox
            this.on(input, 'keyup', this.handleTextboxKeyup.bind(this));

            // Handle close button clicks
            this.on(close, 'click', this.handleCloseClick.bind(this));

            // Handle save button clicks (capture)
            this.on(save, 'click', this.handleSaveClick.bind(this), true);

        },

        createForm: function () {
            var doc = this.document,
                form = doc.createElement('div');

            // Anchor Form (div)
            form.className = 'medium-editor-toolbar-form';
            form.id = 'medium-editor-toolbar-form-anchor-' + this.getEditorId();
            form.innerHTML = this.getTemplate();
            this.attachFormEvents(form);

            return form;
        },

        getInput: function () {
            return this.getForm().querySelector('input.medium-editor-toolbar-input');
        },

        getAnchorTargetCheckbox: function () {
            return this.getForm().querySelector('.medium-editor-toolbar-anchor-target');
        },

        getAnchorButtonCheckbox: function () {
            return this.getForm().querySelector('.medium-editor-toolbar-anchor-button');
        },

        handleTextboxKeyup: function (event) {
            // For ENTER -> create the anchor
            if (event.keyCode === MediumEditor.util.keyCode.ENTER) {
                event.preventDefault();
                this.doFormSave();
                return;
            }

            // For ESCAPE -> close the form
            if (event.keyCode === MediumEditor.util.keyCode.ESCAPE) {
                event.preventDefault();
                this.doFormCancel();
            }
        },

        handleFormClick: function (event) {
            // make sure not to hide form when clicking inside the form
            event.stopPropagation();
        },

        handleSaveClick: function (event) {
            // Clicking Save -> create the anchor
            event.preventDefault();
            this.doFormSave();
        },

        handleCloseClick: function (event) {
            // Click Close -> close the form
            event.preventDefault();
            this.doFormCancel();
        }
    });

    MediumEditor.extensions.anchor = AnchorForm;
}());

(function () {
    'use strict';

    var AnchorPreview = MediumEditor.Extension.extend({
        name: 'anchor-preview',

        // Anchor Preview Options

        /* hideDelay: [number]  (previously options.anchorPreviewHideDelay)
         * time in milliseconds to show the anchor tag preview after the mouse has left the anchor tag.
         */
        hideDelay: 500,

        /* previewValueSelector: [string]
         * the default selector to locate where to put the activeAnchor value in the preview
         */
        previewValueSelector: 'a',

        /* showWhenToolbarIsVisible: [boolean]
         * determines whether the anchor tag preview shows up when the toolbar is visible
         */
        showWhenToolbarIsVisible: false,

        /* showOnEmptyLinks: [boolean]
        * determines whether the anchor tag preview shows up on links with href="" or href="#something"
        */
        showOnEmptyLinks: true,

        init: function () {
            this.anchorPreview = this.createPreview();

            this.getEditorOption('elementsContainer').appendChild(this.anchorPreview);

            this.attachToEditables();
        },

        getInteractionElements: function () {
            return this.getPreviewElement();
        },

        // TODO: Remove this function in 6.0.0
        getPreviewElement: function () {
            return this.anchorPreview;
        },

        createPreview: function () {
            var el = this.document.createElement('div');

            el.id = 'medium-editor-anchor-preview-' + this.getEditorId();
            el.className = 'medium-editor-anchor-preview';
            el.innerHTML = this.getTemplate();

            this.on(el, 'click', this.handleClick.bind(this));

            return el;
        },

        getTemplate: function () {
            return '<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">' +
                '    <a class="medium-editor-toolbar-anchor-preview-inner"></a>' +
                '</div>';
        },

        destroy: function () {
            if (this.anchorPreview) {
                if (this.anchorPreview.parentNode) {
                    this.anchorPreview.parentNode.removeChild(this.anchorPreview);
                }
                delete this.anchorPreview;
            }
        },

        hidePreview: function () {
            this.anchorPreview.classList.remove('medium-editor-anchor-preview-active');
            this.activeAnchor = null;
        },

        showPreview: function (anchorEl) {
            if (this.anchorPreview.classList.contains('medium-editor-anchor-preview-active') ||
                    anchorEl.getAttribute('data-disable-preview')) {
                return true;
            }

            if (this.previewValueSelector) {
                this.anchorPreview.querySelector(this.previewValueSelector).textContent = anchorEl.attributes.href.value;
                this.anchorPreview.querySelector(this.previewValueSelector).href = anchorEl.attributes.href.value;
            }

            this.anchorPreview.classList.add('medium-toolbar-arrow-over');
            this.anchorPreview.classList.remove('medium-toolbar-arrow-under');

            if (!this.anchorPreview.classList.contains('medium-editor-anchor-preview-active')) {
                this.anchorPreview.classList.add('medium-editor-anchor-preview-active');
            }

            this.activeAnchor = anchorEl;

            this.positionPreview();
            this.attachPreviewHandlers();

            return this;
        },

        positionPreview: function (activeAnchor) {
            activeAnchor = activeAnchor || this.activeAnchor;
            var containerWidth = this.window.innerWidth,
                buttonHeight = this.anchorPreview.offsetHeight,
                boundary = activeAnchor.getBoundingClientRect(),
                diffLeft = this.diffLeft,
                diffTop = this.diffTop,
                elementsContainer = this.getEditorOption('elementsContainer'),
                elementsContainerAbsolute = ['absolute', 'fixed'].indexOf(window.getComputedStyle(elementsContainer).getPropertyValue('position')) > -1,
                relativeBoundary = {},
                halfOffsetWidth, defaultLeft, middleBoundary, elementsContainerBoundary, top;

            halfOffsetWidth = this.anchorPreview.offsetWidth / 2;
            var toolbarExtension = this.base.getExtensionByName('toolbar');
            if (toolbarExtension) {
                diffLeft = toolbarExtension.diffLeft;
                diffTop = toolbarExtension.diffTop;
            }
            defaultLeft = diffLeft - halfOffsetWidth;

            // If container element is absolute / fixed, recalculate boundaries to be relative to the container
            if (elementsContainerAbsolute) {
                elementsContainerBoundary = elementsContainer.getBoundingClientRect();
                ['top', 'left'].forEach(function (key) {
                    relativeBoundary[key] = boundary[key] - elementsContainerBoundary[key];
                });

                relativeBoundary.width = boundary.width;
                relativeBoundary.height = boundary.height;
                boundary = relativeBoundary;

                containerWidth = elementsContainerBoundary.width;

                // Adjust top position according to container scroll position
                top = elementsContainer.scrollTop;
            } else {
                // Adjust top position according to window scroll position
                top = this.window.pageYOffset;
            }

            middleBoundary = boundary.left + boundary.width / 2;
            top += buttonHeight + boundary.top + boundary.height - diffTop - this.anchorPreview.offsetHeight;

            this.anchorPreview.style.top = Math.round(top) + 'px';
            this.anchorPreview.style.right = 'initial';
            if (middleBoundary < halfOffsetWidth) {
                this.anchorPreview.style.left = defaultLeft + halfOffsetWidth + 'px';
                this.anchorPreview.style.right = 'initial';
            } else if ((containerWidth - middleBoundary) < halfOffsetWidth) {
                this.anchorPreview.style.left = 'auto';
                this.anchorPreview.style.right = 0;
            } else {
                this.anchorPreview.style.left = defaultLeft + middleBoundary + 'px';
                this.anchorPreview.style.right = 'initial';
            }
        },

        attachToEditables: function () {
            this.subscribe('editableMouseover', this.handleEditableMouseover.bind(this));
            this.subscribe('positionedToolbar', this.handlePositionedToolbar.bind(this));
        },

        handlePositionedToolbar: function () {
            // If the toolbar is visible and positioned, we don't need to hide the preview
            // when showWhenToolbarIsVisible is true
            if (!this.showWhenToolbarIsVisible) {
                this.hidePreview();
            }
        },

        handleClick: function (event) {
            var anchorExtension = this.base.getExtensionByName('anchor'),
                activeAnchor = this.activeAnchor;

            if (anchorExtension && activeAnchor) {
                event.preventDefault();

                this.base.selectElement(this.activeAnchor);

                // Using setTimeout + delay because:
                // We may actually be displaying the anchor form, which should be controlled by delay
                this.base.delay(function () {
                    if (activeAnchor) {
                        var opts = {
                            value: activeAnchor.attributes.href.value,
                            target: activeAnchor.getAttribute('target'),
                            buttonClass: activeAnchor.getAttribute('class')
                        };
                        anchorExtension.showForm(opts);
                        activeAnchor = null;
                    }
                }.bind(this));
            }

            this.hidePreview();
        },

        handleAnchorMouseout: function () {
            this.anchorToPreview = null;
            this.off(this.activeAnchor, 'mouseout', this.instanceHandleAnchorMouseout);
            this.instanceHandleAnchorMouseout = null;
        },

        handleEditableMouseover: function (event) {
            var target = MediumEditor.util.getClosestTag(event.target, 'a');

            if (false === target) {
                return;
            }

            // Detect empty href attributes
            // The browser will make href="" or href="#top"
            // into absolute urls when accessed as event.target.href, so check the html
            if (!this.showOnEmptyLinks &&
                (!/href=["']\S+["']/.test(target.outerHTML) || /href=["']#\S+["']/.test(target.outerHTML))) {
                return true;
            }

            // only show when toolbar is not present
            var toolbar = this.base.getExtensionByName('toolbar');
            if (!this.showWhenToolbarIsVisible && toolbar && toolbar.isDisplayed && toolbar.isDisplayed()) {
                return true;
            }

            // detach handler for other anchor in case we hovered multiple anchors quickly
            if (this.activeAnchor && this.activeAnchor !== target) {
                this.detachPreviewHandlers();
            }

            this.anchorToPreview = target;

            this.instanceHandleAnchorMouseout = this.handleAnchorMouseout.bind(this);
            this.on(this.anchorToPreview, 'mouseout', this.instanceHandleAnchorMouseout);
            // Using setTimeout + delay because:
            // - We're going to show the anchor preview according to the configured delay
            //   if the mouse has not left the anchor tag in that time
            this.base.delay(function () {
                if (this.anchorToPreview) {
                    this.showPreview(this.anchorToPreview);
                }
            }.bind(this));
        },

        handlePreviewMouseover: function () {
            this.lastOver = (new Date()).getTime();
            this.hovering = true;
        },

        handlePreviewMouseout: function (event) {
            if (!event.relatedTarget || !/anchor-preview/.test(event.relatedTarget.className)) {
                this.hovering = false;
            }
        },

        updatePreview: function () {
            if (this.hovering) {
                return true;
            }
            var durr = (new Date()).getTime() - this.lastOver;
            if (durr > this.hideDelay) {
                // hide the preview 1/2 second after mouse leaves the link
                this.detachPreviewHandlers();
            }
        },

        detachPreviewHandlers: function () {
            // cleanup
            clearInterval(this.intervalTimer);
            if (this.instanceHandlePreviewMouseover) {
                this.off(this.anchorPreview, 'mouseover', this.instanceHandlePreviewMouseover);
                this.off(this.anchorPreview, 'mouseout', this.instanceHandlePreviewMouseout);
                if (this.activeAnchor) {
                    this.off(this.activeAnchor, 'mouseover', this.instanceHandlePreviewMouseover);
                    this.off(this.activeAnchor, 'mouseout', this.instanceHandlePreviewMouseout);
                }
            }

            this.hidePreview();

            this.hovering = this.instanceHandlePreviewMouseover = this.instanceHandlePreviewMouseout = null;
        },

        // TODO: break up method and extract out handlers
        attachPreviewHandlers: function () {
            this.lastOver = (new Date()).getTime();
            this.hovering = true;

            this.instanceHandlePreviewMouseover = this.handlePreviewMouseover.bind(this);
            this.instanceHandlePreviewMouseout = this.handlePreviewMouseout.bind(this);

            this.intervalTimer = setInterval(this.updatePreview.bind(this), 200);

            this.on(this.anchorPreview, 'mouseover', this.instanceHandlePreviewMouseover);
            this.on(this.anchorPreview, 'mouseout', this.instanceHandlePreviewMouseout);
            this.on(this.activeAnchor, 'mouseover', this.instanceHandlePreviewMouseover);
            this.on(this.activeAnchor, 'mouseout', this.instanceHandlePreviewMouseout);
        }
    });

    MediumEditor.extensions.anchorPreview = AnchorPreview;
}());

(function () {
    'use strict';

    var WHITESPACE_CHARS,
        KNOWN_TLDS_FRAGMENT,
        LINK_REGEXP_TEXT,
        KNOWN_TLDS_REGEXP;

    WHITESPACE_CHARS = [' ', '\t', '\n', '\r', '\u00A0', '\u2000', '\u2001', '\u2002', '\u2003',
                                    '\u2028', '\u2029'];
    KNOWN_TLDS_FRAGMENT = 'com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|' +
        'xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|' +
        'bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|' +
        'fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|' +
        'is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|' +
        'mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|' +
        'pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|' +
        'tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw';

    LINK_REGEXP_TEXT =
        '(' +
        // Version of Gruber URL Regexp optimized for JS: http://stackoverflow.com/a/17733640
        '((?:(https?://|ftps?://|nntp://)|www\\d{0,3}[.]|[a-z0-9.\\-]+[.](' + KNOWN_TLDS_FRAGMENT + ')\\\/)\\S+(?:[^\\s`!\\[\\]{};:\'\".,?\u00AB\u00BB\u201C\u201D\u2018\u2019]))' +
        // Addition to above Regexp to support bare domains/one level subdomains with common non-i18n TLDs and without www prefix:
        ')|(([a-z0-9\\-]+\\.)?[a-z0-9\\-]+\\.(' + KNOWN_TLDS_FRAGMENT + '))';

    KNOWN_TLDS_REGEXP = new RegExp('^(' + KNOWN_TLDS_FRAGMENT + ')$', 'i');

    function nodeIsNotInsideAnchorTag(node) {
        return !MediumEditor.util.getClosestTag(node, 'a');
    }

    var AutoLink = MediumEditor.Extension.extend({
        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.disableEventHandling = false;
            this.subscribe('editableKeypress', this.onKeypress.bind(this));
            this.subscribe('editableBlur', this.onBlur.bind(this));
            // MS IE has it's own auto-URL detect feature but ours is better in some ways. Be consistent.
            this.document.execCommand('AutoUrlDetect', false, false);
        },

        isLastInstance: function () {
            var activeInstances = 0;
            for (var i = 0; i < this.window._mediumEditors.length; i++) {
                var editor = this.window._mediumEditors[i];
                if (editor !== null && editor.getExtensionByName('autoLink') !== undefined) {
                    activeInstances++;
                }
            }
            return activeInstances === 1;
        },

        destroy: function () {
            // Turn AutoUrlDetect back on
            if (this.document.queryCommandSupported('AutoUrlDetect') && this.isLastInstance()) {
                this.document.execCommand('AutoUrlDetect', false, true);
            }
        },

        onBlur: function (blurEvent, editable) {
            this.performLinking(editable);
        },

        onKeypress: function (keyPressEvent) {
            if (this.disableEventHandling) {
                return;
            }

            if (MediumEditor.util.isKey(keyPressEvent, [MediumEditor.util.keyCode.SPACE, MediumEditor.util.keyCode.ENTER])) {
                clearTimeout(this.performLinkingTimeout);
                // Saving/restoring the selection in the middle of a keypress doesn't work well...
                this.performLinkingTimeout = setTimeout(function () {
                    try {
                        var sel = this.base.exportSelection();
                        if (this.performLinking(keyPressEvent.target)) {
                            // pass true for favorLaterSelectionAnchor - this is needed for links at the end of a
                            // paragraph in MS IE, or MS IE causes the link to be deleted right after adding it.
                            this.base.importSelection(sel, true);
                        }
                    } catch (e) {
                        if (window.console) {
                            window.console.error('Failed to perform linking', e);
                        }
                        this.disableEventHandling = true;
                    }
                }.bind(this), 0);
            }
        },

        performLinking: function (contenteditable) {
            /*
            Perform linking on blockElement basis, blockElements are HTML elements with text content and without
            child element.

            Example:
            - HTML content
            <blockquote>
              <p>link.</p>
              <p>my</p>
            </blockquote>

            - blockElements
            [<p>link.</p>, <p>my</p>]

            otherwise the detection can wrongly find the end of one paragraph and the beginning of another paragraph
            to constitute a link, such as a paragraph ending "link." and the next paragraph beginning with "my" is
            interpreted into "link.my" and the code tries to create a link across blockElements - which doesn't work
            and is terrible.
            (Medium deletes the spaces/returns between P tags so the textContent ends up without paragraph spacing)
            */
            var blockElements = MediumEditor.util.splitByBlockElements(contenteditable),
                documentModified = false;
            if (blockElements.length === 0) {
                blockElements = [contenteditable];
            }
            for (var i = 0; i < blockElements.length; i++) {
                documentModified = this.removeObsoleteAutoLinkSpans(blockElements[i]) || documentModified;
                documentModified = this.performLinkingWithinElement(blockElements[i]) || documentModified;
            }
            this.base.events.updateInput(contenteditable, { target: contenteditable, currentTarget: contenteditable });
            return documentModified;
        },

        removeObsoleteAutoLinkSpans: function (element) {
            if (!element || element.nodeType === 3) {
                return false;
            }

            var spans = element.querySelectorAll('span[data-auto-link="true"]'),
                documentModified = false;

            for (var i = 0; i < spans.length; i++) {
                var textContent = spans[i].textContent;
                if (textContent.indexOf('://') === -1) {
                    textContent = MediumEditor.util.ensureUrlHasProtocol(textContent);
                }
                if (spans[i].getAttribute('data-href') !== textContent && nodeIsNotInsideAnchorTag(spans[i])) {
                    documentModified = true;
                    var trimmedTextContent = textContent.replace(/\s+$/, '');
                    if (spans[i].getAttribute('data-href') === trimmedTextContent) {
                        var charactersTrimmed = textContent.length - trimmedTextContent.length,
                            subtree = MediumEditor.util.splitOffDOMTree(spans[i], this.splitTextBeforeEnd(spans[i], charactersTrimmed));
                        spans[i].parentNode.insertBefore(subtree, spans[i].nextSibling);
                    } else {
                        // Some editing has happened to the span, so just remove it entirely. The user can put it back
                        // around just the href content if they need to prevent it from linking
                        MediumEditor.util.unwrap(spans[i], this.document);
                    }
                }
            }
            return documentModified;
        },

        splitTextBeforeEnd: function (element, characterCount) {
            var treeWalker = this.document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false),
                lastChildNotExhausted = true;

            // Start the tree walker at the last descendant of the span
            while (lastChildNotExhausted) {
                lastChildNotExhausted = treeWalker.lastChild() !== null;
            }

            var currentNode,
                currentNodeValue,
                previousNode;
            while (characterCount > 0 && previousNode !== null) {
                currentNode = treeWalker.currentNode;
                currentNodeValue = currentNode.nodeValue;
                if (currentNodeValue.length > characterCount) {
                    previousNode = currentNode.splitText(currentNodeValue.length - characterCount);
                    characterCount = 0;
                } else {
                    previousNode = treeWalker.previousNode();
                    characterCount -= currentNodeValue.length;
                }
            }
            return previousNode;
        },

        performLinkingWithinElement: function (element) {
            var matches = this.findLinkableText(element),
                linkCreated = false;

            for (var matchIndex = 0; matchIndex < matches.length; matchIndex++) {
                var matchingTextNodes = MediumEditor.util.findOrCreateMatchingTextNodes(this.document, element,
                        matches[matchIndex]);
                if (this.shouldNotLink(matchingTextNodes)) {
                    continue;
                }
                this.createAutoLink(matchingTextNodes, matches[matchIndex].href);
            }
            return linkCreated;
        },

        shouldNotLink: function (textNodes) {
            var shouldNotLink = false;
            for (var i = 0; i < textNodes.length && shouldNotLink === false; i++) {
                // Do not link if the text node is either inside an anchor or inside span[data-auto-link]
                shouldNotLink = !!MediumEditor.util.traverseUp(textNodes[i], function (node) {
                    return node.nodeName.toLowerCase() === 'a' ||
                        (node.getAttribute && node.getAttribute('data-auto-link') === 'true');
                });
            }
            return shouldNotLink;
        },

        findLinkableText: function (contenteditable) {
            var linkRegExp = new RegExp(LINK_REGEXP_TEXT, 'gi'),
                textContent = contenteditable.textContent,
                match = null,
                matches = [];

            while ((match = linkRegExp.exec(textContent)) !== null) {
                var matchOk = true,
                    matchEnd = match.index + match[0].length;
                // If the regexp detected something as a link that has text immediately preceding/following it, bail out.
                matchOk = (match.index === 0 || WHITESPACE_CHARS.indexOf(textContent[match.index - 1]) !== -1) &&
                    (matchEnd === textContent.length || WHITESPACE_CHARS.indexOf(textContent[matchEnd]) !== -1);
                // If the regexp detected a bare domain that doesn't use one of our expected TLDs, bail out.
                matchOk = matchOk && (match[0].indexOf('/') !== -1 ||
                    KNOWN_TLDS_REGEXP.test(match[0].split('.').pop().split('?').shift()));

                if (matchOk) {
                    matches.push({
                        href: match[0],
                        start: match.index,
                        end: matchEnd
                    });
                }
            }
            return matches;
        },

        createAutoLink: function (textNodes, href) {
            href = MediumEditor.util.ensureUrlHasProtocol(href);
            var anchor = MediumEditor.util.createLink(this.document, textNodes, href, this.getEditorOption('targetBlank') ? '_blank' : null),
                span = this.document.createElement('span');
            span.setAttribute('data-auto-link', 'true');
            span.setAttribute('data-href', href);
            anchor.insertBefore(span, anchor.firstChild);
            while (anchor.childNodes.length > 1) {
                span.appendChild(anchor.childNodes[1]);
            }
        }

    });

    MediumEditor.extensions.autoLink = AutoLink;
}());

(function () {
    'use strict';

    var CLASS_DRAG_OVER = 'medium-editor-dragover';

    function clearClassNames(element) {
        var editable = MediumEditor.util.getContainerEditorElement(element),
            existing = Array.prototype.slice.call(editable.parentElement.querySelectorAll('.' + CLASS_DRAG_OVER));

        existing.forEach(function (el) {
            el.classList.remove(CLASS_DRAG_OVER);
        });
    }

    var FileDragging = MediumEditor.Extension.extend({
        name: 'fileDragging',

        allowedTypes: ['image'],

        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.subscribe('editableDrag', this.handleDrag.bind(this));
            this.subscribe('editableDrop', this.handleDrop.bind(this));
        },

        handleDrag: function (event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy';

            var target = event.target.classList ? event.target : event.target.parentElement;

            // Ensure the class gets removed from anything that had it before
            clearClassNames(target);

            if (event.type === 'dragover') {
                target.classList.add(CLASS_DRAG_OVER);
            }
        },

        handleDrop: function (event) {
            // Prevent file from opening in the current window
            event.preventDefault();
            event.stopPropagation();
            // Select the dropping target, and set the selection to the end of the target
            // https://github.com/yabwe/medium-editor/issues/980
            this.base.selectElement(event.target);
            var selection = this.base.exportSelection();
            selection.start = selection.end;
            this.base.importSelection(selection);
            // IE9 does not support the File API, so prevent file from opening in the window
            // but also don't try to actually get the file
            if (event.dataTransfer.files) {
                Array.prototype.slice.call(event.dataTransfer.files).forEach(function (file) {
                    if (this.isAllowedFile(file)) {
                        if (file.type.match('image')) {
                            this.insertImageFile(file);
                        }
                    }
                }, this);
            }

            // Make sure we remove our class from everything
            clearClassNames(event.target);
        },

        isAllowedFile: function (file) {
            return this.allowedTypes.some(function (fileType) {
                return !!file.type.match(fileType);
            });
        },

        insertImageFile: function (file) {
            if (typeof FileReader !== 'function') {
                return;
            }
            var fileReader = new FileReader();
            fileReader.readAsDataURL(file);

            // attach the onload event handler, makes it easier to listen in with jasmine
            fileReader.addEventListener('load', function (e) {
                var addImageElement = this.document.createElement('img');
                addImageElement.src = e.target.result;
                MediumEditor.util.insertHTMLCommand(this.document, addImageElement.outerHTML);
            }.bind(this));
        }
    });

    MediumEditor.extensions.fileDragging = FileDragging;
}());

(function () {
    'use strict';

    var KeyboardCommands = MediumEditor.Extension.extend({
        name: 'keyboard-commands',

        /* KeyboardCommands Options */

        /* commands: [Array]
         * Array of objects describing each command and the combination of keys that will trigger it
         * Required for each object:
         *   command [String] (argument passed to editor.execAction())
         *   key [String] (keyboard character that triggers this command)
         *   meta [boolean] (whether the ctrl/meta key has to be active or inactive)
         *   shift [boolean] (whether the shift key has to be active or inactive)
         *   alt [boolean] (whether the alt key has to be active or inactive)
         */
        commands: [
            {
                command: 'bold',
                key: 'B',
                meta: true,
                shift: false,
                alt: false
            },
            {
                command: 'italic',
                key: 'I',
                meta: true,
                shift: false,
                alt: false
            },
            {
                command: 'underline',
                key: 'U',
                meta: true,
                shift: false,
                alt: false
            }
        ],

        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.subscribe('editableKeydown', this.handleKeydown.bind(this));
            this.keys = {};
            this.commands.forEach(function (command) {
                var keyCode = command.key.charCodeAt(0);
                if (!this.keys[keyCode]) {
                    this.keys[keyCode] = [];
                }
                this.keys[keyCode].push(command);
            }, this);
        },

        handleKeydown: function (event) {
            var keyCode = MediumEditor.util.getKeyCode(event);
            if (!this.keys[keyCode]) {
                return;
            }

            var isMeta = MediumEditor.util.isMetaCtrlKey(event),
                isShift = !!event.shiftKey,
                isAlt = !!event.altKey;

            this.keys[keyCode].forEach(function (data) {
                if (data.meta === isMeta &&
                    data.shift === isShift &&
                    (data.alt === isAlt ||
                     undefined === data.alt)) { // TODO deprecated: remove check for undefined === data.alt when jumping to 6.0.0
                    event.preventDefault();
                    event.stopPropagation();

                    // command can be a function to execute
                    if (typeof data.command === 'function') {
                        data.command.apply(this);
                    }
                    // command can be false so the shortcut is just disabled
                    else if (false !== data.command) {
                        this.execAction(data.command);
                    }
                }
            }, this);
        }
    });

    MediumEditor.extensions.keyboardCommands = KeyboardCommands;
}());

(function () {
    'use strict';

    var FontNameForm = MediumEditor.extensions.form.extend({

        name: 'fontname',
        action: 'fontName',
        aria: 'change font name',
        contentDefault: '&#xB1;', // 
        contentFA: '<i class="fa fa-font"></i>',

        fonts: ['', 'Arial', 'Verdana', 'Times New Roman'],

        init: function () {
            MediumEditor.extensions.form.prototype.init.apply(this, arguments);
        },

        // Called when the button the toolbar is clicked
        // Overrides ButtonExtension.handleClick
        handleClick: function (event) {
            event.preventDefault();
            event.stopPropagation();

            if (!this.isDisplayed()) {
                // Get FontName of current selection (convert to string since IE returns this as number)
                var fontName = this.document.queryCommandValue('fontName') + '';
                this.showForm(fontName);
            }

            return false;
        },

        // Called by medium-editor to append form to the toolbar
        getForm: function () {
            if (!this.form) {
                this.form = this.createForm();
            }
            return this.form;
        },

        // Used by medium-editor when the default toolbar is to be displayed
        isDisplayed: function () {
            return this.getForm().style.display === 'block';
        },

        hideForm: function () {
            this.getForm().style.display = 'none';
            this.getSelect().value = '';
        },

        showForm: function (fontName) {
            var select = this.getSelect();

            this.base.saveSelection();
            this.hideToolbarDefaultActions();
            this.getForm().style.display = 'block';
            this.setToolbarPosition();

            select.value = fontName || '';
            select.focus();
        },

        // Called by core when tearing down medium-editor (destroy)
        destroy: function () {
            if (!this.form) {
                return false;
            }

            if (this.form.parentNode) {
                this.form.parentNode.removeChild(this.form);
            }

            delete this.form;
        },

        // core methods

        doFormSave: function () {
            this.base.restoreSelection();
            this.base.checkSelection();
        },

        doFormCancel: function () {
            this.base.restoreSelection();
            this.clearFontName();
            this.base.checkSelection();
        },

        // form creation and event handling
        createForm: function () {
            var doc = this.document,
                form = doc.createElement('div'),
                select = doc.createElement('select'),
                close = doc.createElement('a'),
                save = doc.createElement('a'),
                option;

            // Font Name Form (div)
            form.className = 'medium-editor-toolbar-form';
            form.id = 'medium-editor-toolbar-form-fontname-' + this.getEditorId();

            // Handle clicks on the form itself
            this.on(form, 'click', this.handleFormClick.bind(this));

            // Add font names
            for (var i = 0; i<this.fonts.length; i++) {
                option = doc.createElement('option');
                option.innerHTML = this.fonts[i];
                option.value = this.fonts[i];
                select.appendChild(option);
            }

            select.className = 'medium-editor-toolbar-select';
            form.appendChild(select);

            // Handle typing in the textbox
            this.on(select, 'change', this.handleFontChange.bind(this));

            // Add save buton
            save.setAttribute('href', '#');
            save.className = 'medium-editor-toobar-save';
            save.innerHTML = this.getEditorOption('buttonLabels') === 'fontawesome' ?
                             '<i class="fa fa-check"></i>' :
                             '&#10003;';
            form.appendChild(save);

            // Handle save button clicks (capture)
            this.on(save, 'click', this.handleSaveClick.bind(this), true);

            // Add close button
            close.setAttribute('href', '#');
            close.className = 'medium-editor-toobar-close';
            close.innerHTML = this.getEditorOption('buttonLabels') === 'fontawesome' ?
                              '<i class="fa fa-times"></i>' :
                              '&times;';
            form.appendChild(close);

            // Handle close button clicks
            this.on(close, 'click', this.handleCloseClick.bind(this));

            return form;
        },

        getSelect: function () {
            return this.getForm().querySelector('select.medium-editor-toolbar-select');
        },

        clearFontName: function () {
            MediumEditor.selection.getSelectedElements(this.document).forEach(function (el) {
                if (el.nodeName.toLowerCase() === 'font' && el.hasAttribute('face')) {
                    el.removeAttribute('face');
                }
            });
        },

        handleFontChange: function () {
            var font = this.getSelect().value;
            if (font === '') {
                this.clearFontName();
            } else {
                this.execAction('fontName', { value: font });
            }
        },

        handleFormClick: function (event) {
            // make sure not to hide form when clicking inside the form
            event.stopPropagation();
        },

        handleSaveClick: function (event) {
            // Clicking Save -> create the font size
            event.preventDefault();
            this.doFormSave();
        },

        handleCloseClick: function (event) {
            // Click Close -> close the form
            event.preventDefault();
            this.doFormCancel();
        }
    });

    MediumEditor.extensions.fontName = FontNameForm;
}());

(function () {
    'use strict';

    var FontSizeForm = MediumEditor.extensions.form.extend({

        name: 'fontsize',
        action: 'fontSize',
        aria: 'increase/decrease font size',
        contentDefault: '&#xB1;', // 
        contentFA: '<i class="fa fa-text-height"></i>',

        init: function () {
            MediumEditor.extensions.form.prototype.init.apply(this, arguments);
        },

        // Called when the button the toolbar is clicked
        // Overrides ButtonExtension.handleClick
        handleClick: function (event) {
            event.preventDefault();
            event.stopPropagation();

            if (!this.isDisplayed()) {
                // Get fontsize of current selection (convert to string since IE returns this as number)
                var fontSize = this.document.queryCommandValue('fontSize') + '';
                this.showForm(fontSize);
            }

            return false;
        },

        // Called by medium-editor to append form to the toolbar
        getForm: function () {
            if (!this.form) {
                this.form = this.createForm();
            }
            return this.form;
        },

        // Used by medium-editor when the default toolbar is to be displayed
        isDisplayed: function () {
            return this.getForm().style.display === 'block';
        },

        hideForm: function () {
            this.getForm().style.display = 'none';
            this.getInput().value = '';
        },

        showForm: function (fontSize) {
            var input = this.getInput();

            this.base.saveSelection();
            this.hideToolbarDefaultActions();
            this.getForm().style.display = 'block';
            this.setToolbarPosition();

            input.value = fontSize || '';
            input.focus();
        },

        // Called by core when tearing down medium-editor (destroy)
        destroy: function () {
            if (!this.form) {
                return false;
            }

            if (this.form.parentNode) {
                this.form.parentNode.removeChild(this.form);
            }

            delete this.form;
        },

        // core methods

        doFormSave: function () {
            this.base.restoreSelection();
            this.base.checkSelection();
        },

        doFormCancel: function () {
            this.base.restoreSelection();
            this.clearFontSize();
            this.base.checkSelection();
        },

        // form creation and event handling
        createForm: function () {
            var doc = this.document,
                form = doc.createElement('div'),
                input = doc.createElement('input'),
                close = doc.createElement('a'),
                save = doc.createElement('a');

            // Font Size Form (div)
            form.className = 'medium-editor-toolbar-form';
            form.id = 'medium-editor-toolbar-form-fontsize-' + this.getEditorId();

            // Handle clicks on the form itself
            this.on(form, 'click', this.handleFormClick.bind(this));

            // Add font size slider
            input.setAttribute('type', 'range');
            input.setAttribute('min', '1');
            input.setAttribute('max', '7');
            input.className = 'medium-editor-toolbar-input';
            form.appendChild(input);

            // Handle typing in the textbox
            this.on(input, 'change', this.handleSliderChange.bind(this));

            // Add save buton
            save.setAttribute('href', '#');
            save.className = 'medium-editor-toobar-save';
            save.innerHTML = this.getEditorOption('buttonLabels') === 'fontawesome' ?
                             '<i class="fa fa-check"></i>' :
                             '&#10003;';
            form.appendChild(save);

            // Handle save button clicks (capture)
            this.on(save, 'click', this.handleSaveClick.bind(this), true);

            // Add close button
            close.setAttribute('href', '#');
            close.className = 'medium-editor-toobar-close';
            close.innerHTML = this.getEditorOption('buttonLabels') === 'fontawesome' ?
                              '<i class="fa fa-times"></i>' :
                              '&times;';
            form.appendChild(close);

            // Handle close button clicks
            this.on(close, 'click', this.handleCloseClick.bind(this));

            return form;
        },

        getInput: function () {
            return this.getForm().querySelector('input.medium-editor-toolbar-input');
        },

        clearFontSize: function () {
            MediumEditor.selection.getSelectedElements(this.document).forEach(function (el) {
                if (el.nodeName.toLowerCase() === 'font' && el.hasAttribute('size')) {
                    el.removeAttribute('size');
                }
            });
        },

        handleSliderChange: function () {
            var size = this.getInput().value;
            if (size === '4') {
                this.clearFontSize();
            } else {
                this.execAction('fontSize', { value: size });
            }
        },

        handleFormClick: function (event) {
            // make sure not to hide form when clicking inside the form
            event.stopPropagation();
        },

        handleSaveClick: function (event) {
            // Clicking Save -> create the font size
            event.preventDefault();
            this.doFormSave();
        },

        handleCloseClick: function (event) {
            // Click Close -> close the form
            event.preventDefault();
            this.doFormCancel();
        }
    });

    MediumEditor.extensions.fontSize = FontSizeForm;
}());
(function () {
    'use strict';

    /* Helpers and internal variables that don't need to be members of actual paste handler */

    var pasteBinDefaultContent = '%ME_PASTEBIN%',
        lastRange = null,
        keyboardPasteEditable = null,
        stopProp = function (event) {
            event.stopPropagation();
        };

    /*jslint regexp: true*/
    /*
        jslint does not allow character negation, because the negation
        will not match any unicode characters. In the regexes in this
        block, negation is used specifically to match the end of an html
        tag, and in fact unicode characters *should* be allowed.
    */
    function createReplacements() {
        return [
            // Remove anything but the contents within the BODY element
            [new RegExp(/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g), ''],

            // cleanup comments added by Chrome when pasting html
            [new RegExp(/<!--StartFragment-->|<!--EndFragment-->/g), ''],

            // Trailing BR elements
            [new RegExp(/<br>$/i), ''],

            // replace two bogus tags that begin pastes from google docs
            [new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi), ''],
            [new RegExp(/<\/b>(<br[^>]*>)?$/gi), ''],

             // un-html spaces and newlines inserted by OS X
            [new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g), ' '],
            [new RegExp(/<br class="Apple-interchange-newline">/g), '<br>'],

            // replace google docs italics+bold with a span to be replaced once the html is inserted
            [new RegExp(/<span[^>]*(font-style:italic;font-weight:(bold|700)|font-weight:(bold|700);font-style:italic)[^>]*>/gi), '<span class="replace-with italic bold">'],

            // replace google docs italics with a span to be replaced once the html is inserted
            [new RegExp(/<span[^>]*font-style:italic[^>]*>/gi), '<span class="replace-with italic">'],

            //[replace google docs bolds with a span to be replaced once the html is inserted
            [new RegExp(/<span[^>]*font-weight:(bold|700)[^>]*>/gi), '<span class="replace-with bold">'],

             // replace manually entered b/i/a tags with real ones
            [new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi), '<$1$2>'],

             // replace manually a tags with real ones, converting smart-quotes from google docs
            [new RegExp(/&lt;a(?:(?!href).)+href=(?:&quot;|&rdquo;|&ldquo;|"||)(((?!&quot;|&rdquo;|&ldquo;|"||).)*)(?:&quot;|&rdquo;|&ldquo;|"||)(?:(?!&gt;).)*&gt;/gi), '<a href="$1">'],

            // Newlines between paragraphs in html have no syntactic value,
            // but then have a tendency to accidentally become additional paragraphs down the line
            [new RegExp(/<\/p>\n+/gi), '</p>'],
            [new RegExp(/\n+<p/gi), '<p'],

            // Microsoft Word makes these odd tags, like <o:p></o:p>
            [new RegExp(/<\/?o:[a-z]*>/gi), ''],

            // Microsoft Word adds some special elements around list items
            [new RegExp(/<!\[if !supportLists\]>(((?!<!).)*)<!\[endif]\>/gi), '$1']
        ];
    }
    /*jslint regexp: false*/

    /**
     * Gets various content types out of the Clipboard API. It will also get the
     * plain text using older IE and WebKit API.
     *
     * @param {event} event Event fired on paste.
     * @param {win} reference to window
     * @param {doc} reference to document
     * @return {Object} Object with mime types and data for those mime types.
     */
    function getClipboardContent(event, win, doc) {
        var dataTransfer = event.clipboardData || win.clipboardData || doc.dataTransfer,
            data = {};

        if (!dataTransfer) {
            return data;
        }

        // Use old WebKit/IE API
        if (dataTransfer.getData) {
            var legacyText = dataTransfer.getData('Text');
            if (legacyText && legacyText.length > 0) {
                data['text/plain'] = legacyText;
            }
        }

        if (dataTransfer.types) {
            for (var i = 0; i < dataTransfer.types.length; i++) {
                var contentType = dataTransfer.types[i];
                data[contentType] = dataTransfer.getData(contentType);
            }
        }

        return data;
    }

    var PasteHandler = MediumEditor.Extension.extend({
        /* Paste Options */

        /* forcePlainText: [boolean]
         * Forces pasting as plain text.
         */
        forcePlainText: true,

        /* cleanPastedHTML: [boolean]
         * cleans pasted content from different sources, like google docs etc.
         */
        cleanPastedHTML: false,

        /* preCleanReplacements: [Array]
         * custom pairs (2 element arrays) of RegExp and replacement text to use during past when
         * __forcePlainText__ or __cleanPastedHTML__ are `true` OR when calling `cleanPaste(text)` helper method.
         * These replacements are executed before any medium editor defined replacements.
         */
        preCleanReplacements: [],

        /* cleanReplacements: [Array]
         * custom pairs (2 element arrays) of RegExp and replacement text to use during paste when
         * __forcePlainText__ or __cleanPastedHTML__ are `true` OR when calling `cleanPaste(text)` helper method.
         * These replacements are executed after any medium editor defined replacements.
         */
        cleanReplacements: [],

        /* cleanAttrs:: [Array]
         * list of element attributes to remove during paste when __cleanPastedHTML__ is `true` or when
         * calling `cleanPaste(text)` or `pasteHTML(html, options)` helper methods.
         */
        cleanAttrs: ['class', 'style', 'dir'],

        /* cleanTags: [Array]
         * list of element tag names to remove during paste when __cleanPastedHTML__ is `true` or when
         * calling `cleanPaste(text)` or `pasteHTML(html, options)` helper methods.
         */
        cleanTags: ['meta'],

        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            if (this.forcePlainText || this.cleanPastedHTML) {
                this.subscribe('editableKeydown', this.handleKeydown.bind(this));
                // We need access to the full event data in paste
                // so we can't use the editablePaste event here
                this.getEditorElements().forEach(function (element) {
                    this.on(element, 'paste', this.handlePaste.bind(this));
                }, this);
                this.subscribe('addElement', this.handleAddElement.bind(this));
            }
        },

        handleAddElement: function (event, editable) {
            this.on(editable, 'paste', this.handlePaste.bind(this));
        },

        destroy: function () {
            // Make sure pastebin is destroyed in case it's still around for some reason
            if (this.forcePlainText || this.cleanPastedHTML) {
                this.removePasteBin();
            }
        },

        handlePaste: function (event, editable) {
            if (event.defaultPrevented) {
                return;
            }

            var clipboardContent = getClipboardContent(event, this.window, this.document),
                pastedHTML = clipboardContent['text/html'],
                pastedPlain = clipboardContent['text/plain'];

            if (this.window.clipboardData && event.clipboardData === undefined && !pastedHTML) {
                // If window.clipboardData exists, but event.clipboardData doesn't exist,
                // we're probably in IE. IE only has two possibilities for clipboard
                // data format: 'Text' and 'URL'.
                //
                // For IE, we'll fallback to 'Text' for text/html
                pastedHTML = pastedPlain;
            }

            if (pastedHTML || pastedPlain) {
                event.preventDefault();

                this.doPaste(pastedHTML, pastedPlain, editable);
            }
        },

        doPaste: function (pastedHTML, pastedPlain, editable) {
            var paragraphs,
                html = '',
                p;

            if (this.cleanPastedHTML && pastedHTML) {
                return this.cleanPaste(pastedHTML);
            }

            if (!(this.getEditorOption('disableReturn') || (editable && editable.getAttribute('data-disable-return')))) {
                paragraphs = pastedPlain.split(/[\r\n]+/g);
                // If there are no \r\n in data, don't wrap in <p>
                if (paragraphs.length > 1) {
                    for (p = 0; p < paragraphs.length; p += 1) {
                        if (paragraphs[p] !== '') {
                            html += '<p>' + MediumEditor.util.htmlEntities(paragraphs[p]) + '</p>';
                        }
                    }
                } else {
                    html = MediumEditor.util.htmlEntities(paragraphs[0]);
                }
            } else {
                html = MediumEditor.util.htmlEntities(pastedPlain);
            }
            MediumEditor.util.insertHTMLCommand(this.document, html);
        },

        handlePasteBinPaste: function (event) {
            if (event.defaultPrevented) {
                this.removePasteBin();
                return;
            }

            var clipboardContent = getClipboardContent(event, this.window, this.document),
                pastedHTML = clipboardContent['text/html'],
                pastedPlain = clipboardContent['text/plain'],
                editable = keyboardPasteEditable;

            // If we have valid html already, or we're not in cleanPastedHTML mode
            // we can ignore the paste bin and just paste now
            if (!this.cleanPastedHTML || pastedHTML) {
                event.preventDefault();
                this.removePasteBin();
                this.doPaste(pastedHTML, pastedPlain, editable);

                // The event handling code listens for paste on the editable element
                // in order to trigger the editablePaste event.  Since this paste event
                // is happening on the pastebin, the event handling code never knows about it
                // So, we have to trigger editablePaste manually
                this.trigger('editablePaste', { currentTarget: editable, target: editable }, editable);
                return;
            }

            // We need to look at the paste bin, so do a setTimeout to let the paste
            // fall through into the paste bin
            setTimeout(function () {
                // Only look for HTML if we're in cleanPastedHTML mode
                if (this.cleanPastedHTML) {
                    // If clipboard didn't have HTML, try the paste bin
                    pastedHTML = this.getPasteBinHtml();
                }

                // If we needed the paste bin, we're done with it now, remove it
                this.removePasteBin();

                // Handle the paste with the html from the paste bin
                this.doPaste(pastedHTML, pastedPlain, editable);

                // The event handling code listens for paste on the editable element
                // in order to trigger the editablePaste event.  Since this paste event
                // is happening on the pastebin, the event handling code never knows about it
                // So, we have to trigger editablePaste manually
                this.trigger('editablePaste', { currentTarget: editable, target: editable }, editable);
            }.bind(this), 0);
        },

        handleKeydown: function (event, editable) {
            // if it's not Ctrl+V, do nothing
            if (!(MediumEditor.util.isKey(event, MediumEditor.util.keyCode.V) && MediumEditor.util.isMetaCtrlKey(event))) {
                return;
            }

            event.stopImmediatePropagation();

            this.removePasteBin();
            this.createPasteBin(editable);
        },

        createPasteBin: function (editable) {
            var rects,
                range = MediumEditor.selection.getSelectionRange(this.document),
                top = this.window.pageYOffset;

            keyboardPasteEditable = editable;

            if (range) {
                rects = range.getClientRects();

                // on empty line, rects is empty so we grab information from the first container of the range
                if (rects.length) {
                    top += rects[0].top;
                } else {
                    top += range.startContainer.getBoundingClientRect().top;
                }
            }

            lastRange = range;

            var pasteBinElm = this.document.createElement('div');
            pasteBinElm.id = this.pasteBinId = 'medium-editor-pastebin-' + (+Date.now());
            pasteBinElm.setAttribute('style', 'border: 1px red solid; position: absolute; top: ' + top + 'px; width: 10px; height: 10px; overflow: hidden; opacity: 0');
            pasteBinElm.setAttribute('contentEditable', true);
            pasteBinElm.innerHTML = pasteBinDefaultContent;

            this.document.body.appendChild(pasteBinElm);

            // avoid .focus() to stop other event (actually the paste event)
            this.on(pasteBinElm, 'focus', stopProp);
            this.on(pasteBinElm, 'focusin', stopProp);
            this.on(pasteBinElm, 'focusout', stopProp);

            pasteBinElm.focus();

            MediumEditor.selection.selectNode(pasteBinElm, this.document);

            if (!this.boundHandlePaste) {
                this.boundHandlePaste = this.handlePasteBinPaste.bind(this);
            }

            this.on(pasteBinElm, 'paste', this.boundHandlePaste);
        },

        removePasteBin: function () {
            if (null !== lastRange) {
                MediumEditor.selection.selectRange(this.document, lastRange);
                lastRange = null;
            }

            if (null !== keyboardPasteEditable) {
                keyboardPasteEditable = null;
            }

            var pasteBinElm = this.getPasteBin();
            if (!pasteBinElm) {
                return;
            }

            if (pasteBinElm) {
                this.off(pasteBinElm, 'focus', stopProp);
                this.off(pasteBinElm, 'focusin', stopProp);
                this.off(pasteBinElm, 'focusout', stopProp);
                this.off(pasteBinElm, 'paste', this.boundHandlePaste);
                pasteBinElm.parentElement.removeChild(pasteBinElm);
            }
        },

        getPasteBin: function () {
            return this.document.getElementById(this.pasteBinId);
        },

        getPasteBinHtml: function () {
            var pasteBinElm = this.getPasteBin();

            if (!pasteBinElm) {
                return false;
            }

            // WebKit has a nice bug where it clones the paste bin if you paste from for example notepad
            // so we need to force plain text mode in this case
            if (pasteBinElm.firstChild && pasteBinElm.firstChild.id === 'mcepastebin') {
                return false;
            }

            var pasteBinHtml = pasteBinElm.innerHTML;

            // If paste bin is empty try using plain text mode
            // since that is better than nothing right
            if (!pasteBinHtml || pasteBinHtml === pasteBinDefaultContent) {
                return false;
            }

            return pasteBinHtml;
        },

        cleanPaste: function (text) {
            var i, elList, tmp, workEl,
                multiline = /<p|<br|<div/.test(text),
                replacements = [].concat(
                    this.preCleanReplacements || [],
                    createReplacements(),
                    this.cleanReplacements || []);

            for (i = 0; i < replacements.length; i += 1) {
                text = text.replace(replacements[i][0], replacements[i][1]);
            }

            if (!multiline) {
                return this.pasteHTML(text);
            }

            // create a temporary div to cleanup block elements
            tmp = this.document.createElement('div');

            // double br's aren't converted to p tags, but we want paragraphs.
            tmp.innerHTML = '<p>' + text.split('<br><br>').join('</p><p>') + '</p>';

            // block element cleanup
            elList = tmp.querySelectorAll('a,p,div,br');
            for (i = 0; i < elList.length; i += 1) {
                workEl = elList[i];

                // Microsoft Word replaces some spaces with newlines.
                // While newlines between block elements are meaningless, newlines within
                // elements are sometimes actually spaces.
                workEl.innerHTML = workEl.innerHTML.replace(/\n/gi, ' ');

                switch (workEl.nodeName.toLowerCase()) {
                    case 'p':
                    case 'div':
                        this.filterCommonBlocks(workEl);
                        break;
                    case 'br':
                        this.filterLineBreak(workEl);
                        break;
                }
            }

            this.pasteHTML(tmp.innerHTML);
        },

        pasteHTML: function (html, options) {
            options = MediumEditor.util.defaults({}, options, {
                cleanAttrs: this.cleanAttrs,
                cleanTags: this.cleanTags
            });

            var elList, workEl, i, fragmentBody, pasteBlock = this.document.createDocumentFragment();

            pasteBlock.appendChild(this.document.createElement('body'));

            fragmentBody = pasteBlock.querySelector('body');
            fragmentBody.innerHTML = html;

            this.cleanupSpans(fragmentBody);

            elList = fragmentBody.querySelectorAll('*');
            for (i = 0; i < elList.length; i += 1) {
                workEl = elList[i];

                if ('a' === workEl.nodeName.toLowerCase() && this.getEditorOption('targetBlank')) {
                    MediumEditor.util.setTargetBlank(workEl);
                }

                MediumEditor.util.cleanupAttrs(workEl, options.cleanAttrs);
                MediumEditor.util.cleanupTags(workEl, options.cleanTags);
            }

            MediumEditor.util.insertHTMLCommand(this.document, fragmentBody.innerHTML.replace(/&nbsp;/g, ' '));
        },

        // TODO (6.0): Make this an internal helper instead of member of paste handler
        isCommonBlock: function (el) {
            return (el && (el.nodeName.toLowerCase() === 'p' || el.nodeName.toLowerCase() === 'div'));
        },

        // TODO (6.0): Make this an internal helper instead of member of paste handler
        filterCommonBlocks: function (el) {
            if (/^\s*$/.test(el.textContent) && el.parentNode) {
                el.parentNode.removeChild(el);
            }
        },

        // TODO (6.0): Make this an internal helper instead of member of paste handler
        filterLineBreak: function (el) {
            if (this.isCommonBlock(el.previousElementSibling)) {
                // remove stray br's following common block elements
                this.removeWithParent(el);
            } else if (this.isCommonBlock(el.parentNode) && (el.parentNode.firstChild === el || el.parentNode.lastChild === el)) {
                // remove br's just inside open or close tags of a div/p
                this.removeWithParent(el);
            } else if (el.parentNode && el.parentNode.childElementCount === 1 && el.parentNode.textContent === '') {
                // and br's that are the only child of elements other than div/p
                this.removeWithParent(el);
            }
        },

        // TODO (6.0): Make this an internal helper instead of member of paste handler
        // remove an element, including its parent, if it is the only element within its parent
        removeWithParent: function (el) {
            if (el && el.parentNode) {
                if (el.parentNode.parentNode && el.parentNode.childElementCount === 1) {
                    el.parentNode.parentNode.removeChild(el.parentNode);
                } else {
                    el.parentNode.removeChild(el);
                }
            }
        },

        // TODO (6.0): Make this an internal helper instead of member of paste handler
        cleanupSpans: function (containerEl) {
            var i,
                el,
                newEl,
                spans = containerEl.querySelectorAll('.replace-with'),
                isCEF = function (el) {
                    return (el && el.nodeName !== '#text' && el.getAttribute('contenteditable') === 'false');
                };

            for (i = 0; i < spans.length; i += 1) {
                el = spans[i];
                newEl = this.document.createElement(el.classList.contains('bold') ? 'b' : 'i');

                if (el.classList.contains('bold') && el.classList.contains('italic')) {
                    // add an i tag as well if this has both italics and bold
                    newEl.innerHTML = '<i>' + el.innerHTML + '</i>';
                } else {
                    newEl.innerHTML = el.innerHTML;
                }
                el.parentNode.replaceChild(newEl, el);
            }

            spans = containerEl.querySelectorAll('span');
            for (i = 0; i < spans.length; i += 1) {
                el = spans[i];

                // bail if span is in contenteditable = false
                if (MediumEditor.util.traverseUp(el, isCEF)) {
                    return false;
                }

                // remove empty spans, replace others with their contents
                MediumEditor.util.unwrap(el, this.document);
            }
        }
    });

    MediumEditor.extensions.paste = PasteHandler;
}());

(function () {
    'use strict';

    var Placeholder = MediumEditor.Extension.extend({
        name: 'placeholder',

        /* Placeholder Options */

        /* text: [string]
         * Text to display in the placeholder
         */
        text: 'Type your text',

        /* hideOnClick: [boolean]
         * Should we hide the placeholder on click (true) or when user starts typing (false)
         */
        hideOnClick: true,

        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.initPlaceholders();
            this.attachEventHandlers();
        },

        initPlaceholders: function () {
            this.getEditorElements().forEach(this.initElement, this);
        },

        handleAddElement: function (event, editable) {
            this.initElement(editable);
        },

        initElement: function (el) {
            if (!el.getAttribute('data-placeholder')) {
                el.setAttribute('data-placeholder', this.text);
            }
            this.updatePlaceholder(el);
        },

        destroy: function () {
            this.getEditorElements().forEach(this.cleanupElement, this);
        },

        handleRemoveElement: function (event, editable) {
            this.cleanupElement(editable);
        },

        cleanupElement: function (el) {
            if (el.getAttribute('data-placeholder') === this.text) {
                el.removeAttribute('data-placeholder');
            }
        },

        showPlaceholder: function (el) {
            if (el) {
                // https://github.com/yabwe/medium-editor/issues/234
                // In firefox, styling the placeholder with an absolutely positioned
                // pseudo element causes the cursor to appear in a bad location
                // when the element is completely empty, so apply a different class to
                // style it with a relatively positioned pseudo element
                if (MediumEditor.util.isFF && el.childNodes.length === 0) {
                    el.classList.add('medium-editor-placeholder-relative');
                    el.classList.remove('medium-editor-placeholder');
                } else {
                    el.classList.add('medium-editor-placeholder');
                    el.classList.remove('medium-editor-placeholder-relative');
                }
            }
        },

        hidePlaceholder: function (el) {
            if (el) {
                el.classList.remove('medium-editor-placeholder');
                el.classList.remove('medium-editor-placeholder-relative');
            }
        },

        updatePlaceholder: function (el, dontShow) {
            // If the element has content, hide the placeholder
            if (el.querySelector('img, blockquote, ul, ol, table') || (el.textContent.replace(/^\s+|\s+$/g, '') !== '')) {
                return this.hidePlaceholder(el);
            }

            if (!dontShow) {
                this.showPlaceholder(el);
            }
        },

        attachEventHandlers: function () {
            if (this.hideOnClick) {
                // For the 'hideOnClick' option, the placeholder should always be hidden on focus
                this.subscribe('focus', this.handleFocus.bind(this));
            }

            // If the editor has content, it should always hide the placeholder
            this.subscribe('editableInput', this.handleInput.bind(this));

            // When the editor loses focus, check if the placeholder should be visible
            this.subscribe('blur', this.handleBlur.bind(this));

            // Need to know when elements are added/removed from the editor
            this.subscribe('addElement', this.handleAddElement.bind(this));
            this.subscribe('removeElement', this.handleRemoveElement.bind(this));
        },

        handleInput: function (event, element) {
            // If the placeholder should be hidden on focus and the
            // element has focus, don't show the placeholder
            var dontShow = this.hideOnClick && (element === this.base.getFocusedElement());

            // Editor's content has changed, check if the placeholder should be hidden
            this.updatePlaceholder(element, dontShow);
        },

        handleFocus: function (event, element) {
            // Editor has focus, hide the placeholder
            this.hidePlaceholder(element);
        },

        handleBlur: function (event, element) {
            // Editor has lost focus, check if the placeholder should be shown
            this.updatePlaceholder(element);
        }
    });

    MediumEditor.extensions.placeholder = Placeholder;
}());

(function () {
    'use strict';

    var Toolbar = MediumEditor.Extension.extend({
        name: 'toolbar',

        /* Toolbar Options */

        /* align: ['left'|'center'|'right']
         * When the __static__ option is true, this aligns the static toolbar
         * relative to the medium-editor element.
         */
        align: 'center',

        /* allowMultiParagraphSelection: [boolean]
         * enables/disables whether the toolbar should be displayed when
         * selecting multiple paragraphs/block elements
         */
        allowMultiParagraphSelection: true,

        /* buttons: [Array]
         * the names of the set of buttons to display on the toolbar.
         */
        buttons: ['bold', 'italic', 'underline', 'anchor', 'h2', 'h3', 'quote'],

        /* diffLeft: [Number]
         * value in pixels to be added to the X axis positioning of the toolbar.
         */
        diffLeft: 0,

        /* diffTop: [Number]
         * value in pixels to be added to the Y axis positioning of the toolbar.
         */
        diffTop: -10,

        /* firstButtonClass: [string]
         * CSS class added to the first button in the toolbar.
         */
        firstButtonClass: 'medium-editor-button-first',

        /* lastButtonClass: [string]
         * CSS class added to the last button in the toolbar.
         */
        lastButtonClass: 'medium-editor-button-last',

        /* standardizeSelectionStart: [boolean]
         * enables/disables standardizing how the beginning of a range is decided
         * between browsers whenever the selected text is analyzed for updating toolbar buttons status.
         */
        standardizeSelectionStart: false,

        /* static: [boolean]
         * enable/disable the toolbar always displaying in the same location
         * relative to the medium-editor element.
         */
        static: false,

        /* sticky: [boolean]
         * When the __static__ option is true, this enables/disables the toolbar
         * "sticking" to the viewport and staying visible on the screen while
         * the page scrolls.
         */
        sticky: false,

        /* stickyTopOffset: [Number]
         * Value in pixel of the top offset above the toolbar
         */
        stickyTopOffset: 0,

        /* updateOnEmptySelection: [boolean]
         * When the __static__ option is true, this enables/disables updating
         * the state of the toolbar buttons even when the selection is collapsed
         * (there is no selection, just a cursor).
         */
        updateOnEmptySelection: false,

        /* relativeContainer: [node]
         * appending the toolbar to a given node instead of body
         */
        relativeContainer: null,

        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.initThrottledMethods();

            if (!this.relativeContainer) {
                this.getEditorOption('elementsContainer').appendChild(this.getToolbarElement());
            } else {
                this.relativeContainer.appendChild(this.getToolbarElement());
            }
        },

        // Helper method to execute method for every extension, but ignoring the toolbar extension
        forEachExtension: function (iterator, context) {
            return this.base.extensions.forEach(function (command) {
                if (command === this) {
                    return;
                }
                return iterator.apply(context || this, arguments);
            }, this);
        },

        // Toolbar creation/deletion

        createToolbar: function () {
            var toolbar = this.document.createElement('div');

            toolbar.id = 'medium-editor-toolbar-' + this.getEditorId();
            toolbar.className = 'medium-editor-toolbar';

            if (this.static) {
                toolbar.className += ' static-toolbar';
            } else if (this.relativeContainer) {
                toolbar.className += ' medium-editor-relative-toolbar';
            } else {
                toolbar.className += ' medium-editor-stalker-toolbar';
            }

            toolbar.appendChild(this.createToolbarButtons());

            // Add any forms that extensions may have
            this.forEachExtension(function (extension) {
                if (extension.hasForm) {
                    toolbar.appendChild(extension.getForm());
                }
            });

            this.attachEventHandlers();

            return toolbar;
        },

        createToolbarButtons: function () {
            var ul = this.document.createElement('ul'),
                li,
                btn,
                buttons,
                extension,
                buttonName,
                buttonOpts;

            ul.id = 'medium-editor-toolbar-actions' + this.getEditorId();
            ul.className = 'medium-editor-toolbar-actions';
            ul.style.display = 'block';

            this.buttons.forEach(function (button) {
                if (typeof button === 'string') {
                    buttonName = button;
                    buttonOpts = null;
                } else {
                    buttonName = button.name;
                    buttonOpts = button;
                }

                // If the button already exists as an extension, it'll be returned
                // othwerise it'll create the default built-in button
                extension = this.base.addBuiltInExtension(buttonName, buttonOpts);

                if (extension && typeof extension.getButton === 'function') {
                    btn = extension.getButton(this.base);
                    li = this.document.createElement('li');
                    if (MediumEditor.util.isElement(btn)) {
                        li.appendChild(btn);
                    } else {
                        li.innerHTML = btn;
                    }
                    ul.appendChild(li);
                }
            }, this);

            buttons = ul.querySelectorAll('button');
            if (buttons.length > 0) {
                buttons[0].classList.add(this.firstButtonClass);
                buttons[buttons.length - 1].classList.add(this.lastButtonClass);
            }

            return ul;
        },

        destroy: function () {
            if (this.toolbar) {
                if (this.toolbar.parentNode) {
                    this.toolbar.parentNode.removeChild(this.toolbar);
                }
                delete this.toolbar;
            }
        },

        // Toolbar accessors

        getInteractionElements: function () {
            return this.getToolbarElement();
        },

        getToolbarElement: function () {
            if (!this.toolbar) {
                this.toolbar = this.createToolbar();
            }

            return this.toolbar;
        },

        getToolbarActionsElement: function () {
            return this.getToolbarElement().querySelector('.medium-editor-toolbar-actions');
        },

        // Toolbar event handlers

        initThrottledMethods: function () {
            // throttledPositionToolbar is throttled because:
            // - It will be called when the browser is resizing, which can fire many times very quickly
            // - For some event (like resize) a slight lag in UI responsiveness is OK and provides performance benefits
            this.throttledPositionToolbar = MediumEditor.util.throttle(function () {
                if (this.base.isActive) {
                    this.positionToolbarIfShown();
                }
            }.bind(this));
        },

        attachEventHandlers: function () {
            // MediumEditor custom events for when user beings and ends interaction with a contenteditable and its elements
            this.subscribe('blur', this.handleBlur.bind(this));
            this.subscribe('focus', this.handleFocus.bind(this));

            // Updating the state of the toolbar as things change
            this.subscribe('editableClick', this.handleEditableClick.bind(this));
            this.subscribe('editableKeyup', this.handleEditableKeyup.bind(this));

            // Handle mouseup on document for updating the selection in the toolbar
            this.on(this.document.documentElement, 'mouseup', this.handleDocumentMouseup.bind(this));

            // Add a scroll event for sticky toolbar
            if (this.static && this.sticky) {
                // On scroll (capture), re-position the toolbar
                this.on(this.window, 'scroll', this.handleWindowScroll.bind(this), true);
            }

            // On resize, re-position the toolbar
            this.on(this.window, 'resize', this.handleWindowResize.bind(this));
        },

        handleWindowScroll: function () {
            this.positionToolbarIfShown();
        },

        handleWindowResize: function () {
            this.throttledPositionToolbar();
        },

        handleDocumentMouseup: function (event) {
            // Do not trigger checkState when mouseup fires over the toolbar
            if (event &&
                    event.target &&
                    MediumEditor.util.isDescendant(this.getToolbarElement(), event.target)) {
                return false;
            }
            this.checkState();
        },

        handleEditableClick: function () {
            // Delay the call to checkState to handle bug where selection is empty
            // immediately after clicking inside a pre-existing selection
            setTimeout(function () {
                this.checkState();
            }.bind(this), 0);
        },

        handleEditableKeyup: function () {
            this.checkState();
        },

        handleBlur: function () {
            // Kill any previously delayed calls to hide the toolbar
            clearTimeout(this.hideTimeout);

            // Blur may fire even if we have a selection, so we want to prevent any delayed showToolbar
            // calls from happening in this specific case
            clearTimeout(this.delayShowTimeout);

            // Delay the call to hideToolbar to handle bug with multiple editors on the page at once
            this.hideTimeout = setTimeout(function () {
                this.hideToolbar();
            }.bind(this), 1);
        },

        handleFocus: function () {
            this.checkState();
        },

        // Hiding/showing toolbar

        isDisplayed: function () {
            return this.getToolbarElement().classList.contains('medium-editor-toolbar-active');
        },

        showToolbar: function () {
            clearTimeout(this.hideTimeout);
            if (!this.isDisplayed()) {
                this.getToolbarElement().classList.add('medium-editor-toolbar-active');
                this.trigger('showToolbar', {}, this.base.getFocusedElement());
            }
        },

        hideToolbar: function () {
            if (this.isDisplayed()) {
                this.getToolbarElement().classList.remove('medium-editor-toolbar-active');
                this.trigger('hideToolbar', {}, this.base.getFocusedElement());
            }
        },

        isToolbarDefaultActionsDisplayed: function () {
            return this.getToolbarActionsElement().style.display === 'block';
        },

        hideToolbarDefaultActions: function () {
            if (this.isToolbarDefaultActionsDisplayed()) {
                this.getToolbarActionsElement().style.display = 'none';
            }
        },

        showToolbarDefaultActions: function () {
            this.hideExtensionForms();

            if (!this.isToolbarDefaultActionsDisplayed()) {
                this.getToolbarActionsElement().style.display = 'block';
            }

            // Using setTimeout + options.delay because:
            // We will actually be displaying the toolbar, which should be controlled by options.delay
            this.delayShowTimeout = this.base.delay(function () {
                this.showToolbar();
            }.bind(this));
        },

        hideExtensionForms: function () {
            // Hide all extension forms
            this.forEachExtension(function (extension) {
                if (extension.hasForm && extension.isDisplayed()) {
                    extension.hideForm();
                }
            });
        },

        // Responding to changes in user selection

        // Checks for existance of multiple block elements in the current selection
        multipleBlockElementsSelected: function () {
            var regexEmptyHTMLTags = /<[^\/>][^>]*><\/[^>]+>/gim, // http://stackoverflow.com/questions/3129738/remove-empty-tags-using-regex
                regexBlockElements = new RegExp('<(' + MediumEditor.util.blockContainerElementNames.join('|') + ')[^>]*>', 'g'),
                selectionHTML = MediumEditor.selection.getSelectionHtml(this.document).replace(regexEmptyHTMLTags, ''), // Filter out empty blocks from selection
                hasMultiParagraphs = selectionHTML.match(regexBlockElements); // Find how many block elements are within the html

            return !!hasMultiParagraphs && hasMultiParagraphs.length > 1;
        },

        modifySelection: function () {
            var selection = this.window.getSelection(),
                selectionRange = selection.getRangeAt(0);

            /*
            * In firefox, there are cases (ie doubleclick of a word) where the selectionRange start
            * will be at the very end of an element.  In other browsers, the selectionRange start
            * would instead be at the very beginning of an element that actually has content.
            * example:
            *   <span>foo</span><span>bar</span>
            *
            * If the text 'bar' is selected, most browsers will have the selectionRange start at the beginning
            * of the 'bar' span.  However, there are cases where firefox will have the selectionRange start
            * at the end of the 'foo' span.  The contenteditable behavior will be ok, but if there are any
            * properties on the 'bar' span, they won't be reflected accurately in the toolbar
            * (ie 'Bold' button wouldn't be active)
            *
            * So, for cases where the selectionRange start is at the end of an element/node, find the next
            * adjacent text node that actually has content in it, and move the selectionRange start there.
            */
            if (this.standardizeSelectionStart &&
                    selectionRange.startContainer.nodeValue &&
                    (selectionRange.startOffset === selectionRange.startContainer.nodeValue.length)) {
                var adjacentNode = MediumEditor.util.findAdjacentTextNodeWithContent(MediumEditor.selection.getSelectionElement(this.window), selectionRange.startContainer, this.document);
                if (adjacentNode) {
                    var offset = 0;
                    while (adjacentNode.nodeValue.substr(offset, 1).trim().length === 0) {
                        offset = offset + 1;
                    }
                    selectionRange = MediumEditor.selection.select(this.document, adjacentNode, offset,
                        selectionRange.endContainer, selectionRange.endOffset);
                }
            }
        },

        checkState: function () {
            if (this.base.preventSelectionUpdates) {
                return;
            }

            // If no editable has focus OR selection is inside contenteditable = false
            // hide toolbar
            if (!this.base.getFocusedElement() ||
                    MediumEditor.selection.selectionInContentEditableFalse(this.window)) {
                return this.hideToolbar();
            }

            // If there's no selection element, selection element doesn't belong to this editor
            // or toolbar is disabled for this selection element
            // hide toolbar
            var selectionElement = MediumEditor.selection.getSelectionElement(this.window);
            if (!selectionElement ||
                    this.getEditorElements().indexOf(selectionElement) === -1 ||
                    selectionElement.getAttribute('data-disable-toolbar')) {
                return this.hideToolbar();
            }

            // Now we know there's a focused editable with a selection

            // If the updateOnEmptySelection option is true, show the toolbar
            if (this.updateOnEmptySelection && this.static) {
                return this.showAndUpdateToolbar();
            }

            // If we don't have a 'valid' selection -> hide toolbar
            if (!MediumEditor.selection.selectionContainsContent(this.document) ||
                (this.allowMultiParagraphSelection === false && this.multipleBlockElementsSelected())) {
                return this.hideToolbar();
            }

            this.showAndUpdateToolbar();
        },

        // Updating the toolbar

        showAndUpdateToolbar: function () {
            this.modifySelection();
            this.setToolbarButtonStates();
            this.trigger('positionToolbar', {}, this.base.getFocusedElement());
            this.showToolbarDefaultActions();
            this.setToolbarPosition();
        },

        setToolbarButtonStates: function () {
            this.forEachExtension(function (extension) {
                if (typeof extension.isActive === 'function' &&
                    typeof extension.setInactive === 'function') {
                    extension.setInactive();
                }
            });

            this.checkActiveButtons();
        },

        checkActiveButtons: function () {
            var manualStateChecks = [],
                queryState = null,
                selectionRange = MediumEditor.selection.getSelectionRange(this.document),
                parentNode,
                updateExtensionState = function (extension) {
                    if (typeof extension.checkState === 'function') {
                        extension.checkState(parentNode);
                    } else if (typeof extension.isActive === 'function' &&
                               typeof extension.isAlreadyApplied === 'function' &&
                               typeof extension.setActive === 'function') {
                        if (!extension.isActive() && extension.isAlreadyApplied(parentNode)) {
                            extension.setActive();
                        }
                    }
                };

            if (!selectionRange) {
                return;
            }

            // Loop through all extensions
            this.forEachExtension(function (extension) {
                // For those extensions where we can use document.queryCommandState(), do so
                if (typeof extension.queryCommandState === 'function') {
                    queryState = extension.queryCommandState();
                    // If queryCommandState returns a valid value, we can trust the browser
                    // and don't need to do our manual checks
                    if (queryState !== null) {
                        if (queryState && typeof extension.setActive === 'function') {
                            extension.setActive();
                        }
                        return;
                    }
                }
                // We can't use queryCommandState for this extension, so add to manualStateChecks
                manualStateChecks.push(extension);
            });

            parentNode = MediumEditor.selection.getSelectedParentElement(selectionRange);

            // Make sure the selection parent isn't outside of the contenteditable
            if (!this.getEditorElements().some(function (element) {
                    return MediumEditor.util.isDescendant(element, parentNode, true);
                })) {
                return;
            }

            // Climb up the DOM and do manual checks for whether a certain extension is currently enabled for this node
            while (parentNode) {
                manualStateChecks.forEach(updateExtensionState);

                // we can abort the search upwards if we leave the contentEditable element
                if (MediumEditor.util.isMediumEditorElement(parentNode)) {
                    break;
                }
                parentNode = parentNode.parentNode;
            }
        },

        // Positioning toolbar

        positionToolbarIfShown: function () {
            if (this.isDisplayed()) {
                this.setToolbarPosition();
            }
        },

        setToolbarPosition: function () {
            var container = this.base.getFocusedElement(),
                selection = this.window.getSelection();

            // If there isn't a valid selection, bail
            if (!container) {
                return this;
            }

            if (this.static || !selection.isCollapsed) {
                this.showToolbar();

                // we don't need any absolute positioning if relativeContainer is set
                if (!this.relativeContainer) {
                    if (this.static) {
                        this.positionStaticToolbar(container);
                    } else {
                        this.positionToolbar(selection);
                    }
                }

                this.trigger('positionedToolbar', {}, this.base.getFocusedElement());
            }
        },

        positionStaticToolbar: function (container) {
            // position the toolbar at left 0, so we can get the real width of the toolbar
            this.getToolbarElement().style.left = '0';

            // document.documentElement for IE 9
            var scrollTop = (this.document.documentElement && this.document.documentElement.scrollTop) || this.document.body.scrollTop,
                windowWidth = this.window.innerWidth,
                toolbarElement = this.getToolbarElement(),
                containerRect = container.getBoundingClientRect(),
                containerTop = containerRect.top + scrollTop,
                containerCenter = (containerRect.left + (containerRect.width / 2)),
                toolbarHeight = toolbarElement.offsetHeight,
                toolbarWidth = toolbarElement.offsetWidth,
                halfOffsetWidth = toolbarWidth / 2,
                targetLeft;

            if (this.sticky) {
                // If it's beyond the height of the editor, position it at the bottom of the editor
                if (scrollTop > (containerTop + container.offsetHeight - toolbarHeight - this.stickyTopOffset)) {
                    toolbarElement.style.top = (containerTop + container.offsetHeight - toolbarHeight) + 'px';
                    toolbarElement.classList.remove('medium-editor-sticky-toolbar');
                // Stick the toolbar to the top of the window
                } else if (scrollTop > (containerTop - toolbarHeight - this.stickyTopOffset)) {
                    toolbarElement.classList.add('medium-editor-sticky-toolbar');
                    toolbarElement.style.top = this.stickyTopOffset + 'px';
                // Normal static toolbar position
                } else {
                    toolbarElement.classList.remove('medium-editor-sticky-toolbar');
                    toolbarElement.style.top = containerTop - toolbarHeight + 'px';
                }
            } else {
                toolbarElement.style.top = containerTop - toolbarHeight + 'px';
            }

            switch (this.align) {
                case 'left':
                    targetLeft = containerRect.left;
                    break;

                case 'right':
                    targetLeft = containerRect.right - toolbarWidth;
                    break;

                case 'center':
                    targetLeft = containerCenter - halfOffsetWidth;
                    break;
            }

            if (targetLeft < 0) {
                targetLeft = 0;
            } else if ((targetLeft + toolbarWidth) > windowWidth) {
                targetLeft = (windowWidth - Math.ceil(toolbarWidth) - 1);
            }

            toolbarElement.style.left = targetLeft + 'px';
        },

        positionToolbar: function (selection) {
            // position the toolbar at left 0, so we can get the real width of the toolbar
            this.getToolbarElement().style.left = '0';
            this.getToolbarElement().style.right = 'initial';

            var range = selection.getRangeAt(0),
                boundary = range.getBoundingClientRect();

            // Handle selections with just images
            if (!boundary || ((boundary.height === 0 && boundary.width === 0) && range.startContainer === range.endContainer)) {
                // If there's a nested image, use that for the bounding rectangle
                if (range.startContainer.nodeType === 1 && range.startContainer.querySelector('img')) {
                    boundary = range.startContainer.querySelector('img').getBoundingClientRect();
                } else {
                    boundary = range.startContainer.getBoundingClientRect();
                }
            }

            var containerWidth = this.window.innerWidth,
                toolbarElement = this.getToolbarElement(),
                toolbarHeight = toolbarElement.offsetHeight,
                toolbarWidth = toolbarElement.offsetWidth,
                halfOffsetWidth = toolbarWidth / 2,
                buttonHeight = 50,
                defaultLeft = this.diffLeft - halfOffsetWidth,
                elementsContainer = this.getEditorOption('elementsContainer'),
                elementsContainerAbsolute = ['absolute', 'fixed'].indexOf(window.getComputedStyle(elementsContainer).getPropertyValue('position')) > -1,
                positions = {},
                relativeBoundary = {},
                middleBoundary, elementsContainerBoundary;

            // If container element is absolute / fixed, recalculate boundaries to be relative to the container
            if (elementsContainerAbsolute) {
                elementsContainerBoundary = elementsContainer.getBoundingClientRect();
                ['top', 'left'].forEach(function (key) {
                    relativeBoundary[key] = boundary[key] - elementsContainerBoundary[key];
                });

                relativeBoundary.width = boundary.width;
                relativeBoundary.height = boundary.height;
                boundary = relativeBoundary;

                containerWidth = elementsContainerBoundary.width;

                // Adjust top position according to container scroll position
                positions.top = elementsContainer.scrollTop;
            } else {
                // Adjust top position according to window scroll position
                positions.top = this.window.pageYOffset;
            }

            middleBoundary = boundary.left + boundary.width / 2;
            positions.top += boundary.top - toolbarHeight;

            if (boundary.top < buttonHeight) {
                toolbarElement.classList.add('medium-toolbar-arrow-over');
                toolbarElement.classList.remove('medium-toolbar-arrow-under');
                positions.top += buttonHeight + boundary.height - this.diffTop;
            } else {
                toolbarElement.classList.add('medium-toolbar-arrow-under');
                toolbarElement.classList.remove('medium-toolbar-arrow-over');
                positions.top += this.diffTop;
            }

            if (middleBoundary < halfOffsetWidth) {
                positions.left = defaultLeft + halfOffsetWidth;
                positions.right = 'initial';
            } else if ((containerWidth - middleBoundary) < halfOffsetWidth) {
                positions.left = 'auto';
                positions.right = 0;
            } else {
                positions.left = defaultLeft + middleBoundary;
                positions.right = 'initial';
            }

            ['top', 'left', 'right'].forEach(function (key) {
                toolbarElement.style[key] = positions[key] + (isNaN(positions[key]) ? '' : 'px');
            });
        }
    });

    MediumEditor.extensions.toolbar = Toolbar;
}());

(function () {
    'use strict';

    var ImageDragging = MediumEditor.Extension.extend({
        init: function () {
            MediumEditor.Extension.prototype.init.apply(this, arguments);

            this.subscribe('editableDrag', this.handleDrag.bind(this));
            this.subscribe('editableDrop', this.handleDrop.bind(this));
        },

        handleDrag: function (event) {
            var className = 'medium-editor-dragover';
            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy';

            if (event.type === 'dragover') {
                event.target.classList.add(className);
            } else if (event.type === 'dragleave') {
                event.target.classList.remove(className);
            }
        },

        handleDrop: function (event) {
            var className = 'medium-editor-dragover',
                files;
            event.preventDefault();
            event.stopPropagation();

            // IE9 does not support the File API, so prevent file from opening in a new window
            // but also don't try to actually get the file
            if (event.dataTransfer.files) {
                files = Array.prototype.slice.call(event.dataTransfer.files, 0);
                files.some(function (file) {
                    if (file.type.match('image')) {
                        var fileReader, id;
                        fileReader = new FileReader();
                        fileReader.readAsDataURL(file);

                        id = 'medium-img-' + (+new Date());
                        MediumEditor.util.insertHTMLCommand(this.document, '<img class="medium-editor-image-loading" id="' + id + '" />');

                        fileReader.onload = function () {
                            var img = this.document.getElementById(id);
                            if (img) {
                                img.removeAttribute('id');
                                img.removeAttribute('class');
                                img.src = fileReader.result;
                            }
                        }.bind(this);
                    }
                }.bind(this));
            }
            event.target.classList.remove(className);
        }
    });

    MediumEditor.extensions.imageDragging = ImageDragging;
}());

(function () {
    'use strict';

    // Event handlers that shouldn't be exposed externally

    function handleDisableExtraSpaces(event) {
        var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),
            textContent = node.textContent,
            caretPositions = MediumEditor.selection.getCaretOffsets(node);

        if ((textContent[caretPositions.left - 1] === undefined) || (textContent[caretPositions.left - 1].trim() === '') || (textContent[caretPositions.left] !== undefined && textContent[caretPositions.left].trim() === '')) {
            event.preventDefault();
        }
    }

    function handleDisabledEnterKeydown(event, element) {
        if (this.options.disableReturn || element.getAttribute('data-disable-return')) {
            event.preventDefault();
        } else if (this.options.disableDoubleReturn || element.getAttribute('data-disable-double-return')) {
            var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument);

            // if current text selection is empty OR previous sibling text is empty OR it is not a list
            if ((node && node.textContent.trim() === '' && node.nodeName.toLowerCase() !== 'li') ||
                (node.previousElementSibling && node.previousElementSibling.nodeName.toLowerCase() !== 'br' &&
                 node.previousElementSibling.textContent.trim() === '')) {
                event.preventDefault();
            }
        }
    }

    function handleTabKeydown(event) {
        // Override tab only for pre nodes
        var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),
            tag = node && node.nodeName.toLowerCase();

        if (tag === 'pre') {
            event.preventDefault();
            MediumEditor.util.insertHTMLCommand(this.options.ownerDocument, '    ');
        }

        // Tab to indent list structures!
        if (MediumEditor.util.isListItem(node)) {
            event.preventDefault();

            // If Shift is down, outdent, otherwise indent
            if (event.shiftKey) {
                this.options.ownerDocument.execCommand('outdent', false, null);
            } else {
                this.options.ownerDocument.execCommand('indent', false, null);
            }
        }
    }

    function handleBlockDeleteKeydowns(event) {
        var p, node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),
            tagName = node.nodeName.toLowerCase(),
            isEmpty = /^(\s+|<br\/?>)?$/i,
            isHeader = /h\d/i;

        if (MediumEditor.util.isKey(event, [MediumEditor.util.keyCode.BACKSPACE, MediumEditor.util.keyCode.ENTER]) &&
                // has a preceeding sibling
                node.previousElementSibling &&
                // in a header
                isHeader.test(tagName) &&
                // at the very end of the block
                MediumEditor.selection.getCaretOffsets(node).left === 0) {
            if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.BACKSPACE) && isEmpty.test(node.previousElementSibling.innerHTML)) {
                // backspacing the begining of a header into an empty previous element will
                // change the tagName of the current node to prevent one
                // instead delete previous node and cancel the event.
                node.previousElementSibling.parentNode.removeChild(node.previousElementSibling);
                event.preventDefault();
            } else if (!this.options.disableDoubleReturn && MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER)) {
                // hitting return in the begining of a header will create empty header elements before the current one
                // instead, make "<p><br></p>" element, which are what happens if you hit return in an empty paragraph
                p = this.options.ownerDocument.createElement('p');
                p.innerHTML = '<br>';
                node.previousElementSibling.parentNode.insertBefore(p, node);
                event.preventDefault();
            }
        } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.DELETE) &&
                    // between two sibling elements
                    node.nextElementSibling &&
                    node.previousElementSibling &&
                    // not in a header
                    !isHeader.test(tagName) &&
                    // in an empty tag
                    isEmpty.test(node.innerHTML) &&
                    // when the next tag *is* a header
                    isHeader.test(node.nextElementSibling.nodeName.toLowerCase())) {
            // hitting delete in an empty element preceding a header, ex:
            //  <p>[CURSOR]</p><h1>Header</h1>
            // Will cause the h1 to become a paragraph.
            // Instead, delete the paragraph node and move the cursor to the begining of the h1

            // remove node and move cursor to start of header
            MediumEditor.selection.moveCursor(this.options.ownerDocument, node.nextElementSibling);

            node.previousElementSibling.parentNode.removeChild(node);

            event.preventDefault();
        } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.BACKSPACE) &&
                tagName === 'li' &&
                // hitting backspace inside an empty li
                isEmpty.test(node.innerHTML) &&
                // is first element (no preceeding siblings)
                !node.previousElementSibling &&
                // parent also does not have a sibling
                !node.parentElement.previousElementSibling &&
                // is not the only li in a list
                node.nextElementSibling &&
                node.nextElementSibling.nodeName.toLowerCase() === 'li') {
            // backspacing in an empty first list element in the first list (with more elements) ex:
            //  <ul><li>[CURSOR]</li><li>List Item 2</li></ul>
            // will remove the first <li> but add some extra element before (varies based on browser)
            // Instead, this will:
            // 1) remove the list element
            // 2) create a paragraph before the list
            // 3) move the cursor into the paragraph

            // create a paragraph before the list
            p = this.options.ownerDocument.createElement('p');
            p.innerHTML = '<br>';
            node.parentElement.parentElement.insertBefore(p, node.parentElement);

            // move the cursor into the new paragraph
            MediumEditor.selection.moveCursor(this.options.ownerDocument, p);

            // remove the list element
            node.parentElement.removeChild(node);

            event.preventDefault();
        } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.BACKSPACE) &&
                (MediumEditor.util.getClosestTag(node, 'blockquote') !== false) &&
                MediumEditor.selection.getCaretOffsets(node).left === 0) {

            // when cursor is at the begining of the element and the element is <blockquote>
            // then pressing backspace key should change the <blockquote> to a <p> tag
            event.preventDefault();
            MediumEditor.util.execFormatBlock(this.options.ownerDocument, 'p');
        } else if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER) &&
                (MediumEditor.util.getClosestTag(node, 'blockquote') !== false) &&
                MediumEditor.selection.getCaretOffsets(node).right === 0) {

            // when cursor is at the end of <blockquote>,
            // then pressing enter key should create <p> tag, not <blockquote>
            p = this.options.ownerDocument.createElement('p');
            p.innerHTML = '<br>';
            node.parentElement.insertBefore(p, node.nextSibling);

            // move the cursor into the new paragraph
            MediumEditor.selection.moveCursor(this.options.ownerDocument, p);

            event.preventDefault();
        }
    }

    function handleKeyup(event) {
        var node = MediumEditor.selection.getSelectionStart(this.options.ownerDocument),
            tagName;

        if (!node) {
            return;
        }

        // https://github.com/yabwe/medium-editor/issues/994
        // Firefox thrown an error when calling `formatBlock` on an empty editable blockContainer that's not a <div>
        if (MediumEditor.util.isMediumEditorElement(node) && node.children.length === 0 && !MediumEditor.util.isBlockContainer(node)) {
            this.options.ownerDocument.execCommand('formatBlock', false, 'p');
        }

        // https://github.com/yabwe/medium-editor/issues/834
        // https://github.com/yabwe/medium-editor/pull/382
        // Don't call format block if this is a block element (ie h1, figCaption, etc.)
        if (MediumEditor.util.isKey(event, MediumEditor.util.keyCode.ENTER) &&
            !MediumEditor.util.isListItem(node) &&
            !MediumEditor.util.isBlockContainer(node)) {

            tagName = node.nodeName.toLowerCase();
            // For anchor tags, unlink
            if (tagName === 'a') {
                this.options.ownerDocument.execCommand('unlink', false, null);
            } else if (!event.shiftKey && !event.ctrlKey) {
                this.options.ownerDocument.execCommand('formatBlock', false, 'p');
            }
        }
    }

    function handleEditableInput(event, editable) {
        var textarea = editable.parentNode.querySelector('textarea[medium-editor-textarea-id="' + editable.getAttribute('medium-editor-textarea-id') + '"]');
        if (textarea) {
            textarea.value = editable.innerHTML.trim();
        }
    }

    // Internal helper methods which shouldn't be exposed externally

    function addToEditors(win) {
        if (!win._mediumEditors) {
            // To avoid breaking users who are assuming that the unique id on
            // medium-editor elements will start at 1, inserting a 'null' in the
            // array so the unique-id can always map to the index of the editor instance
            win._mediumEditors = [null];
        }

        // If this already has a unique id, re-use it
        if (!this.id) {
            this.id = win._mediumEditors.length;
        }

        win._mediumEditors[this.id] = this;
    }

    function removeFromEditors(win) {
        if (!win._mediumEditors || !win._mediumEditors[this.id]) {
            return;
        }

        /* Setting the instance to null in the array instead of deleting it allows:
         * 1) Each instance to preserve its own unique-id, even after being destroyed
         *    and initialized again
         * 2) The unique-id to always correspond to an index in the array of medium-editor
         *    instances. Thus, we will be able to look at a contenteditable, and determine
         *    which instance it belongs to, by indexing into the global array.
         */
        win._mediumEditors[this.id] = null;
    }

    function createElementsArray(selector, doc, filterEditorElements) {
        var elements = [];

        if (!selector) {
            selector = [];
        }
        // If string, use as query selector
        if (typeof selector === 'string') {
            selector = doc.querySelectorAll(selector);
        }
        // If element, put into array
        if (MediumEditor.util.isElement(selector)) {
            selector = [selector];
        }

        if (filterEditorElements) {
            // Remove elements that have already been initialized by the editor
            // selecotr might not be an array (ie NodeList) so use for loop
            for (var i = 0; i < selector.length; i++) {
                var el = selector[i];
                if (MediumEditor.util.isElement(el) &&
                    !el.getAttribute('data-medium-editor-element') &&
                    !el.getAttribute('medium-editor-textarea-id')) {
                    elements.push(el);
                }
            }
        } else {
            // Convert NodeList (or other array like object) into an array
            elements = Array.prototype.slice.apply(selector);
        }

        return elements;
    }

    function cleanupTextareaElement(element) {
        var textarea = element.parentNode.querySelector('textarea[medium-editor-textarea-id="' + element.getAttribute('medium-editor-textarea-id') + '"]');
        if (textarea) {
            // Un-hide the textarea
            textarea.classList.remove('medium-editor-hidden');
            textarea.removeAttribute('medium-editor-textarea-id');
        }
        if (element.parentNode) {
            element.parentNode.removeChild(element);
        }
    }

    function setExtensionDefaults(extension, defaults) {
        Object.keys(defaults).forEach(function (prop) {
            if (extension[prop] === undefined) {
                extension[prop] = defaults[prop];
            }
        });
        return extension;
    }

    function initExtension(extension, name, instance) {
        var extensionDefaults = {
            'window': instance.options.contentWindow,
            'document': instance.options.ownerDocument,
            'base': instance
        };

        // Add default options into the extension
        extension = setExtensionDefaults(extension, extensionDefaults);

        // Call init on the extension
        if (typeof extension.init === 'function') {
            extension.init();
        }

        // Set extension name (if not already set)
        if (!extension.name) {
            extension.name = name;
        }
        return extension;
    }

    function isToolbarEnabled() {
        // If any of the elements don't have the toolbar disabled
        // We need a toolbar
        if (this.elements.every(function (element) {
                return !!element.getAttribute('data-disable-toolbar');
            })) {
            return false;
        }

        return this.options.toolbar !== false;
    }

    function isAnchorPreviewEnabled() {
        // If toolbar is disabled, don't add
        if (!isToolbarEnabled.call(this)) {
            return false;
        }

        return this.options.anchorPreview !== false;
    }

    function isPlaceholderEnabled() {
        return this.options.placeholder !== false;
    }

    function isAutoLinkEnabled() {
        return this.options.autoLink !== false;
    }

    function isImageDraggingEnabled() {
        return this.options.imageDragging !== false;
    }

    function isKeyboardCommandsEnabled() {
        return this.options.keyboardCommands !== false;
    }

    function shouldUseFileDraggingExtension() {
        // Since the file-dragging extension replaces the image-dragging extension,
        // we need to check if the user passed an overrided image-dragging extension.
        // If they have, to avoid breaking users, we won't use file-dragging extension.
        return !this.options.extensions['imageDragging'];
    }

    function createContentEditable(textarea) {
        var div = this.options.ownerDocument.createElement('div'),
            now = Date.now(),
            uniqueId = 'medium-editor-' + now,
            atts = textarea.attributes;

        // Some browsers can move pretty fast, since we're using a timestamp
        // to make a unique-id, ensure that the id is actually unique on the page
        while (this.options.ownerDocument.getElementById(uniqueId)) {
            now++;
            uniqueId = 'medium-editor-' + now;
        }

        div.className = textarea.className;
        div.id = uniqueId;
        div.innerHTML = textarea.value;

        textarea.setAttribute('medium-editor-textarea-id', uniqueId);

        // re-create all attributes from the textearea to the new created div
        for (var i = 0, n = atts.length; i < n; i++) {
            // do not re-create existing attributes
            if (!div.hasAttribute(atts[i].nodeName)) {
                div.setAttribute(atts[i].nodeName, atts[i].nodeValue);
            }
        }

        // If textarea has a form, listen for reset on the form to clear
        // the content of the created div
        if (textarea.form) {
            this.on(textarea.form, 'reset', function (event) {
                if (!event.defaultPrevented) {
                    this.resetContent(this.options.ownerDocument.getElementById(uniqueId));
                }
            }.bind(this));
        }

        textarea.classList.add('medium-editor-hidden');
        textarea.parentNode.insertBefore(
            div,
            textarea
        );

        return div;
    }

    function initElement(element, editorId) {
        if (!element.getAttribute('data-medium-editor-element')) {
            if (element.nodeName.toLowerCase() === 'textarea') {
                element = createContentEditable.call(this, element);

                // Make sure we only attach to editableInput once for <textarea> elements
                if (!this.instanceHandleEditableInput) {
                    this.instanceHandleEditableInput = handleEditableInput.bind(this);
                    this.subscribe('editableInput', this.instanceHandleEditableInput);
                }
            }

            if (!this.options.disableEditing && !element.getAttribute('data-disable-editing')) {
                element.setAttribute('contentEditable', true);
                element.setAttribute('spellcheck', this.options.spellcheck);
            }

            // Make sure we only attach to editableKeydownEnter once for disable-return options
            if (!this.instanceHandleEditableKeydownEnter) {
                if (element.getAttribute('data-disable-return') || element.getAttribute('data-disable-double-return')) {
                    this.instanceHandleEditableKeydownEnter = handleDisabledEnterKeydown.bind(this);
                    this.subscribe('editableKeydownEnter', this.instanceHandleEditableKeydownEnter);
                }
            }

            // if we're not disabling return, add a handler to help handle cleanup
            // for certain cases when enter is pressed
            if (!this.options.disableReturn && !element.getAttribute('data-disable-return')) {
                this.on(element, 'keyup', handleKeyup.bind(this));
            }

            var elementId = MediumEditor.util.guid();

            element.setAttribute('data-medium-editor-element', true);
            element.classList.add('medium-editor-element');
            element.setAttribute('role', 'textbox');
            element.setAttribute('aria-multiline', true);
            element.setAttribute('data-medium-editor-editor-index', editorId);
            // TODO: Merge data-medium-editor-element and medium-editor-index attributes for 6.0.0
            // medium-editor-index is not named correctly anymore and can be re-purposed to signify
            // whether the element has been initialized or not
            element.setAttribute('medium-editor-index', elementId);
            initialContent[elementId] = element.innerHTML;

            this.events.attachAllEventsToElement(element);
        }

        return element;
    }

    function attachHandlers() {
        // attach to tabs
        this.subscribe('editableKeydownTab', handleTabKeydown.bind(this));

        // Bind keys which can create or destroy a block element: backspace, delete, return
        this.subscribe('editableKeydownDelete', handleBlockDeleteKeydowns.bind(this));
        this.subscribe('editableKeydownEnter', handleBlockDeleteKeydowns.bind(this));

        // Bind double space event
        if (this.options.disableExtraSpaces) {
            this.subscribe('editableKeydownSpace', handleDisableExtraSpaces.bind(this));
        }

        // Make sure we only attach to editableKeydownEnter once for disable-return options
        if (!this.instanceHandleEditableKeydownEnter) {
            // disabling return or double return
            if (this.options.disableReturn || this.options.disableDoubleReturn) {
                this.instanceHandleEditableKeydownEnter = handleDisabledEnterKeydown.bind(this);
                this.subscribe('editableKeydownEnter', this.instanceHandleEditableKeydownEnter);
            }
        }
    }

    function initExtensions() {

        this.extensions = [];

        // Passed in extensions
        Object.keys(this.options.extensions).forEach(function (name) {
            // Always save the toolbar extension for last
            if (name !== 'toolbar' && this.options.extensions[name]) {
                this.extensions.push(initExtension(this.options.extensions[name], name, this));
            }
        }, this);

        // 4 Cases for imageDragging + fileDragging extensons:
        //
        // 1. ImageDragging ON + No Custom Image Dragging Extension:
        //    * Use fileDragging extension (default options)
        // 2. ImageDragging OFF + No Custom Image Dragging Extension:
        //    * Use fileDragging extension w/ images turned off
        // 3. ImageDragging ON + Custom Image Dragging Extension:
        //    * Don't use fileDragging (could interfere with custom image dragging extension)
        // 4. ImageDragging OFF + Custom Image Dragging:
        //    * Don't use fileDragging (could interfere with custom image dragging extension)
        if (shouldUseFileDraggingExtension.call(this)) {
            var opts = this.options.fileDragging;
            if (!opts) {
                opts = {};

                // Image is in the 'allowedTypes' list by default.
                // If imageDragging is off override the 'allowedTypes' list with an empty one
                if (!isImageDraggingEnabled.call(this)) {
                    opts.allowedTypes = [];
                }
            }
            this.addBuiltInExtension('fileDragging', opts);
        }

        // Built-in extensions
        var builtIns = {
            paste: true,
            'anchor-preview': isAnchorPreviewEnabled.call(this),
            autoLink: isAutoLinkEnabled.call(this),
            keyboardCommands: isKeyboardCommandsEnabled.call(this),
            placeholder: isPlaceholderEnabled.call(this)
        };
        Object.keys(builtIns).forEach(function (name) {
            if (builtIns[name]) {
                this.addBuiltInExtension(name);
            }
        }, this);

        // Users can pass in a custom toolbar extension
        // so check for that first and if it's not present
        // just create the default toolbar
        var toolbarExtension = this.options.extensions['toolbar'];
        if (!toolbarExtension && isToolbarEnabled.call(this)) {
            // Backwards compatability
            var toolbarOptions = MediumEditor.util.extend({}, this.options.toolbar, {
                allowMultiParagraphSelection: this.options.allowMultiParagraphSelection // deprecated
            });
            toolbarExtension = new MediumEditor.extensions.toolbar(toolbarOptions);
        }

        // If the toolbar is not disabled, so we actually have an extension
        // initialize it and add it to the extensions array
        if (toolbarExtension) {
            this.extensions.push(initExtension(toolbarExtension, 'toolbar', this));
        }
    }

    function mergeOptions(defaults, options) {
        var deprecatedProperties = [
            ['allowMultiParagraphSelection', 'toolbar.allowMultiParagraphSelection']
        ];
        // warn about using deprecated properties
        if (options) {
            deprecatedProperties.forEach(function (pair) {
                if (options.hasOwnProperty(pair[0]) && options[pair[0]] !== undefined) {
                    MediumEditor.util.deprecated(pair[0], pair[1], 'v6.0.0');
                }
            });
        }

        return MediumEditor.util.defaults({}, options, defaults);
    }

    function execActionInternal(action, opts) {
        /*jslint regexp: true*/
        var appendAction = /^append-(.+)$/gi,
            justifyAction = /justify([A-Za-z]*)$/g, /* Detecting if is justifyCenter|Right|Left */
            match,
            cmdValueArgument;
        /*jslint regexp: false*/

        // Actions starting with 'append-' should attempt to format a block of text ('formatBlock') using a specific
        // type of block element (ie append-blockquote, append-h1, append-pre, etc.)
        match = appendAction.exec(action);
        if (match) {
            return MediumEditor.util.execFormatBlock(this.options.ownerDocument, match[1]);
        }

        if (action === 'fontSize') {
            // TODO: Deprecate support for opts.size in 6.0.0
            if (opts.size) {
                MediumEditor.util.deprecated('.size option for fontSize command', '.value', '6.0.0');
            }
            cmdValueArgument = opts.value || opts.size;
            return this.options.ownerDocument.execCommand('fontSize', false, cmdValueArgument);
        }

        if (action === 'fontName') {
            // TODO: Deprecate support for opts.name in 6.0.0
            if (opts.name) {
                MediumEditor.util.deprecated('.name option for fontName command', '.value', '6.0.0');
            }
            cmdValueArgument = opts.value || opts.name;
            return this.options.ownerDocument.execCommand('fontName', false, cmdValueArgument);
        }

        if (action === 'createLink') {
            return this.createLink(opts);
        }

        if (action === 'image') {
            var src = this.options.contentWindow.getSelection().toString().trim();
            return this.options.ownerDocument.execCommand('insertImage', false, src);
        }

        /* Issue: https://github.com/yabwe/medium-editor/issues/595
         * If the action is to justify the text */
        if (justifyAction.exec(action)) {
            var result = this.options.ownerDocument.execCommand(action, false, null),
                parentNode = MediumEditor.selection.getSelectedParentElement(MediumEditor.selection.getSelectionRange(this.options.ownerDocument));
            if (parentNode) {
                cleanupJustifyDivFragments.call(this, MediumEditor.util.getTopBlockContainer(parentNode));
            }

            return result;
        }

        cmdValueArgument = opts && opts.value;
        return this.options.ownerDocument.execCommand(action, false, cmdValueArgument);
    }

    /* If we've just justified text within a container block
     * Chrome may have removed <br> elements and instead wrapped lines in <div> elements
     * with a text-align property.  If so, we want to fix this
     */
    function cleanupJustifyDivFragments(blockContainer) {
        if (!blockContainer) {
            return;
        }

        var textAlign,
            childDivs = Array.prototype.slice.call(blockContainer.childNodes).filter(function (element) {
                var isDiv = element.nodeName.toLowerCase() === 'div';
                if (isDiv && !textAlign) {
                    textAlign = element.style.textAlign;
                }
                return isDiv;
            });

        /* If we found child <div> elements with text-align style attributes
         * we should fix this by:
         *
         * 1) Unwrapping each <div> which has a text-align style
         * 2) Insert a <br> element after each set of 'unwrapped' div children
         * 3) Set the text-align style of the parent block element
         */
        if (childDivs.length) {
            // Since we're mucking with the HTML, preserve selection
            this.saveSelection();
            childDivs.forEach(function (div) {
                if (div.style.textAlign === textAlign) {
                    var lastChild = div.lastChild;
                    if (lastChild) {
                        // Instead of a div, extract the child elements and add a <br>
                        MediumEditor.util.unwrap(div, this.options.ownerDocument);
                        var br = this.options.ownerDocument.createElement('BR');
                        lastChild.parentNode.insertBefore(br, lastChild.nextSibling);
                    }
                }
            }, this);
            blockContainer.style.textAlign = textAlign;
            // We're done, so restore selection
            this.restoreSelection();
        }
    }

    var initialContent = {};

    MediumEditor.prototype = {
        // NOT DOCUMENTED - exposed for backwards compatability
        init: function (elements, options) {
            this.options = mergeOptions.call(this, this.defaults, options);
            this.origElements = elements;

            if (!this.options.elementsContainer) {
                this.options.elementsContainer = this.options.ownerDocument.body;
            }

            return this.setup();
        },

        setup: function () {
            if (this.isActive) {
                return;
            }

            addToEditors.call(this, this.options.contentWindow);
            this.events = new MediumEditor.Events(this);
            this.elements = [];

            this.addElements(this.origElements);

            if (this.elements.length === 0) {
                return;
            }

            this.isActive = true;

            // Call initialization helpers
            initExtensions.call(this);
            attachHandlers.call(this);
        },

        destroy: function () {
            if (!this.isActive) {
                return;
            }

            this.isActive = false;

            this.extensions.forEach(function (extension) {
                if (typeof extension.destroy === 'function') {
                    extension.destroy();
                }
            }, this);

            this.events.destroy();

            this.elements.forEach(function (element) {
                // Reset elements content, fix for issue where after editor destroyed the red underlines on spelling errors are left
                if (this.options.spellcheck) {
                    element.innerHTML = element.innerHTML;
                }

                // cleanup extra added attributes
                element.removeAttribute('contentEditable');
                element.removeAttribute('spellcheck');
                element.removeAttribute('data-medium-editor-element');
                element.classList.remove('medium-editor-element');
                element.removeAttribute('role');
                element.removeAttribute('aria-multiline');
                element.removeAttribute('medium-editor-index');
                element.removeAttribute('data-medium-editor-editor-index');

                // Remove any elements created for textareas
                if (element.getAttribute('medium-editor-textarea-id')) {
                    cleanupTextareaElement(element);
                }
            }, this);
            this.elements = [];
            this.instanceHandleEditableKeydownEnter = null;
            this.instanceHandleEditableInput = null;

            removeFromEditors.call(this, this.options.contentWindow);
        },

        on: function (target, event, listener, useCapture) {
            this.events.attachDOMEvent(target, event, listener, useCapture);

            return this;
        },

        off: function (target, event, listener, useCapture) {
            this.events.detachDOMEvent(target, event, listener, useCapture);

            return this;
        },

        subscribe: function (event, listener) {
            this.events.attachCustomEvent(event, listener);

            return this;
        },

        unsubscribe: function (event, listener) {
            this.events.detachCustomEvent(event, listener);

            return this;
        },

        trigger: function (name, data, editable) {
            this.events.triggerCustomEvent(name, data, editable);

            return this;
        },

        delay: function (fn) {
            var self = this;
            return setTimeout(function () {
                if (self.isActive) {
                    fn();
                }
            }, this.options.delay);
        },

        serialize: function () {
            var i,
                elementid,
                content = {},
                len = this.elements.length;

            for (i = 0; i < len; i += 1) {
                elementid = (this.elements[i].id !== '') ? this.elements[i].id : 'element-' + i;
                content[elementid] = {
                    value: this.elements[i].innerHTML.trim()
                };
            }
            return content;
        },

        getExtensionByName: function (name) {
            var extension;
            if (this.extensions && this.extensions.length) {
                this.extensions.some(function (ext) {
                    if (ext.name === name) {
                        extension = ext;
                        return true;
                    }
                    return false;
                });
            }
            return extension;
        },

        /**
         * NOT DOCUMENTED - exposed as a helper for other extensions to use
         */
        addBuiltInExtension: function (name, opts) {
            var extension = this.getExtensionByName(name),
                merged;
            if (extension) {
                return extension;
            }

            switch (name) {
                case 'anchor':
                    merged = MediumEditor.util.extend({}, this.options.anchor, opts);
                    extension = new MediumEditor.extensions.anchor(merged);
                    break;
                case 'anchor-preview':
                    extension = new MediumEditor.extensions.anchorPreview(this.options.anchorPreview);
                    break;
                case 'autoLink':
                    extension = new MediumEditor.extensions.autoLink();
                    break;
                case 'fileDragging':
                    extension = new MediumEditor.extensions.fileDragging(opts);
                    break;
                case 'fontname':
                    extension = new MediumEditor.extensions.fontName(this.options.fontName);
                    break;
                case 'fontsize':
                    extension = new MediumEditor.extensions.fontSize(opts);
                    break;
                case 'keyboardCommands':
                    extension = new MediumEditor.extensions.keyboardCommands(this.options.keyboardCommands);
                    break;
                case 'paste':
                    extension = new MediumEditor.extensions.paste(this.options.paste);
                    break;
                case 'placeholder':
                    extension = new MediumEditor.extensions.placeholder(this.options.placeholder);
                    break;
                default:
                    // All of the built-in buttons for MediumEditor are extensions
                    // so check to see if the extension we're creating is a built-in button
                    if (MediumEditor.extensions.button.isBuiltInButton(name)) {
                        if (opts) {
                            merged = MediumEditor.util.defaults({}, opts, MediumEditor.extensions.button.prototype.defaults[name]);
                            extension = new MediumEditor.extensions.button(merged);
                        } else {
                            extension = new MediumEditor.extensions.button(name);
                        }
                    }
            }

            if (extension) {
                this.extensions.push(initExtension(extension, name, this));
            }

            return extension;
        },

        stopSelectionUpdates: function () {
            this.preventSelectionUpdates = true;
        },

        startSelectionUpdates: function () {
            this.preventSelectionUpdates = false;
        },

        checkSelection: function () {
            var toolbar = this.getExtensionByName('toolbar');
            if (toolbar) {
                toolbar.checkState();
            }
            return this;
        },

        // Wrapper around document.queryCommandState for checking whether an action has already
        // been applied to the current selection
        queryCommandState: function (action) {
            var fullAction = /^full-(.+)$/gi,
                match,
                queryState = null;

            // Actions starting with 'full-' need to be modified since this is a medium-editor concept
            match = fullAction.exec(action);
            if (match) {
                action = match[1];
            }

            try {
                queryState = this.options.ownerDocument.queryCommandState(action);
            } catch (exc) {
                queryState = null;
            }

            return queryState;
        },

        execAction: function (action, opts) {
            /*jslint regexp: true*/
            var fullAction = /^full-(.+)$/gi,
                match,
                result;
            /*jslint regexp: false*/

            // Actions starting with 'full-' should be applied to to the entire contents of the editable element
            // (ie full-bold, full-append-pre, etc.)
            match = fullAction.exec(action);
            if (match) {
                // Store the current selection to be restored after applying the action
                this.saveSelection();
                // Select all of the contents before calling the action
                this.selectAllContents();
                result = execActionInternal.call(this, match[1], opts);
                // Restore the previous selection
                this.restoreSelection();
            } else {
                result = execActionInternal.call(this, action, opts);
            }

            // do some DOM clean-up for known browser issues after the action
            if (action === 'insertunorderedlist' || action === 'insertorderedlist') {
                MediumEditor.util.cleanListDOM(this.options.ownerDocument, this.getSelectedParentElement());
            }

            this.checkSelection();
            return result;
        },

        getSelectedParentElement: function (range) {
            if (range === undefined) {
                range = this.options.contentWindow.getSelection().getRangeAt(0);
            }
            return MediumEditor.selection.getSelectedParentElement(range);
        },

        selectAllContents: function () {
            var currNode = MediumEditor.selection.getSelectionElement(this.options.contentWindow);

            if (currNode) {
                // Move to the lowest descendant node that still selects all of the contents
                while (currNode.children.length === 1) {
                    currNode = currNode.children[0];
                }

                this.selectElement(currNode);
            }
        },

        selectElement: function (element) {
            MediumEditor.selection.selectNode(element, this.options.ownerDocument);

            var selElement = MediumEditor.selection.getSelectionElement(this.options.contentWindow);
            if (selElement) {
                this.events.focusElement(selElement);
            }
        },

        getFocusedElement: function () {
            var focused;
            this.elements.some(function (element) {
                // Find the element that has focus
                if (!focused && element.getAttribute('data-medium-focused')) {
                    focused = element;
                }

                // bail if we found the element that had focus
                return !!focused;
            }, this);

            return focused;
        },

        // Export the state of the selection in respect to one of this
        // instance of MediumEditor's elements
        exportSelection: function () {
            var selectionElement = MediumEditor.selection.getSelectionElement(this.options.contentWindow),
                editableElementIndex = this.elements.indexOf(selectionElement),
                selectionState = null;

            if (editableElementIndex >= 0) {
                selectionState = MediumEditor.selection.exportSelection(selectionElement, this.options.ownerDocument);
            }

            if (selectionState !== null && editableElementIndex !== 0) {
                selectionState.editableElementIndex = editableElementIndex;
            }

            return selectionState;
        },

        saveSelection: function () {
            this.selectionState = this.exportSelection();
        },

        // Restore a selection based on a selectionState returned by a call
        // to MediumEditor.exportSelection
        importSelection: function (selectionState, favorLaterSelectionAnchor) {
            if (!selectionState) {
                return;
            }

            var editableElement = this.elements[selectionState.editableElementIndex || 0];
            MediumEditor.selection.importSelection(selectionState, editableElement, this.options.ownerDocument, favorLaterSelectionAnchor);
        },

        restoreSelection: function () {
            this.importSelection(this.selectionState);
        },

        createLink: function (opts) {
            var currentEditor = MediumEditor.selection.getSelectionElement(this.options.contentWindow),
                customEvent = {},
                targetUrl;

            // Make sure the selection is within an element this editor is tracking
            if (this.elements.indexOf(currentEditor) === -1) {
                return;
            }

            try {
                this.events.disableCustomEvent('editableInput');
                // TODO: Deprecate support for opts.url in 6.0.0
                if (opts.url) {
                    MediumEditor.util.deprecated('.url option for createLink', '.value', '6.0.0');
                }
                targetUrl = opts.url || opts.value;
                if (targetUrl && targetUrl.trim().length > 0) {
                    var currentSelection = this.options.contentWindow.getSelection();
                    if (currentSelection) {
                        var currRange = currentSelection.getRangeAt(0),
                            commonAncestorContainer = currRange.commonAncestorContainer,
                            exportedSelection,
                            startContainerParentElement,
                            endContainerParentElement,
                            textNodes;

                        // If the selection is contained within a single text node
                        // and the selection starts at the beginning of the text node,
                        // MSIE still says the startContainer is the parent of the text node.
                        // If the selection is contained within a single text node, we
                        // want to just use the default browser 'createLink', so we need
                        // to account for this case and adjust the commonAncestorContainer accordingly
                        if (currRange.endContainer.nodeType === 3 &&
                            currRange.startContainer.nodeType !== 3 &&
                            currRange.startOffset === 0 &&
                            currRange.startContainer.firstChild === currRange.endContainer) {
                            commonAncestorContainer = currRange.endContainer;
                        }

                        startContainerParentElement = MediumEditor.util.getClosestBlockContainer(currRange.startContainer);
                        endContainerParentElement = MediumEditor.util.getClosestBlockContainer(currRange.endContainer);

                        // If the selection is not contained within a single text node
                        // but the selection is contained within the same block element
                        // we want to make sure we create a single link, and not multiple links
                        // which can happen with the built in browser functionality
                        if (commonAncestorContainer.nodeType !== 3 && commonAncestorContainer.textContent.length !== 0 && startContainerParentElement === endContainerParentElement) {
                            var parentElement = (startContainerParentElement || currentEditor),
                                fragment = this.options.ownerDocument.createDocumentFragment();

                            // since we are going to create a link from an extracted text,
                            // be sure that if we are updating a link, we won't let an empty link behind (see #754)
                            // (Workaroung for Chrome)
                            this.execAction('unlink');

                            exportedSelection = this.exportSelection();
                            fragment.appendChild(parentElement.cloneNode(true));

                            if (currentEditor === parentElement) {
                                // We have to avoid the editor itself being wiped out when it's the only block element,
                                // as our reference inside this.elements gets detached from the page when insertHTML runs.
                                // If we just use [parentElement, 0] and [parentElement, parentElement.childNodes.length]
                                // as the range boundaries, this happens whenever parentElement === currentEditor.
                                // The tradeoff to this workaround is that a orphaned tag can sometimes be left behind at
                                // the end of the editor's content.
                                // In Gecko:
                                // as an empty <strong></strong> if parentElement.lastChild is a <strong> tag.
                                // In WebKit:
                                // an invented <br /> tag at the end in the same situation
                                MediumEditor.selection.select(
                                    this.options.ownerDocument,
                                    parentElement.firstChild,
                                    0,
                                    parentElement.lastChild,
                                    parentElement.lastChild.nodeType === 3 ?
                                    parentElement.lastChild.nodeValue.length : parentElement.lastChild.childNodes.length
                                );
                            } else {
                                MediumEditor.selection.select(
                                    this.options.ownerDocument,
                                    parentElement,
                                    0,
                                    parentElement,
                                    parentElement.childNodes.length
                                );
                            }

                            var modifiedExportedSelection = this.exportSelection();

                            textNodes = MediumEditor.util.findOrCreateMatchingTextNodes(
                                this.options.ownerDocument,
                                fragment,
                                {
                                    start: exportedSelection.start - modifiedExportedSelection.start,
                                    end: exportedSelection.end - modifiedExportedSelection.start,
                                    editableElementIndex: exportedSelection.editableElementIndex
                                }
                            );
                            // If textNodes are not present, when changing link on images
                            // ex: <a><img src="http://image.test.com"></a>, change fragment to currRange.startContainer
                            // and set textNodes array to [imageElement, imageElement]
                            if (textNodes.length === 0) {
                                fragment = this.options.ownerDocument.createDocumentFragment();
                                fragment.appendChild(commonAncestorContainer.cloneNode(true));
                                textNodes = [fragment.firstChild.firstChild, fragment.firstChild.lastChild];
                            }

                            // Creates the link in the document fragment
                            MediumEditor.util.createLink(this.options.ownerDocument, textNodes, targetUrl.trim());

                            // Chrome trims the leading whitespaces when inserting HTML, which messes up restoring the selection.
                            var leadingWhitespacesCount = (fragment.firstChild.innerHTML.match(/^\s+/) || [''])[0].length;

                            // Now move the created link back into the original document in a way to preserve undo/redo history
                            MediumEditor.util.insertHTMLCommand(this.options.ownerDocument, fragment.firstChild.innerHTML.replace(/^\s+/, ''));
                            exportedSelection.start -= leadingWhitespacesCount;
                            exportedSelection.end -= leadingWhitespacesCount;

                            this.importSelection(exportedSelection);
                        } else {
                            this.options.ownerDocument.execCommand('createLink', false, targetUrl);
                        }

                        if (this.options.targetBlank || opts.target === '_blank') {
                            MediumEditor.util.setTargetBlank(MediumEditor.selection.getSelectionStart(this.options.ownerDocument), targetUrl);
                        } else {
                            MediumEditor.util.removeTargetBlank(MediumEditor.selection.getSelectionStart(this.options.ownerDocument), targetUrl);
                        }

                        if (opts.buttonClass) {
                            MediumEditor.util.addClassToAnchors(MediumEditor.selection.getSelectionStart(this.options.ownerDocument), opts.buttonClass);
                        }
                    }
                }
                // Fire input event for backwards compatibility if anyone was listening directly to the DOM input event
                if (this.options.targetBlank || opts.target === '_blank' || opts.buttonClass) {
                    customEvent = this.options.ownerDocument.createEvent('HTMLEvents');
                    customEvent.initEvent('input', true, true, this.options.contentWindow);
                    for (var i = 0, len = this.elements.length; i < len; i += 1) {
                        this.elements[i].dispatchEvent(customEvent);
                    }
                }
            } finally {
                this.events.enableCustomEvent('editableInput');
            }
            // Fire our custom editableInput event
            this.events.triggerCustomEvent('editableInput', customEvent, currentEditor);
        },

        cleanPaste: function (text) {
            this.getExtensionByName('paste').cleanPaste(text);
        },

        pasteHTML: function (html, options) {
            this.getExtensionByName('paste').pasteHTML(html, options);
        },

        setContent: function (html, index) {
            index = index || 0;

            if (this.elements[index]) {
                var target = this.elements[index];
                target.innerHTML = html;
                this.checkContentChanged(target);
            }
        },

        getContent: function (index) {
            index = index || 0;

            if (this.elements[index]) {
                return this.elements[index].innerHTML.trim();
            }
            return null;
        },

        checkContentChanged: function (editable) {
            editable = editable || MediumEditor.selection.getSelectionElement(this.options.contentWindow);
            this.events.updateInput(editable, { target: editable, currentTarget: editable });
        },

        resetContent: function (element) {
            // For all elements that exist in the this.elements array, we can assume:
            // - Its initial content has been set in the initialContent object
            // - It has a medium-editor-index attribute which is the key value in the initialContent object

            if (element) {
                var index = this.elements.indexOf(element);
                if (index !== -1) {
                    this.setContent(initialContent[element.getAttribute('medium-editor-index')], index);
                }
                return;
            }

            this.elements.forEach(function (el, idx) {
                this.setContent(initialContent[el.getAttribute('medium-editor-index')], idx);
            }, this);
        },

        addElements: function (selector) {
            // Convert elements into an array
            var elements = createElementsArray(selector, this.options.ownerDocument, true);

            // Do we have elements to add now?
            if (elements.length === 0) {
                return false;
            }

            elements.forEach(function (element) {
                // Initialize all new elements (we check that in those functions don't worry)
                element = initElement.call(this, element, this.id);

                // Add new elements to our internal elements array
                this.elements.push(element);

                // Trigger event so extensions can know when an element has been added
                this.trigger('addElement', { target: element, currentTarget: element }, element);
            }, this);
        },

        removeElements: function (selector) {
            // Convert elements into an array
            var elements = createElementsArray(selector, this.options.ownerDocument),
                toRemove = elements.map(function (el) {
                    // For textareas, make sure we're looking at the editor div and not the textarea itself
                    if (el.getAttribute('medium-editor-textarea-id') && el.parentNode) {
                        return el.parentNode.querySelector('div[medium-editor-textarea-id="' + el.getAttribute('medium-editor-textarea-id') + '"]');
                    } else {
                        return el;
                    }
                });

            this.elements = this.elements.filter(function (element) {
                // If this is an element we want to remove
                if (toRemove.indexOf(element) !== -1) {
                    this.events.cleanupElement(element);
                    if (element.getAttribute('medium-editor-textarea-id')) {
                        cleanupTextareaElement(element);
                    }
                    // Trigger event so extensions can clean-up elements that are being removed
                    this.trigger('removeElement', { target: element, currentTarget: element }, element);
                    return false;
                }
                return true;
            }, this);
        }
    };

    MediumEditor.getEditorFromElement = function (element) {
        var index = element.getAttribute('data-medium-editor-editor-index'),
            win = element && element.ownerDocument && (element.ownerDocument.defaultView || element.ownerDocument.parentWindow);
        if (win && win._mediumEditors && win._mediumEditors[index]) {
            return win._mediumEditors[index];
        }
        return null;
    };
}());

(function () {
    // summary: The default options hash used by the Editor

    MediumEditor.prototype.defaults = {
        activeButtonClass: 'medium-editor-button-active',
        buttonLabels: false,
        delay: 0,
        disableReturn: false,
        disableDoubleReturn: false,
        disableExtraSpaces: false,
        disableEditing: false,
        autoLink: false,
        elementsContainer: false,
        contentWindow: window,
        ownerDocument: document,
        targetBlank: false,
        extensions: {},
        spellcheck: true
    };
})();

MediumEditor.parseVersionString = function (release) {
    var split = release.split('-'),
        version = split[0].split('.'),
        preRelease = (split.length > 1) ? split[1] : '';
    return {
        major: parseInt(version[0], 10),
        minor: parseInt(version[1], 10),
        revision: parseInt(version[2], 10),
        preRelease: preRelease,
        toString: function () {
            return [version[0], version[1], version[2]].join('.') + (preRelease ? '-' + preRelease : '');
        }
    };
};

MediumEditor.version = MediumEditor.parseVersionString.call(this, ({
    // grunt-bump looks for this:
    'version': '5.21.1'
}).version);

    return MediumEditor;
}()));

define('storymaps-react/common/builder/textEditor/plugins/blockToolbar/utils',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor'], function (module, exports, _mediumEditor) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var utils = {

    isChildOf: function isChildOf(el, parent) {
      return _mediumEditor2.default.util.traverseUp(el, function (element) {
        return element === parent;
      }) ? true : false;
    }

  };

  exports.default = utils;
  module.exports = exports['default'];
});
//# sourceMappingURL=utils.js.map
;

define('lib-build/less!storymaps-react/common/builder/textEditor/plugins/blockToolbar/Core',[],function(){});
define('storymaps-react/common/builder/textEditor/plugins/blockToolbar/Core',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', './utils', 'lib-build/less!./Core'], function (module, exports, _mediumEditor, _utils) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  var _utils2 = _interopRequireDefault(_utils);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Core = function () {
    function Core(plugin) {
      _classCallCheck(this, Core);

      this._plugin = plugin;
      this._editor = this._plugin.base;
      this._editorNode = $(this._editor.elements[0]);

      this._document = $(document);

      // Config of default medium buttons
      this._defaultButtons = _mediumEditor2.default.extensions.button.prototype.defaults;

      // Reference to regular medium editor toolbar
      this._highlightToolbar = null;
      // Reference to the default medium editor buttons replicated in the block toolbar
      this._buttonsClasses = {};

      // List of tags that are managed by the toolbar
      // TODO: See once decided on ul/ol https://github.com/yabwe/medium-editor/blob/master/src/js/util.js#L105-L113
      this._managedTagsList = [];

      // Active buttons of the current selection
      this._activeButtons = [];
      // An action has been triggered and the toolbar is not updated yet
      this._actionPendingRefresh = false;

      // Status button dom node
      this._button = null;
      // Block toolbar dom node
      this._blockToolbar = null;

      // Keep a reference to constructor global selection object (babel issue otherwise)
      this._selection = _mediumEditor2.default.selection;

      this.init();
      this.createToolbar();
      this.initEvents();
    }

    _createClass(Core, [{
      key: 'selectElement',
      value: function selectElement(el) {
        this.selectedElement = el;
      }
    }, {
      key: 'getSelectedElement',
      value: function getSelectedElement() {
        return this.selectedElement;
      }
    }, {
      key: 'init',
      value: function init() {
        var _this = this;

        var buttons = this._plugin.getButtons();

        buttons.forEach(function (name) {
          _this._buttonsClasses[name] = _this._editor.addBuiltInExtension(name);
          _this._managedTagsList = _this._managedTagsList.concat(_this._buttonsClasses[name].tagNames);
        });

        // p is not listed otherwise
        this._managedTagsList.push('p');

        // Filter out duplicate values
        this._managedTagsList = this._managedTagsList.filter(function (elem, pos, arr) {
          return arr.indexOf(elem) == pos;
        });

        // Store a reference to the regular medium editor toolbar
        // TODO find a better way to do this
        setTimeout(function () {
          var _this2 = this;

          this._editor.extensions.forEach(function (extension) {
            if (extension.name == 'toolbar') {
              _this2._highlightToolbar = extension;
            }
          });
        }.bind(this), 1000);
      }
    }, {
      key: 'createToolbar',
      value: function createToolbar() {
        var buttons = this._plugin.getButtons(),
            mediumButtons = _mediumEditor2.default.extensions.button.prototype.defaults;

        var html = void 0;

        this._button = document.createElement('div');
        this._button.classList.add('block-toolbar-button');
        this._button.setAttribute('contentediable', false);

        this._button.innerHTML = html;
        document.body.appendChild(this._button);

        this._blockToolbar = document.createElement('div');
        this._blockToolbar.classList.add('block-toolbar-buttons');
        this._blockToolbar.classList.add('medium-toolbar-arrow-under');
        this._blockToolbar.setAttribute('contentediable', false);

        html = '<ul>';

        buttons.forEach(function (name) {
          if (mediumButtons[name]) {
            var btnTag = mediumButtons[name].contentFA;

            // TODO: half the button seems to miss that -> report
            if (!btnTag.match(/<\/i>$/)) {
              btnTag += '</i>';
            }

            html += '<li><a class="block-button" data-button="' + name + '">' + btnTag + '</a></li>';
          }
        });

        html += '</ul>';

        this._blockToolbar.innerHTML = html;
        document.body.appendChild(this._blockToolbar);
      }
    }, {
      key: 'initEvents',
      value: function initEvents() {
        var _this3 = this;

        // This could be chained when medium-editor 5.15.2 is released
        // https://github.com/yabwe/medium-editor/pull/1046
        this._plugin.on(document, 'click', this.updateToolbar.bind(this));
        this._plugin.on(document, 'keyup', this.updateToolbarKeyboard.bind(this));
        this._plugin.on(this._button, 'click', this.toggleToolbar.bind(this));

        var buttons = this._blockToolbar.getElementsByClassName('block-button');
        Array.prototype.forEach.call(buttons, function (button) {
          _this3._plugin.on(button, 'click', _this3.handleButtonClick.bind(_this3));
        });

        this._plugin.on(window, 'resize', this.positionToolbar.bind(this));

        this._editor.subscribe('showToolbar', function () {
          this.hideToolbar();
        }.bind(this));
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        this._button.remove();
        this._blockToolbar.remove();
      }
    }, {
      key: 'positionToolbar',
      value: function positionToolbar() {
        var el = void 0,
            elPosition = void 0,
            position = void 0;

        // Don't position buttons if they aren't active
        if (this._button.classList.contains('active') === false) {
          return;
        }

        el = this._editor.getSelectedParentElement();

        // If the element is not a root block
        if (this._managedTagsList.indexOf(el.tagName.toLowerCase()) < 0) {
          // Find it
          el = $(el).closest(this._managedTagsList.join(','))[0];

          // Check that it's still an editor child
          if (!this.shouldDisplayButtonsOnElement(el)) {
            return;
          }
        }

        elPosition = el.getBoundingClientRect();

        // Calculate position
        position = {
          top: this.getScrollY() + elPosition.top,
          left: (window.scrollX || 0) + elPosition.left /*- parseInt(addonsStyle.left, 10)*/ /*- parseInt(addonButtonStyle.marginLeft, 10)*/
        };

        if ($(el).is('h1')) {
          position.top = position.top + 10;
        }

        position.left -= 35;

        // If left position is lower than 0, the buttons would be out of the viewport.
        // In that case, align buttons with the editor
        position.left = position.left < 0 ? elPosition.left : position.left;

        this._button.style.left = position.left + 'px';
        this._button.style.top = position.top + 'px';

        this._blockToolbar.style.top = position.top - 42 + 'px';
        this._blockToolbar.style.left = position.left - 10 + 'px';
      }
    }, {
      key: 'updateToolbar',
      value: function updateToolbar(e) {
        var target = $(e.target),
            $editor = $(this._editor.elements[0]);

        if (!this._editorNode.has(target).length && !this._actionPendingRefresh) {
          // Might have clicked on placeholder?
          if (!(target.is(this._editor.elements[0]) && $editor.find('.block').length == 1 && $editor.find('.block').eq(0).html() == '') && !target.parents('.block-toolbar-button').length) {
            this.hideToolbarAndButton();
            return;
          }
        }

        this.updateToolbarForElement(this._editor.getSelectedParentElement());
      }
    }, {
      key: 'updateToolbarKeyboard',
      value: function updateToolbarKeyboard(e) {
        var keyCode = e.keyCode;

        // backspace, delete
        // enter
        // arrows
        if (keyCode == 8 || keyCode == 46 || keyCode == 13 || keyCode == 37 || keyCode == 38 || keyCode == 39 || keyCode == 40) {
          this.updateToolbarForElement(this._editor.getSelectedParentElement());
        }
      }
    }, {
      key: 'updateToolbarForElement',
      value: function updateToolbarForElement(el) {
        var $el = $(el);

        if (this._highlightToolbar && this._highlightToolbar.multipleBlockElementsSelected()) {
          this.hideToolbarAndButton();
          return;
        }

        if (!this.shouldDisplayButtonsOnElement(el)) {
          this.hideToolbarAndButton();
          return;
        }

        if ($el.hasClass('block-caption') || $el.parents('.block-media').length) {
          this.hideToolbarAndButton();
          return;
        }

        /*
        if (el.tagName.toLowerCase() == 'li') {
          el = el.parentNode;
        }*/

        var isNewBlockSelected = el != this.getSelectedElement();

        // First selection
        if (this.getSelectedElement() == null) {
          isNewBlockSelected = false;
        }
        // Click on the button (in most browser)
        else if ($(el).hasClass('block-toolbar-button-status')) {
            isNewBlockSelected = false;
          }
          // User just realized an action and some of them will change the markup
          //  so el != this.getSelectedElement()
          else if (this._actionPendingRefresh) {
              isNewBlockSelected = false;
              this._actionPendingRefresh = false;
            }

        // Hide toolbar when new block is selected
        if (isNewBlockSelected) {
          this.hideToolbar();
        }

        this.selectElement(el);
        this.showButtons();
      }
    }, {
      key: 'shouldDisplayButtonsOnElement',
      value: function shouldDisplayButtonsOnElement(el) {
        var belongsToEditor = false;

        // Don't show buttons when the editor doesn't belong to editor
        this._plugin.getEditorElements().forEach(function (editor) {
          if (_utils2.default.isChildOf(el, editor)) {
            belongsToEditor = true;
            return;
          }
        });

        if (!belongsToEditor) {
          return false;
        }

        return true;
      }
    }, {
      key: 'showButtons',
      value: function showButtons() {
        var _this4 = this;

        var buttons = this._plugin.getButtons();

        var activeButtons = [];

        //
        // Query editor to know what buttons are active
        //  - reflect button in toolbar
        //  - update the block status
        //

        // Find what buttons are active
        buttons.forEach(function (name) {
          var isActive = false;

          if (_this4._plugin.getQueryStateMethods()[name] == 'ALREADY_APLLIED') {
            var el = $(_this4.getSelectedElement());

            // Formatted text in h1, h2 and blockquote
            if (el.is('b, i, u') && el.parent().is('h1, h2, blockquote')) {
              el = el.parent()[0];
            } else {
              el = el[0];
            }

            isActive = _this4._buttonsClasses[name].isAlreadyApplied(el);
          } else {
            isActive = _this4._editor.queryCommandState(name);
          }

          if (isActive) {
            activeButtons.push(name);
          }
        });

        // Update the buttons status
        buttons.forEach(function (name) {
          var isActive = activeButtons.indexOf(name) > -1;
          $('.block-button[data-button=' + name + ']').toggleClass('active', isActive);
        });

        var activeButton = 'justifyLeft';

        if (activeButtons.length) {
          if (activeButtons.indexOf('h1') > -1) {
            activeButton = 'h1';
          } else if (activeButtons.indexOf('h2') > -1) {
            activeButton = 'h2';
          } else if (activeButtons.indexOf('quote') > -1) {
            activeButton = 'quote';
          } else {
            activeButton = activeButtons[0];
          }
        }
        // For IE
        else {
            activeButtons = [activeButton];
            $('.block-button[data-button=' + activeButton + ']').toggleClass('active', true);
          }

        // Set the button icon
        this._button.innerHTML = '<a class="block-toolbar-button-status">' + this._defaultButtons[activeButton].contentFA + '</a>';

        // Display and position the toolbar
        this._button.classList.add('active');
        this.positionToolbar();
        this._activeButtons = activeButtons;
      }
    }, {
      key: 'toggleToolbar',
      value: function toggleToolbar() {
        this._button.classList.toggle('buttons-active');
        this._blockToolbar.classList.toggle('active');
      }
    }, {
      key: 'hideToolbar',
      value: function hideToolbar() {
        this._button.classList.remove('buttons-active');
        this._blockToolbar.classList.remove('active');
      }
    }, {
      key: 'hideToolbarAndButton',
      value: function hideToolbarAndButton() {
        this._button.classList.remove('active');
        this._button.classList.remove('buttons-active');
        this._blockToolbar.classList.remove('active');
      }
    }, {
      key: 'handleButtonClick',
      value: function handleButtonClick(e) {
        var name = e.currentTarget.getAttribute('data-button');

        this._actionPendingRefresh = true;

        // Select the whole block
        this._selection.selectNode(this.getSelectedElement(), document);

        // TODO cleanup
        // h1, h2 and quote cannot be mixed in all browser (but chrome)
        if (name == 'quote') {
          if (this._activeButtons.indexOf('h1') > -1) {
            this._editor.execAction(this._defaultButtons['h1'].action);
          } else if (this._activeButtons.indexOf('h2') > -1) {
            this._editor.execAction(this._defaultButtons['h2'].action);
          }
          // TODO deal with lists
          // see https://github.com/yabwe/medium-editor/issues/1068
        } else if (name == 'h1' || name == 'h2') {
          if (this._activeButtons.indexOf('quote') > -1) {
            this._editor.execAction(this._defaultButtons['quote'].action);
          } else if (this._activeButtons.indexOf('orderedlist') > -1) {
            this._editor.execAction(this._defaultButtons['orderedlist'].action);
          } else if (this._activeButtons.indexOf('unorderedlist') > -1) {
            this._editor.execAction(this._defaultButtons['unorderedlist'].action);
          }
        }
        /*
        else if (name == 'orderedlist' || name == 'unorderedlist') {
          if (this._activeButtons.indexOf('quote') > -1) {
            this._editor.execAction(this._defaultButtons['quote'].action);
          }
          else if (this._activeButtons.indexOf('h1') > -1) {
            this._editor.execAction(this._defaultButtons['h1'].action);
          }
          else if (this._activeButtons.indexOf('h2') > -1) {
            this._editor.execAction(this._defaultButtons['h2'].action);
          }
        }
        */

        if (this._defaultButtons[name]) {
          this._editor.execAction(this._defaultButtons[name].action);
        }

        this.hideEditorToolbar();
        this._selection.clearSelection(document);

        e.preventDefault();
      }
    }, {
      key: 'hideEditorToolbar',
      value: function hideEditorToolbar() {
        setTimeout(function () {
          this._highlightToolbar.hideToolbar();
        }.bind(this), 0);

        setTimeout(function () {
          this._highlightToolbar.hideToolbar();
        }.bind(this), 10);

        setTimeout(function () {
          this._highlightToolbar.hideToolbar();
        }.bind(this), 50);
      }
    }, {
      key: 'getScrollY',
      value: function getScrollY() {
        return this._document.scrollTop();
      }
    }]);

    return Core;
  }();

  exports.default = Core;
  module.exports = exports['default'];
});
//# sourceMappingURL=Core.js.map
;
define('storymaps-react/common/builder/textEditor/plugins/blockToolbar/Plugin',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', './Core'], function (module, exports, _mediumEditor, _Core) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  var _Core2 = _interopRequireDefault(_Core);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var BlockToolbar = _mediumEditor2.default.Extension.extend({
    name: 'blockToolbar',

    _initializedAddons: {},

    init: function init() {
      _mediumEditor2.default.Extension.prototype.init.apply(this, arguments);

      this.core = new _Core2.default(this);
    },

    destroy: function destroy() {
      this.core.destroy();
    },

    getCore: function getCore() {
      return this.core;
    },

    getButtons: function getButtons() {
      return this.buttons;
    },

    getQueryStateMethods: function getQueryStateMethods() {
      return this.queryStateMethods;
    },

    hide: function hide() {
      this.core.hideToolbarAndButton();
    },

    updateToolbar: function updateToolbar() {
      this.core.updateToolbarForElement(this.base.getSelectedParentElement());
    }
  });

  /*
   * Based on Medium Insert Plugin 3.0 development branch on 04/14
   * https://github.com/orthes/medium-editor-insert-plugin
   */

  exports.default = BlockToolbar;
  module.exports = exports['default'];
});
//# sourceMappingURL=Plugin.js.map
;

define('lib-build/less!storymaps-react/common/builder/textEditor/plugins/blockAdd/Core',[],function(){});
define('storymaps-react/common/builder/textEditor/plugins/blockAdd/Core',['module', 'exports', 'dojo/has', 'lib-build/less!./Core'], function (module, exports, _has) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _has2 = _interopRequireDefault(_has);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Core = function () {
    function Core(plugin) {
      _classCallCheck(this, Core);

      this._plugin = plugin;
      this._editor = this._plugin.base;

      this._document = $(document);
      this._editorNode = $(this._editor.elements[0]);

      // The new block menu dom node
      this._menu = null;

      // Advanced placement rules for Immersive
      // This avoid too much measuring that has to be updated at runtime
      // But should be reviewed
      this._placementRules = null;

      this.createMenu();
      this.initEvents();
      this.addBlockEvents();
    }

    _createClass(Core, [{
      key: 'setPlacementRules',
      value: function setPlacementRules(rules) {
        this._placementRules = rules;

        // jQuery doesn't seems to allow to override values that are set to important with inherit
        if (rules.left) {
          this._menu.attr('style', 'left:' + rules.left);
        }
        this._menu.css(rules);
      }
    }, {
      key: 'addBlockEvents',
      value: function addBlockEvents() {
        this.getEditorBlocks().removeClass('show-add-invite').off('mousemove').off('mouseleave').mousemove(function (e) {
          var target = $(e.target),
              el = target[0];

          if (!target.hasClass('block')) {
            return;
          }

          var position = el.getBoundingClientRect();
          var isOnAddInvite = e.pageY > position.bottom + this.getScrollY();

          $(e.target).toggleClass('show-add-invite', isOnAddInvite)
          // For Safari, also an issue on IE but doesn't help
          .css('cursor', isOnAddInvite ? 'hand' : '');
        }.bind(this)).mouseleave(function () {
          var target = $(this);
          if (!target.hasClass('block')) {
            return;
          }

          target.toggleClass('show-add-invite', false).css('cursor', '');
        });
      }
    }, {
      key: 'getEditorBlocks',
      value: function getEditorBlocks() {
        return this._editorNode.find(this._plugin.getBlocksSelector());
      }
    }, {
      key: 'onEditorContentChange',
      value: function onEditorContentChange() {
        // Need a slight delay for paste
        setTimeout(function () {
          this.addBlockEvents();
        }.bind(this), 200);
      }
    }, {
      key: 'update',
      value: function update() {
        this.onEditorContentChange();
      }
    }, {
      key: 'destroy',
      value: function destroy() {
        this._menu.remove();
      }
    }, {
      key: 'createMenu',
      value: function createMenu() {
        var buttons = this._plugin.getButtons();

        this._menu = document.createElement('div');
        this._menu.classList.add('add-toolbar-menu-container');
        this._menu.setAttribute('contentediable', false);

        var html = '<div class="add-toolbar-menu"><ul>';

        Object.keys(buttons).forEach(function (name) {
          var button = buttons[name];
          var icon = buttons[name].icon || '';
          var iconHover = buttons[name].iconHover || '';
          var iconNode = '<img class="add-button-icon" src="' + icon + '" />';

          html += '<li><a class="add-button" data-button="' + name + '" data-icon="' + icon + '" data-icon-hover="' + iconHover + '">' + iconNode + ' ' + button.label + '</a></li>';
        });

        html += '</ul></div>';

        this._menu.innerHTML = html;
        document.body.appendChild(this._menu);

        this._menu = $(this._menu); // Mhhhh
      }
    }, {
      key: 'initEvents',
      value: function initEvents() {
        var _this = this;

        // Listen to all click event (so we can discard when toolbar is active if clicking outside)
        this._plugin.on(document, 'click', this.handleDocumentClick.bind(this));

        // Menu option click
        var buttons = this._menu[0].getElementsByClassName('add-button');
        Array.prototype.forEach.call(buttons, function (button) {
          _this._plugin.on(button, 'click', _this.handleButtonClick.bind(_this));

          if (button.getAttribute('data-icon-hover')) {
            $(button).hover(function () {
              $(this).find('img').attr('src', button.getAttribute('data-icon-hover'));
            }, function () {
              $(this).find('img').attr('src', button.getAttribute('data-icon'));
            });
          }
        });

        // Listen to editor content change to refresh the block evetns
        this._editor.subscribe('editableInput', this.onEditorContentChange.bind(this));

        if ((0, _has2.default)('mac')) {
          $('body').addClass('is-mac-os');
        }
      }
    }, {
      key: 'handleDocumentClick',
      value: function handleDocumentClick(e) {
        var target = $(e.target),
            targetIsAddBlock = false,
            targetPosition = null;

        if (this._editorNode.has(target).length && target.hasClass('block')) {
          targetPosition = e.target.getBoundingClientRect();
          if (e.pageY > targetPosition.bottom + this.getScrollY()) {
            targetIsAddBlock = true;
          }
        }

        this.hideMenuAndInvite();

        if (targetIsAddBlock) {
          if (this._menu.hasClass('active')) {
            if (this._menu.data('block-index') == target.index()) {
              this._menu.removeClass('active');
              return;
            }
          }

          this._menu.css({
            top: this.getScrollY() + targetPosition.bottom
          }).data('block-index', target.index()).addClass('active');

          // Hide block toolbar
          if (this._editor.options.extensions && this._editor.options.extensions.blockToolbar) {
            this._editor.options.extensions.blockToolbar.hide();
          }

          target.addClass('add-menu-active');

          //
          // Scroll the page if there isn't enough room for the menu
          //
          var toolbarBBOX = this._menu[0].getBoundingClientRect(),
              scrollOffset = 0;

          if (toolbarBBOX.bottom > app.display.windowHeight) {
            scrollOffset = app.display.windowHeight - toolbarBBOX.bottom;
          }

          if (scrollOffset) {
            var currentScroll = document.body.scrollTop || document.documentElement.scrollTop;
            $('html,body').animate({
              scrollTop: currentScroll - scrollOffset + 10
            }, 150);
          }
        }
      }
    }, {
      key: 'hideMenuAndInvite',
      value: function hideMenuAndInvite() {
        this.getEditorBlocks().removeClass('add-menu-active');
        this._menu.removeClass('active');
      }
    }, {
      key: 'handleButtonClick',
      value: function handleButtonClick(e) {
        var name = e.currentTarget.getAttribute('data-button');
        var buttons = this._plugin.getButtons();

        if (buttons[name].action) {
          var targetEl = this._editorNode.find('.add-menu-active'),
              sectionIndex = targetEl.parents('.section').eq(0).index();

          buttons[name].action({
            previousNode: targetEl,
            sectionIndex: sectionIndex,
            blockIndex: targetEl.index()
          }).then(function (content) {
            // Adding a new section
            if (!content) {
              this.hideMenuAndInvite();
              return;
            }

            // Adding a block
            targetEl.after(content);
            this.update();
            this.hideMenuAndInvite();

            // Focus text block and display block toolbar
            if (name == 'text') {
              var node = targetEl.next();
              this._editor.selectElement(node[0]);

              setTimeout(function () {
                node.click();
              }, 50);
            }

            // First sequence of the story
            if (targetEl.hasClass('block-placeholder')) {
              targetEl.remove();
              this._editorNode.attr('contentEditable', 'true');

              this._editor.selectElement(node[0]);
              setTimeout(function () {
                node.click();
              }, 50);
            }
          }.bind(this), function () {
            // this catches the cancelled or rejected deferred
            // so it doesn't throw console errors.
          });
        }
      }
    }, {
      key: 'getScrollY',
      value: function getScrollY() {
        return this._document.scrollTop();
      }
    }]);

    return Core;
  }();

  exports.default = Core;
  module.exports = exports['default'];
});
//# sourceMappingURL=Core.js.map
;
define('storymaps-react/common/builder/textEditor/plugins/blockAdd/Plugin',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', './Core'], function (module, exports, _mediumEditor, _Core) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  var _Core2 = _interopRequireDefault(_Core);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var BlockAdd = _mediumEditor2.default.Extension.extend({
    name: 'blockAdd',

    _initializedAddons: {},

    init: function init() {
      _mediumEditor2.default.Extension.prototype.init.apply(this, arguments);

      this.core = new _Core2.default(this);
    },

    destroy: function destroy() {
      this.core.destroy();
    },

    getCore: function getCore() {
      return this.core;
    },

    getButtons: function getButtons() {
      return this.buttons;
    },

    getBlocksSelector: function getBlocksSelector() {
      return this.blocksSelector;
    },

    update: function update() {
      this.core.update();
    },

    hide: function hide() {
      this.core.hideMenuAndInvite();
    },

    setPlacementRules: function setPlacementRules(rules) {
      this.core.setPlacementRules(rules);
    }
  });

  /*
   * Based on Medium Insert Plugin 3.0 development branch on 04/14
   * https://github.com/orthes/medium-editor-insert-plugin
   */

  exports.default = BlockAdd;
  module.exports = exports['default'];
});
//# sourceMappingURL=Plugin.js.map
;

define('lib-build/less!storymaps-react/common/builder/textEditor/plugins/AnchorPreview',[],function(){});
define('storymaps-react/common/builder/textEditor/plugins/AnchorPreview',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', 'lib-build/less!./AnchorPreview'], function (module, exports, _mediumEditor) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var AnchorPreview = _mediumEditor2.default.extensions.anchorPreview.extend({
    name: 'anchor-preview',
    init: function init() {
      _mediumEditor2.default.extensions.anchorPreview.prototype.init.call(this);
    },
    getTemplate: function getTemplate() {
      return '<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">' + '    <a class="medium-editor-toolbar-anchor-preview-inner" target="_blank"></a>' + '    <i class="fa fa-trash-o delete-btn" aria-hidden="true" title="Delete"></i>' + '    <i class="fa fa-pencil edit-btn" aria-hidden="true" title="Edit"></i>' + '</div>';
    },
    handleClick: function handleClick(event) {
      var anchorExtension = this.base.getExtensionByName('anchor'),
          activeAnchor = this.activeAnchor;

      if (anchorExtension && activeAnchor) {
        // Add a custom class to the edit toolbar for style
        $(anchorExtension.form).parent().addClass('medium-editor-toolbar-anchor-sm');

        // Delete
        if (event.target.classList.contains('delete-btn')) {
          _mediumEditor2.default.selection.selectNode(this.activeAnchor, document);

          anchorExtension.execAction('unlink');
          event.preventDefault();
        }

        // Edit
        if (event.target.classList.contains('edit-btn')) {
          _mediumEditor2.default.selection.selectNode(this.activeAnchor, document);

          event.preventDefault();

          // Using setTimeout + delay because:
          // We may actually be displaying the anchor form, which should be controlled by delay
          this.base.delay(function () {

            if (activeAnchor) {
              var opts = {
                value: activeAnchor.attributes.href.value,
                target: activeAnchor.getAttribute('target'),
                buttonClass: activeAnchor.getAttribute('class')
              };
              anchorExtension.showForm(opts);
              activeAnchor = null;
            }
          }.bind(this));
        }
      }

      this.hidePreview();
    },
    positionPreview: function positionPreview(activeAnchor) {
      activeAnchor = activeAnchor || this.activeAnchor;

      var buttonHeight = this.anchorPreview.offsetHeight,
          boundary = activeAnchor.getBoundingClientRect(),
          middleBoundary = (boundary.left + boundary.right) / 2,
          diffLeft = this.diffLeft,
          halfOffsetWidth,
          defaultLeft;

      halfOffsetWidth = this.anchorPreview.offsetWidth / 2;

      var toolbarExtension = this.base.getExtensionByName('toolbar');

      if (toolbarExtension) {
        diffLeft = toolbarExtension.diffLeft;
      }

      defaultLeft = diffLeft - halfOffsetWidth;

      this.anchorPreview.style.top = Math.round(boundary.top - buttonHeight + this.window.pageYOffset) + 'px';
      this.anchorPreview.style.right = 'initial';

      if (middleBoundary < halfOffsetWidth) {
        this.anchorPreview.style.left = defaultLeft + halfOffsetWidth + 'px';
        this.anchorPreview.style.right = 'initial';
      } else if (this.window.innerWidth - middleBoundary < halfOffsetWidth) {
        this.anchorPreview.style.left = 'auto';
        this.anchorPreview.style.right = 0;
      } else {
        this.anchorPreview.style.left = defaultLeft + middleBoundary + 'px';
        this.anchorPreview.style.right = 'initial';
      }
    }
  });

  exports.default = AnchorPreview;
  module.exports = exports['default'];
});
//# sourceMappingURL=AnchorPreview.js.map
;
define('storymaps-react/common/builder/textEditor/plugins/ColorPicker',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', 'storymaps-react/common/builder/ColorPicker'], function (module, exports, _mediumEditor, _ColorPicker) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  var _ColorPicker2 = _interopRequireDefault(_ColorPicker);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var SELECTION = _mediumEditor2.default.selection;

  var ColorPicker = _mediumEditor2.default.extensions.button.extend({
    name: 'colorPicker',
    action: 'applyForeColor',
    aria: 'color picker',

    init: function init() {
      this.button = this.document.createElement('button');
      this.button.classList.add('medium-editor-action');
      this.button.innerHTML = '<i class="fa fa-paint-brush" aria-hidden="true"></i>';

      var palette = [['#000', '#444', '#666', '#999', '#ccc', '#eee', '#f3f3f3', '#fff'], ['#f00', '#f90', '#ff0', '#0f0', '#0ff', '#00f', '#90f', '#f0f'], ['#f4cccc', '#fce5cd', '#fff2cc', '#d9ead3', '#d0e0e3', '#cfe2f3', '#d9d2e9', '#ead1dc'], ['#ea9999', '#f9cb9c', '#ffe599', '#b6d7a8', '#a2c4c9', '#9fc5e8', '#b4a7d6', '#d5a6bd'], ['#e06666', '#f6b26b', '#ffd966', '#93c47d', '#76a5af', '#6fa8dc', '#8e7cc3', '#c27ba0'], ['#c00', '#e69138', '#f1c232', '#6aa84f', '#45818e', '#3d85c6', '#674ea7', '#a64d79'], ['#900', '#b45f06', '#bf9000', '#38761d', '#134f5c', '#0b5394', '#351c75', '#741b47'], ['#600', '#783f04', '#7f6000', '#274e13', '#0c343d', '#073763', '#20124d', '#4c1130']];

      _ColorPicker2.default.initPicker({
        element: this.button,
        palette: palette,
        onChangeCallback: this.setColor.bind(this),
        showAlpha: true
      });
    },

    setColor: function setColor(color) {
      this.base.importSelection(window.selectionState);
      this.document.execCommand('styleWithCSS', false, true);
      this.document.execCommand('foreColor', false, color);

      // Clear selected text for easy preview
      SELECTION.clearSelection(document);

      // Close toolbar as it's in an invalid state otherwise
      setTimeout(function () {
        var toolbar = this.base.getExtensionByName('toolbar');
        if (toolbar) {
          toolbar.hideToolbar();
        }
      }.bind(this), 0);
    }
  });

  exports.default = ColorPicker;
  module.exports = exports['default'];
});
//# sourceMappingURL=ColorPicker.js.map
;

define('lib-build/less!storymaps-react/common/builder/textEditor/plugins/Anchor',[],function(){});
define('storymaps-react/common/builder/textEditor/plugins/Anchor',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', 'lib-build/less!./Anchor'], function (module, exports, _mediumEditor) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var SELECTION = _mediumEditor2.default.selection;

  var Anchor = _mediumEditor2.default.extensions.anchor.extend({
    name: 'anchor',
    init: function init() {
      _mediumEditor2.default.extensions.anchor.prototype.init.call(this);
    },
    // Make sure to add a class we can style with CSS
    // Not sure why but '' is only added second time the form is displayed
    createForm: function createForm() {
      var form = _mediumEditor2.default.extensions.anchor.prototype.createForm.call(this);
      form.className += ' medium-editor-toolbar-anchor-creation';
      return form;
    },
    completeFormSave: function completeFormSave(opts) {
      _mediumEditor2.default.extensions.anchor.prototype.completeFormSave.call(this, opts);

      // Clear selected text
      //SELECTION.clearSelection(document);

      // Hide regular toolbar
      this.hideToolbarDefaultActions();

      setTimeout(function () {
        // Make sure that the anchor toolbar is fully hidden
        var toolbar = this.base.getExtensionByName('toolbar');
        if (toolbar) {
          toolbar.hideToolbar();
        }

        // Open anchor preview
        var anchorPreview = this.base.getExtensionByName('anchor-preview');
        anchorPreview.handleEditableMouseover({
          target: SELECTION.getSelectedElements(document)[0]
        });
      }.bind(this), 0);

      /*
      // Attempt to trigger hover on the link to have the preview toolbar to open
      $(_selection.getSelectedElements(document)).trigger('mouseenter');
        setTimeout(function() {
        console.log(_selection);
        $(_selection.getSelectedElements(document)).trigger('mouseenter');
      }, 100);
      */
    }
  });

  exports.default = Anchor;
  module.exports = exports['default'];
});
//# sourceMappingURL=Anchor.js.map
;

define('lib-build/css!lib/medium-editor/dist/css/medium-editor',[],function(){});

define('lib-build/less!storymaps-react/common/builder/textEditor/MediumEditorWrapper',[],function(){});
define('storymaps-react/common/builder/textEditor/MediumEditorWrapper',['module', 'exports', 'lib/medium-editor/dist/js/medium-editor', './plugins/blockToolbar/Plugin', './plugins/blockAdd/Plugin', './plugins/AnchorPreview', './plugins/ColorPicker', './plugins/Anchor', 'storymaps/common/utils/CommonHelper', 'dojo/Deferred', 'lib-build/css!lib/medium-editor/dist/css/medium-editor', 'lib-build/less!./MediumEditorWrapper'], function (module, exports, _mediumEditor, _Plugin, _Plugin3, _AnchorPreview, _ColorPicker, _Anchor, _CommonHelper, _Deferred) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  exports.default = function () {
    var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

    var _node = params.node,
        _addMedia = params.addMedia,
        _style = params.style,
        _addButtons = params.addButtons || [],
        _authorizedMedia = params.authorizedMedia,
        _onChangeCallback = params.onChange,
        _editor = null;

    /*
    if (! _addButtons) {
      _addButtons = ['text', 'arcgis', 'media', 'title', 'immersive'];
    }
    */

    if (!_node || !_addMedia || !_style) {
      console.error('Could not initialize MediumEditor');
      return;
    }

    var placeholder = {
      text: 'Continue your story here...',
      hideOnClick: false
    };

    if (params.placeholder === false) {
      placeholder = false;
    }

    // Buttons in highlighting toolbar
    var highlightButtons = ['bold', 'italic', 'underline', 'strikethrough', 'anchor' /*, 'orderedlist', 'unorderedlist'*/, 'colorPicker'];

    // Buttons in block toolbar
    var blockButtonsFull = ['h1', 'h2', 'quote', 'justifyLeft', 'justifyCenter', 'justifyRight'],
        blockButtonsCompact = ['justifyLeft', 'justifyCenter', 'justifyRight', 'h2'],

    // All block buttons need to have an entry there describing how the block toolbar has to query their status
    // TODO: there must be a more efficient way to do this
    queryStateMethods = {
      justifyLeft: 'QUERY_STATE',
      justifyCenter: 'QUERY_STATE',
      justifyRight: 'QUERY_STATE',
      quote: 'ALREADY_APLLIED',
      h1: 'ALREADY_APLLIED',
      h2: 'ALREADY_APLLIED' /*,
                            orderedlist: 'ALREADY_APLLIED',
                            unorderedlist: 'ALREADY_APLLIED'*/
    };

    // Buttons in new block menu
    var addButtons = {
      text: {
        icon: 'resources/tpl/builder/icons/text-editor/Text.png',
        label: 'Text',
        action: function action() {
          var resultDeferred = new _Deferred2.default();

          var html = '<p class="block"></p>';

          resultDeferred.resolve(html);

          return resultDeferred;
        }
      },
      media: {
        icon: 'resources/tpl/builder/icons/text-editor/Media.png',
        label: 'Media',
        action: function action(params) {
          var resultDeferred = new _Deferred2.default();

          params = params || {};

          if (!params.previousNode) {
            resultDeferred.reject();
            return resultDeferred;
          }

          app.builder.mediaPicker.open({
            mode: 'add',
            authorizedMedia: _authorizedMedia
          }).then(function (selection) {
            console.log('selected media:', selection);

            var html = _addMedia({
              media: selection,
              blockIndex: params.blockIndex
            });

            resultDeferred.resolve(html);
          }, function () {
            resultDeferred.reject();
          });

          return resultDeferred;
        }
      },
      title: {
        icon: 'resources/tpl/builder/icons/text-editor/Title.png',
        label: 'Title',
        action: function action() {
          var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

          var resultDeferred = new _Deferred2.default();

          if (params.sectionIndex === undefined) {
            resultDeferred.reject();
            return resultDeferred;
          }

          app.Controller.splitAndAddSection({
            section: params.sectionIndex,
            split: params.blockIndex,
            type: 'title'
          });

          resultDeferred.resolve();

          return resultDeferred;
        }
      },
      immersive: {
        icon: 'resources/tpl/builder/icons/text-editor/Immersive.gif',
        //iconHover: 'resources/tpl/builder/icons/text-editor/Immersive-hover.gif',
        label: 'Immersive',
        action: function action() {
          var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

          var resultDeferred = new _Deferred2.default();

          if (params.sectionIndex === undefined) {
            resultDeferred.reject();
            return resultDeferred;
          }

          app.Controller.splitAndAddSection({
            section: params.sectionIndex,
            split: params.blockIndex,
            type: 'immersive'
          });

          resultDeferred.resolve();

          return resultDeferred;
        }
      }
    };

    // Tags that always receive a block class
    var blockElements = 'p, h1, h2, blockquote, ol, ul';

    // Selector used to know what block are decorated with + button
    // TODO: should be defined programattically in the same fashion than blockToolbar
    var addBlocksSelector = '.block';

    // List of media element that:
    // - cannot be deleted with backspace from the next block
    // - are serialized by their parent section or panel
    var mediaElements = '.image-gallery, .image, .block-type-webmap, .block-webpage, .block-type-webscene, .block-type-video';

    //
    // Control what features are exposed
    //

    var addButtonsEnabled = {};
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = _addButtons[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var btn = _step.value;

        if (addButtons[btn]) {
          addButtonsEnabled[btn] = addButtons[btn];
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    var blockButtonsEnabled = _style == 'compact' ? blockButtonsCompact : blockButtonsFull;

    var blockAddExtension = null;

    if (_addButtons.length) {
      blockAddExtension = new _Plugin4.default({
        buttons: addButtonsEnabled,
        blocksSelector: addBlocksSelector,
        style: _style
      });
    }

    var editor = new _mediumEditor2.default(_node, {
      targetBlank: true,
      autoLink: true,
      imageDragging: false,
      fileDragging: false,
      diffTop: -20,
      buttonLabels: 'fontawesome',
      toolbar: {
        allowMultiParagraphSelection: false,
        buttons: highlightButtons
      },
      placeholder: placeholder,
      anchor: {
        linkValidation: true,
        placeholderText: 'Enter a link...'
      },
      paste: {
        // This configuration force only plain text
        forcePlainText: true,
        cleanPastedHTML: false

        /*
        // Changing cleanPastedHTML to true and keep forcePlainText should allow rich text and reject image
        //  but it's not working that good, below is an attempt
        //  it's likely very frustrating for user to discover what's going to be kept so better be safe...
        cleanPastedHTML: true,
        cleanReplacements: [
          [/<!--[^>]*-->/gi, ''], // MS Word
          [/<div/gi, '<p'],
          [/<\/div/gi, '<\/p'],
          [/<pre/gi, '<p'],
          [/<\/pre/gi, '<\/p']
        ],
        cleanAttrs: ['class', 'dir', 'style'],
        cleanTags: ['label', 'meta', 'aside', 'span', 'ul', 'ol', 'table', 'tr', 'td']
        */
      },
      extensions: {
        imageDragging: new function () {}(),
        // TODO? not AMD friendly, can't find Medium...
        //'autolist': new MediumEditorAutolist()
        'blockToolbar': new _Plugin2.default({
          buttons: blockButtonsEnabled,
          queryStateMethods: queryStateMethods,
          style: _style
        }),
        'blockAdd': blockAddExtension,
        // Override anchor preview
        'anchor-preview': new _AnchorPreview2.default(),
        'anchor': new _Anchor2.default(),
        'colorPicker': new _ColorPicker2.default()
      }
    });

    /*
    editor.subscribe('editableClick', function(e) {
      var blockContent = $(editor.getSelectedParentElement());
      console.log(blockContent.parents('.image-gallery').length)
      if (blockContent.parents('.image-gallery').length) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    });
    */

    /*
    editor.subscribe('editableMouseover', function(e) {
      var el = $(e.fromElement);
      if (el.parents('.image-gallery').length) {
        console.log('prevent')
        e.preventDefault();
        e.stopPropagation();
      }
    });
      $(editor.elements[0]).mousemove(function(e) {
      if ($(e.target).parents('.image-gallery').length) {
        console.log('jquery prevent')
        e.preventDefault();
        e.stopPropagation();
      }
    })
    */

    if (params.disableEditing) {
      _node.attr('contenteditable', false);
    }

    // Prevent focus on some elements
    editor.subscribe('editableKeydown', function (e) {
      var el = $(editor.getSelectedParentElement());

      // Prevent backspace on some elements
      if (event.keyCode == 8) {
        // If at the start of a block
        if (SELECTION.getSelectionRange(document).startOffset === 0) {
          var prevBlock = el.prev();

          // Media caption to prevent deleting the media
          if (el.is('.block-caption')) {
            e.preventDefault();
          }
          // Inside a media
          else if (el.is(mediaElements) || el.parents('.block').eq(0).is(mediaElements)) {
              e.preventDefault();
            }
            // And going to delete the block, focus the caption in previous block
            else if (el.hasClass('.block') || prevBlock.is(mediaElements)) {
                e.preventDefault();
                /*
                // Attempt to merge block, seems ok in most case
                setTimeout(function() {
                  SELECTION.moveCursor(document, prevBlock.find('.block-caption')[0], 0);
                }, 0);
                */
              }
              // Prevent backspace on first block when there is no placeholder
              else if (el.is('p, h1, h2, blockquote') && el.index() == 0 && !$(editor.elements[0]).data('placeholder')) {
                  e.preventDefault();
                }

          setTimeout(function () {
            _editor.options.extensions.blockToolbar.updateToolbar();
          }, 0);
        }
      }
      // Prevent deleting the next block if it match mediaElements
      else if (event.keyCode == 46) {
          var range = SELECTION.getSelectionRange(document);
          var nextBlock = el.next();

          if (el.hasClass('block') && nextBlock.is(mediaElements)) {
            // delete empty block
            if (range.startOffset == range.startContainer.length) {
              e.preventDefault();
            }
            // delete whole block
            else if (range.startOffset == 0 && range.endOffset == 0 && range.collapsed == false) {
                setTimeout(function () {
                  SELECTION.moveCursor(document, nextBlock.find('.block-caption')[0], 0);
                  _editor.options.extensions.blockToolbar.updateToolbar();
                }, 0);
              }
          }
        }
        // Arrows
        else if (event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40) {
            setTimeout(function () {
              _editor.options.extensions.blockToolbar.updateToolbar();
            }, 0);
          }

      //
      // Prevent any event on some elements
      // This is not ideal as the carret is displayed
      // editableClick does not seems to allow to reject the event
      // could do it with jQuery but require to attach to every media?
      // TODO: dig
      //

      /*
      // Image
      if (el.parents('.image-container').length) {
        e.preventDefault();
      }
      // Image gallery item
      else if (el.parents('.image-gallery-image-link').length) {
        e.preventDefault();
      }
      // Map
      else if (el.parents('.block-type-webmap').length) {
        e.preventDefault();
      }
      */
    });

    editor.subscribe('editableKeydownEnter', function (e) {
      var blockContent = $(editor.getSelectedParentElement());
      var range = SELECTION.getSelectionRange(document);

      // Hide add menu
      blockAddExtension.hide();

      // Insert a new block if hitting enter at the end of a h1/h2/blockquote
      if (blockContent.is('h1') || blockContent.is('h2') || blockContent.is('blockquote')) {
        // Enter on the first character require this
        if (blockContent.prev().is(blockElements)) {
          blockContent.prev().addClass('block');
        }

        if (range.startOffset == range.startContainer.length) {
          // Insert an empty block and focus it
          blockContent.after('<p class="block"></p>');
          _mediumEditor2.default.selection.moveCursor(document, blockContent.next()[0], 0);

          setTimeout(function () {
            _editor.options.extensions.blockToolbar.updateToolbar();
          }, 10);

          e.preventDefault();
          return;
        }
      }

      // Insert a new block if hitting enter at the end of a caption
      if (blockContent.is('.block-caption')) {
        if (range.startOffset == range.startContainer.length) {
          blockContent.parents('.block').eq(0).after('<p class="block"></p>');
          _mediumEditor2.default.selection.moveCursor(document, blockContent.parents('.block').eq(0).next()[0], 0);
        }

        e.preventDefault();
        return;
      }

      // Prevent adding two consecutive empty block
      if (blockContent.is(addBlocksSelector)) {
        var childrens = blockContent.children();

        // The block is empty
        if (blockContent.html() == '' && childrens.length == 0) {
          e.preventDefault();
        }

        // The previous block is empty and cursor on first character
        if ((blockContent.prev().html() == '' || blockContent.prev().html() == '<br>') && range.startOffset === 0) {
          e.preventDefault();
        }

        // Or the block is visually empty...
        if (childrens.length == 1) {
          if (childrens[0].tagName.toLowerCase() == 'br' && !blockContent.text()) {
            e.preventDefault();
          }
        } else {
          // Click on the new next block so the block toolbar is updated
          setTimeout(function () {
            _editor.options.extensions.blockToolbar.updateToolbar();
          }, 100);
        }
      }
    }.bind(this));

    // On text change
    editor.subscribe('editableInput', function (event, editable) {
      var blockContent = $(editor.getSelectedParentElement());

      // Do not allow children inside caption
      if (blockContent.is('p') && blockContent.parent().is('.block-caption')) {
        blockContent.parent().html(blockContent.html());
        return;
      }

      // Add block class to all elements that qualify
      if (blockContent.is(blockElements)) {
        blockContent.addClass('block');
      }
      // Allow to create h1, h2, blockquote from bold, italic, underline
      else if (blockContent.is('b, i, u') && blockContent.parent().is(blockElements)) {
          blockContent.parent().addClass('block');
        }

      // Clean up paste from word
      $(editable).find('p').contents().each(function () {
        if (this.nodeType === Node.COMMENT_NODE || this.nodeType == 8) {
          $(this).remove();
        }
      });

      onContentChange();
    });

    // Prevent the editor from creating span when merging blocks
    // Keep span with a color as that's what the editor use for the text color
    var el = $(editor.elements[0]);
    el.on('input', function () {
      el.children('p, h1, h2, blockquote').children('span[style]').each(function () {
        if (!this.style.color || this.style.color == 'inherit' || this.style.color == DEFAULT_TEXT_COLOR) {
          $(this).contents().unwrap();
        }
      });

      // Prevent pressing enter twice rapidely to wrap caption content inside a paragraph
      el.find('.block-caption').find('p').each(function () {
        $(this).contents().unwrap();
      });

      // Specific to block-caption
      setTimeout(function () {
        el.find('.block-caption').children('span[style]').each(function () {
          if (!this.style.color || this.style.color == 'inherit' || this.style.color == DEFAULT_TEXT_COLOR) {
            $(this).contents().unwrap();
          }
        });
      }, 50);

      // Prevent invalid block when creating h1/h2/blockquote from empty block through block toolbar
      el.children('h1:not(.block), h2:not(.block), blockquote:not(.block)').children('p:empty').each(function () {
        var ghost = $(this),
            parent = ghost.parent();

        parent.addClass('block');
        ghost.replaceWith('<br>');

        var newEl = parent.children();

        editor.selectElement(newEl[0]);

        setTimeout(function () {
          newEl.click();
        }, 50);
      });
    });

    editor.subscribe('editablePaste', function () {
      setTimeout(function () {
        // Add block class after a paste
        $(editor.elements[0]).find(blockElements).addClass('block');

        /*
        // Remove empty char - works but lose focus
        $(editor.elements[0]).find(blockElements).each(function() {
          var $this = $(this);
          $this.html($this.html().replace(/&nbsp;/g, ''));
        });
        */
      }, 100);
    });

    _editor = editor;

    _editor.extensions.forEach(function (extension) {
      // Modify placeholder so that it hides if entering an empty block with space
      if (extension.name == 'placeholder') {
        extension.updatePlaceholder = function (el, dontShow) {
          // If the element has content, hide the placeholder
          // if (el.querySelector('img, blockquote, ul, ol') || (el.textContent.replace(/^\s+|\s+$/g, '') !== '')) {
          if (el.querySelector('img, blockquote, ul, ol') || el.textContent !== '') {
            return this.hidePlaceholder(el);
          }

          if (!dontShow) {
            this.showPlaceholder(el);
          }
        };
      }
    });

    this.serialize = function () {
      var blocks = [],
          rawOutput = $(_editor.serialize()['element-0'].value);

      $.each(rawOutput, function (i, node) {
        var el = $(node);

        // Ignore text element
        if (node.nodeType == 3) {
          return;
        }

        if (el.is(blockElements)) {
          blocks.push({
            type: 'text',
            text: {
              value: el[0].outerHTML
            }
          });
        } else if (el.is(mediaElements)) {
          blocks.push({
            type: 'media',
            id: el.attr('id')
          });
        }
      });

      return blocks;
    };

    this.hideToolbars = function () {
      _editor.options.extensions.blockToolbar.hide();
      _editor.options.extensions.blockAdd.hide();

      _editor.extensions.forEach(function (extension) {
        if (extension.name == 'toolbar') {
          extension.hideToolbar();
        }
      });
    };

    this.setAddMenuPlacementRules = function (rules) {
      blockAddExtension.setPlacementRules(rules);
    };

    this.focus = function () {
      _editor.elements[0].focus();
    };

    var onContentChange = _CommonHelper2.default.throttle(function () {
      if (_onChangeCallback) {
        _onChangeCallback();
      }
    }, 500);
  };

  var _mediumEditor2 = _interopRequireDefault(_mediumEditor);

  var _Plugin2 = _interopRequireDefault(_Plugin);

  var _Plugin4 = _interopRequireDefault(_Plugin3);

  var _AnchorPreview2 = _interopRequireDefault(_AnchorPreview);

  var _ColorPicker2 = _interopRequireDefault(_ColorPicker);

  var _Anchor2 = _interopRequireDefault(_Anchor);

  var _CommonHelper2 = _interopRequireDefault(_CommonHelper);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  /*
   * There is two ways to handle the editor for a set of block
   *  1. instanciate the editor once and have all the block managed by it (images, ...)
   *  2. instanciate one editor for each block we want to be editable
   *
   * Performance either way is not a concern
   * The block toolbar handle both case very well
   *
   * 1. pros: nothing to do when adding/deleting/merging a block
   * 1. cons: can be harder to know what the editor is doing and position the addToolbar in between blocks
   *     Tried two ways to manage the addToolbar:
   *       1.a: use div inside the DOM: make split/merge really hard as the editor need to ignore those
   *       1.b: use pseudo element: harder to style and manage events but don't mess with the editor
   *
   * 2. pros: make it easy to do the add toolbar
   * 2. cons: need to handle adding/deleting/merging a block (catch the enter/backspace and do the work)
   *            also ideally need to handle key navigation
   *
   * The implementation is 1.b
   */

  var SELECTION = _mediumEditor2.default.selection;

  // Default text color - needed to prevent some editor behavior
  var DEFAULT_TEXT_COLOR = 'rgb(76, 76, 76)'; // OR #4c4c4c

  module.exports = exports['default'];
});
//# sourceMappingURL=MediumEditorWrapper.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/SequenceBuilder',[],function(){});
define('storymaps-react/tpl/view/section/SequenceBuilder',['module', 'exports', './Sequence', 'storymaps/tpl/view/section/Common', 'storymaps-react/common/builder/textEditor/MediumEditorWrapper', 'dojo/topic', 'dojo/_base/lang', 'lib-build/less!./SequenceBuilder'], function (module, exports, _Sequence2, _Common, _MediumEditorWrapper, _topic, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Sequence3 = _interopRequireDefault(_Sequence2);

  var _Common2 = _interopRequireDefault(_Common);

  var _MediumEditorWrapper2 = _interopRequireDefault(_MediumEditorWrapper);

  var _topic2 = _interopRequireDefault(_topic);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var SequenceBuilder = function (_Sequence) {
    _inherits(SequenceBuilder, _Sequence);

    function SequenceBuilder(section) {
      _classCallCheck(this, SequenceBuilder);

      var _this = _possibleConstructorReturn(this, (SequenceBuilder.__proto__ || Object.getPrototypeOf(SequenceBuilder)).call(this, section));

      _this._editor = null;

      _this.MEDIA_BUILDER_TABS = ['size', 'appearance', 'manage'];
      return _this;
    }

    _createClass(SequenceBuilder, [{
      key: 'render',
      value: function render() {
        if (!this._section.background || !this._section.foreground || !this._section.foreground.blocks || !this._section.foreground.blocks.length) {
          this._section = {
            type: 'sequence',
            layout: 'sequence-1',
            background: {
              type: 'color',
              color: {
                value: '#FFF'
              }
            },
            foreground: {
              blocks: [{
                type: 'text',
                text: {
                  value: '<p class="block"></p>'
                }
              }]
            }
          };
        }

        return _get(SequenceBuilder.prototype.__proto__ || Object.getPrototypeOf(SequenceBuilder.prototype), 'render', this).call(this);
      }
    }, {
      key: 'postCreate',
      value: function postCreate(node) {
        _get(SequenceBuilder.prototype.__proto__ || Object.getPrototypeOf(SequenceBuilder.prototype), 'postCreate', this).call(this, node);

        this._editor = new _MediumEditorWrapper2.default({
          node: this._node.find('.foreground'),
          addMedia: this.addMedia.bind(this),
          addButtons: ['text', 'arcgis', 'media', 'title', 'immersive'],
          style: 'full',
          placeholder: node.index() != 1,
          disableEditing: node.index() == 1 && this._section.foreground.blocks && this._section.foreground.blocks.length == 1 && this._section.foreground.blocks[0].type == 'text' && this._section.foreground.blocks[0].text.value.match(/block-placeholder/),
          onChange: this._onContentChange.bind(this)
        });
      }
    }, {
      key: 'focus',
      value: function focus() {
        setTimeout(function () {
          this._editor.focus();
        }.bind(this), 50);
      }
    }, {
      key: 'addMedia',
      value: function addMedia() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.media) {
          return;
        }

        var block = _Common2.default.createBlock(params.media);

        this._blocks.splice(params.blockIndex, 0, block);

        // Load the block after the editor got a chance to add it
        // TODO!
        setTimeout(function () {
          block.postCreate({
            //container: params.previousNode.next()
            container: this._node,
            onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
            onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
            builderConfigurationTabs: this.MEDIA_BUILDER_TABS
          });
          block.load();

          //
          // Scroll the page if there isn't enough room for the media
          //
          var mediaBBOX = block.getNode()[0].getBoundingClientRect(),
              scrollOffset = 0;

          if (mediaBBOX.bottom > app.display.windowHeight) {
            scrollOffset = app.display.windowHeight - mediaBBOX.bottom;
          }

          if (scrollOffset) {
            var currentScroll = document.body.scrollTop || document.documentElement.scrollTop;

            $('html,body').animate({
              scrollTop: currentScroll - scrollOffset + 10
            }, 150);
          }

          this._onContentChange();
        }.bind(this), 50);

        return block.render({
          placement: 'block'
        });
      }
    }, {
      key: '_onContentChange',
      value: function _onContentChange() {
        this.serialize();
        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: '_onToggleMediaConfig',
      value: function _onToggleMediaConfig(media) {
        //
        // Scroll the page if there isn't enough room for the builder panel
        //
        var mediaNode = media.getNode()[0],
            mediaBBOX = mediaNode.getBoundingClientRect(),
            scrollOffset = 0;

        if (mediaBBOX.bottom > app.display.windowHeight) {
          scrollOffset = app.display.windowHeight - mediaBBOX.bottom;
        }

        if (scrollOffset) {
          var currentScroll = document.body.scrollTop || document.documentElement.scrollTop;

          $('html,body').animate({
            scrollTop: currentScroll - scrollOffset + 10
          }, 150);
        }
      }
    }, {
      key: '_onEditMedia',
      value: function _onEditMedia(media, newMediaJSON) {
        var newMedia = _Common2.default.initMedia(newMediaJSON);

        media.getNode().before(newMedia.render({
          placement: 'block'
        }));

        // Delete actual background
        media.getNode().remove();

        newMedia.postCreate({
          container: this._node,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS
        });

        // TODO: this may be an issue if picking a map/scene already present
        newMedia.load();

        this._blocks.splice(this._blocks.indexOf(media), 1, newMedia);

        this._onContentChange();
      }
    }, {
      key: '_onMediaConfigAction',
      value: function _onMediaConfigAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.action || !params.media) {
          return;
        }

        if (params.action == 'remove') {
          params.media.remove();
          this._blocks.splice(this._blocks.indexOf(params.media), 1);
        } else if (params.action == 'swap') {
          app.builder.mediaPicker.open({
            mode: 'edit',
            media: params.media.serialize()
          }).then(function (newMedia) {
            this._onEditMedia(params.media, newMedia);
          }.bind(this), function () {
            //
          });
        } else if (params.action == 'image-to-image-gallery') {
          app.builder.mediaPicker.open({
            mode: 'add',
            authorizedMedia: ['image']
          }).then(function (newMedia) {
            if (newMedia.type != 'image') {
              return;
            }

            var firstImage = params.media.serialize();
            this._onEditMedia(params.media, {
              type: 'image-gallery',
              'image-gallery': {
                images: [{
                  url: firstImage.image.url,
                  width: firstImage.image.width,
                  height: firstImage.image.height
                }, newMedia.image],
                caption: firstImage.image.caption
              }
            });
          }.bind(this), function () {
            //
          });
        } else if (params.action == 'image-gallery-to-image') {
          var firstImage = params.media.serialize()['image-gallery'].images[0];

          this._onEditMedia(params.media, {
            type: 'image',
            'image': {
              url: firstImage.url,
              width: firstImage.width,
              height: firstImage.height,
              caption: firstImage.caption
            }
          });
        }

        this._onContentChange();
      }
    }, {
      key: 'getPreviewThumbnail',
      value: function getPreviewThumbnail() {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._blocks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var block = _step.value;

            if (block.type != 'text') {
              return block.getPreviewThumbnail();
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return null;
      }
    }, {
      key: 'getPreviewIcon',
      value: function getPreviewIcon() {
        return '';
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        var text = '';

        if (this._section.foreground.blocks && this._section.foreground.blocks.length) {
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = this._section.foreground.blocks[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var block = _step2.value;

              if (block.type == 'text') {
                text = $(block.text.value).text();
                if (text) {
                  break;
                }
              }
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2.return) {
                _iterator2.return();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        }

        return text;
      }
    }, {
      key: 'findBlock',
      value: function findBlock(id) {
        if (!id) {
          return null;
        }

        for (var i = 0; i < this._blocks.length; i++) {
          if (this._blocks[i]._domID == id) {
            return this._blocks[i];
          }
        }
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        if (this._editor) {
          var blocks = this._editor.serialize();

          for (var i = 0; i < blocks.length; i++) {
            var editorBlock = blocks[i];

            if (editorBlock.type == 'media') {
              var block = this.findBlock(editorBlock.id);
              if (block) {
                blocks[i] = block.serialize();
              }
            }
          }

          this._section.foreground.blocks = blocks;
        }

        //
        // All serialize methods for medias and section deep clone the object
        //  Object.assign is not perforning deep cloning of properties
        // This is to avoid issues with a duplicated Sequential section where
        //  edits in one would be performed on both!
        // As the serialize method are called quite a bit in builder, it may
        //  be worthwile to optimize
        // TODO: optimize
        return _lang2.default.clone(this._section);
      }
    }, {
      key: 'requireSplitAt',
      value: function requireSplitAt(startBlock) {
        return startBlock < this.serialize().foreground.blocks.length - 1;
      }
    }, {
      key: 'serializePartially',
      value: function serializePartially(startBlock, endBlock) {
        var json = this.serialize();

        if (endBlock === undefined) {
          endBlock = json.foreground.blocks.length;
        }

        json.foreground.blocks = json.foreground.blocks.slice(startBlock, endBlock);

        return json;
      }
    }, {
      key: 'mergeAndSerialize',
      value: function mergeAndSerialize(followingSection) {
        var json1 = this.serialize();
        var json2 = followingSection.serialize();

        json1.foreground.blocks = json1.foreground.blocks.concat(json2.foreground.blocks);

        return json1;
      }
    }, {
      key: 'setBookmark',
      value: function setBookmark(bookmark) {
        this._section.bookmark = {
          enabled: bookmark.status == 'visible',
          title: bookmark.bookmark
        };
      }
    }]);

    return SequenceBuilder;
  }(_Sequence3.default);

  exports.default = SequenceBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=SequenceBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/builder/AddMenu', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, buffer = "<div class=\"add-menu\">\r\n  <ul>\r\n    ";
  stack1 = ((helper = (helper = helpers.buttons || (depth0 != null ? depth0.buttons : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"buttons","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n  </ul>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/builder/AddMenu',[],function(){});
define('storymaps-react/tpl/view/section/builder/AddMenu',['module', 'exports', 'lib-build/hbars!./AddMenu', 'lib-build/less!./AddMenu'], function (module, exports, _AddMenu) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _AddMenu2 = _interopRequireDefault(_AddMenu);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var BUTTONS = {
    sequence: {
      name: 'sequence',
      icon: 'resources/tpl/builder/icons/text-editor/Text.png',
      label: 'Sequential'
    },
    title: {
      name: 'title',
      icon: 'resources/tpl/builder/icons/text-editor/Title.png',
      label: 'Title'
    },
    immersive: {
      name: 'immersive',
      icon: 'resources/tpl/builder/icons/text-editor/Immersive.gif',
      //iconHover: 'resources/tpl/builder/icons/text-editor/Immersive-hover.gif',
      label: 'Immersive'
    }
  };

  var AddMenu = function () {
    function AddMenu() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, AddMenu);

      this._container = null;
      this._sectionContainer = null;

      this._buttons = [];

      if (params.buttons && params.buttons.length) {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = params.buttons[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var button = _step.value;

            this._buttons.push(BUTTONS[button]);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }

    _createClass(AddMenu, [{
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        this._container = params.container;
        this._sectionContainer = params.sectionContainer;

        this._container.html(this._render()).mouseleave(this._onMenuMouseleave.bind(this)).find('.add-button').click(this._onButtonClick.bind(this));

        this._sectionContainer.click(this._onSectionClick.bind(this)).mousemove(this._onSectionMouseMove.bind(this)).mouseleave(this._onSectionMouseleave.bind(this));
      }
    }, {
      key: '_render',
      value: function _render() {
        var buttonsHTML = '';

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._buttons[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var button = _step2.value;

            var name = button.name;
            var icon = button.icon || '';
            var iconHover = button.iconHover || '';
            var iconNode = '<img class="add-button-icon" src="' + icon + '" />';

            buttonsHTML += '<li><a class="add-button" data-button="' + name + '" data-icon="' + icon + '" data-icon-hover="' + iconHover + '">' + iconNode + ' ' + button.label + '</a></li>';
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        return (0, _AddMenu2.default)({
          buttons: buttonsHTML
        });
      }
    }, {
      key: 'show',
      value: function show() {
        this._container.addClass('active');
      }
    }, {
      key: '_onSectionClick',
      value: function _onSectionClick(e) {
        var targetPosition = e.currentTarget.getBoundingClientRect();

        if (e.clientY - 15 < targetPosition.top) {
          var cssDisplay = window.getComputedStyle(this._container.parent('.section')[0], ':before').getPropertyValue('display');

          if (cssDisplay == 'block') {
            this.show();
          }
        }
      }
    }, {
      key: '_onSectionMouseMove',
      value: function _onSectionMouseMove(e) {
        var targetPosition = e.currentTarget.getBoundingClientRect();
        var isOnAddInvite = e.clientY - 15 < targetPosition.top;

        this._sectionContainer.toggleClass('show-add-section-menu', isOnAddInvite)
        // For Safari, also an issue on IE but doesn't help
        .css('cursor', isOnAddInvite ? 'hand' : 'default');
      }
    }, {
      key: '_onSectionMouseleave',
      value: function _onSectionMouseleave() {
        this._sectionContainer.toggleClass('show-add-section-menu', false).css('cursor', 'default');

        this._container.removeClass('active');
      }
    }, {
      key: '_onMenuMouseleave',
      value: function _onMenuMouseleave() {
        this._onSectionMouseleave();
      }
    }, {
      key: '_onButtonClick',
      value: function _onButtonClick(e) {
        var target = $(e.currentTarget);

        var newSectionIndex = this._sectionContainer.index() - 1;

        // If the section is credits, need to skip credits placeholder
        if (this._sectionContainer.hasClass('section-layout-credits')) {
          newSectionIndex--;
        }

        var type = target.data('button');

        app.Controller.addSection({
          type: type,
          index: newSectionIndex,
          navigation: type != 'title',
          animateSpeed: 800
        });
      }
    }]);

    return AddMenu;
  }();

  exports.default = AddMenu;
  module.exports = exports['default'];
});
//# sourceMappingURL=AddMenu.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/TitleBuilder',[],function(){});
define('storymaps-react/tpl/view/section/TitleBuilder',['module', 'exports', './Title', 'storymaps/tpl/view/section/Common', './builder/AddMenu', 'dojo/topic', 'dojo/_base/lang', 'lib-build/less!./TitleBuilder'], function (module, exports, _Title2, _Common, _AddMenu, _topic, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Title3 = _interopRequireDefault(_Title2);

  var _Common2 = _interopRequireDefault(_Common);

  var _AddMenu2 = _interopRequireDefault(_AddMenu);

  var _topic2 = _interopRequireDefault(_topic);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var TitleBuilder = function (_Title) {
    _inherits(TitleBuilder, _Title);

    function TitleBuilder(section, media) {
      _classCallCheck(this, TitleBuilder);

      var _this = _possibleConstructorReturn(this, (TitleBuilder.__proto__ || Object.getPrototypeOf(TitleBuilder)).call(this, section));

      _this._initialMedia = media;
      _this._addMenu = new _AddMenu2.default({
        buttons: ['sequence', 'title', 'immersive']
      });

      _this.MEDIA_BUILDER_TABS_BACKGROUND = ['media-appearance', 'background', 'manage'];
      return _this;
    }

    _createClass(TitleBuilder, [{
      key: 'render',
      value: function render() {
        if (!this._section.layout) {
          this._section.layout = 'title-regular';
        }

        // Creating a new section
        if (!this._section.background) {
          this._section.background = this._initialMedia || { type: 'empty', empty: 'empty' };
          this._section.foreground = { title: '', credits: '', options: {} };
        }

        if (!this._section.foreground.options) {
          this._section.foreground.options = {};
        }

        return _get(TitleBuilder.prototype.__proto__ || Object.getPrototypeOf(TitleBuilder.prototype), 'render', this).call(this);
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(TitleBuilder.prototype.__proto__ || Object.getPrototypeOf(TitleBuilder.prototype), 'postCreate', this).call(this, params);

        this._addMenu.postCreate({
          container: this._node.find('.builder-section-add-menu'),
          sectionContainer: this._node
        });

        this._node.find('.fg-title').attr('contenteditable', true).attr('placeholder', 'Enter a title...').on('blur keyup', function () {
          this.serialize();
          this._onContentChange();
        }.bind(this)).on('paste', function () {
          setTimeout(function () {
            this._node.find('.fg-title').html($('<div>' + this._node.find('.fg-title').text() + '</div>').text());
            this.serialize();
            this._onContentChange();
          }.bind(this), 0);
        }.bind(this)).keydown(function (e) {
          // Do not allow enter key
          if (e.keyCode === 13) {
            // If pressing enter insert <br> instead of default behavior that is div
            //document.execCommand('insertHTML', false, '<br><br>');
            return false;
          }

          // Prevent ctrl + B/I/U or ctrl + b/i/u
          if (e.ctrlKey || e.metaKey) {
            var key = e.keyCode;
            if (key == 66 || key == 98 || key == 73 || key == 105 || key == 85 || key == 117) {
              return false;
            }
          }
        });
      }
    }, {
      key: 'focus',
      value: function focus() {
        setTimeout(function () {
          this._node.find('.fg-title').focus();
        }.bind(this), 50);
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        this._section.background = this._backgroundMedia.serialize();
        this._section.foreground.title = $('<div>' + this._node.find('.fg-title').text() + '</div>').text();

        return _lang2.default.clone(this._section);
      }
    }, {
      key: 'setBookmark',
      value: function setBookmark(bookmark) {
        this._section.bookmark = {
          enabled: bookmark.status == 'visible',
          title: bookmark.bookmark
        };
      }
    }, {
      key: '_onContentChange',
      value: function _onContentChange() {
        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: '_onToggleMediaConfig',
      value: function _onToggleMediaConfig() {
        this._node.toggleClass('hide-foreground');
      }
    }, {
      key: '_onMediaConfigAction',
      value: function _onMediaConfigAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.action || !params.media) {
          return;
        }

        if (params.action == 'swap') {
          var mediaIsEmpty = params.media.serialize().type == 'empty';

          app.builder.mediaPicker.open({
            mode: mediaIsEmpty ? 'add' : 'edit',
            media: mediaIsEmpty ? null : params.media.serialize(),
            authorizedMedia: ['image']
          }).then(function (newMedia) {
            this._onEditMedia(params.media, newMedia);
          }.bind(this), function () {
            //
          });
        }

        this._onContentChange();
      }
    }, {
      key: '_applySectionConfig',
      value: function _applySectionConfig() {
        this._applyConfig();
        this._onContentChange();
      }
    }, {
      key: '_onEditMedia',
      value: function _onEditMedia(media, newMediaJSON) {
        var newMedia = _Common2.default.initMedia(newMediaJSON);

        // Delete actual background
        this._node.find('.background').remove();

        // TODO: only if media not already rendered
        this._node.prepend(_Common2.default.renderBackground({
          media: newMedia
        }));

        newMedia.postCreate({
          container: this._node,
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          foregroundOptions: this._section.foreground.options,
          applySectionConfig: app.isInBuilder ? this._applySectionConfig.bind(this) : null,
          sectionType: 'title'
        });

        // TODO: this may be an issue if picking a map/scene already present
        newMedia.load();

        if (media.type != 'empty') {
          this._onToggleMediaConfig();
        }

        media.destroy();

        this._backgroundMedia = newMedia;
        this._applySectionConfig();
      }
    }]);

    return TitleBuilder;
  }(_Title3.default);

  exports.default = TitleBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=TitleBuilder.js.map
;
/**
 * React v15.1.0
 *
 * Copyright 2013-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define('react',[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.React=e()}}(function(){return function e(t,n,r){function o(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";var r=e(40),o=e(148),i={focusDOMComponent:function(){o(r.getNodeFromInstance(this))}};t.exports=i},{148:148,40:40}],2:[function(e,t,n){"use strict";function r(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}function o(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function i(e){switch(e){case S.topCompositionStart:return M.compositionStart;case S.topCompositionEnd:return M.compositionEnd;case S.topCompositionUpdate:return M.compositionUpdate}}function a(e,t){return e===S.topKeyDown&&t.keyCode===_}function u(e,t){switch(e){case S.topKeyUp:return-1!==b.indexOf(t.keyCode);case S.topKeyDown:return t.keyCode!==_;case S.topKeyPress:case S.topMouseDown:case S.topBlur:return!0;default:return!1}}function s(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function l(e,t,n,r){var o,l;if(E?o=i(e):R?u(e,n)&&(o=M.compositionEnd):a(e,n)&&(o=M.compositionStart),!o)return null;T&&(R||o!==M.compositionStart?o===M.compositionEnd&&R&&(l=R.getData()):R=m.getPooled(r));var c=g.getPooled(o,t,n,r);if(l)c.data=l;else{var p=s(n);null!==p&&(c.data=p)}return h.accumulateTwoPhaseDispatches(c),c}function c(e,t){switch(e){case S.topCompositionEnd:return s(t);case S.topKeyPress:var n=t.which;return n!==P?null:(k=!0,w);case S.topTextInput:var r=t.data;return r===w&&k?null:r;default:return null}}function p(e,t){if(R){if(e===S.topCompositionEnd||u(e,t)){var n=R.getData();return m.release(R),R=null,n}return null}switch(e){case S.topPaste:return null;case S.topKeyPress:return t.which&&!o(t)?String.fromCharCode(t.which):null;case S.topCompositionEnd:return T?null:t.data;default:return null}}function d(e,t,n,r){var o;if(o=N?c(e,n):p(e,n),!o)return null;var i=y.getPooled(M.beforeInput,t,n,r);return i.data=o,h.accumulateTwoPhaseDispatches(i),i}var f=e(16),h=e(20),v=e(140),m=e(21),g=e(97),y=e(101),C=e(158),b=[9,13,27,32],_=229,E=v.canUseDOM&&"CompositionEvent"in window,x=null;v.canUseDOM&&"documentMode"in document&&(x=document.documentMode);var N=v.canUseDOM&&"TextEvent"in window&&!x&&!r(),T=v.canUseDOM&&(!E||x&&x>8&&11>=x),P=32,w=String.fromCharCode(P),S=f.topLevelTypes,M={beforeInput:{phasedRegistrationNames:{bubbled:C({onBeforeInput:null}),captured:C({onBeforeInputCapture:null})},dependencies:[S.topCompositionEnd,S.topKeyPress,S.topTextInput,S.topPaste]},compositionEnd:{phasedRegistrationNames:{bubbled:C({onCompositionEnd:null}),captured:C({onCompositionEndCapture:null})},dependencies:[S.topBlur,S.topCompositionEnd,S.topKeyDown,S.topKeyPress,S.topKeyUp,S.topMouseDown]},compositionStart:{phasedRegistrationNames:{bubbled:C({onCompositionStart:null}),captured:C({onCompositionStartCapture:null})},dependencies:[S.topBlur,S.topCompositionStart,S.topKeyDown,S.topKeyPress,S.topKeyUp,S.topMouseDown]},compositionUpdate:{phasedRegistrationNames:{bubbled:C({onCompositionUpdate:null}),captured:C({onCompositionUpdateCapture:null})},dependencies:[S.topBlur,S.topCompositionUpdate,S.topKeyDown,S.topKeyPress,S.topKeyUp,S.topMouseDown]}},k=!1,R=null,D={eventTypes:M,extractEvents:function(e,t,n,r){return[l(e,t,n,r),d(e,t,n,r)]}};t.exports=D},{101:101,140:140,158:158,16:16,20:20,21:21,97:97}],3:[function(e,t,n){"use strict";function r(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var o={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(o).forEach(function(e){i.forEach(function(t){o[r(t,e)]=o[e]})});var a={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},u={isUnitlessNumber:o,shorthandPropertyExpansions:a};t.exports=u},{}],4:[function(e,t,n){"use strict";var r=e(3),o=e(140),i=(e(70),e(142),e(114)),a=e(153),u=e(160),s=(e(164),u(function(e){return a(e)})),l=!1,c="cssFloat";if(o.canUseDOM){var p=document.createElement("div").style;try{p.font=""}catch(d){l=!0}void 0===document.documentElement.style.cssFloat&&(c="styleFloat")}var f={createMarkupForStyles:function(e,t){var n="";for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];null!=o&&(n+=s(r)+":",n+=i(r,o,t)+";")}return n||null},setValueForStyles:function(e,t,n){var o=e.style;for(var a in t)if(t.hasOwnProperty(a)){var u=i(a,t[a],n);if("float"!==a&&"cssFloat"!==a||(a=c),u)o[a]=u;else{var s=l&&r.shorthandPropertyExpansions[a];if(s)for(var p in s)o[p]="";else o[a]=""}}}};t.exports=f},{114:114,140:140,142:142,153:153,160:160,164:164,3:3,70:70}],5:[function(e,t,n){"use strict";function r(){this._callbacks=null,this._contexts=null}var o=e(165),i=e(25),a=e(154);o(r.prototype,{enqueue:function(e,t){this._callbacks=this._callbacks||[],this._contexts=this._contexts||[],this._callbacks.push(e),this._contexts.push(t)},notifyAll:function(){var e=this._callbacks,t=this._contexts;if(e){e.length!==t.length?a(!1):void 0,this._callbacks=null,this._contexts=null;for(var n=0;n<e.length;n++)e[n].call(t[n]);e.length=0,t.length=0}},checkpoint:function(){return this._callbacks?this._callbacks.length:0},rollback:function(e){this._callbacks&&(this._callbacks.length=e,this._contexts.length=e)},reset:function(){this._callbacks=null,this._contexts=null},destructor:function(){this.reset()}}),i.addPoolingTo(r),t.exports=r},{154:154,165:165,25:25}],6:[function(e,t,n){"use strict";function r(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function o(e){var t=N.getPooled(k.change,D,e,T(e));b.accumulateTwoPhaseDispatches(t),x.batchedUpdates(i,t)}function i(e){C.enqueueEvents(e),C.processEventQueue(!1)}function a(e,t){R=e,D=t,R.attachEvent("onchange",o)}function u(){R&&(R.detachEvent("onchange",o),R=null,D=null)}function s(e,t){return e===M.topChange?t:void 0}function l(e,t,n){e===M.topFocus?(u(),a(t,n)):e===M.topBlur&&u()}function c(e,t){R=e,D=t,I=e.value,O=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(R,"value",U),R.attachEvent?R.attachEvent("onpropertychange",d):R.addEventListener("propertychange",d,!1)}function p(){R&&(delete R.value,R.detachEvent?R.detachEvent("onpropertychange",d):R.removeEventListener("propertychange",d,!1),R=null,D=null,I=null,O=null)}function d(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==I&&(I=t,o(e))}}function f(e,t){return e===M.topInput?t:void 0}function h(e,t,n){e===M.topFocus?(p(),c(t,n)):e===M.topBlur&&p()}function v(e,t){return e!==M.topSelectionChange&&e!==M.topKeyUp&&e!==M.topKeyDown||!R||R.value===I?void 0:(I=R.value,D)}function m(e){return e.nodeName&&"input"===e.nodeName.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function g(e,t){return e===M.topClick?t:void 0}var y=e(16),C=e(17),b=e(20),_=e(140),E=e(40),x=e(90),N=e(99),T=e(122),P=e(129),w=e(130),S=e(158),M=y.topLevelTypes,k={change:{phasedRegistrationNames:{bubbled:S({onChange:null}),captured:S({onChangeCapture:null})},dependencies:[M.topBlur,M.topChange,M.topClick,M.topFocus,M.topInput,M.topKeyDown,M.topKeyUp,M.topSelectionChange]}},R=null,D=null,I=null,O=null,A=!1;_.canUseDOM&&(A=P("change")&&(!("documentMode"in document)||document.documentMode>8));var L=!1;_.canUseDOM&&(L=P("input")&&(!("documentMode"in document)||document.documentMode>11));var U={get:function(){return O.get.call(this)},set:function(e){I=""+e,O.set.call(this,e)}},F={eventTypes:k,extractEvents:function(e,t,n,o){var i,a,u=t?E.getNodeFromInstance(t):window;if(r(u)?A?i=s:a=l:w(u)?L?i=f:(i=v,a=h):m(u)&&(i=g),i){var c=i(e,t);if(c){var p=N.getPooled(k.change,c,n,o);return p.type="change",b.accumulateTwoPhaseDispatches(p),p}}a&&a(e,u,t)}};t.exports=F},{122:122,129:129,130:130,140:140,158:158,16:16,17:17,20:20,40:40,90:90,99:99}],7:[function(e,t,n){"use strict";function r(e,t){return Array.isArray(t)&&(t=t[1]),t?t.nextSibling:e.firstChild}function o(e,t,n){c.insertTreeBefore(e,t,n)}function i(e,t,n){Array.isArray(t)?u(e,t[0],t[1],n):m(e,t,n)}function a(e,t){if(Array.isArray(t)){var n=t[1];t=t[0],s(e,t,n),e.removeChild(n)}e.removeChild(t)}function u(e,t,n,r){for(var o=t;;){var i=o.nextSibling;if(m(e,o,r),o===n)break;o=i}}function s(e,t,n){for(;;){var r=t.nextSibling;if(r===n)break;e.removeChild(r)}}function l(e,t,n){var r=e.parentNode,o=e.nextSibling;o===t?n&&m(r,document.createTextNode(n),o):n?(v(o,n),s(r,o,t)):s(r,e,t)}var c=e(8),p=e(12),d=e(74),f=(e(40),e(70),e(113)),h=e(134),v=e(135),m=f(function(e,t,n){e.insertBefore(t,n)}),g=p.dangerouslyReplaceNodeWithMarkup,y={dangerouslyReplaceNodeWithMarkup:g,replaceDelimitedText:l,processUpdates:function(e,t){for(var n=0;n<t.length;n++){var u=t[n];switch(u.type){case d.INSERT_MARKUP:o(e,u.content,r(e,u.afterNode));break;case d.MOVE_EXISTING:i(e,u.fromNode,r(e,u.afterNode));break;case d.SET_MARKUP:h(e,u.content);break;case d.TEXT_CONTENT:v(e,u.content);break;case d.REMOVE_NODE:a(e,u.fromNode)}}}};t.exports=y},{113:113,12:12,134:134,135:135,40:40,70:70,74:74,8:8}],8:[function(e,t,n){"use strict";function r(e){if(v){var t=e.node,n=e.children;if(n.length)for(var r=0;r<n.length;r++)m(t,n[r],null);else null!=e.html?t.innerHTML=e.html:null!=e.text&&d(t,e.text)}}function o(e,t){e.parentNode.replaceChild(t.node,e),r(t)}function i(e,t){v?e.children.push(t):e.node.appendChild(t.node)}function a(e,t){v?e.html=t:e.node.innerHTML=t}function u(e,t){v?e.text=t:d(e.node,t)}function s(){return this.node.nodeName}function l(e){return{node:e,children:[],html:null,text:null,toString:s}}var c=e(9),p=e(113),d=e(135),f=1,h=11,v="undefined"!=typeof document&&"number"==typeof document.documentMode||"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent&&/\bEdge\/\d/.test(navigator.userAgent),m=p(function(e,t,n){t.node.nodeType===h||t.node.nodeType===f&&"object"===t.node.nodeName.toLowerCase()&&(null==t.node.namespaceURI||t.node.namespaceURI===c.html)?(r(t),e.insertBefore(t.node,n)):(e.insertBefore(t.node,n),r(t))});l.insertTreeBefore=m,l.replaceChildWithTree=o,l.queueChild=i,l.queueHTML=a,l.queueText=u,t.exports=l},{113:113,135:135,9:9}],9:[function(e,t,n){"use strict";var r={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};t.exports=r},{}],10:[function(e,t,n){"use strict";function r(e,t){return(e&t)===t}var o=e(154),i={MUST_USE_PROPERTY:1,HAS_SIDE_EFFECTS:2,HAS_BOOLEAN_VALUE:4,HAS_NUMERIC_VALUE:8,HAS_POSITIVE_NUMERIC_VALUE:24,HAS_OVERLOADED_BOOLEAN_VALUE:32,injectDOMPropertyConfig:function(e){var t=i,n=e.Properties||{},a=e.DOMAttributeNamespaces||{},s=e.DOMAttributeNames||{},l=e.DOMPropertyNames||{},c=e.DOMMutationMethods||{};e.isCustomAttribute&&u._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var p in n){u.properties.hasOwnProperty(p)?o(!1):void 0;var d=p.toLowerCase(),f=n[p],h={attributeName:d,attributeNamespace:null,propertyName:p,mutationMethod:null,mustUseProperty:r(f,t.MUST_USE_PROPERTY),hasSideEffects:r(f,t.HAS_SIDE_EFFECTS),hasBooleanValue:r(f,t.HAS_BOOLEAN_VALUE),hasNumericValue:r(f,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:r(f,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:r(f,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(!h.mustUseProperty&&h.hasSideEffects?o(!1):void 0,h.hasBooleanValue+h.hasNumericValue+h.hasOverloadedBooleanValue<=1?void 0:o(!1),s.hasOwnProperty(p)){var v=s[p];h.attributeName=v}a.hasOwnProperty(p)&&(h.attributeNamespace=a[p]),l.hasOwnProperty(p)&&(h.propertyName=l[p]),c.hasOwnProperty(p)&&(h.mutationMethod=c[p]),u.properties[p]=h}}},a=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",u={ID_ATTRIBUTE_NAME:"data-reactid",ROOT_ATTRIBUTE_NAME:"data-reactroot",ATTRIBUTE_NAME_START_CHAR:a,ATTRIBUTE_NAME_CHAR:a+"\\-.0-9\\uB7\\u0300-\\u036F\\u203F-\\u2040",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<u._isCustomAttributeFunctions.length;t++){var n=u._isCustomAttributeFunctions[t];if(n(e))return!0}return!1},injection:i};t.exports=u},{154:154}],11:[function(e,t,n){"use strict";function r(e){return l.hasOwnProperty(e)?!0:s.hasOwnProperty(e)?!1:u.test(e)?(l[e]=!0,!0):(s[e]=!0,!1)}function o(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&1>t||e.hasOverloadedBooleanValue&&t===!1}var i=e(10),a=(e(40),e(48),e(70),e(132)),u=(e(164),new RegExp("^["+i.ATTRIBUTE_NAME_START_CHAR+"]["+i.ATTRIBUTE_NAME_CHAR+"]*$")),s={},l={},c={createMarkupForID:function(e){return i.ID_ATTRIBUTE_NAME+"="+a(e)},setAttributeForID:function(e,t){e.setAttribute(i.ID_ATTRIBUTE_NAME,t)},createMarkupForRoot:function(){return i.ROOT_ATTRIBUTE_NAME+'=""'},setAttributeForRoot:function(e){e.setAttribute(i.ROOT_ATTRIBUTE_NAME,"")},createMarkupForProperty:function(e,t){var n=i.properties.hasOwnProperty(e)?i.properties[e]:null;if(n){if(o(n,t))return"";var r=n.attributeName;return n.hasBooleanValue||n.hasOverloadedBooleanValue&&t===!0?r+'=""':r+"="+a(t)}return i.isCustomAttribute(e)?null==t?"":e+"="+a(t):null},createMarkupForCustomAttribute:function(e,t){return r(e)&&null!=t?e+"="+a(t):""},setValueForProperty:function(e,t,n){var r=i.properties.hasOwnProperty(t)?i.properties[t]:null;if(r){var a=r.mutationMethod;if(a)a(e,n);else{if(o(r,n))return void this.deleteValueForProperty(e,t);if(r.mustUseProperty){var u=r.propertyName;r.hasSideEffects&&""+e[u]==""+n||(e[u]=n)}else{var s=r.attributeName,l=r.attributeNamespace;l?e.setAttributeNS(l,s,""+n):r.hasBooleanValue||r.hasOverloadedBooleanValue&&n===!0?e.setAttribute(s,""):e.setAttribute(s,""+n)}}}else if(i.isCustomAttribute(t))return void c.setValueForAttribute(e,t,n)},setValueForAttribute:function(e,t,n){r(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForProperty:function(e,t){var n=i.properties.hasOwnProperty(t)?i.properties[t]:null;if(n){var r=n.mutationMethod;if(r)r(e,void 0);else if(n.mustUseProperty){var o=n.propertyName;n.hasBooleanValue?e[o]=!1:n.hasSideEffects&&""+e[o]==""||(e[o]="")}else e.removeAttribute(n.attributeName)}else i.isCustomAttribute(t)&&e.removeAttribute(t)}};t.exports=c},{10:10,132:132,164:164,40:40,48:48,70:70}],12:[function(e,t,n){"use strict";function r(e){return e.substring(1,e.indexOf(" "))}var o=e(8),i=e(140),a=e(145),u=e(146),s=e(150),l=e(154),c=/^(<[^ \/>]+)/,p="data-danger-index",d={dangerouslyRenderMarkup:function(e){i.canUseDOM?void 0:l(!1);for(var t,n={},o=0;o<e.length;o++)e[o]?void 0:l(!1),t=r(e[o]),t=s(t)?t:"*",n[t]=n[t]||[],n[t][o]=e[o];var d=[],f=0;for(t in n)if(n.hasOwnProperty(t)){var h,v=n[t];for(h in v)if(v.hasOwnProperty(h)){var m=v[h];v[h]=m.replace(c,"$1 "+p+'="'+h+'" ')}for(var g=a(v.join(""),u),y=0;y<g.length;++y){var C=g[y];C.hasAttribute&&C.hasAttribute(p)&&(h=+C.getAttribute(p),C.removeAttribute(p),d.hasOwnProperty(h)?l(!1):void 0,d[h]=C,f+=1)}}return f!==d.length?l(!1):void 0,d.length!==e.length?l(!1):void 0,d},dangerouslyReplaceNodeWithMarkup:function(e,t){if(i.canUseDOM?void 0:l(!1),t?void 0:l(!1),"HTML"===e.nodeName?l(!1):void 0,"string"==typeof t){var n=a(t,u)[0];e.parentNode.replaceChild(n,e)}else o.replaceChildWithTree(e,t)}};t.exports=d},{140:140,145:145,146:146,150:150,154:154,8:8}],13:[function(e,t,n){"use strict";var r=e(158),o=[r({ResponderEventPlugin:null}),r({SimpleEventPlugin:null}),r({TapEventPlugin:null}),r({EnterLeaveEventPlugin:null}),r({ChangeEventPlugin:null}),r({SelectEventPlugin:null}),r({BeforeInputEventPlugin:null})];t.exports=o},{158:158}],14:[function(e,t,n){"use strict";var r={onClick:!0,onDoubleClick:!0,onMouseDown:!0,onMouseMove:!0,onMouseUp:!0,onClickCapture:!0,onDoubleClickCapture:!0,onMouseDownCapture:!0,onMouseMoveCapture:!0,onMouseUpCapture:!0},o={getNativeProps:function(e,t){if(!t.disabled)return t;var n={};for(var o in t)!r[o]&&t.hasOwnProperty(o)&&(n[o]=t[o]);return n}};t.exports=o},{}],15:[function(e,t,n){"use strict";var r=e(16),o=e(20),i=e(40),a=e(103),u=e(158),s=r.topLevelTypes,l={mouseEnter:{registrationName:u({onMouseEnter:null}),dependencies:[s.topMouseOut,s.topMouseOver]},mouseLeave:{registrationName:u({onMouseLeave:null}),dependencies:[s.topMouseOut,s.topMouseOver]}},c={eventTypes:l,extractEvents:function(e,t,n,r){if(e===s.topMouseOver&&(n.relatedTarget||n.fromElement))return null;if(e!==s.topMouseOut&&e!==s.topMouseOver)return null;var u;if(r.window===r)u=r;else{var c=r.ownerDocument;u=c?c.defaultView||c.parentWindow:window}var p,d;if(e===s.topMouseOut){p=t;var f=n.relatedTarget||n.toElement;d=f?i.getClosestInstanceFromNode(f):null}else p=null,d=t;if(p===d)return null;var h=null==p?u:i.getNodeFromInstance(p),v=null==d?u:i.getNodeFromInstance(d),m=a.getPooled(l.mouseLeave,p,n,r);m.type="mouseleave",m.target=h,m.relatedTarget=v;var g=a.getPooled(l.mouseEnter,d,n,r);return g.type="mouseenter",g.target=v,g.relatedTarget=h,o.accumulateEnterLeaveDispatches(m,g,p,d),[m,g]}};t.exports=c},{103:103,158:158,16:16,20:20,40:40}],16:[function(e,t,n){"use strict";var r=e(157),o=r({bubbled:null,captured:null}),i=r({topAbort:null,topAnimationEnd:null,topAnimationIteration:null,topAnimationStart:null,topBlur:null,topCanPlay:null,topCanPlayThrough:null,topChange:null,topClick:null,topCompositionEnd:null,topCompositionStart:null,topCompositionUpdate:null,topContextMenu:null,topCopy:null,topCut:null,topDoubleClick:null,topDrag:null,topDragEnd:null,topDragEnter:null,topDragExit:null,topDragLeave:null,topDragOver:null,topDragStart:null,topDrop:null,topDurationChange:null,topEmptied:null,topEncrypted:null,topEnded:null,topError:null,topFocus:null,topInput:null,topInvalid:null,topKeyDown:null,topKeyPress:null,topKeyUp:null,topLoad:null,topLoadedData:null,topLoadedMetadata:null,topLoadStart:null,topMouseDown:null,topMouseMove:null,topMouseOut:null,topMouseOver:null,topMouseUp:null,topPaste:null,topPause:null,topPlay:null,topPlaying:null,topProgress:null,topRateChange:null,topReset:null,topScroll:null,topSeeked:null,topSeeking:null,topSelectionChange:null,topStalled:null,topSubmit:null,topSuspend:null,topTextInput:null,topTimeUpdate:null,topTouchCancel:null,topTouchEnd:null,topTouchMove:null,topTouchStart:null,topTransitionEnd:null,topVolumeChange:null,topWaiting:null,topWheel:null}),a={topLevelTypes:i,PropagationPhases:o};t.exports=a},{157:157}],17:[function(e,t,n){"use strict";var r=e(18),o=e(19),i=e(63),a=e(110),u=e(118),s=e(154),l={},c=null,p=function(e,t){e&&(o.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},d=function(e){return p(e,!0)},f=function(e){return p(e,!1)},h={injection:{injectEventPluginOrder:r.injectEventPluginOrder,injectEventPluginsByName:r.injectEventPluginsByName},putListener:function(e,t,n){"function"!=typeof n?s(!1):void 0;var o=l[t]||(l[t]={});o[e._rootNodeID]=n;var i=r.registrationNameModules[t];i&&i.didPutListener&&i.didPutListener(e,t,n)},getListener:function(e,t){var n=l[t];return n&&n[e._rootNodeID]},deleteListener:function(e,t){var n=r.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t);var o=l[t];o&&delete o[e._rootNodeID]},deleteAllListeners:function(e){for(var t in l)if(l[t][e._rootNodeID]){var n=r.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t),delete l[t][e._rootNodeID]}},extractEvents:function(e,t,n,o){for(var i,u=r.plugins,s=0;s<u.length;s++){var l=u[s];if(l){var c=l.extractEvents(e,t,n,o);c&&(i=a(i,c))}}return i},enqueueEvents:function(e){e&&(c=a(c,e))},processEventQueue:function(e){var t=c;c=null,e?u(t,d):u(t,f),c?s(!1):void 0,i.rethrowCaughtError()},__purge:function(){l={}},__getListenerBank:function(){return l}};t.exports=h},{110:110,118:118,154:154,18:18,19:19,63:63}],18:[function(e,t,n){"use strict";function r(){if(u)for(var e in s){var t=s[e],n=u.indexOf(e);if(n>-1?void 0:a(!1),!l.plugins[n]){t.extractEvents?void 0:a(!1),l.plugins[n]=t;var r=t.eventTypes;for(var i in r)o(r[i],t,i)?void 0:a(!1)}}}function o(e,t,n){l.eventNameDispatchConfigs.hasOwnProperty(n)?a(!1):void 0,l.eventNameDispatchConfigs[n]=e;var r=e.phasedRegistrationNames;if(r){for(var o in r)if(r.hasOwnProperty(o)){var u=r[o];i(u,t,n)}return!0}return e.registrationName?(i(e.registrationName,t,n),!0):!1}function i(e,t,n){l.registrationNameModules[e]?a(!1):void 0,l.registrationNameModules[e]=t,l.registrationNameDependencies[e]=t.eventTypes[n].dependencies}var a=e(154),u=null,s={},l={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},possibleRegistrationNames:null,injectEventPluginOrder:function(e){u?a(!1):void 0,u=Array.prototype.slice.call(e),r()},injectEventPluginsByName:function(e){var t=!1;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];s.hasOwnProperty(n)&&s[n]===o||(s[n]?a(!1):void 0,s[n]=o,t=!0)}t&&r()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return l.registrationNameModules[t.registrationName]||null;for(var n in t.phasedRegistrationNames)if(t.phasedRegistrationNames.hasOwnProperty(n)){var r=l.registrationNameModules[t.phasedRegistrationNames[n]];if(r)return r}return null},_resetEventPlugins:function(){u=null;for(var e in s)s.hasOwnProperty(e)&&delete s[e];l.plugins.length=0;var t=l.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var r=l.registrationNameModules;for(var o in r)r.hasOwnProperty(o)&&delete r[o]}};t.exports=l},{154:154}],19:[function(e,t,n){"use strict";function r(e){return e===y.topMouseUp||e===y.topTouchEnd||e===y.topTouchCancel}function o(e){return e===y.topMouseMove||e===y.topTouchMove}function i(e){return e===y.topMouseDown||e===y.topTouchStart}function a(e,t,n,r){var o=e.type||"unknown-event";e.currentTarget=C.getNodeFromInstance(r),t?v.invokeGuardedCallbackWithCatch(o,n,e):v.invokeGuardedCallback(o,n,e),e.currentTarget=null}function u(e,t){var n=e._dispatchListeners,r=e._dispatchInstances;if(Array.isArray(n))for(var o=0;o<n.length&&!e.isPropagationStopped();o++)a(e,t,n[o],r[o]);else n&&a(e,t,n,r);e._dispatchListeners=null,e._dispatchInstances=null}function s(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t)){for(var r=0;r<t.length&&!e.isPropagationStopped();r++)if(t[r](e,n[r]))return n[r]}else if(t&&t(e,n))return n;return null}function l(e){var t=s(e);return e._dispatchInstances=null,e._dispatchListeners=null,t}function c(e){var t=e._dispatchListeners,n=e._dispatchInstances;Array.isArray(t)?m(!1):void 0,e.currentTarget=t?C.getNodeFromInstance(n):null;var r=t?t(e):null;return e.currentTarget=null,e._dispatchListeners=null,e._dispatchInstances=null,r}function p(e){return!!e._dispatchListeners}var d,f,h=e(16),v=e(63),m=e(154),g=(e(164),{injectComponentTree:function(e){d=e},injectTreeTraversal:function(e){f=e}}),y=h.topLevelTypes,C={isEndish:r,isMoveish:o,isStartish:i,executeDirectDispatch:c,executeDispatchesInOrder:u,executeDispatchesInOrderStopAtTrue:l,hasDispatches:p,getInstanceFromNode:function(e){return d.getInstanceFromNode(e)},getNodeFromInstance:function(e){return d.getNodeFromInstance(e)},isAncestor:function(e,t){return f.isAncestor(e,t)},getLowestCommonAncestor:function(e,t){return f.getLowestCommonAncestor(e,t)},getParentInstance:function(e){return f.getParentInstance(e)},traverseTwoPhase:function(e,t,n){return f.traverseTwoPhase(e,t,n)},traverseEnterLeave:function(e,t,n,r,o){return f.traverseEnterLeave(e,t,n,r,o)},injection:g};t.exports=C},{154:154,16:16,164:164,63:63}],20:[function(e,t,n){"use strict";function r(e,t,n){var r=t.dispatchConfig.phasedRegistrationNames[n];return C(e,r)}function o(e,t,n){var o=t?y.bubbled:y.captured,i=r(e,n,o);i&&(n._dispatchListeners=m(n._dispatchListeners,i),n._dispatchInstances=m(n._dispatchInstances,e))}function i(e){e&&e.dispatchConfig.phasedRegistrationNames&&v.traverseTwoPhase(e._targetInst,o,e)}function a(e){if(e&&e.dispatchConfig.phasedRegistrationNames){var t=e._targetInst,n=t?v.getParentInstance(t):null;v.traverseTwoPhase(n,o,e)}}function u(e,t,n){if(n&&n.dispatchConfig.registrationName){var r=n.dispatchConfig.registrationName,o=C(e,r);o&&(n._dispatchListeners=m(n._dispatchListeners,o),n._dispatchInstances=m(n._dispatchInstances,e))}}function s(e){e&&e.dispatchConfig.registrationName&&u(e._targetInst,null,e)}function l(e){g(e,i)}function c(e){g(e,a)}function p(e,t,n,r){v.traverseEnterLeave(n,r,u,e,t)}function d(e){g(e,s)}var f=e(16),h=e(17),v=e(19),m=e(110),g=e(118),y=(e(164),f.PropagationPhases),C=h.getListener,b={accumulateTwoPhaseDispatches:l,accumulateTwoPhaseDispatchesSkipTarget:c,accumulateDirectDispatches:d,accumulateEnterLeaveDispatches:p};t.exports=b},{110:110,118:118,16:16,164:164,17:17,19:19}],21:[function(e,t,n){"use strict";function r(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var o=e(165),i=e(25),a=e(126);o(r.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[a()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,r=n.length,o=this.getText(),i=o.length;for(e=0;r>e&&n[e]===o[e];e++);var a=r-e;for(t=1;a>=t&&n[r-t]===o[i-t];t++);var u=t>1?1-t:void 0;return this._fallbackText=o.slice(e,u),this._fallbackText}}),i.addPoolingTo(r),t.exports=r},{126:126,165:165,25:25}],22:[function(e,t,n){"use strict";var r=e(10),o=r.injection.MUST_USE_PROPERTY,i=r.injection.HAS_BOOLEAN_VALUE,a=r.injection.HAS_SIDE_EFFECTS,u=r.injection.HAS_NUMERIC_VALUE,s=r.injection.HAS_POSITIVE_NUMERIC_VALUE,l=r.injection.HAS_OVERLOADED_BOOLEAN_VALUE,c={isCustomAttribute:RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+r.ATTRIBUTE_NAME_CHAR+"]*$")),Properties:{accept:0,acceptCharset:0,accessKey:0,action:0,allowFullScreen:i,allowTransparency:0,alt:0,async:i,autoComplete:0,autoPlay:i,capture:i,cellPadding:0,cellSpacing:0,charSet:0,challenge:0,checked:o|i,cite:0,classID:0,className:0,cols:s,colSpan:0,content:0,contentEditable:0,contextMenu:0,controls:i,coords:0,crossOrigin:0,data:0,dateTime:0,"default":i,defer:i,dir:0,disabled:i,download:l,draggable:0,encType:0,form:0,formAction:0,formEncType:0,formMethod:0,formNoValidate:i,formTarget:0,frameBorder:0,headers:0,height:0,hidden:i,high:0,href:0,hrefLang:0,htmlFor:0,httpEquiv:0,icon:0,id:0,inputMode:0,integrity:0,is:0,keyParams:0,keyType:0,kind:0,label:0,lang:0,list:0,loop:i,low:0,manifest:0,marginHeight:0,marginWidth:0,max:0,maxLength:0,media:0,mediaGroup:0,method:0,min:0,minLength:0,multiple:o|i,muted:o|i,name:0,nonce:0,noValidate:i,open:i,optimum:0,pattern:0,placeholder:0,poster:0,preload:0,profile:0,radioGroup:0,readOnly:i,rel:0,required:i,reversed:i,role:0,rows:s,rowSpan:u,sandbox:0,scope:0,scoped:i,scrolling:0,seamless:i,selected:o|i,shape:0,size:s,sizes:0,span:s,spellCheck:0,src:0,srcDoc:0,srcLang:0,srcSet:0,start:u,step:0,style:0,summary:0,tabIndex:0,target:0,title:0,type:0,useMap:0,value:o|a,width:0,wmode:0,wrap:0,about:0,datatype:0,inlist:0,prefix:0,property:0,resource:0,"typeof":0,vocab:0,autoCapitalize:0,autoCorrect:0,autoSave:0,color:0,itemProp:0,itemScope:i,itemType:0,itemID:0,itemRef:0,results:0,security:0,unselectable:0},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{}};t.exports=c},{10:10}],23:[function(e,t,n){"use strict";function r(e){var t=/[=:]/g,n={"=":"=0",":":"=2"},r=(""+e).replace(t,function(e){return n[e]});return"$"+r}function o(e){var t=/(=0|=2)/g,n={"=0":"=","=2":":"},r="."===e[0]&&"$"===e[1]?e.substring(2):e.substring(1);return(""+r).replace(t,function(e){return n[e]})}var i={escape:r,unescape:o};t.exports=i},{}],24:[function(e,t,n){"use strict";function r(e){null!=e.checkedLink&&null!=e.valueLink?l(!1):void 0}function o(e){r(e),null!=e.value||null!=e.onChange?l(!1):void 0}function i(e){r(e),null!=e.checked||null!=e.onChange?l(!1):void 0}function a(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var u=e(81),s=e(80),l=e(154),c=(e(164),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),p={value:function(e,t,n){return!e[t]||c[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:u.func},d={},f={checkPropTypes:function(e,t,n){for(var r in p){if(p.hasOwnProperty(r))var o=p[r](t,r,e,s.prop);o instanceof Error&&!(o.message in d)&&(d[o.message]=!0,a(n))}},getValue:function(e){return e.valueLink?(o(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(i(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(o(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(i(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};t.exports=f},{154:154,164:164,80:80,81:81}],25:[function(e,t,n){"use strict";var r=e(154),o=function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)},i=function(e,t){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t),r}return new n(e,t)},a=function(e,t,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,e,t,n),o}return new r(e,t,n)},u=function(e,t,n,r){var o=this;if(o.instancePool.length){var i=o.instancePool.pop();return o.call(i,e,t,n,r),i}return new o(e,t,n,r)},s=function(e,t,n,r,o){var i=this;if(i.instancePool.length){var a=i.instancePool.pop();return i.call(a,e,t,n,r,o),a}return new i(e,t,n,r,o)},l=function(e){var t=this;e instanceof t?void 0:r(!1),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},c=10,p=o,d=function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||p,n.poolSize||(n.poolSize=c),n.release=l,n},f={addPoolingTo:d,oneArgumentPooler:o,twoArgumentPooler:i,threeArgumentPooler:a,fourArgumentPooler:u,fiveArgumentPooler:s};t.exports=f},{154:154}],26:[function(e,t,n){"use strict";var r=e(165),o=e(29),i=e(31),a=e(30),u=e(44),s=e(60),l=(e(61),e(81)),c=e(91),p=e(131),d=(e(164),s.createElement),f=s.createFactory,h=s.cloneElement,v=r,m={
Children:{map:o.map,forEach:o.forEach,count:o.count,toArray:o.toArray,only:p},Component:i,createElement:d,cloneElement:h,isValidElement:s.isValidElement,PropTypes:l,createClass:a.createClass,createFactory:f,createMixin:function(e){return e},DOM:u,version:c,__spread:v};t.exports=m},{131:131,164:164,165:165,29:29,30:30,31:31,44:44,60:60,61:61,81:81,91:91}],27:[function(e,t,n){"use strict";function r(e){return Object.prototype.hasOwnProperty.call(e,m)||(e[m]=h++,d[e[m]]={}),d[e[m]]}var o,i=e(165),a=e(16),u=e(18),s=e(64),l=e(109),c=e(127),p=e(129),d={},f=!1,h=0,v={topAbort:"abort",topAnimationEnd:c("animationend")||"animationend",topAnimationIteration:c("animationiteration")||"animationiteration",topAnimationStart:c("animationstart")||"animationstart",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topTransitionEnd:c("transitionend")||"transitionend",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},m="_reactListenersID"+String(Math.random()).slice(2),g=i({},s,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(g.handleTopLevel),g.ReactEventListener=e}},setEnabled:function(e){g.ReactEventListener&&g.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!g.ReactEventListener||!g.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,o=r(n),i=u.registrationNameDependencies[e],s=a.topLevelTypes,l=0;l<i.length;l++){var c=i[l];o.hasOwnProperty(c)&&o[c]||(c===s.topWheel?p("wheel")?g.ReactEventListener.trapBubbledEvent(s.topWheel,"wheel",n):p("mousewheel")?g.ReactEventListener.trapBubbledEvent(s.topWheel,"mousewheel",n):g.ReactEventListener.trapBubbledEvent(s.topWheel,"DOMMouseScroll",n):c===s.topScroll?p("scroll",!0)?g.ReactEventListener.trapCapturedEvent(s.topScroll,"scroll",n):g.ReactEventListener.trapBubbledEvent(s.topScroll,"scroll",g.ReactEventListener.WINDOW_HANDLE):c===s.topFocus||c===s.topBlur?(p("focus",!0)?(g.ReactEventListener.trapCapturedEvent(s.topFocus,"focus",n),g.ReactEventListener.trapCapturedEvent(s.topBlur,"blur",n)):p("focusin")&&(g.ReactEventListener.trapBubbledEvent(s.topFocus,"focusin",n),g.ReactEventListener.trapBubbledEvent(s.topBlur,"focusout",n)),o[s.topBlur]=!0,o[s.topFocus]=!0):v.hasOwnProperty(c)&&g.ReactEventListener.trapBubbledEvent(c,v[c],n),o[c]=!0)}},trapBubbledEvent:function(e,t,n){return g.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return g.ReactEventListener.trapCapturedEvent(e,t,n)},ensureScrollValueMonitoring:function(){if(void 0===o&&(o=document.createEvent&&"pageX"in document.createEvent("MouseEvent")),!o&&!f){var e=l.refreshScrollValues;g.ReactEventListener.monitorScrollValue(e),f=!0}}});t.exports=g},{109:109,127:127,129:129,16:16,165:165,18:18,64:64}],28:[function(e,t,n){"use strict";function r(e,t,n){var r=void 0===e[n];null!=t&&r&&(e[n]=i(t))}var o=e(83),i=e(128),a=(e(23),e(136)),u=e(137),s=(e(164),{instantiateChildren:function(e,t,n){if(null==e)return null;var o={};return u(e,r,o),o},updateChildren:function(e,t,n,r,u){if(t||e){var s,l;for(s in t)if(t.hasOwnProperty(s)){l=e&&e[s];var c=l&&l._currentElement,p=t[s];if(null!=l&&a(c,p))o.receiveComponent(l,p,r,u),t[s]=l;else{l&&(n[s]=o.getNativeNode(l),o.unmountComponent(l,!1));var d=i(p);t[s]=d}}for(s in e)!e.hasOwnProperty(s)||t&&t.hasOwnProperty(s)||(l=e[s],n[s]=o.getNativeNode(l),o.unmountComponent(l,!1))}},unmountChildren:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];o.unmountComponent(r,t)}}});t.exports=s},{128:128,136:136,137:137,164:164,23:23,83:83}],29:[function(e,t,n){"use strict";function r(e){return(""+e).replace(b,"$&/")}function o(e,t){this.func=e,this.context=t,this.count=0}function i(e,t,n){var r=e.func,o=e.context;r.call(o,t,e.count++)}function a(e,t,n){if(null==e)return e;var r=o.getPooled(t,n);g(e,i,r),o.release(r)}function u(e,t,n,r){this.result=e,this.keyPrefix=t,this.func=n,this.context=r,this.count=0}function s(e,t,n){var o=e.result,i=e.keyPrefix,a=e.func,u=e.context,s=a.call(u,t,e.count++);Array.isArray(s)?l(s,o,n,m.thatReturnsArgument):null!=s&&(v.isValidElement(s)&&(s=v.cloneAndReplaceKey(s,i+(!s.key||t&&t.key===s.key?"":r(s.key)+"/")+n)),o.push(s))}function l(e,t,n,o,i){var a="";null!=n&&(a=r(n)+"/");var l=u.getPooled(t,a,o,i);g(e,s,l),u.release(l)}function c(e,t,n){if(null==e)return e;var r=[];return l(e,r,null,t,n),r}function p(e,t,n){return null}function d(e,t){return g(e,p,null)}function f(e){var t=[];return l(e,t,null,m.thatReturnsArgument),t}var h=e(25),v=e(60),m=e(146),g=e(137),y=h.twoArgumentPooler,C=h.fourArgumentPooler,b=/\/+/g;o.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},h.addPoolingTo(o,y),u.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},h.addPoolingTo(u,C);var _={forEach:a,map:c,mapIntoWithKeyPrefixInternal:l,count:d,toArray:f};t.exports=_},{137:137,146:146,25:25,60:60}],30:[function(e,t,n){"use strict";function r(e,t){var n=E.hasOwnProperty(t)?E[t]:null;N.hasOwnProperty(t)&&(n!==b.OVERRIDE_BASE?m(!1):void 0),e&&(n!==b.DEFINE_MANY&&n!==b.DEFINE_MANY_MERGED?m(!1):void 0)}function o(e,t){if(t){"function"==typeof t?m(!1):void 0,f.isValidElement(t)?m(!1):void 0;var n=e.prototype,o=n.__reactAutoBindPairs;t.hasOwnProperty(C)&&x.mixins(e,t.mixins);for(var i in t)if(t.hasOwnProperty(i)&&i!==C){var a=t[i],l=n.hasOwnProperty(i);if(r(l,i),x.hasOwnProperty(i))x[i](e,a);else{var c=E.hasOwnProperty(i),p="function"==typeof a,d=p&&!c&&!l&&t.autobind!==!1;if(d)o.push(i,a),n[i]=a;else if(l){var h=E[i];!c||h!==b.DEFINE_MANY_MERGED&&h!==b.DEFINE_MANY?m(!1):void 0,h===b.DEFINE_MANY_MERGED?n[i]=u(n[i],a):h===b.DEFINE_MANY&&(n[i]=s(n[i],a))}else n[i]=a}}}}function i(e,t){if(t)for(var n in t){var r=t[n];if(t.hasOwnProperty(n)){var o=n in x;o?m(!1):void 0;var i=n in e;i?m(!1):void 0,e[n]=r}}}function a(e,t){e&&t&&"object"==typeof e&&"object"==typeof t?void 0:m(!1);for(var n in t)t.hasOwnProperty(n)&&(void 0!==e[n]?m(!1):void 0,e[n]=t[n]);return e}function u(e,t){return function(){var n=e.apply(this,arguments),r=t.apply(this,arguments);if(null==n)return r;if(null==r)return n;var o={};return a(o,n),a(o,r),o}}function s(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function l(e,t){var n=t.bind(e);return n}function c(e){for(var t=e.__reactAutoBindPairs,n=0;n<t.length;n+=2){var r=t[n],o=t[n+1];e[r]=l(e,o)}}var p=e(165),d=e(31),f=e(60),h=(e(80),e(79),e(77)),v=e(147),m=e(154),g=e(157),y=e(158),C=(e(164),y({mixins:null})),b=g({DEFINE_ONCE:null,DEFINE_MANY:null,OVERRIDE_BASE:null,DEFINE_MANY_MERGED:null}),_=[],E={mixins:b.DEFINE_MANY,statics:b.DEFINE_MANY,propTypes:b.DEFINE_MANY,contextTypes:b.DEFINE_MANY,childContextTypes:b.DEFINE_MANY,getDefaultProps:b.DEFINE_MANY_MERGED,getInitialState:b.DEFINE_MANY_MERGED,getChildContext:b.DEFINE_MANY_MERGED,render:b.DEFINE_ONCE,componentWillMount:b.DEFINE_MANY,componentDidMount:b.DEFINE_MANY,componentWillReceiveProps:b.DEFINE_MANY,shouldComponentUpdate:b.DEFINE_ONCE,componentWillUpdate:b.DEFINE_MANY,componentDidUpdate:b.DEFINE_MANY,componentWillUnmount:b.DEFINE_MANY,updateComponent:b.OVERRIDE_BASE},x={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)o(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=p({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=p({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=u(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=p({},e.propTypes,t)},statics:function(e,t){i(e,t)},autobind:function(){}},N={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e),t&&this.updater.enqueueCallback(this,t,"replaceState")},isMounted:function(){return this.updater.isMounted(this)}},T=function(){};p(T.prototype,d.prototype,N);var P={createClass:function(e){var t=function(e,t,n){this.__reactAutoBindPairs.length&&c(this),this.props=e,this.context=t,this.refs=v,this.updater=n||h,this.state=null;var r=this.getInitialState?this.getInitialState():null;"object"!=typeof r||Array.isArray(r)?m(!1):void 0,this.state=r};t.prototype=new T,t.prototype.constructor=t,t.prototype.__reactAutoBindPairs=[],_.forEach(o.bind(null,t)),o(t,e),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),t.prototype.render?void 0:m(!1);for(var n in E)t.prototype[n]||(t.prototype[n]=null);return t},injection:{injectMixin:function(e){_.push(e)}}};t.exports=P},{147:147,154:154,157:157,158:158,164:164,165:165,31:31,60:60,77:77,79:79,80:80}],31:[function(e,t,n){"use strict";function r(e,t,n){this.props=e,this.context=t,this.refs=i,this.updater=n||o}var o=e(77),i=(e(70),e(112),e(147)),a=e(154);e(164);r.prototype.isReactComponent={},r.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e?a(!1):void 0,this.updater.enqueueSetState(this,e),t&&this.updater.enqueueCallback(this,t,"setState")},r.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e,"forceUpdate")};t.exports=r},{112:112,147:147,154:154,164:164,70:70,77:77}],32:[function(e,t,n){"use strict";var r=e(7),o=e(46),i={processChildrenUpdates:o.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkup:r.dangerouslyReplaceNodeWithMarkup,unmountIDFromEnvironment:function(e){}};t.exports=i},{46:46,7:7}],33:[function(e,t,n){"use strict";var r=e(154),o=!1,i={unmountIDFromEnvironment:null,replaceNodeWithMarkup:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){o?r(!1):void 0,i.unmountIDFromEnvironment=e.unmountIDFromEnvironment,i.replaceNodeWithMarkup=e.replaceNodeWithMarkup,i.processChildrenUpdates=e.processChildrenUpdates,o=!0}}};t.exports=i},{154:154}],34:[function(e,t,n){"use strict";function r(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" Check the render method of `"+n+"`."}return""}function o(e){}function i(e,t){}function a(e){return e.prototype&&e.prototype.isReactComponent}var u=e(165),s=e(33),l=e(35),c=e(60),p=e(63),d=e(69),f=(e(70),e(76)),h=e(80),v=(e(79),e(83)),m=e(89),g=e(147),y=e(154),C=e(136);e(164);o.prototype.render=function(){var e=d.get(this)._currentElement.type,t=e(this.props,this.context,this.updater);return i(e,t),t};var b=1,_={construct:function(e){this._currentElement=e,this._rootNodeID=null,this._instance=null,this._nativeParent=null,this._nativeContainerInfo=null,this._updateBatchNumber=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedNodeType=null,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null,this._calledComponentWillUnmount=!1},mountComponent:function(e,t,n,r){this._context=r,this._mountOrder=b++,this._nativeParent=t,this._nativeContainerInfo=n;var u,s=this._processProps(this._currentElement.props),l=this._processContext(r),p=this._currentElement.type,f=this._constructComponent(s,l);a(p)||null!=f&&null!=f.render||(u=f,i(p,u),null===f||f===!1||c.isValidElement(f)?void 0:y(!1),f=new o(p)),f.props=s,f.context=l,f.refs=g,f.updater=m,this._instance=f,d.set(f,this);var h=f.state;void 0===h&&(f.state=h=null),"object"!=typeof h||Array.isArray(h)?y(!1):void 0,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1;var v;return v=f.unstable_handleError?this.performInitialMountWithErrorHandling(u,t,n,e,r):this.performInitialMount(u,t,n,e,r),f.componentDidMount&&e.getReactMountReady().enqueue(f.componentDidMount,f),v},_constructComponent:function(e,t){return this._constructComponentWithoutOwner(e,t)},_constructComponentWithoutOwner:function(e,t){var n,r=this._currentElement.type;return n=a(r)?new r(e,t,m):r(e,t,m)},performInitialMountWithErrorHandling:function(e,t,n,r,o){var i,a=r.checkpoint();try{i=this.performInitialMount(e,t,n,r,o)}catch(u){r.rollback(a),this._instance.unstable_handleError(u),this._pendingStateQueue&&(this._instance.state=this._processPendingState(this._instance.props,this._instance.context)),a=r.checkpoint(),this._renderedComponent.unmountComponent(!0),r.rollback(a),i=this.performInitialMount(e,t,n,r,o)}return i},performInitialMount:function(e,t,n,r,o){var i=this._instance;i.componentWillMount&&(i.componentWillMount(),this._pendingStateQueue&&(i.state=this._processPendingState(i.props,i.context))),void 0===e&&(e=this._renderValidatedComponent()),this._renderedNodeType=f.getType(e),this._renderedComponent=this._instantiateReactComponent(e);var a=v.mountComponent(this._renderedComponent,r,t,n,this._processChildContext(o));return a},getNativeNode:function(){return v.getNativeNode(this._renderedComponent)},unmountComponent:function(e){if(this._renderedComponent){var t=this._instance;if(t.componentWillUnmount&&!t._calledComponentWillUnmount)if(t._calledComponentWillUnmount=!0,e){var n=this.getName()+".componentWillUnmount()";p.invokeGuardedCallback(n,t.componentWillUnmount.bind(t))}else t.componentWillUnmount();this._renderedComponent&&(v.unmountComponent(this._renderedComponent,e),this._renderedNodeType=null,this._renderedComponent=null,this._instance=null),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=null,this._topLevelWrapper=null,d.remove(t)}},_maskContext:function(e){var t=this._currentElement.type,n=t.contextTypes;if(!n)return g;var r={};for(var o in n)r[o]=e[o];return r},_processContext:function(e){var t=this._maskContext(e);return t},_processChildContext:function(e){var t=this._currentElement.type,n=this._instance,r=n.getChildContext&&n.getChildContext();if(r){"object"!=typeof t.childContextTypes?y(!1):void 0;for(var o in r)o in t.childContextTypes?void 0:y(!1);return u({},e,r)}return e},_processProps:function(e){return e},_checkPropTypes:function(e,t,n){var o=this.getName();for(var i in e)if(e.hasOwnProperty(i)){var a;try{"function"!=typeof e[i]?y(!1):void 0,a=e[i](t,i,o,n)}catch(u){a=u}a instanceof Error&&(r(this),n===h.prop)}},receiveComponent:function(e,t,n){var r=this._currentElement,o=this._context;this._pendingElement=null,this.updateComponent(t,r,e,o,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement?v.receiveComponent(this,this._pendingElement,e,this._context):null!==this._pendingStateQueue||this._pendingForceUpdate?this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context):this._updateBatchNumber=null},updateComponent:function(e,t,n,r,o){var i,a,u=this._instance,s=!1;this._context===o?i=u.context:(i=this._processContext(o),s=!0),t===n?a=n.props:(a=this._processProps(n.props),s=!0),s&&u.componentWillReceiveProps&&u.componentWillReceiveProps(a,i);var l=this._processPendingState(a,i),c=!0;!this._pendingForceUpdate&&u.shouldComponentUpdate&&(c=u.shouldComponentUpdate(a,l,i)),this._updateBatchNumber=null,c?(this._pendingForceUpdate=!1,this._performComponentUpdate(n,a,l,i,e,o)):(this._currentElement=n,this._context=o,u.props=a,u.state=l,u.context=i)},_processPendingState:function(e,t){var n=this._instance,r=this._pendingStateQueue,o=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!r)return n.state;if(o&&1===r.length)return r[0];for(var i=u({},o?r[0]:n.state),a=o?1:0;a<r.length;a++){var s=r[a];u(i,"function"==typeof s?s.call(n,i,e,t):s)}return i},_performComponentUpdate:function(e,t,n,r,o,i){var a,u,s,l=this._instance,c=Boolean(l.componentDidUpdate);c&&(a=l.props,u=l.state,s=l.context),l.componentWillUpdate&&l.componentWillUpdate(t,n,r),this._currentElement=e,this._context=i,l.props=t,l.state=n,l.context=r,this._updateRenderedComponent(o,i),c&&o.getReactMountReady().enqueue(l.componentDidUpdate.bind(l,a,u,s),l)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,r=n._currentElement,o=this._renderValidatedComponent();if(C(r,o))v.receiveComponent(n,o,e,this._processChildContext(t));else{var i=v.getNativeNode(n);v.unmountComponent(n,!1),this._renderedNodeType=f.getType(o),this._renderedComponent=this._instantiateReactComponent(o);var a=v.mountComponent(this._renderedComponent,e,this._nativeParent,this._nativeContainerInfo,this._processChildContext(t));this._replaceNodeWithMarkup(i,a,n)}},_replaceNodeWithMarkup:function(e,t,n){s.replaceNodeWithMarkup(e,t,n)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e=this._instance,t=e.render();return t},_renderValidatedComponent:function(){var e;l.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{l.current=null}return null===e||e===!1||c.isValidElement(e)?void 0:y(!1),e},attachRef:function(e,t){var n=this.getPublicInstance();null==n?y(!1):void 0;var r=t.getPublicInstance(),o=n.refs===g?n.refs={}:n.refs;o[e]=r},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return e instanceof o?null:e},_instantiateReactComponent:null},E={Mixin:_};t.exports=E},{136:136,147:147,154:154,164:164,165:165,33:33,35:35,60:60,63:63,69:69,70:70,76:76,79:79,80:80,83:83,89:89}],35:[function(e,t,n){"use strict";var r={current:null};t.exports=r},{}],36:[function(e,t,n){"use strict";var r=e(40),o=e(59),i=e(72),a=e(83),u=e(90),s=e(91),l=e(116),c=e(124),p=e(133);e(164);o.inject();var d={findDOMNode:l,render:i.render,unmountComponentAtNode:i.unmountComponentAtNode,version:s,unstable_batchedUpdates:u.batchedUpdates,unstable_renderSubtreeIntoContainer:p};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({ComponentTree:{getClosestInstanceFromNode:r.getClosestInstanceFromNode,getNodeFromInstance:function(e){return e._renderedComponent&&(e=c(e)),e?r.getNodeFromInstance(e):null}},Mount:i,Reconciler:a});t.exports=d},{116:116,124:124,133:133,164:164,40:40,59:59,72:72,83:83,90:90,91:91}],37:[function(e,t,n){"use strict";var r=e(14),o={getNativeProps:r.getNativeProps};t.exports=o},{14:14}],38:[function(e,t,n){"use strict";function r(e,t){t&&(X[e._tag]&&(null!=t.children||null!=t.dangerouslySetInnerHTML?O(!1):void 0),null!=t.dangerouslySetInnerHTML&&(null!=t.children?O(!1):void 0,"object"==typeof t.dangerouslySetInnerHTML&&K in t.dangerouslySetInnerHTML?void 0:O(!1)),null!=t.style&&"object"!=typeof t.style?O(!1):void 0)}function o(e,t,n,r){if(!(r instanceof D)){var o=e._nativeContainerInfo,a=o._node&&o._node.nodeType===q,u=a?o._node:o._ownerDocument;V(t,u),r.getReactMountReady().enqueue(i,{inst:e,registrationName:t,listener:n})}}function i(){var e=this;b.putListener(e.inst,e.registrationName,e.listener)}function a(){var e=this;S.postMountWrapper(e)}function u(){var e=this;e._rootNodeID?void 0:O(!1);var t=F(e);switch(t?void 0:O(!1),e._tag){case"iframe":case"object":e._wrapperState.listeners=[E.trapBubbledEvent(C.topLevelTypes.topLoad,"load",t)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var n in Y)Y.hasOwnProperty(n)&&e._wrapperState.listeners.push(E.trapBubbledEvent(C.topLevelTypes[n],Y[n],t));break;case"img":e._wrapperState.listeners=[E.trapBubbledEvent(C.topLevelTypes.topError,"error",t),E.trapBubbledEvent(C.topLevelTypes.topLoad,"load",t)];break;case"form":e._wrapperState.listeners=[E.trapBubbledEvent(C.topLevelTypes.topReset,"reset",t),E.trapBubbledEvent(C.topLevelTypes.topSubmit,"submit",t)];break;case"input":case"select":case"textarea":e._wrapperState.listeners=[E.trapBubbledEvent(C.topLevelTypes.topInvalid,"invalid",t)]}}function s(){M.postUpdateWrapper(this)}function l(e){Z.call($,e)||(Q.test(e)?void 0:O(!1),$[e]=!0)}function c(e,t){return e.indexOf("-")>=0||null!=t.is}function p(e){var t=e.type;l(t),this._currentElement=e,this._tag=t.toLowerCase(),this._namespaceURI=null,this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._nativeNode=null,this._nativeParent=null,this._rootNodeID=null,this._domID=null,this._nativeContainerInfo=null,this._wrapperState=null,this._topLevelWrapper=null,this._flags=0}var d=e(165),f=e(1),h=e(4),v=e(8),m=e(9),g=e(10),y=e(11),C=e(16),b=e(17),_=e(18),E=e(27),x=e(32),N=e(37),T=e(39),P=e(40),w=e(47),S=e(49),M=e(50),k=e(54),R=(e(70),e(73)),D=e(87),I=(e(146),e(115)),O=e(154),A=(e(129),e(158)),L=(e(163),e(138),e(164),T),U=b.deleteListener,F=P.getNodeFromInstance,V=E.listenTo,B=_.registrationNameModules,j={string:!0,number:!0},W=A({style:null}),K=A({__html:null}),H={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null},q=11,Y={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},z={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},G={listing:!0,pre:!0,textarea:!0},X=d({menuitem:!0},z),Q=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,$={},Z={}.hasOwnProperty,J=1;p.displayName="ReactDOMComponent",p.Mixin={mountComponent:function(e,t,n,o){this._rootNodeID=J++,this._domID=n._idCounter++,this._nativeParent=t,this._nativeContainerInfo=n;var i=this._currentElement.props;switch(this._tag){case"iframe":case"object":case"img":case"form":case"video":case"audio":this._wrapperState={listeners:null},e.getReactMountReady().enqueue(u,this);break;case"button":i=N.getNativeProps(this,i,t);break;case"input":w.mountWrapper(this,i,t),i=w.getNativeProps(this,i),e.getReactMountReady().enqueue(u,this);break;case"option":S.mountWrapper(this,i,t),i=S.getNativeProps(this,i);break;case"select":M.mountWrapper(this,i,t),i=M.getNativeProps(this,i),e.getReactMountReady().enqueue(u,this);break;case"textarea":k.mountWrapper(this,i,t),i=k.getNativeProps(this,i),e.getReactMountReady().enqueue(u,this)}r(this,i);var s,l;null!=t?(s=t._namespaceURI,l=t._tag):n._tag&&(s=n._namespaceURI,l=n._tag),(null==s||s===m.svg&&"foreignobject"===l)&&(s=m.html),s===m.html&&("svg"===this._tag?s=m.svg:"math"===this._tag&&(s=m.mathml)),this._namespaceURI=s;var c;if(e.useCreateElement){var p,d=n._ownerDocument;if(s===m.html)if("script"===this._tag){var h=d.createElement("div"),g=this._currentElement.type;h.innerHTML="<"+g+"></"+g+">",p=h.removeChild(h.firstChild)}else p=d.createElement(this._currentElement.type,i.is||null);else p=d.createElementNS(s,this._currentElement.type);P.precacheNode(this,p),this._flags|=L.hasCachedChildNodes,this._nativeParent||y.setAttributeForRoot(p),this._updateDOMProperties(null,i,e);var C=v(p);this._createInitialChildren(e,i,o,C),c=C}else{var b=this._createOpenTagMarkupAndPutListeners(e,i),_=this._createContentMarkup(e,i,o);c=!_&&z[this._tag]?b+"/>":b+">"+_+"</"+this._currentElement.type+">"}switch(this._tag){case"button":case"input":case"select":case"textarea":i.autoFocus&&e.getReactMountReady().enqueue(f.focusDOMComponent,this);break;case"option":e.getReactMountReady().enqueue(a,this)}return c},_createOpenTagMarkupAndPutListeners:function(e,t){var n="<"+this._currentElement.type;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if(null!=i)if(B.hasOwnProperty(r))i&&o(this,r,i,e);else{r===W&&(i&&(i=this._previousStyleCopy=d({},t.style)),i=h.createMarkupForStyles(i,this));var a=null;null!=this._tag&&c(this._tag,t)?H.hasOwnProperty(r)||(a=y.createMarkupForCustomAttribute(r,i)):a=y.createMarkupForProperty(r,i),a&&(n+=" "+a)}}return e.renderToStaticMarkup?n:(this._nativeParent||(n+=" "+y.createMarkupForRoot()),n+=" "+y.createMarkupForID(this._domID))},_createContentMarkup:function(e,t,n){var r="",o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&(r=o.__html);else{var i=j[typeof t.children]?t.children:null,a=null!=i?null:t.children;if(null!=i)r=I(i);else if(null!=a){var u=this.mountChildren(a,e,n);r=u.join("")}}return G[this._tag]&&"\n"===r.charAt(0)?"\n"+r:r},_createInitialChildren:function(e,t,n,r){var o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&v.queueHTML(r,o.__html);else{var i=j[typeof t.children]?t.children:null,a=null!=i?null:t.children;if(null!=i)v.queueText(r,i);else if(null!=a)for(var u=this.mountChildren(a,e,n),s=0;s<u.length;s++)v.queueChild(r,u[s])}},receiveComponent:function(e,t,n){var r=this._currentElement;this._currentElement=e,this.updateComponent(t,r,e,n)},updateComponent:function(e,t,n,o){var i=t.props,a=this._currentElement.props;switch(this._tag){case"button":i=N.getNativeProps(this,i),a=N.getNativeProps(this,a);break;case"input":w.updateWrapper(this),i=w.getNativeProps(this,i),a=w.getNativeProps(this,a);break;case"option":i=S.getNativeProps(this,i),a=S.getNativeProps(this,a);break;case"select":i=M.getNativeProps(this,i),a=M.getNativeProps(this,a);break;case"textarea":k.updateWrapper(this),i=k.getNativeProps(this,i),a=k.getNativeProps(this,a)}r(this,a),this._updateDOMProperties(i,a,e),this._updateDOMChildren(i,a,e,o),"select"===this._tag&&e.getReactMountReady().enqueue(s,this)},_updateDOMProperties:function(e,t,n){var r,i,a;for(r in e)if(!t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&null!=e[r])if(r===W){var u=this._previousStyleCopy;for(i in u)u.hasOwnProperty(i)&&(a=a||{},a[i]="");this._previousStyleCopy=null}else B.hasOwnProperty(r)?e[r]&&U(this,r):(g.properties[r]||g.isCustomAttribute(r))&&y.deleteValueForProperty(F(this),r);for(r in t){var s=t[r],l=r===W?this._previousStyleCopy:null!=e?e[r]:void 0;if(t.hasOwnProperty(r)&&s!==l&&(null!=s||null!=l))if(r===W)if(s?s=this._previousStyleCopy=d({},s):this._previousStyleCopy=null,l){for(i in l)!l.hasOwnProperty(i)||s&&s.hasOwnProperty(i)||(a=a||{},a[i]="");for(i in s)s.hasOwnProperty(i)&&l[i]!==s[i]&&(a=a||{},a[i]=s[i])}else a=s;else if(B.hasOwnProperty(r))s?o(this,r,s,n):l&&U(this,r);else if(c(this._tag,t))H.hasOwnProperty(r)||y.setValueForAttribute(F(this),r,s);else if(g.properties[r]||g.isCustomAttribute(r)){var p=F(this);null!=s?y.setValueForProperty(p,r,s):y.deleteValueForProperty(p,r)}}a&&h.setValueForStyles(F(this),a,this)},_updateDOMChildren:function(e,t,n,r){var o=j[typeof e.children]?e.children:null,i=j[typeof t.children]?t.children:null,a=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,u=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,s=null!=o?null:e.children,l=null!=i?null:t.children,c=null!=o||null!=a,p=null!=i||null!=u;null!=s&&null==l?this.updateChildren(null,n,r):c&&!p&&this.updateTextContent(""),null!=i?o!==i&&this.updateTextContent(""+i):null!=u?a!==u&&this.updateMarkup(""+u):null!=l&&this.updateChildren(l,n,r)},getNativeNode:function(){return F(this)},unmountComponent:function(e){switch(this._tag){case"iframe":case"object":case"img":case"form":case"video":case"audio":var t=this._wrapperState.listeners;if(t)for(var n=0;n<t.length;n++)t[n].remove();break;case"html":case"head":case"body":O(!1)}this.unmountChildren(e),P.uncacheNode(this),b.deleteAllListeners(this),x.unmountIDFromEnvironment(this._rootNodeID),this._rootNodeID=null,this._domID=null,this._wrapperState=null},getPublicInstance:function(){return F(this)}},d(p.prototype,p.Mixin,R.Mixin),t.exports=p},{1:1,10:10,11:11,115:115,129:129,138:138,146:146,154:154,158:158,16:16,163:163,164:164,165:165,17:17,18:18,27:27,32:32,37:37,39:39,4:4,40:40,47:47,49:49,50:50,54:54,70:70,73:73,8:8,87:87,9:9}],39:[function(e,t,n){"use strict";var r={hasCachedChildNodes:1};t.exports=r},{}],40:[function(e,t,n){"use strict";function r(e){for(var t;t=e._renderedComponent;)e=t;return e}function o(e,t){var n=r(e);n._nativeNode=t,t[v]=n}function i(e){var t=e._nativeNode;t&&(delete t[v],e._nativeNode=null)}function a(e,t){if(!(e._flags&h.hasCachedChildNodes)){var n=e._renderedChildren,i=t.firstChild;e:for(var a in n)if(n.hasOwnProperty(a)){var u=n[a],s=r(u)._domID;if(null!=s){for(;null!==i;i=i.nextSibling)if(1===i.nodeType&&i.getAttribute(f)===String(s)||8===i.nodeType&&i.nodeValue===" react-text: "+s+" "||8===i.nodeType&&i.nodeValue===" react-empty: "+s+" "){o(u,i);continue e}d(!1)}}e._flags|=h.hasCachedChildNodes}}function u(e){if(e[v])return e[v];for(var t=[];!e[v];){if(t.push(e),!e.parentNode)return null;e=e.parentNode}for(var n,r;e&&(r=e[v]);e=t.pop())n=r,t.length&&a(r,e);return n}function s(e){var t=u(e);return null!=t&&t._nativeNode===e?t:null}function l(e){if(void 0===e._nativeNode?d(!1):void 0,e._nativeNode)return e._nativeNode;for(var t=[];!e._nativeNode;)t.push(e),e._nativeParent?void 0:d(!1),e=e._nativeParent;for(;t.length;e=t.pop())a(e,e._nativeNode);return e._nativeNode}var c=e(10),p=e(39),d=e(154),f=c.ID_ATTRIBUTE_NAME,h=p,v="__reactInternalInstance$"+Math.random().toString(36).slice(2),m={getClosestInstanceFromNode:u,getInstanceFromNode:s,getNodeFromInstance:l,precacheChildNodes:a,precacheNode:o,uncacheNode:i};t.exports=m},{10:10,154:154,39:39}],41:[function(e,t,n){"use strict";function r(e,t){var n={_topLevelWrapper:e,_idCounter:1,_ownerDocument:t?t.nodeType===o?t:t.ownerDocument:null,_node:t,_tag:t?t.nodeName.toLowerCase():null,_namespaceURI:t?t.namespaceURI:null};return n}var o=(e(138),9);t.exports=r},{138:138}],42:[function(e,t,n){"use strict";function r(e,t,n,r,o,i){}var o=e(56),i=(e(164),[]),a={addDevtool:function(e){i.push(e)},removeDevtool:function(e){for(var t=0;t<i.length;t++)i[t]===e&&(i.splice(t,1),t--)},onCreateMarkupForProperty:function(e,t){r("onCreateMarkupForProperty",e,t)},onSetValueForProperty:function(e,t,n){r("onSetValueForProperty",e,t,n)},onDeleteValueForProperty:function(e,t){r("onDeleteValueForProperty",e,t)}};a.addDevtool(o),t.exports=a},{164:164,56:56}],43:[function(e,t,n){"use strict";var r=e(165),o=e(8),i=e(40),a=function(e){this._currentElement=null,this._nativeNode=null,this._nativeParent=null,this._nativeContainerInfo=null,this._domID=null};r(a.prototype,{mountComponent:function(e,t,n,r){var a=n._idCounter++;this._domID=a,this._nativeParent=t,this._nativeContainerInfo=n;var u=" react-empty: "+this._domID+" ";if(e.useCreateElement){var s=n._ownerDocument,l=s.createComment(u);return i.precacheNode(this,l),o(l)}return e.renderToStaticMarkup?"":"<!--"+u+"-->"},receiveComponent:function(){},getNativeNode:function(){return i.getNodeFromInstance(this)},unmountComponent:function(){i.uncacheNode(this)}}),t.exports=a},{165:165,40:40,8:8}],44:[function(e,t,n){"use strict";function r(e){return o.createFactory(e)}var o=e(60),i=(e(61),e(159)),a=i({a:"a",abbr:"abbr",address:"address",area:"area",article:"article",aside:"aside",audio:"audio",
b:"b",base:"base",bdi:"bdi",bdo:"bdo",big:"big",blockquote:"blockquote",body:"body",br:"br",button:"button",canvas:"canvas",caption:"caption",cite:"cite",code:"code",col:"col",colgroup:"colgroup",data:"data",datalist:"datalist",dd:"dd",del:"del",details:"details",dfn:"dfn",dialog:"dialog",div:"div",dl:"dl",dt:"dt",em:"em",embed:"embed",fieldset:"fieldset",figcaption:"figcaption",figure:"figure",footer:"footer",form:"form",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",head:"head",header:"header",hgroup:"hgroup",hr:"hr",html:"html",i:"i",iframe:"iframe",img:"img",input:"input",ins:"ins",kbd:"kbd",keygen:"keygen",label:"label",legend:"legend",li:"li",link:"link",main:"main",map:"map",mark:"mark",menu:"menu",menuitem:"menuitem",meta:"meta",meter:"meter",nav:"nav",noscript:"noscript",object:"object",ol:"ol",optgroup:"optgroup",option:"option",output:"output",p:"p",param:"param",picture:"picture",pre:"pre",progress:"progress",q:"q",rp:"rp",rt:"rt",ruby:"ruby",s:"s",samp:"samp",script:"script",section:"section",select:"select",small:"small",source:"source",span:"span",strong:"strong",style:"style",sub:"sub",summary:"summary",sup:"sup",table:"table",tbody:"tbody",td:"td",textarea:"textarea",tfoot:"tfoot",th:"th",thead:"thead",time:"time",title:"title",tr:"tr",track:"track",u:"u",ul:"ul","var":"var",video:"video",wbr:"wbr",circle:"circle",clipPath:"clipPath",defs:"defs",ellipse:"ellipse",g:"g",image:"image",line:"line",linearGradient:"linearGradient",mask:"mask",path:"path",pattern:"pattern",polygon:"polygon",polyline:"polyline",radialGradient:"radialGradient",rect:"rect",stop:"stop",svg:"svg",text:"text",tspan:"tspan"},r);t.exports=a},{159:159,60:60,61:61}],45:[function(e,t,n){"use strict";var r={useCreateElement:!0};t.exports=r},{}],46:[function(e,t,n){"use strict";var r=e(7),o=e(40),i={dangerouslyProcessChildrenUpdates:function(e,t){var n=o.getNodeFromInstance(e);r.processUpdates(n,t)}};t.exports=i},{40:40,7:7}],47:[function(e,t,n){"use strict";function r(){this._rootNodeID&&d.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);c.asap(r,this);var o=t.name;if("radio"===t.type&&null!=o){for(var i=l.getNodeFromInstance(this),a=i;a.parentNode;)a=a.parentNode;for(var u=a.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),d=0;d<u.length;d++){var f=u[d];if(f!==i&&f.form===i.form){var h=l.getInstanceFromNode(f);h?void 0:p(!1),c.asap(r,h)}}}return n}var i=e(165),a=e(14),u=e(11),s=e(24),l=e(40),c=e(90),p=e(154),d=(e(164),{getNativeProps:function(e,t){var n=s.getValue(t),r=s.getChecked(t),o=i({type:void 0},a.getNativeProps(e,t),{defaultChecked:void 0,defaultValue:void 0,value:null!=n?n:e._wrapperState.initialValue,checked:null!=r?r:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange});return o},mountWrapper:function(e,t){var n=t.defaultValue;e._wrapperState={initialChecked:t.defaultChecked||!1,initialValue:null!=n?n:null,listeners:null,onChange:o.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=t.checked;null!=n&&u.setValueForProperty(l.getNodeFromInstance(e),"checked",n||!1);var r=s.getValue(t);null!=r&&u.setValueForProperty(l.getNodeFromInstance(e),"value",""+r)}});t.exports=d},{11:11,14:14,154:154,164:164,165:165,24:24,40:40,90:90}],48:[function(e,t,n){"use strict";var r=e(42);t.exports={debugTool:r}},{42:42}],49:[function(e,t,n){"use strict";var r=e(165),o=e(29),i=e(40),a=e(50),u=(e(164),{mountWrapper:function(e,t,n){var r=null;if(null!=n){var o=n;"optgroup"===o._tag&&(o=o._nativeParent),null!=o&&"select"===o._tag&&(r=a.getSelectValueContext(o))}var i=null;if(null!=r)if(i=!1,Array.isArray(r)){for(var u=0;u<r.length;u++)if(""+r[u]==""+t.value){i=!0;break}}else i=""+r==""+t.value;e._wrapperState={selected:i}},postMountWrapper:function(e){var t=e._currentElement.props;if(null!=t.value){var n=i.getNodeFromInstance(e);n.setAttribute("value",t.value)}},getNativeProps:function(e,t){var n=r({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(n.selected=e._wrapperState.selected);var i="";return o.forEach(t.children,function(e){null!=e&&("string"!=typeof e&&"number"!=typeof e||(i+=e))}),i&&(n.children=i),n}});t.exports=u},{164:164,165:165,29:29,40:40,50:50}],50:[function(e,t,n){"use strict";function r(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=s.getValue(e);null!=t&&o(this,Boolean(e.multiple),t)}}function o(e,t,n){var r,o,i=l.getNodeFromInstance(e).options;if(t){for(r={},o=0;o<n.length;o++)r[""+n[o]]=!0;for(o=0;o<i.length;o++){var a=r.hasOwnProperty(i[o].value);i[o].selected!==a&&(i[o].selected=a)}}else{for(r=""+n,o=0;o<i.length;o++)if(i[o].value===r)return void(i[o].selected=!0);i.length&&(i[0].selected=!0)}}function i(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);return this._rootNodeID&&(this._wrapperState.pendingUpdate=!0),c.asap(r,this),n}var a=e(165),u=e(14),s=e(24),l=e(40),c=e(90),p=(e(164),!1),d={getNativeProps:function(e,t){return a({},u.getNativeProps(e,t),{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var n=s.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=n?n:t.defaultValue,listeners:null,onChange:i.bind(e),wasMultiple:Boolean(t.multiple)},void 0===t.value||void 0===t.defaultValue||p||(p=!0)},getSelectValueContext:function(e){return e._wrapperState.initialValue},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var n=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var r=s.getValue(t);null!=r?(e._wrapperState.pendingUpdate=!1,o(e,Boolean(t.multiple),r)):n!==Boolean(t.multiple)&&(null!=t.defaultValue?o(e,Boolean(t.multiple),t.defaultValue):o(e,Boolean(t.multiple),t.multiple?[]:""))}};t.exports=d},{14:14,164:164,165:165,24:24,40:40,90:90}],51:[function(e,t,n){"use strict";function r(e,t,n,r){return e===n&&t===r}function o(e){var t=document.selection,n=t.createRange(),r=n.text.length,o=n.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",n);var i=o.text.length,a=i+r;return{start:i,end:a}}function i(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,o=t.anchorOffset,i=t.focusNode,a=t.focusOffset,u=t.getRangeAt(0);try{u.startContainer.nodeType,u.endContainer.nodeType}catch(s){return null}var l=r(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),c=l?0:u.toString().length,p=u.cloneRange();p.selectNodeContents(e),p.setEnd(u.startContainer,u.startOffset);var d=r(p.startContainer,p.startOffset,p.endContainer,p.endOffset),f=d?0:p.toString().length,h=f+c,v=document.createRange();v.setStart(n,o),v.setEnd(i,a);var m=v.collapsed;return{start:m?h:f,end:m?f:h}}function a(e,t){var n,r,o=document.selection.createRange().duplicate();void 0===t.end?(n=t.start,r=n):t.start>t.end?(n=t.end,r=t.start):(n=t.start,r=t.end),o.moveToElementText(e),o.moveStart("character",n),o.setEndPoint("EndToStart",o),o.moveEnd("character",r-n),o.select()}function u(e,t){if(window.getSelection){var n=window.getSelection(),r=e[c()].length,o=Math.min(t.start,r),i=void 0===t.end?o:Math.min(t.end,r);if(!n.extend&&o>i){var a=i;i=o,o=a}var u=l(e,o),s=l(e,i);if(u&&s){var p=document.createRange();p.setStart(u.node,u.offset),n.removeAllRanges(),o>i?(n.addRange(p),n.extend(s.node,s.offset)):(p.setEnd(s.node,s.offset),n.addRange(p))}}}var s=e(140),l=e(125),c=e(126),p=s.canUseDOM&&"selection"in document&&!("getSelection"in window),d={getOffsets:p?o:i,setOffsets:p?a:u};t.exports=d},{125:125,126:126,140:140}],52:[function(e,t,n){"use strict";var r=e(59),o=e(86),i=e(91);r.inject();var a={renderToString:o.renderToString,renderToStaticMarkup:o.renderToStaticMarkup,version:i};t.exports=a},{59:59,86:86,91:91}],53:[function(e,t,n){"use strict";var r=e(165),o=e(7),i=e(8),a=e(40),u=(e(70),e(115)),s=e(154),l=(e(138),function(e){this._currentElement=e,this._stringText=""+e,this._nativeNode=null,this._nativeParent=null,this._domID=null,this._mountIndex=0,this._closingComment=null,this._commentNodes=null});r(l.prototype,{mountComponent:function(e,t,n,r){var o=n._idCounter++,s=" react-text: "+o+" ",l=" /react-text ";if(this._domID=o,this._nativeParent=t,e.useCreateElement){var c=n._ownerDocument,p=c.createComment(s),d=c.createComment(l),f=i(c.createDocumentFragment());return i.queueChild(f,i(p)),this._stringText&&i.queueChild(f,i(c.createTextNode(this._stringText))),i.queueChild(f,i(d)),a.precacheNode(this,p),this._closingComment=d,f}var h=u(this._stringText);return e.renderToStaticMarkup?h:"<!--"+s+"-->"+h+"<!--"+l+"-->"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;if(n!==this._stringText){this._stringText=n;var r=this.getNativeNode();o.replaceDelimitedText(r[0],r[1],n)}}},getNativeNode:function(){var e=this._commentNodes;if(e)return e;if(!this._closingComment)for(var t=a.getNodeFromInstance(this),n=t.nextSibling;;){if(null==n?s(!1):void 0,8===n.nodeType&&" /react-text "===n.nodeValue){this._closingComment=n;break}n=n.nextSibling}return e=[this._nativeNode,this._closingComment],this._commentNodes=e,e},unmountComponent:function(){this._closingComment=null,this._commentNodes=null,a.uncacheNode(this)}}),t.exports=l},{115:115,138:138,154:154,165:165,40:40,7:7,70:70,8:8}],54:[function(e,t,n){"use strict";function r(){this._rootNodeID&&d.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);return c.asap(r,this),n}var i=e(165),a=e(14),u=e(11),s=e(24),l=e(40),c=e(90),p=e(154),d=(e(164),{getNativeProps:function(e,t){null!=t.dangerouslySetInnerHTML?p(!1):void 0;var n=i({},a.getNativeProps(e,t),{defaultValue:void 0,value:void 0,children:e._wrapperState.initialValue,onChange:e._wrapperState.onChange});return n},mountWrapper:function(e,t){var n=t.defaultValue,r=t.children;null!=r&&(null!=n?p(!1):void 0,Array.isArray(r)&&(r.length<=1?void 0:p(!1),r=r[0]),n=""+r),null==n&&(n="");var i=s.getValue(t);e._wrapperState={initialValue:""+(null!=i?i:n),listeners:null,onChange:o.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=s.getValue(t);null!=n&&u.setValueForProperty(l.getNodeFromInstance(e),"value",""+n)}});t.exports=d},{11:11,14:14,154:154,164:164,165:165,24:24,40:40,90:90}],55:[function(e,t,n){"use strict";function r(e,t){"_nativeNode"in e?void 0:s(!1),"_nativeNode"in t?void 0:s(!1);for(var n=0,r=e;r;r=r._nativeParent)n++;for(var o=0,i=t;i;i=i._nativeParent)o++;for(;n-o>0;)e=e._nativeParent,n--;for(;o-n>0;)t=t._nativeParent,o--;for(var a=n;a--;){if(e===t)return e;e=e._nativeParent,t=t._nativeParent}return null}function o(e,t){"_nativeNode"in e?void 0:s(!1),"_nativeNode"in t?void 0:s(!1);for(;t;){if(t===e)return!0;t=t._nativeParent}return!1}function i(e){return"_nativeNode"in e?void 0:s(!1),e._nativeParent}function a(e,t,n){for(var r=[];e;)r.push(e),e=e._nativeParent;var o;for(o=r.length;o-- >0;)t(r[o],!1,n);for(o=0;o<r.length;o++)t(r[o],!0,n)}function u(e,t,n,o,i){for(var a=e&&t?r(e,t):null,u=[];e&&e!==a;)u.push(e),e=e._nativeParent;for(var s=[];t&&t!==a;)s.push(t),t=t._nativeParent;var l;for(l=0;l<u.length;l++)n(u[l],!0,o);for(l=s.length;l-- >0;)n(s[l],!1,i)}var s=e(154);t.exports={isAncestor:o,getLowestCommonAncestor:r,getParentInstance:i,traverseTwoPhase:a,traverseEnterLeave:u}},{154:154}],56:[function(e,t,n){"use strict";var r,o=(e(10),e(18),e(164),{onCreateMarkupForProperty:function(e,t){r(e)},onSetValueForProperty:function(e,t,n){r(t)},onDeleteValueForProperty:function(e,t){r(t)}});t.exports=o},{10:10,164:164,18:18}],57:[function(e,t,n){"use strict";function r(e,t,n,r,o,i){}function o(e){}var i=(e(140),e(162),e(164),[]),a={addDevtool:function(e){i.push(e)},removeDevtool:function(e){for(var t=0;t<i.length;t++)i[t]===e&&(i.splice(t,1),t--)},beginProfiling:function(){},endProfiling:function(){},getFlushHistory:function(){},onBeginFlush:function(){r("onBeginFlush")},onEndFlush:function(){r("onEndFlush")},onBeginLifeCycleTimer:function(e,t){o(e),r("onBeginLifeCycleTimer",e,t)},onEndLifeCycleTimer:function(e,t){o(e),r("onEndLifeCycleTimer",e,t)},onBeginReconcilerTimer:function(e,t){o(e),r("onBeginReconcilerTimer",e,t)},onEndReconcilerTimer:function(e,t){o(e),r("onEndReconcilerTimer",e,t)},onBeginProcessingChildContext:function(){r("onBeginProcessingChildContext")},onEndProcessingChildContext:function(){r("onEndProcessingChildContext")},onNativeOperation:function(e,t,n){o(e),r("onNativeOperation",e,t,n)},onSetState:function(){r("onSetState")},onSetDisplayName:function(e,t){o(e),r("onSetDisplayName",e,t)},onSetChildren:function(e,t){o(e),r("onSetChildren",e,t)},onSetOwner:function(e,t){o(e),r("onSetOwner",e,t)},onSetText:function(e,t){o(e),r("onSetText",e,t)},onMountRootComponent:function(e){o(e),r("onMountRootComponent",e)},onMountComponent:function(e){o(e),r("onMountComponent",e)},onUpdateComponent:function(e){o(e),r("onUpdateComponent",e)},onUnmountComponent:function(e){o(e),r("onUnmountComponent",e)}};t.exports=a},{140:140,162:162,164:164}],58:[function(e,t,n){"use strict";function r(){this.reinitializeTransaction()}var o=e(165),i=e(90),a=e(108),u=e(146),s={initialize:u,close:function(){d.isBatchingUpdates=!1}},l={initialize:u,close:i.flushBatchedUpdates.bind(i)},c=[l,s];o(r.prototype,a.Mixin,{getTransactionWrappers:function(){return c}});var p=new r,d={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,r,o,i){var a=d.isBatchingUpdates;d.isBatchingUpdates=!0,a?e(t,n,r,o,i):p.perform(e,null,t,n,r,o,i)}};t.exports=d},{108:108,146:146,165:165,90:90}],59:[function(e,t,n){"use strict";function r(){E||(E=!0,g.EventEmitter.injectReactEventListener(m),g.EventPluginHub.injectEventPluginOrder(a),g.EventPluginUtils.injectComponentTree(p),g.EventPluginUtils.injectTreeTraversal(f),g.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:_,EnterLeaveEventPlugin:u,ChangeEventPlugin:i,SelectEventPlugin:b,BeforeInputEventPlugin:o}),g.NativeComponent.injectGenericComponentClass(c),g.NativeComponent.injectTextComponentClass(h),g.DOMProperty.injectDOMPropertyConfig(s),g.DOMProperty.injectDOMPropertyConfig(C),g.EmptyComponent.injectEmptyComponentFactory(function(e){return new d(e)}),g.Updates.injectReconcileTransaction(y),g.Updates.injectBatchingStrategy(v),g.Component.injectEnvironment(l))}var o=e(2),i=e(6),a=e(13),u=e(15),s=e(22),l=e(32),c=e(38),p=e(40),d=e(43),f=e(55),h=e(53),v=e(58),m=e(65),g=e(67),y=e(82),C=e(92),b=e(93),_=e(94),E=!1;t.exports={inject:r}},{13:13,15:15,2:2,22:22,32:32,38:38,40:40,43:43,53:53,55:55,58:58,6:6,65:65,67:67,82:82,92:92,93:93,94:94}],60:[function(e,t,n){"use strict";var r=e(165),o=e(35),i=(e(164),e(112),"function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103),a={key:!0,ref:!0,__self:!0,__source:!0},u=function(e,t,n,r,o,a,u){var s={$$typeof:i,type:e,key:t,ref:n,props:u,_owner:a};return s};u.createElement=function(e,t,n){var r,i={},s=null,l=null,c=null,p=null;if(null!=t){l=void 0===t.ref?null:t.ref,s=void 0===t.key?null:""+t.key,c=void 0===t.__self?null:t.__self,p=void 0===t.__source?null:t.__source;for(r in t)t.hasOwnProperty(r)&&!a.hasOwnProperty(r)&&(i[r]=t[r])}var d=arguments.length-2;if(1===d)i.children=n;else if(d>1){for(var f=Array(d),h=0;d>h;h++)f[h]=arguments[h+2];i.children=f}if(e&&e.defaultProps){var v=e.defaultProps;for(r in v)void 0===i[r]&&(i[r]=v[r])}return u(e,s,l,c,p,o.current,i)},u.createFactory=function(e){var t=u.createElement.bind(null,e);return t.type=e,t},u.cloneAndReplaceKey=function(e,t){var n=u(e.type,t,e.ref,e._self,e._source,e._owner,e.props);return n},u.cloneElement=function(e,t,n){var i,s=r({},e.props),l=e.key,c=e.ref,p=e._self,d=e._source,f=e._owner;if(null!=t){void 0!==t.ref&&(c=t.ref,f=o.current),void 0!==t.key&&(l=""+t.key);var h;e.type&&e.type.defaultProps&&(h=e.type.defaultProps);for(i in t)t.hasOwnProperty(i)&&!a.hasOwnProperty(i)&&(void 0===t[i]&&void 0!==h?s[i]=h[i]:s[i]=t[i])}var v=arguments.length-2;if(1===v)s.children=n;else if(v>1){for(var m=Array(v),g=0;v>g;g++)m[g]=arguments[g+2];s.children=m}return u(e.type,l,c,p,d,f,s)},u.isValidElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.exports=u},{112:112,164:164,165:165,35:35}],61:[function(e,t,n){"use strict";function r(){if(p.current){var e=p.current.getName();if(e)return" Check the render method of `"+e+"`."}return""}function o(e,t){e._store&&!e._store.validated&&null==e.key&&(e._store.validated=!0,i("uniqueKey",e,t))}function i(e,t,n){var o=r();if(!o){var i="string"==typeof n?n:n.displayName||n.name;i&&(o=" Check the top-level render call using <"+i+">.")}var a=h[e]||(h[e]={});if(a[o])return null;a[o]=!0;var u={parentOrOwner:o,url:" See https://fb.me/react-warning-keys for more information.",childOwner:null};return t&&t._owner&&t._owner!==p.current&&(u.childOwner=" It was passed a child from "+t._owner.getName()+"."),u}function a(e,t){if("object"==typeof e)if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];l.isValidElement(r)&&o(r,t)}else if(l.isValidElement(e))e._store&&(e._store.validated=!0);else if(e){var i=d(e);if(i&&i!==e.entries)for(var a,u=i.call(e);!(a=u.next()).done;)l.isValidElement(a.value)&&o(a.value,t)}}function u(e,t,n,o){for(var i in t)if(t.hasOwnProperty(i)){var a;try{"function"!=typeof t[i]?f(!1):void 0,a=t[i](n,i,e,o)}catch(u){a=u}a instanceof Error&&!(a.message in v)&&(v[a.message]=!0,r())}}function s(e){var t=e.type;if("function"==typeof t){var n=t.displayName||t.name;t.propTypes&&u(n,t.propTypes,e.props,c.prop),"function"==typeof t.getDefaultProps}}var l=e(60),c=e(80),p=(e(79),e(35)),d=(e(112),e(123)),f=e(154),h=(e(164),{}),v={},m={createElement:function(e,t,n){var r="string"==typeof e||"function"==typeof e,o=l.createElement.apply(this,arguments);if(null==o)return o;if(r)for(var i=2;i<arguments.length;i++)a(arguments[i],e);return s(o),o},createFactory:function(e){var t=m.createElement.bind(null,e);return t.type=e,t},cloneElement:function(e,t,n){for(var r=l.cloneElement.apply(this,arguments),o=2;o<arguments.length;o++)a(arguments[o],r.type);return s(r),r}};t.exports=m},{112:112,123:123,154:154,164:164,35:35,60:60,79:79,80:80}],62:[function(e,t,n){"use strict";var r,o={injectEmptyComponentFactory:function(e){r=e}},i={create:function(e){return r(e)}};i.injection=o,t.exports=i},{}],63:[function(e,t,n){"use strict";function r(e,t,n,r){try{return t(n,r)}catch(i){return void(null===o&&(o=i))}}var o=null,i={invokeGuardedCallback:r,invokeGuardedCallbackWithCatch:r,rethrowCaughtError:function(){if(o){var e=o;throw o=null,e}}};t.exports=i},{}],64:[function(e,t,n){"use strict";function r(e){o.enqueueEvents(e),o.processEventQueue(!1)}var o=e(17),i={handleTopLevel:function(e,t,n,i){var a=o.extractEvents(e,t,n,i);r(a)}};t.exports=i},{17:17}],65:[function(e,t,n){"use strict";function r(e){for(;e._nativeParent;)e=e._nativeParent;var t=p.getNodeFromInstance(e),n=t.parentNode;return p.getClosestInstanceFromNode(n)}function o(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function i(e){var t=f(e.nativeEvent),n=p.getClosestInstanceFromNode(t),o=n;do e.ancestors.push(o),o=o&&r(o);while(o);for(var i=0;i<e.ancestors.length;i++)n=e.ancestors[i],v._handleTopLevel(e.topLevelType,n,e.nativeEvent,f(e.nativeEvent))}function a(e){var t=h(window);e(t)}var u=e(165),s=e(139),l=e(140),c=e(25),p=e(40),d=e(90),f=e(122),h=e(151);u(o.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),c.addPoolingTo(o,c.twoArgumentPooler);var v={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:l.canUseDOM?window:null,setHandleTopLevel:function(e){v._handleTopLevel=e},setEnabled:function(e){v._enabled=!!e},isEnabled:function(){return v._enabled},trapBubbledEvent:function(e,t,n){var r=n;return r?s.listen(r,t,v.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){var r=n;return r?s.capture(r,t,v.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=a.bind(null,e);s.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(v._enabled){var n=o.getPooled(e,t);try{d.batchedUpdates(i,n)}finally{o.release(n)}}}};t.exports=v},{122:122,139:139,140:140,151:151,165:165,25:25,40:40,90:90}],66:[function(e,t,n){"use strict";var r={logTopLevelRenders:!1};t.exports=r},{}],67:[function(e,t,n){"use strict";var r=e(10),o=e(17),i=e(19),a=e(33),u=e(30),s=e(62),l=e(27),c=e(75),p=e(90),d={Component:a.injection,Class:u.injection,DOMProperty:r.injection,EmptyComponent:s.injection,EventPluginHub:o.injection,EventPluginUtils:i.injection,EventEmitter:l.injection,NativeComponent:c.injection,Updates:p.injection};t.exports=d},{10:10,17:17,19:19,27:27,30:30,33:33,62:62,75:75,90:90}],68:[function(e,t,n){"use strict";function r(e){return i(document.documentElement,e)}var o=e(51),i=e(143),a=e(148),u=e(149),s={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=u();return{focusedElem:e,selectionRange:s.hasSelectionCapabilities(e)?s.getSelection(e):null}},restoreSelection:function(e){var t=u(),n=e.focusedElem,o=e.selectionRange;t!==n&&r(n)&&(s.hasSelectionCapabilities(n)&&s.setSelection(n,o),a(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=o.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,r=t.end;if(void 0===r&&(r=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(r,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var i=e.createTextRange();i.collapse(!0),i.moveStart("character",n),i.moveEnd("character",r-n),i.select()}else o.setOffsets(e,t)}};t.exports=s},{143:143,148:148,149:149,51:51}],69:[function(e,t,n){"use strict";var r={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};t.exports=r},{}],70:[function(e,t,n){"use strict";var r=e(57);t.exports={debugTool:r}},{57:57}],71:[function(e,t,n){"use strict";var r=e(111),o=/\/?>/,i=/^<\!\-\-/,a={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=r(e);return i.test(e)?e:e.replace(o," "+a.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var n=t.getAttribute(a.CHECKSUM_ATTR_NAME);n=n&&parseInt(n,10);var o=r(e);return o===n}};t.exports=a},{111:111}],72:[function(e,t,n){"use strict";function r(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r))return r;return e.length===t.length?-1:n}function o(e){return e?e.nodeType===D?e.documentElement:e.firstChild:null}function i(e){return e.getAttribute&&e.getAttribute(M)||""}function a(e,t,n,r,o){var i;if(C.logTopLevelRenders){var a=e._currentElement.props,u=a.type;i="React mount: "+("string"==typeof u?u:u.displayName||u.name),console.time(i)}var s=_.mountComponent(e,n,null,m(e,t),o);i&&console.timeEnd(i),e._renderedComponent._topLevelWrapper=e,U._mountImageIntoNode(s,t,e,r,n)}function u(e,t,n,r){var o=x.ReactReconcileTransaction.getPooled(!n&&g.useCreateElement);o.perform(a,null,e,t,o,n,r),x.ReactReconcileTransaction.release(o)}function s(e,t,n){for(_.unmountComponent(e,n),t.nodeType===D&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function l(e){var t=o(e);if(t){var n=v.getInstanceFromNode(t);return!(!n||!n._nativeParent)}}function c(e){var t=o(e),n=t&&v.getInstanceFromNode(t);return n&&!n._nativeParent?n:null}function p(e){var t=c(e);return t?t._nativeContainerInfo._topLevelWrapper:null}var d=e(8),f=e(10),h=e(27),v=(e(35),e(40)),m=e(41),g=e(45),y=e(60),C=e(66),b=(e(70),e(71)),_=e(83),E=e(89),x=e(90),N=e(147),T=e(128),P=e(154),w=e(134),S=e(136),M=(e(164),f.ID_ATTRIBUTE_NAME),k=f.ROOT_ATTRIBUTE_NAME,R=1,D=9,I=11,O={},A=1,L=function(){this.rootID=A++};L.prototype.isReactComponent={},L.prototype.render=function(){return this.props};var U={TopLevelWrapper:L,_instancesByReactRootID:O,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,r){return U.scrollMonitor(n,function(){E.enqueueElementInternal(e,t),r&&E.enqueueCallbackInternal(e,r)}),e},_renderNewRootComponent:function(e,t,n,r){!t||t.nodeType!==R&&t.nodeType!==D&&t.nodeType!==I?P(!1):void 0,h.ensureScrollValueMonitoring();var o=T(e);x.batchedUpdates(u,o,t,n,r);var i=o._instance.rootID;return O[i]=o,o},renderSubtreeIntoContainer:function(e,t,n,r){return null==e||null==e._reactInternalInstance?P(!1):void 0,U._renderSubtreeIntoContainer(e,t,n,r)},_renderSubtreeIntoContainer:function(e,t,n,r){E.validateCallback(r,"ReactDOM.render"),y.isValidElement(t)?void 0:P(!1);var a=y(L,null,null,null,null,null,t),u=p(n);if(u){var s=u._currentElement,c=s.props;if(S(c,t)){var d=u._renderedComponent.getPublicInstance(),f=r&&function(){r.call(d)};return U._updateRootComponent(u,a,n,f),d}U.unmountComponentAtNode(n)}var h=o(n),v=h&&!!i(h),m=l(n),g=v&&!u&&!m,C=U._renderNewRootComponent(a,n,g,null!=e?e._reactInternalInstance._processChildContext(e._reactInternalInstance._context):N)._renderedComponent.getPublicInstance();return r&&r.call(C),C},render:function(e,t,n){return U._renderSubtreeIntoContainer(null,e,t,n)},unmountComponentAtNode:function(e){!e||e.nodeType!==R&&e.nodeType!==D&&e.nodeType!==I?P(!1):void 0;var t=p(e);return t?(delete O[t._instance.rootID],x.batchedUpdates(s,t,e,!1),!0):(l(e),1===e.nodeType&&e.hasAttribute(k),!1)},_mountImageIntoNode:function(e,t,n,i,a){if(!t||t.nodeType!==R&&t.nodeType!==D&&t.nodeType!==I?P(!1):void 0,i){var u=o(t);if(b.canReuseMarkup(e,u))return void v.precacheNode(n,u);var s=u.getAttribute(b.CHECKSUM_ATTR_NAME);u.removeAttribute(b.CHECKSUM_ATTR_NAME);var l=u.outerHTML;u.setAttribute(b.CHECKSUM_ATTR_NAME,s);var c=e,p=r(c,l);" (client) "+c.substring(p-20,p+20)+"\n (server) "+l.substring(p-20,p+20),t.nodeType===D?P(!1):void 0}if(t.nodeType===D?P(!1):void 0,a.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);d.insertTreeBefore(t,e,null)}else w(t,e),v.precacheNode(n,t.firstChild)}};t.exports=U},{10:10,128:128,134:134,136:136,147:147,154:154,164:164,27:27,35:35,40:40,41:41,45:45,60:60,66:66,70:70,71:71,8:8,83:83,89:89,90:90}],73:[function(e,t,n){"use strict";function r(e,t,n){return{type:p.INSERT_MARKUP,content:e,fromIndex:null,fromNode:null,toIndex:n,afterNode:t}}function o(e,t,n){return{type:p.MOVE_EXISTING,content:null,fromIndex:e._mountIndex,fromNode:d.getNativeNode(e),toIndex:n,afterNode:t}}function i(e,t){return{type:p.REMOVE_NODE,content:null,fromIndex:e._mountIndex,fromNode:t,toIndex:null,afterNode:null}}function a(e){return{type:p.SET_MARKUP,content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function u(e){return{type:p.TEXT_CONTENT,content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function s(e,t){return t&&(e=e||[],e.push(t)),e}function l(e,t){c.processChildrenUpdates(e,t)}var c=e(33),p=(e(70),e(74)),d=(e(35),e(83)),f=e(28),h=(e(146),e(117)),v=e(154),m={Mixin:{_reconcilerInstantiateChildren:function(e,t,n){return f.instantiateChildren(e,t,n)},_reconcilerUpdateChildren:function(e,t,n,r,o){var i;return i=h(t),f.updateChildren(e,i,n,r,o),i},mountChildren:function(e,t,n){var r=this._reconcilerInstantiateChildren(e,t,n);this._renderedChildren=r;var o=[],i=0;for(var a in r)if(r.hasOwnProperty(a)){var u=r[a],s=d.mountComponent(u,t,this,this._nativeContainerInfo,n);u._mountIndex=i++,o.push(s)}return o},updateTextContent:function(e){var t=this._renderedChildren;f.unmountChildren(t,!1);for(var n in t)t.hasOwnProperty(n)&&v(!1);var r=[u(e)];l(this,r)},updateMarkup:function(e){var t=this._renderedChildren;f.unmountChildren(t,!1);for(var n in t)t.hasOwnProperty(n)&&v(!1);var r=[a(e)];l(this,r)},updateChildren:function(e,t,n){this._updateChildren(e,t,n)},_updateChildren:function(e,t,n){var r=this._renderedChildren,o={},i=this._reconcilerUpdateChildren(r,e,o,t,n);if(i||r){var a,u=null,c=0,p=0,f=null;for(a in i)if(i.hasOwnProperty(a)){var h=r&&r[a],v=i[a];h===v?(u=s(u,this.moveChild(h,f,p,c)),c=Math.max(h._mountIndex,c),h._mountIndex=p):(h&&(c=Math.max(h._mountIndex,c)),u=s(u,this._mountChildAtIndex(v,f,p,t,n))),p++,f=d.getNativeNode(v)}for(a in o)o.hasOwnProperty(a)&&(u=s(u,this._unmountChild(r[a],o[a])));u&&l(this,u),this._renderedChildren=i}},unmountChildren:function(e){var t=this._renderedChildren;f.unmountChildren(t,e),this._renderedChildren=null},moveChild:function(e,t,n,r){return e._mountIndex<r?o(e,t,n):void 0},createChild:function(e,t,n){return r(n,t,e._mountIndex)},removeChild:function(e,t){return i(e,t)},_mountChildAtIndex:function(e,t,n,r,o){var i=d.mountComponent(e,r,this,this._nativeContainerInfo,o);return e._mountIndex=n,this.createChild(e,t,i)},_unmountChild:function(e,t){var n=this.removeChild(e,t);return e._mountIndex=null,n}}};t.exports=m},{117:117,146:146,154:154,28:28,33:33,35:35,70:70,74:74,83:83}],74:[function(e,t,n){"use strict";var r=e(157),o=r({INSERT_MARKUP:null,MOVE_EXISTING:null,REMOVE_NODE:null,SET_MARKUP:null,TEXT_CONTENT:null});t.exports=o},{157:157}],75:[function(e,t,n){"use strict";function r(e){if("function"==typeof e.type)return e.type;var t=e.type,n=p[t];return null==n&&(p[t]=n=l(t)),n}function o(e){return c?void 0:s(!1),new c(e)}function i(e){return new d(e)}function a(e){return e instanceof d}var u=e(165),s=e(154),l=null,c=null,p={},d=null,f={injectGenericComponentClass:function(e){c=e},injectTextComponentClass:function(e){d=e},injectComponentClasses:function(e){u(p,e)}},h={getComponentClassForElement:r,createInternalComponent:o,createInstanceForText:i,isTextComponent:a,injection:f};t.exports=h},{154:154,165:165}],76:[function(e,t,n){"use strict";var r=e(60),o=e(154),i={NATIVE:0,COMPOSITE:1,EMPTY:2,getType:function(e){return null===e||e===!1?i.EMPTY:r.isValidElement(e)?"function"==typeof e.type?i.COMPOSITE:i.NATIVE:void o(!1)}};t.exports=i},{154:154,60:60}],77:[function(e,t,n){"use strict";function r(e,t){}var o=(e(164),{isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){r(e,"forceUpdate")},enqueueReplaceState:function(e,t){r(e,"replaceState")},enqueueSetState:function(e,t){r(e,"setState")}});t.exports=o},{164:164}],78:[function(e,t,n){"use strict";var r=e(154),o={isValidOwner:function(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)},addComponentAsRefTo:function(e,t,n){o.isValidOwner(n)?void 0:r(!1),n.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,n){o.isValidOwner(n)?void 0:r(!1);var i=n.getPublicInstance();i&&i.refs[t]===e.getPublicInstance()&&n.detachRef(t)}};t.exports=o},{154:154}],79:[function(e,t,n){"use strict";var r={};t.exports=r},{}],80:[function(e,t,n){"use strict";var r=e(157),o=r({prop:null,context:null,childContext:null});t.exports=o},{157:157}],81:[function(e,t,n){"use strict";function r(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function o(e){function t(t,n,r,o,i,a){if(o=o||x,a=a||r,null==n[r]){var u=b[i];return t?new Error("Required "+u+" `"+a+"` was not specified in "+("`"+o+"`.")):null}return e(n,r,o,i,a)}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}function i(e){function t(t,n,r,o,i){var a=t[n],u=m(a);if(u!==e){var s=b[o],l=g(a);return new Error("Invalid "+s+" `"+i+"` of type "+("`"+l+"` supplied to `"+r+"`, expected ")+("`"+e+"`."))}return null}return o(t)}function a(){return o(_.thatReturns(null))}function u(e){function t(t,n,r,o,i){if("function"!=typeof e)return new Error("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside arrayOf.");var a=t[n];if(!Array.isArray(a)){var u=b[o],s=m(a);return new Error("Invalid "+u+" `"+i+"` of type "+("`"+s+"` supplied to `"+r+"`, expected an array."))}for(var l=0;l<a.length;l++){var c=e(a,l,r,o,i+"["+l+"]");if(c instanceof Error)return c}return null}return o(t)}function s(){function e(e,t,n,r,o){
if(!C.isValidElement(e[t])){var i=b[r];return new Error("Invalid "+i+" `"+o+"` supplied to "+("`"+n+"`, expected a single ReactElement."))}return null}return o(e)}function l(e){function t(t,n,r,o,i){if(!(t[n]instanceof e)){var a=b[o],u=e.name||x,s=y(t[n]);return new Error("Invalid "+a+" `"+i+"` of type "+("`"+s+"` supplied to `"+r+"`, expected ")+("instance of `"+u+"`."))}return null}return o(t)}function c(e){function t(t,n,o,i,a){for(var u=t[n],s=0;s<e.length;s++)if(r(u,e[s]))return null;var l=b[i],c=JSON.stringify(e);return new Error("Invalid "+l+" `"+a+"` of value `"+u+"` "+("supplied to `"+o+"`, expected one of "+c+"."))}return o(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOf, expected an instance of array.")})}function p(e){function t(t,n,r,o,i){if("function"!=typeof e)return new Error("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var a=t[n],u=m(a);if("object"!==u){var s=b[o];return new Error("Invalid "+s+" `"+i+"` of type "+("`"+u+"` supplied to `"+r+"`, expected an object."))}for(var l in a)if(a.hasOwnProperty(l)){var c=e(a,l,r,o,i+"."+l);if(c instanceof Error)return c}return null}return o(t)}function d(e){function t(t,n,r,o,i){for(var a=0;a<e.length;a++){var u=e[a];if(null==u(t,n,r,o,i))return null}var s=b[o];return new Error("Invalid "+s+" `"+i+"` supplied to "+("`"+r+"`."))}return o(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOfType, expected an instance of array.")})}function f(){function e(e,t,n,r,o){if(!v(e[t])){var i=b[r];return new Error("Invalid "+i+" `"+o+"` supplied to "+("`"+n+"`, expected a ReactNode."))}return null}return o(e)}function h(e){function t(t,n,r,o,i){var a=t[n],u=m(a);if("object"!==u){var s=b[o];return new Error("Invalid "+s+" `"+i+"` of type `"+u+"` "+("supplied to `"+r+"`, expected `object`."))}for(var l in e){var c=e[l];if(c){var p=c(a,l,r,o,i+"."+l);if(p)return p}}return null}return o(t)}function v(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(v);if(null===e||C.isValidElement(e))return!0;var t=E(e);if(!t)return!1;var n,r=t.call(e);if(t!==e.entries){for(;!(n=r.next()).done;)if(!v(n.value))return!1}else for(;!(n=r.next()).done;){var o=n.value;if(o&&!v(o[1]))return!1}return!0;default:return!1}}function m(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":t}function g(e){var t=m(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function y(e){return e.constructor&&e.constructor.name?e.constructor.name:x}var C=e(60),b=e(79),_=e(146),E=e(123),x="<<anonymous>>",N={array:i("array"),bool:i("boolean"),func:i("function"),number:i("number"),object:i("object"),string:i("string"),any:a(),arrayOf:u,element:s(),instanceOf:l,node:f(),objectOf:p,oneOf:c,oneOfType:d,shape:h};t.exports=N},{123:123,146:146,60:60,79:79}],82:[function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=i.getPooled(null),this.useCreateElement=e}var o=e(165),i=e(5),a=e(25),u=e(27),s=e(68),l=e(108),c={initialize:s.getSelectionInformation,close:s.restoreSelection},p={initialize:function(){var e=u.isEnabled();return u.setEnabled(!1),e},close:function(e){u.setEnabled(e)}},d={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},f=[c,p,d],h={getTransactionWrappers:function(){return f},getReactMountReady:function(){return this.reactMountReady},checkpoint:function(){return this.reactMountReady.checkpoint()},rollback:function(e){this.reactMountReady.rollback(e)},destructor:function(){i.release(this.reactMountReady),this.reactMountReady=null}};o(r.prototype,l.Mixin,h),a.addPoolingTo(r),t.exports=r},{108:108,165:165,25:25,27:27,5:5,68:68}],83:[function(e,t,n){"use strict";function r(){o.attachRefs(this,this._currentElement)}var o=e(84),i=(e(70),e(154)),a={mountComponent:function(e,t,n,o,i){var a=e.mountComponent(t,n,o,i);return e._currentElement&&null!=e._currentElement.ref&&t.getReactMountReady().enqueue(r,e),a},getNativeNode:function(e){return e.getNativeNode()},unmountComponent:function(e,t){o.detachRefs(e,e._currentElement),e.unmountComponent(t)},receiveComponent:function(e,t,n,i){var a=e._currentElement;if(t!==a||i!==e._context){var u=o.shouldUpdateRefs(a,t);u&&o.detachRefs(e,a),e.receiveComponent(t,n,i),u&&e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e)}},performUpdateIfNecessary:function(e,t,n){return e._updateBatchNumber!==n?void(null!=e._updateBatchNumber&&e._updateBatchNumber!==n+1?i(!1):void 0):void e.performUpdateIfNecessary(t)}};t.exports=a},{154:154,70:70,84:84}],84:[function(e,t,n){"use strict";function r(e,t,n){"function"==typeof e?e(t.getPublicInstance()):i.addComponentAsRefTo(t,e,n)}function o(e,t,n){"function"==typeof e?e(null):i.removeComponentAsRefFrom(t,e,n)}var i=e(78),a={};a.attachRefs=function(e,t){if(null!==t&&t!==!1){var n=t.ref;null!=n&&r(n,e,t._owner)}},a.shouldUpdateRefs=function(e,t){var n=null===e||e===!1,r=null===t||t===!1;return n||r||t._owner!==e._owner||t.ref!==e.ref},a.detachRefs=function(e,t){if(null!==t&&t!==!1){var n=t.ref;null!=n&&o(n,e,t._owner)}},t.exports=a},{78:78}],85:[function(e,t,n){"use strict";var r={isBatchingUpdates:!1,batchedUpdates:function(e){}};t.exports=r},{}],86:[function(e,t,n){"use strict";function r(e,t){var n;try{return f.injection.injectBatchingStrategy(p),n=d.getPooled(t),n.perform(function(){var r=v(e),o=c.mountComponent(r,n,null,a(),h);return t||(o=l.addChecksumToMarkup(o)),o},null)}finally{d.release(n),f.injection.injectBatchingStrategy(u)}}function o(e){return s.isValidElement(e)?void 0:m(!1),r(e,!1)}function i(e){return s.isValidElement(e)?void 0:m(!1),r(e,!0)}var a=e(41),u=e(58),s=e(60),l=(e(70),e(71)),c=e(83),p=e(85),d=e(87),f=e(90),h=e(147),v=e(128),m=e(154);t.exports={renderToString:o,renderToStaticMarkup:i}},{128:128,147:147,154:154,41:41,58:58,60:60,70:70,71:71,83:83,85:85,87:87,90:90}],87:[function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.useCreateElement=!1}var o=e(165),i=e(25),a=e(108),u=[],s={enqueue:function(){}},l={getTransactionWrappers:function(){return u},getReactMountReady:function(){return s},destructor:function(){},checkpoint:function(){},rollback:function(){}};o(r.prototype,a.Mixin,l),i.addPoolingTo(r),t.exports=r},{108:108,165:165,25:25}],88:[function(e,t,n){"use strict";var r=e(165),o=e(36),i=e(52),a=e(26),u=r({__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:o,__SECRET_DOM_SERVER_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:i},a);t.exports=u},{165:165,26:26,36:36,52:52}],89:[function(e,t,n){"use strict";function r(e){a.enqueueUpdate(e)}function o(e,t){var n=i.get(e);return n?n:null}var i=(e(35),e(69)),a=e(90),u=e(154),s=(e(164),{isMounted:function(e){var t=i.get(e);return t?!!t._renderedComponent:!1},enqueueCallback:function(e,t,n){s.validateCallback(t,n);var i=o(e);return i?(i._pendingCallbacks?i._pendingCallbacks.push(t):i._pendingCallbacks=[t],void r(i)):null},enqueueCallbackInternal:function(e,t){e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],r(e)},enqueueForceUpdate:function(e){var t=o(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,r(t))},enqueueReplaceState:function(e,t){var n=o(e,"replaceState");n&&(n._pendingStateQueue=[t],n._pendingReplaceState=!0,r(n))},enqueueSetState:function(e,t){var n=o(e,"setState");if(n){var i=n._pendingStateQueue||(n._pendingStateQueue=[]);i.push(t),r(n)}},enqueueElementInternal:function(e,t){e._pendingElement=t,r(e)},validateCallback:function(e,t){e&&"function"!=typeof e?u(!1):void 0}});t.exports=s},{154:154,164:164,35:35,69:69,90:90}],90:[function(e,t,n){"use strict";function r(){w.ReactReconcileTransaction&&_?void 0:m(!1)}function o(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=p.getPooled(),this.reconcileTransaction=w.ReactReconcileTransaction.getPooled(!0)}function i(e,t,n,o,i,a){r(),_.batchedUpdates(e,t,n,o,i,a)}function a(e,t){return e._mountOrder-t._mountOrder}function u(e){var t=e.dirtyComponentsLength;t!==g.length?m(!1):void 0,g.sort(a),y++;for(var n=0;t>n;n++){var r=g[n],o=r._pendingCallbacks;r._pendingCallbacks=null;var i;if(f.logTopLevelRenders){var u=r;r._currentElement.props===r._renderedComponent._currentElement&&(u=r._renderedComponent),i="React update: "+u.getName(),console.time(i)}if(h.performUpdateIfNecessary(r,e.reconcileTransaction,y),i&&console.timeEnd(i),o)for(var s=0;s<o.length;s++)e.callbackQueue.enqueue(o[s],r.getPublicInstance())}}function s(e){return r(),_.isBatchingUpdates?(g.push(e),void(null==e._updateBatchNumber&&(e._updateBatchNumber=y+1))):void _.batchedUpdates(s,e)}function l(e,t){_.isBatchingUpdates?void 0:m(!1),C.enqueue(e,t),b=!0}var c=e(165),p=e(5),d=e(25),f=e(66),h=(e(70),e(83)),v=e(108),m=e(154),g=[],y=0,C=p.getPooled(),b=!1,_=null,E={initialize:function(){this.dirtyComponentsLength=g.length},close:function(){this.dirtyComponentsLength!==g.length?(g.splice(0,this.dirtyComponentsLength),T()):g.length=0}},x={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},N=[E,x];c(o.prototype,v.Mixin,{getTransactionWrappers:function(){return N},destructor:function(){this.dirtyComponentsLength=null,p.release(this.callbackQueue),this.callbackQueue=null,w.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return v.Mixin.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)}}),d.addPoolingTo(o);var T=function(){for(;g.length||b;){if(g.length){var e=o.getPooled();e.perform(u,null,e),o.release(e)}if(b){b=!1;var t=C;C=p.getPooled(),t.notifyAll(),p.release(t)}}},P={injectReconcileTransaction:function(e){e?void 0:m(!1),w.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e?void 0:m(!1),"function"!=typeof e.batchedUpdates?m(!1):void 0,"boolean"!=typeof e.isBatchingUpdates?m(!1):void 0,_=e}},w={ReactReconcileTransaction:null,batchedUpdates:i,enqueueUpdate:s,flushBatchedUpdates:T,injection:P,asap:l};t.exports=w},{108:108,154:154,165:165,25:25,5:5,66:66,70:70,83:83}],91:[function(e,t,n){"use strict";t.exports="15.1.0"},{}],92:[function(e,t,n){"use strict";var r={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},o={accentHeight:"accent-height",accumulate:0,additive:0,alignmentBaseline:"alignment-baseline",allowReorder:"allowReorder",alphabetic:0,amplitude:0,arabicForm:"arabic-form",ascent:0,attributeName:"attributeName",attributeType:"attributeType",autoReverse:"autoReverse",azimuth:0,baseFrequency:"baseFrequency",baseProfile:"baseProfile",baselineShift:"baseline-shift",bbox:0,begin:0,bias:0,by:0,calcMode:"calcMode",capHeight:"cap-height",clip:0,clipPath:"clip-path",clipRule:"clip-rule",clipPathUnits:"clipPathUnits",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",contentScriptType:"contentScriptType",contentStyleType:"contentStyleType",cursor:0,cx:0,cy:0,d:0,decelerate:0,descent:0,diffuseConstant:"diffuseConstant",direction:0,display:0,divisor:0,dominantBaseline:"dominant-baseline",dur:0,dx:0,dy:0,edgeMode:"edgeMode",elevation:0,enableBackground:"enable-background",end:0,exponent:0,externalResourcesRequired:"externalResourcesRequired",fill:0,fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:0,filterRes:"filterRes",filterUnits:"filterUnits",floodColor:"flood-color",floodOpacity:"flood-opacity",focusable:0,fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",glyphRef:"glyphRef",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",hanging:0,horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",ideographic:0,imageRendering:"image-rendering","in":0,in2:0,intercept:0,k:0,k1:0,k2:0,k3:0,k4:0,kernelMatrix:"kernelMatrix",kernelUnitLength:"kernelUnitLength",kerning:0,keyPoints:"keyPoints",keySplines:"keySplines",keyTimes:"keyTimes",lengthAdjust:"lengthAdjust",letterSpacing:"letter-spacing",lightingColor:"lighting-color",limitingConeAngle:"limitingConeAngle",local:0,markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",markerHeight:"markerHeight",markerUnits:"markerUnits",markerWidth:"markerWidth",mask:0,maskContentUnits:"maskContentUnits",maskUnits:"maskUnits",mathematical:0,mode:0,numOctaves:"numOctaves",offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pathLength:"pathLength",patternContentUnits:"patternContentUnits",patternTransform:"patternTransform",patternUnits:"patternUnits",pointerEvents:"pointer-events",points:0,pointsAtX:"pointsAtX",pointsAtY:"pointsAtY",pointsAtZ:"pointsAtZ",preserveAlpha:"preserveAlpha",preserveAspectRatio:"preserveAspectRatio",primitiveUnits:"primitiveUnits",r:0,radius:0,refX:"refX",refY:"refY",renderingIntent:"rendering-intent",repeatCount:"repeatCount",repeatDur:"repeatDur",requiredExtensions:"requiredExtensions",requiredFeatures:"requiredFeatures",restart:0,result:0,rotate:0,rx:0,ry:0,scale:0,seed:0,shapeRendering:"shape-rendering",slope:0,spacing:0,specularConstant:"specularConstant",specularExponent:"specularExponent",speed:0,spreadMethod:"spreadMethod",startOffset:"startOffset",stdDeviation:"stdDeviation",stemh:0,stemv:0,stitchTiles:"stitchTiles",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",string:0,stroke:0,strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",surfaceScale:"surfaceScale",systemLanguage:"systemLanguage",tableValues:"tableValues",targetX:"targetX",targetY:"targetY",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",textLength:"textLength",to:0,transform:0,u1:0,u2:0,underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicode:0,unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",values:0,vectorEffect:"vector-effect",version:0,vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",viewBox:"viewBox",viewTarget:"viewTarget",visibility:0,widths:0,wordSpacing:"word-spacing",writingMode:"writing-mode",x:0,xHeight:"x-height",x1:0,x2:0,xChannelSelector:"xChannelSelector",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlLang:"xml:lang",xmlSpace:"xml:space",y:0,y1:0,y2:0,yChannelSelector:"yChannelSelector",z:0,zoomAndPan:"zoomAndPan"},i={Properties:{},DOMAttributeNamespaces:{xlinkActuate:r.xlink,xlinkArcrole:r.xlink,xlinkHref:r.xlink,xlinkRole:r.xlink,xlinkShow:r.xlink,xlinkTitle:r.xlink,xlinkType:r.xlink,xmlBase:r.xml,xmlLang:r.xml,xmlSpace:r.xml},DOMAttributeNames:{}};Object.keys(o).forEach(function(e){i.Properties[e]=0,o[e]&&(i.DOMAttributeNames[e]=o[e])}),t.exports=i},{}],93:[function(e,t,n){"use strict";function r(e){if("selectionStart"in e&&l.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}function o(e,t){if(_||null==y||y!==p())return null;var n=r(y);if(!b||!h(b,n)){b=n;var o=c.getPooled(g.select,C,e,t);return o.type="select",o.target=y,a.accumulateTwoPhaseDispatches(o),o}return null}var i=e(16),a=e(20),u=e(140),s=e(40),l=e(68),c=e(99),p=e(149),d=e(130),f=e(158),h=e(163),v=i.topLevelTypes,m=u.canUseDOM&&"documentMode"in document&&document.documentMode<=11,g={select:{phasedRegistrationNames:{bubbled:f({onSelect:null}),captured:f({onSelectCapture:null})},dependencies:[v.topBlur,v.topContextMenu,v.topFocus,v.topKeyDown,v.topMouseDown,v.topMouseUp,v.topSelectionChange]}},y=null,C=null,b=null,_=!1,E=!1,x=f({onSelect:null}),N={eventTypes:g,extractEvents:function(e,t,n,r){if(!E)return null;var i=t?s.getNodeFromInstance(t):window;switch(e){case v.topFocus:(d(i)||"true"===i.contentEditable)&&(y=i,C=t,b=null);break;case v.topBlur:y=null,C=null,b=null;break;case v.topMouseDown:_=!0;break;case v.topContextMenu:case v.topMouseUp:return _=!1,o(n,r);case v.topSelectionChange:if(m)break;case v.topKeyDown:case v.topKeyUp:return o(n,r)}return null},didPutListener:function(e,t,n){t===x&&(E=!0)}};t.exports=N},{130:130,140:140,149:149,158:158,16:16,163:163,20:20,40:40,68:68,99:99}],94:[function(e,t,n){"use strict";var r=e(16),o=e(139),i=e(20),a=e(40),u=e(95),s=e(96),l=e(99),c=e(100),p=e(102),d=e(103),f=e(98),h=e(104),v=e(105),m=e(106),g=e(107),y=e(146),C=e(119),b=e(154),_=e(158),E=r.topLevelTypes,x={abort:{phasedRegistrationNames:{bubbled:_({onAbort:!0}),captured:_({onAbortCapture:!0})}},animationEnd:{phasedRegistrationNames:{bubbled:_({onAnimationEnd:!0}),captured:_({onAnimationEndCapture:!0})}},animationIteration:{phasedRegistrationNames:{bubbled:_({onAnimationIteration:!0}),captured:_({onAnimationIterationCapture:!0})}},animationStart:{phasedRegistrationNames:{bubbled:_({onAnimationStart:!0}),captured:_({onAnimationStartCapture:!0})}},blur:{phasedRegistrationNames:{bubbled:_({onBlur:!0}),captured:_({onBlurCapture:!0})}},canPlay:{phasedRegistrationNames:{bubbled:_({onCanPlay:!0}),captured:_({onCanPlayCapture:!0})}},canPlayThrough:{phasedRegistrationNames:{bubbled:_({onCanPlayThrough:!0}),captured:_({onCanPlayThroughCapture:!0})}},click:{phasedRegistrationNames:{bubbled:_({onClick:!0}),captured:_({onClickCapture:!0})}},contextMenu:{phasedRegistrationNames:{bubbled:_({onContextMenu:!0}),captured:_({onContextMenuCapture:!0})}},copy:{phasedRegistrationNames:{bubbled:_({onCopy:!0}),captured:_({onCopyCapture:!0})}},cut:{phasedRegistrationNames:{bubbled:_({onCut:!0}),captured:_({onCutCapture:!0})}},doubleClick:{phasedRegistrationNames:{bubbled:_({onDoubleClick:!0}),captured:_({onDoubleClickCapture:!0})}},drag:{phasedRegistrationNames:{bubbled:_({onDrag:!0}),captured:_({onDragCapture:!0})}},dragEnd:{phasedRegistrationNames:{bubbled:_({onDragEnd:!0}),captured:_({onDragEndCapture:!0})}},dragEnter:{phasedRegistrationNames:{bubbled:_({onDragEnter:!0}),captured:_({onDragEnterCapture:!0})}},dragExit:{phasedRegistrationNames:{bubbled:_({onDragExit:!0}),captured:_({onDragExitCapture:!0})}},dragLeave:{phasedRegistrationNames:{bubbled:_({onDragLeave:!0}),captured:_({onDragLeaveCapture:!0})}},dragOver:{phasedRegistrationNames:{bubbled:_({onDragOver:!0}),captured:_({onDragOverCapture:!0})}},dragStart:{phasedRegistrationNames:{bubbled:_({onDragStart:!0}),captured:_({onDragStartCapture:!0})}},drop:{phasedRegistrationNames:{bubbled:_({onDrop:!0}),captured:_({onDropCapture:!0})}},durationChange:{phasedRegistrationNames:{bubbled:_({onDurationChange:!0}),captured:_({onDurationChangeCapture:!0})}},emptied:{phasedRegistrationNames:{bubbled:_({onEmptied:!0}),captured:_({onEmptiedCapture:!0})}},encrypted:{phasedRegistrationNames:{bubbled:_({onEncrypted:!0}),captured:_({onEncryptedCapture:!0})}},ended:{phasedRegistrationNames:{bubbled:_({onEnded:!0}),captured:_({onEndedCapture:!0})}},error:{phasedRegistrationNames:{bubbled:_({onError:!0}),captured:_({onErrorCapture:!0})}},focus:{phasedRegistrationNames:{bubbled:_({onFocus:!0}),captured:_({onFocusCapture:!0})}},input:{phasedRegistrationNames:{bubbled:_({onInput:!0}),captured:_({onInputCapture:!0})}},invalid:{phasedRegistrationNames:{bubbled:_({onInvalid:!0}),captured:_({onInvalidCapture:!0})}},keyDown:{phasedRegistrationNames:{bubbled:_({onKeyDown:!0}),captured:_({onKeyDownCapture:!0})}},keyPress:{phasedRegistrationNames:{bubbled:_({onKeyPress:!0}),captured:_({onKeyPressCapture:!0})}},keyUp:{phasedRegistrationNames:{bubbled:_({onKeyUp:!0}),captured:_({onKeyUpCapture:!0})}},load:{phasedRegistrationNames:{bubbled:_({onLoad:!0}),captured:_({onLoadCapture:!0})}},loadedData:{phasedRegistrationNames:{bubbled:_({onLoadedData:!0}),captured:_({onLoadedDataCapture:!0})}},loadedMetadata:{phasedRegistrationNames:{bubbled:_({onLoadedMetadata:!0}),captured:_({onLoadedMetadataCapture:!0})}},loadStart:{phasedRegistrationNames:{bubbled:_({onLoadStart:!0}),captured:_({onLoadStartCapture:!0})}},mouseDown:{phasedRegistrationNames:{bubbled:_({onMouseDown:!0}),captured:_({onMouseDownCapture:!0})}},mouseMove:{phasedRegistrationNames:{bubbled:_({onMouseMove:!0}),captured:_({onMouseMoveCapture:!0})}},mouseOut:{phasedRegistrationNames:{bubbled:_({onMouseOut:!0}),captured:_({onMouseOutCapture:!0})}},mouseOver:{phasedRegistrationNames:{bubbled:_({onMouseOver:!0}),captured:_({onMouseOverCapture:!0})}},mouseUp:{phasedRegistrationNames:{bubbled:_({onMouseUp:!0}),captured:_({onMouseUpCapture:!0})}},paste:{phasedRegistrationNames:{bubbled:_({onPaste:!0}),captured:_({onPasteCapture:!0})}},pause:{phasedRegistrationNames:{bubbled:_({onPause:!0}),captured:_({onPauseCapture:!0})}},play:{phasedRegistrationNames:{bubbled:_({onPlay:!0}),captured:_({onPlayCapture:!0})}},playing:{phasedRegistrationNames:{bubbled:_({onPlaying:!0}),captured:_({onPlayingCapture:!0})}},progress:{phasedRegistrationNames:{bubbled:_({onProgress:!0}),captured:_({onProgressCapture:!0})}},rateChange:{phasedRegistrationNames:{bubbled:_({onRateChange:!0}),captured:_({onRateChangeCapture:!0})}},reset:{phasedRegistrationNames:{bubbled:_({onReset:!0}),captured:_({onResetCapture:!0})}},scroll:{phasedRegistrationNames:{bubbled:_({onScroll:!0}),captured:_({onScrollCapture:!0})}},seeked:{phasedRegistrationNames:{bubbled:_({onSeeked:!0}),captured:_({onSeekedCapture:!0})}},seeking:{phasedRegistrationNames:{bubbled:_({onSeeking:!0}),captured:_({onSeekingCapture:!0})}},stalled:{phasedRegistrationNames:{bubbled:_({onStalled:!0}),captured:_({onStalledCapture:!0})}},submit:{phasedRegistrationNames:{bubbled:_({onSubmit:!0}),captured:_({onSubmitCapture:!0})}},suspend:{phasedRegistrationNames:{bubbled:_({onSuspend:!0}),captured:_({onSuspendCapture:!0})}},timeUpdate:{phasedRegistrationNames:{bubbled:_({onTimeUpdate:!0}),captured:_({onTimeUpdateCapture:!0})}},touchCancel:{phasedRegistrationNames:{bubbled:_({onTouchCancel:!0}),captured:_({onTouchCancelCapture:!0})}},touchEnd:{phasedRegistrationNames:{bubbled:_({onTouchEnd:!0}),captured:_({onTouchEndCapture:!0})}},touchMove:{phasedRegistrationNames:{bubbled:_({onTouchMove:!0}),captured:_({onTouchMoveCapture:!0})}},touchStart:{phasedRegistrationNames:{bubbled:_({onTouchStart:!0}),captured:_({onTouchStartCapture:!0})}},transitionEnd:{phasedRegistrationNames:{bubbled:_({onTransitionEnd:!0}),captured:_({onTransitionEndCapture:!0})}},volumeChange:{phasedRegistrationNames:{bubbled:_({onVolumeChange:!0}),captured:_({onVolumeChangeCapture:!0})}},waiting:{phasedRegistrationNames:{bubbled:_({onWaiting:!0}),captured:_({onWaitingCapture:!0})}},wheel:{phasedRegistrationNames:{bubbled:_({onWheel:!0}),captured:_({onWheelCapture:!0})}}},N={topAbort:x.abort,topAnimationEnd:x.animationEnd,topAnimationIteration:x.animationIteration,topAnimationStart:x.animationStart,topBlur:x.blur,topCanPlay:x.canPlay,topCanPlayThrough:x.canPlayThrough,topClick:x.click,topContextMenu:x.contextMenu,topCopy:x.copy,topCut:x.cut,topDoubleClick:x.doubleClick,topDrag:x.drag,topDragEnd:x.dragEnd,topDragEnter:x.dragEnter,topDragExit:x.dragExit,topDragLeave:x.dragLeave,topDragOver:x.dragOver,topDragStart:x.dragStart,topDrop:x.drop,topDurationChange:x.durationChange,topEmptied:x.emptied,topEncrypted:x.encrypted,topEnded:x.ended,topError:x.error,topFocus:x.focus,topInput:x.input,topInvalid:x.invalid,topKeyDown:x.keyDown,topKeyPress:x.keyPress,topKeyUp:x.keyUp,topLoad:x.load,topLoadedData:x.loadedData,topLoadedMetadata:x.loadedMetadata,topLoadStart:x.loadStart,topMouseDown:x.mouseDown,topMouseMove:x.mouseMove,topMouseOut:x.mouseOut,topMouseOver:x.mouseOver,topMouseUp:x.mouseUp,topPaste:x.paste,topPause:x.pause,topPlay:x.play,topPlaying:x.playing,topProgress:x.progress,topRateChange:x.rateChange,topReset:x.reset,topScroll:x.scroll,topSeeked:x.seeked,topSeeking:x.seeking,topStalled:x.stalled,topSubmit:x.submit,topSuspend:x.suspend,topTimeUpdate:x.timeUpdate,topTouchCancel:x.touchCancel,topTouchEnd:x.touchEnd,topTouchMove:x.touchMove,topTouchStart:x.touchStart,topTransitionEnd:x.transitionEnd,topVolumeChange:x.volumeChange,topWaiting:x.waiting,topWheel:x.wheel};for(var T in N)N[T].dependencies=[T];var P=_({onClick:null}),w={},S={eventTypes:x,extractEvents:function(e,t,n,r){var o=N[e];if(!o)return null;var a;switch(e){case E.topAbort:case E.topCanPlay:case E.topCanPlayThrough:case E.topDurationChange:case E.topEmptied:case E.topEncrypted:case E.topEnded:case E.topError:case E.topInput:case E.topInvalid:case E.topLoad:case E.topLoadedData:case E.topLoadedMetadata:case E.topLoadStart:case E.topPause:case E.topPlay:case E.topPlaying:case E.topProgress:case E.topRateChange:case E.topReset:case E.topSeeked:case E.topSeeking:case E.topStalled:case E.topSubmit:case E.topSuspend:case E.topTimeUpdate:case E.topVolumeChange:case E.topWaiting:a=l;break;case E.topKeyPress:if(0===C(n))return null;case E.topKeyDown:case E.topKeyUp:a=p;break;case E.topBlur:case E.topFocus:a=c;break;case E.topClick:if(2===n.button)return null;case E.topContextMenu:case E.topDoubleClick:case E.topMouseDown:case E.topMouseMove:case E.topMouseOut:case E.topMouseOver:case E.topMouseUp:a=d;break;case E.topDrag:case E.topDragEnd:case E.topDragEnter:case E.topDragExit:case E.topDragLeave:case E.topDragOver:case E.topDragStart:case E.topDrop:a=f;break;case E.topTouchCancel:case E.topTouchEnd:case E.topTouchMove:case E.topTouchStart:a=h;break;case E.topAnimationEnd:case E.topAnimationIteration:case E.topAnimationStart:a=u;break;case E.topTransitionEnd:a=v;break;case E.topScroll:a=m;break;case E.topWheel:a=g;break;case E.topCopy:case E.topCut:case E.topPaste:a=s}a?void 0:b(!1);var y=a.getPooled(o,t,n,r);return i.accumulateTwoPhaseDispatches(y),y},didPutListener:function(e,t,n){if(t===P){var r=e._rootNodeID,i=a.getNodeFromInstance(e);w[r]||(w[r]=o.listen(i,"click",y))}},willDeleteListener:function(e,t){if(t===P){var n=e._rootNodeID;w[n].remove(),delete w[n]}}};t.exports=S},{100:100,102:102,103:103,104:104,105:105,106:106,107:107,119:119,139:139,146:146,154:154,158:158,16:16,20:20,40:40,95:95,96:96,98:98,99:99}],95:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(99),i={animationName:null,elapsedTime:null,pseudoElement:null};o.augmentClass(r,i),t.exports=r},{99:99}],96:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(99),i={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};o.augmentClass(r,i),t.exports=r},{99:99}],97:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(99),i={data:null};o.augmentClass(r,i),t.exports=r},{99:99}],98:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(103),i={dataTransfer:null};o.augmentClass(r,i),t.exports=r},{103:103}],99:[function(e,t,n){"use strict";function r(e,t,n,r){this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n;var o=this.constructor.Interface;for(var i in o)if(o.hasOwnProperty(i)){var u=o[i];u?this[i]=u(n):"target"===i?this.target=r:this[i]=n[i]}var s=null!=n.defaultPrevented?n.defaultPrevented:n.returnValue===!1;return s?this.isDefaultPrevented=a.thatReturnsTrue:this.isDefaultPrevented=a.thatReturnsFalse,this.isPropagationStopped=a.thatReturnsFalse,this}var o=e(165),i=e(25),a=e(146),u=(e(164),"function"==typeof Proxy,["dispatchConfig","_targetInst","nativeEvent","isDefaultPrevented","isPropagationStopped","_dispatchListeners","_dispatchInstances"]),s={type:null,target:null,currentTarget:a.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};o(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1,this.isDefaultPrevented=a.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.isPropagationStopped=a.thatReturnsTrue)},persist:function(){this.isPersistent=a.thatReturnsTrue},isPersistent:a.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;for(var n=0;n<u.length;n++)this[u[n]]=null}}),r.Interface=s,r.augmentClass=function(e,t){var n=this,r=function(){};r.prototype=n.prototype;var a=new r;o(a,e.prototype),e.prototype=a,e.prototype.constructor=e,e.Interface=o({},n.Interface,t),e.augmentClass=n.augmentClass,i.addPoolingTo(e,i.fourArgumentPooler)},i.addPoolingTo(r,i.fourArgumentPooler),t.exports=r},{146:146,164:164,165:165,25:25}],100:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(106),i={relatedTarget:null};o.augmentClass(r,i),t.exports=r},{106:106}],101:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(99),i={data:null};o.augmentClass(r,i),t.exports=r},{99:99}],102:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(106),i=e(119),a=e(120),u=e(121),s={key:a,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:u,charCode:function(e){return"keypress"===e.type?i(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?i(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};o.augmentClass(r,s),t.exports=r},{106:106,119:119,120:120,121:121}],103:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(106),i=e(109),a=e(121),u={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:a,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+i.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+i.currentScrollTop}};o.augmentClass(r,u),t.exports=r},{106:106,109:109,121:121}],104:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(106),i=e(121),a={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:i};o.augmentClass(r,a),t.exports=r},{106:106,121:121}],105:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(99),i={propertyName:null,elapsedTime:null,pseudoElement:null};o.augmentClass(r,i),t.exports=r},{99:99}],106:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(99),i=e(122),a={view:function(e){if(e.view)return e.view;var t=i(e);if(null!=t&&t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};o.augmentClass(r,a),t.exports=r},{122:122,99:99}],107:[function(e,t,n){"use strict";function r(e,t,n,r){
return o.call(this,e,t,n,r)}var o=e(103),i={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};o.augmentClass(r,i),t.exports=r},{103:103}],108:[function(e,t,n){"use strict";var r=e(154),o={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,n,o,i,a,u,s){this.isInTransaction()?r(!1):void 0;var l,c;try{this._isInTransaction=!0,l=!0,this.initializeAll(0),c=e.call(t,n,o,i,a,u,s),l=!1}finally{try{if(l)try{this.closeAll(0)}catch(p){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return c},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var r=t[n];try{this.wrapperInitData[n]=i.OBSERVED_ERROR,this.wrapperInitData[n]=r.initialize?r.initialize.call(this):null}finally{if(this.wrapperInitData[n]===i.OBSERVED_ERROR)try{this.initializeAll(n+1)}catch(o){}}}},closeAll:function(e){this.isInTransaction()?void 0:r(!1);for(var t=this.transactionWrappers,n=e;n<t.length;n++){var o,a=t[n],u=this.wrapperInitData[n];try{o=!0,u!==i.OBSERVED_ERROR&&a.close&&a.close.call(this,u),o=!1}finally{if(o)try{this.closeAll(n+1)}catch(s){}}}this.wrapperInitData.length=0}},i={Mixin:o,OBSERVED_ERROR:{}};t.exports=i},{154:154}],109:[function(e,t,n){"use strict";var r={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){r.currentScrollLeft=e.x,r.currentScrollTop=e.y}};t.exports=r},{}],110:[function(e,t,n){"use strict";function r(e,t){if(null==t?o(!1):void 0,null==e)return t;var n=Array.isArray(e),r=Array.isArray(t);return n&&r?(e.push.apply(e,t),e):n?(e.push(t),e):r?[e].concat(t):[e,t]}var o=e(154);t.exports=r},{154:154}],111:[function(e,t,n){"use strict";function r(e){for(var t=1,n=0,r=0,i=e.length,a=-4&i;a>r;){for(var u=Math.min(r+4096,a);u>r;r+=4)n+=(t+=e.charCodeAt(r))+(t+=e.charCodeAt(r+1))+(t+=e.charCodeAt(r+2))+(t+=e.charCodeAt(r+3));t%=o,n%=o}for(;i>r;r++)n+=t+=e.charCodeAt(r);return t%=o,n%=o,t|n<<16}var o=65521;t.exports=r},{}],112:[function(e,t,n){"use strict";var r=!1;t.exports=r},{}],113:[function(e,t,n){"use strict";var r=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e};t.exports=r},{}],114:[function(e,t,n){"use strict";function r(e,t,n){var r=null==t||"boolean"==typeof t||""===t;if(r)return"";var o=isNaN(t);return o||0===t||i.hasOwnProperty(e)&&i[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var o=e(3),i=(e(164),o.isUnitlessNumber);t.exports=r},{164:164,3:3}],115:[function(e,t,n){"use strict";function r(e){return i[e]}function o(e){return(""+e).replace(a,r)}var i={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},a=/[&><"']/g;t.exports=o},{}],116:[function(e,t,n){"use strict";function r(e){if(null==e)return null;if(1===e.nodeType)return e;var t=i.get(e);return t?(t=a(t),t?o.getNodeFromInstance(t):null):void u(("function"==typeof e.render,!1))}var o=(e(35),e(40)),i=e(69),a=e(124),u=e(154);e(164);t.exports=r},{124:124,154:154,164:164,35:35,40:40,69:69}],117:[function(e,t,n){"use strict";function r(e,t,n){var r=e,o=void 0===r[n];o&&null!=t&&(r[n]=t)}function o(e){if(null==e)return e;var t={};return i(e,r,t),t}var i=(e(23),e(137));e(164);t.exports=o},{137:137,164:164,23:23}],118:[function(e,t,n){"use strict";var r=function(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)};t.exports=r},{}],119:[function(e,t,n){"use strict";function r(e){var t,n=e.keyCode;return"charCode"in e?(t=e.charCode,0===t&&13===n&&(t=13)):t=n,t>=32||13===t?t:0}t.exports=r},{}],120:[function(e,t,n){"use strict";function r(e){if(e.key){var t=i[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=o(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?a[e.keyCode]||"Unidentified":""}var o=e(119),i={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},a={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};t.exports=r},{119:119}],121:[function(e,t,n){"use strict";function r(e){var t=this,n=t.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var r=i[e];return r?!!n[r]:!1}function o(e){return r}var i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};t.exports=o},{}],122:[function(e,t,n){"use strict";function r(e){var t=e.target||e.srcElement||window;return t.correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}t.exports=r},{}],123:[function(e,t,n){"use strict";function r(e){var t=e&&(o&&e[o]||e[i]);return"function"==typeof t?t:void 0}var o="function"==typeof Symbol&&Symbol.iterator,i="@@iterator";t.exports=r},{}],124:[function(e,t,n){"use strict";function r(e){for(var t;(t=e._renderedNodeType)===o.COMPOSITE;)e=e._renderedComponent;return t===o.NATIVE?e._renderedComponent:t===o.EMPTY?null:void 0}var o=e(76);t.exports=r},{76:76}],125:[function(e,t,n){"use strict";function r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function i(e,t){for(var n=r(e),i=0,a=0;n;){if(3===n.nodeType){if(a=i+n.textContent.length,t>=i&&a>=t)return{node:n,offset:t-i};i=a}n=r(o(n))}}t.exports=i},{}],126:[function(e,t,n){"use strict";function r(){return!i&&o.canUseDOM&&(i="textContent"in document.documentElement?"textContent":"innerText"),i}var o=e(140),i=null;t.exports=r},{140:140}],127:[function(e,t,n){"use strict";function r(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n["ms"+e]="MS"+t,n["O"+e]="o"+t.toLowerCase(),n}function o(e){if(u[e])return u[e];if(!a[e])return e;var t=a[e];for(var n in t)if(t.hasOwnProperty(n)&&n in s)return u[e]=t[n];return""}var i=e(140),a={animationend:r("Animation","AnimationEnd"),animationiteration:r("Animation","AnimationIteration"),animationstart:r("Animation","AnimationStart"),transitionend:r("Transition","TransitionEnd")},u={},s={};i.canUseDOM&&(s=document.createElement("div").style,"AnimationEvent"in window||(delete a.animationend.animation,delete a.animationiteration.animation,delete a.animationstart.animation),"TransitionEvent"in window||delete a.transitionend.transition),t.exports=o},{140:140}],128:[function(e,t,n){"use strict";function r(e){return"function"==typeof e&&"undefined"!=typeof e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function o(e){var t,n=null===e||e===!1;if(n)t=u.create(o);else if("object"==typeof e){var i=e;!i||"function"!=typeof i.type&&"string"!=typeof i.type?l(!1):void 0,t="string"==typeof i.type?s.createInternalComponent(i):r(i.type)?new i.type(i):new c(i)}else"string"==typeof e||"number"==typeof e?t=s.createInstanceForText(e):l(!1);return t._mountIndex=0,t._mountImage=null,t}var i=e(165),a=e(34),u=e(62),s=e(75),l=(e(70),e(154)),c=(e(164),function(e){this.construct(e)});i(c.prototype,a.Mixin,{_instantiateReactComponent:o});t.exports=o},{154:154,164:164,165:165,34:34,62:62,70:70,75:75}],129:[function(e,t,n){"use strict";function r(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var a=document.createElement("div");a.setAttribute(n,"return;"),r="function"==typeof a[n]}return!r&&o&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var o,i=e(140);i.canUseDOM&&(o=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0),t.exports=r},{140:140}],130:[function(e,t,n){"use strict";function r(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&o[e.type]||"textarea"===t)}var o={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};t.exports=r},{}],131:[function(e,t,n){"use strict";function r(e){return o.isValidElement(e)?void 0:i(!1),e}var o=e(60),i=e(154);t.exports=r},{154:154,60:60}],132:[function(e,t,n){"use strict";function r(e){return'"'+o(e)+'"'}var o=e(115);t.exports=r},{115:115}],133:[function(e,t,n){"use strict";var r=e(72);t.exports=r.renderSubtreeIntoContainer},{72:72}],134:[function(e,t,n){"use strict";var r=e(140),o=/^[ \r\n\t\f]/,i=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,a=e(113),u=a(function(e,t){e.innerHTML=t});if(r.canUseDOM){var s=document.createElement("div");s.innerHTML=" ",""===s.innerHTML&&(u=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),o.test(t)||"<"===t[0]&&i.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t}),s=null}t.exports=u},{113:113,140:140}],135:[function(e,t,n){"use strict";var r=e(140),o=e(115),i=e(134),a=function(e,t){e.textContent=t};r.canUseDOM&&("textContent"in document.documentElement||(a=function(e,t){i(e,o(t))})),t.exports=a},{115:115,134:134,140:140}],136:[function(e,t,n){"use strict";function r(e,t){var n=null===e||e===!1,r=null===t||t===!1;if(n||r)return n===r;var o=typeof e,i=typeof t;return"string"===o||"number"===o?"string"===i||"number"===i:"object"===i&&e.type===t.type&&e.key===t.key}t.exports=r},{}],137:[function(e,t,n){"use strict";function r(e,t){return e&&"object"==typeof e&&null!=e.key?l.escape(e.key):t.toString(36)}function o(e,t,n,i){var d=typeof e;if("undefined"!==d&&"boolean"!==d||(e=null),null===e||"string"===d||"number"===d||a.isValidElement(e))return n(i,e,""===t?c+r(e,0):t),1;var f,h,v=0,m=""===t?c:t+p;if(Array.isArray(e))for(var g=0;g<e.length;g++)f=e[g],h=m+r(f,g),v+=o(f,h,n,i);else{var y=u(e);if(y){var C,b=y.call(e);if(y!==e.entries)for(var _=0;!(C=b.next()).done;)f=C.value,h=m+r(f,_++),v+=o(f,h,n,i);else for(;!(C=b.next()).done;){var E=C.value;E&&(f=E[1],h=m+l.escape(E[0])+p+r(f,0),v+=o(f,h,n,i))}}else"object"===d&&(String(e),s(!1))}return v}function i(e,t,n){return null==e?0:o(e,"",t,n)}var a=(e(35),e(60)),u=e(123),s=e(154),l=e(23),c=(e(164),"."),p=":";t.exports=i},{123:123,154:154,164:164,23:23,35:35,60:60}],138:[function(e,t,n){"use strict";var r=(e(165),e(146)),o=(e(164),r);t.exports=o},{146:146,164:164,165:165}],139:[function(e,t,n){"use strict";var r=e(146),o={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!0),{remove:function(){e.removeEventListener(t,n,!0)}}):{remove:r}},registerDefault:function(){}};t.exports=o},{146:146}],140:[function(e,t,n){"use strict";var r=!("undefined"==typeof window||!window.document||!window.document.createElement),o={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};t.exports=o},{}],141:[function(e,t,n){"use strict";function r(e){return e.replace(o,function(e,t){return t.toUpperCase()})}var o=/-(.)/g;t.exports=r},{}],142:[function(e,t,n){"use strict";function r(e){return o(e.replace(i,"ms-"))}var o=e(141),i=/^-ms-/;t.exports=r},{141:141}],143:[function(e,t,n){"use strict";function r(e,t){return e&&t?e===t?!0:o(e)?!1:o(t)?r(e,t.parentNode):e.contains?e.contains(t):e.compareDocumentPosition?!!(16&e.compareDocumentPosition(t)):!1:!1}var o=e(156);t.exports=r},{156:156}],144:[function(e,t,n){"use strict";function r(e){var t=e.length;if(Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e?a(!1):void 0,"number"!=typeof t?a(!1):void 0,0===t||t-1 in e?void 0:a(!1),"function"==typeof e.callee?a(!1):void 0,e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(n){}for(var r=Array(t),o=0;t>o;o++)r[o]=e[o];return r}function o(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function i(e){return o(e)?Array.isArray(e)?e.slice():r(e):[e]}var a=e(154);t.exports=i},{154:154}],145:[function(e,t,n){"use strict";function r(e){var t=e.match(c);return t&&t[1].toLowerCase()}function o(e,t){var n=l;l?void 0:s(!1);var o=r(e),i=o&&u(o);if(i){n.innerHTML=i[1]+e+i[2];for(var c=i[0];c--;)n=n.lastChild}else n.innerHTML=e;var p=n.getElementsByTagName("script");p.length&&(t?void 0:s(!1),a(p).forEach(t));for(var d=Array.from(n.childNodes);n.lastChild;)n.removeChild(n.lastChild);return d}var i=e(140),a=e(144),u=e(150),s=e(154),l=i.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;t.exports=o},{140:140,144:144,150:150,154:154}],146:[function(e,t,n){"use strict";function r(e){return function(){return e}}function o(){}o.thatReturns=r,o.thatReturnsFalse=r(!1),o.thatReturnsTrue=r(!0),o.thatReturnsNull=r(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},t.exports=o},{}],147:[function(e,t,n){"use strict";var r={};t.exports=r},{}],148:[function(e,t,n){"use strict";function r(e){try{e.focus()}catch(t){}}t.exports=r},{}],149:[function(e,t,n){"use strict";function r(){if("undefined"==typeof document)return null;try{return document.activeElement||document.body}catch(e){return document.body}}t.exports=r},{}],150:[function(e,t,n){"use strict";function r(e){return a?void 0:i(!1),d.hasOwnProperty(e)||(e="*"),u.hasOwnProperty(e)||("*"===e?a.innerHTML="<link />":a.innerHTML="<"+e+"></"+e+">",u[e]=!a.firstChild),u[e]?d[e]:null}var o=e(140),i=e(154),a=o.canUseDOM?document.createElement("div"):null,u={},s=[1,'<select multiple="true">',"</select>"],l=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],p=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],d={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:s,option:s,caption:l,colgroup:l,tbody:l,tfoot:l,thead:l,td:c,th:c},f=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];f.forEach(function(e){d[e]=p,u[e]=!0}),t.exports=r},{140:140,154:154}],151:[function(e,t,n){"use strict";function r(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}t.exports=r},{}],152:[function(e,t,n){"use strict";function r(e){return e.replace(o,"-$1").toLowerCase()}var o=/([A-Z])/g;t.exports=r},{}],153:[function(e,t,n){"use strict";function r(e){return o(e).replace(i,"-ms-")}var o=e(152),i=/^ms-/;t.exports=r},{152:152}],154:[function(e,t,n){"use strict";function r(e,t,n,r,o,i,a,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,o,i,a,u],c=0;s=new Error(t.replace(/%s/g,function(){return l[c++]})),s.name="Invariant Violation"}throw s.framesToPop=1,s}}t.exports=r},{}],155:[function(e,t,n){"use strict";function r(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}t.exports=r},{}],156:[function(e,t,n){"use strict";function r(e){return o(e)&&3==e.nodeType}var o=e(155);t.exports=r},{155:155}],157:[function(e,t,n){"use strict";var r=e(154),o=function(e){var t,n={};e instanceof Object&&!Array.isArray(e)?void 0:r(!1);for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};t.exports=o},{154:154}],158:[function(e,t,n){"use strict";var r=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return t;return null};t.exports=r},{}],159:[function(e,t,n){"use strict";function r(e,t,n){if(!e)return null;var r={};for(var i in e)o.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],160:[function(e,t,n){"use strict";function r(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}t.exports=r},{}],161:[function(e,t,n){"use strict";var r,o=e(140);o.canUseDOM&&(r=window.performance||window.msPerformance||window.webkitPerformance),t.exports=r||{}},{140:140}],162:[function(e,t,n){"use strict";var r,o=e(161);r=o.now?function(){return o.now()}:function(){return Date.now()},t.exports=r},{161:161}],163:[function(e,t,n){"use strict";function r(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function o(e,t){if(r(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(var a=0;a<n.length;a++)if(!i.call(t,n[a])||!r(e[n[a]],t[n[a]]))return!1;return!0}var i=Object.prototype.hasOwnProperty;t.exports=o},{}],164:[function(e,t,n){"use strict";var r=e(146),o=r;t.exports=o},{146:146}],165:[function(e,t,n){"use strict";function r(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function o(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;10>n;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==r.join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(e){o[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(i){return!1}}var i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=o()?Object.assign:function(e,t){for(var n,o,u=r(e),s=1;s<arguments.length;s++){n=Object(arguments[s]);for(var l in n)i.call(n,l)&&(u[l]=n[l]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(n);for(var c=0;c<o.length;c++)a.call(n,o[c])&&(u[o[c]]=n[o[c]])}}return u}},{}]},{},[88])(88)});
/**
 * ReactDOM v15.1.0
 *
 * Copyright 2013-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e(require("react"));else if("function"==typeof define&&define.amd)define('react-dom',["react"],e);else{var f;f="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,f.ReactDOM=e(f.React)}}(function(e){return e.__SECRET_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED});
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define('redux',[],e):"object"==typeof exports?exports.Redux=e():t.Redux=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0,e.compose=e.applyMiddleware=e.bindActionCreators=e.combineReducers=e.createStore=void 0;var o=n(2),i=r(o),u=n(7),c=r(u),a=n(6),f=r(a),s=n(5),d=r(s),l=n(1),p=r(l),y=n(3);r(y);e.createStore=i["default"],e.combineReducers=c["default"],e.bindActionCreators=f["default"],e.applyMiddleware=d["default"],e.compose=p["default"]},function(t,e){"use strict";function n(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];return function(){if(0===e.length)return arguments.length>0?arguments[0]:void 0;var t=e[e.length-1],n=e.slice(0,-1);return n.reduceRight(function(t,e){return e(t)},t.apply(void 0,arguments))}}e.__esModule=!0,e["default"]=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e,n){function r(){y===p&&(y=p.slice())}function i(){return l}function a(t){if("function"!=typeof t)throw Error("Expected listener to be a function.");var e=!0;return r(),y.push(t),function(){if(e){e=!1,r();var n=y.indexOf(t);y.splice(n,1)}}}function f(t){if(!(0,u["default"])(t))throw Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw Error("Reducers may not dispatch actions.");try{h=!0,l=d(l,t)}finally{h=!1}for(var e=p=y,n=0;e.length>n;n++)e[n]();return t}function s(t){if("function"!=typeof t)throw Error("Expected the nextReducer to be a function.");d=t,f({type:c.INIT})}if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw Error("Expected the enhancer to be a function.");return n(o)(t,e)}if("function"!=typeof t)throw Error("Expected the reducer to be a function.");var d=t,l=e,p=[],y=p,h=!1;return f({type:c.INIT}),{dispatch:f,subscribe:a,getState:i,replaceReducer:s}}e.__esModule=!0,e.ActionTypes=void 0,e["default"]=o;var i=n(4),u=r(i),c=e.ActionTypes={INIT:"@@redux/INIT"}},function(t,e){"use strict";function n(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t);try{throw Error(t)}catch(e){}}e.__esModule=!0,e["default"]=n},function(t,e,n){function r(t){if(!i(t)||s.call(t)!=u||o(t))return!1;var e=c;if("function"==typeof t.constructor&&(e=d(t)),null===e)return!0;var n=e.constructor;return"function"==typeof n&&n instanceof n&&a.call(n)==f}var o=n(8),i=n(9),u="[object Object]",c=Object.prototype,a=Function.prototype.toString,f=a.call(Object),s=c.toString,d=Object.getPrototypeOf;t.exports=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];return function(t){return function(n,r,o){var u=t(n,r,o),a=u.dispatch,f=[],s={getState:u.getState,dispatch:function(t){return a(t)}};return f=e.map(function(t){return t(s)}),a=c["default"].apply(void 0,f)(u.dispatch),i({},u,{dispatch:a})}}}var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.__esModule=!0,e["default"]=o;var u=n(1),c=r(u)},function(t,e){"use strict";function n(t,e){return function(){return e(t.apply(void 0,arguments))}}function r(t,e){if("function"==typeof t)return n(t,e);if("object"!=typeof t||null===t)throw Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(t),o={},i=0;r.length>i;i++){var u=r[i],c=t[u];"function"==typeof c&&(o[u]=n(c,e))}return o}e.__esModule=!0,e["default"]=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){var n=e&&e.type,r=n&&'"'+n+'"'||"an action";return'Reducer "'+t+'" returned undefined handling '+r+". To ignore an action, you must explicitly return the previous state."}function i(t){Object.keys(t).forEach(function(e){var n=t[e],r=n(void 0,{type:c.ActionTypes.INIT});if(void 0===r)throw Error('Reducer "'+e+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');var o="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if(void 0===n(void 0,{type:o}))throw Error('Reducer "'+e+'" returned undefined when probed with a random type. '+("Don't try to handle "+c.ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.")})}function u(t){for(var e=Object.keys(t),n={},r=0;e.length>r;r++){var u=e[r];"function"==typeof t[u]&&(n[u]=t[u])}var c,a=Object.keys(n);try{i(n)}catch(f){c=f}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(c)throw c;for(var r=!1,i={},u=0;a.length>u;u++){var f=a[u],s=n[f],d=t[f],l=s(d,e);if(void 0===l){var p=o(f,e);throw Error(p)}i[f]=l,r=r||l!==d}return r?i:t}}e.__esModule=!0,e["default"]=u;var c=n(2),a=n(4),f=(r(a),n(3));r(f)},function(t,e){function n(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}t.exports=n},function(t,e){function n(t){return!!t&&"object"==typeof t}t.exports=n}])});
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("react"), require("redux"));
	else if(typeof define === 'function' && define.amd)
		define('react-redux',["react", "redux"], factory);
	else if(typeof exports === 'object')
		exports["ReactRedux"] = factory(require("react"), require("redux"));
	else
		root["ReactRedux"] = factory(root["React"], root["Redux"]);
})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_12__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	exports.__esModule = true;
	exports.connect = exports.Provider = undefined;

	var _Provider = __webpack_require__(3);

	var _Provider2 = _interopRequireDefault(_Provider);

	var _connect = __webpack_require__(4);

	var _connect2 = _interopRequireDefault(_connect);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

	exports.Provider = _Provider2["default"];
	exports.connect = _connect2["default"];

/***/ },
/* 1 */
/***/ function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_1__;

/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	exports.__esModule = true;

	var _react = __webpack_require__(1);

	exports["default"] = _react.PropTypes.shape({
	  subscribe: _react.PropTypes.func.isRequired,
	  dispatch: _react.PropTypes.func.isRequired,
	  getState: _react.PropTypes.func.isRequired
	});

/***/ },
/* 3 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	exports.__esModule = true;
	exports["default"] = undefined;

	var _react = __webpack_require__(1);

	var _storeShape = __webpack_require__(2);

	var _storeShape2 = _interopRequireDefault(_storeShape);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var didWarnAboutReceivingStore = false;
	function warnAboutReceivingStore() {
	  if (didWarnAboutReceivingStore) {
	    return;
	  }
	  didWarnAboutReceivingStore = true;

	  /* eslint-disable no-console */
	  if (typeof console !== 'undefined' && typeof console.error === 'function') {
	    console.error('<Provider> does not support changing `store` on the fly. ' + 'It is most likely that you see this error because you updated to ' + 'Redux 2.x and React Redux 2.x which no longer hot reload reducers ' + 'automatically. See https://github.com/rackt/react-redux/releases/' + 'tag/v2.0.0 for the migration instructions.');
	  }
	  /* eslint-disable no-console */
	}

	var Provider = function (_Component) {
	  _inherits(Provider, _Component);

	  Provider.prototype.getChildContext = function getChildContext() {
	    return { store: this.store };
	  };

	  function Provider(props, context) {
	    _classCallCheck(this, Provider);

	    var _this = _possibleConstructorReturn(this, _Component.call(this, props, context));

	    _this.store = props.store;
	    return _this;
	  }

	  Provider.prototype.render = function render() {
	    var children = this.props.children;

	    return _react.Children.only(children);
	  };

	  return Provider;
	}(_react.Component);

	exports["default"] = Provider;

	if (true) {
	  Provider.prototype.componentWillReceiveProps = function (nextProps) {
	    var store = this.store;
	    var nextStore = nextProps.store;

	    if (store !== nextStore) {
	      warnAboutReceivingStore();
	    }
	  };
	}

	Provider.propTypes = {
	  store: _storeShape2["default"].isRequired,
	  children: _react.PropTypes.element.isRequired
	};
	Provider.childContextTypes = {
	  store: _storeShape2["default"].isRequired
	};

/***/ },
/* 4 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

	exports.__esModule = true;
	exports["default"] = connect;

	var _react = __webpack_require__(1);

	var _storeShape = __webpack_require__(2);

	var _storeShape2 = _interopRequireDefault(_storeShape);

	var _shallowEqual = __webpack_require__(5);

	var _shallowEqual2 = _interopRequireDefault(_shallowEqual);

	var _wrapActionCreators = __webpack_require__(6);

	var _wrapActionCreators2 = _interopRequireDefault(_wrapActionCreators);

	var _isPlainObject = __webpack_require__(11);

	var _isPlainObject2 = _interopRequireDefault(_isPlainObject);

	var _hoistNonReactStatics = __webpack_require__(7);

	var _hoistNonReactStatics2 = _interopRequireDefault(_hoistNonReactStatics);

	var _invariant = __webpack_require__(8);

	var _invariant2 = _interopRequireDefault(_invariant);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var defaultMapStateToProps = function defaultMapStateToProps(state) {
	  return {};
	}; // eslint-disable-line no-unused-vars
	var defaultMapDispatchToProps = function defaultMapDispatchToProps(dispatch) {
	  return { dispatch: dispatch };
	};
	var defaultMergeProps = function defaultMergeProps(stateProps, dispatchProps, parentProps) {
	  return _extends({}, parentProps, stateProps, dispatchProps);
	};

	function getDisplayName(WrappedComponent) {
	  return WrappedComponent.displayName || WrappedComponent.name || 'Component';
	}

	function checkStateShape(stateProps, dispatch) {
	  (0, _invariant2["default"])((0, _isPlainObject2["default"])(stateProps), '`%sToProps` must return an object. Instead received %s.', dispatch ? 'mapDispatch' : 'mapState', stateProps);
	  return stateProps;
	}

	// Helps track hot reloading.
	var nextVersion = 0;

	function connect(mapStateToProps, mapDispatchToProps, mergeProps) {
	  var options = arguments.length <= 3 || arguments[3] === undefined ? {} : arguments[3];

	  var shouldSubscribe = Boolean(mapStateToProps);
	  var mapState = mapStateToProps || defaultMapStateToProps;
	  var mapDispatch = (0, _isPlainObject2["default"])(mapDispatchToProps) ? (0, _wrapActionCreators2["default"])(mapDispatchToProps) : mapDispatchToProps || defaultMapDispatchToProps;

	  var finalMergeProps = mergeProps || defaultMergeProps;
	  var checkMergedEquals = finalMergeProps !== defaultMergeProps;
	  var _options$pure = options.pure;
	  var pure = _options$pure === undefined ? true : _options$pure;
	  var _options$withRef = options.withRef;
	  var withRef = _options$withRef === undefined ? false : _options$withRef;

	  // Helps track hot reloading.

	  var version = nextVersion++;

	  function computeMergedProps(stateProps, dispatchProps, parentProps) {
	    var mergedProps = finalMergeProps(stateProps, dispatchProps, parentProps);
	    (0, _invariant2["default"])((0, _isPlainObject2["default"])(mergedProps), '`mergeProps` must return an object. Instead received %s.', mergedProps);
	    return mergedProps;
	  }

	  return function wrapWithConnect(WrappedComponent) {
	    var Connect = function (_Component) {
	      _inherits(Connect, _Component);

	      Connect.prototype.shouldComponentUpdate = function shouldComponentUpdate() {
	        return !pure || this.haveOwnPropsChanged || this.hasStoreStateChanged;
	      };

	      function Connect(props, context) {
	        _classCallCheck(this, Connect);

	        var _this = _possibleConstructorReturn(this, _Component.call(this, props, context));

	        _this.version = version;
	        _this.store = props.store || context.store;

	        (0, _invariant2["default"])(_this.store, 'Could not find "store" in either the context or ' + ('props of "' + _this.constructor.displayName + '". ') + 'Either wrap the root component in a <Provider>, ' + ('or explicitly pass "store" as a prop to "' + _this.constructor.displayName + '".'));

	        var storeState = _this.store.getState();
	        _this.state = { storeState: storeState };
	        _this.clearCache();
	        return _this;
	      }

	      Connect.prototype.computeStateProps = function computeStateProps(store, props) {
	        if (!this.finalMapStateToProps) {
	          return this.configureFinalMapState(store, props);
	        }

	        var state = store.getState();
	        var stateProps = this.doStatePropsDependOnOwnProps ? this.finalMapStateToProps(state, props) : this.finalMapStateToProps(state);

	        return checkStateShape(stateProps);
	      };

	      Connect.prototype.configureFinalMapState = function configureFinalMapState(store, props) {
	        var mappedState = mapState(store.getState(), props);
	        var isFactory = typeof mappedState === 'function';

	        this.finalMapStateToProps = isFactory ? mappedState : mapState;
	        this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1;

	        return isFactory ? this.computeStateProps(store, props) : checkStateShape(mappedState);
	      };

	      Connect.prototype.computeDispatchProps = function computeDispatchProps(store, props) {
	        if (!this.finalMapDispatchToProps) {
	          return this.configureFinalMapDispatch(store, props);
	        }

	        var dispatch = store.dispatch;

	        var dispatchProps = this.doDispatchPropsDependOnOwnProps ? this.finalMapDispatchToProps(dispatch, props) : this.finalMapDispatchToProps(dispatch);

	        return checkStateShape(dispatchProps, true);
	      };

	      Connect.prototype.configureFinalMapDispatch = function configureFinalMapDispatch(store, props) {
	        var mappedDispatch = mapDispatch(store.dispatch, props);
	        var isFactory = typeof mappedDispatch === 'function';

	        this.finalMapDispatchToProps = isFactory ? mappedDispatch : mapDispatch;
	        this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1;

	        return isFactory ? this.computeDispatchProps(store, props) : checkStateShape(mappedDispatch, true);
	      };

	      Connect.prototype.updateStatePropsIfNeeded = function updateStatePropsIfNeeded() {
	        var nextStateProps = this.computeStateProps(this.store, this.props);
	        if (this.stateProps && (0, _shallowEqual2["default"])(nextStateProps, this.stateProps)) {
	          return false;
	        }

	        this.stateProps = nextStateProps;
	        return true;
	      };

	      Connect.prototype.updateDispatchPropsIfNeeded = function updateDispatchPropsIfNeeded() {
	        var nextDispatchProps = this.computeDispatchProps(this.store, this.props);
	        if (this.dispatchProps && (0, _shallowEqual2["default"])(nextDispatchProps, this.dispatchProps)) {
	          return false;
	        }

	        this.dispatchProps = nextDispatchProps;
	        return true;
	      };

	      Connect.prototype.updateMergedPropsIfNeeded = function updateMergedPropsIfNeeded() {
	        var nextMergedProps = computeMergedProps(this.stateProps, this.dispatchProps, this.props);
	        if (this.mergedProps && checkMergedEquals && (0, _shallowEqual2["default"])(nextMergedProps, this.mergedProps)) {
	          return false;
	        }

	        this.mergedProps = nextMergedProps;
	        return true;
	      };

	      Connect.prototype.isSubscribed = function isSubscribed() {
	        return typeof this.unsubscribe === 'function';
	      };

	      Connect.prototype.trySubscribe = function trySubscribe() {
	        if (shouldSubscribe && !this.unsubscribe) {
	          this.unsubscribe = this.store.subscribe(this.handleChange.bind(this));
	          this.handleChange();
	        }
	      };

	      Connect.prototype.tryUnsubscribe = function tryUnsubscribe() {
	        if (this.unsubscribe) {
	          this.unsubscribe();
	          this.unsubscribe = null;
	        }
	      };

	      Connect.prototype.componentDidMount = function componentDidMount() {
	        this.trySubscribe();
	      };

	      Connect.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {
	        if (!pure || !(0, _shallowEqual2["default"])(nextProps, this.props)) {
	          this.haveOwnPropsChanged = true;
	        }
	      };

	      Connect.prototype.componentWillUnmount = function componentWillUnmount() {
	        this.tryUnsubscribe();
	        this.clearCache();
	      };

	      Connect.prototype.clearCache = function clearCache() {
	        this.dispatchProps = null;
	        this.stateProps = null;
	        this.mergedProps = null;
	        this.haveOwnPropsChanged = true;
	        this.hasStoreStateChanged = true;
	        this.renderedElement = null;
	        this.finalMapDispatchToProps = null;
	        this.finalMapStateToProps = null;
	      };

	      Connect.prototype.handleChange = function handleChange() {
	        if (!this.unsubscribe) {
	          return;
	        }

	        var prevStoreState = this.state.storeState;
	        var storeState = this.store.getState();

	        if (!pure || prevStoreState !== storeState) {
	          this.hasStoreStateChanged = true;
	          this.setState({ storeState: storeState });
	        }
	      };

	      Connect.prototype.getWrappedInstance = function getWrappedInstance() {
	        (0, _invariant2["default"])(withRef, 'To access the wrapped instance, you need to specify ' + '{ withRef: true } as the fourth argument of the connect() call.');

	        return this.refs.wrappedInstance;
	      };

	      Connect.prototype.render = function render() {
	        var haveOwnPropsChanged = this.haveOwnPropsChanged;
	        var hasStoreStateChanged = this.hasStoreStateChanged;
	        var renderedElement = this.renderedElement;

	        this.haveOwnPropsChanged = false;
	        this.hasStoreStateChanged = false;

	        var shouldUpdateStateProps = true;
	        var shouldUpdateDispatchProps = true;
	        if (pure && renderedElement) {
	          shouldUpdateStateProps = hasStoreStateChanged || haveOwnPropsChanged && this.doStatePropsDependOnOwnProps;
	          shouldUpdateDispatchProps = haveOwnPropsChanged && this.doDispatchPropsDependOnOwnProps;
	        }

	        var haveStatePropsChanged = false;
	        var haveDispatchPropsChanged = false;
	        if (shouldUpdateStateProps) {
	          haveStatePropsChanged = this.updateStatePropsIfNeeded();
	        }
	        if (shouldUpdateDispatchProps) {
	          haveDispatchPropsChanged = this.updateDispatchPropsIfNeeded();
	        }

	        var haveMergedPropsChanged = true;
	        if (haveStatePropsChanged || haveDispatchPropsChanged || haveOwnPropsChanged) {
	          haveMergedPropsChanged = this.updateMergedPropsIfNeeded();
	        } else {
	          haveMergedPropsChanged = false;
	        }

	        if (!haveMergedPropsChanged && renderedElement) {
	          return renderedElement;
	        }

	        if (withRef) {
	          this.renderedElement = (0, _react.createElement)(WrappedComponent, _extends({}, this.mergedProps, {
	            ref: 'wrappedInstance'
	          }));
	        } else {
	          this.renderedElement = (0, _react.createElement)(WrappedComponent, this.mergedProps);
	        }

	        return this.renderedElement;
	      };

	      return Connect;
	    }(_react.Component);

	    Connect.displayName = 'Connect(' + getDisplayName(WrappedComponent) + ')';
	    Connect.WrappedComponent = WrappedComponent;
	    Connect.contextTypes = {
	      store: _storeShape2["default"]
	    };
	    Connect.propTypes = {
	      store: _storeShape2["default"]
	    };

	    if (true) {
	      Connect.prototype.componentWillUpdate = function componentWillUpdate() {
	        if (this.version === version) {
	          return;
	        }

	        // We are hot reloading!
	        this.version = version;
	        this.trySubscribe();
	        this.clearCache();
	      };
	    }

	    return (0, _hoistNonReactStatics2["default"])(Connect, WrappedComponent);
	  };
	}

/***/ },
/* 5 */
/***/ function(module, exports) {

	"use strict";

	exports.__esModule = true;
	exports["default"] = shallowEqual;
	function shallowEqual(objA, objB) {
	  if (objA === objB) {
	    return true;
	  }

	  var keysA = Object.keys(objA);
	  var keysB = Object.keys(objB);

	  if (keysA.length !== keysB.length) {
	    return false;
	  }

	  // Test for A's keys different from B.
	  var hasOwn = Object.prototype.hasOwnProperty;
	  for (var i = 0; i < keysA.length; i++) {
	    if (!hasOwn.call(objB, keysA[i]) || objA[keysA[i]] !== objB[keysA[i]]) {
	      return false;
	    }
	  }

	  return true;
	}

/***/ },
/* 6 */
/***/ function(module, exports, __webpack_require__) {

	'use strict';

	exports.__esModule = true;
	exports["default"] = wrapActionCreators;

	var _redux = __webpack_require__(12);

	function wrapActionCreators(actionCreators) {
	  return function (dispatch) {
	    return (0, _redux.bindActionCreators)(actionCreators, dispatch);
	  };
	}

/***/ },
/* 7 */
/***/ function(module, exports) {

	/**
	 * Copyright 2015, Yahoo! Inc.
	 * Copyrights licensed under the New BSD License. See the accompanying LICENSE file for terms.
	 */
	'use strict';

	var REACT_STATICS = {
	    childContextTypes: true,
	    contextTypes: true,
	    defaultProps: true,
	    displayName: true,
	    getDefaultProps: true,
	    mixins: true,
	    propTypes: true,
	    type: true
	};

	var KNOWN_STATICS = {
	    name: true,
	    length: true,
	    prototype: true,
	    caller: true,
	    arguments: true,
	    arity: true
	};

	module.exports = function hoistNonReactStatics(targetComponent, sourceComponent) {
	    var keys = Object.getOwnPropertyNames(sourceComponent);
	    for (var i=0; i<keys.length; ++i) {
	        if (!REACT_STATICS[keys[i]] && !KNOWN_STATICS[keys[i]]) {
	            targetComponent[keys[i]] = sourceComponent[keys[i]];
	        }
	    }

	    return targetComponent;
	};


/***/ },
/* 8 */
/***/ function(module, exports, __webpack_require__) {

	/**
	 * Copyright 2013-2015, Facebook, Inc.
	 * All rights reserved.
	 *
	 * This source code is licensed under the BSD-style license found in the
	 * LICENSE file in the root directory of this source tree. An additional grant
	 * of patent rights can be found in the PATENTS file in the same directory.
	 */

	'use strict';

	/**
	 * Use invariant() to assert state which your program assumes to be true.
	 *
	 * Provide sprintf-style format (only %s is supported) and arguments
	 * to provide information about what broke and what you were
	 * expecting.
	 *
	 * The invariant message will be stripped in production, but the invariant
	 * will remain to ensure logic does not differ in production.
	 */

	var invariant = function(condition, format, a, b, c, d, e, f) {
	  if (true) {
	    if (format === undefined) {
	      throw new Error('invariant requires an error message argument');
	    }
	  }

	  if (!condition) {
	    var error;
	    if (format === undefined) {
	      error = new Error(
	        'Minified exception occurred; use the non-minified dev environment ' +
	        'for the full error message and additional helpful warnings.'
	      );
	    } else {
	      var args = [a, b, c, d, e, f];
	      var argIndex = 0;
	      error = new Error(
	        format.replace(/%s/g, function() { return args[argIndex++]; })
	      );
	      error.name = 'Invariant Violation';
	    }

	    error.framesToPop = 1; // we don't care about invariant's own frame
	    throw error;
	  }
	};

	module.exports = invariant;


/***/ },
/* 9 */
/***/ function(module, exports) {

	/**
	 * Checks if `value` is a host object in IE < 9.
	 *
	 * @private
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
	 */
	function isHostObject(value) {
	  // Many host objects are `Object` objects that can coerce to strings
	  // despite having improperly defined `toString` methods.
	  var result = false;
	  if (value != null && typeof value.toString != 'function') {
	    try {
	      result = !!(value + '');
	    } catch (e) {}
	  }
	  return result;
	}

	module.exports = isHostObject;


/***/ },
/* 10 */
/***/ function(module, exports) {

	/**
	 * Checks if `value` is object-like. A value is object-like if it's not `null`
	 * and has a `typeof` result of "object".
	 *
	 * @static
	 * @memberOf _
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
	 * @example
	 *
	 * _.isObjectLike({});
	 * // => true
	 *
	 * _.isObjectLike([1, 2, 3]);
	 * // => true
	 *
	 * _.isObjectLike(_.noop);
	 * // => false
	 *
	 * _.isObjectLike(null);
	 * // => false
	 */
	function isObjectLike(value) {
	  return !!value && typeof value == 'object';
	}

	module.exports = isObjectLike;


/***/ },
/* 11 */
/***/ function(module, exports, __webpack_require__) {

	var isHostObject = __webpack_require__(9),
	    isObjectLike = __webpack_require__(10);

	/** `Object#toString` result references. */
	var objectTag = '[object Object]';

	/** Used for built-in method references. */
	var objectProto = Object.prototype;

	/** Used to resolve the decompiled source of functions. */
	var funcToString = Function.prototype.toString;

	/** Used to infer the `Object` constructor. */
	var objectCtorString = funcToString.call(Object);

	/**
	 * Used to resolve the [`toStringTag`](http://ecma-international.org/ecma-262/6.0/#sec-object.prototype.tostring)
	 * of values.
	 */
	var objectToString = objectProto.toString;

	/** Built-in value references. */
	var getPrototypeOf = Object.getPrototypeOf;

	/**
	 * Checks if `value` is a plain object, that is, an object created by the
	 * `Object` constructor or one with a `[[Prototype]]` of `null`.
	 *
	 * @static
	 * @memberOf _
	 * @category Lang
	 * @param {*} value The value to check.
	 * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
	 * @example
	 *
	 * function Foo() {
	 *   this.a = 1;
	 * }
	 *
	 * _.isPlainObject(new Foo);
	 * // => false
	 *
	 * _.isPlainObject([1, 2, 3]);
	 * // => false
	 *
	 * _.isPlainObject({ 'x': 0, 'y': 0 });
	 * // => true
	 *
	 * _.isPlainObject(Object.create(null));
	 * // => true
	 */
	function isPlainObject(value) {
	  if (!isObjectLike(value) || objectToString.call(value) != objectTag || isHostObject(value)) {
	    return false;
	  }
	  var proto = objectProto;
	  if (typeof value.constructor == 'function') {
	    proto = getPrototypeOf(value);
	  }
	  if (proto === null) {
	    return true;
	  }
	  var Ctor = proto.constructor;
	  return (typeof Ctor == 'function' &&
	    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);
	}

	module.exports = isPlainObject;


/***/ },
/* 12 */
/***/ function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_12__;

/***/ }
/******/ ])
});
;
define('storymaps-react/tpl/builder/overviewPanel/actionTypes',['exports'], function (exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  var TOGGLE_ORGANIZE = exports.TOGGLE_ORGANIZE = 'TOGGLE_ORGANIZE';
  var CHANGE_SELECTED_ITEM = exports.CHANGE_SELECTED_ITEM = 'CHANGE_SELECTED_ITEM';
  var UPDATE_ITEMS = exports.UPDATE_ITEMS = 'UPDATE_ITEMS';
  var UPDATE_ORDER = exports.UPDATE_ORDER = 'UPDATE_ORDER';
});
//# sourceMappingURL=actionTypes.js.map
;
define('storymaps-react/tpl/builder/overviewPanel/reducer',['module', 'exports', './actionTypes'], function (module, exports, _actionTypes) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var types = _interopRequireWildcard(_actionTypes);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function overviewPanel() {
    var state = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
    var action = arguments[1];

    switch (action.type) {
      case types.CHANGE_SELECTED_ITEM:
        return Object.assign({}, state, { selectedItem: action.value });
      case types.TOGGLE_ORGANIZE:
        return Object.assign({}, state, { organize: !state.organize });
      case types.UPDATE_ITEMS:
        return Object.assign({}, state, { items: action.value });
      case types.UPDATE_ORDER:
        return Object.assign({}, state, { order: action.value });
      default:
        return state;
    }
  }

  exports.default = overviewPanel;
  module.exports = exports['default'];
});
//# sourceMappingURL=reducer.js.map
;
define('storymaps-react/tpl/builder/overviewPanel/actions',['exports', './actionTypes'], function (exports, _actionTypes) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.toggleOrganize = toggleOrganize;
  exports.changeSelectedItem = changeSelectedItem;
  exports.updateItems = updateItems;
  exports.updateOrder = updateOrder;

  var types = _interopRequireWildcard(_actionTypes);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function toggleOrganize() {
    return {
      type: types.TOGGLE_ORGANIZE,
      value: null
    };
  }

  function changeSelectedItem(itemID) {
    return {
      type: types.CHANGE_SELECTED_ITEM,
      value: itemID
    };
  }

  function updateItems(items) {
    return {
      type: types.UPDATE_ITEMS,
      value: items
    };
  }

  function updateOrder(order) {
    return {
      type: types.UPDATE_ORDER,
      value: order
    };
  }
});
//# sourceMappingURL=actions.js.map
;
/**!
 * Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @license MIT
 */


(function (factory) {
	"use strict";

	if (typeof define === "function" && define.amd) {
		define('lib/Sortable/Sortable',factory);
	}
	else if (typeof module != "undefined" && typeof module.exports != "undefined") {
		module.exports = factory();
	}
	else if (typeof Package !== "undefined") {
		Sortable = factory();  // export for Meteor.js
	}
	else {
		/* jshint sub:true */
		window["Sortable"] = factory();
	}
})(function () {
	"use strict";

	var dragEl,
		parentEl,
		ghostEl,
		cloneEl,
		rootEl,
		nextEl,

		scrollEl,
		scrollParentEl,

		lastEl,
		lastCSS,
		lastParentCSS,

		oldIndex,
		newIndex,

		activeGroup,
		autoScroll = {},

		tapEvt,
		touchEvt,

		moved,

		/** @const */
		RSPACE = /\s+/g,

		expando = 'Sortable' + (new Date).getTime(),

		win = window,
		document = win.document,
		parseInt = win.parseInt,

		supportDraggable = !!('draggable' in document.createElement('div')),
		supportCssPointerEvents = (function (el) {
			el = document.createElement('x');
			el.style.cssText = 'pointer-events:auto';
			return el.style.pointerEvents === 'auto';
		})(),

		_silent = false,

		abs = Math.abs,
		slice = [].slice,

		touchDragOverListeners = [],

		_autoScroll = _throttle(function (/**Event*/evt, /**Object*/options, /**HTMLElement*/rootEl) {
			// Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=505521
			if (rootEl && options.scroll) {
				var el,
					rect,
					sens = options.scrollSensitivity,
					speed = options.scrollSpeed,

					x = evt.clientX,
					y = evt.clientY,

					winWidth = window.innerWidth,
					winHeight = window.innerHeight,

					vx,
					vy
				;

				// Delect scrollEl
				if (scrollParentEl !== rootEl) {
					scrollEl = options.scroll;
					scrollParentEl = rootEl;

					if (scrollEl === true) {
						scrollEl = rootEl;

						do {
							if ((scrollEl.offsetWidth < scrollEl.scrollWidth) ||
								(scrollEl.offsetHeight < scrollEl.scrollHeight)
							) {
								break;
							}
							/* jshint boss:true */
						} while (scrollEl = scrollEl.parentNode);
					}
				}

				if (scrollEl) {
					el = scrollEl;
					rect = scrollEl.getBoundingClientRect();
					vx = (abs(rect.right - x) <= sens) - (abs(rect.left - x) <= sens);
					vy = (abs(rect.bottom - y) <= sens) - (abs(rect.top - y) <= sens);
				}


				if (!(vx || vy)) {
					vx = (winWidth - x <= sens) - (x <= sens);
					vy = (winHeight - y <= sens) - (y <= sens);

					/* jshint expr:true */
					(vx || vy) && (el = win);
				}


				if (autoScroll.vx !== vx || autoScroll.vy !== vy || autoScroll.el !== el) {
					autoScroll.el = el;
					autoScroll.vx = vx;
					autoScroll.vy = vy;

					clearInterval(autoScroll.pid);

					if (el) {
						autoScroll.pid = setInterval(function () {
							if (el === win) {
								win.scrollTo(win.pageXOffset + vx * speed, win.pageYOffset + vy * speed);
							} else {
								vy && (el.scrollTop += vy * speed);
								vx && (el.scrollLeft += vx * speed);
							}
						}, 24);
					}
				}
			}
		}, 30),

		_prepareGroup = function (options) {
			var group = options.group;

			if (!group || typeof group != 'object') {
				group = options.group = {name: group};
			}

			['pull', 'put'].forEach(function (key) {
				if (!(key in group)) {
					group[key] = true;
				}
			});

			options.groups = ' ' + group.name + (group.put.join ? ' ' + group.put.join(' ') : '') + ' ';
		}
	;



	/**
	 * @class  Sortable
	 * @param  {HTMLElement}  el
	 * @param  {Object}       [options]
	 */
	function Sortable(el, options) {
		if (!(el && el.nodeType && el.nodeType === 1)) {
			throw 'Sortable: `el` must be HTMLElement, and not ' + {}.toString.call(el);
		}

		this.el = el; // root element
		this.options = options = _extend({}, options);


		// Export instance
		el[expando] = this;


		// Default options
		var defaults = {
			group: Math.random(),
			sort: true,
			disabled: false,
			store: null,
			handle: null,
			scroll: true,
			scrollSensitivity: 30,
			scrollSpeed: 10,
			draggable: /[uo]l/i.test(el.nodeName) ? 'li' : '>*',
			ghostClass: 'sortable-ghost',
			chosenClass: 'sortable-chosen',
			ignore: 'a, img',
			filter: null,
			animation: 0,
			setData: function (dataTransfer, dragEl) {
				dataTransfer.setData('Text', dragEl.textContent);
			},
			dropBubble: false,
			dragoverBubble: false,
			dataIdAttr: 'data-id',
			delay: 0,
			forceFallback: false,
			fallbackClass: 'sortable-fallback',
			fallbackOnBody: false
		};


		// Set default options
		for (var name in defaults) {
			!(name in options) && (options[name] = defaults[name]);
		}

		_prepareGroup(options);

		// Bind all private methods
		for (var fn in this) {
			if (fn.charAt(0) === '_') {
				this[fn] = this[fn].bind(this);
			}
		}

		// Setup drag mode
		this.nativeDraggable = options.forceFallback ? false : supportDraggable;

		// Bind events
		_on(el, 'mousedown', this._onTapStart);
		_on(el, 'touchstart', this._onTapStart);

		if (this.nativeDraggable) {
			_on(el, 'dragover', this);
			_on(el, 'dragenter', this);
		}

		touchDragOverListeners.push(this._onDragOver);

		// Restore sorting
		options.store && this.sort(options.store.get(this));
	}


	Sortable.prototype = /** @lends Sortable.prototype */ {
		constructor: Sortable,

		_onTapStart: function (/** Event|TouchEvent */evt) {
			var _this = this,
				el = this.el,
				options = this.options,
				type = evt.type,
				touch = evt.touches && evt.touches[0],
				target = (touch || evt).target,
				originalTarget = target,
				filter = options.filter;


			if (type === 'mousedown' && evt.button !== 0 || options.disabled) {
				return; // only left button or enabled
			}

			target = _closest(target, options.draggable, el);

			if (!target) {
				return;
			}

			// get the index of the dragged element within its parent
			oldIndex = _index(target);

			// Check filter
			if (typeof filter === 'function') {
				if (filter.call(this, evt, target, this)) {
					_dispatchEvent(_this, originalTarget, 'filter', target, el, oldIndex);
					evt.preventDefault();
					return; // cancel dnd
				}
			}
			else if (filter) {
				filter = filter.split(',').some(function (criteria) {
					criteria = _closest(originalTarget, criteria.trim(), el);

					if (criteria) {
						_dispatchEvent(_this, criteria, 'filter', target, el, oldIndex);
						return true;
					}
				});

				if (filter) {
					evt.preventDefault();
					return; // cancel dnd
				}
			}


			if (options.handle && !_closest(originalTarget, options.handle, el)) {
				return;
			}


			// Prepare `dragstart`
			this._prepareDragStart(evt, touch, target);
		},

		_prepareDragStart: function (/** Event */evt, /** Touch */touch, /** HTMLElement */target) {
			var _this = this,
				el = _this.el,
				options = _this.options,
				ownerDocument = el.ownerDocument,
				dragStartFn;

			if (target && !dragEl && (target.parentNode === el)) {
				tapEvt = evt;

				rootEl = el;
				dragEl = target;
				parentEl = dragEl.parentNode;
				nextEl = dragEl.nextSibling;
				activeGroup = options.group;

				dragStartFn = function () {
					// Delayed drag has been triggered
					// we can re-enable the events: touchmove/mousemove
					_this._disableDelayedDrag();

					// Make the element draggable
					dragEl.draggable = true;

					// Chosen item
					_toggleClass(dragEl, _this.options.chosenClass, true);

					// Bind the events: dragstart/dragend
					_this._triggerDragStart(touch);
				};

				// Disable "draggable"
				options.ignore.split(',').forEach(function (criteria) {
					_find(dragEl, criteria.trim(), _disableDraggable);
				});

				_on(ownerDocument, 'mouseup', _this._onDrop);
				_on(ownerDocument, 'touchend', _this._onDrop);
				_on(ownerDocument, 'touchcancel', _this._onDrop);

				if (options.delay) {
					// If the user moves the pointer or let go the click or touch
					// before the delay has been reached:
					// disable the delayed drag
					_on(ownerDocument, 'mouseup', _this._disableDelayedDrag);
					_on(ownerDocument, 'touchend', _this._disableDelayedDrag);
					_on(ownerDocument, 'touchcancel', _this._disableDelayedDrag);
					_on(ownerDocument, 'mousemove', _this._disableDelayedDrag);
					_on(ownerDocument, 'touchmove', _this._disableDelayedDrag);

					_this._dragStartTimer = setTimeout(dragStartFn, options.delay);
				} else {
					dragStartFn();
				}
			}
		},

		_disableDelayedDrag: function () {
			var ownerDocument = this.el.ownerDocument;

			clearTimeout(this._dragStartTimer);
			_off(ownerDocument, 'mouseup', this._disableDelayedDrag);
			_off(ownerDocument, 'touchend', this._disableDelayedDrag);
			_off(ownerDocument, 'touchcancel', this._disableDelayedDrag);
			_off(ownerDocument, 'mousemove', this._disableDelayedDrag);
			_off(ownerDocument, 'touchmove', this._disableDelayedDrag);
		},

		_triggerDragStart: function (/** Touch */touch) {
			if (touch) {
				// Touch device support
				tapEvt = {
					target: dragEl,
					clientX: touch.clientX,
					clientY: touch.clientY
				};

				this._onDragStart(tapEvt, 'touch');
			}
			else if (!this.nativeDraggable) {
				this._onDragStart(tapEvt, true);
			}
			else {
				_on(dragEl, 'dragend', this);
				_on(rootEl, 'dragstart', this._onDragStart);
			}

			try {
				if (document.selection) {
					document.selection.empty();
				} else {
					window.getSelection().removeAllRanges();
				}
			} catch (err) {
			}
		},

		_dragStarted: function () {
			if (rootEl && dragEl) {
				// Apply effect
				_toggleClass(dragEl, this.options.ghostClass, true);

				Sortable.active = this;

				// Drag start event
				_dispatchEvent(this, rootEl, 'start', dragEl, rootEl, oldIndex);
			}
		},

		_emulateDragOver: function () {
			if (touchEvt) {
				if (this._lastX === touchEvt.clientX && this._lastY === touchEvt.clientY) {
					return;
				}

				this._lastX = touchEvt.clientX;
				this._lastY = touchEvt.clientY;

				if (!supportCssPointerEvents) {
					_css(ghostEl, 'display', 'none');
				}

				var target = document.elementFromPoint(touchEvt.clientX, touchEvt.clientY),
					parent = target,
					groupName = ' ' + this.options.group.name + '',
					i = touchDragOverListeners.length;

				if (parent) {
					do {
						if (parent[expando] && parent[expando].options.groups.indexOf(groupName) > -1) {
							while (i--) {
								touchDragOverListeners[i]({
									clientX: touchEvt.clientX,
									clientY: touchEvt.clientY,
									target: target,
									rootEl: parent
								});
							}

							break;
						}

						target = parent; // store last element
					}
					/* jshint boss:true */
					while (parent = parent.parentNode);
				}

				if (!supportCssPointerEvents) {
					_css(ghostEl, 'display', '');
				}
			}
		},


		_onTouchMove: function (/**TouchEvent*/evt) {
			if (tapEvt) {
				// only set the status to dragging, when we are actually dragging
				if (!Sortable.active) {
					this._dragStarted();
				}

				// as well as creating the ghost element on the document body
				this._appendGhost();

				var touch = evt.touches ? evt.touches[0] : evt,
					dx = touch.clientX - tapEvt.clientX,
					dy = touch.clientY - tapEvt.clientY,
					translate3d = evt.touches ? 'translate3d(' + dx + 'px,' + dy + 'px,0)' : 'translate(' + dx + 'px,' + dy + 'px)';

				moved = true;
				touchEvt = touch;

				_css(ghostEl, 'webkitTransform', translate3d);
				_css(ghostEl, 'mozTransform', translate3d);
				_css(ghostEl, 'msTransform', translate3d);
				_css(ghostEl, 'transform', translate3d);

				evt.preventDefault();
			}
		},

		_appendGhost: function () {
			if (!ghostEl) {
				var rect = dragEl.getBoundingClientRect(),
					css = _css(dragEl),
					options = this.options,
					ghostRect;

				ghostEl = dragEl.cloneNode(true);

				_toggleClass(ghostEl, options.ghostClass, false);
				_toggleClass(ghostEl, options.fallbackClass, true);

				_css(ghostEl, 'top', rect.top - parseInt(css.marginTop, 10));
				_css(ghostEl, 'left', rect.left - parseInt(css.marginLeft, 10));
				_css(ghostEl, 'width', rect.width);
				_css(ghostEl, 'height', rect.height);
				_css(ghostEl, 'opacity', '0.8');
				_css(ghostEl, 'position', 'fixed');
				_css(ghostEl, 'zIndex', '100000');
				_css(ghostEl, 'pointerEvents', 'none');

				options.fallbackOnBody && document.body.appendChild(ghostEl) || rootEl.appendChild(ghostEl);

				// Fixing dimensions.
				ghostRect = ghostEl.getBoundingClientRect();
				_css(ghostEl, 'width', rect.width * 2 - ghostRect.width);
				_css(ghostEl, 'height', rect.height * 2 - ghostRect.height);
			}
		},

		_onDragStart: function (/**Event*/evt, /**boolean*/useFallback) {
			var dataTransfer = evt.dataTransfer,
				options = this.options;

			this._offUpEvents();

			if (activeGroup.pull == 'clone') {
				cloneEl = dragEl.cloneNode(true);
				_css(cloneEl, 'display', 'none');
				rootEl.insertBefore(cloneEl, dragEl);
			}

			if (useFallback) {

				if (useFallback === 'touch') {
					// Bind touch events
					_on(document, 'touchmove', this._onTouchMove);
					_on(document, 'touchend', this._onDrop);
					_on(document, 'touchcancel', this._onDrop);
				} else {
					// Old brwoser
					_on(document, 'mousemove', this._onTouchMove);
					_on(document, 'mouseup', this._onDrop);
				}

				this._loopId = setInterval(this._emulateDragOver, 50);
			}
			else {
				if (dataTransfer) {
					dataTransfer.effectAllowed = 'move';
					options.setData && options.setData.call(this, dataTransfer, dragEl);
				}

				_on(document, 'drop', this);
				setTimeout(this._dragStarted, 0);
			}
		},

		_onDragOver: function (/**Event*/evt) {
			var el = this.el,
				target,
				dragRect,
				revert,
				options = this.options,
				group = options.group,
				groupPut = group.put,
				isOwner = (activeGroup === group),
				canSort = options.sort;

			if (evt.preventDefault !== void 0) {
				evt.preventDefault();
				!options.dragoverBubble && evt.stopPropagation();
			}

			moved = true;

			if (activeGroup && !options.disabled &&
				(isOwner
					? canSort || (revert = !rootEl.contains(dragEl)) // Reverting item into the original list
					: activeGroup.pull && groupPut && (
						(activeGroup.name === group.name) || // by Name
						(groupPut.indexOf && ~groupPut.indexOf(activeGroup.name)) // by Array
					)
				) &&
				(evt.rootEl === void 0 || evt.rootEl === this.el) // touch fallback
			) {
				// Smart auto-scrolling
				_autoScroll(evt, options, this.el);

				if (_silent) {
					return;
				}

				target = _closest(evt.target, options.draggable, el);
				dragRect = dragEl.getBoundingClientRect();

				if (revert) {
					_cloneHide(true);

					if (cloneEl || nextEl) {
						rootEl.insertBefore(dragEl, cloneEl || nextEl);
					}
					else if (!canSort) {
						rootEl.appendChild(dragEl);
					}

					return;
				}


				if ((el.children.length === 0) || (el.children[0] === ghostEl) ||
					(el === evt.target) && (target = _ghostIsLast(el, evt))
				) {

					if (target) {
						if (target.animated) {
							return;
						}

						targetRect = target.getBoundingClientRect();
					}

					_cloneHide(isOwner);

					if (_onMove(rootEl, el, dragEl, dragRect, target, targetRect) !== false) {
						if (!dragEl.contains(el)) {
							el.appendChild(dragEl);
							parentEl = el; // actualization
						}

						this._animate(dragRect, dragEl);
						target && this._animate(targetRect, target);
					}
				}
				else if (target && !target.animated && target !== dragEl && (target.parentNode[expando] !== void 0)) {
					if (lastEl !== target) {
						lastEl = target;
						lastCSS = _css(target);
						lastParentCSS = _css(target.parentNode);
					}


					var targetRect = target.getBoundingClientRect(),
						width = targetRect.right - targetRect.left,
						height = targetRect.bottom - targetRect.top,
						floating = /left|right|inline/.test(lastCSS.cssFloat + lastCSS.display)
							|| (lastParentCSS.display == 'flex' && lastParentCSS['flex-direction'].indexOf('row') === 0),
						isWide = (target.offsetWidth > dragEl.offsetWidth),
						isLong = (target.offsetHeight > dragEl.offsetHeight),
						halfway = (floating ? (evt.clientX - targetRect.left) / width : (evt.clientY - targetRect.top) / height) > 0.5,
						nextSibling = target.nextElementSibling,
						moveVector = _onMove(rootEl, el, dragEl, dragRect, target, targetRect),
						after
					;

					if (moveVector !== false) {
						_silent = true;
						setTimeout(_unsilent, 30);

						_cloneHide(isOwner);

						if (moveVector === 1 || moveVector === -1) {
							after = (moveVector === 1);
						}
						else if (floating) {
							var elTop = dragEl.offsetTop,
								tgTop = target.offsetTop;

							if (elTop === tgTop) {
								after = (target.previousElementSibling === dragEl) && !isWide || halfway && isWide;
							} else {
								after = tgTop > elTop;
							}
						} else {
							after = (nextSibling !== dragEl) && !isLong || halfway && isLong;
						}

						if (!dragEl.contains(el)) {
							if (after && !nextSibling) {
								el.appendChild(dragEl);
							} else {
								target.parentNode.insertBefore(dragEl, after ? nextSibling : target);
							}
						}

						parentEl = dragEl.parentNode; // actualization

						this._animate(dragRect, dragEl);
						this._animate(targetRect, target);
					}
				}
			}
		},

		_animate: function (prevRect, target) {
			var ms = this.options.animation;

			if (ms) {
				var currentRect = target.getBoundingClientRect();

				_css(target, 'transition', 'none');
				_css(target, 'transform', 'translate3d('
					+ (prevRect.left - currentRect.left) + 'px,'
					+ (prevRect.top - currentRect.top) + 'px,0)'
				);

				target.offsetWidth; // repaint

				_css(target, 'transition', 'all ' + ms + 'ms');
				_css(target, 'transform', 'translate3d(0,0,0)');

				clearTimeout(target.animated);
				target.animated = setTimeout(function () {
					_css(target, 'transition', '');
					_css(target, 'transform', '');
					target.animated = false;
				}, ms);
			}
		},

		_offUpEvents: function () {
			var ownerDocument = this.el.ownerDocument;

			_off(document, 'touchmove', this._onTouchMove);
			_off(ownerDocument, 'mouseup', this._onDrop);
			_off(ownerDocument, 'touchend', this._onDrop);
			_off(ownerDocument, 'touchcancel', this._onDrop);
		},

		_onDrop: function (/**Event*/evt) {
			var el = this.el,
				options = this.options;

			clearInterval(this._loopId);
			clearInterval(autoScroll.pid);
			clearTimeout(this._dragStartTimer);

			// Unbind events
			_off(document, 'mousemove', this._onTouchMove);

			if (this.nativeDraggable) {
				_off(document, 'drop', this);
				_off(el, 'dragstart', this._onDragStart);
			}

			this._offUpEvents();

			if (evt) {
				if (moved) {
					evt.preventDefault();
					!options.dropBubble && evt.stopPropagation();
				}

				ghostEl && ghostEl.parentNode.removeChild(ghostEl);

				if (dragEl) {
					if (this.nativeDraggable) {
						_off(dragEl, 'dragend', this);
					}

					_disableDraggable(dragEl);

					// Remove class's
					_toggleClass(dragEl, this.options.ghostClass, false);
					_toggleClass(dragEl, this.options.chosenClass, false);

					if (rootEl !== parentEl) {
						newIndex = _index(dragEl);

						if (newIndex >= 0) {
							// drag from one list and drop into another
							_dispatchEvent(null, parentEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
							_dispatchEvent(this, rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);

							// Add event
							_dispatchEvent(null, parentEl, 'add', dragEl, rootEl, oldIndex, newIndex);

							// Remove event
							_dispatchEvent(this, rootEl, 'remove', dragEl, rootEl, oldIndex, newIndex);
						}
					}
					else {
						// Remove clone
						cloneEl && cloneEl.parentNode.removeChild(cloneEl);

						if (dragEl.nextSibling !== nextEl) {
							// Get the index of the dragged element within its parent
							newIndex = _index(dragEl);

							if (newIndex >= 0) {
								// drag & drop within the same list
								_dispatchEvent(this, rootEl, 'update', dragEl, rootEl, oldIndex, newIndex);
								_dispatchEvent(this, rootEl, 'sort', dragEl, rootEl, oldIndex, newIndex);
							}
						}
					}

					if (Sortable.active) {
						if (newIndex === null || newIndex === -1) {
							newIndex = oldIndex;
						}

						_dispatchEvent(this, rootEl, 'end', dragEl, rootEl, oldIndex, newIndex);

						// Save sorting
						this.save();
					}
				}

				// Nulling
				rootEl =
				dragEl =
				parentEl =
				ghostEl =
				nextEl =
				cloneEl =

				scrollEl =
				scrollParentEl =

				tapEvt =
				touchEvt =

				moved =
				newIndex =

				lastEl =
				lastCSS =

				activeGroup =
				Sortable.active = null;
			}
		},


		handleEvent: function (/**Event*/evt) {
			var type = evt.type;

			if (type === 'dragover' || type === 'dragenter') {
				if (dragEl) {
					this._onDragOver(evt);
					_globalDragOver(evt);
				}
			}
			else if (type === 'drop' || type === 'dragend') {
				this._onDrop(evt);
			}
		},


		/**
		 * Serializes the item into an array of string.
		 * @returns {String[]}
		 */
		toArray: function () {
			var order = [],
				el,
				children = this.el.children,
				i = 0,
				n = children.length,
				options = this.options;

			for (; i < n; i++) {
				el = children[i];
				if (_closest(el, options.draggable, this.el)) {
					order.push(el.getAttribute(options.dataIdAttr) || _generateId(el));
				}
			}

			return order;
		},


		/**
		 * Sorts the elements according to the array.
		 * @param  {String[]}  order  order of the items
		 */
		sort: function (order) {
			var items = {}, rootEl = this.el;

			this.toArray().forEach(function (id, i) {
				var el = rootEl.children[i];

				if (_closest(el, this.options.draggable, rootEl)) {
					items[id] = el;
				}
			}, this);

			order.forEach(function (id) {
				if (items[id]) {
					rootEl.removeChild(items[id]);
					rootEl.appendChild(items[id]);
				}
			});
		},


		/**
		 * Save the current sorting
		 */
		save: function () {
			var store = this.options.store;
			store && store.set(this);
		},


		/**
		 * For each element in the set, get the first element that matches the selector by testing the element itself and traversing up through its ancestors in the DOM tree.
		 * @param   {HTMLElement}  el
		 * @param   {String}       [selector]  default: `options.draggable`
		 * @returns {HTMLElement|null}
		 */
		closest: function (el, selector) {
			return _closest(el, selector || this.options.draggable, this.el);
		},


		/**
		 * Set/get option
		 * @param   {string} name
		 * @param   {*}      [value]
		 * @returns {*}
		 */
		option: function (name, value) {
			var options = this.options;

			if (value === void 0) {
				return options[name];
			} else {
				options[name] = value;

				if (name === 'group') {
					_prepareGroup(options);
				}
			}
		},


		/**
		 * Destroy
		 */
		destroy: function () {
			var el = this.el;

			el[expando] = null;

			_off(el, 'mousedown', this._onTapStart);
			_off(el, 'touchstart', this._onTapStart);

			if (this.nativeDraggable) {
				_off(el, 'dragover', this);
				_off(el, 'dragenter', this);
			}

			// Remove draggable attributes
			Array.prototype.forEach.call(el.querySelectorAll('[draggable]'), function (el) {
				el.removeAttribute('draggable');
			});

			touchDragOverListeners.splice(touchDragOverListeners.indexOf(this._onDragOver), 1);

			this._onDrop();

			this.el = el = null;
		}
	};


	function _cloneHide(state) {
		if (cloneEl && (cloneEl.state !== state)) {
			_css(cloneEl, 'display', state ? 'none' : '');
			!state && cloneEl.state && rootEl.insertBefore(cloneEl, dragEl);
			cloneEl.state = state;
		}
	}


	function _closest(/**HTMLElement*/el, /**String*/selector, /**HTMLElement*/ctx) {
		if (el) {
			ctx = ctx || document;
			selector = selector.split('.');

			var tag = selector.shift().toUpperCase(),
				re = new RegExp('\\s(' + selector.join('|') + ')(?=\\s)', 'g');

			do {
				if (
					(tag === '>*' && el.parentNode === ctx) || (
						(tag === '' || el.nodeName.toUpperCase() == tag) &&
						(!selector.length || ((' ' + el.className + ' ').match(re) || []).length == selector.length)
					)
				) {
					return el;
				}
			}
			while (el !== ctx && (el = el.parentNode));
		}

		return null;
	}


	function _globalDragOver(/**Event*/evt) {
		if (evt.dataTransfer) {
			evt.dataTransfer.dropEffect = 'move';
		}
		evt.preventDefault();
	}


	function _on(el, event, fn) {
		el.addEventListener(event, fn, false);
	}


	function _off(el, event, fn) {
		el.removeEventListener(event, fn, false);
	}


	function _toggleClass(el, name, state) {
		if (el) {
			if (el.classList) {
				el.classList[state ? 'add' : 'remove'](name);
			}
			else {
				var className = (' ' + el.className + ' ').replace(RSPACE, ' ').replace(' ' + name + ' ', ' ');
				el.className = (className + (state ? ' ' + name : '')).replace(RSPACE, ' ');
			}
		}
	}


	function _css(el, prop, val) {
		var style = el && el.style;

		if (style) {
			if (val === void 0) {
				if (document.defaultView && document.defaultView.getComputedStyle) {
					val = document.defaultView.getComputedStyle(el, '');
				}
				else if (el.currentStyle) {
					val = el.currentStyle;
				}

				return prop === void 0 ? val : val[prop];
			}
			else {
				if (!(prop in style)) {
					prop = '-webkit-' + prop;
				}

				style[prop] = val + (typeof val === 'string' ? '' : 'px');
			}
		}
	}


	function _find(ctx, tagName, iterator) {
		if (ctx) {
			var list = ctx.getElementsByTagName(tagName), i = 0, n = list.length;

			if (iterator) {
				for (; i < n; i++) {
					iterator(list[i], i);
				}
			}

			return list;
		}

		return [];
	}



	function _dispatchEvent(sortable, rootEl, name, targetEl, fromEl, startIndex, newIndex) {
		var evt = document.createEvent('Event'),
			options = (sortable || rootEl[expando]).options,
			onName = 'on' + name.charAt(0).toUpperCase() + name.substr(1);

		evt.initEvent(name, true, true);

		evt.to = rootEl;
		evt.from = fromEl || rootEl;
		evt.item = targetEl || rootEl;
		evt.clone = cloneEl;

		evt.oldIndex = startIndex;
		evt.newIndex = newIndex;

		rootEl.dispatchEvent(evt);

		if (options[onName]) {
			options[onName].call(sortable, evt);
		}
	}


	function _onMove(fromEl, toEl, dragEl, dragRect, targetEl, targetRect) {
		var evt,
			sortable = fromEl[expando],
			onMoveFn = sortable.options.onMove,
			retVal;

		evt = document.createEvent('Event');
		evt.initEvent('move', true, true);

		evt.to = toEl;
		evt.from = fromEl;
		evt.dragged = dragEl;
		evt.draggedRect = dragRect;
		evt.related = targetEl || toEl;
		evt.relatedRect = targetRect || toEl.getBoundingClientRect();

		fromEl.dispatchEvent(evt);

		if (onMoveFn) {
			retVal = onMoveFn.call(sortable, evt);
		}

		return retVal;
	}


	function _disableDraggable(el) {
		el.draggable = false;
	}


	function _unsilent() {
		_silent = false;
	}


	/** @returns {HTMLElement|false} */
	function _ghostIsLast(el, evt) {
		var lastEl = el.lastElementChild,
				rect = lastEl.getBoundingClientRect();

		return ((evt.clientY - (rect.top + rect.height) > 5) || (evt.clientX - (rect.right + rect.width) > 5)) && lastEl; // min delta
	}


	/**
	 * Generate id
	 * @param   {HTMLElement} el
	 * @returns {String}
	 * @private
	 */
	function _generateId(el) {
		var str = el.tagName + el.className + el.src + el.href + el.textContent,
			i = str.length,
			sum = 0;

		while (i--) {
			sum += str.charCodeAt(i);
		}

		return sum.toString(36);
	}

	/**
	 * Returns the index of an element within its parent
	 * @param  {HTMLElement} el
	 * @return {number}
	 */
	function _index(el) {
		var index = 0;

		if (!el || !el.parentNode) {
			return -1;
		}

		while (el && (el = el.previousElementSibling)) {
			if (el.nodeName.toUpperCase() !== 'TEMPLATE') {
				index++;
			}
		}

		return index;
	}

	function _throttle(callback, ms) {
		var args, _this;

		return function () {
			if (args === void 0) {
				args = arguments;
				_this = this;

				setTimeout(function () {
					if (args.length === 1) {
						callback.call(_this, args[0]);
					} else {
						callback.apply(_this, args);
					}

					args = void 0;
				}, ms);
			}
		};
	}

	function _extend(dst, src) {
		if (dst && src) {
			for (var key in src) {
				if (src.hasOwnProperty(key)) {
					dst[key] = src[key];
				}
			}
		}

		return dst;
	}


	// Export utils
	Sortable.utils = {
		on: _on,
		off: _off,
		css: _css,
		find: _find,
		is: function (el, selector) {
			return !!_closest(el, selector, el);
		},
		extend: _extend,
		throttle: _throttle,
		closest: _closest,
		toggleClass: _toggleClass,
		index: _index
	};


	/**
	 * Create sortable instance
	 * @param {HTMLElement}  el
	 * @param {Object}      [options]
	 */
	Sortable.create = function (el, options) {
		return new Sortable(el, options);
	};


	// Export
	Sortable.version = '1.4.2';
	return Sortable;
});


define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/common/ActionOverlay',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/common/ActionOverlay',['module', 'exports', 'react', 'lib-build/less!./ActionOverlay'], function (module, exports, _react) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function ActionOverlay(props) {
    function renderAction(action, className, callback) {
      if (!action) {
        className += ' op-hidden';
      }
      return _react2.default.createElement('span', { className: className, onClick: callback });
    }

    if (!props.showActions) {
      return null;
    } else if (!props.item.hasDelete && !props.item.hasDuplicate) {
      return null;
    } else {
      return _react2.default.createElement(
        'div',
        { className: 'op-action-overlay' },
        renderAction(props.item.hasDelete, 'action-icon glyphicon glyphicon-remove-circle', function (e) {
          props.callbacks.deleteItem(props.item.id);
          e.stopPropagation();
        }),
        renderAction(props.item.hasDuplicate, 'action-icon glyphicon glyphicon-duplicate', function (e) {
          props.callbacks.duplicateItem(props.item.id);
          e.stopPropagation();
        })
      );
    }
  }

  exports.default = ActionOverlay;
  module.exports = exports['default'];
});
//# sourceMappingURL=ActionOverlay.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/common/ItemMain',[],function(){});

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/builderOverview/ItemMain',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/builderOverview/ItemMain',['module', 'exports', 'react', './../common/ActionOverlay', 'lib-build/less!./../common/ItemMain', 'lib-build/less!./ItemMain'], function (module, exports, _react, _ActionOverlay) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _ActionOverlay2 = _interopRequireDefault(_ActionOverlay);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function ItemMain(props) {
    var mainClassName = 'op-item-main builder-overview ' + props.item.size;

    var renderInnerContent = function renderInnerContent() {
      if (props.item.showTitleBar) {
        return _react2.default.createElement(
          'div',
          { className: 'title-bar' },
          _react2.default.createElement(
            'span',
            { className: 'title' },
            _react2.default.createElement('span', { className: props.item.icon + ' icon' }),
            props.item.title
          )
        );
      } else if (props.item.icon) {
        return _react2.default.createElement(
          'span',
          { className: 'item-icon' },
          _react2.default.createElement('span', { className: props.item.icon + ' icon' })
        );
      } else if (props.item.text) {
        return _react2.default.createElement(
          'div',
          { className: 'text-overlay' },
          _react2.default.createElement(
            'p',
            { className: 'item-text' },
            props.item.text
          )
        );
      } else {
        return null;
      }
    };

    var renderLabel = function renderLabel() {
      if (props.item.label) {
        return _react2.default.createElement(
          'div',
          { className: 'item-label' },
          props.item.label
        );
      } else {
        return null;
      }
    };

    return _react2.default.createElement(
      'div',
      { style: { backgroundImage: 'url(' + props.item.thumbnail + ')' }, className: mainClassName },
      renderInnerContent(),
      renderLabel(),
      _react2.default.createElement(_ActionOverlay2.default, props)
    );
  }

  exports.default = ItemMain;
  module.exports = exports['default'];
});
//# sourceMappingURL=ItemMain.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/builderOverview/ItemMainButton',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/builderOverview/ItemMainButton',['module', 'exports', 'react', './../common/ActionOverlay', 'lib-build/less!./../common/ItemMain', 'lib-build/less!./ItemMainButton'], function (module, exports, _react, _ActionOverlay) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _ActionOverlay2 = _interopRequireDefault(_ActionOverlay);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function ItemMainButton(props) {

    return _react2.default.createElement(
      'div',
      { className: 'op-item-main item-button' },
      _react2.default.createElement(
        'div',
        null,
        props.item.label
      ),
      _react2.default.createElement(_ActionOverlay2.default, props)
    );
  }

  exports.default = ItemMainButton;
  module.exports = exports['default'];
});
//# sourceMappingURL=ItemMainButton.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/common/Item',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/builderOverview/Item',['module', 'exports', 'react', './ItemMain', './ItemMainButton', 'lib-build/less!./../common/Item'], function (module, exports, _react, _ItemMain, _ItemMainButton) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _ItemMain2 = _interopRequireDefault(_ItemMain);

  var _ItemMainButton2 = _interopRequireDefault(_ItemMainButton);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var Item = function (_React$Component) {
    _inherits(Item, _React$Component);

    function Item() {
      _classCallCheck(this, Item);

      var _this = _possibleConstructorReturn(this, (Item.__proto__ || Object.getPrototypeOf(Item)).call(this));

      _this.state = {
        showActions: false
      };

      _this.renderInnerItem = _this.renderInnerItem.bind(_this);
      return _this;
    }

    _createClass(Item, [{
      key: 'renderInnerItem',
      value: function renderInnerItem() {
        var _this2 = this;

        var InnerComponent = _ItemMain2.default;
        var className = 'op-item';

        if (this.props.item.style === 'button') {
          InnerComponent = _ItemMainButton2.default;
        }

        if (this.props.selected) {
          className += ' selected';
        }
        if (!this.props.item.hasOrganize) {
          className += ' undraggable';
        }
        if (this.props.organize) {
          className += ' organize';
        }
        if (this.props.item.style == 'simple-text') {
          className += ' style-simple-text';
        }

        return _react2.default.createElement(
          'div',
          {
            className: className,
            onClick: function onClick() {
              // only do this if not in organize mode
              if (!_this2.props.organize) {
                _this2.props.onItemClicked(_this2.props.item.id);
                _this2.props.callbacks.selectItem(_this2.props.item.id);
              }
            },
            onMouseOver: function onMouseOver() {
              // show actions if not in organize mode and if hovered over.
              if (!_this2.props.organize) {
                _this2.setState({
                  showActions: true
                });
              }
            },

            onMouseLeave: function onMouseLeave() {
              _this2.setState({
                showActions: false
              });
            },

            'data-id': this.props.item.id
          },
          _react2.default.createElement(InnerComponent, _extends({
            showActions: this.state.showActions
          }, this.props))
        );
      }
    }, {
      key: 'render',
      value: function render() {
        return this.renderInnerItem();
      }
    }]);

    return Item;
  }(_react2.default.Component);

  exports.default = Item;
  module.exports = exports['default'];
});
//# sourceMappingURL=Item.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/InlineAdd',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/InlineAdd',['module', 'exports', 'react', 'lib-build/less!./InlineAdd'], function (module, exports, _react) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var InlineAdd = function (_React$Component) {
    _inherits(InlineAdd, _React$Component);

    function InlineAdd() {
      _classCallCheck(this, InlineAdd);

      var _this = _possibleConstructorReturn(this, (InlineAdd.__proto__ || Object.getPrototypeOf(InlineAdd)).call(this));

      _this.state = {
        hovered: false
      };
      return _this;
    }

    _createClass(InlineAdd, [{
      key: 'render',
      value: function render() {
        var _this2 = this;

        var inlineAddButton = null;

        // show it if not on org mode
        if (!this.props.organize) {
          inlineAddButton = _react2.default.createElement(
            'span',
            {
              className: 'add-button',
              onClick: function onClick() {
                _this2.props.addItem(_this2.props.index);
              }
            },
            _react2.default.createElement('span', { className: 'icon glyphicon glyphicon-plus' })
          );
        }

        return _react2.default.createElement(
          'div',
          {
            className: 'op-inline-add-container',
            onMouseEnter: function onMouseEnter() {
              _this2.setState({
                hovered: true
              });
            },
            onMouseLeave: function onMouseLeave() {
              _this2.setState({
                hovered: false
              });
            }
          },
          inlineAddButton
        );
      }
    }]);

    return InlineAdd;
  }(_react2.default.Component);

  exports.default = InlineAdd;
  module.exports = exports['default'];
});
//# sourceMappingURL=InlineAdd.js.map
;
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define('react-bootstrap',["react","react-dom"],t):"object"==typeof exports?exports.ReactBootstrap=t(require("react"),require("react-dom")):e.ReactBootstrap=t(e.React,e.ReactDOM)}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(2)["default"],o=n(48)["default"];t.__esModule=!0;var s=n(121),a=r(s);t.Accordion=a["default"];var l=n(122),i=r(l);t.Alert=i["default"];var u=n(123),p=r(u);t.Badge=p["default"];var d=n(124),f=r(d);t.Breadcrumb=f["default"];var c=n(64),h=r(c);t.BreadcrumbItem=h["default"];var y=n(20),v=r(y);t.Button=v["default"];var m=n(65),b=r(m);t.ButtonGroup=b["default"];var g=n(125),T=r(g);t.ButtonInput=T["default"];var x=n(126),P=r(x);t.ButtonToolbar=P["default"];var C=n(127),E=r(C);t.Carousel=E["default"];var _=n(66),N=r(_);t.CarouselItem=N["default"];var O=n(129),S=r(O);t.Checkbox=S["default"];var w=n(130),k=r(w);t.Clearfix=k["default"];var M=n(131),I=r(M);t.ControlLabel=I["default"];var D=n(67),A=r(D);t.Col=A["default"];var R=n(42),L=r(R);t.Collapse=L["default"];var j=n(30),K=r(j);t.Dropdown=K["default"];var F=n(132),B=r(F);t.DropdownButton=B["default"];var H=n(31),U=r(H);t.Fade=U["default"];var W=n(134),$=r(W);t.Form=$["default"];var z=n(135),G=r(z);t.FormControl=G["default"];var V=n(43),q=r(V);t.FormGroup=q["default"];var Y=n(32),X=r(Y);t.Glyphicon=X["default"];var Z=n(70),J=r(Z);t.Grid=J["default"];var Q=n(139),ee=r(Q);t.HelpBlock=ee["default"];var te=n(140),ne=r(te);t.Image=ne["default"];var re=n(141),oe=r(re);t.Input=oe["default"];var se=n(142),ae=r(se);t.InputGroup=ae["default"];var le=n(71),ie=r(le);t.Interpolate=ie["default"];var ue=n(145),pe=r(ue);t.Jumbotron=pe["default"];var de=n(146),fe=r(de);t.Label=fe["default"];var ce=n(147),he=r(ce);t.ListGroup=he["default"];var ye=n(72),ve=r(ye);t.ListGroupItem=ve["default"];var me=n(148),be=r(me);t.Media=be["default"];var ge=n(155),Te=r(ge);t.MenuItem=Te["default"];var xe=n(156),Pe=r(xe);t.Modal=Pe["default"];var Ce=n(73),Ee=r(Ce);t.ModalBody=Ee["default"];var _e=n(74),Ne=r(_e);t.ModalFooter=Ne["default"];var Oe=n(75),Se=r(Oe);t.ModalHeader=Se["default"];var we=n(76),ke=r(we);t.ModalTitle=ke["default"];var Me=n(77),Ie=r(Me);t.Nav=Ie["default"];var De=n(159),Ae=r(De);t.Navbar=Ae["default"];var Re=n(79),Le=r(Re);t.NavbarBrand=Le["default"];var je=n(158),Ke=r(je);t.NavDropdown=Ke["default"];var Fe=n(78),Be=r(Fe);t.NavItem=Be["default"];var He=n(80),Ue=r(He);t.Overlay=Ue["default"];var We=n(163),$e=r(We);t.OverlayTrigger=$e["default"];var ze=n(164),Ge=r(ze);t.PageHeader=Ge["default"];var Ve=n(165),qe=r(Ve);t.PageItem=qe["default"];var Ye=n(166),Xe=r(Ye);t.Pager=Xe["default"];var Ze=n(167),Je=r(Ze);t.Pagination=Je["default"];var Qe=n(169),et=r(Qe);t.Panel=et["default"];var tt=n(81),nt=r(tt);t.PanelGroup=nt["default"];var rt=n(170),ot=r(rt);t.Popover=ot["default"];var st=n(171),at=r(st);t.ProgressBar=at["default"];var lt=n(172),it=r(lt);t.Radio=it["default"];var ut=n(173),pt=r(ut);t.ResponsiveEmbed=pt["default"];var dt=n(174),ft=r(dt);t.Row=ft["default"];var ct=n(16),ht=r(ct);t.SafeAnchor=ht["default"];var yt=n(175),vt=r(yt);t.SplitButton=vt["default"];var mt=n(177),bt=r(mt);t.Tab=bt["default"];var gt=n(45),Tt=r(gt);t.TabContainer=Tt["default"];var xt=n(46),Pt=r(xt);t.TabContent=Pt["default"];var Ct=n(178),Et=r(Ct);t.Table=Et["default"];var _t=n(82),Nt=r(_t);t.TabPane=Nt["default"];var Ot=n(179),St=r(Ot);t.Tabs=St["default"];var wt=n(180),kt=r(wt);t.Thumbnail=kt["default"];var Mt=n(181),It=r(Mt);t.Tooltip=It["default"];var Dt=n(182),At=r(Dt);t.Well=At["default"];var Rt=n(69),Lt=o(Rt);t.FormControls=Lt;var jt=n(186),Kt=o(jt);t.utils=Kt},function(t,n){t.exports=e},function(e,t){"use strict";t["default"]=function(e){return e&&e.__esModule?e:{"default":e}},t.__esModule=!0},function(e,t,n){"use strict";var r=n(26)["default"];t["default"]=r||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.__esModule=!0},function(e,t,n){var r,o;/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r))e.push(n.apply(null,r));else if("object"===o)for(var a in r)s.call(r,a)&&r[a]&&e.push(a)}}return e.join(" ")}var s={}.hasOwnProperty;"undefined"!=typeof e&&e.exports?e.exports=n:(r=[],o=function(){return n}.apply(t,r),!(void 0!==o&&(e.exports=o)))}()},function(e,t,n){"use strict";function r(e){return function(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var o=n[n.length-1];return"function"==typeof o?e.apply(void 0,n):function(t){return e.apply(void 0,n.concat([t]))}}}function o(e,t){return void 0===e&&(e={}),(e.bsClass||"").trim()?void 0:c["default"](!1),e.bsClass+(t?"-"+t:"")}function s(e){var t,n=(t={},t[o(e)]=!0,t);if(e.bsSize){var r=d["default"].SIZES[e.bsSize]||r;n[o(e,r)]=!0}return e.bsStyle&&(n[o(e,e.bsStyle)]=!0),n}function a(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];y(n,e)}var l=n(3)["default"],i=n(2)["default"];t.__esModule=!0,t.prefix=o,t.getClassSet=s,t.addStyle=a;var u=n(1),p=n(10),d=i(p),f=n(52),c=i(f),h=r(function(e,t){var n=t.propTypes||(t.propTypes={}),r=t.defaultProps||(t.defaultProps={});return n.bsClass=u.PropTypes.string,r.bsClass=e,t});t.bsClass=h;var y=r(function(e,t,n){"string"!=typeof t&&(n=t,t=void 0);var r=n.STYLES||[],o=n.propTypes||{};e.forEach(function(e){-1===r.indexOf(e)&&r.push(e)});var s=u.PropTypes.oneOf(r);if(n.STYLES=s._values=r,n.propTypes=l({},o,{bsStyle:s}),void 0!==t){var a=n.defaultProps||(n.defaultProps={});a.bsStyle=t}return n});t.bsStyles=y;var v=r(function(e,t,n){"string"!=typeof t&&(n=t,t=void 0);var r=n.SIZES||[],o=n.propTypes||{};e.forEach(function(e){-1===r.indexOf(e)&&r.push(e)});var s=[];r.forEach(function(e){var t=d["default"].SIZES[e];t&&t!==e&&s.push(t),s.push(e)});var a=u.PropTypes.oneOf(s);return a._values=s,n.SIZES=r,n.propTypes=l({},o,{bsSize:a}),void 0!==t&&(n.defaultProps||(n.defaultProps={}),n.defaultProps.bsSize=t),n});t.bsSizes=v;var m=r;t._curry=m},function(e,t){"use strict";t["default"]=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},t.__esModule=!0},function(e,t){"use strict";t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.__esModule=!0},function(e,t,n){"use strict";var r=n(84)["default"],o=n(187)["default"];t["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=r(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o?o(e,t):e.__proto__=t)},t.__esModule=!0},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=l.errMsg(e,t,n,". Expected an Element `type`");if("function"!=typeof e[t]){if(a["default"].isValidElement(e[t]))return new Error(r+", not an actual Element");if("string"!=typeof e[t])return new Error(r+" such as a tag name or return value of React.createClass(...)")}}t.__esModule=!0;var s=n(1),a=r(s),l=n(120);t["default"]=l.createChainableTypeChecker(o),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(26)["default"],o=n(84)["default"],s=n(17)["default"];t.__esModule=!0;var a=function(e){return r(o({values:function(){var e=this;return s(this).map(function(t){return e[t]})}}),e)},l={SIZES:{large:"lg",medium:"md",small:"sm",xsmall:"xs",lg:"lg",md:"md",sm:"sm",xs:"xs"},GRID_COLUMNS:12},i=a({LARGE:"large",MEDIUM:"medium",SMALL:"small",XSMALL:"xsmall"});t.Sizes=i;var u=a({SUCCESS:"success",WARNING:"warning",DANGER:"danger",INFO:"info"});t.State=u;var p="default";t.DEFAULT=p;var d="primary";t.PRIMARY=d;var f="link";t.LINK=f;var c="inverse";t.INVERSE=c,t["default"]=l},function(e,t,n){"use strict";function r(e,t,n){var r=0;return d["default"].Children.map(e,function(e){return d["default"].isValidElement(e)?t.call(n,e,r++):e})}function o(e,t,n){var r=0;d["default"].Children.forEach(e,function(e){d["default"].isValidElement(e)&&t.call(n,e,r++)})}function s(e){var t=0;return d["default"].Children.forEach(e,function(e){d["default"].isValidElement(e)&&++t}),t}function a(e,t,n){var r=0,o=[];return d["default"].Children.forEach(e,function(e){d["default"].isValidElement(e)&&t.call(n,e,r++)&&o.push(e)}),o}function l(e,t,n){var r=0,o=void 0;return d["default"].Children.forEach(e,function(e){o||d["default"].isValidElement(e)&&t.call(n,e,r++)&&(o=e)}),o}function i(e,t,n){var r=0,o=!1;return d["default"].Children.forEach(e,function(e){o||d["default"].isValidElement(e)&&t.call(n,e,r++)&&(o=!0)}),o}var u=n(2)["default"];t.__esModule=!0;var p=n(1),d=u(p);t["default"]={map:r,forEach:o,count:s,find:l,filter:a,some:i},e.exports=t["default"]},function(e,t){"use strict";function n(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return t.filter(function(e){return null!=e}).reduce(function(e,t){if("function"!=typeof t)throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];e.apply(this,r),t.apply(this,r)}},null)}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,n){e.exports=t},function(e,t,n){"use strict";var r=function(){};e.exports=r},function(e,t,n){function r(e){if(a.unindexedChars&&s(e)){for(var t=-1,n=e.length,r=Object(e);++t<n;)r[t]=e.charAt(t);return r}return o(e)?e:Object(e)}var o=n(19),s=n(57),a=n(61);e.exports=r},function(e,t,n){"use strict";function r(e){return!e||"#"===e.trim()}var o=n(8)["default"],s=n(7)["default"],a=n(3)["default"],l=n(6)["default"],i=n(2)["default"];t.__esModule=!0;var u=n(1),p=i(u),d=n(9),f=i(d),c=function(e){function t(n){s(this,t),e.call(this,n),this.handleClick=this.handleClick.bind(this)}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.href,n=e.role,o=e.tabIndex,s=e.disabled,i=e.style,u=l(e,["href","role","tabIndex","disabled","style"]),d=this.props.componentClass||"a";return r(t)&&(n=n||"button",t=t||""),s&&(o=-1,i=a({pointerEvents:"none"},i)),p["default"].createElement(d,a({},u,{role:n,href:t,style:i,tabIndex:o,onClick:this.handleClick}))},t.prototype.handleClick=function(e){var t=this.props,n=t.disabled,o=t.href,s=t.onClick;return(n||r(o))&&e.preventDefault(),n?void e.stopPropagation():void(s&&s(e))},t}(p["default"].Component);t["default"]=c,c.propTypes={href:p["default"].PropTypes.string,onClick:p["default"].PropTypes.func,disabled:p["default"].PropTypes.bool,role:p["default"].PropTypes.string,tabIndex:p["default"].PropTypes.oneOfType([p["default"].PropTypes.number,p["default"].PropTypes.string]),componentClass:f["default"]},e.exports=t["default"]},function(e,t,n){e.exports={"default":n(190),__esModule:!0}},function(e,t,n){var r=n(36),o=n(24),s=n(22),a="[object Array]",l=Object.prototype,i=l.toString,u=r(Array,"isArray"),p=u||function(e){return s(e)&&o(e.length)&&i.call(e)==a};e.exports=p},function(e,t){function n(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=n},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(9),f=a(d),c=n(10),h=n(5),y=n(16),v=a(y),m=c.State.values().concat(c.DEFAULT,c.PRIMARY,c.LINK),b=["button","reset","submit"],g=function(e){function t(n,r){o(this,t),e.call(this,n,r)}return r(t,e),t.prototype.render=function(){var e,t=this.props.navDropdown?{}:h.getClassSet(this.props),n=void 0,r=h.prefix(this.props,"block");return t=s((e={active:this.props.active},e[r]=this.props.block,e),t),this.props.navItem?this.renderNavItem(t):(n=this.props.href||this.props.target||this.props.navDropdown?"renderAnchor":"renderButton",this[n](t))},t.prototype.renderAnchor=function(e){var t=this.props,n=t.disabled,r=t.href;return e.disabled=n,p["default"].createElement(v["default"],s({},this.props,{href:r||"#",className:i["default"](this.props.className,e)}),this.props.children)},t.prototype.renderButton=function(e){var t=this.props.componentClass||"button";return p["default"].createElement(t,s({},this.props,{type:this.props.type||"button",className:i["default"](this.props.className,e)}),this.props.children)},t.prototype.renderNavItem=function(e){var t={active:this.props.active};return p["default"].createElement("li",{className:i["default"](t)},this.renderAnchor(e))},t}(p["default"].Component);g.propTypes={active:p["default"].PropTypes.bool,disabled:p["default"].PropTypes.bool,block:p["default"].PropTypes.bool,navItem:p["default"].PropTypes.bool,navDropdown:p["default"].PropTypes.bool,onClick:p["default"].PropTypes.func,componentClass:f["default"],href:p["default"].PropTypes.string,target:p["default"].PropTypes.string,type:p["default"].PropTypes.oneOf(b)},g.defaultProps={active:!1,block:!1,disabled:!1,navItem:!1,navDropdown:!1},g.types=b,t["default"]=h.bsStyles(m,c.DEFAULT,h.bsSizes([c.Sizes.LARGE,c.Sizes.SMALL,c.Sizes.XSMALL],h.bsClass("btn",g))),e.exports=t["default"]},function(e,t){"use strict";e.exports=!("undefined"==typeof window||!window.document||!window.document.createElement)},function(e,t){function n(e){return!!e&&"object"==typeof e}e.exports=n},function(e,t){"use strict";function n(e){return e&&e.ownerDocument||document}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&r>=e}var r=9007199254740991;e.exports=n},function(e,t,n){"use strict";function r(e,t,n){var r=void 0;"object"==typeof e?r=e.message:(r=e+" is deprecated. Use "+t+" instead.",n&&(r+="\nYou can read more about it at "+n)),u[r]||(u[r]=!0)}function o(){u={}}var s=n(8)["default"],a=n(7)["default"],l=n(2)["default"];t.__esModule=!0,t._resetWarned=o;var i=n(14),u=(l(i),{});r.wrapper=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;t>o;o++)n[o-1]=arguments[o];return function(e){function t(){a(this,t),e.apply(this,arguments)}return s(t,e),t.prototype.componentWillMount=function(){if(r.apply(void 0,n),e.prototype.componentWillMount){for(var t,o=arguments.length,s=Array(o),a=0;o>a;a++)s[a]=arguments[a];(t=e.prototype.componentWillMount).call.apply(t,[this].concat(s))}},t}(e)},t["default"]=r},function(e,t,n){e.exports={"default":n(188),__esModule:!0}},function(e,t){var n=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";var r=n(21),o=function(){var e=r&&document.documentElement;return e&&e.contains?function(e,t){return e.contains(t)}:e&&e.compareDocumentPosition?function(e,t){return e===t||!!(16&e.compareDocumentPosition(t))}:function(e,t){if(t)do if(t===e)return!0;while(t=t.parentNode);return!1}}();e.exports=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var o=n(13),s=r(o),a=n(23),l=r(a);t["default"]=function(e){return l["default"](s["default"].findDOMNode(e))},e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(89),p=a(u),d=n(28),f=a(d),c=n(53),h=a(c),y=n(219),v=a(y),m=n(60),b=a(m),g=n(1),T=a(g),x=n(13),P=a(x),C=n(38),E=a(C),_=n(9),N=a(_),O=n(40),S=a(O),w=n(41),k=a(w),M=n(5),I=n(12),D=a(I),A=n(183),R=a(A),L=n(11),j=a(L),K=n(65),F=a(K),B=n(133),H=a(B),U=n(68),W=a(U),$="toggle-btn",z=W["default"].defaultProps.bsRole,G=H["default"].defaultProps.bsRole,V=function(e){function t(n){o(this,t),e.call(this,n),this.Toggle=W["default"],this.toggleOpen=this.toggleOpen.bind(this),this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleClose=this.handleClose.bind(this),this.extractChildren=this.extractChildren.bind(this),this.refineMenu=this.refineMenu.bind(this),this.refineToggle=this.refineToggle.bind(this),this.childExtractors=[{key:"toggle",matches:function(e){return e.props.bsRole===z},refine:this.refineToggle},{key:"menu",exclusive:!0,matches:function(e){return e.props.bsRole===G},refine:this.refineMenu}],this.state={},this.lastOpenEventType=null}return r(t,e),t.prototype.componentDidMount=function(){this.focusNextOnOpen()},t.prototype.componentWillUpdate=function(e){!e.open&&this.props.open&&(this._focusInDropdown=f["default"](P["default"].findDOMNode(this.refs.menu),p["default"](document)))},t.prototype.componentDidUpdate=function(e){this.props.open&&!e.open&&this.focusNextOnOpen(),!this.props.open&&e.open&&this._focusInDropdown&&(this._focusInDropdown=!1,this.focus())},t.prototype.render=function(){var e,t=this.extractChildren(),n=this.props.componentClass,r=b["default"](this.props,["id","bsClass","role","onSelect"]),o=M.prefix(this.props),a=(e={open:this.props.open,disabled:this.props.disabled},e[o]=!this.props.dropup,e.dropup=this.props.dropup,e);return T["default"].createElement(n,s({},r,{className:i["default"](this.props.className,a)}),t)},t.prototype.toggleOpen=function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],t=!this.props.open;t&&(this.lastOpenEventType=e),this.props.onToggle&&this.props.onToggle(t)},t.prototype.handleClick=function(){this.props.disabled||this.toggleOpen("click")},t.prototype.handleKeyDown=function(e){if(!this.props.disabled)switch(e.keyCode){case h["default"].codes.down:this.props.open?this.refs.menu.focusNext&&this.refs.menu.focusNext():this.toggleOpen("keydown"),e.preventDefault();break;case h["default"].codes.esc:case h["default"].codes.tab:this.handleClose(e)}},t.prototype.handleClose=function(){this.props.open&&this.toggleOpen()},t.prototype.focusNextOnOpen=function(){var e=this.refs.menu;e.focusNext&&("keydown"!==this.lastOpenEventType&&"menuitem"!==this.props.role||e.focusNext())},t.prototype.focus=function(){var e=P["default"].findDOMNode(this.refs[$]);e&&e.focus&&e.focus()},t.prototype.extractChildren=function(){var e=this,t=!!this.props.open,n={};return j["default"].map(this.props.children,function(r){var o=v["default"](e.childExtractors,function(e){return e.matches(r)});if(o){if(n[o.key])return!1;n[o.key]=o.exclusive,r=o.refine(r,t)}return r})},t.prototype.refineMenu=function(e,t){var n={ref:"menu",open:t,labelledBy:this.props.id,pullRight:this.props.pullRight,bsClass:this.props.bsClass};return n.onClose=D["default"](e.props.onClose,this.props.onClose,this.handleClose),n.onSelect=D["default"](e.props.onSelect,this.props.onSelect,this.handleClose),g.cloneElement(e,n,e.props.children)},t.prototype.refineToggle=function(e,t){var n={open:t,id:this.props.id,ref:$,role:this.props.role};return n.onClick=D["default"](e.props.onClick,this.handleClick),n.onKeyDown=D["default"](e.props.onKeyDown,this.handleKeyDown),g.cloneElement(e,n,e.props.children)},t}(T["default"].Component);V.Toggle=W["default"],V.TOGGLE_REF=$,V.TOGGLE_ROLE=z,V.MENU_ROLE=G,V.defaultProps={componentClass:F["default"],bsClass:"dropdown"},V.propTypes={bsClass:T["default"].PropTypes.string,dropup:T["default"].PropTypes.bool,id:S["default"](T["default"].PropTypes.oneOfType([T["default"].PropTypes.string,T["default"].PropTypes.number])),componentClass:N["default"],children:E["default"](R["default"].requiredRoles(z,G),R["default"].exclusiveRoles(G)),disabled:T["default"].PropTypes.bool,pullRight:T["default"].PropTypes.bool,open:T["default"].PropTypes.bool,onClose:T["default"].PropTypes.func,onToggle:T["default"].PropTypes.func,onSelect:T["default"].PropTypes.func,role:T["default"].PropTypes.string},V=k["default"](V,{open:"onToggle"}),V.Toggle=W["default"],V.Menu=H["default"],t["default"]=V,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(1),i=a(l),u=n(4),p=a(u),d=n(115),f=a(d),c=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props.timeout;return i["default"].createElement(f["default"],s({},this.props,{timeout:e,className:p["default"](this.props.className,"fade"),enteredClassName:"in",enteringClassName:"in"}),this.props.children)},t}(i["default"].Component);c.propTypes={"in":i["default"].PropTypes.bool,unmountOnExit:i["default"].PropTypes.bool,transitionAppear:i["default"].PropTypes.bool,timeout:i["default"].PropTypes.number,onEnter:i["default"].PropTypes.func,onEntering:i["default"].PropTypes.func,onEntered:i["default"].PropTypes.func,onExit:i["default"].PropTypes.func,onExiting:i["default"].PropTypes.func,onExited:i["default"].PropTypes.func},c.defaultProps={"in":!1,timeout:300,unmountOnExit:!1,transitionAppear:!1},t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(39),p=o(u),d=i["default"].createClass({displayName:"Glyphicon",propTypes:{bsClass:i["default"].PropTypes.string,glyph:i["default"].PropTypes.string.isRequired,formControlFeedback:p["default"](i["default"].PropTypes.bool,"Use `<FormControl.Feedback>`.")},getDefaultProps:function(){return{bsClass:"glyphicon"}},render:function(){var e,t=a["default"](this.props.className,(e={},e[this.props.bsClass]=!0,e["glyphicon-"+this.props.glyph]=!0,e["form-control-feedback"]=this.props.formControlFeedback,e));return i["default"].createElement("span",r({},this.props,{className:t}),this.props.children)}});t["default"]=d,e.exports=t["default"]},function(e,t){"use strict";e.exports=function(e){return e===e.window?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}},function(e,t,n){"use strict";var r=n(95),o=n(217),s=n(212),a=n(213),l=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var i="",u=t;if("string"==typeof t){if(void 0===n)return e.style[r(t)]||s(e).getPropertyValue(o(t));(u={})[t]=n}for(var p in u)l.call(u,p)&&(u[p]||0===u[p]?i+=o(p)+":"+u[p]+";":a(e,o(p)));e.style.cssText+=";"+i}},function(e,t,n){var r,o,s;!function(n,a){o=[t],r=a,s="function"==typeof r?r.apply(t,o):r,!(void 0!==s&&(e.exports=s))}(this,function(e){var t=e;t.interopRequireDefault=function(e){return e&&e.__esModule?e:{"default":e}},t._extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}})},function(e,t,n){function r(e,t){var n=null==e?void 0:e[t];return o(n)?n:void 0}var o=n(252);e.exports=r},function(e,t,n){var r=n(98),o=n(54),s=n(108),a=n(109),l=n(97),i=l(function(e,t){return null==e?{}:"function"==typeof t[0]?a(e,o(t[0],t[1],3)):s(e,r(t))});e.exports=i},function(e,t){"use strict";function n(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];if(void 0===t)throw new Error("No validations provided");if(t.some(function(e){return"function"!=typeof e}))throw new Error("Invalid arguments, must be functions");if(0===t.length)throw new Error("No validations provided");return function(e,n,r){for(var o=0;o<t.length;o++){var s=t[o](e,n,r);if(void 0!==s&&null!==s)return s}}}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return function(n,r,o){return null!=n[r]&&a["default"](!1,'"'+r+'" property of "'+o+'" has been deprecated.\n'+t),e(n,r,o)}}t.__esModule=!0,t["default"]=o;var s=n(14),a=r(s);e.exports=t["default"]},function(e,t){"use strict";function n(e){return function(t,n,r){return null==t[n]?new Error("The prop '"+n+"' is required to make '"+r+"' accessible for users using assistive technologies such as screen readers"):e(t,n,r)}}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o){n&&(e._notifying=!0,n.call.apply(n,[e,r].concat(o)),e._notifying=!1),e._values[t]=r,e.isMounted()&&e.forceUpdate()}t.__esModule=!0;var s=n(265),a=r(s),l={shouldComponentUpdate:function(){return!this._notifying}};t["default"]=a["default"]([l],o),e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){var n=t["offset"+b(e)],r=T[e];return n+parseInt(u["default"](t,r[0]),10)+parseInt(u["default"](t,r[1]),10)}var o=n(8)["default"],s=n(7)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(34),u=l(i),p=n(1),d=l(p),f=n(4),c=l(f),h=n(115),y=l(h),v=n(12),m=l(v),b=function(e){return e[0].toUpperCase()+e.substr(1)},g=function(e){return e.offsetHeight},T={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]},x=function(e){function t(n,r){s(this,t),e.call(this,n,r),this.onEnterListener=this.handleEnter.bind(this),this.onEnteringListener=this.handleEntering.bind(this),this.onEnteredListener=this.handleEntered.bind(this),this.onExitListener=this.handleExit.bind(this),this.onExitingListener=this.handleExiting.bind(this)}return o(t,e),t.prototype.render=function(){var e=m["default"](this.onEnterListener,this.props.onEnter),t=m["default"](this.onEnteringListener,this.props.onEntering),n=m["default"](this.onEnteredListener,this.props.onEntered),r=m["default"](this.onExitListener,this.props.onExit),o=m["default"](this.onExitingListener,this.props.onExiting);return d["default"].createElement(y["default"],a({ref:"transition"},this.props,{"aria-expanded":this.props.role?this.props["in"]:null,className:c["default"](this.props.className,{width:"width"===this._dimension()}),exitedClassName:"collapse",exitingClassName:"collapsing",enteredClassName:"collapse in",enteringClassName:"collapsing",onEnter:e,onEntering:t,onEntered:n,onExit:r,onExiting:o,onExited:this.props.onExited}),this.props.children)},t.prototype.handleEnter=function(e){var t=this._dimension();e.style[t]="0"},t.prototype.handleEntering=function(e){var t=this._dimension();e.style[t]=this._getScrollDimensionValue(e,t)},t.prototype.handleEntered=function(e){var t=this._dimension();e.style[t]=null},t.prototype.handleExit=function(e){var t=this._dimension();e.style[t]=this.props.getDimensionValue(t,e)+"px"},t.prototype.handleExiting=function(e){var t=this._dimension();g(e),e.style[t]="0"},t.prototype._dimension=function(){return"function"==typeof this.props.dimension?this.props.dimension():this.props.dimension},t.prototype._getTransitionInstance=function(){return this.refs.transition},t.prototype._getScrollDimensionValue=function(e,t){return e["scroll"+b(t)]+"px"},t}(d["default"].Component);x.propTypes={"in":d["default"].PropTypes.bool,unmountOnExit:d["default"].PropTypes.bool,transitionAppear:d["default"].PropTypes.bool,timeout:d["default"].PropTypes.number,onEnter:d["default"].PropTypes.func,onEntering:d["default"].PropTypes.func,onEntered:d["default"].PropTypes.func,onExit:d["default"].PropTypes.func,onExiting:d["default"].PropTypes.func,onExited:d["default"].PropTypes.func,dimension:d["default"].PropTypes.oneOfType([d["default"].PropTypes.oneOf(["height","width"]),d["default"].PropTypes.func]),getDimensionValue:d["default"].PropTypes.func,role:d["default"].PropTypes.string},x.defaultProps={"in":!1,timeout:300,unmountOnExit:!1,transitionAppear:!1,dimension:"height",getDimensionValue:r},t["default"]=x,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(39),c=l(f),h=n(10),y=n(5),v=n(11),m=l(v),b={controlId:d["default"].PropTypes.string,standalone:c["default"](d["default"].PropTypes.bool,"Use a `<FormControl>` or `<InputGroup>` directly."),validationState:d["default"].PropTypes.oneOf(["success","warning","error"]),bsStyle:c["default"](d["default"].PropTypes.oneOf(["success","warning","error"]),"Use `validationState`"),hasFeedback:c["default"](d["default"].PropTypes.bool,"Use a `<FormControl.Feedback>` element."),groupClassName:c["default"](d["default"].PropTypes.string,"Use `className`.")},g={$bs_formGroup:d["default"].PropTypes.object.isRequired},T=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.getChildContext=function(){var e=this.props,t=e.controlId,n=e.bsStyle,r=e.validationState,o=void 0===r?n:r;return{$bs_formGroup:{controlId:t,validationState:o}}},t.prototype.hasFeedback=function(e){var t=this;return m["default"].some(e,function(e){return"feedback"===e.props.bsRole||e.props.children&&t.hasFeedback(e.props.children)})},t.prototype.render=function(){var e=this.props,t=e.standalone,n=e.bsStyle,r=e.validationState,o=void 0===r?n:r,l=e.groupClassName,i=e.className,p=void 0===i?l:i,f=e.children,c=e.hasFeedback,h=void 0===c?this.hasFeedback(f):c,v=a(e,["standalone","bsStyle","validationState","groupClassName","className","children","hasFeedback"]);delete v.bsClass,delete v.bsSize,delete v.controlId;var m=s({},!t&&y.getClassSet(this.props),{"has-feedback":h});return o&&(m["has-"+o]=!0),d["default"].createElement("div",s({},v,{className:u["default"](p,m)}),f)},t}(d["default"].Component);T.propTypes=b,T.childContextTypes=g,t["default"]=y.bsClass("form-group",y.bsSizes([h.Sizes.LARGE,h.Sizes.SMALL],T)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(43),f=a(d),c=n(32),h=a(c),y=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.getInputDOMNode=function(){return this.refs.input},t.prototype.getValue=function(){if("static"===this.props.type)return this.props.value;if(this.props.type)return"select"===this.props.type&&this.props.multiple?this.getSelectedOptions():this.getInputDOMNode().value;throw new Error("Cannot use getValue without specifying input type.")},t.prototype.getChecked=function(){return this.getInputDOMNode().checked},t.prototype.getSelectedOptions=function(){var e=[];return Array.prototype.forEach.call(this.getInputDOMNode().getElementsByTagName("option"),function(t){if(t.selected){var n=t.getAttribute("value")||t.innerHtml;e.push(n)}}),e},t.prototype.isCheckboxOrRadio=function(){return"checkbox"===this.props.type||"radio"===this.props.type},t.prototype.isFile=function(){return"file"===this.props.type},t.prototype.renderInputGroup=function(e){var t=this.props.addonBefore?p["default"].createElement("span",{className:"input-group-addon",key:"addonBefore"},this.props.addonBefore):null,n=this.props.addonAfter?p["default"].createElement("span",{className:"input-group-addon",key:"addonAfter"},this.props.addonAfter):null,r=this.props.buttonBefore?p["default"].createElement("span",{className:"input-group-btn"},this.props.buttonBefore):null,o=this.props.buttonAfter?p["default"].createElement("span",{className:"input-group-btn"},this.props.buttonAfter):null,s=void 0;switch(this.props.bsSize){case"small":s="input-group-sm";break;case"large":s="input-group-lg"}return t||n||r||o?p["default"].createElement("div",{className:i["default"](s,"input-group"),key:"input-group"},t,r,e,n,o):e},t.prototype.renderIcon=function(){if(!this.props.hasFeedback)return null;if(this.props.feedbackIcon)return p["default"].cloneElement(this.props.feedbackIcon,{formControlFeedback:!0});switch(this.props.bsStyle){case"success":return p["default"].createElement(h["default"],{formControlFeedback:!0,glyph:"ok",key:"icon"});case"warning":return p["default"].createElement(h["default"],{formControlFeedback:!0,glyph:"warning-sign",key:"icon"});case"error":return p["default"].createElement(h["default"],{formControlFeedback:!0,glyph:"remove",key:"icon"});default:return p["default"].createElement("span",{className:"form-control-feedback",key:"icon"})}},t.prototype.renderHelp=function(){return this.props.help?p["default"].createElement("span",{className:"help-block",key:"help"},this.props.help):null},t.prototype.renderCheckboxAndRadioWrapper=function(e){var t={checkbox:"checkbox"===this.props.type,radio:"radio"===this.props.type};return p["default"].createElement("div",{className:i["default"](t),key:"checkboxRadioWrapper"},e)},t.prototype.renderWrapper=function(e){return this.props.wrapperClassName?p["default"].createElement("div",{className:this.props.wrapperClassName,key:"wrapper"},e):e},t.prototype.renderLabel=function(e){var t={"control-label":!this.isCheckboxOrRadio()};return t[this.props.labelClassName]=this.props.labelClassName,this.props.label?p["default"].createElement("label",{htmlFor:this.props.id,className:i["default"](t),key:"label"},e,this.props.label):e},t.prototype.renderInput=function(){if(!this.props.type)return this.props.children;switch(this.props.type){case"select":return p["default"].createElement("select",s({},this.props,{className:i["default"](this.props.className,"form-control"),ref:"input",key:"input"}),this.props.children);case"textarea":return p["default"].createElement("textarea",s({},this.props,{className:i["default"](this.props.className,"form-control"),ref:"input",key:"input"}));case"static":return p["default"].createElement("p",s({},this.props,{className:i["default"](this.props.className,"form-control-static"),ref:"input",key:"input"}),this.props.value);default:var e=this.isCheckboxOrRadio()||this.isFile()?"":"form-control";return p["default"].createElement("input",s({},this.props,{className:i["default"](this.props.className,e),ref:"input",key:"input"}))}},t.prototype.renderFormGroup=function(e){return p["default"].createElement(f["default"],this.props,e)},t.prototype.renderChildren=function(){return this.isCheckboxOrRadio()?this.renderWrapper([this.renderCheckboxAndRadioWrapper(this.renderLabel(this.renderInput())),this.renderHelp()]):[this.renderLabel(),this.renderWrapper([this.renderInputGroup(this.renderInput()),this.renderIcon(),this.renderHelp()])]},t.prototype.render=function(){var e=this.renderChildren();return this.renderFormGroup(e)},t}(p["default"].Component);y.propTypes={type:p["default"].PropTypes.string,label:p["default"].PropTypes.node,help:p["default"].PropTypes.node,addonBefore:p["default"].PropTypes.node,addonAfter:p["default"].PropTypes.node,buttonBefore:p["default"].PropTypes.node,buttonAfter:p["default"].PropTypes.node,bsSize:p["default"].PropTypes.oneOf(["small","medium","large"]),bsStyle:p["default"].PropTypes.oneOf(["success","warning","error"]),hasFeedback:p["default"].PropTypes.bool,feedbackIcon:p["default"].PropTypes.node,id:p["default"].PropTypes.oneOfType([p["default"].PropTypes.string,p["default"].PropTypes.number]),groupClassName:p["default"].PropTypes.string,wrapperClassName:p["default"].PropTypes.string,labelClassName:p["default"].PropTypes.string,multiple:p["default"].PropTypes.bool,disabled:p["default"].PropTypes.bool,value:p["default"].PropTypes.any},y.defaultProps={disabled:!1,hasFeedback:!1,multiple:!1},t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(41),i=o(l),u=s.PropTypes.oneOfType([s.PropTypes.string,s.PropTypes.number]),p=a["default"].createClass({displayName:"TabContainer",propTypes:{id:function(e){var t=null;if(!e.generateChildId){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];t=u.apply(void 0,[e].concat(r)),t||e.id||(t=new Error("In order to properly initialize Tabs in a way that is accessible to assistive technologies (such as screen readers) an `id` or a `generateChildId` prop to TabContainer is required"))}return t},generateChildId:s.PropTypes.func,onSelect:s.PropTypes.func,activeKey:s.PropTypes.any},childContextTypes:{$bs_tabcontainer:a["default"].PropTypes.shape({activeKey:s.PropTypes.any,onSelect:s.PropTypes.func,getId:s.PropTypes.func})},getChildContext:function(){var e=this.props,t=e.activeKey,n=e.onSelect,r=e.generateChildId,o=e.id;return{$bs_tabcontainer:{activeKey:t,onSelect:n,getId:r||function(e,t){return o?o+"-"+t+"-"+e:null}}}},render:function(){var e=this.props,t=e.children,n=r(e,["children"]);return delete n.generateChildId,delete n.onSelect,delete n.activeKey,a["default"].cloneElement(a["default"].Children.only(t),n)}});t["default"]=i["default"](p,{activeKey:"onSelect"}),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(2)["default"];t.__esModule=!0;var o=n(4),s=r(o),a=n(52),l=r(a),i=n(1),u=r(i),p=n(9),d=r(p),f=n(5),c=i.PropTypes.oneOfType([i.PropTypes.bool,d["default"]]),h=u["default"].createClass({
displayName:"TabContent",propTypes:{componentClass:d["default"],animation:i.PropTypes.oneOfType([i.PropTypes.bool,d["default"]]),unmountOnExit:i.PropTypes.bool},contextTypes:{$bs_tabcontainer:u["default"].PropTypes.shape({activeKey:u["default"].PropTypes.any,onSelect:i.PropTypes.func})},childContextTypes:{$bs_tabcontent:i.PropTypes.shape({bsClass:i.PropTypes.string,animation:c,activeKey:i.PropTypes.any,onExited:i.PropTypes.func,register:i.PropTypes.func,unmountOnExit:i.PropTypes.bool})},getDefaultProps:function(){return{componentClass:"div",animation:!0,unmountOnExit:!1}},getInitialState:function(){return{exitingPane:null}},getChildContext:function(){var e=this._exitingPane;return{$bs_tabcontent:{bsClass:this.props.bsClass,animation:this.props.animation,activeKey:e?void 0:this.getActiveKey(),onExited:this.handlePaneExited,register:this.registerPane,unmountOnExit:this.props.unmountOnExit}}},componentWillMount:function(){this.panes=[]},componentWillUpdate:function(e,t,n){var r=this.getActiveKey(),o=this.getActiveKey(n),s=-1!==this.panes.indexOf(r);-1===this.panes.indexOf(this._exitingPane)&&(this._exitingPane=null),o!==r&&s&&(this._exitingPane=r)},render:function(){var e=this.props,t=e.className,n=e.children,r=this.props.componentClass,o=f.prefix(this.props,"content");return u["default"].createElement(r,{className:s["default"](o,t)},n)},handlePaneExited:function(){this._exitingPane=null,this.forceUpdate()},registerPane:function(e){var t=this,n=this.panes;return-1!==n.indexOf(e)?l["default"](!1):void 0,n.push(e),function(){n.splice(n.indexOf(e),1),e===t.getActiveKey()&&t.getContext("$bs_tabcontainer").onSelect()}},getActiveKey:function(){var e=arguments.length<=0||void 0===arguments[0]?this.context:arguments[0];return this.getContext("$bs_tabcontainer",e).activeKey},getContext:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.context:arguments[1];return t[e]||{}}});t["default"]=f.bsClass("tab",h),e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t,n){var r=i["default"]("children","value")(e,t,n);return r||(r=a["default"].PropTypes.node(e,t,n)),r}var o=n(2)["default"];t.__esModule=!0,t["default"]=r;var s=n(1),a=o(s),l=n(264),i=o(l);e.exports=t["default"]},function(e,t){"use strict";t["default"]=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t},t.__esModule=!0},function(e,t,n){var r=n(196),o=n(27),s=n(85),a="prototype",l=function(e,t,n){var i,u,p,d=e&l.F,f=e&l.G,c=e&l.S,h=e&l.P,y=e&l.B,v=e&l.W,m=f?o:o[t]||(o[t]={}),b=f?r:c?r[t]:(r[t]||{})[a];f&&(n=t);for(i in n)u=!d&&b&&i in b,u&&i in m||(p=u?b[i]:n[i],m[i]=f&&"function"!=typeof b[i]?n[i]:y&&u?s(p,r):v&&b[i]==p?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[a]=e[a],t}(p):h&&"function"==typeof p?s(Function.call,p):p,h&&((m[a]||(m[a]={}))[i]=p))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,e.exports=l},function(e,t){var n=Object;e.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}},function(e,t,n){"use strict";var r=n(21),o=function(){};r&&(o=function(){return document.addEventListener?function(e,t,n,r){return e.addEventListener(t,n,r||!1)}:document.attachEvent?function(e,t,n){return e.attachEvent("on"+t,n)}:void 0}()),e.exports=o},function(e,t,n){"use strict";var r=function(e,t,n,r,o,s,a,l){if(!e){var i;if(void 0===t)i=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[n,r,o,s,a,l],p=0;i=new Error(t.replace(/%s/g,function(){return u[p++]})),i.name="Invariant Violation"}throw i.framesToPop=1,i}};e.exports=r},function(e,t){t=e.exports=function(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return s[e];var o=String(e),a=n[o.toLowerCase()];if(a)return a;var a=r[o.toLowerCase()];return a?a:1===o.length?o.charCodeAt(0):void 0};var n=t.code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,command:91,"right click":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=t.aliases={windows:91,"":16,"":18,"":17,"":91,ctl:17,control:17,option:18,pause:19,"break":19,caps:20,"return":13,escape:27,spc:32,pgup:33,pgdn:33,ins:45,del:46,cmd:91};/*!
	 * Programatically add the following
	 */
for(o=97;123>o;o++)n[String.fromCharCode(o)]=o-32;for(var o=48;58>o;o++)n[o-48]=o;for(o=1;13>o;o++)n["f"+o]=o+111;for(o=0;10>o;o++)n["numpad "+o]=o+96;var s=t.names=t.title={};for(o in n)s[n[o]]=o;for(var a in r)n[a]=r[a]},function(e,t,n){function r(e,t,n){if("function"!=typeof e)return o;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,o){return e.call(t,n,r,o)};case 4:return function(n,r,o,s){return e.call(t,n,r,o,s)};case 5:return function(n,r,o,s,a){return e.call(t,n,r,o,s,a)}}return function(){return e.apply(t,arguments)}}var o=n(112);e.exports=r},function(e,t,n){function r(e){return null!=e&&s(o(e))}var o=n(103),s=n(24);e.exports=r},function(e,t,n){function r(e){return s(e)&&o(e)&&l.call(e,"callee")&&!i.call(e,"callee")}var o=n(55),s=n(22),a=Object.prototype,l=a.hasOwnProperty,i=a.propertyIsEnumerable;e.exports=r},function(e,t,n){function r(e){return"string"==typeof e||o(e)&&l.call(e)==s}var o=n(22),s="[object String]",a=Object.prototype,l=a.toString;e.exports=r},function(e,t,n){var r=n(36),o=n(55),s=n(19),a=n(251),l=n(61),i=r(Object,"keys"),u=i?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||("function"==typeof e?l.enumPrototypes:o(e))?a(e):s(e)?i(e):[]}:a;e.exports=u},function(e,t,n){function r(e){if(null==e)return[];p(e)||(e=Object(e));var t=e.length;t=t&&u(t)&&(a(e)||s(e)||d(e))&&t||0;for(var n=e.constructor,r=-1,o=l(n)&&n.prototype||E,c=o===e,h=Array(t),y=t>0,m=f.enumErrorProps&&(e===C||e instanceof Error),b=f.enumPrototypes&&l(e);++r<t;)h[r]=r+"";for(var T in e)b&&"prototype"==T||m&&("message"==T||"name"==T)||y&&i(T,t)||"constructor"==T&&(c||!N.call(e,T))||h.push(T);if(f.nonEnumShadows&&e!==E){var w=e===_?x:e===C?v:O.call(e),k=S[w]||S[g];for(w==g&&(o=E),t=P.length;t--;){T=P[t];var M=k[T];c&&M||(M?!N.call(e,T):e[T]===o[T])||h.push(T)}}return h}var o=n(221),s=n(56),a=n(18),l=n(111),i=n(105),u=n(24),p=n(19),d=n(57),f=n(61),c="[object Array]",h="[object Boolean]",y="[object Date]",v="[object Error]",m="[object Function]",b="[object Number]",g="[object Object]",T="[object RegExp]",x="[object String]",P=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],C=Error.prototype,E=Object.prototype,_=String.prototype,N=E.hasOwnProperty,O=E.toString,S={};S[c]=S[y]=S[b]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},S[h]=S[x]={constructor:!0,toString:!0,valueOf:!0},S[v]=S[m]=S[T]={constructor:!0,toString:!0},S[g]={constructor:!0},o(P,function(e){for(var t in S)if(N.call(S,t)){var n=S[t];n[e]=N.call(n,e)}}),e.exports=r},function(e,t,n){var r=n(222),o=n(226),s=n(98),a=n(54),l=n(59),i=n(108),u=n(109),p=n(97),d=p(function(e,t){if(null==e)return{};if("function"!=typeof t[0]){var t=r(s(t),String);return i(e,o(l(e),t))}var n=a(t[0],t[1],3);return u(e,function(e,t,r){return!n(e,t,r)})});e.exports=d},function(e,t){var n=Array.prototype,r=Error.prototype,o=Object.prototype,s=o.propertyIsEnumerable,a=n.splice,l={};!function(e){var t=function(){this.x=e},n={0:e,length:e},o=[];t.prototype={valueOf:e,y:e};for(var i in new t)o.push(i);l.enumErrorProps=s.call(r,"message")||s.call(r,"name"),l.enumPrototypes=s.call(t,"prototype"),l.nonEnumShadows=!/valueOf/.test(o),l.ownLast="x"!=o[0],l.spliceObjects=(a.call(n,0,1),!n[0]),l.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1,0),e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return e="function"==typeof e?e():e,a["default"].findDOMNode(e)||t}t.__esModule=!0,t["default"]=o;var s=n(13),a=r(s);e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t,n){return"object"!=typeof e[t]||"function"!=typeof e[t].render&&1!==e[t].nodeType?new Error(o.errMsg(e,t,n,", expected a DOM element or an object that has a `render` method")):void 0}t.__esModule=!0;var o=n(118);t["default"]=o.createChainableTypeChecker(r),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(16),d=s(p),f=u["default"].createClass({displayName:"BreadcrumbItem",propTypes:{active:u["default"].PropTypes.bool,id:u["default"].PropTypes.oneOfType([u["default"].PropTypes.string,u["default"].PropTypes.number]),linkId:u["default"].PropTypes.oneOfType([u["default"].PropTypes.string,u["default"].PropTypes.number]),href:u["default"].PropTypes.string,title:u["default"].PropTypes.node,target:u["default"].PropTypes.string},getDefaultProps:function(){return{active:!1}},render:function(){var e=this.props,t=e.active,n=e.className,s=e.id,a=e.linkId,i=e.children,p=e.href,f=e.title,c=e.target,h=r(e,["active","className","id","linkId","children","href","title","target"]),y={href:p,title:f,target:c,id:a};return u["default"].createElement("li",{id:s,className:l["default"](n,{active:t})},t?u["default"].createElement("span",h,i):u["default"].createElement(d["default"],o({},h,y),i))}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(38),p=o(u),d=n(5),f=n(20),c=o(f),h=i["default"].createClass({displayName:"ButtonGroup",propTypes:{vertical:i["default"].PropTypes.bool,justified:i["default"].PropTypes.bool,block:p["default"](i["default"].PropTypes.bool,function(e){return e.block&&!e.vertical?new Error("The block property requires the vertical property to be set to have any effect"):void 0})},getDefaultProps:function(){return{block:!1,justified:!1,vertical:!1}},render:function(){var e=d.getClassSet(this.props);return e[d.prefix(this.props)]=!this.props.vertical,e[d.prefix(this.props,"vertical")]=this.props.vertical,e[d.prefix(this.props,"justified")]=this.props.justified,e[d.prefix(c["default"].defaultProps,"block")]=this.props.block,i["default"].createElement("div",r({},this.props,{className:a["default"](this.props.className,e)}),this.props.children)}});t["default"]=d.bsClass("btn-group",h),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(13),p=o(u),d=n(5),f=n(184),c=o(f),h=i["default"].createClass({displayName:"CarouselItem",propTypes:{direction:i["default"].PropTypes.oneOf(["prev","next"]),onAnimateOutEnd:i["default"].PropTypes.func,active:i["default"].PropTypes.bool,animateIn:i["default"].PropTypes.bool,animateOut:i["default"].PropTypes.bool,caption:i["default"].PropTypes.node,index:i["default"].PropTypes.number},getInitialState:function(){return{direction:null}},getDefaultProps:function(){return{bsStyle:"carousel",active:!1,animateIn:!1,animateOut:!1}},handleAnimateOutEnd:function(){this.props.onAnimateOutEnd&&this.isMounted()&&this.props.onAnimateOutEnd(this.props.index)},componentWillReceiveProps:function(e){this.props.active!==e.active&&this.setState({direction:null})},componentDidUpdate:function(e){!this.props.active&&e.active&&c["default"].addEndEventListener(p["default"].findDOMNode(this),this.handleAnimateOutEnd),this.props.active!==e.active&&setTimeout(this.startAnimation,20)},startAnimation:function(){this.isMounted()&&this.setState({direction:"prev"===this.props.direction?"right":"left"})},render:function(){var e={item:!0,active:this.props.active&&!this.props.animateIn||this.props.animateOut,next:this.props.active&&this.props.animateIn&&"next"===this.props.direction,prev:this.props.active&&this.props.animateIn&&"prev"===this.props.direction};return this.state.direction&&(this.props.animateIn||this.props.animateOut)&&(e[this.state.direction]=!0),i["default"].createElement("div",r({},this.props,{className:a["default"](this.props.className,e)}),this.props.children,this.props.caption?this.renderCaption():null)},renderCaption:function(){var e=d.prefix(this.props,"caption");return i["default"].createElement("div",{className:e},this.props.caption)}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(17)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=n(10),d=s(p),f=n(9),c=s(f),h=l["default"].createClass({displayName:"Col",propTypes:{xs:l["default"].PropTypes.number,sm:l["default"].PropTypes.number,md:l["default"].PropTypes.number,lg:l["default"].PropTypes.number,xsHidden:l["default"].PropTypes.bool,smHidden:l["default"].PropTypes.bool,mdHidden:l["default"].PropTypes.bool,lgHidden:l["default"].PropTypes.bool,xsOffset:l["default"].PropTypes.number,smOffset:l["default"].PropTypes.number,mdOffset:l["default"].PropTypes.number,lgOffset:l["default"].PropTypes.number,xsPush:l["default"].PropTypes.number,smPush:l["default"].PropTypes.number,mdPush:l["default"].PropTypes.number,lgPush:l["default"].PropTypes.number,xsPull:l["default"].PropTypes.number,smPull:l["default"].PropTypes.number,mdPull:l["default"].PropTypes.number,lgPull:l["default"].PropTypes.number,componentClass:c["default"]},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this,t=this.props.componentClass,n={};return o(d["default"].SIZES).forEach(function(t){var r=d["default"].SIZES[t],o=r,s=r+"-";e.props[o]&&(n["col-"+s+e.props[o]]=!0),n["hidden-"+r]=e.props[r+"Hidden"],o=r+"Offset",s=r+"-offset-",e.props[o]>=0&&(n["col-"+s+e.props[o]]=!0),o=r+"Push",s=r+"-push-",e.props[o]>=0&&(n["col-"+s+e.props[o]]=!0),o=r+"Pull",s=r+"-pull-",e.props[o]>=0&&(n["col-"+s+e.props[o]]=!0)},this),l["default"].createElement(t,r({},this.props,{className:u["default"](this.props.className,n)}),this.props.children)}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(1),i=a(l),u=n(4),p=a(u),d=n(20),f=a(d),c=n(16),h=a(c),y=i["default"].createElement("span",null," ",i["default"].createElement("span",{className:"caret"})),v=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props.noCaret?null:y,t={"dropdown-toggle":!0},n=this.props.useAnchor?h["default"]:f["default"];return i["default"].createElement(n,s({},this.props,{className:p["default"](t,this.props.className),role:"button","aria-haspopup":!0,"aria-expanded":this.props.open}),this.props.children||this.props.title,e)},t}(i["default"].Component);t["default"]=v,v.defaultProps={open:!1,useAnchor:!1,bsRole:"toggle"},v.propTypes={bsRole:i["default"].PropTypes.string,noCaret:i["default"].PropTypes.bool,open:i["default"].PropTypes.bool,title:i["default"].PropTypes.string,useAnchor:i["default"].PropTypes.bool},v.isToggle=!0,v.titleProp="title",v.onClickProp="onClick",e.exports=t["default"]},function(e,t,n){"use strict";var r=n(2)["default"];t.__esModule=!0;var o=n(138),s=r(o);t.Static=s["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=n(9),p=o(u),d=a["default"].createClass({displayName:"Grid",propTypes:{fluid:a["default"].PropTypes.bool,componentClass:p["default"]},getDefaultProps:function(){return{componentClass:"div",fluid:!1}},render:function(){var e=this.props.componentClass,t=this.props.fluid?"container-fluid":"container";return a["default"].createElement(e,r({},this.props,{className:i["default"](this.props.className,t)}),this.props.children)}});t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(26)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(11),u=s(i),p=/\%\((.+?)\)s/,d=l["default"].createClass({displayName:"Interpolate",propTypes:{component:l["default"].PropTypes.node,format:l["default"].PropTypes.string,unsafe:l["default"].PropTypes.bool},getDefaultProps:function(){return{component:"span",unsafe:!1}},render:function(){var e=u["default"].count(this.props.children)>0||"string"==typeof this.props.children?this.props.children:this.props.format,t=this.props.component,n=this.props.unsafe===!0,o=r({},this.props);if(delete o.children,delete o.format,delete o.component,delete o.unsafe,n){var s=e.split(p).reduce(function(e,t,n){var r=void 0;if(n%2===0?r=t:(r=o[t],delete o[t]),l["default"].isValidElement(r))throw new Error("cannot interpolate a React component into unsafe text");return e+=r},"");return o.dangerouslySetInnerHTML={__html:s},l["default"].createElement(t,o)}var a=e.split(p).reduce(function(e,t,n){var r=void 0;if(n%2===0){if(0===t.length)return e;r=t}else r=o[t],delete o[t];return e.push(r),e},[]);return l["default"].createElement(t,o,a)}});o(d,{REGEXP:p}),t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(10),f=n(5),c=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=f.getClassSet(this.props);return e.active=this.props.active,e.disabled=this.props.disabled,this.props.href?this.renderAnchor(e):this.props.onClick?this.renderButton(e):this.props.listItem?this.renderLi(e):this.renderSpan(e)},t.prototype.renderLi=function(e){return p["default"].createElement("li",s({},this.props,{className:i["default"](this.props.className,e)}),this.props.header?this.renderStructuredContent():this.props.children)},t.prototype.renderAnchor=function(e){return p["default"].createElement("a",s({},this.props,{className:i["default"](this.props.className,e)}),this.props.header?this.renderStructuredContent():this.props.children)},t.prototype.renderButton=function(e){return p["default"].createElement("button",s({type:"button"},this.props,{className:i["default"](this.props.className,e)}),this.props.header?this.renderStructuredContent():this.props.children)},t.prototype.renderSpan=function(e){return p["default"].createElement("span",s({},this.props,{className:i["default"](this.props.className,e)}),this.props.header?this.renderStructuredContent():this.props.children)},t.prototype.renderStructuredContent=function(){var e=void 0,t=f.prefix(this.props,"heading");e=p["default"].isValidElement(this.props.header)?u.cloneElement(this.props.header,{key:"header",className:i["default"](this.props.header.props.className,t)}):p["default"].createElement("h4",{key:"header",className:t},this.props.header);var n=p["default"].createElement("p",{key:"content",className:f.prefix(this.props,"text")},this.props.children);return[e,n]},t}(p["default"].Component);c.propTypes={className:p["default"].PropTypes.string,active:p["default"].PropTypes.any,disabled:p["default"].PropTypes.any,header:p["default"].PropTypes.node,listItem:p["default"].PropTypes.bool,onClick:p["default"].PropTypes.func,eventKey:p["default"].PropTypes.any,href:p["default"].PropTypes.string,target:p["default"].PropTypes.string},c.defaultTypes={listItem:!1},t["default"]=f.bsStyles(d.State.values(),f.bsClass("list-group-item",c)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(5),f=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){return p["default"].createElement("div",s({},this.props,{className:i["default"](this.props.className,d.prefix(this.props,"body"))}),this.props.children)},t}(p["default"].Component);t["default"]=d.bsClass("modal",f),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(5),f=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){return p["default"].createElement("div",s({},this.props,{className:i["default"](this.props.className,d.prefix(this.props,"footer"))}),this.props.children)},t}(p["default"].Component);f.propTypes={bsClass:p["default"].PropTypes.string},f.defaultProps={bsClass:"modal"},t["default"]=d.bsClass("modal",f),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(5),c=n(12),h=l(c),y=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e["aria-label"],n=s(e,["aria-label"]),r=h["default"](this.context.$bs_onModalHide,this.props.onHide);return d["default"].createElement("div",a({},n,{className:u["default"](this.props.className,f.prefix(this.props,"header"))}),this.props.closeButton&&d["default"].createElement("button",{type:"button",className:"close","aria-label":t,onClick:r},d["default"].createElement("span",{"aria-hidden":"true"},"")),this.props.children)},t}(d["default"].Component);y.propTypes={"aria-label":d["default"].PropTypes.string,bsClass:d["default"].PropTypes.string,closeButton:d["default"].PropTypes.bool,onHide:d["default"].PropTypes.func},y.contextTypes={$bs_onModalHide:d["default"].PropTypes.func},y.defaultProps={"aria-label":"Close",closeButton:!1},t["default"]=f.bsClass("modal",y),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(5),f=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){return p["default"].createElement("h4",s({},this.props,{className:i["default"](this.props.className,d.prefix(this.props,"title"))}),this.props.children)},t}(p["default"].Component);t["default"]=d.bsClass("modal",f),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(53),p=a(u),d=n(1),f=a(d),c=n(13),h=a(c),y=n(38),v=a(y),m=n(14),b=(a(m),n(5)),g=n(12),T=a(g),x=n(83),P=n(11),C=a(P),E=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.componentDidUpdate=function(){if(this._needsRefocus){var e=this.refs.ul&&h["default"].findDOMNode(this.refs.ul),t=e?e.children||[]:[],n=this.eventKeys().indexOf(this.getActiveKey());if(this._needsRefocus=!1,-1!==n){var r=t[n];r&&r.firstChild&&r.firstChild.focus()}}},t.prototype.render=function(){var e=this.props.className,t=null!=this.props.navbar?this.props.navbar:this.context.$bs_navbar,n=b.getClassSet(this.props);if(n[b.prefix(this.props,"stacked")]=this.props.stacked,n[b.prefix(this.props,"justified")]=this.props.justified,t){var r=this.context.$bs_navbar_bsClass||"navbar";n[b.prefix({bsClass:r},"nav")]=!0,n[b.prefix({bsClass:r},"right")]=this.props.pullRight,n[b.prefix({bsClass:r},"left")]=this.props.pullLeft}else n["pull-right"]=this.props.pullRight,n["pull-left"]=this.props.pullLeft;var o=f["default"].createElement("ul",s({ref:"ul"},this.props,{role:this.getNavRole(),className:i["default"](e,n)}),C["default"].map(this.props.children,this.renderNavItem,this));return o},t.prototype.renderNavItem=function(e,t){var n=T["default"](e.props.onSelect,this.props.onSelect),r=this.isChildActive(e),o=this.getTabProps(e,r,n);return d.cloneElement(e,s({active:r,activeKey:this.props.activeKey,activeHref:this.props.activeHref,onSelect:n,key:e.key||t,navItem:!0},o))},t.prototype.getActiveKey=function(){var e=this.context.$bs_tabcontainer;return e?e.activeKey:this.props.activeKey},t.prototype.isChildActive=function(e){var t=this.getActiveKey();return this.context.$bs_tabcontainer?e.props.eventKey===t:e.props.active?!0:null!=this.props.activeKey&&e.props.eventKey===this.props.activeKey?!0:null!=this.props.activeHref&&e.props.href===this.props.activeHref?!0:e.props.active},t.prototype.getTabProps=function(e,t,n){var r=this.getNavRole(),o=this.context.$bs_tabcontainer;if(!o&&"tablist"!==r)return null;var s=e.props,a=s.id,l=s["aria-controls"],i=s.eventKey,u=s.role,p=s.onKeyDown,d=s.tabIndex,f=void 0===d?0:d;return o&&o.getId&&(a=o.getId(i,x.TAB)||null,l=o.getId(i,x.PANE)||null,n=T["default"](n,o.onSelect)),"tablist"===r&&(u=u||"tab",p=T["default"](this.handleTabKeyDown.bind(this,n||function(){}),p),f=t?f:-1),{onSelect:n,id:a,role:u,onKeyDown:p,"aria-controls":l,tabIndex:f}},t.prototype.handleTabKeyDown=function(e,t){var n=this.eventKeys(),r=this.getActiveKey()||n[0],o=void 0;switch(t.keyCode){case p["default"].codes.left:case p["default"].codes.up:o=x.nextEnabled(this.props.children,r,n,!1),o&&o!==r&&(t.preventDefault(),e(o),this._needsRefocus=!0);break;case p["default"].codes.right:case p["default"].codes.down:o=x.nextEnabled(this.props.children,r,n,!0),o&&o!==r&&(t.preventDefault(),e(o),this._needsRefocus=!0)}},t.prototype.eventKeys=function(){var e=[];return C["default"].forEach(this.props.children,function(t){var n=t.props.eventKey;return e.push(n)}),e},t.prototype.getNavRole=function(){return this.props.role||(this.context.$bs_tabcontainer?"tablist":null)},t}(f["default"].Component);E.propTypes={activeHref:f["default"].PropTypes.string,activeKey:f["default"].PropTypes.any,stacked:f["default"].PropTypes.bool,justified:v["default"](f["default"].PropTypes.bool,function(e){var t=e.justified,n=e.navbar;return t&&n?Error("justified navbar `Nav`s are not supported"):null}),onSelect:f["default"].PropTypes.func,className:f["default"].PropTypes.string,id:f["default"].PropTypes.oneOfType([f["default"].PropTypes.string,f["default"].PropTypes.number]),role:f["default"].PropTypes.string,navbar:f["default"].PropTypes.bool,pullRight:f["default"].PropTypes.bool,pullLeft:f["default"].PropTypes.bool},E.contextTypes={$bs_navbar:f["default"].PropTypes.bool,$bs_navbar_bsClass:f["default"].PropTypes.string,$bs_tabcontainer:f["default"].PropTypes.shape({activeKey:f["default"].PropTypes.any,onSelect:f["default"].PropTypes.func,getId:f["default"].PropTypes.func})},E.defaultProps={justified:!1,pullRight:!1,pullLeft:!1,stacked:!1},t["default"]=b.bsClass("nav",b.bsStyles(["tabs","pills"],E)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(16),d=s(p),f=n(12),c=s(f),h=u["default"].createClass({displayName:"NavItem",propTypes:{active:u["default"].PropTypes.bool,disabled:u["default"].PropTypes.bool,role:u["default"].PropTypes.string,href:u["default"].PropTypes.string,onClick:u["default"].PropTypes.func,onSelect:u["default"].PropTypes.func,eventKey:u["default"].PropTypes.any},getDefaultProps:function(){return{active:!1,disabled:!1}},render:function(){var e=this.props,t=e.active,n=e.disabled,s=e.role,a=e.href,i=e.onClick,p=e.className,f=e.style,h=r(e,["active","disabled","role","href","onClick","className","style"]);return delete h.onSelect,delete h.eventKey,s?"tab"===s&&(h["aria-selected"]=t):"#"===a&&(s="button"),u["default"].createElement("li",{role:"presentation",className:l["default"](p,{active:t,disabled:n}),style:f},u["default"].createElement(d["default"],o({},h,{disabled:n,role:s,href:a,onClick:c["default"](i,this.handleClick)})))},handleClick:function(e){this.props.onSelect&&(e.preventDefault(),this.props.disabled||this.props.onSelect(this.props.eventKey,e))}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(5),c=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.children,r=s(e,["className","children"]),o=this.context.$bs_navbar_bsClass,l=void 0===o?"navbar":o,i=f.prefix({bsClass:l},"brand");return d["default"].isValidElement(n)?d["default"].cloneElement(n,{className:u["default"](n.props.className,t,i)}):d["default"].createElement("span",a({},r,{className:u["default"](t,i)}),n)},t}(d["default"].Component);c.contextTypes={$bs_navbar_bsClass:d["default"].PropTypes.string},t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(1),u=l(i),p=n(258),d=l(p),f=n(9),c=l(f),h=n(31),y=l(h),v=n(4),m=l(v),b=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.animation,r=a(e,["children","animation"]);return n===!0&&(n=y["default"]),n===!1&&(n=null),n||(t=i.cloneElement(t,{className:m["default"]("in",t.props.className)})),u["default"].createElement(d["default"],s({},r,{transition:n}),t)},t}(u["default"].Component);b.propTypes=s({},d["default"].propTypes,{show:u["default"].PropTypes.bool,rootClose:u["default"].PropTypes.bool,onHide:u["default"].PropTypes.func,animation:u["default"].PropTypes.oneOfType([u["default"].PropTypes.bool,c["default"]]),onEnter:u["default"].PropTypes.func,onEntering:u["default"].PropTypes.func,onEntered:u["default"].PropTypes.func,onExit:u["default"].PropTypes.func,onExiting:u["default"].PropTypes.func,onExited:u["default"].PropTypes.func}),b.defaultProps={animation:y["default"],rootClose:!1,show:!1},t["default"]=b,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(5),d=n(11),f=s(d),c=u["default"].createClass({displayName:"PanelGroup",propTypes:{accordion:u["default"].PropTypes.bool,activeKey:u["default"].PropTypes.any,className:u["default"].PropTypes.string,children:u["default"].PropTypes.node,defaultActiveKey:u["default"].PropTypes.any,onSelect:u["default"].PropTypes.func},getDefaultProps:function(){return{accordion:!1}},getInitialState:function(){var e=this.props.defaultActiveKey;return{activeKey:e}},render:function(){var e=p.getClassSet(this.props),t=this.props,n=t.className,s=r(t,["className"]);return this.props.accordion&&(s.role="tablist"),u["default"].createElement("div",o({},s,{className:l["default"](n,e),onSelect:null}),f["default"].map(s.children,this.renderPanel))},renderPanel:function(e,t){var n=null!=this.props.activeKey?this.props.activeKey:this.state.activeKey,r={bsStyle:e.props.bsStyle||this.props.bsStyle,key:e.key?e.key:t,ref:e.ref};return this.props.accordion&&(r.headerRole="tab",r.panelRole="tabpanel",r.collapsible=!0,r.expanded=e.props.eventKey===n,r.onSelect=this.handleSelect),i.cloneElement(e,r)},shouldComponentUpdate:function(){return!this._isChanging},handleSelect:function(e,t){t.preventDefault(),this.props.onSelect&&(this._isChanging=!0,this.props.onSelect(e,t),this._isChanging=!1),this.state.activeKey===e&&(e=null),this.setState({activeKey:e})}});t["default"]=p.bsClass("panel-group",c),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(90),i=o(l),u=n(1),p=o(u),d=n(9),f=o(d),c=n(14),h=(o(c),n(5)),y=n(12),v=o(y),m=n(83),b=n(31),g=o(b),T=p["default"].createClass({displayName:"TabPane",propTypes:{eventKey:u.PropTypes.any,animation:u.PropTypes.oneOfType([u.PropTypes.bool,f["default"]]),id:u.PropTypes.string,"aria-labelledby":u.PropTypes.string,onEnter:u.PropTypes.func,onEntering:u.PropTypes.func,onEntered:u.PropTypes.func,onExit:u.PropTypes.func,onExiting:u.PropTypes.func,onExited:u.PropTypes.func,unmountOnExit:u.PropTypes.bool},contextTypes:{$bs_tabcontainer:u.PropTypes.shape({getId:u.PropTypes.func,unmountOnExit:u.PropTypes.bool}),$bs_tabcontent:u.PropTypes.shape({bsClass:u.PropTypes.string,animation:u.PropTypes.oneOfType([u.PropTypes.bool,f["default"]]),activeKey:u.PropTypes.any,onExited:u.PropTypes.func,register:u.PropTypes.func,unmountOnExit:u.PropTypes.bool})},childContextTypes:{$bs_tabcontainer:u.PropTypes.oneOf([null])},componentWillMount:function(){this.exited=!this.isActive(),this.registerWithParent()},componentWillReceiveProps:function(e,t){e.eventKey!==this.props.eventKey&&(this.unregisterWithParent(),this.registerWithParent(e,t))},componentWillUpdate:function(e,t,n){this.isActive(e,n)?this.exited=!1:this.exited||this.getTransition(e,n)||(this.exited=!0,this._fireExitedCallback=!0)},componentDidUpdate:function(){this._fireExitedCallback&&(this._fireExitedCallback=!1,this.onExited())},componentWillUnmount:function(){this.unregisterWithParent()},getChildContext:function(){return{$bs_tabcontainer:null}},getTransition:function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.context:arguments[1];return t=this.getContext("$bs_tabcontent",t),null!=e.animation?e.animation:t.animation},getUnmountOnExit:function(){var e=this.getContext("$bs_tabcontent",this.context);return null!=this.props.unmountOnExit?this.props.unmountOnExit:e.unmountOnExit},isActive:function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.context:arguments[1];return this.getContext("$bs_tabcontent",t).activeKey===e.eventKey},render:function(){var e,t=this.isActive(),n=t||!this.exited,o=this.getContext("$bs_tabcontainer").getId,s=this.props.bsClass||this.getContext("$bs_tabcontent").bsClass,l=this.getTransition();if(!n&&!l&&this.getUnmountOnExit())return null;var i=(e={active:n},e[h.prefix({bsClass:s},"pane")]=!0,e),u=this.props,d=u.eventKey,f=u.id,c=u["aria-labelledby"],y=u.onExit,b=u.onExiting,T=u.onExited,x=u.onEnter,P=u.onEntering,C=u.onEntered;"boolean"==typeof l&&(l=l?g["default"]:null),o&&(f=o(d,m.PANE)||null,c=o(d,m.TAB)||null);var E=p["default"].createElement("div",r({},this.props,{id:f,role:"tabpanel","aria-hidden":!n,"aria-labelledby":c,className:a["default"](this.props.className,i,{"in":!l})}),this.props.children);return l&&(E=p["default"].createElement(l,{"in":t,onExit:y,onExiting:b,onExited:v["default"](this.handleExited,T),onEnter:v["default"](this.handleEnter,x),onEntering:P,onEntered:C,unmountOnExit:this.getUnmountOnExit()},E)),E},onExited:function(){var e=this.getContext("$bs_tabcontent");e.onExited&&e.onExited(this.props.eventKey)},handleEnter:function(e){this.isActive()&&(i["default"](e,"active"),e.offsetWidth)},handleExited:function(){this.exited=!0,this.onExited(),this.forceUpdate()},registerWithParent:function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.context:arguments[1],n=this.getContext("$bs_tabcontent",t).register;n&&(this.unregister=n(e.eventKey))},unregisterWithParent:function(){this.unregister&&this.unregister()},getContext:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.context:arguments[1];return t[e]||{}}});t["default"]=h.bsClass("tab",T),e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t,n,r){function o(){var t=n.indexOf(i);return i=r?n[Math.min(s,t+1)]:n[Math.max(0,t-1)],l(e,function(e){return e.props.eventKey===i})}for(var s=n.length-1,a=n[r?Math.max(s,0):0],i=t,u=o();u.props.eventKey!==a&&u.props.disabled;)u=o();return u.props.disabled?t:u.props.eventKey}var o=n(2)["default"];t.__esModule=!0,t.nextEnabled=r;var s=n(11),a=o(s),l=a["default"].find,i="tab";t.TAB=i;var u="pane";t.PANE=u},function(e,t,n){e.exports={"default":n(189),__esModule:!0}},function(e,t,n){var r=n(192);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(195);e.exports=function(e){return Object(r(e))}},function(e,t,n){"use strict";function r(){var e=void 0===arguments[0]?document:arguments[0];try{return e.activeElement}catch(t){}}var o=n(35);t.__esModule=!0,t["default"]=r;var s=n(23);o.interopRequireDefault(s);e.exports=t["default"]},function(e,t,n){"use strict";var r=n(91);e.exports=function(e,t){e.classList?e.classList.add(t):r(e)||(e.className=e.className+" "+t)}},function(e,t){"use strict";e.exports=function(e,t){
return e.classList?!!t&&e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")}},function(e,t,n){"use strict";var r=n(21),o=function(){};r&&(o=function(){return document.addEventListener?function(e,t,n,r){return e.removeEventListener(t,n,r||!1)}:document.attachEvent?function(e,t,n){return e.detachEvent("on"+t,n)}:void 0}()),e.exports=o},function(e,t,n){"use strict";var r=n(28),o=n(33),s=n(23);e.exports=function(e){var t=s(e),n=o(t),a=t&&t.documentElement,l={top:0,left:0,height:0,width:0};if(t)return r(a,e)?(void 0!==e.getBoundingClientRect&&(l=e.getBoundingClientRect()),(l.width||l.height)&&(l={top:l.top+(n.pageYOffset||a.scrollTop)-(a.clientTop||0),left:l.left+(n.pageXOffset||a.scrollLeft)-(a.clientLeft||0),width:(null==l.width?e.offsetWidth:l.width)||0,height:(null==l.height?e.offsetHeight:l.height)||0}),l):l}},function(e,t,n){"use strict";var r=n(33);e.exports=function(e,t){var n=r(e);return void 0===t?n?"pageYOffset"in n?n.pageYOffset:n.document.documentElement.scrollTop:e.scrollTop:void(n?n.scrollTo("pageXOffset"in n?n.pageXOffset:n.document.documentElement.scrollLeft,t):e.scrollTop=t)}},function(e,t,n){"use strict";var r=n(215),o=/^-ms-/;e.exports=function(e){return r(e.replace(o,"ms-"))}},function(e,t,n){"use strict";var r,o=n(21);e.exports=function(e){if((!r||e)&&o){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),r=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return r}},function(e,t){function n(e,t){if("function"!=typeof e)throw new TypeError(r);return t=o(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,s=o(n.length-t,0),a=Array(s);++r<s;)a[r]=n[t+r];switch(t){case 0:return e.call(this,a);case 1:return e.call(this,n[0],a);case 2:return e.call(this,n[0],n[1],a)}var l=Array(t+1);for(r=-1;++r<t;)l[r]=n[r];return l[t]=a,e.apply(this,l)}}var r="Expected a function",o=Math.max;e.exports=n},function(e,t,n){function r(e,t,n,u){u||(u=[]);for(var p=-1,d=e.length;++p<d;){var f=e[p];i(f)&&l(f)&&(n||a(f)||s(f))?t?r(f,t,n,u):o(u,f):n||(u[u.length]=f)}return u}var o=n(223),s=n(56),a=n(18),l=n(55),i=n(22);e.exports=r},function(e,t,n){var r=n(243),o=r();e.exports=o},function(e,t,n){function r(e,t,n){if(null!=e){e=o(e),void 0!==n&&n in e&&(t=[n]);for(var r=0,s=t.length;null!=e&&s>r;)e=o(e)[t[r++]];return r&&r==s?e:void 0}}var o=n(15);e.exports=r},function(e,t,n){function r(e,t,n,l,i,u){return e===t?!0:null==e||null==t||!s(e)&&!a(t)?e!==e&&t!==t:o(e,t,r,n,l,i,u)}var o=n(233),s=n(19),a=n(22);e.exports=r},function(e,t,n){function r(e){return function(t){return null==t?void 0:o(t)[e]}}var o=n(15);e.exports=r},function(e,t,n){var r=n(102),o=r("length");e.exports=o},function(e,t){var n=function(){try{Object({toString:0}+"")}catch(e){return function(){return!1}}return function(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}}();e.exports=n},function(e,t){function n(e,t){return e="number"==typeof e||r.test(e)?+e:-1,t=null==t?o:t,e>-1&&e%1==0&&t>e}var r=/^\d+$/,o=9007199254740991;e.exports=n},function(e,t,n){function r(e,t){var n=typeof e;if("string"==n&&l.test(e)||"number"==n)return!0;if(o(e))return!1;var r=!a.test(e);return r||null!=t&&e in s(t)}var o=n(18),s=n(15),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,l=/^\w*$/;e.exports=r},function(e,t,n){function r(e){return e===e&&!o(e)}var o=n(19);e.exports=r},function(e,t,n){function r(e,t){e=o(e);for(var n=-1,r=t.length,s={};++n<r;){var a=t[n];a in e&&(s[a]=e[a])}return s}var o=n(15);e.exports=r},function(e,t,n){function r(e,t){var n={};return o(e,function(e,r,o){t(e,r,o)&&(n[r]=e)}),n}var o=n(230);e.exports=r},function(e,t,n){function r(e){if(s(e))return e;var t=[];return o(e).replace(a,function(e,n,r,o){t.push(r?o.replace(l,"$1"):n||e)}),t}var o=n(239),s=n(18),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,l=/\\(\\)?/g;e.exports=r},function(e,t,n){function r(e){return o(e)&&l.call(e)==s}var o=n(19),s="[object Function]",a=Object.prototype,l=a.toString;e.exports=r},function(e,t){function n(e){return e}e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var o=n(1),s=r(o),a=n(13),l=r(a),i=n(63),u=r(i),p=n(29),d=r(p),f=n(62),c=r(f),h=s["default"].createClass({displayName:"Portal",propTypes:{container:s["default"].PropTypes.oneOfType([u["default"],s["default"].PropTypes.func])},componentDidMount:function(){this._renderOverlay()},componentDidUpdate:function(){this._renderOverlay()},componentWillReceiveProps:function(e){this._overlayTarget&&e.container!==this.props.container&&(this._portalContainerNode.removeChild(this._overlayTarget),this._portalContainerNode=c["default"](e.container,d["default"](this).body),this._portalContainerNode.appendChild(this._overlayTarget))},componentWillUnmount:function(){this._unrenderOverlay(),this._unmountOverlayTarget()},_mountOverlayTarget:function(){this._overlayTarget||(this._overlayTarget=document.createElement("div"),this._portalContainerNode=c["default"](this.props.container,d["default"](this).body),this._portalContainerNode.appendChild(this._overlayTarget))},_unmountOverlayTarget:function(){this._overlayTarget&&(this._portalContainerNode.removeChild(this._overlayTarget),this._overlayTarget=null),this._portalContainerNode=null},_renderOverlay:function(){var e=this.props.children?s["default"].Children.only(this.props.children):null;null!==e?(this._mountOverlayTarget(),this._overlayInstance=l["default"].unstable_renderSubtreeIntoContainer(this,e,this._overlayTarget)):(this._unrenderOverlay(),this._unmountOverlayTarget())},_unrenderOverlay:function(){this._overlayTarget&&(l["default"].unmountComponentAtNode(this._overlayTarget),this._overlayInstance=null)},render:function(){return null},getMountNode:function(){return this._overlayTarget},getOverlayDOMNode:function(){if(!this.isMounted())throw new Error("getOverlayDOMNode(): A component must be mounted to have a DOM node.");return this._overlayInstance?this._overlayInstance.getWrappedDOMNode?this._overlayInstance.getWrappedDOMNode():l["default"].findDOMNode(this._overlayInstance):null}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return 0===e.button}function l(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function i(){var e=g+"_"+T++;return{id:e,suppressRootClose:function(t){t.nativeEvent[e]=!0}}}t.__esModule=!0;var u=n(1),p=r(u),d=n(13),f=r(d),c=n(116),h=r(c),y=n(261),v=r(y),m=n(29),b=r(m),g="__click_was_inside",T=0,x=function(e){function t(n){o(this,t),e.call(this,n),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleDocumentKeyUp=this.handleDocumentKeyUp.bind(this);var r=i(),s=r.id,a=r.suppressRootClose;this._suppressRootId=s,this._suppressRootCloseHandler=a}return s(t,e),t.prototype.bindRootCloseHandlers=function(){var e=b["default"](this);this._onDocumentClickListener=h["default"](e,"click",this.handleDocumentClick),this._onDocumentKeyupListener=h["default"](e,"keyup",this.handleDocumentKeyUp)},t.prototype.handleDocumentClick=function(e){e[this._suppressRootId]||!l(e)&&a(e)&&this.props.onRootClose()},t.prototype.handleDocumentKeyUp=function(e){27===e.keyCode&&this.props.onRootClose()},t.prototype.unbindRootCloseHandlers=function(){this._onDocumentClickListener&&this._onDocumentClickListener.remove(),this._onDocumentKeyupListener&&this._onDocumentKeyupListener.remove()},t.prototype.componentDidMount=function(){this.bindRootCloseHandlers()},t.prototype.render=function(){var e=this.props,t=e.noWrap,n=e.children,r=p["default"].Children.only(n);return t?p["default"].cloneElement(r,{onClick:v["default"](this._suppressRootCloseHandler,r.props.onClick)}):p["default"].createElement("div",{onClick:this._suppressRootCloseHandler},r)},t.prototype.getWrappedDOMNode=function(){var e=f["default"].findDOMNode(this);return this.props.noWrap?e:e.firstChild},t.prototype.componentWillUnmount=function(){this.unbindRootCloseHandlers()},t}(p["default"].Component);t["default"]=x,x.displayName="RootCloseWrapper",x.propTypes={onRootClose:p["default"].PropTypes.func.isRequired,noWrap:p["default"].PropTypes.bool},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){}t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=n(1),p=r(u),d=n(13),f=r(d),c=n(214),h=r(c),y=n(51),v=r(y),m=n(4),b=r(m),g=h["default"].end,T=0;t.UNMOUNTED=T;var x=1;t.EXITED=x;var P=2;t.ENTERING=P;var C=3;t.ENTERED=C;var E=4;t.EXITING=E;var _=function(e){function t(n,r){s(this,t),e.call(this,n,r);var o=void 0;o=n["in"]?n.transitionAppear?x:C:n.unmountOnExit?T:x,this.state={status:o},this.nextCallback=null}return a(t,e),t.prototype.componentDidMount=function(){this.props.transitionAppear&&this.props["in"]&&this.performEnter(this.props)},t.prototype.componentWillReceiveProps=function(e){e["in"]&&this.props.unmountOnExit?this.state.status===T&&this.setState({status:x}):this._needsUpdate=!0},t.prototype.componentDidUpdate=function(){var e=this.state.status;return this.props.unmountOnExit&&e===x?void(this.props["in"]?this.performEnter(this.props):this.setState({status:T})):void(this._needsUpdate&&(this._needsUpdate=!1,this.props["in"]?e===E?this.performEnter(this.props):e===x&&this.performEnter(this.props):e!==P&&e!==C||this.performExit(this.props)))},t.prototype.componentWillUnmount=function(){this.cancelNextCallback()},t.prototype.performEnter=function(e){var t=this;this.cancelNextCallback();var n=f["default"].findDOMNode(this);e.onEnter(n),this.safeSetState({status:P},function(){t.props.onEntering(n),t.onTransitionEnd(n,function(){t.safeSetState({status:C},function(){t.props.onEntered(n)})})})},t.prototype.performExit=function(e){var t=this;this.cancelNextCallback();var n=f["default"].findDOMNode(this);e.onExit(n),this.safeSetState({status:E},function(){t.props.onExiting(n),t.onTransitionEnd(n,function(){t.safeSetState({status:x},function(){t.props.onExited(n)})})})},t.prototype.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},t.prototype.safeSetState=function(e,t){this.setState(e,this.setNextCallback(t))},t.prototype.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},t.prototype.onTransitionEnd=function(e,t){this.setNextCallback(t),e?(v["default"](e,g,this.nextCallback),setTimeout(this.nextCallback,this.props.timeout)):setTimeout(this.nextCallback,0)},t.prototype.render=function(){var e=this.state.status;if(e===T)return null;var n=this.props,r=n.children,s=n.className,a=o(n,["children","className"]);Object.keys(t.propTypes).forEach(function(e){return delete a[e]});var l=void 0;e===x?l=this.props.exitedClassName:e===P?l=this.props.enteringClassName:e===C?l=this.props.enteredClassName:e===E&&(l=this.props.exitingClassName);var u=p["default"].Children.only(r);return p["default"].cloneElement(u,i({},a,{className:b["default"](u.props.className,s,l)}))},t}(p["default"].Component);_.propTypes={"in":p["default"].PropTypes.bool,unmountOnExit:p["default"].PropTypes.bool,transitionAppear:p["default"].PropTypes.bool,timeout:p["default"].PropTypes.number,exitedClassName:p["default"].PropTypes.string,exitingClassName:p["default"].PropTypes.string,enteredClassName:p["default"].PropTypes.string,enteringClassName:p["default"].PropTypes.string,onEnter:p["default"].PropTypes.func,onEntering:p["default"].PropTypes.func,onEntered:p["default"].PropTypes.func,onExit:p["default"].PropTypes.func,onExiting:p["default"].PropTypes.func,onExited:p["default"].PropTypes.func},_.displayName="Transition",_.defaultProps={"in":!1,unmountOnExit:!1,transitionAppear:!1,timeout:5e3,onEnter:l,onEntering:l,onEntered:l,onExit:l,onExiting:l,onExited:l},t["default"]=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var o=n(51),s=r(o),a=n(92),l=r(a);t["default"]=function(e,t,n){return s["default"](e,t,n),{remove:function(){l["default"](e,t,n)}}},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"body"===e.tagName.toLowerCase()}function s(e){var t=p["default"](e),n=i["default"](t),r=n.innerWidth;if(!r){var o=t.documentElement.getBoundingClientRect();r=o.right-Math.abs(o.left)}return t.body.clientWidth<r}function a(e){var t=i["default"](e);return t||o(e)?s(e):e.scrollHeight>e.clientHeight}t.__esModule=!0,t["default"]=a;var l=n(33),i=r(l),u=n(23),p=r(u);e.exports=t["default"]},function(e,t){"use strict";function n(e,t,n,r){return"Invalid prop '"+t+"' of value '"+e[t]+"'"+(" supplied to '"+n+"'"+r)}function r(e){function t(t,n,r,o){return o=o||"<<anonymous>>",null!=n[r]?e(n,r,o):t?new Error("Required prop '"+r+"' was not specified in '"+o+"'."):void 0}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}t.__esModule=!0,t.errMsg=n,t.createChainableTypeChecker=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=l.errMsg(e,t,n,". Expected an Element `type`");if("function"!=typeof e[t]){if(a["default"].isValidElement(e[t]))return new Error(r+", not an actual Element");if("string"!=typeof e[t])return new Error(r+" such as a tag name or return value of React.createClass(...)")}}t.__esModule=!0;var s=n(1),a=r(s),l=n(118);t["default"]=l.createChainableTypeChecker(o),e.exports=t["default"]},function(e,t){"use strict";function n(e,t,n,r){return"Invalid prop '"+t+"' of value '"+e[t]+"'"+(" supplied to '"+n+"'"+r)}function r(e){function t(t,n,r,o){return o=o||"<<anonymous>>",null!=n[r]?e(n,r,o):t?new Error("Required prop '"+r+"' was not specified in '"+o+"'."):void 0}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}t.__esModule=!0,t.errMsg=n,t.createChainableTypeChecker=r},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(81),i=o(l),u=a["default"].createClass({displayName:"Accordion",render:function(){return a["default"].createElement(i["default"],r({},this.props,{accordion:!0}),this.props.children)}});t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(39),p=o(u),d=n(10),f=n(5),c=i["default"].createClass({displayName:"Alert",propTypes:{onDismiss:i["default"].PropTypes.func,dismissAfter:p["default"](i["default"].PropTypes.number,"No longer supported."),closeLabel:i["default"].PropTypes.string},getDefaultProps:function(){return{closeLabel:"Close Alert"}},renderDismissButton:function(){return i["default"].createElement("button",{type:"button",className:"close",onClick:this.props.onDismiss,"aria-hidden":"true",tabIndex:"-1"},i["default"].createElement("span",null,""))},renderSrOnlyDismissButton:function(){return i["default"].createElement("button",{type:"button",className:"close sr-only",onClick:this.props.onDismiss},this.props.closeLabel)},render:function(){var e=f.getClassSet(this.props),t=!!this.props.onDismiss;return e[f.prefix(this.props,"dismissable")]=t,i["default"].createElement("div",r({},this.props,{role:"alert",className:a["default"](this.props.className,e)}),t?this.renderDismissButton():null,this.props.children,t?this.renderSrOnlyDismissButton():null)},componentDidMount:function(){this.props.dismissAfter&&this.props.onDismiss&&(this.dismissTimer=setTimeout(this.props.onDismiss,this.props.dismissAfter))},componentWillUnmount:function(){clearTimeout(this.dismissTimer)}});t["default"]=f.bsStyles(d.State.values(),d.State.INFO,f.bsClass("alert",c)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(5),p=n(11),d=o(p),f=i["default"].createClass({displayName:"Badge",propTypes:{pullRight:i["default"].PropTypes.bool},getDefaultProps:function(){return{pullRight:!1,bsClass:"badge"}},hasContent:function(){var e=this.props.children;return d["default"].count(e)>0||i["default"].Children.count(e)>1||"string"==typeof e||"number"==typeof e},render:function(){var e,t=(e={"pull-right":this.props.pullRight},e[u.prefix(this.props)]=this.hasContent(),e);return i["default"].createElement("span",r({},this.props,{className:a["default"](this.props.className,t)}),this.props.children)}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=n(11),d=s(p),f=n(64),c=s(f),h=l["default"].createClass({displayName:"Breadcrumb",propTypes:{bsClass:l["default"].PropTypes.string},getDefaultProps:function(){return{bsClass:"breadcrumb"}},render:function(){var e=this.props,t=e.className,n=r(e,["className"]);return l["default"].createElement("ol",o({},n,{role:"navigation","aria-label":"breadcrumbs",className:u["default"](t,this.props.bsClass)}),d["default"].map(this.props.children,this.renderBreadcrumbItem))},renderBreadcrumbItem:function(e,t){return a.cloneElement(e,{key:e.key||t})}});h.Item=c["default"],t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(1),u=l(i),p=n(20),d=l(p),f=n(43),c=l(f),h=n(44),y=l(h),v=n(47),m=l(v),b=n(25),g=l(b),T=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.renderFormGroup=function(e){var t=this.props,n=(t.bsStyle,t.value,s(t,["bsStyle","value"]));return u["default"].createElement(c["default"],n,e)},t.prototype.renderInput=function(){var e=this.props,t=e.children,n=e.value,r=s(e,["children","value"]),o=t?t:n;return u["default"].createElement(d["default"],a({},r,{componentClass:"input",ref:"input",key:"input",value:o}))},t}(y["default"]);T.types=d["default"].types,T.defaultProps={type:"button"},T.propTypes={type:u["default"].PropTypes.oneOf(T.types),bsStyle:function(){return null},children:m["default"],value:m["default"]},t["default"]=g["default"].wrapper(T,"`<ButtonInput>`","`<Button>` directly"),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(5),p=n(20),d=o(p),f=i["default"].createClass({displayName:"ButtonToolbar",propTypes:{bsSize:d["default"].propTypes.bsSize},getDefaultProps:function(){return{bsClass:"btn-toolbar"}},render:function(){var e=u.getClassSet(this.props);return i["default"].createElement("div",r({},this.props,{role:"toolbar",className:a["default"](this.props.className,e)}),this.props.children)}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(26)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(5),d=n(11),f=s(d),c=n(128),h=s(c),y=n(66),v=s(y),m=n(32),b=s(m),g=u["default"].createClass({displayName:"Carousel",propTypes:{slide:u["default"].PropTypes.bool,indicators:u["default"].PropTypes.bool,interval:u["default"].PropTypes.number,controls:u["default"].PropTypes.bool,pauseOnHover:u["default"].PropTypes.bool,wrap:u["default"].PropTypes.bool,onSelect:u["default"].PropTypes.func,onSlideEnd:u["default"].PropTypes.func,activeIndex:u["default"].PropTypes.number,defaultActiveIndex:u["default"].PropTypes.number,direction:u["default"].PropTypes.oneOf(["prev","next"]),prevIcon:u["default"].PropTypes.node,nextIcon:u["default"].PropTypes.node},getDefaultProps:function(){return{bsClass:"carousel",slide:!0,interval:5e3,pauseOnHover:!0,wrap:!0,indicators:!0,controls:!0,prevIcon:u["default"].createElement(b["default"],{glyph:"chevron-left"}),nextIcon:u["default"].createElement(b["default"],{glyph:"chevron-right"})}},getInitialState:function(){return{activeIndex:null==this.props.defaultActiveIndex?0:this.props.defaultActiveIndex,previousActiveIndex:null,direction:null}},getDirection:function(e,t){return e===t?null:e>t?"prev":"next"},componentWillReceiveProps:function(e){var t=this.getActiveIndex();null!=e.activeIndex&&e.activeIndex!==t&&(clearTimeout(this.timeout),this.setState({previousActiveIndex:t,direction:null!=e.direction?e.direction:this.getDirection(t,e.activeIndex)}))},componentDidMount:function(){this.waitForNext()},componentWillUnmount:function(){clearTimeout(this.timeout)},next:function(e){e&&e.preventDefault();var t=this.getActiveIndex()+1,n=f["default"].count(this.props.children);if(t>n-1){if(!this.props.wrap)return;t=0}this.handleSelect(t,e,"next")},prev:function(e){e&&e.preventDefault();var t=this.getActiveIndex()-1;if(0>t){if(!this.props.wrap)return;t=f["default"].count(this.props.children)-1}this.handleSelect(t,e,"prev")},pause:function(){this.isPaused=!0,clearTimeout(this.timeout)},play:function(){this.isPaused=!1,this.waitForNext()},waitForNext:function(){!this.isPaused&&this.props.slide&&this.props.interval&&null==this.props.activeIndex&&(this.timeout=setTimeout(this.next,this.props.interval))},handleMouseOver:function(){this.props.pauseOnHover&&this.pause()},handleMouseOut:function(){this.isPaused&&this.play()},render:function(){var e,t=(e={},e[p.prefix(this.props)]=!0,e.slide=this.props.slide,e);return u["default"].createElement("div",r({},this.props,{className:l["default"](this.props.className,t),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut}),this.props.indicators?this.renderIndicators():null,u["default"].createElement("div",{ref:"inner",className:p.prefix(this.props,"inner")},f["default"].map(this.props.children,this.renderItem)),this.props.controls?this.renderControls():null)},renderPrev:function(){var e="left "+p.prefix(this.props,"control");return u["default"].createElement("a",{className:e,href:"#prev",key:0,onClick:this.prev},this.props.prevIcon)},renderNext:function(){var e="right "+p.prefix(this.props,"control");return u["default"].createElement("a",{className:e,href:"#next",key:1,onClick:this.next},this.props.nextIcon)},renderControls:function(){if(!this.props.wrap){var e=this.getActiveIndex(),t=f["default"].count(this.props.children);return[0!==e?this.renderPrev():null,e!==t-1?this.renderNext():null]}return[this.renderPrev(),this.renderNext()]},renderIndicator:function(e,t){var n=this,r=t===this.getActiveIndex()?"active":null;return u["default"].createElement("li",{key:t,className:r,onClick:function(e){return n.handleSelect(t,e,null)}})},renderIndicators:function(){var e=this,t=[];return f["default"].forEach(this.props.children,function(n,r){t.push(e.renderIndicator(n,r)," ")},this),u["default"].createElement("ol",{className:p.prefix(this.props,"indicators")},t)},getActiveIndex:function(){return null!=this.props.activeIndex?this.props.activeIndex:this.state.activeIndex},handleItemAnimateOutEnd:function(){var e=this;this.setState({previousActiveIndex:null,direction:null},function(){e.waitForNext(),e.props.onSlideEnd&&e.props.onSlideEnd()})},renderItem:function(e,t){var n=this.getActiveIndex(),r=t===n,o=null!=this.state.previousActiveIndex&&this.state.previousActiveIndex===t&&this.props.slide;return i.cloneElement(e,{active:r,ref:e.ref,key:e.key?e.key:t,index:t,animateOut:o,animateIn:r&&null!=this.state.previousActiveIndex&&this.props.slide,direction:this.state.direction,onAnimateOutEnd:o?this.handleItemAnimateOutEnd:null})},handleSelect:function(e,t,n){if(clearTimeout(this.timeout),this.isMounted()){var r=this.getActiveIndex();n=n||this.getDirection(r,e);var o=this.props.onSelect;if(o&&(o.length>1?(t.persist(),t.direction=n,o(e,t)):o(e)),null==this.props.activeIndex&&e!==r){if(null!=this.state.previousActiveIndex)return;this.setState({activeIndex:e,previousActiveIndex:r,direction:n})}}}});g=o(g,{Caption:h["default"],Item:v["default"]}),t["default"]=g,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(9),p=o(u),d=i["default"].createClass({displayName:"Carousel.Caption",propTypes:{componentClass:p["default"]},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this.props.componentClass;return i["default"].createElement(e,r({},this.props,{className:a["default"](this.props.className,"carousel-caption")}),this.props.children)}});t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(14),c=(l(f),n(5)),h={inline:d["default"].PropTypes.bool,disabled:d["default"].PropTypes.bool,validationState:d["default"].PropTypes.oneOf(["success","warning","error"]),inputRef:d["default"].PropTypes.func},y={inline:!1,disabled:!1},v=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.inline,n=e.disabled,r=e.validationState,o=e.inputRef,l=e.className,i=e.style,p=e.children,f=a(e,["inline","disabled","validationState","inputRef","className","style","children"]);delete f.bsClass;var h=d["default"].createElement("input",s({},f,{ref:o,type:"checkbox",disabled:n}));if(t){var y,v=(y={},y[c.prefix(this.props,"inline")]=!0,y.disabled=n,y);return d["default"].createElement("label",{className:u["default"](l,v),style:i},h,p)}var m=s({},c.getClassSet(this.props),{disabled:n});return r&&(m["has-"+r]=!0),d["default"].createElement("div",{className:u["default"](l,m),style:i},d["default"].createElement("label",null,h,p))},t}(d["default"].Component);v.propTypes=h,v.defaultProps=y,t["default"]=c.bsClass("checkbox",v),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(17)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=n(10),d=s(p),f=n(9),c=s(f),h=l["default"].createClass({displayName:"Clearfix",propTypes:{componentClass:c["default"],visibleXsBlock:l["default"].PropTypes.bool,visibleSmBlock:l["default"].PropTypes.bool,visibleMdBlock:l["default"].PropTypes.bool,visibleLgBlock:l["default"].PropTypes.bool},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this,t=this.props.componentClass,n={};return o(d["default"].SIZES).forEach(function(t){var r=d["default"].SIZES[t];n["visible-"+r+"-block"]=e.props["visible"+r.charAt(0).toUpperCase()+r.slice(1)+"Block"]},this),l["default"].createElement(t,r({},this.props,{className:u["default"](this.props.className,"clearfix",n)}),this.props.children)}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(14),c=(l(f),n(5)),h={htmlFor:d["default"].PropTypes.string,srOnly:d["default"].PropTypes.bool},y={srOnly:!1},v={$bs_formGroup:d["default"].PropTypes.object},m=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.context.$bs_formGroup,t=e&&e.controlId,n=this.props,r=n.htmlFor,o=void 0===r?t:r,l=n.srOnly,i=n.className,p=a(n,["htmlFor","srOnly","className"]);delete p.bsClass;var f=s({},c.getClassSet(this.props),{"sr-only":l});return d["default"].createElement("label",s({},p,{htmlFor:o,className:u["default"](i,f)}))},t}(d["default"].Component);m.propTypes=h,m.defaultProps=y,m.contextTypes=v,t["default"]=c.bsClass("control-label",m),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(17)["default"],i=n(2)["default"];t.__esModule=!0;var u=n(1),p=i(u),d=n(30),f=i(d),c=n(60),h=i(c),y=n(37),v=i(y),m=n(20),b=i(m),g=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.bsStyle,n=e.bsSize,r=e.disabled,o=this.props,i=o.title,u=o.children,d=a(o,["title","children"]),c=v["default"](d,l(f["default"].ControlledComponent.propTypes)),y=h["default"](d,l(f["default"].ControlledComponent.propTypes));return p["default"].createElement(f["default"],s({},c,{bsSize:n,bsStyle:t}),p["default"].createElement(f["default"].Toggle,s({},y,{disabled:r}),i),p["default"].createElement(f["default"].Menu,null,u))},t}(p["default"].Component);g.propTypes=s({disabled:p["default"].PropTypes.bool,bsStyle:b["default"].propTypes.bsStyle,bsSize:b["default"].propTypes.bsSize,noCaret:p["default"].PropTypes.bool,title:p["default"].PropTypes.node.isRequired},f["default"].propTypes),g.defaultProps={disabled:!1,pullRight:!1,dropup:!1,navItem:!1,noCaret:!1},t["default"]=g,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(53),d=l(p),f=n(1),c=l(f),h=n(13),y=l(h),v=n(5),m=n(12),b=l(m),g=n(11),T=l(g),x=n(114),P=l(x),C=function(e){function t(n){o(this,t),e.call(this,n),this.focusNext=this.focusNext.bind(this),this.focusPrevious=this.focusPrevious.bind(this),this.getFocusableMenuItems=this.getFocusableMenuItems.bind(this),this.getItemsAndActiveIndex=this.getItemsAndActiveIndex.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}return r(t,e),t.prototype.handleKeyDown=function(e){switch(e.keyCode){case d["default"].codes.down:this.focusNext(),e.preventDefault();break;case d["default"].codes.up:this.focusPrevious(),e.preventDefault();break;case d["default"].codes.esc:case d["default"].codes.tab:this.props.onClose(e)}},t.prototype.focusNext=function(){var e=this.getItemsAndActiveIndex(),t=e.items,n=e.activeItemIndex;return 0!==t.length?n===t.length-1?void t[0].focus():void t[n+1].focus():void 0},t.prototype.focusPrevious=function(){var e=this.getItemsAndActiveIndex(),t=e.items,n=e.activeItemIndex;return 0===n?void t[t.length-1].focus():void t[n-1].focus()},t.prototype.getItemsAndActiveIndex=function(){var e=this.getFocusableMenuItems(),t=document.activeElement,n=e.indexOf(t);return{items:e,activeItemIndex:n}},t.prototype.getFocusableMenuItems=function(){var e=y["default"].findDOMNode(this);return void 0===e?[]:[].slice.call(e.querySelectorAll('[tabIndex="-1"]'),0)},t.prototype.render=function(){var e,t=this,n=this.props,r=n.children,o=n.onSelect,l=n.pullRight,i=n.className,p=n.labelledBy,d=n.open,f=n.onClose,h=s(n,["children","onSelect","pullRight","className","labelledBy","open","onClose"]),y=T["default"].map(r,function(e){var n=e.props||{};return c["default"].cloneElement(e,{onKeyDown:b["default"](n.onKeyDown,t.handleKeyDown),onSelect:b["default"](n.onSelect,o)},n.children)}),m=(e={},e[v.prefix(this.props,"menu")]=!0,e[v.prefix(this.props,"menu-right")]=l,e),g=c["default"].createElement("ul",a({className:u["default"](i,m),role:"menu","aria-labelledby":p},h),y);return d&&(g=c["default"].createElement(P["default"],{noWrap:!0,onRootClose:f},g)),g},t}(c["default"].Component);C.defaultProps={bsRole:"menu",bsClass:"dropdown",pullRight:!1},C.propTypes={open:c["default"].PropTypes.bool,
pullRight:c["default"].PropTypes.bool,onClose:c["default"].PropTypes.func,labelledBy:c["default"].PropTypes.oneOfType([c["default"].PropTypes.string,c["default"].PropTypes.number]),onSelect:c["default"].PropTypes.func},t["default"]=C,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(9),c=l(f),h=n(5),y={horizontal:d["default"].PropTypes.bool,inline:d["default"].PropTypes.bool,componentClass:c["default"]},v={horizontal:!1,inline:!1,componentClass:"form"},m=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.horizontal,n=e.inline,r=e.componentClass,o=e.className,l=s(e,["horizontal","inline","componentClass","className"]);delete l.bsClass;var i=[];return t&&i.push(h.prefix(this.props,"horizontal")),n&&i.push(h.prefix(this.props,"inline")),d["default"].createElement(r,a({},l,{className:u["default"](o,i)}))},t}(d["default"].Component);m.propTypes=y,m.defaultProps=v,t["default"]=h.bsClass("form",m),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(9),c=l(f),h=n(14),y=(l(h),n(5)),v=n(136),m=l(v),b=n(137),g=l(b),T={componentClass:c["default"],type:d["default"].PropTypes.string,id:d["default"].PropTypes.string},x={componentClass:"input"},P={$bs_formGroup:d["default"].PropTypes.object},C=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.context.$bs_formGroup,t=e&&e.controlId,n=this.props,r=n.componentClass,o=n.type,l=n.id,i=void 0===l?t:l,p=n.className,f=s(n,["componentClass","type","id","className"]);delete f.bsClass;var c=void 0;return"file"!==o&&(c=y.getClassSet(this.props)),d["default"].createElement(r,a({},f,{type:o,id:i,className:u["default"](p,c)}))},t}(d["default"].Component);C.propTypes=T,C.defaultProps=x,C.contextTypes=P,C.Feedback=m["default"],C.Static=g["default"],t["default"]=y.bsClass("form-control",C),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(5),c=n(32),h=l(c),y={bsRole:"feedback"},v={$bs_formGroup:d["default"].PropTypes.object},m=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.getGlyph=function(e){switch(e){case"success":return"ok";case"warning":return"warning-sign";case"error":return"remove";default:return null}},t.prototype.renderDefaultFeedback=function(e,t,n,r){var o=this.getGlyph(e&&e.validationState);return o?d["default"].createElement(h["default"],s({},r,{glyph:o,className:u["default"](t,n)})):null},t.prototype.render=function(){var e=this.props,t=e.className,n=e.children,r=a(e,["className","children"]);delete r.bsClass;var o=f.getClassSet(this.props);if(!n)return this.renderDefaultFeedback(this.context.$bs_formGroup,t,o,r);var l=d["default"].Children.only(n);return d["default"].cloneElement(l,s({},r,{className:u["default"](l.props.className,t,o)}))},t}(d["default"].Component);m.defaultProps=y,m.contextTypes=v,t["default"]=f.bsClass("form-control-feedback",m),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(9),c=l(f),h=n(5),y={componentClass:c["default"]},v={componentClass:"p"},m=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.componentClass,n=e.className,r=s(e,["componentClass","className"]);delete r.bsClass;var o=h.getClassSet(this.props);return d["default"].createElement(t,a({},r,{className:u["default"](n,o)}))},t}(d["default"].Component);m.propTypes=y,m.defaultProps=v,t["default"]=h.bsClass("form-control-static",m),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(9),c=l(f),h=n(44),y=l(h),v=n(47),m=l(v),b=n(25),g=l(b),T=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.getValue=function(){var e=this.props,t=e.children,n=e.value;return t?t:n},t.prototype.renderInput=function(){var e=this.props,t=e.componentClass,n=s(e,["componentClass"]);return d["default"].createElement(t,a({},n,{className:u["default"](n.className,"form-control-static"),ref:"input",key:"input"}),this.getValue())},t}(y["default"]);T.propTypes={value:m["default"],componentClass:c["default"],children:m["default"]},T.defaultProps={componentClass:"p"},t["default"]=g["default"].wrapper(T,"`<FormControls.Static>`","`<FormControl.Static>`"),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(5),c=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=s(e,["className"]);delete n.bsClass;var r=f.getClassSet(this.props);return d["default"].createElement("span",a({},n,{className:u["default"](t,r)}))},t}(d["default"].Component);t["default"]=f.bsClass("help-block",c),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=a["default"].createClass({displayName:"Image",propTypes:{responsive:a["default"].PropTypes.bool,rounded:a["default"].PropTypes.bool,circle:a["default"].PropTypes.bool,thumbnail:a["default"].PropTypes.bool},getDefaultProps:function(){return{responsive:!1,rounded:!1,circle:!1,thumbnail:!1}},render:function(){var e={"img-responsive":this.props.responsive,"img-rounded":this.props.rounded,"img-circle":this.props.circle,"img-thumbnail":this.props.thumbnail};return a["default"].createElement("img",r({},this.props,{className:i["default"](this.props.className,e)}))}});t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(2)["default"],a=n(48)["default"];t.__esModule=!0;var l=n(1),i=s(l),u=n(69),p=a(u),d=n(44),f=s(d),c=n(25),h=s(c),y=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){return"static"===this.props.type?(h["default"]("Input type=static","FormControls.Static"),i["default"].createElement(p.Static,this.props)):e.prototype.render.call(this)},t}(f["default"]);y.propTypes={type:i["default"].PropTypes.string},t["default"]=h["default"].wrapper(y,"`<Input>`","`<FormControl>`, `<Checkbox>`, or `<Radio>`, with `<FormGroup>` and/or `<InputGroup>` as needed"),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(10),c=n(5),h=n(143),y=l(h),v=n(144),m=l(v),b=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=s(e,["className"]);delete n.bsClass,delete n.bsSize;var r=c.getClassSet(this.props);return d["default"].createElement("span",a({},n,{className:u["default"](t,r)}))},t}(d["default"].Component);b.Addon=y["default"],b.Button=m["default"],t["default"]=c.bsClass("input-group",c.bsSizes([f.Sizes.LARGE,f.Sizes.SMALL],b)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(5),c=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=s(e,["className"]);delete n.bsClass;var r=f.getClassSet(this.props);return d["default"].createElement("span",a({},n,{className:u["default"](t,r)}))},t}(d["default"].Component);t["default"]=f.bsClass("input-group-addon",c),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(5),c=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=s(e,["className"]);delete n.bsClass;var r=f.getClassSet(this.props);return d["default"].createElement("span",a({},n,{className:u["default"](t,r)}))},t}(d["default"].Component);t["default"]=f.bsClass("input-group-btn",c),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=n(9),p=o(u),d=a["default"].createClass({displayName:"Jumbotron",propTypes:{componentClass:p["default"]},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this.props.componentClass;return a["default"].createElement(e,r({},this.props,{className:i["default"](this.props.className,"jumbotron")}),this.props.children)}});t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(10),f=n(5),c=function(e){function t(){o(this,n),e.apply(this,arguments)}r(t,e),t.prototype.render=function(){var e=f.getClassSet(this.props);return p["default"].createElement("span",s({},this.props,{className:i["default"](this.props.className,e)}),this.props.children)};var n=t;return t=f.bsStyles(d.State.values().concat(d.DEFAULT,d.PRIMARY),d.DEFAULT)(t)||t,t=f.bsClass("label")(t)||t}(p["default"].Component);t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(1),i=a(l),u=n(72),p=a(u),d=n(4),f=a(d),c=n(11),h=a(c),y=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this,t=h["default"].map(this.props.children,function(e,t){return l.cloneElement(e,{key:e.key?e.key:t})});if(this.areCustomChildren(t)){var n=this.props.componentClass;return i["default"].createElement(n,s({},this.props,{className:f["default"](this.props.className,"list-group")}),t)}var r=!1;return this.props.children?h["default"].forEach(this.props.children,function(t){e.isAnchorOrButton(t.props)&&(r=!0)}):r=!0,r?this.renderDiv(t):this.renderUL(t)},t.prototype.isAnchorOrButton=function(e){return e.href||e.onClick},t.prototype.areCustomChildren=function(e){var t=!1;return h["default"].forEach(e,function(e){e.type!==p["default"]&&(t=!0)},this),t},t.prototype.renderUL=function(e){var t=h["default"].map(e,function(e){return l.cloneElement(e,{listItem:!0})});return i["default"].createElement("ul",s({},this.props,{className:f["default"](this.props.className,"list-group")}),t)},t.prototype.renderDiv=function(e){return i["default"].createElement("div",s({},this.props,{className:f["default"](this.props.className,"list-group")}),e)},t}(i["default"].Component);y.defaultProps={componentClass:"div"},y.propTypes={className:i["default"].PropTypes.string,componentClass:i["default"].PropTypes.oneOf(["ul","div"]),id:i["default"].PropTypes.oneOfType([i["default"].PropTypes.string,i["default"].PropTypes.number])},t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(26)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(1),i=a(l),u=n(9),p=a(u),d=n(4),f=a(d),c=n(150),h=a(c),y=n(149),v=a(y),m=n(151),b=a(m),g=n(154),T=a(g),x=n(152),P=a(x),C=n(153),E=a(C),_=i["default"].createClass({displayName:"Media",propTypes:{componentClass:p["default"]},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this.props,t=e.componentClass,n=e.className,s=r(e,["componentClass","className"]);return i["default"].createElement(t,o({},s,{className:f["default"](n,"media")}))}});_=s(_,{Heading:h["default"],Body:v["default"],Left:b["default"],Right:T["default"],List:P["default"],ListItem:E["default"]}),t["default"]=_,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(9),u=s(i),p=n(4),d=s(p),f=l["default"].createClass({displayName:"Media.Body",propTypes:{componentClass:u["default"]},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this.props,t=e.componentClass,n=e.className,s=r(e,["componentClass","className"]);return l["default"].createElement(t,o({},s,{className:d["default"](n,"media-body")}))}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(9),u=s(i),p=n(4),d=s(p),f=l["default"].createClass({displayName:"Media.Heading",propTypes:{componentClass:u["default"]},getDefaultProps:function(){return{componentClass:"h4"}},render:function(){var e=this.props,t=e.componentClass,n=e.className,s=r(e,["componentClass","className"]);return l["default"].createElement(t,o({},s,{className:d["default"](n,"media-heading")}))}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=l["default"].createClass({displayName:"Media.Left",propTypes:{align:l["default"].PropTypes.oneOf(["top","middle","bottom"])},render:function(){var e,t=this.props,n=t.align,s=t.className,a=r(t,["align","className"]),i=u["default"](s,"media-left",(e={},e["media-"+n]=Boolean(n),e));return l["default"].createElement("div",o({},a,{className:i}))}});t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=l["default"].createClass({displayName:"Media.List",render:function(){var e=this.props,t=e.className,n=r(e,["className"]);return l["default"].createElement("ul",o({},n,{className:u["default"](t,"media-list")}))}});t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=l["default"].createClass({displayName:"Media.ListItem",render:function(){var e=this.props,t=e.className,n=r(e,["className"]);return l["default"].createElement("li",o({},n,{className:u["default"](t,"media")}))}});t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(4),u=s(i),p=l["default"].createClass({displayName:"Media.Right",propTypes:{align:l["default"].PropTypes.oneOf(["top","middle","bottom"])},render:function(){var e,t=this.props,n=t.align,s=t.className,a=r(t,["align","className"]),i=u["default"](s,"media-right",(e={},e["media-"+n]=Boolean(n),e));return l["default"].createElement("div",o({},a,{className:i}))}});t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(6)["default"],a=n(3)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(38),c=l(f),h=n(5),y=n(12),v=l(y),m=n(16),b=l(m),g=function(e){function t(n){o(this,t),e.call(this,n),this.handleClick=this.handleClick.bind(this)}return r(t,e),t.prototype.handleClick=function(e){this.props.href&&!this.props.disabled||e.preventDefault(),this.props.disabled||this.props.onSelect&&this.props.onSelect(this.props.eventKey,e)},t.prototype.render=function(){if(this.props.divider)return d["default"].createElement("li",{role:"separator",className:u["default"]("divider",this.props.className),style:this.props.style});if(this.props.header){var e=h.prefix(this.props,"header");return d["default"].createElement("li",{role:"heading",className:u["default"](e,this.props.className),style:this.props.style},this.props.children)}var t=this.props,n=t.className,r=t.style,o=t.onClick,l=s(t,["className","style","onClick"]);delete l.onSelect;var i={disabled:this.props.disabled,active:this.props.active};return d["default"].createElement("li",{role:"presentation",className:u["default"](n,i),style:r},d["default"].createElement(b["default"],a({},l,{role:"menuitem",tabIndex:"-1",onClick:v["default"](o,this.handleClick)})))},t}(d["default"].Component);g.propTypes={active:d["default"].PropTypes.bool,disabled:d["default"].PropTypes.bool,divider:c["default"](d["default"].PropTypes.bool,function(e){return e.divider&&e.children?new Error("Children will not be rendered for dividers"):void 0}),eventKey:d["default"].PropTypes.any,header:d["default"].PropTypes.bool,href:d["default"].PropTypes.string,target:d["default"].PropTypes.string,title:d["default"].PropTypes.string,onClick:d["default"].PropTypes.func,onKeyDown:d["default"].PropTypes.func,onSelect:d["default"].PropTypes.func,id:d["default"].PropTypes.oneOfType([d["default"].PropTypes.string,d["default"].PropTypes.number])},g.defaultProps={divider:!1,disabled:!1,header:!1},t["default"]=h.bsClass("dropdown",g),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(6)["default"],s=n(17)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(207),p=a(u),d=n(23),f=a(d),c=n(21),h=a(c),y=n(96),v=a(y),m=n(37),b=a(m),g=n(1),T=a(g),x=n(13),P=a(x),C=n(256),E=a(C),_=n(117),N=a(_),O=n(39),S=a(O),w=n(9),k=a(w),M=n(10),I=n(5),D=n(31),A=a(D),R=n(157),L=a(R),j=n(73),K=a(j),F=n(75),B=a(F),H=n(76),U=a(H),W=n(74),$=a(W),z=T["default"].createClass({displayName:"Modal",propTypes:r({},E["default"].propTypes,L["default"].propTypes,{backdrop:T["default"].PropTypes.oneOf(["static",!0,!1]),keyboard:T["default"].PropTypes.bool,animation:T["default"].PropTypes.bool,dialogComponentClass:k["default"],dialogComponent:S["default"](k["default"],"Use `dialogComponentClass`."),autoFocus:T["default"].PropTypes.bool,enforceFocus:T["default"].PropTypes.bool,bsStyle:T["default"].PropTypes.string,show:T["default"].PropTypes.bool,onHide:T["default"].PropTypes.func,onEnter:T["default"].PropTypes.func,onEntering:T["default"].PropTypes.func,onEntered:T["default"].PropTypes.func,onExit:T["default"].PropTypes.func,onExiting:T["default"].PropTypes.func,onExited:T["default"].PropTypes.func}),childContextTypes:{$bs_onModalHide:T["default"].PropTypes.func},getDefaultProps:function(){return r({},E["default"].defaultProps,{bsClass:"modal",animation:!0,dialogComponentClass:L["default"]})},getInitialState:function(){return{modalStyles:{}}},getChildContext:function(){return{$bs_onModalHide:this.props.onHide}},componentWillUnmount:function(){p["default"].off(window,"resize",this.handleWindowResize)},render:function(){var e=this,t=this.props,n=t.className,a=(t.children,t.dialogClassName),l=t.animation,u=o(t,["className","children","dialogClassName","animation"]),p=this.state.modalStyles,d={"in":u.show&&!l},f=u.dialogComponent||u.dialogComponentClass,c=b["default"](u,s(E["default"].propTypes).concat(["onExit","onExiting","onEnter","onEntered"])),h=T["default"].createElement(f,r({key:"modal",ref:function(t){return e._modal=t}},u,{style:p,className:i["default"](n,d),dialogClassName:a,onClick:u.backdrop===!0?this.handleDialogClick:null}),this.props.children);return T["default"].createElement(E["default"],r({},c,{show:u.show,ref:function(t){e._wrapper=t&&t.refs.modal,e._backdrop=t&&t.refs.backdrop},onEntering:this._onShow,onExited:this._onHide,backdropClassName:i["default"](I.prefix(u,"backdrop"),d),containerClassName:I.prefix(u,"open"),transition:l?A["default"]:void 0,dialogTransitionTimeout:z.TRANSITION_DURATION,backdropTransitionTimeout:z.BACKDROP_TRANSITION_DURATION}),h)},_onShow:function(){if(p["default"].on(window,"resize",this.handleWindowResize),this.setState(this._getStyles()),this.props.onEntering){var e;(e=this.props).onEntering.apply(e,arguments)}},_onHide:function(){if(p["default"].off(window,"resize",this.handleWindowResize),this.props.onExited){var e;(e=this.props).onExited.apply(e,arguments)}},handleDialogClick:function(e){e.target===e.currentTarget&&this.props.onHide()},handleWindowResize:function(){this.setState(this._getStyles())},_getStyles:function(){if(!h["default"])return{};var e=P["default"].findDOMNode(this._modal),t=f["default"](e),n=e.scrollHeight,r=N["default"](P["default"].findDOMNode(this.props.container||t.body)),o=n>t.documentElement.clientHeight;return{modalStyles:{paddingRight:r&&!o?v["default"]():void 0,paddingLeft:!r&&o?v["default"]():void 0}}}});z.Body=K["default"],z.Header=B["default"],z.Title=U["default"],z.Footer=$["default"],z.Dialog=L["default"],z.TRANSITION_DURATION=300,z.BACKDROP_TRANSITION_DURATION=150,t["default"]=I.bsSizes([M.Sizes.LARGE,M.Sizes.SMALL],I.bsClass("modal",z)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(10),p=n(5),d=i["default"].createClass({displayName:"ModalDialog",propTypes:{dialogClassName:i["default"].PropTypes.string},render:function(){var e=r({display:"block"},this.props.style),t=p.prefix(this.props),n=p.getClassSet(this.props);return delete n[t],n[p.prefix(this.props,"dialog")]=!0,i["default"].createElement("div",r({},this.props,{title:null,tabIndex:"-1",role:"dialog",style:e,className:a["default"](this.props.className,t)}),i["default"].createElement("div",{className:a["default"](this.props.dialogClassName,n)},i["default"].createElement("div",{className:p.prefix(this.props,"content"),role:"document"},this.props.children)))}});t["default"]=p.bsSizes([u.Sizes.LARGE,u.Sizes.SMALL],p.bsClass("modal",d)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(1),u=l(i),p=n(30),d=l(p),f=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.title,r=e.noCaret,o=a(e,["children","title","noCaret"]);return u["default"].createElement(d["default"],s({},o,{componentClass:"li"}),u["default"].createElement(d["default"].Toggle,{useAnchor:!0,disabled:o.disabled,noCaret:r},n),u["default"].createElement(d["default"].Menu,null,t))},t}(u["default"].Component);f.propTypes=s({noCaret:u["default"].PropTypes.bool,title:u["default"].PropTypes.node.isRequired},d["default"].propTypes),t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t,n){var r=function(e,n){var r,a=e.componentClass,l=e.className,u=o(e,["componentClass","className"]),d=n.$bs_navbar_bsClass,f=void 0===d?"navbar":d;return p["default"].createElement(a,s({},u,{className:i["default"](l,v.prefix({bsClass:f},t),(r={},r[v.prefix({bsClass:f},"right")]=u.pullRight,r[v.prefix({bsClass:f},"left")]=u.pullLeft,r))}))};return r.displayName=n,r.propTypes={componentClass:f["default"],pullRight:p["default"].PropTypes.bool,pullLeft:p["default"].PropTypes.bool},r.defaultProps={componentClass:e,pullRight:!1,pullLeft:!1},r.contextTypes={$bs_navbar_bsClass:u.PropTypes.string},r}var o=n(6)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(9),f=a(d),c=n(41),h=a(c),y=n(10),v=n(5),m=n(70),b=a(m),g=n(79),T=a(g),x=n(160),P=a(x),C=n(161),E=a(C),_=n(162),N=a(_),O=p["default"].createClass({displayName:"Navbar",propTypes:{fixedTop:p["default"].PropTypes.bool,fixedBottom:p["default"].PropTypes.bool,staticTop:p["default"].PropTypes.bool,inverse:p["default"].PropTypes.bool,fluid:p["default"].PropTypes.bool,componentClass:f["default"],onToggle:p["default"].PropTypes.func,expanded:p["default"].PropTypes.bool},childContextTypes:{$bs_navbar:u.PropTypes.bool,$bs_navbar_bsClass:u.PropTypes.string,$bs_navbar_onToggle:u.PropTypes.func,$bs_navbar_expanded:u.PropTypes.bool},getDefaultProps:function(){return{componentClass:"nav",fixedTop:!1,fixedBottom:!1,staticTop:!1,inverse:!1,fluid:!1}},getChildContext:function(){return{$bs_navbar:!0,$bs_navbar_bsClass:this.props.bsClass,$bs_navbar_onToggle:this.handleToggle,$bs_navbar_expanded:this.props.expanded}},handleToggle:function(){this.props.onToggle(!this.props.expanded)},isNavExpanded:function(){return!!this.props.expanded},render:function(){var e=this.props,t=e.fixedTop,n=e.fixedBottom,r=e.staticTop,a=e.inverse,l=e.componentClass,u=e.fluid,d=e.className,f=e.children,c=o(e,["fixedTop","fixedBottom","staticTop","inverse","componentClass","fluid","className","children"]);void 0===c.role&&"nav"!==l&&(c.role="navigation"),a&&(c.bsStyle=y.INVERSE);var h=v.getClassSet(c);return h[v.prefix(this.props,"fixed-top")]=t,h[v.prefix(this.props,"fixed-bottom")]=n,h[v.prefix(this.props,"static-top")]=r,p["default"].createElement(l,s({},c,{className:i["default"](d,h)}),p["default"].createElement(b["default"],{fluid:u},f))}}),S=[y.DEFAULT,y.INVERSE];O=v.bsStyles(S,y.DEFAULT,v.bsClass("navbar",h["default"](O,{expanded:"onToggle"}))),O.Brand=T["default"],O.Header=E["default"],O.Toggle=N["default"],O.Collapse=P["default"],O.Form=r("div","form","NavbarForm"),O.Text=r("p","text","NavbarText"),O.Link=r("a","link","NavbarLink"),t["default"]=O,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(1),l=s(a),i=n(5),u=n(42),p=s(u),d=l["default"].createClass({displayName:"NavbarCollapse",contextTypes:{$bs_navbar_bsClass:a.PropTypes.string,$bs_navbar_expanded:a.PropTypes.bool},render:function(){var e=this.props,t=e.children,n=r(e,["children"]),s=this.context,a=s.$bs_navbar_bsClass,u=void 0===a?"navbar":a,d=s.$bs_navbar_expanded;return l["default"].createElement(p["default"],o({"in":d},n),l["default"].createElement("div",{className:i.prefix({bsClass:u},"collapse")},t))}});t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(5),d=u["default"].createClass({displayName:"NavbarHeader",contextTypes:{$bs_navbar_bsClass:i.PropTypes.string},render:function(){var e=this.props,t=e.className,n=r(e,["className"]),s=this.context.$bs_navbar_bsClass,a=void 0===s?"navbar":s,i=p.prefix({bsClass:a},"header");return u["default"].createElement("div",o({},n,{className:l["default"](t,i)}))}});t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(6)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(5),d=n(12),f=s(d),c=u["default"].createClass({displayName:"NavbarToggle",propTypes:{onClick:u["default"].PropTypes.func,children:i.PropTypes.node},contextTypes:{$bs_navbar_bsClass:i.PropTypes.string,$bs_navbar_onToggle:i.PropTypes.func,$bs_navbar_expanded:i.PropTypes.bool},render:function(){var e=this.props,t=e.onClick,n=e.className,s=e.children,a=o(e,["onClick","className","children"]),i=this.context,d=i.$bs_navbar_bsClass,c=void 0===d?"navbar":d,h=i.$bs_navbar_onToggle,y=i.$bs_navbar_expanded,v=r({type:"button"},a,{onClick:f["default"](t,h),className:l["default"](n,p.prefix({bsClass:c},"toggle"),!y&&"collapsed")});return s?u["default"].createElement("button",v,s):u["default"].createElement("button",v,u["default"].createElement("span",{className:"sr-only"},"Toggle navigation"),u["default"].createElement("span",{className:"icon-bar"}),u["default"].createElement("span",{className:"icon-bar"}),u["default"].createElement("span",{className:"icon-bar"}))}});t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){return Array.isArray(t)?t.indexOf(e)>=0:e===t}var o=n(3)["default"],s=n(17)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(28),i=a(l),u=n(37),p=a(u),d=n(1),f=a(d),c=n(13),h=a(c),y=n(14),v=(a(y),n(80)),m=a(v),b=n(12),g=a(b),T=f["default"].createClass({displayName:"OverlayTrigger",propTypes:o({},m["default"].propTypes,{trigger:f["default"].PropTypes.oneOfType([f["default"].PropTypes.oneOf(["click","hover","focus"]),f["default"].PropTypes.arrayOf(f["default"].PropTypes.oneOf(["click","hover","focus"]))]),delay:f["default"].PropTypes.number,delayShow:f["default"].PropTypes.number,delayHide:f["default"].PropTypes.number,defaultOverlayShown:f["default"].PropTypes.bool,overlay:f["default"].PropTypes.node.isRequired,onBlur:f["default"].PropTypes.func,onClick:f["default"].PropTypes.func,onFocus:f["default"].PropTypes.func,onMouseEnter:f["default"].PropTypes.func,onMouseLeave:f["default"].PropTypes.func,target:function(){},onHide:function(){},show:function(){}}),getDefaultProps:function(){return{defaultOverlayShown:!1,trigger:["hover","focus"]}},getInitialState:function(){return{isOverlayShown:this.props.defaultOverlayShown}},show:function(){this.setState({isOverlayShown:!0})},hide:function(){this.setState({isOverlayShown:!1})},toggle:function(){this.state.isOverlayShown?this.hide():this.show()},componentWillMount:function(){this.handleMouseOver=this.handleMouseOverOut.bind(null,this.handleDelayedShow),this.handleMouseOut=this.handleMouseOverOut.bind(null,this.handleDelayedHide)},componentDidMount:function(){this._mountNode=document.createElement("div"),this.renderOverlay()},renderOverlay:function(){h["default"].unstable_renderSubtreeIntoContainer(this,this._overlay,this._mountNode)},componentWillUnmount:function(){h["default"].unmountComponentAtNode(this._mountNode),this._mountNode=null,clearTimeout(this._hoverShowDelay),clearTimeout(this._hoverHideDelay)},componentDidUpdate:function(){this._mountNode&&this.renderOverlay()},getOverlayTarget:function(){return h["default"].findDOMNode(this)},getOverlay:function(){var e=o({},p["default"](this.props,s(m["default"].propTypes)),{show:this.state.isOverlayShown,onHide:this.hide,target:this.getOverlayTarget,onExit:this.props.onExit,onExiting:this.props.onExiting,onExited:this.props.onExited,onEnter:this.props.onEnter,onEntering:this.props.onEntering,onEntered:this.props.onEntered}),t=d.cloneElement(this.props.overlay,{placement:e.placement,container:e.container});return f["default"].createElement(m["default"],e,t)},render:function(){var e=f["default"].Children.only(this.props.children),t=e.props,n={"aria-describedby":this.props.overlay.props.id};return this._overlay=this.getOverlay(),n.onClick=g["default"](t.onClick,this.props.onClick),r("click",this.props.trigger)&&(n.onClick=g["default"](this.toggle,n.onClick)),r("hover",this.props.trigger)&&(n.onMouseOver=g["default"](this.handleMouseOver,this.props.onMouseOver,t.onMouseOver),n.onMouseOut=g["default"](this.handleMouseOut,this.props.onMouseOut,t.onMouseOut)),r("focus",this.props.trigger)&&(n.onFocus=g["default"](this.handleDelayedShow,this.props.onFocus,t.onFocus),n.onBlur=g["default"](this.handleDelayedHide,this.props.onBlur,t.onBlur)),d.cloneElement(e,n)},handleDelayedShow:function(){var e=this;if(null!=this._hoverHideDelay)return clearTimeout(this._hoverHideDelay),void(this._hoverHideDelay=null);if(!this.state.isOverlayShown&&null==this._hoverShowDelay){var t=null!=this.props.delayShow?this.props.delayShow:this.props.delay;return t?void(this._hoverShowDelay=setTimeout(function(){e._hoverShowDelay=null,e.show()},t)):void this.show()}},handleDelayedHide:function(){var e=this;if(null!=this._hoverShowDelay)return clearTimeout(this._hoverShowDelay),void(this._hoverShowDelay=null);if(this.state.isOverlayShown&&null==this._hoverHideDelay){var t=null!=this.props.delayHide?this.props.delayHide:this.props.delay;return t?void(this._hoverHideDelay=setTimeout(function(){e._hoverHideDelay=null,e.hide()},t)):void this.hide()}},handleMouseOverOut:function(e,t){var n=t.currentTarget,r=t.relatedTarget||t.nativeEvent.toElement;r&&(r===n||i["default"](n,r))||e(t)}});t["default"]=T,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=a["default"].createClass({displayName:"PageHeader",render:function(){return a["default"].createElement("div",r({},this.props,{
className:i["default"](this.props.className,"page-header")}),a["default"].createElement("h1",null,this.props.children))}});t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(16),d=s(p),f=n(12),c=s(f),h=u["default"].createClass({displayName:"PageItem",propTypes:{disabled:u["default"].PropTypes.bool,previous:u["default"].PropTypes.bool,next:u["default"].PropTypes.bool,onClick:u["default"].PropTypes.func,onSelect:u["default"].PropTypes.func,eventKey:u["default"].PropTypes.any},getDefaultProps:function(){return{disabled:!1,previous:!1,next:!1}},render:function(){var e=this.props,t=e.disabled,n=e.previous,s=e.next,a=e.onClick,i=e.className,p=e.style,f=r(e,["disabled","previous","next","onClick","className","style"]);return delete f.onSelect,delete f.eventKey,u["default"].createElement("li",{className:l["default"](i,{disabled:t,previous:n,next:s}),style:p},u["default"].createElement(d["default"],o({},f,{disabled:t,onClick:c["default"](a,this.handleSelect)})))},handleSelect:function(e){(this.props.onSelect||this.props.disabled)&&(e.preventDefault(),this.props.disabled||this.props.onSelect(this.props.eventKey,e))}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=n(11),p=o(u),d=n(12),f=o(d),c=a["default"].createClass({displayName:"Pager",propTypes:{onSelect:a["default"].PropTypes.func},render:function(){return a["default"].createElement("ul",r({},this.props,{className:i["default"](this.props.className,"pager")}),p["default"].map(this.props.children,this.renderPageItem))},renderPageItem:function(e,t){return s.cloneElement(e,{onSelect:f["default"](e.props.onSelect,this.props.onSelect),key:e.key?e.key:t})}});t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(9),p=o(u),d=n(5),f=n(168),c=o(f),h=n(16),y=o(h),v=i["default"].createClass({displayName:"Pagination",propTypes:{activePage:i["default"].PropTypes.number,items:i["default"].PropTypes.number,maxButtons:i["default"].PropTypes.number,boundaryLinks:i["default"].PropTypes.bool,ellipsis:i["default"].PropTypes.oneOfType([i["default"].PropTypes.bool,i["default"].PropTypes.node]),first:i["default"].PropTypes.oneOfType([i["default"].PropTypes.bool,i["default"].PropTypes.node]),last:i["default"].PropTypes.oneOfType([i["default"].PropTypes.bool,i["default"].PropTypes.node]),prev:i["default"].PropTypes.oneOfType([i["default"].PropTypes.bool,i["default"].PropTypes.node]),next:i["default"].PropTypes.oneOfType([i["default"].PropTypes.bool,i["default"].PropTypes.node]),onSelect:i["default"].PropTypes.func,buttonComponentClass:p["default"]},getDefaultProps:function(){return{activePage:1,items:1,maxButtons:0,first:!1,last:!1,prev:!1,next:!1,ellipsis:!0,boundaryLinks:!1,buttonComponentClass:y["default"],bsClass:"pagination"}},renderPageButtons:function(){var e=[],t=void 0,n=void 0,r=void 0,o=this.props,s=o.maxButtons,a=o.activePage,l=o.items,u=o.onSelect,p=o.ellipsis,d=o.buttonComponentClass,f=o.boundaryLinks;if(s){var h=a-parseInt(s/2,10);t=h>1?h:1,r=l>=t+s,r?n=t+s-1:(n=l,t=l-s+1,1>t&&(t=1))}else t=1,n=l;for(var y=t;n>=y;y++)e.push(i["default"].createElement(c["default"],{key:y,eventKey:y,active:y===a,onSelect:u,buttonComponentClass:d},y));return f&&p&&1!==t&&(e.unshift(i["default"].createElement(c["default"],{key:"ellipsisFirst",disabled:!0,buttonComponentClass:d},i["default"].createElement("span",{"aria-label":"More"},this.props.ellipsis===!0?"":this.props.ellipsis))),e.unshift(i["default"].createElement(c["default"],{key:1,eventKey:1,active:!1,onSelect:u,buttonComponentClass:d},"1"))),s&&r&&p&&(e.push(i["default"].createElement(c["default"],{key:"ellipsis",disabled:!0,buttonComponentClass:d},i["default"].createElement("span",{"aria-label":"More"},this.props.ellipsis===!0?"":this.props.ellipsis))),f&&n!==l&&e.push(i["default"].createElement(c["default"],{key:l,eventKey:l,active:!1,onSelect:u,buttonComponentClass:d},l))),e},renderPrev:function(){return this.props.prev?i["default"].createElement(c["default"],{key:"prev",eventKey:this.props.activePage-1,disabled:1===this.props.activePage,onSelect:this.props.onSelect,buttonComponentClass:this.props.buttonComponentClass},i["default"].createElement("span",{"aria-label":"Previous"},this.props.prev===!0?"":this.props.prev)):null},renderNext:function(){return this.props.next?i["default"].createElement(c["default"],{key:"next",eventKey:this.props.activePage+1,disabled:this.props.activePage>=this.props.items,onSelect:this.props.onSelect,buttonComponentClass:this.props.buttonComponentClass},i["default"].createElement("span",{"aria-label":"Next"},this.props.next===!0?"":this.props.next)):null},renderFirst:function(){return this.props.first?i["default"].createElement(c["default"],{key:"first",eventKey:1,disabled:1===this.props.activePage,onSelect:this.props.onSelect,buttonComponentClass:this.props.buttonComponentClass},i["default"].createElement("span",{"aria-label":"First"},this.props.first===!0?"":this.props.first)):null},renderLast:function(){return this.props.last?i["default"].createElement(c["default"],{key:"last",eventKey:this.props.items,disabled:this.props.activePage>=this.props.items,onSelect:this.props.onSelect,buttonComponentClass:this.props.buttonComponentClass},i["default"].createElement("span",{"aria-label":"Last"},this.props.last===!0?"":this.props.last)):null},render:function(){return i["default"].createElement("ul",r({},this.props,{className:a["default"](this.props.className,d.getClassSet(this.props))}),this.renderFirst(),this.renderPrev(),this.renderPageButtons(),this.renderNext(),this.renderLast())}});t["default"]=d.bsClass("pagination",v),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(9),d=s(p),f=n(12),c=s(f),h=u["default"].createClass({displayName:"PaginationButton",propTypes:{className:u["default"].PropTypes.string,eventKey:u["default"].PropTypes.any,onSelect:u["default"].PropTypes.func,disabled:u["default"].PropTypes.bool,active:u["default"].PropTypes.bool,onClick:u["default"].PropTypes.func,buttonComponentClass:d["default"]},getDefaultProps:function(){return{active:!1,disabled:!1}},handleClick:function(e){this.props.disabled||this.props.onSelect&&this.props.onSelect(this.props.eventKey,e)},render:function(){var e=this.props,t=e.active,n=e.disabled,s=e.onClick,a=e.buttonComponentClass,i=e.className,p=e.style,d=r(e,["active","disabled","onClick","buttonComponentClass","className","style"]);return delete d.onSelect,u["default"].createElement("li",{className:l["default"](i,{active:t,disabled:n}),style:p},u["default"].createElement(a,o({},d,{disabled:n,onClick:c["default"](s,this.handleClick)})))}});t["default"]=h,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(6)["default"],o=n(3)["default"],s=n(2)["default"];t.__esModule=!0;var a=n(4),l=s(a),i=n(1),u=s(i),p=n(10),d=n(5),f=n(42),c=s(f),h=u["default"].createClass({displayName:"Panel",propTypes:{collapsible:u["default"].PropTypes.bool,onSelect:u["default"].PropTypes.func,header:u["default"].PropTypes.node,id:u["default"].PropTypes.oneOfType([u["default"].PropTypes.string,u["default"].PropTypes.number]),footer:u["default"].PropTypes.node,defaultExpanded:u["default"].PropTypes.bool,expanded:u["default"].PropTypes.bool,eventKey:u["default"].PropTypes.any,headerRole:u["default"].PropTypes.string,panelRole:u["default"].PropTypes.string,onEnter:c["default"].propTypes.onEnter,onEntering:c["default"].propTypes.onEntering,onEntered:c["default"].propTypes.onEntered,onExit:c["default"].propTypes.onExit,onExiting:c["default"].propTypes.onExiting,onExited:c["default"].propTypes.onExited},getDefaultProps:function(){return{defaultExpanded:!1}},getInitialState:function(){return{expanded:this.props.defaultExpanded}},handleSelect:function(e){e.persist(),e.selected=!0,this.props.onSelect?this.props.onSelect(this.props.eventKey,e):e.preventDefault(),e.selected&&this.handleToggle()},handleToggle:function(){this.setState({expanded:!this.state.expanded})},isExpanded:function(){return null!=this.props.expanded?this.props.expanded:this.state.expanded},render:function(){var e=this.props,t=e.headerRole,n=e.panelRole,s=r(e,["headerRole","panelRole"]);return u["default"].createElement("div",o({},s,{className:l["default"](this.props.className,d.getClassSet(this.props)),id:this.props.collapsible?null:this.props.id,onSelect:null}),this.renderHeading(t),this.props.collapsible?this.renderCollapsibleBody(n):this.renderBody(),this.renderFooter())},renderCollapsibleBody:function(e){var t={onEnter:this.props.onEnter,onEntering:this.props.onEntering,onEntered:this.props.onEntered,onExit:this.props.onExit,onExiting:this.props.onExiting,onExited:this.props.onExited,"in":this.isExpanded()},n={className:d.prefix(this.props,"collapse"),id:this.props.id,ref:"panel","aria-hidden":!this.isExpanded()};return e&&(n.role=e),u["default"].createElement(c["default"],t,u["default"].createElement("div",n,this.renderBody()))},renderBody:function(){function e(){return{key:l.length}}function t(t){l.push(i.cloneElement(t,e()))}function n(t){l.push(u["default"].createElement("div",o({className:f},e()),t))}function r(){0!==p.length&&(n(p),p=[])}var s=this,a=this.props.children,l=[],p=[],f=d.prefix(this.props,"body");return Array.isArray(a)&&0!==a.length?(a.forEach(function(e){s.shouldRenderFill(e)?(r(),t(e)):p.push(e)}),r()):this.shouldRenderFill(a)?t(a):n(a),l},shouldRenderFill:function(e){return u["default"].isValidElement(e)&&null!=e.props.fill},renderHeading:function(e){var t=this.props.header;if(!t)return null;if(!u["default"].isValidElement(t)||Array.isArray(t))t=this.props.collapsible?this.renderCollapsibleTitle(t,e):t;else{var n=l["default"](d.prefix(this.props,"title"),t.props.className);t=this.props.collapsible?i.cloneElement(t,{className:n,children:this.renderAnchor(t.props.children,e)}):i.cloneElement(t,{className:n})}return u["default"].createElement("div",{className:d.prefix(this.props,"heading")},t)},renderAnchor:function(e,t){return u["default"].createElement("a",{href:"#"+(this.props.id||""),"aria-controls":this.props.collapsible?this.props.id:null,className:this.isExpanded()?null:"collapsed","aria-expanded":this.isExpanded(),"aria-selected":this.isExpanded(),onClick:this.handleSelect,role:t},e)},renderCollapsibleTitle:function(e,t){return u["default"].createElement("h4",{className:d.prefix(this.props,"title"),role:"presentation"},this.renderAnchor(e,t))},renderFooter:function(){return this.props.footer?u["default"].createElement("div",{className:d.prefix(this.props,"footer")},this.props.footer):null}}),y=p.State.values().concat(p.DEFAULT,p.PRIMARY);t["default"]=d.bsStyles(y,p.DEFAULT,d.bsClass("panel",h)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(40),p=o(u),d=n(5),f=i["default"].createClass({displayName:"Popover",propTypes:{id:p["default"](i["default"].PropTypes.oneOfType([i["default"].PropTypes.string,i["default"].PropTypes.number])),placement:i["default"].PropTypes.oneOf(["top","right","bottom","left"]),positionLeft:i["default"].PropTypes.number,positionTop:i["default"].PropTypes.number,arrowOffsetLeft:i["default"].PropTypes.oneOfType([i["default"].PropTypes.number,i["default"].PropTypes.string]),arrowOffsetTop:i["default"].PropTypes.oneOfType([i["default"].PropTypes.number,i["default"].PropTypes.string]),title:i["default"].PropTypes.node},getDefaultProps:function(){return{placement:"right",bsClass:"popover"}},render:function(){var e,t=(e={},e[d.prefix(this.props)]=!0,e[this.props.placement]=!0,e),n=r({left:this.props.positionLeft,top:this.props.positionTop,display:"block"},this.props.style),o={left:this.props.arrowOffsetLeft,top:this.props.arrowOffsetTop};return i["default"].createElement("div",r({role:"tooltip"},this.props,{className:a["default"](this.props.className,t),style:n,title:null}),i["default"].createElement("div",{className:"arrow",style:o}),this.props.title?this.renderTitle():null,i["default"].createElement("div",{className:d.prefix(this.props,"content")},this.props.children))},renderTitle:function(){return i["default"].createElement("h3",{className:d.prefix(this.props,"title")},this.props.title)}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t,n){if(e[t]){var r=function(){var r=void 0,o=void 0;return f["default"].Children.forEach(e[t],function(e){e.type!==x&&(o=e.type.displayName?e.type.displayName:e.type,r=new Error("Children of "+n+" can contain only ProgressBar components. Found "+o))}),{v:r}}();if("object"==typeof r)return r.v}}var o=n(8)["default"],s=n(7)["default"],a=n(3)["default"],l=n(6)["default"],i=n(2)["default"];t.__esModule=!0;var u=n(4),p=i(u),d=n(1),f=i(d),c=n(10),h=n(5),y=n(25),v=i(y),m=n(11),b=i(m),g=n(71),T=i(g),x=function(e){function t(){s(this,t),e.apply(this,arguments)}return o(t,e),t.prototype.getPercentage=function(e,t,n){var r=1e3;return Math.round((e-t)/(n-t)*100*r)/r},t.prototype.render=function(){if(this.props.isChild)return this.renderProgressBar();var e=void 0;return e=this.props.children?b["default"].map(this.props.children,this.renderChildBar):this.renderProgressBar(),f["default"].createElement("div",a({},this.props,{className:p["default"](this.props.className,"progress"),min:null,max:null,label:null,"aria-valuetext":null}),e)},t.prototype.renderChildBar=function(e,t){return d.cloneElement(e,{isChild:!0,key:e.key?e.key:t})},t.prototype.renderProgressBar=function(){var e,t=this.props,n=t.className,r=t.label,o=t.now,s=t.min,i=t.max,u=t.style,d=l(t,["className","label","now","min","max","style"]),c=this.getPercentage(o,s,i);"string"==typeof r&&(r=this.renderLabel(c)),this.props.srOnly&&(r=f["default"].createElement("span",{className:"sr-only"},r));var y=p["default"](n,h.getClassSet(this.props),(e={active:this.props.active},e[h.prefix(this.props,"striped")]=this.props.active||this.props.striped,e));return f["default"].createElement("div",a({},d,{className:y,role:"progressbar",style:a({width:c+"%"},u),"aria-valuenow":this.props.now,"aria-valuemin":this.props.min,"aria-valuemax":this.props.max}),r)},t.prototype.renderLabel=function(e){var t=this.props,n=t.interpolateClass,r=t.now,o=t.min,s=t.max,a=t.bsStyle,l=t.label,i=n||T["default"],u=i.REGEXP;return u&&u.exec(l)&&v["default"]("String interpolation in <ProgressBar label>","ES2015 template strings or other patterns"),f["default"].createElement(i,{now:r,min:o,max:s,percent:e,bsStyle:a},l)},t}(f["default"].Component);x.propTypes={min:d.PropTypes.number,now:d.PropTypes.number,max:d.PropTypes.number,label:d.PropTypes.node,srOnly:d.PropTypes.bool,striped:d.PropTypes.bool,active:d.PropTypes.bool,children:r,className:f["default"].PropTypes.string,interpolateClass:d.PropTypes.node,isChild:d.PropTypes.bool},x.defaultProps={min:0,max:100,active:!1,isChild:!1,srOnly:!1,striped:!1},t["default"]=h.bsStyles(c.State.values(),h.bsClass("progress-bar",x)),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(14),c=(l(f),n(5)),h={inline:d["default"].PropTypes.bool,disabled:d["default"].PropTypes.bool,validationState:d["default"].PropTypes.oneOf(["success","warning","error"]),inputRef:d["default"].PropTypes.func},y={inline:!1,disabled:!1},v=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.inline,n=e.disabled,r=e.validationState,o=e.inputRef,l=e.className,i=e.style,p=e.children,f=a(e,["inline","disabled","validationState","inputRef","className","style","children"]);delete f.bsClass;var h=d["default"].createElement("input",s({},f,{ref:o,type:"radio",disabled:n}));if(t){var y,v=(y={},y[c.prefix(this.props,"inline")]=!0,y.disabled=n,y);return d["default"].createElement("label",{className:u["default"](l,v),style:i},h,p)}var m=s({},c.getClassSet(this.props),{disabled:n});return r&&(m["has-"+r]=!0),d["default"].createElement("div",{className:u["default"](l,m),style:i},d["default"].createElement("label",null,h,p))},t}(d["default"].Component);v.propTypes=h,v.defaultProps=y,t["default"]=c.bsClass("radio",v),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(1),d=l(p),f=n(14),c=(l(f),function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.bsClass,n=e.className,r=e.a16by9,o=e.a4by3,l=e.children,i=a(e,["bsClass","className","a16by9","a4by3","children"]),f={"embed-responsive-16by9":r,"embed-responsive-4by3":o};return d["default"].createElement("div",{className:u["default"](t,f)},p.cloneElement(l,s({},i,{className:u["default"](n,"embed-responsive-item")})))},t}(d["default"].Component));c.defaultProps={bsClass:"embed-responsive",a16by9:!1,a4by3:!1},c.propTypes={bsClass:p.PropTypes.string,children:p.PropTypes.element.isRequired,a16by9:p.PropTypes.bool,a4by3:p.PropTypes.bool},t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=n(9),p=o(u),d=a["default"].createClass({displayName:"Row",propTypes:{componentClass:p["default"]},getDefaultProps:function(){return{componentClass:"div"}},render:function(){var e=this.props.componentClass;return a["default"].createElement(e,r({},this.props,{className:i["default"](this.props.className,"row")}),this.props.children)}});t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(17)["default"],i=n(2)["default"];t.__esModule=!0;var u=n(1),p=i(u),d=n(20),f=i(d),c=n(30),h=i(c),y=n(176),v=i(y),m=n(60),b=i(m),g=n(37),T=i(g),x=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.title,r=e.onClick,o=e.target,i=e.href,u=e.toggleLabel,d=e.bsSize,c=e.bsStyle,y=a(e,["children","title","onClick","target","href","toggleLabel","bsSize","bsStyle"]),m=y.disabled,g=T["default"](y,l(h["default"].ControlledComponent.propTypes)),x=b["default"](y,l(h["default"].ControlledComponent.propTypes));return p["default"].createElement(h["default"],g,p["default"].createElement(f["default"],s({},x,{onClick:r,bsStyle:c,bsSize:d,disabled:m,target:o,href:i}),n),p["default"].createElement(v["default"],{"aria-label":u||n,bsStyle:c,bsSize:d,disabled:m}),p["default"].createElement(h["default"].Menu,null,t))},t}(p["default"].Component);x.propTypes=s({},h["default"].propTypes,{bsStyle:f["default"].propTypes.bsStyle,onClick:function(){},target:p["default"].PropTypes.string,href:p["default"].PropTypes.string,title:p["default"].PropTypes.node.isRequired,toggleLabel:p["default"].PropTypes.string}),x.defaultProps={disabled:!1,dropup:!1,pullRight:!1},x.Toggle=v["default"],t["default"]=x,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(1),i=a(l),u=n(68),p=a(u),d=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){return i["default"].createElement(p["default"],s({},this.props,{useAnchor:!1,noCaret:!1}))},t}(i["default"].Component);t["default"]=d,d.defaultProps=p["default"].defaultProps,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(6)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(1),u=l(i),p=n(82),d=l(p),f=n(45),c=l(f),h=n(46),y=l(h),v=function(e){function t(){o(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.render=function(){var e=this.props,t=(e.title,e.disabled,e.tabClassName,a(e,["title","disabled","tabClassName"]));return u["default"].createElement(d["default"],t)},t}(u["default"].Component);v.propTypes=s({},d["default"].propTypes,{disabled:u["default"].PropTypes.bool,title:u["default"].PropTypes.node,tabClassName:u["default"].PropTypes.string}),v.Container=c["default"],v.Content=y["default"],v.Pane=d["default"],t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(1),a=o(s),l=n(4),i=o(l),u=a["default"].createClass({displayName:"Table",propTypes:{striped:a["default"].PropTypes.bool,bordered:a["default"].PropTypes.bool,condensed:a["default"].PropTypes.bool,hover:a["default"].PropTypes.bool,responsive:a["default"].PropTypes.bool},getDefaultProps:function(){return{bordered:!1,condensed:!1,hover:!1,responsive:!1,striped:!1}},render:function(){var e={table:!0,"table-striped":this.props.striped,"table-bordered":this.props.bordered,"table-condensed":this.props.condensed,"table-hover":this.props.hover},t=a["default"].createElement("table",r({},this.props,{className:i["default"](this.props.className,e)}),this.props.children);return this.props.responsive?a["default"].createElement("div",{className:"table-responsive"},t):t}});t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){var t=void 0;return O["default"].forEach(e,function(e){null==t&&(t=e.props.eventKey)}),t}var o=n(3)["default"],s=n(6)["default"],a=n(17)["default"],l=n(2)["default"];t.__esModule=!0;var i=n(4),u=l(i),p=n(41),d=l(p),f=n(1),c=l(f),h=n(67),y=l(h),v=n(77),m=l(v),b=n(78),g=l(b),T=n(10),x=l(T),P=n(40),C=l(P),E=n(25),_=l(E),N=n(11),O=l(N),S=n(45),w=l(S),k=n(46),M=l(k),I=w["default"].ControlledComponent,D=c["default"].createClass({displayName:"Tabs",propTypes:{activeKey:c["default"].PropTypes.any,bsStyle:c["default"].PropTypes.oneOf(["tabs","pills"]),animation:c["default"].PropTypes.bool,id:C["default"](c["default"].PropTypes.oneOfType([c["default"].PropTypes.string,c["default"].PropTypes.number])),onSelect:c["default"].PropTypes.func,unmountOnExit:c["default"].PropTypes.bool,position:c["default"].PropTypes.oneOf(["top","left","right"]),tabWidth:c["default"].PropTypes.oneOfType([c["default"].PropTypes.number,c["default"].PropTypes.object]),paneWidth:c["default"].PropTypes.oneOfType([c["default"].PropTypes.number,c["default"].PropTypes.object]),standalone:c["default"].PropTypes.bool},getDefaultProps:function(){return{bsClass:"tab",animation:!0,tabWidth:2,position:"top",standalone:!1,unmountOnExit:!1}},render:function(){var e=this.props,t=e.id,n=e.className,r=e.style,a=e.position,l=e.bsStyle,i=e.tabWidth,p=e.paneWidth,d=e.standalone,f=e.children,h=e.onSelect,v=e.activeKey,b=s(e,["id","className","style","position","bsStyle","tabWidth","paneWidth","standalone","children","onSelect","activeKey"]);v=this.getActiveKey();var g="left"===a||"right"===a;null==l&&(l=g?"pills":"tabs");var T={id:t,className:n,style:r,activeKey:v,onSelect:h},x=o({},b,{bsStyle:l,bsClass:void 0,stacked:g,ref:"tabs",role:"tablist"}),P=O["default"].map(f,this.renderTab),C={ref:"panes",animation:b.animation,unmountOnExit:b.unmountOnExit},E=f;if(g){_["default"]({message:'Horizontal Tabs (position "left" or "right") are deprecated in favor of the more flexible TabContainer component.'}),d||(T.className=u["default"](T.className,"clearfix"));var N=this.getColProps({tabWidth:i,paneWidth:p}),S=N.tabsColProps,w=N.panesColProps,k=c["default"].createElement(y["default"],o({componentClass:m["default"]},x,S),P),D=c["default"].createElement(y["default"],o({componentClass:M["default"]},C,w),E);return"left"===a?c["default"].createElement(I,T,c["default"].createElement("div",null,k,D)):c["default"].createElement(I,T,c["default"].createElement("div",null,D,k))}return c["default"].createElement(I,T,c["default"].createElement("div",null,c["default"].createElement(m["default"],x,P),c["default"].createElement(M["default"],C,E)))},getActiveKey:function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=e.activeKey,n=e.children;return void 0===t?r(n):t},renderPane:function(e,t){return f.cloneElement(e,{key:e.key?e.key:t})},renderTab:function(e){if(null==e.props.title)return null;var t=e.props,n=t.eventKey,r=t.title,o=t.disabled,s=t.tabClassName;return c["default"].createElement(g["default"],{eventKey:n,disabled:o,className:s},r)},getColProps:function(e){var t=e.tabWidth,n=e.paneWidth,r=void 0;r=t instanceof Object?t:{xs:t};var o=void 0;return null==n?(o={},a(r).forEach(function(e){o[e]=x["default"].GRID_COLUMNS-r[e]})):o=n instanceof Object?n:{xs:n},{tabsColProps:r,panesColProps:o}}});t["default"]=d["default"](D,{activeKey:"onSelect"}),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(5),p=n(16),d=o(p),f=i["default"].createClass({displayName:"Thumbnail",propTypes:{alt:i["default"].PropTypes.string,href:i["default"].PropTypes.string,src:i["default"].PropTypes.string},render:function(){var e=u.getClassSet(this.props);return this.props.href?i["default"].createElement(d["default"],r({},this.props,{href:this.props.href,className:a["default"](this.props.className,e)}),i["default"].createElement("img",{src:this.props.src,alt:this.props.alt})):this.props.children?i["default"].createElement("div",r({},this.props,{className:a["default"](this.props.className,e)}),i["default"].createElement("img",{src:this.props.src,alt:this.props.alt}),i["default"].createElement("div",{className:"caption"},this.props.children)):i["default"].createElement("div",r({},this.props,{className:a["default"](this.props.className,e)}),i["default"].createElement("img",{src:this.props.src,alt:this.props.alt}))}});t["default"]=u.bsClass("thumbnail",f),e.exports=t["default"]},function(e,t,n){"use strict";var r=n(3)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(4),a=o(s),l=n(1),i=o(l),u=n(40),p=o(u),d=n(5),f=i["default"].createClass({displayName:"Tooltip",propTypes:{id:p["default"](i["default"].PropTypes.oneOfType([i["default"].PropTypes.string,i["default"].PropTypes.number])),placement:i["default"].PropTypes.oneOf(["top","right","bottom","left"]),positionLeft:i["default"].PropTypes.number,positionTop:i["default"].PropTypes.number,arrowOffsetLeft:i["default"].PropTypes.oneOfType([i["default"].PropTypes.number,i["default"].PropTypes.string]),arrowOffsetTop:i["default"].PropTypes.oneOfType([i["default"].PropTypes.number,i["default"].PropTypes.string]),title:i["default"].PropTypes.node},getDefaultProps:function(){return{bsClass:"tooltip",placement:"right"}},render:function(){var e,t=(e={},e[d.prefix(this.props)]=!0,e[this.props.placement]=!0,e),n=r({left:this.props.positionLeft,top:this.props.positionTop},this.props.style),o={left:this.props.arrowOffsetLeft,top:this.props.arrowOffsetTop};return i["default"].createElement("div",r({role:"tooltip"},this.props,{className:a["default"](this.props.className,t),style:n}),i["default"].createElement("div",{className:d.prefix(this.props,"arrow"),style:o}),i["default"].createElement("div",{className:d.prefix(this.props,"inner")},this.props.children))}});t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(8)["default"],o=n(7)["default"],s=n(3)["default"],a=n(2)["default"];t.__esModule=!0;var l=n(4),i=a(l),u=n(1),p=a(u),d=n(10),f=n(5),c=function(e){function t(){o(this,n),e.apply(this,arguments)}r(t,e),t.prototype.render=function(){var e=f.getClassSet(this.props);return p["default"].createElement("div",s({},this.props,{className:i["default"](this.props.className,e)}),this.props.children)};var n=t;return t=f.bsSizes([d.Sizes.LARGE,d.Sizes.SMALL])(t)||t,t=f.bsClass("well")(t)||t}(p["default"].Component);t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(2)["default"];t.__esModule=!0;var o=n(120),s=n(185),a=r(s);t["default"]={requiredRoles:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return o.createChainableTypeChecker(function(e,n,r){var o=void 0,s=a["default"](e.children),l=function(e,t){return e===t.props.bsRole};return t.every(function(e){return s.some(function(t){return l(e,t)})?!0:(o=e,!1)}),o?new Error("(children) "+r+" - Missing a required child with bsRole: "+o+". "+(r+" must have at least one child of each of the following bsRoles: "+t.join(", "))):void 0})},exclusiveRoles:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return o.createChainableTypeChecker(function(e,n,r){var o=a["default"](e.children),s=void 0;return t.every(function(e){var t=o.filter(function(t){return t.props.bsRole===e});return t.length>1?(s=e,!1):!0}),s?new Error("(children) "+r+" - Duplicate children detected of bsRole: "+s+". Only one child each allowed with the following bsRoles: "+t.join(", ")):void 0})}},e.exports=t["default"]},function(e,t){"use strict";function n(){var e=document.createElement("div"),t=e.style;"AnimationEvent"in window||delete a.animationend.animation,"TransitionEvent"in window||delete a.transitionend.transition;for(var n in a){var r=a[n];for(var o in r)if(o in t){l.push(r[o]);break}}}function r(e,t,n){e.addEventListener(t,n,!1)}function o(e,t,n){e.removeEventListener(t,n,!1)}t.__esModule=!0;var s=!("undefined"==typeof window||!window.document||!window.document.createElement),a={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},l=[];s&&n();var i={addEndEventListener:function(e,t){return 0===l.length?void window.setTimeout(t,0):void l.forEach(function(n){r(e,n,t)})},removeEndEventListener:function(e,t){0!==l.length&&l.forEach(function(n){o(e,n,t)})}};t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){var t=[];return void 0===e?t:(a["default"].forEach(e,function(e){t.push(e)}),t)}var o=n(2)["default"];t.__esModule=!0,t["default"]=r;var s=n(11),a=o(s);e.exports=t["default"]},function(e,t,n){"use strict";var r=n(48)["default"],o=n(2)["default"];t.__esModule=!0;var s=n(5),a=r(s);t.bootstrapUtils=a;var l=n(47),i=o(l);t.childrenValueInputValidation=i["default"];var u=n(12),p=o(u);t.createChainedFunction=p["default"];var d=n(11),f=o(d);t.ValidComponentChildren=f["default"]},function(e,t,n){e.exports={"default":n(191),__esModule:!0}},function(e,t,n){n(201),e.exports=n(27).Object.assign},function(e,t,n){var r=n(50);e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){n(202),e.exports=n(27).Object.keys},function(e,t,n){n(203),e.exports=n(27).Object.setPrototypeOf},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(87);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(194);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(50),o=n(88),s=n(197);e.exports=n(86)(function(){var e=Object.assign,t={},n={},r=Symbol(),o="abcdefghijklmnopqrst";return t[r]=7,o.split("").forEach(function(e){n[e]=e}),7!=e({},t)[r]||Object.keys(e({},n)).join("")!=o})?function(e,t){for(var n=o(e),a=arguments,l=a.length,i=1,u=r.getKeys,p=r.getSymbols,d=r.isEnum;l>i;)for(var f,c=s(a[i++]),h=p?u(c).concat(p(c)):u(c),y=h.length,v=0;y>v;)d.call(c,f=h[v++])&&(n[f]=c[f]);
return n}:Object.assign},function(e,t,n){var r=n(49),o=n(27),s=n(86);e.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*s(function(){n(1)}),"Object",a)}},function(e,t,n){var r=n(50).getDesc,o=n(87),s=n(193),a=function(e,t){if(s(e),!o(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,o){try{o=n(85)(Function.call,r(Object.prototype,"__proto__").set,2),o(e,[]),t=!(e instanceof Array)}catch(s){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:o(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){var r=n(49);r(r.S+r.F,"Object",{assign:n(198)})},function(e,t,n){var r=n(88);n(199)("keys",function(e){return function(t){return e(r(t))}})},function(e,t,n){var r=n(49);r(r.S,"Object",{setPrototypeOf:n(200).set})},function(e,t,n){"use strict";e.exports={addClass:n(90),removeClass:n(205),hasClass:n(91)}},function(e,t){"use strict";e.exports=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}},function(e,t,n){"use strict";var r=n(28),o=n(210);e.exports=function(e,t){return function(n){var s=n.currentTarget,a=n.target,l=o(s,e);l.some(function(e){return r(e,a)})&&t.call(this,n)}}},function(e,t,n){"use strict";var r=n(51),o=n(92),s=n(206);e.exports={on:r,off:o,filter:s}},function(e,t,n){"use strict";function r(e){return e.nodeName&&e.nodeName.toLowerCase()}function o(e){for(var t=(0,l["default"])(e),n=e&&e.offsetParent;n&&"html"!==r(e)&&"static"===(0,u["default"])(n,"position");)n=n.offsetParent;return n||t.documentElement}var s=n(35);t.__esModule=!0,t["default"]=o;var a=n(23),l=s.interopRequireDefault(a),i=n(34),u=s.interopRequireDefault(i);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e.nodeName&&e.nodeName.toLowerCase()}function o(e,t){var n,o={top:0,left:0};return"fixed"===(0,y["default"])(e,"position")?n=e.getBoundingClientRect():(t=t||(0,u["default"])(e),n=(0,l["default"])(e),"html"!==r(t)&&(o=(0,l["default"])(t)),o.top+=parseInt((0,y["default"])(t,"borderTopWidth"),10)-(0,d["default"])(t)||0,o.left+=parseInt((0,y["default"])(t,"borderLeftWidth"),10)-(0,c["default"])(t)||0),s._extends({},n,{top:n.top-o.top-(parseInt((0,y["default"])(e,"marginTop"),10)||0),left:n.left-o.left-(parseInt((0,y["default"])(e,"marginLeft"),10)||0)})}var s=n(35);t.__esModule=!0,t["default"]=o;var a=n(93),l=s.interopRequireDefault(a),i=n(208),u=s.interopRequireDefault(i),p=n(94),d=s.interopRequireDefault(p),f=n(211),c=s.interopRequireDefault(f),h=n(34),y=s.interopRequireDefault(h);e.exports=t["default"]},function(e,t){"use strict";var n=/^[\w-]*$/,r=Function.prototype.bind.call(Function.prototype.call,[].slice);e.exports=function(e,t){var o,s="#"===t[0],a="."===t[0],l=s||a?t.slice(1):t,i=n.test(l);return i?s?(e=e.getElementById?e:document,(o=e.getElementById(l))?[o]:[]):r(e.getElementsByClassName&&a?e.getElementsByClassName(l):e.getElementsByTagName(t)):r(e.querySelectorAll(t))}},function(e,t,n){"use strict";var r=n(33);e.exports=function(e,t){var n=r(e);return void 0===t?n?"pageXOffset"in n?n.pageXOffset:n.document.documentElement.scrollLeft:e.scrollLeft:void(n?n.scrollTo(t,"pageYOffset"in n?n.pageYOffset:n.document.documentElement.scrollTop):e.scrollLeft=t)}},function(e,t,n){"use strict";var r=n(35),o=n(95),s=r.interopRequireDefault(o),a=/^(top|right|bottom|left)$/,l=/^([+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|))(?!px)[a-z%]+$/i;e.exports=function(e){if(!e)throw new TypeError("No Element passed to `getComputedStyle()`");var t=e.ownerDocument;return"defaultView"in t?t.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):window.getComputedStyle(e,null):{getPropertyValue:function(t){var n=e.style;t=(0,s["default"])(t),"float"==t&&(t="styleFloat");var r=e.currentStyle[t]||null;if(null==r&&n&&n[t]&&(r=n[t]),l.test(r)&&!a.test(t)){var o=n.left,i=e.runtimeStyle,u=i&&i.left;u&&(i.left=e.currentStyle.left),n.left="fontSize"===t?"1em":r,r=n.pixelLeft+"px",n.left=o,u&&(i.left=u)}return r}}}},function(e,t){"use strict";e.exports=function(e,t){return"removeProperty"in e.style?e.style.removeProperty(t):e.style.removeAttribute(t)}},function(e,t,n){"use strict";function r(){var e,t="",n={O:"otransitionend",Moz:"transitionend",Webkit:"webkitTransitionEnd",ms:"MSTransitionEnd"},r=document.createElement("div");for(var o in n)if(u.call(n,o)&&void 0!==r.style[o+"TransitionProperty"]){t="-"+o.toLowerCase()+"-",e=n[o];break}return e||void 0===r.style.transitionProperty||(e="transitionend"),{end:e,prefix:t}}var o,s,a,l,i=n(21),u=Object.prototype.hasOwnProperty,p="transform",d={};i&&(d=r(),p=d.prefix+p,a=d.prefix+"transition-property",s=d.prefix+"transition-duration",l=d.prefix+"transition-delay",o=d.prefix+"transition-timing-function"),e.exports={transform:p,end:d.end,property:a,timing:o,delay:l,duration:s}},function(e,t){"use strict";var n=/-(.)/g;e.exports=function(e){return e.replace(n,function(e,t){return t.toUpperCase()})}},function(e,t){"use strict";var n=/([A-Z])/g;e.exports=function(e){return e.replace(n,"-$1").toLowerCase()}},function(e,t,n){"use strict";var r=n(216),o=/^ms-/;e.exports=function(e){return r(e).replace(o,"-ms-")}},function(e,t){function n(e){var t=e?e.length:0;return t?e[t-1]:void 0}e.exports=n},function(e,t,n){var r=n(227),o=n(245),s=o(r);e.exports=s},function(e,t,n){(function(t){function r(e){var t=e?e.length:0;for(this.data={hash:l(null),set:new a};t--;)this.push(e[t])}var o=n(241),s=n(36),a=s(t,"Set"),l=s(Object,"create");r.prototype.push=o,e.exports=r}).call(t,function(){return this}())},function(e,t){function n(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}e.exports=n},function(e,t){function n(e,t){for(var n=-1,r=e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}e.exports=n},function(e,t){function n(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}e.exports=n},function(e,t){function n(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}e.exports=n},function(e,t,n){function r(e,t,n){var r=typeof e;return"function"==r?void 0===t?e:a(e,t,n):null==e?l:"object"==r?o(e):void 0===t?i(e):s(e,t)}var o=n(235),s=n(236),a=n(54),l=n(112),i=n(255);e.exports=r},function(e,t,n){function r(e,t){var n=e?e.length:0,r=[];if(!n)return r;var i=-1,u=o,p=!0,d=p&&t.length>=l?a(t):null,f=t.length;d&&(u=s,p=!1,t=d);e:for(;++i<n;){var c=e[i];if(p&&c===c){for(var h=f;h--;)if(t[h]===c)continue e;r.push(c)}else u(t,c,0)<0&&r.push(c)}return r}var o=n(232),s=n(240),a=n(244),l=200;e.exports=r},function(e,t,n){var r=n(231),o=n(242),s=o(r);e.exports=s},function(e,t){function n(e,t,n,r){var o;return n(e,function(e,n,s){return t(e,n,s)?(o=r?n:e,!1):void 0}),o}e.exports=n},function(e,t){function n(e,t,n){for(var r=e.length,o=n?r:-1;n?o--:++o<r;)if(t(e[o],o,e))return o;return-1}e.exports=n},function(e,t,n){function r(e,t){return o(e,t,s)}var o=n(99),s=n(59);e.exports=r},function(e,t,n){function r(e,t){return o(e,t,s)}var o=n(99),s=n(58);e.exports=r},function(e,t,n){function r(e,t,n){if(t!==t)return o(e,n);for(var r=n-1,s=e.length;++r<s;)if(e[r]===t)return r;return-1}var o=n(250);e.exports=r},function(e,t,n){function r(e,t,n,r,c,v,m){var b=l(e),g=l(t),T=d,x=d;b||(T=y.call(e),T==p?T=f:T!=f&&(b=u(e))),g||(x=y.call(t),x==p?x=f:x!=f&&(g=u(t)));var P=T==f&&!i(e),C=x==f&&!i(t),E=T==x;if(E&&!b&&!P)return s(e,t,T);if(!c){var _=P&&h.call(e,"__wrapped__"),N=C&&h.call(t,"__wrapped__");if(_||N)return n(_?e.value():e,N?t.value():t,r,c,v,m)}if(!E)return!1;v||(v=[]),m||(m=[]);for(var O=v.length;O--;)if(v[O]==e)return m[O]==t;v.push(e),m.push(t);var S=(b?o:a)(e,t,n,r,c,v,m);return v.pop(),m.pop(),S}var o=n(246),s=n(247),a=n(248),l=n(18),i=n(104),u=n(253),p="[object Arguments]",d="[object Array]",f="[object Object]",c=Object.prototype,h=c.hasOwnProperty,y=c.toString;e.exports=r},function(e,t,n){function r(e,t,n){var r=t.length,a=r,l=!n;if(null==e)return!a;for(e=s(e);r--;){var i=t[r];if(l&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++r<a;){i=t[r];var u=i[0],p=e[u],d=i[1];if(l&&i[2]){if(void 0===p&&!(u in e))return!1}else{var f=n?n(p,d,u):void 0;if(!(void 0===f?o(d,p,n,!0):f))return!1}}return!0}var o=n(101),s=n(15);e.exports=r},function(e,t,n){function r(e){var t=s(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null==e?!1:(e=a(e),e[n]===r&&(void 0!==r||n in e))}}return function(e){return o(e,t)}}var o=n(234),s=n(249),a=n(15);e.exports=r},function(e,t,n){function r(e,t){var n=l(e),r=i(e)&&u(t),c=e+"";return e=f(e),function(l){if(null==l)return!1;var i=c;if(l=d(l),(n||!r)&&!(i in l)){if(l=1==e.length?l:o(l,a(e,0,-1)),null==l)return!1;i=p(e),l=d(l)}return l[i]===t?void 0!==t||i in l:s(t,l[i],void 0,!0)}}var o=n(100),s=n(101),a=n(238),l=n(18),i=n(106),u=n(107),p=n(218),d=n(15),f=n(110);e.exports=r},function(e,t,n){function r(e){var t=e+"";return e=s(e),function(n){return o(n,e,t)}}var o=n(100),s=n(110);e.exports=r},function(e,t){function n(e,t,n){var r=-1,o=e.length;t=null==t?0:+t||0,0>t&&(t=-t>o?0:o+t),n=void 0===n||n>o?o:+n||0,0>n&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(o);++r<o;)s[r]=e[r+t];return s}e.exports=n},function(e,t){function n(e){return null==e?"":e+""}e.exports=n},function(e,t,n){function r(e,t){var n=e.data,r="string"==typeof t||o(t)?n.set.has(t):n.hash[t];return r?0:-1}var o=n(19);e.exports=r},function(e,t,n){function r(e){var t=this.data;"string"==typeof e||o(e)?t.set.add(e):t.hash[e]=!0}var o=n(19);e.exports=r},function(e,t,n){function r(e,t){return function(n,r){var l=n?o(n):0;if(!s(l))return e(n,r);for(var i=t?l:-1,u=a(n);(t?i--:++i<l)&&r(u[i],i,u)!==!1;);return n}}var o=n(103),s=n(24),a=n(15);e.exports=r},function(e,t,n){function r(e){return function(t,n,r){for(var s=o(t),a=r(t),l=a.length,i=e?l:-1;e?i--:++i<l;){var u=a[i];if(n(s[u],u,s)===!1)break}return t}}var o=n(15);e.exports=r},function(e,t,n){(function(t){function r(e){return l&&a?new o(e):null}var o=n(220),s=n(36),a=s(t,"Set"),l=s(Object,"create");e.exports=r}).call(t,function(){return this}())},function(e,t,n){function r(e,t){return function(n,r,i){if(r=o(r,i,3),l(n)){var u=a(n,r,t);return u>-1?n[u]:void 0}return s(n,r,e)}}var o=n(225),s=n(228),a=n(229),l=n(18);e.exports=r},function(e,t,n){function r(e,t,n,r,s,a,l){var i=-1,u=e.length,p=t.length;if(u!=p&&!(s&&p>u))return!1;for(;++i<u;){var d=e[i],f=t[i],c=r?r(s?f:d,s?d:f,i):void 0;if(void 0!==c){if(c)continue;return!1}if(s){if(!o(t,function(e){return d===e||n(d,e,r,s,a,l)}))return!1}else if(d!==f&&!n(d,f,r,s,a,l))return!1}return!0}var o=n(224);e.exports=r},function(e,t){function n(e,t,n){switch(n){case r:case o:return+e==+t;case s:return e.name==t.name&&e.message==t.message;case a:return e!=+e?t!=+t:e==+t;case l:case i:return e==t+""}return!1}var r="[object Boolean]",o="[object Date]",s="[object Error]",a="[object Number]",l="[object RegExp]",i="[object String]";e.exports=n},function(e,t,n){function r(e,t,n,r,s,l,i){var u=o(e),p=u.length,d=o(t),f=d.length;if(p!=f&&!s)return!1;for(var c=p;c--;){var h=u[c];if(!(s?h in t:a.call(t,h)))return!1}for(var y=s;++c<p;){h=u[c];var v=e[h],m=t[h],b=r?r(s?m:v,s?v:m,h):void 0;if(!(void 0===b?n(v,m,r,s,l,i):b))return!1;y||(y="constructor"==h)}if(!y){var g=e.constructor,T=t.constructor;if(g!=T&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof T&&T instanceof T))return!1}return!0}var o=n(58),s=Object.prototype,a=s.hasOwnProperty;e.exports=r},function(e,t,n){function r(e){for(var t=s(e),n=t.length;n--;)t[n][2]=o(t[n][1]);return t}var o=n(107),s=n(254);e.exports=r},function(e,t){function n(e,t,n){for(var r=e.length,o=t+(n?0:-1);n?o--:++o<r;){var s=e[o];if(s!==s)return o}return-1}e.exports=n},function(e,t,n){function r(e){for(var t=u(e),n=t.length,r=n&&e.length,p=!!r&&l(r)&&(s(e)||o(e)||i(e)),f=-1,c=[];++f<n;){var h=t[f];(p&&a(h,r)||d.call(e,h))&&c.push(h)}return c}var o=n(56),s=n(18),a=n(105),l=n(24),i=n(57),u=n(59),p=Object.prototype,d=p.hasOwnProperty;e.exports=r},function(e,t,n){function r(e){return null==e?!1:o(e)?d.test(u.call(e)):a(e)&&(s(e)?d:l).test(e)}var o=n(111),s=n(104),a=n(22),l=/^\[object .+?Constructor\]$/,i=Object.prototype,u=Function.prototype.toString,p=i.hasOwnProperty,d=RegExp("^"+u.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},function(e,t,n){function r(e){return s(e)&&o(e.length)&&!!w[M.call(e)]}var o=n(24),s=n(22),a="[object Arguments]",l="[object Array]",i="[object Boolean]",u="[object Date]",p="[object Error]",d="[object Function]",f="[object Map]",c="[object Number]",h="[object Object]",y="[object RegExp]",v="[object Set]",m="[object String]",b="[object WeakMap]",g="[object ArrayBuffer]",T="[object Float32Array]",x="[object Float64Array]",P="[object Int8Array]",C="[object Int16Array]",E="[object Int32Array]",_="[object Uint8Array]",N="[object Uint8ClampedArray]",O="[object Uint16Array]",S="[object Uint32Array]",w={};w[T]=w[x]=w[P]=w[C]=w[E]=w[_]=w[N]=w[O]=w[S]=!0,w[a]=w[l]=w[g]=w[i]=w[u]=w[p]=w[d]=w[f]=w[c]=w[h]=w[y]=w[v]=w[m]=w[b]=!1;var k=Object.prototype,M=k.toString;e.exports=r},function(e,t,n){function r(e){e=s(e);for(var t=-1,n=o(e),r=n.length,a=Array(r);++t<r;){var l=n[t];a[t]=[l,e[l]]}return a}var o=n(58),s=n(15);e.exports=r},function(e,t,n){function r(e){return a(e)?o(e):s(e)}var o=n(102),s=n(237),a=n(106);e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n(1),l=r(a),i=n(14),u=r(i),p=n(63),d=r(p),f=n(119),c=r(f),h=n(113),y=r(h),v=n(257),m=r(v),b=n(29),g=r(b),T=n(116),x=r(T),P=n(260),C=r(P),E=n(21),_=r(E),N=n(89),O=r(N),S=n(28),w=r(S),k=n(62),M=r(k),I=new m["default"],D=l["default"].createClass({displayName:"Modal",propTypes:s({},y["default"].propTypes,{show:l["default"].PropTypes.bool,container:l["default"].PropTypes.oneOfType([d["default"],l["default"].PropTypes.func]),onShow:l["default"].PropTypes.func,onHide:l["default"].PropTypes.func,backdrop:l["default"].PropTypes.oneOfType([l["default"].PropTypes.bool,l["default"].PropTypes.oneOf(["static"])]),onEscapeKeyUp:l["default"].PropTypes.func,onBackdropClick:l["default"].PropTypes.func,backdropStyle:l["default"].PropTypes.object,backdropClassName:l["default"].PropTypes.string,containerClassName:l["default"].PropTypes.string,keyboard:l["default"].PropTypes.bool,transition:c["default"],dialogTransitionTimeout:l["default"].PropTypes.number,backdropTransitionTimeout:l["default"].PropTypes.number,autoFocus:l["default"].PropTypes.bool,enforceFocus:l["default"].PropTypes.bool,onEnter:l["default"].PropTypes.func,onEntering:l["default"].PropTypes.func,onEntered:l["default"].PropTypes.func,onExit:l["default"].PropTypes.func,onExiting:l["default"].PropTypes.func,onExited:l["default"].PropTypes.func}),getDefaultProps:function(){var e=function(){};return{show:!1,backdrop:!0,keyboard:!0,autoFocus:!0,enforceFocus:!0,onHide:e}},getInitialState:function(){return{exited:!this.props.show}},render:function(){var e=this.props,t=(e.children,e.transition),n=e.backdrop,r=e.dialogTransitionTimeout,s=o(e,["children","transition","backdrop","dialogTransitionTimeout"]),i=s.onExit,u=s.onExiting,p=s.onEnter,d=s.onEntering,f=s.onEntered,c=!!s.show,h=l["default"].Children.only(this.props.children),v=c||t&&!this.state.exited;if(!v)return null;var m=h.props,b=m.role,g=m.tabIndex;return void 0!==b&&void 0!==g||(h=a.cloneElement(h,{role:void 0===b?"document":b,tabIndex:null==g?"-1":g})),t&&(h=l["default"].createElement(t,{transitionAppear:!0,unmountOnExit:!0,"in":c,timeout:r,onExit:i,onExiting:u,onExited:this.handleHidden,onEnter:p,onEntering:d,onEntered:f},h)),l["default"].createElement(y["default"],{ref:this.setMountNode,container:s.container},l["default"].createElement("div",{ref:"modal",role:s.role||"dialog",style:s.style,className:s.className},n&&this.renderBackdrop(),h))},renderBackdrop:function(){var e=this.props,t=e.transition,n=e.backdropTransitionTimeout,r=l["default"].createElement("div",{ref:"backdrop",style:this.props.backdropStyle,className:this.props.backdropClassName,onClick:this.handleBackdropClick});return t&&(r=l["default"].createElement(t,{transitionAppear:!0,"in":this.props.show,timeout:n},r)),r},componentWillReceiveProps:function(e){e.show?this.setState({exited:!1}):e.transition||this.setState({exited:!0})},componentWillUpdate:function(e){e.show&&this.checkForFocus()},componentDidMount:function(){this.props.show&&this.onShow()},componentDidUpdate:function(e){var t=this.props.transition;!e.show||this.props.show||t?!e.show&&this.props.show&&this.onShow():this.onHide()},componentWillUnmount:function(){var e=this.props,t=e.show,n=e.transition;(t||n&&!this.state.exited)&&this.onHide()},onShow:function(){var e=g["default"](this),t=M["default"](this.props.container,e.body);I.add(this,t,this.props.containerClassName),this._onDocumentKeyupListener=x["default"](e,"keyup",this.handleDocumentKeyUp),this._onFocusinListener=C["default"](this.enforceFocus),this.focus(),this.props.onShow&&this.props.onShow()},onHide:function(){I.remove(this),this._onDocumentKeyupListener.remove(),this._onFocusinListener.remove(),this.restoreLastFocus()},setMountNode:function(e){this.mountNode=e?e.getMountNode():e},handleHidden:function(){if(this.setState({exited:!0}),this.onHide(),this.props.onExited){var e;(e=this.props).onExited.apply(e,arguments)}},handleBackdropClick:function(e){e.target===e.currentTarget&&(this.props.onBackdropClick&&this.props.onBackdropClick(e),this.props.backdrop===!0&&this.props.onHide())},handleDocumentKeyUp:function(e){this.props.keyboard&&27===e.keyCode&&this.isTopModal()&&(this.props.onEscapeKeyUp&&this.props.onEscapeKeyUp(e),this.props.onHide())},checkForFocus:function(){_["default"]&&(this.lastFocus=O["default"]())},focus:function(){var e=this.props.autoFocus,t=this.getDialogElement(),n=O["default"](g["default"](this)),r=n&&w["default"](t,n);t&&e&&!r&&(this.lastFocus=n,t.hasAttribute("tabIndex")||(t.setAttribute("tabIndex",-1),u["default"](!1,'The modal content node does not accept focus. For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".')),t.focus())},restoreLastFocus:function(){this.lastFocus&&this.lastFocus.focus&&(this.lastFocus.focus(),this.lastFocus=null)},enforceFocus:function A(){var A=this.props.enforceFocus;if(A&&this.isMounted()&&this.isTopModal()){var e=O["default"](g["default"](this)),t=this.getDialogElement();t&&t!==e&&!w["default"](t,e)&&t.focus()}},getDialogElement:function(){var e=this.refs.modal;return e&&e.lastChild},isTopModal:function(){return I.isTopModal(this)}});D.manager=I,t["default"]=D,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){var n=-1;return e.some(function(e,r){return t(e,r)?(n=r,!0):void 0}),n}function a(e,t){return s(e,function(e){return-1!==e.modals.indexOf(t)})}t.__esModule=!0;var l=n(34),i=r(l),u=n(204),p=r(u),d=n(96),f=r(d),c=n(117),h=r(c),y=n(262),v=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];o(this,e),this.hideSiblingNodes=t,this.modals=[],this.containers=[],this.data=[]}return e.prototype.add=function(e,t,n){var r=this.modals.indexOf(e),o=this.containers.indexOf(t);if(-1!==r)return r;if(r=this.modals.length,this.modals.push(e),this.hideSiblingNodes&&y.hideSiblings(t,e.mountNode),-1!==o)return this.data[o].modals.push(e),r;var s={modals:[e],classes:n?n.split(/\s+/):[],style:{overflow:t.style.overflow,paddingRight:t.style.paddingRight}},a={overflow:"hidden"};return s.overflowing=h["default"](t),s.overflowing&&(a.paddingRight=parseInt(i["default"](t,"paddingRight")||0,10)+f["default"]()+"px"),i["default"](t,a),s.classes.forEach(p["default"].addClass.bind(null,t)),this.containers.push(t),this.data.push(s),r},e.prototype.remove=function(e){var t=this.modals.indexOf(e);if(-1!==t){var n=a(this.data,e),r=this.data[n],o=this.containers[n];r.modals.splice(r.modals.indexOf(e),1),this.modals.splice(t,1),0===r.modals.length?(Object.keys(r.style).forEach(function(e){return o.style[e]=r.style[e]}),r.classes.forEach(p["default"].removeClass.bind(null,o)),this.hideSiblingNodes&&y.showSiblings(o,e.mountNode),this.containers.splice(n,1),this.data.splice(n,1)):this.hideSiblingNodes&&y.ariaHidden(!1,r.modals[r.modals.length-1].mountNode)}},e.prototype.isTopModal=function(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e},e}();t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=n(1),u=r(i),p=n(113),d=r(p),f=n(259),c=r(f),h=n(114),y=r(h),v=n(119),m=r(v),b=function(e){function t(n,r){s(this,t),e.call(this,n,r),this.state={exited:!n.show},this.onHiddenListener=this.handleHidden.bind(this)}return a(t,e),t.prototype.componentWillReceiveProps=function(e){e.show?this.setState({exited:!1}):e.transition||this.setState({exited:!0})},t.prototype.render=function(){var e=this.props,t=e.container,n=e.containerPadding,r=e.target,s=e.placement,a=e.shouldUpdatePosition,l=e.rootClose,i=e.children,p=e.transition,f=o(e,["container","containerPadding","target","placement","shouldUpdatePosition","rootClose","children","transition"]),h=f.show||p&&!this.state.exited;if(!h)return null;var v=i;if(v=u["default"].createElement(c["default"],{container:t,containerPadding:n,target:r,placement:s,shouldUpdatePosition:a},v),p){var m=f.onExit,b=f.onExiting,g=f.onEnter,T=f.onEntering,x=f.onEntered;v=u["default"].createElement(p,{"in":f.show,transitionAppear:!0,onExit:m,onExiting:b,onExited:this.onHiddenListener,onEnter:g,onEntering:T,onEntered:x},v)}return l&&(v=u["default"].createElement(y["default"],{onRootClose:f.onHide},v)),u["default"].createElement(d["default"],{container:t},v)},t.prototype.handleHidden=function(){if(this.setState({exited:!0}),this.props.onExited){var e;(e=this.props).onExited.apply(e,arguments)}},t}(u["default"].Component);b.propTypes=l({},d["default"].propTypes,c["default"].propTypes,{show:u["default"].PropTypes.bool,rootClose:u["default"].PropTypes.bool,onHide:function(e,t,n){var r=u["default"].PropTypes.func;return e.rootClose&&(r=r.isRequired),r(e,t,n)},transition:m["default"],onEnter:u["default"].PropTypes.func,onEntering:u["default"].PropTypes.func,onEntered:u["default"].PropTypes.func,onExit:u["default"].PropTypes.func,onExiting:u["default"].PropTypes.func,onExited:u["default"].PropTypes.func}),t["default"]=b,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=n(1),u=r(i),p=n(13),d=r(p),f=n(4),c=r(f),h=n(29),y=r(h),v=n(62),m=r(v),b=n(263),g=n(63),T=r(g),x=function(e){function t(n,r){s(this,t),e.call(this,n,r),this.state={positionLeft:0,positionTop:0,arrowOffsetLeft:null,arrowOffsetTop:null},this._needsFlush=!1,this._lastTarget=null}return a(t,e),t.prototype.componentDidMount=function(){this.updatePosition()},t.prototype.componentWillReceiveProps=function(){this._needsFlush=!0},t.prototype.componentDidUpdate=function(e){this._needsFlush&&(this._needsFlush=!1,this.updatePosition(e.placement!==this.props.placement))},t.prototype.componentWillUnmount=function(){this._lastTarget=null},t.prototype.render=function(){var e=this.props,t=e.children,n=e.className,r=o(e,["children","className"]),s=this.state,a=s.positionLeft,p=s.positionTop,d=o(s,["positionLeft","positionTop"]);delete r.target,delete r.container,delete r.containerPadding;var f=u["default"].Children.only(t);return i.cloneElement(f,l({},r,d,{positionLeft:a,positionTop:p,className:c["default"](n,f.props.className),style:l({},f.props.style,{left:a,top:p})}))},t.prototype.getTargetSafe=function(){if(!this.props.target)return null;var e=this.props.target(this.props);return e?e:null},t.prototype.updatePosition=function(e){var t=this.getTargetSafe();if(this.props.shouldUpdatePosition||t!==this._lastTarget||e){if(this._lastTarget=t,!t)return void this.setState({positionLeft:0,positionTop:0,arrowOffsetLeft:null,arrowOffsetTop:null});var n=d["default"].findDOMNode(this),r=m["default"](this.props.container,y["default"](this).body);this.setState(b.calcOverlayPosition(this.props.placement,n,t,r,this.props.containerPadding))}},t}(u["default"].Component);x.propTypes={target:u["default"].PropTypes.func,container:u["default"].PropTypes.oneOfType([T["default"],u["default"].PropTypes.func]),containerPadding:u["default"].PropTypes.number,placement:u["default"].PropTypes.oneOf(["top","right","bottom","left"]),shouldUpdatePosition:u["default"].PropTypes.bool},x.displayName="Position",x.defaultProps={containerPadding:0,placement:"right",shouldUpdatePosition:!1},t["default"]=x,e.exports=t["default"]},function(e,t){"use strict";function n(e){var t=!document.addEventListener,n=void 0;return t?(document.attachEvent("onfocusin",e),n=function(){return document.detachEvent("onfocusin",e)}):(document.addEventListener("focus",e,!0),n=function(){return document.removeEventListener("focus",e,!0)}),{remove:n}}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";function n(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return t.filter(function(e){return null!=e}).reduce(function(e,t){if("function"!=typeof t)throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];e.apply(this,r),t.apply(this,r)}},null)}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){t&&(e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden"))}function r(e,t){l(e,t,function(e){return n(!0,e)})}function o(e,t){l(e,t,function(e){return n(!1,e)})}t.__esModule=!0,t.ariaHidden=n,t.hideSiblings=r,t.showSiblings=o;var s=["template","script","style"],a=function(e){var t=e.nodeType,n=e.tagName;return 1===t&&-1===s.indexOf(n.toLowerCase())},l=function(e,t,n){t=[].concat(t),[].forEach.call(e.children,function(e){-1===t.indexOf(e)&&a(e)&&n(e)})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r){var o=h.getContainerDimensions(n),s=o.scroll,a=o.height,l=e-r-s,i=e+r-s+t;return 0>l?-l:i>a?a-i:0}function s(e,t,n,r){var o=h.getContainerDimensions(n),s=o.width,a=e-r,l=e+r+t;return 0>a?-a:l>s?s-l:0}t.__esModule=!0;var a=n(29),l=r(a),i=n(93),u=r(i),p=n(209),d=r(p),f=n(94),c=r(f),h={getContainerDimensions:function(e){var t=void 0,n=void 0,r=void 0;if("BODY"===e.tagName)t=window.innerWidth,n=window.innerHeight,r=c["default"](l["default"](e).documentElement)||c["default"](e);else{var o=u["default"](e);t=o.width,n=o.height,r=c["default"](e)}return{width:t,height:n,scroll:r}},getPosition:function(e,t){var n="BODY"===t.tagName?u["default"](e):d["default"](e,t);return n},calcOverlayPosition:function(e,t,n,r,a){var l=h.getPosition(n,r),i=u["default"](t),p=i.height,d=i.width,f=void 0,c=void 0,y=void 0,v=void 0;if("left"===e||"right"===e){c=l.top+(l.height-p)/2,f="left"===e?l.left-d:l.left+l.width;var m=o(c,p,r,a);c+=m,v=50*(1-2*m/p)+"%",y=void 0}else{if("top"!==e&&"bottom"!==e)throw new Error('calcOverlayPosition(): No such placement of "'+e+'" found.');f=l.left+(l.width-d)/2,c="top"===e?l.top-p:l.top+l.height;var b=s(f,d,r,a);f+=b,y=50*(1-2*b/d)+"%",v=void 0}return{positionLeft:f,positionTop:c,arrowOffsetLeft:y,arrowOffsetTop:v}}};t["default"]=h,e.exports=t["default"]},function(e,t){"use strict";function n(){function e(e,t,r){var o=n.map(function(t){return e[t]}).reduce(function(e,t){return e+(void 0!==t?1:0)},0);if(o>1){var s=n[0],a=n.slice(1),l=a.join(", ")+" and "+s;return new Error("Invalid prop '"+t+"', only one of the following may be provided: "+l)}}for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return e}t.__esModule=!0,t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function a(e,t){function n(r,o){function a(e,n){var r=d.getLinkName(e),s=this.props[o[e]];r&&i(this.props,r)&&!s&&(s=this.props[r].requestChange);for(var a=arguments.length,l=Array(a>2?a-2:0),u=2;a>u;u++)l[u-2]=arguments[u];t(this,e,s,n,l)}function i(e,t){return void 0!==e[t]}var p,f=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],c=r.displayName||r.name||"Component",h=d.getType(r).propTypes;p=d.uncontrolledPropTypes(o,h,c),f=d.transform(f,function(e,t){e[t]=function(){var e;return(e=this.refs.inner)[t].apply(e,arguments)}},{});var y=u["default"].createClass(l({displayName:"Uncontrolled("+c+")",mixins:e,propTypes:p},f,{componentWillMount:function(){var e=this.props,t=Object.keys(o);this._values=d.transform(t,function(t,n){t[n]=e[d.defaultKey(n)]},{})},componentWillReceiveProps:function(e){var t=this,n=this.props,r=Object.keys(o);r.forEach(function(r){void 0===d.getValue(e,r)&&void 0!==d.getValue(n,r)&&(t._values[r]=e[d.defaultKey(r)])})},render:function(){var e=this,t={},n=this.props,p=(n.valueLink,n.checkedLink,s(n,["valueLink","checkedLink"]));return d.each(o,function(n,r){var o=d.getLinkName(r),s=e.props[r];o&&!i(e.props,r)&&i(e.props,o)&&(s=e.props[o].value),t[r]=void 0!==s?s:e._values[r],t[n]=a.bind(e,r)}),t=l({},p,t,{ref:"inner"}),u["default"].createElement(r,t)}}));return y.ControlledComponent=r,y.deferControlTo=function(e,t,r){return void 0===t&&(t={}),n(e,l({},o,t),r)},y}return n}t.__esModule=!0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t["default"]=a;var i=n(1),u=o(i),p=n(266),d=r(p);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){return function(r,o){return void 0!==r[o]?r[e]?t&&t(r,o,n):new Error("You have provided a `"+o+"` prop to `"+n+"` without an `"+e+"` handler. This will render a read-only field. If the field should be mutable use `"+p(o)+"`. Otherwise, set `"+e+"`"):void 0;
}}function s(e,t,n){var r={};return r}function a(e){return b[0]>=15||0===b[0]&&b[1]>=13?e:e.type}function l(e,t){var n=u(t);return n&&!i(e,t)&&i(e,n)?e[n].value:e[t]}function i(e,t){return void 0!==e[t]}function u(e){return"value"===e?"valueLink":"checked"===e?"checkedLink":null}function p(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function d(e,t,n){return function(){for(var r=arguments.length,o=Array(r),s=0;r>s;s++)o[s]=arguments[s];t&&t.call.apply(t,[e].concat(o)),n&&n.call.apply(n,[e].concat(o))}}function f(e,t,n){return c(e,t.bind(null,n=n||(Array.isArray(e)?[]:{}))),n}function c(e,t,n){if(Array.isArray(e))return e.forEach(t,n);for(var r in e)h(e,r)&&t.call(n,e[r],r,e)}function h(e,t){return e?Object.prototype.hasOwnProperty.call(e,t):!1}t.__esModule=!0,t.customPropType=o,t.uncontrolledPropTypes=s,t.getType=a,t.getValue=l,t.getLinkName=u,t.defaultKey=p,t.chain=d,t.transform=f,t.each=c,t.has=h;var y=n(1),v=r(y),m=n(52),b=(r(m),v["default"].version.split(".").map(parseFloat));t.version=b}])});
//# sourceMappingURL=react-bootstrap.min.js.map;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/TransitionOverlay',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/TransitionOverlay',['module', 'exports', 'react', 'react-bootstrap', 'lib-build/i18n!./../../../../../../../resources/tpl/builder/nls/app', 'lib-build/less!./TransitionOverlay'], function (module, exports, _react, _reactBootstrap, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function TransitionOverlay(props) {

    var renderInnerOption = function renderInnerOption(transition) {
      var className = 'item btn-gray';
      var selectedIcon = null;

      if (!transition.enabled) {
        // disable and show tooltip.
        className += ' disabled';
      }

      if (props.transition.id === transition.id) {
        className += ' selected';
        selectedIcon = _react2.default.createElement(
          'span',
          { className: 'icon' },
          _react2.default.createElement('span', { className: 'glyphicon glyphicon-ok' })
        );
      }

      return _react2.default.createElement(
        'li',
        {
          key: transition.id,
          className: className,
          onClick: function onClick() {
            // if the item is disabled, don't allow the click to call the callback.
            if (transition.enabled) {
              props.onItemClick(transition.id);
            }
          }
        },
        selectedIcon,
        transition.label
      );
    };

    var renderOptions = function renderOptions() {
      return props.transitions.map(function (transition) {
        if (!transition.enabled) {
          // disable and show tooltip.
          return _react2.default.createElement(
            _reactBootstrap.OverlayTrigger,
            {
              key: transition.id,
              overlay: _react2.default.createElement(
                _reactBootstrap.Tooltip,
                { id: 'transition-tooltip-' + props.itemID + '-' + transition.id, placement: 'right' },
                transition.tooltip
              ) },
            renderInnerOption(transition)
          );
        } else {
          return renderInnerOption(transition);
        }
      });
    };

    return _react2.default.createElement(
      _reactBootstrap.Popover,
      _extends({}, props, {
        id: 'transition-popover-' + props.itemID,
        placement: 'top'
      }),
      _react2.default.createElement(
        'h6',
        { className: 'title' },
        _app2.default.builder.immersiveViewPanel.transition
      ),
      _react2.default.createElement(
        'ul',
        { className: 'list' },
        renderOptions()
      )
    );
  }

  exports.default = TransitionOverlay;
  module.exports = exports['default'];
});
//# sourceMappingURL=TransitionOverlay.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/Transition',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/Transition',['module', 'exports', 'react', 'react-dom', 'react-bootstrap', './TransitionOverlay', 'lib-build/less!./Transition'], function (module, exports, _react, _reactDom, _reactBootstrap, _TransitionOverlay) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _TransitionOverlay2 = _interopRequireDefault(_TransitionOverlay);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var Transition = function (_React$Component) {
    _inherits(Transition, _React$Component);

    function Transition() {
      _classCallCheck(this, Transition);

      var _this = _possibleConstructorReturn(this, (Transition.__proto__ || Object.getPrototypeOf(Transition)).call(this));

      _this.state = {
        shown: false
      };

      _this.hidePopover = _this.hidePopover.bind(_this);
      _this.togglePopover = _this.togglePopover.bind(_this);
      _this.onTransitionClick = _this.onTransitionClick.bind(_this);
      return _this;
    }

    _createClass(Transition, [{
      key: 'hidePopover',
      value: function hidePopover() {
        this.setState({
          shown: false
        });
      }
    }, {
      key: 'togglePopover',
      value: function togglePopover() {
        this.setState({
          shown: !this.state.shown
        });
      }
    }, {
      key: 'onTransitionClick',
      value: function onTransitionClick(transitionType) {
        this.hidePopover();
        this.props.callbacks.updateItemTransition(this.props.index, transitionType);
      }
    }, {
      key: 'render',
      value: function render() {
        var _this2 = this;

        var transitionClass = 'op-transition-button';

        if (this.props.firstItem) {
          return null;
        } else {
          return _react2.default.createElement(
            'div',
            { className: 'op-transition-container' },
            _react2.default.createElement(
              _reactBootstrap.Overlay,
              {
                trigger: 'click',
                placement: 'top',
                rootClose: true,
                show: this.state.shown,
                target: function target() {
                  return _reactDom2.default.findDOMNode(_this2.refs.target);
                },
                onHide: this.hidePopover
              },
              _react2.default.createElement(_TransitionOverlay2.default, {
                className: 'op-transition-overlay',
                itemID: this.props.itemID,
                transitions: this.props.transitions,
                transition: this.props.transition,
                onItemClick: this.onTransitionClick
              })
            ),
            _react2.default.createElement(
              'div',
              {
                ref: 'target',
                className: transitionClass,
                title: 'Choose transition',
                onClick: function onClick(event) {
                  _this2.togglePopover();
                  event.stopPropagation();
                }
              },
              _react2.default.createElement('img', { className: 'icon', src: this.props.transition.icon })
            )
          );
        }
      }
    }]);

    return Transition;
  }(_react2.default.Component);

  exports.default = Transition;
  module.exports = exports['default'];
});
//# sourceMappingURL=Transition.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/ItemMain',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/ItemMain',['module', 'exports', 'react', './../common/ActionOverlay', 'lib-build/less!./../common/ItemMain', 'lib-build/less!./ItemMain'], function (module, exports, _react, _ActionOverlay) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _ActionOverlay2 = _interopRequireDefault(_ActionOverlay);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function ItemMain(props) {
    return _react2.default.createElement(
      'div',
      { style: { backgroundImage: 'url(' + props.item.thumbnail + ')' }, className: 'op-item-main' },
      _react2.default.createElement(_ActionOverlay2.default, props)
    );
  }

  exports.default = ItemMain;
  module.exports = exports['default'];
});
//# sourceMappingURL=ItemMain.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/Item',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/item/immersiveView/Item',['module', 'exports', 'react', './InlineAdd', './Transition', './ItemMain', 'lib-build/less!./../common/Item', 'lib-build/less!./Item'], function (module, exports, _react, _InlineAdd, _Transition, _ItemMain) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _InlineAdd2 = _interopRequireDefault(_InlineAdd);

  var _Transition2 = _interopRequireDefault(_Transition);

  var _ItemMain2 = _interopRequireDefault(_ItemMain);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var Item = function (_React$Component) {
    _inherits(Item, _React$Component);

    function Item() {
      _classCallCheck(this, Item);

      var _this = _possibleConstructorReturn(this, (Item.__proto__ || Object.getPrototypeOf(Item)).call(this));

      _this.state = {
        showActions: false
      };

      _this.renderInlineAdd = _this.renderInlineAdd.bind(_this);
      _this.renderInnerItem = _this.renderInnerItem.bind(_this);
      _this.renderTransition = _this.renderTransition.bind(_this);
      return _this;
    }

    _createClass(Item, [{
      key: 'renderInlineAdd',
      value: function renderInlineAdd() {
        return _react2.default.createElement(_InlineAdd2.default, {
          organize: this.props.organize,
          lastItem: this.props.lastItem,
          addItem: this.props.callbacks.addItem,
          index: this.props.index
        });
      }
    }, {
      key: 'renderTransition',
      value: function renderTransition() {
        var _this2 = this;

        return _react2.default.createElement(_Transition2.default, {
          firstItem: this.props.firstItem,
          itemID: this.props.item.id,
          transitions: this.props.item.transitions,
          transition: this.props.item.transitions.find(function (transition) {
            return transition.id === _this2.props.item.transition;
          }),
          callbacks: this.props.callbacks,
          index: this.props.index
        });
      }
    }, {
      key: 'renderInnerItem',
      value: function renderInnerItem() {
        var _this3 = this;

        var className = 'op-item';

        if (this.props.selected) {
          className += ' selected';
        }
        if (!this.props.item.hasOrganize) {
          className += ' undraggable';
        }
        if (this.props.organize) {
          className += ' organize';
        }

        return _react2.default.createElement(
          'div',
          {
            className: className,
            onClick: function onClick() {
              // only do this if not in organize mode
              if (!_this3.props.organize) {
                _this3.props.onItemClicked(_this3.props.item.id);
                _this3.props.callbacks.selectItem(_this3.props.item.id);
              }
            },
            onMouseOver: function onMouseOver() {
              // show actions if not in organize mode and if hovered over.
              if (!_this3.props.organize) {
                _this3.setState({
                  showActions: true
                });
              }
            },

            onMouseLeave: function onMouseLeave() {
              _this3.setState({
                showActions: false
              });
            },

            'data-id': this.props.item.id
          },
          this.renderTransition(),
          _react2.default.createElement(_ItemMain2.default, _extends({
            showMedia: true,
            showActions: this.state.showActions
          }, this.props))
        );
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          {
            className: 'op-item-outer',
            'data-id': this.props.item.id
          },
          this.renderInnerItem(),
          this.renderInlineAdd()
        );
      }
    }]);

    return Item;
  }(_react2.default.Component);

  exports.default = Item;
  module.exports = exports['default'];
});
//# sourceMappingURL=Item.js.map
;
/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright 2015 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
!function(a){"function"==typeof define&&define.amd?define('lib/jquery-mousewheel/jquery.mousewheel.min',["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/list/List',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/list/List',['module', 'exports', 'react', 'lib/Sortable/Sortable', './item/builderOverview/Item', './item/immersiveView/Item', 'lib/jquery-mousewheel/jquery.mousewheel.min', 'lib-build/less!./List'], function (module, exports, _react, _Sortable, _Item, _Item3) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _Sortable2 = _interopRequireDefault(_Sortable);

  var _Item2 = _interopRequireDefault(_Item);

  var _Item4 = _interopRequireDefault(_Item3);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var List = function (_React$Component) {
    _inherits(List, _React$Component);

    function List() {
      _classCallCheck(this, List);

      var _this = _possibleConstructorReturn(this, (List.__proto__ || Object.getPrototypeOf(List)).call(this));

      _this.sortableContainersDecorator = _this.sortableContainersDecorator.bind(_this);
      _this.sortableGroupDecorator = _this.sortableGroupDecorator.bind(_this);
      _this.showItems = _this.showItems.bind(_this);
      _this.preventPageScroll = _this.preventPageScroll.bind(_this);
      _this.onScroll = _this.onScroll.bind(_this);
      _this.handleHorizontalScroll = _this.handleHorizontalScroll.bind(_this);

      _this.sortableGroupInstance = null;
      _this.sortableContainerInstance = null;
      _this.listNode = null;
      return _this;
    }

    _createClass(List, [{
      key: 'componentDidMount',
      value: function componentDidMount() {
        this.listNode = $(this.props.container).find('.op-list.group-list')[0];
        // we are using the jquery mousewheel plugin
        $(this.listNode).on('mousewheel', this.onScroll);
      }
    }, {
      key: 'onScroll',
      value: function onScroll(e) {
        if (this.props.orientation === 'vertical') {
          // we want the original browser event, not the jquery-mousewheel-ified one.
          this.preventPageScroll(e.originalEvent);
        } else {
          this.handleHorizontalScroll(e);
        }
      }
    }, {
      key: 'handleHorizontalScroll',
      value: function handleHorizontalScroll(e) {
        var target = $(e.currentTarget);
        var changeX = e.deltaX;
        var changeY = e.deltaY;

        e.preventDefault();
        // if the scrolling is horitontal, scroll horizontally.
        if (Math.abs(changeX) > Math.abs(changeY)) {
          target.scrollLeft(target.scrollLeft() + changeX * e.deltaFactor);
        } else {
          // if it is vertical, scroll the list horizontally by the amount it was trying to scroll vertically
          target.scrollLeft(target.scrollLeft() - changeY * e.deltaFactor);
        }
      }
    }, {
      key: 'preventPageScroll',
      value: function preventPageScroll(e) {
        /* High-level algorithm from Jon Beebe: http://codepen.io/somethingkindawierd/post/react-mixin-scroll-lock */
        // if the list is scrollable (more content than it has height to show), OR if they are the same (meaning the list isn't tall enough to scroll)

        if (this.listNode.scrollHeight >= this.listNode.clientHeight) {
          if (this.listNode.scrollHeight - this.listNode.scrollTop <= this.listNode.clientHeight) {
            // if going downwards, stop the scroll.
            if (e.deltaY > 0) {
              e.preventDefault();
            }
          }
          // or if at the top of the list and scrolling upwards, stop the scroll.
          if (this.listNode.scrollTop === 0) {
            if (e.deltaY < 0) {
              e.preventDefault();
            }
          }
        }
      }
    }, {
      key: 'componentDidUpdate',
      value: function componentDidUpdate(prevProps) {
        // we only want to update the sortableInstance if the organize property has changed.
        if (prevProps.organize !== this.props.organize) {
          this.sortableGroupInstance.option('disabled', !this.props.organize);
        }
      }
    }, {
      key: 'componentWillUnmount',
      value: function componentWillUnmount() {
        this.sortableGroupInstance.destroy();
        this.sortableContainerInstance.destroy();
        this.listNode.removeEventListener('wheel', this.preventPageScroll);
      }
    }, {
      key: 'sortableContainersDecorator',
      value: function sortableContainersDecorator(backingInstance) {
        var options = null;
        if (backingInstance) {
          options = {};
          this.sortableContainerInstance = _Sortable2.default.create(backingInstance, options);
        }
      }
    }, {
      key: 'sortableGroupDecorator',
      value: function sortableGroupDecorator(backingInstance) {
        var _this2 = this;

        var options = null;
        if (backingInstance) {
          options = {
            disabled: true,
            ghostClass: 'drop-zone',
            chosenClass: 'chosen',
            filter: '.undraggable',
            animation: 300,
            onUpdate: function onUpdate() {
              // get the order of the points
              var orderArray = _this2.sortableGroupInstance.toArray();
              _this2.props.updateOrder(orderArray);
            },
            onMove: function onMove(event) {
              // if the target node has the class "undraggable", we won't allow it to be dragged over (applies to cover and credits so they can't be reordered)
              if ($(event.related).hasClass('undraggable')) {
                return false;
              }
            }
          };
          this.sortableGroupInstance = _Sortable2.default.create(backingInstance, options);
        }
      }
    }, {
      key: 'showItems',
      value: function showItems() {
        var _this3 = this;

        var ItemComponent = _Item2.default;

        if (this.props.orientation === 'horizontal') {
          ItemComponent = _Item4.default;
        }

        return this.props.items.map(function (item, index, array) {
          // we'll want to show the last item a little differently.
          var firstItem = index === 0;
          var lastItem = index === array.length - 1;
          return _react2.default.createElement(ItemComponent, {
            key: item.id,
            item: item,
            index: index,
            onItemClicked: _this3.props.changeSelectedItem,
            selected: _this3.props.selectedItem === item.id,
            callbacks: _this3.props.callbacks,
            organize: _this3.props.organize,
            orientation: _this3.props.orientation,
            firstItem: firstItem,
            lastItem: lastItem
          });
        });
      }
    }, {
      key: 'render',
      value: function render() {
        var className = 'op-list';
        if (this.props.organize) {
          className += ' organize';
        }

        return _react2.default.createElement(
          'div',
          {
            className: 'group-list ' + className,
            ref: this.sortableGroupDecorator
          },
          this.showItems()
        );
      }
    }]);

    return List;
  }(_react2.default.Component);

  exports.default = List;
  module.exports = exports['default'];
});
//# sourceMappingURL=List.js.map
;

define('lib-build/less!storymaps-react/tpl/builder/overviewPanel/Panel',[],function(){});
define('storymaps-react/tpl/builder/overviewPanel/Panel',['module', 'exports', 'react', './list/List', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'lib-build/less!./Panel'], function (module, exports, _react, _List, _app) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _List2 = _interopRequireDefault(_List);

  var _app2 = _interopRequireDefault(_app);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function Panel(props) {
    var text = props.organize ? _app2.default.builder.builderPanel.done : _app2.default.builder.builderPanel.organize;
    var iconClass = 'icon glyphicon';
    var panelClass = 'op-panel';

    if (props.orientation === 'horizontal') {
      panelClass += ' op-style-horizontal';
    }

    if (props.organize) {
      iconClass += ' glyphicon-ok done';
    } else {
      iconClass += ' glyphicon-sort organize';
    }

    return _react2.default.createElement(
      'div',
      { className: panelClass },
      _react2.default.createElement(_List2.default, props),
      _react2.default.createElement(
        'div',
        {
          className: 'organize-toggle',
          onClick: function onClick() {
            if (props.organize) {
              props.callbacks.organize(props.order);
            }
            props.toggleOrganize();
          } },
        _react2.default.createElement('span', { className: iconClass }),
        props.orientation === 'horizontal' ? null : text
      )
    );
  }

  exports.default = Panel;
  module.exports = exports['default'];
});
//# sourceMappingURL=Panel.js.map
;
define('storymaps-react/tpl/builder/overviewPanel/PanelContainer',['module', 'exports', 'react-redux', './actions', './Panel'], function (module, exports, _reactRedux, _actions, _Panel) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var actions = _interopRequireWildcard(_actions);

  var _Panel2 = _interopRequireDefault(_Panel);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  var mapStateToProps = function mapStateToProps(state) {
    return {
      items: state.items,
      organize: state.organize,
      selectedItem: state.selectedItem,
      order: state.order
    };
  };

  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    return {
      toggleOrganize: function toggleOrganize() {
        dispatch(actions.toggleOrganize());
      },
      changeSelectedItem: function changeSelectedItem(itemID) {
        dispatch(actions.changeSelectedItem(itemID));
      },
      updateOrder: function updateOrder(order) {
        dispatch(actions.updateOrder(order));
      }
    };
  };

  exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(_Panel2.default);
  module.exports = exports['default'];
});
//# sourceMappingURL=PanelContainer.js.map
;
define('storymaps-react/tpl/builder/overviewPanel/OverviewPanel',['module', 'exports', 'react', 'react-dom', 'redux', 'react-redux', './reducer', './actions', './PanelContainer'], function (module, exports, _react, _reactDom, _redux, _reactRedux, _reducer, _actions, _PanelContainer) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  exports.default = function (container, orientation, items, callbacks) {
    var initialState = {
      selectedItem: items.length ? items[0].id : '',
      items: items,
      organize: false,
      order: items.map(function (item) {
        return item.id;
      })
    };

    var store = (0, _redux.createStore)(_reducer2.default, initialState);

    _reactDom2.default.render(_react2.default.createElement(
      _reactRedux.Provider,
      { store: store },
      _react2.default.createElement(_PanelContainer2.default, {
        callbacks: callbacks,
        orientation: orientation,
        container: container
      })
    ), container);

    this.updateItems = function (items) {
      store.dispatch(actions.updateItems(items));

      var order = items.map(function (item) {
        return item.id;
      });
      store.dispatch(actions.updateOrder(order));
    };

    this.navigateTo = function (itemID) {
      store.dispatch(actions.changeSelectedItem(itemID));
      var list = $(container).find('.group-list');
      var item = list.find('[data-id="' + itemID + '"]');

      if (list.length && item.length) {
        scrollPanel(list, item);
      }
    };

    function scrollPanel(list, item) {
      //scroll to the selected item so that it's in the middle of the list's visible area.
      var SCROLL_DURATION = 500;
      var SCROLL_DURATION_HORIZONTAL = 800;
      var scrollAmount = 0;
      var centeredPosition = 0;
      var halfItemWidth = 0;
      var halfListWidth = 0;
      var halfItemHeight = 0;
      var halfListHeight = 0;
      var scrollToLeft = 0;
      var scrollToTop = 0;

      if (orientation === 'horizontal') {
        // get half of item width
        halfItemWidth = item[0].offsetWidth / 2;
        // get half of list width
        halfListWidth = list[0].offsetWidth / 2;
        // centeredPosition is the amount from the top of the visible list to perfectly center an item
        centeredPosition = halfListWidth - halfItemWidth;
        // to position the item at the left, we just have to minus how far the list is from the left of the document compared to how far the item is from the document's left
        scrollToLeft = item.offset().left - (list.offset().left - list.scrollLeft());
        // in our case, we don't want to scroll that far... we want to center the item.
        scrollAmount = scrollToLeft - centeredPosition;

        // if scrollAmount is negative, pass 0 instead of a negative value.
        if (scrollAmount < 0) {
          scrollAmount = 0;
        }

        list.animate({
          scrollLeft: scrollAmount
        }, SCROLL_DURATION_HORIZONTAL);
      } else {
        // get half of item height
        halfItemHeight = item[0].offsetHeight / 2;
        // get half of list height
        halfListHeight = list[0].offsetHeight / 2;
        // centeredPosition is the amount from the top of the visible list to perfectly center an item
        centeredPosition = halfListHeight - halfItemHeight;
        // to position the item at the top, we just have to minus how far the list is from the top of the document compared to how far the item is from the document's top
        scrollToTop = item.offset().top - (list.offset().top - list.scrollTop());
        // in our case, we don't want to scroll that far... we want to center the item.
        scrollAmount = scrollToTop - centeredPosition;

        // if scrollAmount is negative, pass 0 instead of a negative value.
        if (scrollAmount < 0) {
          scrollAmount = 0;
        }

        list.animate({
          scrollTop: scrollAmount
        }, SCROLL_DURATION);
      }
    }
  };

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _reducer2 = _interopRequireDefault(_reducer);

  var actions = _interopRequireWildcard(_actions);

  var _PanelContainer2 = _interopRequireDefault(_PanelContainer);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  module.exports = exports['default'];
});
//# sourceMappingURL=OverviewPanel.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/Immersive/ImmersiveBuilderPanel',[],function(){});
define('storymaps-react/tpl/view/section/Immersive/ImmersiveBuilderPanel',['module', 'exports', 'lib-build/i18n!./../../../../../resources/tpl/builder/nls/app', 'storymaps-react/tpl/builder/overviewPanel/OverviewPanel', 'lib-build/less!./ImmersiveBuilderPanel'], function (module, exports, _app, _OverviewPanel) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _app2 = _interopRequireDefault(_app);

  var _OverviewPanel2 = _interopRequireDefault(_OverviewPanel);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var TRANSITIONS = {
    'fade-fast': {
      id: 'fade-fast',
      label: _app2.default.builder.immersiveViewPanel.fade,
      icon: 'resources/tpl/builder/icons/immersive-panel/FadeFast.png'
    },
    'fade-slow': {
      id: 'fade-slow',
      label: _app2.default.builder.immersiveViewPanel.fadeSlow,
      icon: 'resources/tpl/builder/icons/immersive-panel/Fade.png'
    },
    'swipe-vertical': {
      id: 'swipe-vertical',
      label: _app2.default.builder.immersiveViewPanel.swipeVertical,
      icon: 'resources/tpl/builder/icons/immersive-panel/SwipeVertical.png'
    },
    'swipe-horizontal': {
      id: 'swipe-horizontal',
      label: _app2.default.builder.immersiveViewPanel.swipeHorizontal,
      icon: 'resources/tpl/builder/icons/immersive-panel/SwipeHorizontal.png'
    },
    none: {
      id: 'none',
      label: _app2.default.builder.immersiveViewPanel.none,
      icon: 'resources/tpl/builder/icons/immersive-panel/None.png'
    }
  };

  var ImmersiveBuilderPanel = function () {
    function ImmersiveBuilderPanel(params) {
      _classCallCheck(this, ImmersiveBuilderPanel);

      params = params || {};

      if (!params.container) {
        return;
      }

      // The whole section
      this._node = params.container;

      this._medias = null;
      this._panels = null;
      this._transitions = null;

      this._overview = new _OverviewPanel2.default(this._node[0], 'horizontal', [], {
        selectItem: function (id) {
          params.selectView(this._getViewById(id));
        }.bind(this),
        addItem: params.addView,
        deleteItem: function (id) {
          params.deleteView(this._getViewById(id));
        }.bind(this),
        duplicateItem: function (id) {
          params.duplicateView(this._getViewById(id));
        }.bind(this),
        updateItemTransition: params.updateTransition,
        organize: params.organize
      });
    }

    _createClass(ImmersiveBuilderPanel, [{
      key: 'update',
      value: function update(data) {
        data = data || {};

        if (!data.medias || !data.panels) {
          return;
        }

        this._medias = data.medias;
        this._panels = data.panels;
        this._transitions = data.transitions;

        this._overview.updateItems(this._getViewsOverview(data.transitionsInfos));
      }
    }, {
      key: 'selectView',
      value: function selectView(index) {
        if (index < 0) {
          return;
        }

        this._overview.navigateTo(this._getViewIdByIndex(index));
      }
    }, {
      key: '_getViewById',
      value: function _getViewById(id) {
        for (var panelIndex in this._panels) {
          var panel = this._panels[panelIndex];

          if (panel.id == id) {
            return parseInt(panelIndex, 10);
          }
        }

        return -1;
      }
    }, {
      key: '_getViewIdByIndex',
      value: function _getViewIdByIndex(index) {
        if (index < 0) {
          return null;
        }

        return this._panels[index].id;
      }
    }, {
      key: '_getViewsOverview',
      value: function _getViewsOverview(transitionsInfos) {
        var overview = [];

        for (var i = 0; i < this._medias.length; i++) {
          var media = this._medias[i],
              panel = this._panels[i],
              transition = this._transitions[i],
              transitionInfo = transitionsInfos[i];

          overview.push({
            id: panel.id,
            type: 'thumbnail',
            icon: media.getPreviewIcon(),
            transition: transition,
            transitions: this._getTransition({
              index: i,
              mediaType: media.type,
              isDuplicate: transitionInfo.isDuplicate,
              isDuplicateConsecutive: transitionInfo.isDuplicateConsecutive,
              firstOccurenceTransition: transitionInfo.firstOccurenceTransition,
              duplicateConsecutiveTransitions: transitionInfo.duplicateConsecutiveTransitions
            }),
            thumbnail: media.getPreviewThumbnail(),
            hidden: false,
            hasDelete: true,
            hasHide: true,
            hasDuplicate: true,
            hasOrganize: true
          });
        }

        return overview;
      }
    }, {
      key: '_getTransition',
      value: function _getTransition() {
        var config = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var transitions = [];

        if (config.index === 0) {
          return transitions;
        }

        // Two views using the same media consecutivly
        // -> disable all options except if the transition is listed in config.duplicateConsecutiveTransitions
        //    This is currently for webmap to allow swipe depending on the two medias config
        if (config.isDuplicateConsecutive) {
          var disabledTooltip = _app2.default.builder.immersiveViewPanel.disabledConsecutiveSameMedia,
              disabledTooltipMap = _app2.default.builder.immersiveViewPanel.disabledTooltipMap,
              disabledTooltipMapTmp = _app2.default.builder.immersiveViewPanel.disabledConsecutiveSameMap,
              disabledTooltipMapTmp2 = _app2.default.builder.immersiveViewPanel.disabledNotInBeta,
              disabledTransitions = ['fade-fast', 'fade-slow', 'swipe-vertical', 'swipe-horizontal'];

          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = disabledTransitions[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var name = _step.value;

              var _transition = Object.assign({}, TRANSITIONS[name]);

              if (config.duplicateConsecutiveTransitions.indexOf(name) > -1) {
                _transition.enabled = true;
                _transition.tooltip = '';
              } else if (config.mediaType == 'webmap') {
                // TODO: will remove that limitation soon
                if (name == 'fade-slow' || name == 'fade-fast') {
                  _transition.enabled = false;
                  _transition.tooltip = disabledTooltipMapTmp;
                } else if (name == 'swipe-horizontal') {
                  _transition.enabled = false;
                  _transition.tooltip = disabledTooltipMapTmp2;
                } else {
                  _transition.enabled = false;
                  _transition.tooltip = disabledTooltipMap;
                }
              } else {
                _transition.enabled = false;
                _transition.tooltip = disabledTooltip;
              }

              transitions.push(_transition);
            }

            // "None" is the only available option
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }

          var transition = Object.assign({}, TRANSITIONS['none']);
          transition.enabled = true;
          transition.tooltip = '';
          transitions.push(transition);
        }
        // Duplicate and non consecutive section
        // Only the transition from the first occurence of the media is authorized
        // Except for image where all transition are authorized (images are always duplicated)
        else if (config.isDuplicate && config.firstOccurenceTransition && config.mediaType != 'image') {
            //let disabledTooltip = 'Not available as the first occurence is using a different transition';

            // Temporary workaround
            var _disabledTooltip = _app2.default.builder.immersiveViewPanel.disabledNonConsecutive;
            config.firstOccurenceTransition = 'none';

            for (var _name in TRANSITIONS) {
              var _transition2 = Object.assign({}, TRANSITIONS[_name]);

              if (_name != config.firstOccurenceTransition) {
                _transition2.enabled = false;
                _transition2.tooltip = _disabledTooltip;
              } else {
                _transition2.enabled = true;
                _transition2.tooltip = '';
              }

              transitions.push(_transition2);
            }
          }
          // Allow all transitions
          else {
              for (var _name2 in TRANSITIONS) {
                var _transition3 = Object.assign({}, TRANSITIONS[_name2]);

                _transition3.enabled = true;
                _transition3.tooltip = '';

                transitions.push(_transition3);
              }
            }

        return transitions;
      }
    }]);

    return ImmersiveBuilderPanel;
  }();

  exports.default = ImmersiveBuilderPanel;
  module.exports = exports['default'];
});
//# sourceMappingURL=ImmersiveBuilderPanel.js.map
;

define('lib-build/hbars!storymaps-react/tpl/builder/notification/Undo', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\" class=\"builder-notification notification-undo has-notification-btn\">\r\n  <div class=\"alert alert-dismissible\" role=\"alert\">\r\n    ";
  stack1 = ((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"label","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n    <button class=\"btn btn-primary btn-sm btn-undo\">"
    + escapeExpression(((helper = (helper = helpers.labelUndo || (depth0 != null ? depth0.labelUndo : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"labelUndo","hash":{},"data":data}) : helper)))
    + "</button>\r\n    <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\r\n      <span aria-hidden=\"true\">&times;</span>\r\n    </button>\r\n    <div class=\"progress\"></div>\r\n    <div class=\"info-icon\">\r\n      <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });

// ProgressBar.js 1.0.1
// https://kimmobrunfeldt.github.io/progressbar.js
// License: MIT

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define('lib/progressbar.js/dist/progressbar.min',[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.ProgressBar=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){(function(){var b=this||Function("return this")(),e=function(){"use strict";function e(){}function f(a,b){var c;for(c in a)Object.hasOwnProperty.call(a,c)&&b(c)}function g(a,b){return f(b,function(c){a[c]=b[c]}),a}function h(a,b){f(b,function(c){"undefined"==typeof a[c]&&(a[c]=b[c])})}function i(a,b,c,d,e,f,g){var h,i,k,l=f>a?0:(a-f)/e;for(h in b)b.hasOwnProperty(h)&&(i=g[h],k="function"==typeof i?i:o[i],b[h]=j(c[h],d[h],k,l));return b}function j(a,b,c,d){return a+(b-a)*c(d)}function k(a,b){var c=n.prototype.filter,d=a._filterArgs;f(c,function(e){"undefined"!=typeof c[e][b]&&c[e][b].apply(a,d)})}function l(a,b,c,d,e,f,g,h,j,l,m){v=b+c+d,w=Math.min(m||u(),v),x=w>=v,y=d-(v-w),a.isPlaying()&&(x?(j(g,a._attachment,y),a.stop(!0)):(a._scheduleId=l(a._timeoutHandler,s),k(a,"beforeTween"),b+c>w?i(1,e,f,g,1,1,h):i(w,e,f,g,d,b+c,h),k(a,"afterTween"),j(e,a._attachment,y)))}function m(a,b){var c={},d=typeof b;return"string"===d||"function"===d?f(a,function(a){c[a]=b}):f(a,function(a){c[a]||(c[a]=b[a]||q)}),c}function n(a,b){this._currentState=a||{},this._configured=!1,this._scheduleFunction=p,"undefined"!=typeof b&&this.setConfig(b)}var o,p,q="linear",r=500,s=1e3/60,t=Date.now?Date.now:function(){return+new Date},u="undefined"!=typeof SHIFTY_DEBUG_NOW?SHIFTY_DEBUG_NOW:t;p="undefined"!=typeof window?window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozCancelRequestAnimationFrame&&window.mozRequestAnimationFrame||setTimeout:setTimeout;var v,w,x,y;return n.prototype.tween=function(a){return this._isTweening?this:(void 0===a&&this._configured||this.setConfig(a),this._timestamp=u(),this._start(this.get(),this._attachment),this.resume())},n.prototype.setConfig=function(a){a=a||{},this._configured=!0,this._attachment=a.attachment,this._pausedAtTime=null,this._scheduleId=null,this._delay=a.delay||0,this._start=a.start||e,this._step=a.step||e,this._finish=a.finish||e,this._duration=a.duration||r,this._currentState=g({},a.from)||this.get(),this._originalState=this.get(),this._targetState=g({},a.to)||this.get();var b=this;this._timeoutHandler=function(){l(b,b._timestamp,b._delay,b._duration,b._currentState,b._originalState,b._targetState,b._easing,b._step,b._scheduleFunction)};var c=this._currentState,d=this._targetState;return h(d,c),this._easing=m(c,a.easing||q),this._filterArgs=[c,this._originalState,d,this._easing],k(this,"tweenCreated"),this},n.prototype.get=function(){return g({},this._currentState)},n.prototype.set=function(a){this._currentState=a},n.prototype.pause=function(){return this._pausedAtTime=u(),this._isPaused=!0,this},n.prototype.resume=function(){return this._isPaused&&(this._timestamp+=u()-this._pausedAtTime),this._isPaused=!1,this._isTweening=!0,this._timeoutHandler(),this},n.prototype.seek=function(a){a=Math.max(a,0);var b=u();return this._timestamp+a===0?this:(this._timestamp=b-a,this.isPlaying()||(this._isTweening=!0,this._isPaused=!1,l(this,this._timestamp,this._delay,this._duration,this._currentState,this._originalState,this._targetState,this._easing,this._step,this._scheduleFunction,b),this.pause()),this)},n.prototype.stop=function(a){return this._isTweening=!1,this._isPaused=!1,this._timeoutHandler=e,(b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.oCancelAnimationFrame||b.msCancelAnimationFrame||b.mozCancelRequestAnimationFrame||b.clearTimeout)(this._scheduleId),a&&(k(this,"beforeTween"),i(1,this._currentState,this._originalState,this._targetState,1,0,this._easing),k(this,"afterTween"),k(this,"afterTweenEnd"),this._finish.call(this,this._currentState,this._attachment)),this},n.prototype.isPlaying=function(){return this._isTweening&&!this._isPaused},n.prototype.setScheduleFunction=function(a){this._scheduleFunction=a},n.prototype.dispose=function(){var a;for(a in this)this.hasOwnProperty(a)&&delete this[a]},n.prototype.filter={},n.prototype.formula={linear:function(a){return a}},o=n.prototype.formula,g(n,{now:u,each:f,tweenProps:i,tweenProp:j,applyFilter:k,shallowCopy:g,defaults:h,composeEasingObject:m}),"function"==typeof SHIFTY_DEBUG_NOW&&(b.timeoutHandler=l),"object"==typeof d?c.exports=n:"function"==typeof a&&a.amd?a(function(){return n}):"undefined"==typeof b.Tweenable&&(b.Tweenable=n),n}();!function(){e.shallowCopy(e.prototype.formula,{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){return(a/=.5)<1?.5*Math.pow(a,2):-.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){return(a/=.5)<1?.5*Math.pow(a,3):.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){return(a/=.5)<1?.5*Math.pow(a,5):.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*(a*a*(((b*=1.525)+1)*a-b)):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin((6*a-1)*(2*Math.PI)/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=.5)<1?.5*(a*a*(((b*=1.525)+1)*a-b)):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){var b=1.70158;return a*a*((b+1)*a-b)},swingTo:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},bounce:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bouncePast:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?2-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?2-(7.5625*(a-=2.25/2.75)*a+.9375):2-(7.5625*(a-=2.625/2.75)*a+.984375)},easeFromTo:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,.25)}})}(),function(){function a(a,b,c,d,e,f){function g(a){return((n*a+o)*a+p)*a}function h(a){return((q*a+r)*a+s)*a}function i(a){return(3*n*a+2*o)*a+p}function j(a){return 1/(200*a)}function k(a,b){return h(m(a,b))}function l(a){return a>=0?a:0-a}function m(a,b){var c,d,e,f,h,j;for(e=a,j=0;8>j;j++){if(f=g(e)-a,l(f)<b)return e;if(h=i(e),l(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),l(f-a)<b)return e;a>f?c=e:d=e,e=.5*(d-c)+c}return e}var n=0,o=0,p=0,q=0,r=0,s=0;return p=3*b,o=3*(d-b)-p,n=1-p-o,s=3*c,r=3*(e-c)-s,q=1-s-r,k(a,j(f))}function b(b,c,d,e){return function(f){return a(f,b,c,d,e,1)}}e.setBezierFunction=function(a,c,d,f,g){var h=b(c,d,f,g);return h.displayName=a,h.x1=c,h.y1=d,h.x2=f,h.y2=g,e.prototype.formula[a]=h},e.unsetBezierFunction=function(a){delete e.prototype.formula[a]}}(),function(){function a(a,b,c,d,f,g){return e.tweenProps(d,b,a,c,1,g,f)}var b=new e;b._filterArgs=[],e.interpolate=function(c,d,f,g,h){var i=e.shallowCopy({},c),j=h||0,k=e.composeEasingObject(c,g||"linear");b.set({});var l=b._filterArgs;l.length=0,l[0]=i,l[1]=c,l[2]=d,l[3]=k,e.applyFilter(b,"tweenCreated"),e.applyFilter(b,"beforeTween");var m=a(c,i,d,f,k,j);return e.applyFilter(b,"afterTween"),m}}(),function(a){function b(a,b){var c,d=[],e=a.length;for(c=0;e>c;c++)d.push("_"+b+"_"+c);return d}function c(a){var b=a.match(v);return b?(1===b.length||a[0].match(u))&&b.unshift(""):b=["",""],b.join(A)}function d(b){a.each(b,function(a){var c=b[a];"string"==typeof c&&c.match(z)&&(b[a]=e(c))})}function e(a){return i(z,a,f)}function f(a){var b=g(a);return"rgb("+b[0]+","+b[1]+","+b[2]+")"}function g(a){return a=a.replace(/#/,""),3===a.length&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),B[0]=h(a.substr(0,2)),B[1]=h(a.substr(2,2)),B[2]=h(a.substr(4,2)),B}function h(a){return parseInt(a,16)}function i(a,b,c){var d=b.match(a),e=b.replace(a,A);if(d)for(var f,g=d.length,h=0;g>h;h++)f=d.shift(),e=e.replace(A,c(f));return e}function j(a){return i(x,a,k)}function k(a){for(var b=a.match(w),c=b.length,d=a.match(y)[0],e=0;c>e;e++)d+=parseInt(b[e],10)+",";return d=d.slice(0,-1)+")"}function l(d){var e={};return a.each(d,function(a){var f=d[a];if("string"==typeof f){var g=r(f);e[a]={formatString:c(f),chunkNames:b(g,a)}}}),e}function m(b,c){a.each(c,function(a){for(var d=b[a],e=r(d),f=e.length,g=0;f>g;g++)b[c[a].chunkNames[g]]=+e[g];delete b[a]})}function n(b,c){a.each(c,function(a){var d=b[a],e=o(b,c[a].chunkNames),f=p(e,c[a].chunkNames);d=q(c[a].formatString,f),b[a]=j(d)})}function o(a,b){for(var c,d={},e=b.length,f=0;e>f;f++)c=b[f],d[c]=a[c],delete a[c];return d}function p(a,b){C.length=0;for(var c=b.length,d=0;c>d;d++)C.push(a[b[d]]);return C}function q(a,b){for(var c=a,d=b.length,e=0;d>e;e++)c=c.replace(A,+b[e].toFixed(4));return c}function r(a){return a.match(w)}function s(b,c){a.each(c,function(a){var d,e=c[a],f=e.chunkNames,g=f.length,h=b[a];if("string"==typeof h){var i=h.split(" "),j=i[i.length-1];for(d=0;g>d;d++)b[f[d]]=i[d]||j}else for(d=0;g>d;d++)b[f[d]]=h;delete b[a]})}function t(b,c){a.each(c,function(a){var d=c[a],e=d.chunkNames,f=e.length,g=b[e[0]],h=typeof g;if("string"===h){for(var i="",j=0;f>j;j++)i+=" "+b[e[j]],delete b[e[j]];b[a]=i.substr(1)}else b[a]=g})}var u=/(\d|\-|\.)/,v=/([^\-0-9\.]+)/g,w=/[0-9.\-]+/g,x=new RegExp("rgb\\("+w.source+/,\s*/.source+w.source+/,\s*/.source+w.source+"\\)","g"),y=/^.*\(/,z=/#([0-9]|[a-f]){3,6}/gi,A="VAL",B=[],C=[];a.prototype.filter.token={tweenCreated:function(a,b,c,e){d(a),d(b),d(c),this._tokenData=l(a)},beforeTween:function(a,b,c,d){s(d,this._tokenData),m(a,this._tokenData),m(b,this._tokenData),m(c,this._tokenData)},afterTween:function(a,b,c,d){n(a,this._tokenData),n(b,this._tokenData),n(c,this._tokenData),t(d,this._tokenData)}}}(e)}).call(null)},{}],2:[function(a,b,c){var d=a("./shape"),e=a("./utils"),f=function(a,b){this._pathTemplate="M 50,50 m 0,-{radius} a {radius},{radius} 0 1 1 0,{2radius} a {radius},{radius} 0 1 1 0,-{2radius}",this.containerAspectRatio=1,d.apply(this,arguments)};f.prototype=new d,f.prototype.constructor=f,f.prototype._pathString=function(a){var b=a.strokeWidth;a.trailWidth&&a.trailWidth>a.strokeWidth&&(b=a.trailWidth);var c=50-b/2;return e.render(this._pathTemplate,{radius:c,"2radius":2*c})},f.prototype._trailString=function(a){return this._pathString(a)},b.exports=f},{"./shape":7,"./utils":8}],3:[function(a,b,c){var d=a("./shape"),e=a("./utils"),f=function(a,b){this._pathTemplate="M 0,{center} L 100,{center}",d.apply(this,arguments)};f.prototype=new d,f.prototype.constructor=f,f.prototype._initializeSvg=function(a,b){a.setAttribute("viewBox","0 0 100 "+b.strokeWidth),a.setAttribute("preserveAspectRatio","none")},f.prototype._pathString=function(a){return e.render(this._pathTemplate,{center:a.strokeWidth/2})},f.prototype._trailString=function(a){return this._pathString(a)},b.exports=f},{"./shape":7,"./utils":8}],4:[function(a,b,c){b.exports={Line:a("./line"),Circle:a("./circle"),SemiCircle:a("./semicircle"),Path:a("./path"),Shape:a("./shape"),utils:a("./utils")}},{"./circle":2,"./line":3,"./path":5,"./semicircle":6,"./shape":7,"./utils":8}],5:[function(a,b,c){var d=a("shifty"),e=a("./utils"),f={easeIn:"easeInCubic",easeOut:"easeOutCubic",easeInOut:"easeInOutCubic"},g=function h(a,b){if(!(this instanceof h))throw new Error("Constructor was called without new keyword");b=e.extend({duration:800,easing:"linear",from:{},to:{},step:function(){}},b);var c;c=e.isString(a)?document.querySelector(a):a,this.path=c,this._opts=b,this._tweenable=null;var d=this.path.getTotalLength();this.path.style.strokeDasharray=d+" "+d,this.set(0)};g.prototype.value=function(){var a=this._getComputedDashOffset(),b=this.path.getTotalLength(),c=1-a/b;return parseFloat(c.toFixed(6),10)},g.prototype.set=function(a){this.stop(),this.path.style.strokeDashoffset=this._progressToOffset(a);var b=this._opts.step;if(e.isFunction(b)){var c=this._easing(this._opts.easing),d=this._calculateTo(a,c),f=this._opts.shape||this;b(d,f,this._opts.attachment)}},g.prototype.stop=function(){this._stopTween(),this.path.style.strokeDashoffset=this._getComputedDashOffset()},g.prototype.animate=function(a,b,c){b=b||{},e.isFunction(b)&&(c=b,b={});var f=e.extend({},b),g=e.extend({},this._opts);b=e.extend(g,b);var h=this._easing(b.easing),i=this._resolveFromAndTo(a,h,f);this.stop(),this.path.getBoundingClientRect();var j=this._getComputedDashOffset(),k=this._progressToOffset(a),l=this;this._tweenable=new d,this._tweenable.tween({from:e.extend({offset:j},i.from),to:e.extend({offset:k},i.to),duration:b.duration,easing:h,step:function(a){l.path.style.strokeDashoffset=a.offset;var c=b.shape||l;b.step(a,c,b.attachment)},finish:function(a){e.isFunction(c)&&c()}})},g.prototype._getComputedDashOffset=function(){var a=window.getComputedStyle(this.path,null);return parseFloat(a.getPropertyValue("stroke-dashoffset"),10)},g.prototype._progressToOffset=function(a){var b=this.path.getTotalLength();return b-a*b},g.prototype._resolveFromAndTo=function(a,b,c){return c.from&&c.to?{from:c.from,to:c.to}:{from:this._calculateFrom(b),to:this._calculateTo(a,b)}},g.prototype._calculateFrom=function(a){return d.interpolate(this._opts.from,this._opts.to,this.value(),a)},g.prototype._calculateTo=function(a,b){return d.interpolate(this._opts.from,this._opts.to,a,b)},g.prototype._stopTween=function(){null!==this._tweenable&&(this._tweenable.stop(),this._tweenable=null)},g.prototype._easing=function(a){return f.hasOwnProperty(a)?f[a]:a},b.exports=g},{"./utils":8,shifty:1}],6:[function(a,b,c){var d=a("./shape"),e=a("./circle"),f=a("./utils"),g=function(a,b){this._pathTemplate="M 50,50 m -{radius},0 a {radius},{radius} 0 1 1 {2radius},0",this.containerAspectRatio=2,d.apply(this,arguments)};g.prototype=new d,g.prototype.constructor=g,g.prototype._initializeSvg=function(a,b){a.setAttribute("viewBox","0 0 100 50")},g.prototype._initializeTextContainer=function(a,b,c){a.text.style&&(c.style.top="auto",c.style.bottom="0",a.text.alignToBottom?f.setStyle(c,"transform","translate(-50%, 0)"):f.setStyle(c,"transform","translate(-50%, 50%)"))},g.prototype._pathString=e.prototype._pathString,g.prototype._trailString=e.prototype._trailString,b.exports=g},{"./circle":2,"./shape":7,"./utils":8}],7:[function(a,b,c){var d=a("./path"),e=a("./utils"),f="Object is destroyed",g=function h(a,b){if(!(this instanceof h))throw new Error("Constructor was called without new keyword");if(0!==arguments.length){this._opts=e.extend({color:"#555",strokeWidth:1,trailColor:null,trailWidth:null,fill:null,text:{style:{color:null,position:"absolute",left:"50%",top:"50%",padding:0,margin:0,transform:{prefix:!0,value:"translate(-50%, -50%)"}},autoStyleContainer:!0,alignToBottom:!0,value:null,className:"progressbar-text"},svgStyle:{display:"block",width:"100%"},warnings:!1},b,!0),e.isObject(b)&&void 0!==b.svgStyle&&(this._opts.svgStyle=b.svgStyle),e.isObject(b)&&e.isObject(b.text)&&void 0!==b.text.style&&(this._opts.text.style=b.text.style);var c,f=this._createSvgView(this._opts);if(c=e.isString(a)?document.querySelector(a):a,!c)throw new Error("Container does not exist: "+a);this._container=c,this._container.appendChild(f.svg),this._opts.warnings&&this._warnContainerAspectRatio(this._container),this._opts.svgStyle&&e.setStyles(f.svg,this._opts.svgStyle),this.svg=f.svg,this.path=f.path,this.trail=f.trail,this.text=null;var g=e.extend({attachment:void 0,shape:this},this._opts);this._progressPath=new d(f.path,g),e.isObject(this._opts.text)&&null!==this._opts.text.value&&this.setText(this._opts.text.value)}};g.prototype.animate=function(a,b,c){if(null===this._progressPath)throw new Error(f);this._progressPath.animate(a,b,c)},g.prototype.stop=function(){if(null===this._progressPath)throw new Error(f);void 0!==this._progressPath&&this._progressPath.stop()},g.prototype.destroy=function(){if(null===this._progressPath)throw new Error(f);this.stop(),this.svg.parentNode.removeChild(this.svg),this.svg=null,this.path=null,this.trail=null,this._progressPath=null,null!==this.text&&(this.text.parentNode.removeChild(this.text),this.text=null)},g.prototype.set=function(a){if(null===this._progressPath)throw new Error(f);this._progressPath.set(a)},g.prototype.value=function(){if(null===this._progressPath)throw new Error(f);return void 0===this._progressPath?0:this._progressPath.value()},g.prototype.setText=function(a){if(null===this._progressPath)throw new Error(f);null===this.text&&(this.text=this._createTextContainer(this._opts,this._container),this._container.appendChild(this.text)),e.isObject(a)?(e.removeChildren(this.text),this.text.appendChild(a)):this.text.innerHTML=a},g.prototype._createSvgView=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","svg");this._initializeSvg(b,a);var c=null;(a.trailColor||a.trailWidth)&&(c=this._createTrail(a),b.appendChild(c));var d=this._createPath(a);return b.appendChild(d),{svg:b,path:d,trail:c}},g.prototype._initializeSvg=function(a,b){a.setAttribute("viewBox","0 0 100 100")},g.prototype._createPath=function(a){var b=this._pathString(a);return this._createPathElement(b,a)},g.prototype._createTrail=function(a){var b=this._trailString(a),c=e.extend({},a);return c.trailColor||(c.trailColor="#eee"),c.trailWidth||(c.trailWidth=c.strokeWidth),c.color=c.trailColor,c.strokeWidth=c.trailWidth,c.fill=null,this._createPathElement(b,c)},g.prototype._createPathElement=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","path");return c.setAttribute("d",a),c.setAttribute("stroke",b.color),c.setAttribute("stroke-width",b.strokeWidth),b.fill?c.setAttribute("fill",b.fill):c.setAttribute("fill-opacity","0"),c},g.prototype._createTextContainer=function(a,b){var c=document.createElement("div");c.className=a.text.className;var d=a.text.style;return d&&(a.text.autoStyleContainer&&(b.style.position="relative"),e.setStyles(c,d),d.color||(c.style.color=a.color)),this._initializeTextContainer(a,b,c),c},g.prototype._initializeTextContainer=function(a,b,c){},g.prototype._pathString=function(a){throw new Error("Override this function for each progress bar")},g.prototype._trailString=function(a){throw new Error("Override this function for each progress bar")},g.prototype._warnContainerAspectRatio=function(a){if(this.containerAspectRatio){var b=window.getComputedStyle(a,null),c=parseFloat(b.getPropertyValue("width"),10),d=parseFloat(b.getPropertyValue("height"),10);e.floatEquals(this.containerAspectRatio,c/d)||(console.warn("Incorrect aspect ratio of container","#"+a.id,"detected:",b.getPropertyValue("width")+"(width)","/",b.getPropertyValue("height")+"(height)","=",c/d),console.warn("Aspect ratio of should be",this.containerAspectRatio))}},b.exports=g},{"./path":5,"./utils":8}],8:[function(a,b,c){function d(a,b,c){a=a||{},b=b||{},c=c||!1;for(var e in b)if(b.hasOwnProperty(e)){var f=a[e],g=b[e];c&&l(f)&&l(g)?a[e]=d(f,g,c):a[e]=g}return a}function e(a,b){var c=a;for(var d in b)if(b.hasOwnProperty(d)){var e=b[d],f="\\{"+d+"\\}",g=new RegExp(f,"g");c=c.replace(g,e)}return c}function f(a,b,c){for(var d=a.style,e=0;e<p.length;++e){var f=p[e];d[f+h(b)]=c}d[b]=c}function g(a,b){m(b,function(b,c){null!==b&&void 0!==b&&(l(b)&&b.prefix===!0?f(a,c,b.value):a.style[c]=b)})}function h(a){return a.charAt(0).toUpperCase()+a.slice(1)}function i(a){return"string"==typeof a||a instanceof String}function j(a){return"function"==typeof a}function k(a){return"[object Array]"===Object.prototype.toString.call(a)}function l(a){if(k(a))return!1;var b=typeof a;return"object"===b&&!!a}function m(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b(d,c)}}function n(a,b){return Math.abs(a-b)<q}function o(a){for(;a.firstChild;)a.removeChild(a.firstChild)}var p="Webkit Moz O ms".split(" "),q=.001;b.exports={extend:d,render:e,setStyle:f,setStyles:g,capitalize:h,isString:i,isFunction:j,isObject:l,forEachObject:m,floatEquals:n,removeChildren:o}},{}]},{},[4])(4)});
//# sourceMappingURL=progressbar.min.js.map;

define('lib-build/less!storymaps-react/tpl/builder/notification/Undo',[],function(){});
define('storymaps-react/tpl/builder/notification/Undo',['module', 'exports', './Notification', 'lib-build/hbars!./Undo', 'lib/progressbar.js/dist/progressbar.min', 'lib-build/less!./Undo'], function (module, exports, _Notification2, _Undo, _progressbar) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Notification3 = _interopRequireDefault(_Notification2);

  var _Undo2 = _interopRequireDefault(_Undo);

  var _progressbar2 = _interopRequireDefault(_progressbar);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var DEFAULT_DELAY = 20000;

  var Undo = function (_Notification) {
    _inherits(Undo, _Notification);

    function Undo() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, Undo);

      var _this = _possibleConstructorReturn(this, (Undo.__proto__ || Object.getPrototypeOf(Undo)).call(this, params));

      _this._clearFollowingsAfterUndo = params.clearFollowingsAfterUndo;
      return _this;
    }

    _createClass(Undo, [{
      key: 'render',
      value: function render() {
        return (0, _Undo2.default)({
          id: this._id,
          label: this._label,
          labelUndo: 'Undo' // TODO
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        if (this._positionTop !== undefined) {
          this._node.css('top', this._positionTop);
        }

        this._initEvents();
      }
    }, {
      key: '_initEvents',
      value: function _initEvents() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var delay = params.delay || DEFAULT_DELAY;

        var progressBar = new _progressbar2.default.Line(this._node.find('.progress')[0], {
          strokeWidth: 4,
          duration: delay,
          color: '#005e95',
          trailColor: '#eee',
          trailWidth: 1,
          svgStyle: { width: '100%', height: '100%' }
          /*
          from: {color: '#ED6A5A'},
          to: {color: '#FFEA82'},
          step: (state, bar) => {
            bar.path.setAttribute('stroke', state.color);
          }
          */
        });

        progressBar.set(-1.0);

        progressBar.animate(0, {}, function () {
          setTimeout(function () {
            this._node.fadeOut({
              complete: function () {
                this._node.remove();
              }.bind(this) });
            this._resultDeferred.reject();
          }.bind(this), 200);
        }.bind(this));

        this._node.find('.btn-undo').click(function () {
          if (this._clearFollowingsAfterUndo) {
            this._node.nextAll().remove();
          }

          this._node.remove();
          this._resultDeferred.resolve();
        }.bind(this));
      }
    }]);

    return Undo;
  }(_Notification3.default);

  exports.default = Undo;
  module.exports = exports['default'];
});
//# sourceMappingURL=Undo.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/Immersive/ImmersiveBuilder',[],function(){});
define('storymaps-react/tpl/view/section/Immersive/ImmersiveBuilder',['module', 'exports', './Immersive', './ImmersiveBuilderPanel', 'storymaps/tpl/view/section/Common', 'storymaps-react/tpl/builder/notification/Undo', '../builder/AddMenu', 'dojo/topic', 'dojo/_base/lang', 'lib-build/less!./ImmersiveBuilder'], function (module, exports, _Immersive2, _ImmersiveBuilderPanel, _Common, _Undo, _AddMenu, _topic, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Immersive3 = _interopRequireDefault(_Immersive2);

  var _ImmersiveBuilderPanel2 = _interopRequireDefault(_ImmersiveBuilderPanel);

  var _Common2 = _interopRequireDefault(_Common);

  var _Undo2 = _interopRequireDefault(_Undo);

  var _AddMenu2 = _interopRequireDefault(_AddMenu);

  var _topic2 = _interopRequireDefault(_topic);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var ImmersiveBuilder = function (_Immersive) {
    _inherits(ImmersiveBuilder, _Immersive);

    function ImmersiveBuilder(section, media) {
      _classCallCheck(this, ImmersiveBuilder);

      var _this = _possibleConstructorReturn(this, (ImmersiveBuilder.__proto__ || Object.getPrototypeOf(ImmersiveBuilder)).call(this, section));

      _this.MEDIA_BUILDER_TABS_BACKGROUND = ['appearance', 'background', 'manage'];
      _this.MEDIA_BUILDER_TABS_PANEL = ['appearance', 'manage'];

      _this._latestOnScrollParams = null;
      _this._currentScrollPosition = null;
      _this._builderPanel = null;
      _this._builderPanelNode = null;

      _this._initialMedia = media;

      _this._addMenu = new _AddMenu2.default({
        buttons: ['sequence', 'title', 'immersive']
      });
      return _this;
    }

    _createClass(ImmersiveBuilder, [{
      key: 'render',
      value: function render() {
        var views = this._section.views;

        // Creating a new section
        if (!views || !views.length) {
          var media = this._initialMedia || { type: 'empty', empty: 'empty' };

          this._section.views = [{
            transition: 'fade-fast',
            background: _Common2.default.initMedia(media).serialize(),
            foreground: {
              panels: [app.ui.ImmersivePanelFactory.createInstance().serialize()]
            }
          }];
        }

        return _get(ImmersiveBuilder.prototype.__proto__ || Object.getPrototypeOf(ImmersiveBuilder.prototype), 'render', this).call(this);
      }
    }, {
      key: 'postCreate',
      value: function postCreate(node) {
        _get(ImmersiveBuilder.prototype.__proto__ || Object.getPrototypeOf(ImmersiveBuilder.prototype), 'postCreate', this).call(this, node);

        //
        // Builder panel
        //

        this._builderPanelNode = this._node.find('.builder-panel');
        this._builderPanel = new _ImmersiveBuilderPanel2.default({
          container: this._builderPanelNode,
          selectView: this._selectView.bind(this),
          addView: this._addEmptyView.bind(this),
          deleteView: this._deleteView.bind(this),
          duplicateView: this._duplicateView.bind(this),
          updateTransition: this._updateTransition.bind(this),
          organize: this._organizeByIds.bind(this)
        });

        //
        // View title
        //

        this._node.find('.background-title h2').attr('contenteditable', true).attr('placeholder', 'Enter a title...').on('blur keyup', function () {
          this.serialize();
          this._onContentChange();
        }.bind(this)).on('paste', function () {
          setTimeout(function () {
            this._node.find('.background-title h2').html($('<div>' + this._node.find('.background-title h2').text()).text());
            this.serialize();
            this._onContentChange();
          }.bind(this), 0);
        }.bind(this)).keydown(function (e) {
          // Do not allow enter key
          if (e.keyCode === 13) {
            // If pressing enter insert <br> instead of default behavior that is div
            //document.execCommand('insertHTML', false, '<br><br>');
            return false;
          }

          // Prevent ctrl + B/I/U or ctrl + b/i/u
          if (e.ctrlKey || e.metaKey) {
            var key = e.keyCode;
            if (key == 66 || key == 98 || key == 73 || key == 105 || key == 85 || key == 117) {
              return false;
            }
          }
        });

        //
        // Add section menu
        //

        this._addMenu.postCreate({
          container: this._node.find('.builder-section-add-menu'),
          sectionContainer: this._node
        });

        this._updateBuilderPanel();
      }
    }, {
      key: 'update',
      value: function update() {
        // In the case user edit location on the second view of a consecutive map
        //  the transition will switch to None through super.update() but the swipe will hang
        //  so force a reset
        //  TODO: should call performAction?
        var activeMedia = this._medias[this._currentViewIndex - 1];
        if (activeMedia && activeMedia.type == 'webmap') {
          activeMedia.resetSwipe();
        }

        _get(ImmersiveBuilder.prototype.__proto__ || Object.getPrototypeOf(ImmersiveBuilder.prototype), 'update', this).call(this);
        this._updateBuilderPanel();
        this._onContentChange();
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        this._latestOnScrollParams = params;
        this._currentScrollPosition = params.currentSectionScroll;

        var viewIndexBeforeUpdate = this._currentViewIndex;

        _get(ImmersiveBuilder.prototype.__proto__ || Object.getPrototypeOf(ImmersiveBuilder.prototype), 'onScroll', this).call(this, params);

        if (viewIndexBeforeUpdate != this._currentViewIndex) {
          this._builderPanel.selectView(this._currentViewIndex - 1);

          // Hide/show the panels depending on background configuration for that view
          if (app.isInBuilder) {
            var media = this._medias[this._currentViewIndex - 1];
            if (media) {
              this._node.toggleClass('hide-foreground', media.isConfigActive());
              this._node.find('.media-media').removeClass('appearance-invite');
            }
          }
        }
      }
    }, {
      key: 'navigateToViewByIndex',
      value: function navigateToViewByIndex() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        _get(ImmersiveBuilder.prototype.__proto__ || Object.getPrototypeOf(ImmersiveBuilder.prototype), 'navigateToViewByIndex', this).call(this, params);
        this._builderPanel.selectView(params.index);
      }
    }, {
      key: 'getPreviewThumbnail',
      value: function getPreviewThumbnail() {
        if (this._medias.length) {
          return this._medias[0].getPreviewThumbnail();
        }

        return '';
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        var text = '';

        if (this._node.find('.background-title h2').text()) {
          return this._node.find('.background-title h2').text();
        }

        if (this._panels.length) {
          return this._panels[0].getPreviewText();
        }

        return text;
      }
    }, {
      key: 'getPreviewIcon',
      value: function getPreviewIcon() {
        return 'glyphicon glyphicon-random';
      }
    }, {
      key: 'onUpdatePanelLayout',
      value: function onUpdatePanelLayout(layout) {
        this._node.removeClass('layout-scroll-full layout-scroll-partial').addClass('layout-' + layout);

        this._node.find('.imm-panel').css({
          opacity: layout == 'scroll-full' ? 'inherit' : 0,
          transform: ''
        });

        for (var i = 0; i < this._panels.length; i++) {
          var panel = this._panels[i];

          panel.layout = layout;

          if (i == this._currentViewIndex - 1) {
            panel.updatePosition({
              currentSectionScroll: this._currentScrollPosition
            });
          }
        }
      }
    }, {
      key: 'focus',
      value: function focus() {
        setTimeout(function () {
          if (this._panels[0]) {
            this._panels[0].focus();
          }
        }.bind(this), 50);
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        var views = [];

        for (var i = 0; i < this._medias.length; i++) {
          var media = this._medias[i],
              panel = this._panels[i],
              transition = this._transitions[i];

          views.push({
            transition: transition,
            background: media.serialize(),
            foreground: {
              panels: [panel.serialize()]
            }
          });

          // Title
          if (i === 0) {
            views[0].foreground.title = {
              value: $('<div>' + this._node.find('.background-title h2').text() + '</div>').text(),
              global: true
            };
          }
        }

        this._section.views = views;

        return _lang2.default.clone(this._section);
      }
    }, {
      key: 'setBookmark',
      value: function setBookmark(bookmark) {
        this._section.bookmark = {
          enabled: bookmark.status == 'visible',
          title: bookmark.bookmark
        };
      }
    }, {
      key: '_onContentChange',
      value: function _onContentChange() {
        this.serialize();
        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: '_updateBuilderPanel',
      value: function _updateBuilderPanel() {
        if (!this._builderPanel) {
          return;
        }

        var transitionsInfos = [];

        for (var i = 0; i < this._medias.length; i++) {
          transitionsInfos.push(this._getTransitionInfo(i));
        }

        this._builderPanel.update({
          medias: this._medias,
          panels: this._panels,
          transitions: this._transitions,
          transitionsInfos: transitionsInfos
        });
      }
    }, {
      key: '_onToggleMediaConfig',
      value: function _onToggleMediaConfig() {
        this._node.toggleClass('hide-foreground');
      }
    }, {
      key: '_onMediaConfigAction',
      value: function _onMediaConfigAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.action || !params.media) {
          return;
        }

        if (params.action == 'swap') {
          var mediaIsEmpty = params.media.serialize().type == 'empty';

          app.builder.mediaPicker.open({
            mode: mediaIsEmpty ? 'add' : 'edit',
            media: mediaIsEmpty ? null : params.media.serialize()
          }).then(function (newMedia) {
            if (params.media.type != 'empty') {
              this._onToggleMediaConfig();
            }

            this._onEditMedia(params.media, newMedia);
          }.bind(this), function () {
            //
          });
        }
      }
    }, {
      key: '_onMediaConfigChange',
      value: function _onMediaConfigChange() {
        this.update();
      }
    }, {
      key: '_onEditMedia',
      value: function _onEditMedia(media, newMediaJSON) {
        console.log(media, newMediaJSON);

        var mediaIndex = this._medias.indexOf(media),
            newMedia = _Common2.default.initMedia(newMediaJSON, this._mediaCache);

        var isMediaAlreadyLoaded = this.isMediaAlreadyLoaded(newMediaJSON);
        if (!isMediaAlreadyLoaded) {
          media.getNode().after(_Common2.default.renderBackground({
            media: newMedia,
            transition: this._transitions[mediaIndex]
          }));
        }

        newMedia.postCreate({
          container: this._node,
          delayBuilderInit: false,
          onToggleMediaConfig: this._onToggleMediaConfig.bind(this),
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onConfigChange: app.isInBuilder ? this._onMediaConfigChange.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          // TODO: for video, need to goes away
          sectionType: 'immersive'
        });

        if (!isMediaAlreadyLoaded) {
          newMedia.load({
            isBuilderAdd: true
          });
        }

        media.destroy();

        this._medias[mediaIndex] = newMedia;

        this.update();
        newMedia.getNode().addClass('active');
      }
    }, {
      key: '_selectView',
      value: function _selectView(index) {
        console.log('selectView:', index);

        if (index != this._currentViewIndex - 1) {
          this.navigateToViewByIndex({
            index: index,
            animate: false
          });
        }
      }
    }, {
      key: '_addEmptyView',
      value: function _addEmptyView(index) {
        console.log('addEmptyView:', index);

        var defaultTransition = 'fade-fast';

        //
        // Media
        //

        var media = _Common2.default.initMedia({
          type: 'empty',
          empty: 'empty'
        });

        this._medias.splice(index + 1, 0, media);
        this._medias[index].getNode().after(_Common2.default.renderBackground({
          media: media,
          transition: defaultTransition
        }));
        media.postCreate({
          container: this._node,
          delayBuilderInit: true,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onConfigChange: app.isInBuilder ? this._onMediaConfigChange.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          // TODO: for video, need to goes away
          sectionType: 'immersive'
        });

        //
        // Panel
        //

        var panel = app.ui.ImmersivePanelFactory.duplicateWithoutContent(this._panels[index] ? this._panels[index].serialize() : null, {
          onUpdateLayout: this.onUpdatePanelLayout.bind(this),
          onChange: this._onContentChange.bind(this)
        });

        this._panels.splice(index + 1, 0, panel);
        this._node.find('.foreground .imm-panel').eq(index).after(panel.render());
        // TODO: should work like this (TODO: also do the same for media)
        //panel.postCreate(this._node.find('.foreground .imm-panel').eq(index + 1));
        panel.postCreate({
          container: this._node,
          mediaConfigurationTabs: this.MEDIA_BUILDER_TABS_PANEL
        });

        panel.focus();

        //
        // Transition
        //

        this._transitions.splice(index + 1, 0, defaultTransition);

        //
        // Navigate to the new view
        //

        this.update();

        var currentViewIndexBeforeReset = this._currentViewIndex;
        this._currentViewIndex = -1;

        this.navigateToViewByIndex({
          index: index + 1,
          animate: false
        });

        // If adding a view before active view this is necessary
        //  as the new view is at the same position than current view
        //  the onScroll event may never get to Immersive otherwise
        if (index + 1 == currentViewIndexBeforeReset - 1) {
          app.ui.update({
            forceUpdate: true
          });
        }
      }
    }, {
      key: '_addView',
      value: function _addView() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        console.log('addView:', params);

        var index = params.index,
            media = params.media,
            panel = params.panel,
            transition = params.transition;

        if (index === undefined || !media || !panel || !transition) {
          return;
        }

        //
        // Media
        //

        media = _Common2.default.initMedia(media, this._mediaCache);
        this._medias.splice(index, 0, media);

        var isMediaAlreadyLoaded = this.isMediaAlreadyLoaded(media.serialize());
        if (!isMediaAlreadyLoaded) {
          this._medias[index - 1].getNode().after(_Common2.default.renderBackground({
            media: media,
            transition: transition
          }));
        }

        media.postCreate({
          container: this._node,
          delayBuilderInit: false,
          onToggleMediaConfig: this._onToggleMediaConfig.bind(this),
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onConfigChange: app.isInBuilder ? this._onMediaConfigChange.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          // TODO: for video, need to goes away
          sectionType: 'immersive'
        });

        //
        // Panel
        //

        panel = app.ui.ImmersivePanelFactory.createInstance(panel, {
          onUpdateLayout: this.onUpdatePanelLayout.bind(this),
          onChange: this._onContentChange.bind(this)
        });
        this._panels.splice(index, 0, panel);
        this._node.find('.foreground .imm-panel').eq(index - 1).after(panel.render());
        // TODO: should work like this (TODO: also do the same for media)
        //panel.postCreate(this._node.find('.foreground .imm-panel').eq(index + 1));
        panel.postCreate({
          container: this._node,
          mediaConfigurationTabs: this.MEDIA_BUILDER_TABS_PANEL
        });

        //
        // Transition
        //

        this._transitions.splice(index + 1, 0, transition);

        //
        // Navigate to the new view
        //

        this.update();
        this.navigateToViewByIndex({
          index: index + 1,
          animate: false
        });
      }
    }, {
      key: '_deleteView',
      value: function _deleteView(index) {
        console.log('deleteView:', index);

        if (this._medias.length === 1) {
          app.Controller.deleteActiveSection();
          return;
        }

        var undoData = {
          index: index,
          panel: this._panels[index].serialize(),
          media: this._medias[index].serialize(),
          transition: this._transitions[index]
        };

        if (this.isMediaUniqueInSection(this._medias[index].serialize())) {
          this._node.find('.background').eq(index).remove();
        }
        this._node.find('.imm-panel').eq(index).remove();

        this._panels.splice(index, 1);
        this._medias.splice(index, 1);
        this._transitions.splice(index, 1);

        this.update();

        // Deleting current view
        if (index == this._currentViewIndex - 1) {
          if (index > 0) {
            this.navigateToViewByIndex({
              index: index - 1,
              animate: false
            });
          } else if (this._medias.length) {
            this.navigateToViewByIndex({
              index: index,
              animate: false
            });
          }
        }
        // Delete a view before the actual one, need to navigate to
        //  the actual section as the scroll position change
        else if (index < this._currentViewIndex - 1) {
            var currentViewIndexBeforeReset = this._currentViewIndex;

            this.navigateToViewByIndex({
              index: currentViewIndexBeforeReset - 2,
              animate: false
            });
          }

        // As the new view is at the same position than current view
        //  the onScroll event may never get to Immersive otherwise
        this._currentViewIndex = -1;
        app.ui.update({
          forceUpdate: true
        });

        //
        // Undo
        //

        var undoNotification = new _Undo2.default({
          container: this._node,
          label: 'You deleted a view', // TODO
          positionTop: 70
        });

        undoNotification.display().then(function () {
          this._addView(undoData);
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: '_duplicateView',
      value: function _duplicateView(index) {
        console.log('duplicateView:', index);

        var transition = this._transitions[index];

        //
        // Media
        //

        var newMedia = app.ui.MediaFactory.createInstance(this._medias[index].serialize(), this._mediaCache);
        this._medias.splice(index + 1, 0, newMedia);

        var isMediaAlreadyLoaded = this.isMediaAlreadyLoaded(newMedia.serialize());
        if (!isMediaAlreadyLoaded) {
          if (newMedia.type == 'image') {
            transition = 'none';
          }

          this._medias[index].getNode().after(_Common2.default.renderBackground({
            media: newMedia,
            transition: transition
          }));
        }

        newMedia.postCreate({
          container: this._node,
          delayBuilderInit: false,
          onToggleMediaConfig: this._onToggleMediaConfig.bind(this),
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          onConfigChange: app.isInBuilder ? this._onMediaConfigChange.bind(this) : null,
          builderConfigurationTabs: this.MEDIA_BUILDER_TABS_BACKGROUND,
          // TODO: for video, need to goes away
          sectionType: 'immersive'
        });

        //
        // Panel
        //

        var newPanel = app.ui.ImmersivePanelFactory.duplicateWithoutContent(this._panels[index].serialize(), {
          onUpdateLayout: this.onUpdatePanelLayout.bind(this),
          onChange: this._onContentChange.bind(this)
        });

        this._panels.splice(index + 1, 0, newPanel);
        this._node.find('.foreground .imm-panel').eq(index).after(newPanel.render());
        // TODO: should work like this (TODO: also do the same for media)
        //panel.postCreate(this._node.find('.foreground .imm-panel').eq(index + 1));
        newPanel.postCreate({
          container: this._node,
          mediaConfigurationTabs: this.MEDIA_BUILDER_TABS_PANEL
        });

        newPanel.focus();

        //
        // Transition
        //

        this._transitions.splice(index + 1, 0, transition);

        //
        // Navigate to the new view
        //

        this.update();

        var currentViewIndexBeforeReset = this._currentViewIndex;
        this._currentViewIndex = -1;

        this.navigateToViewByIndex({
          index: index + 1,
          animate: false
        });

        // If duplicating a view before active view this is necessary
        //  as the new view is at the same position than current view
        //  the onScroll event may never get to Immersive otherwise
        if (index + 1 == currentViewIndexBeforeReset - 1) {
          app.ui.update({
            forceUpdate: true
          });
        }
      }
    }, {
      key: '_updateTransition',
      value: function _updateTransition(index, transitionType) {
        console.log('updateTransition:', index, transitionType);

        this._applyViewTransition({
          media: this._medias[index],
          prevTransition: this._transitions[index],
          newTransition: transitionType
        });

        this._transitions[index] = transitionType;

        this.update();
        this.onScroll(this._latestOnScrollParams);
      }
    }, {
      key: '_applyViewTransition',
      value: function _applyViewTransition() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.media) {
          return;
        }

        var backgroundNode = params.media.getNode();

        if (params.prevTransition && params.newTransition) {
          backgroundNode.css('clip', '').removeClass('transition-' + params.prevTransition);

          // The update is performed differently depending on the target transition
          //  to give user a preview feel
          if (params.newTransition == 'fade-slow' || params.newTransition == 'fade-fast') {
            this._node.addClass('disable-transition');

            backgroundNode.removeClass('active').addClass('transition-' + params.newTransition);

            setTimeout(function () {
              this._node.removeClass('disable-transition');
              backgroundNode.addClass('active');
            }.bind(this), 10);
          } else {
            backgroundNode.addClass('transition-' + params.newTransition);
          }
        } else {
          console.error('TODO');
        }
      }
    }, {
      key: '_organizeByIds',
      value: function _organizeByIds(viewIds) {
        var viewIndexes = this._getViewsIndexesByIds(viewIds);
        this._organizeByIndexes(viewIndexes, true);
      }
    }, {
      key: '_organizeByIndexes',
      value: function _organizeByIndexes(viewIndexes, showUndo) {
        console.log('Organize:', viewIndexes);

        //
        // Check if the specified new order require a change
        //

        var newViewsAlreadySorted = true;

        for (var i = 0; i < viewIndexes.length - 1; i++) {
          if (viewIndexes[i] > viewIndexes[i + 1]) {
            newViewsAlreadySorted = false;
            break;
          }
        }

        if (newViewsAlreadySorted) {
          return;
        }

        var newMedias = [],
            newPanels = [],
            newTransitions = [],
            newCurrentViewIndex = -1;

        var backupMedias = [],
            backupPanels = [],
            backupTransitions = [],
            currentIndexBackup = this._currentViewIndex;

        for (var _i = 0; _i < this._medias.length; _i++) {
          backupMedias[_i] = this._medias[_i];
          backupPanels[_i] = this._panels[_i];
          backupTransitions[_i] = this._transitions[_i];
        }

        // Reorder the sections object
        for (var _i2 = 0; _i2 < viewIndexes.length; _i2++) {
          var viewIndex = viewIndexes[_i2];

          newMedias.push(this._medias[viewIndex]);
          newPanels.push(this._panels[viewIndex]);
          newTransitions.push(this._transitions[viewIndex]);

          if (viewIndex == this._currentViewIndex - 1) {
            newCurrentViewIndex = _i2;
          }
        }

        // Persist
        this._medias = newMedias;
        this._panels = newPanels;
        this._transitions = newTransitions;

        // Reorder the DOM for panels
        for (var _viewIndex = this._panels.length - 1; _viewIndex >= 0; _viewIndex--) {
          var panel = this._panels[_viewIndex];
          this._node.find('.foreground').prepend(panel._node);
        }

        this.update();

        // Navigate to new position of current view
        if (newCurrentViewIndex != -1) {
          setTimeout(function () {
            this.navigateToViewByIndex({
              index: newCurrentViewIndex,
              animate: false
            });
          }.bind(this), 50);
        }

        //
        // Undo
        //

        if (showUndo) {
          var undoNotification = new _Undo2.default({
            container: this._node,
            label: 'You organized the views', // TODO
            positionTop: 70
          });

          undoNotification.display().then(function () {
            // Sett builder/Controller this is not working
            //this._organizeByIndexes(viewIndexes, false);

            this._medias = backupMedias;
            this._panels = backupPanels;
            this._transitions = backupTransitions;

            // Reorder the DOM for panels
            for (var _viewIndex2 = this._panels.length - 1; _viewIndex2 >= 0; _viewIndex2--) {
              var panel = this._panels[_viewIndex2];
              this._node.find('.foreground').prepend(panel._node);
            }

            this.update();

            // Navigate to new position of current view
            if (currentIndexBackup != this._currentViewIndex) {
              setTimeout(function () {
                this.navigateToViewByIndex({
                  index: currentIndexBackup - 1,
                  animate: false
                });
              }.bind(this), 50);
            }
          }.bind(this), function () {
            //
          });
        }
      }
    }, {
      key: '_getViewsIndexesByIds',
      value: function _getViewsIndexesByIds(viewsIds) {
        var viewsIndexes = [];

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = viewsIds[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var viewId = _step.value;

            for (var viewIndex = 0; viewIndex < this._panels.length; viewIndex++) {
              var panel = this._panels[viewIndex];
              if (panel.id == viewId) {
                viewsIndexes.push(viewIndex);
              }
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return viewsIndexes;
      }
    }]);

    return ImmersiveBuilder;
  }(_Immersive3.default);

  exports.default = ImmersiveBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=ImmersiveBuilder.js.map
;

define('lib-build/less!storymaps-react/tpl/view/section/CreditsBuilder',[],function(){});
define('storymaps-react/tpl/view/section/CreditsBuilder',['module', 'exports', './Credits', './builder/AddMenu', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'storymaps-react/common/builder/textEditor/MediumEditorWrapper', 'dojo/_base/lang', 'lib-build/less!./CreditsBuilder'], function (module, exports, _Credits2, _AddMenu, _app, _MediumEditorWrapper, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Credits3 = _interopRequireDefault(_Credits2);

  var _AddMenu2 = _interopRequireDefault(_AddMenu);

  var _app2 = _interopRequireDefault(_app);

  var _MediumEditorWrapper2 = _interopRequireDefault(_MediumEditorWrapper);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var DEFAULT_BACKGROUND_COLOR = '#000';

  var CreditsBuilder = function (_Credits) {
    _inherits(CreditsBuilder, _Credits);

    function CreditsBuilder(section) {
      _classCallCheck(this, CreditsBuilder);

      var _this = _possibleConstructorReturn(this, (CreditsBuilder.__proto__ || Object.getPrototypeOf(CreditsBuilder)).call(this, section));

      _this._addMenu = new _AddMenu2.default({
        buttons: ['sequence', 'title', 'immersive']
      });
      return _this;
    }

    _createClass(CreditsBuilder, [{
      key: 'render',
      value: function render() {
        if (!this._section.background) {

          this._section = {
            type: 'credits',
            layout: 'credits-1',
            background: {
              type: 'color',
              color: {
                value: DEFAULT_BACKGROUND_COLOR
              }
            },
            foreground: {
              panels: [{
                type: 'blocks',
                blocks: [{
                  type: 'text',
                  text: {
                    value: '<p class="block" style="text-align: center;"></p>'
                  }
                }]
              }, {
                type: 'credits',
                credits: []
              } /*,
                {
                 type: 'discover',
                 discover: {
                   title: '',
                   items: [
                     {
                       title: 'foo',
                       thumbnail: 'http:// ... .jpg',
                       link: 'http://myotherstory'
                     }
                   ]
                 }
                }*/
              ]
            }
          };
        }

        return _get(CreditsBuilder.prototype.__proto__ || Object.getPrototypeOf(CreditsBuilder.prototype), 'render', this).call(this);
      }
    }, {
      key: 'postCreate',
      value: function postCreate(params) {
        _get(CreditsBuilder.prototype.__proto__ || Object.getPrototypeOf(CreditsBuilder.prototype), 'postCreate', this).call(this, params);

        this._addMenu.postCreate({
          container: this._node.find('.builder-section-add-menu'),
          sectionContainer: this._node
        });

        // find children of .credits that are class blocks.
        // whichever index they are of the parent is whichever index of this._panels you need to instantiate an editor on.
        var blocks = this._node.find('.credits > .blocks');

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = blocks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var block = _step.value;

            // get the index
            var index = $(block).index();

            this._panels[index].editor = new _MediumEditorWrapper2.default({
              node: $(block),
              addMedia: function addMedia() {},
              style: 'compact',
              addButtons: null,
              authorizedMedia: [],
              placeholder: _app2.default.builder.credits.introductionPlaceholder
            });
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }, {
      key: 'focus',
      value: function focus() {
        setTimeout(function () {
          if (this._panels[0] && this._panels[0].editor) {
            this._panels[0].editor.focus();
          }
        }.bind(this), 50);
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        var panels = [];

        // loop through each panel, serializing each one and writing the results to the panels object.
        for (var i = 0; i < this._panels.length; i++) {
          var panel = this._panels[i];
          if (panel.type === 'credits') {
            // have to get the serialize method from somewhere...
            panels.push(panel.credits.serialize());
          } else if (panel.type === 'blocks') {
            panels.push(this.serializeBlocks(panel));
          }
        }

        // write the panels to the section (via the foreground)
        this._section.foreground.panels = panels;

        return _lang2.default.clone(this._section);
      }
    }, {
      key: 'serializeBlocks',
      value: function serializeBlocks(panel) {
        var blocks = [];

        if (panel.editor) {
          blocks = panel.editor.serialize();

          for (var i = 0; i < blocks.length; i++) {
            var editorBlock = blocks[i];
            // if it's media, it's at a "deeper level" of serialization.
            if (editorBlock.type === 'media') {
              var block = this.findBlock(panel, editorBlock.id);
              if (block) {
                blocks[i] = block.serialize();
              }
            }
          }

          panel.blocks = blocks;
        }

        return {
          type: 'blocks',
          blocks: blocks
        };
      }
    }, {
      key: 'findBlock',
      value: function findBlock(panel, id) {
        if (!id) {
          return null;
        }

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = panel.blocks[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var block = _step2.value;

            if (block._domID === id) {
              return block;
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    }]);

    return CreditsBuilder;
  }(_Credits3.default);

  exports.default = CreditsBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=CreditsBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/builder/CreditsPlaceholder', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, buffer = "<div class=\"section section-layout-credits-placeholder\">\r\n\r\n  ";
  stack1 = ((helper = (helper = helpers.background || (depth0 != null ? depth0.background : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"background","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n\r\n  <div class=\"foreground\">\r\n    <button class=\"btn btn-primary btn-lg btn-add-credits\">Add a credits section</button>\r\n  </div>\r\n\r\n  <div class=\"builder-section-add-menu\"></div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/builder/CreditsPlaceholder',[],function(){});
define('storymaps-react/tpl/view/section/builder/CreditsPlaceholder',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', './AddMenu', 'lib-build/hbars!./CreditsPlaceholder', 'lib-build/less!./CreditsPlaceholder'], function (module, exports, _Common, _UI, _AddMenu, _CreditsPlaceholder) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  var _AddMenu2 = _interopRequireDefault(_AddMenu);

  var _CreditsPlaceholder2 = _interopRequireDefault(_CreditsPlaceholder);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var CreditsPlaceholder = function () {
    function CreditsPlaceholder() {
      _classCallCheck(this, CreditsPlaceholder);

      this.type = 'credits-placeholder';
      this.id = _UI2.default.getUID();

      this._node = null;

      this._addMenu = new _AddMenu2.default({
        buttons: ['sequence', 'title', 'immersive']
      });
    }

    _createClass(CreditsPlaceholder, [{
      key: 'render',
      value: function render() {
        return (0, _CreditsPlaceholder2.default)({
          background: _Common2.default.renderBackground({
            media: _Common2.default.initMedia({
              type: 'color',
              color: {
                value: '#777'
              }
            })
          })
        });
      }
    }, {
      key: 'postCreate',
      value: function postCreate(sectionContainer) {
        this._node = sectionContainer;

        this._addMenu.postCreate({
          container: this._node.find('.builder-section-add-menu'),
          sectionContainer: this._node
        });

        this._node.find('.btn-add-credits').click(this._onClickAddCredits.bind(this));
      }
    }, {
      key: 'resize',
      value: function resize() {
        //
      }
    }, {
      key: 'onScroll',
      value: function onScroll() {
        //
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        return null;
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        return [];
      }
    }, {
      key: 'setVisibility',
      value: function setVisibility(visibility) {
        this._node.toggleClass('hidden', !visibility);
      }
    }, {
      key: '_onClickAddCredits',
      value: function _onClickAddCredits() {
        app.Controller.addSection({
          type: 'credits',
          index: this._node.index()
        });
      }
    }]);

    return CreditsPlaceholder;
  }();

  exports.default = CreditsPlaceholder;
  module.exports = exports['default'];
});
//# sourceMappingURL=CreditsPlaceholder.js.map
;
define('storymaps-react/tpl/view/section/FactoryBuilder',['module', 'exports', './FactoryViewer', './Cover/CoverBuilder', './SequenceBuilder', './TitleBuilder', './Immersive/ImmersiveBuilder', './CreditsBuilder', './builder/CreditsPlaceholder'], function (module, exports, _FactoryViewer2, _CoverBuilder, _SequenceBuilder, _TitleBuilder, _ImmersiveBuilder, _CreditsBuilder, _CreditsPlaceholder) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _FactoryViewer3 = _interopRequireDefault(_FactoryViewer2);

  var _CoverBuilder2 = _interopRequireDefault(_CoverBuilder);

  var _SequenceBuilder2 = _interopRequireDefault(_SequenceBuilder);

  var _TitleBuilder2 = _interopRequireDefault(_TitleBuilder);

  var _ImmersiveBuilder2 = _interopRequireDefault(_ImmersiveBuilder);

  var _CreditsBuilder2 = _interopRequireDefault(_CreditsBuilder);

  var _CreditsPlaceholder2 = _interopRequireDefault(_CreditsPlaceholder);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var FactoryBuilder = function (_FactoryViewer) {
    _inherits(FactoryBuilder, _FactoryViewer);

    function FactoryBuilder() {
      _classCallCheck(this, FactoryBuilder);

      return _possibleConstructorReturn(this, (FactoryBuilder.__proto__ || Object.getPrototypeOf(FactoryBuilder)).apply(this, arguments));
    }

    _createClass(FactoryBuilder, null, [{
      key: 'getClasses',
      value: function getClasses() {
        return {
          Cover: _CoverBuilder2.default,
          Sequence: _SequenceBuilder2.default,
          Title: _TitleBuilder2.default,
          Immersive: _ImmersiveBuilder2.default,
          Credits: _CreditsBuilder2.default,
          CreditsPlaceholder: _CreditsPlaceholder2.default
        };
      }
    }]);

    return FactoryBuilder;
  }(_FactoryViewer3.default);

  exports.default = FactoryBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=FactoryBuilder.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/Immersive/Panel', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div class=\""
    + escapeExpression(((helper = (helper = helpers.classes || (depth0 != null ? depth0.classes : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"classes","hash":{},"data":data}) : helper)))
    + "\" id=\""
    + escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"id","hash":{},"data":data}) : helper)))
    + "\">\r\n  <div class=\"blocksWrapper\">\r\n    <div class=\"blocks\">\r\n      ";
  stack1 = ((helper = (helper = helpers.blocks || (depth0 != null ? depth0.blocks : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"blocks","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n    </div>\r\n    <div class=\"builder-ui panel-cfg\"></div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/Immersive/Panel',[],function(){});
define('storymaps-react/tpl/view/section/Immersive/Panel',['module', 'exports', 'storymaps/tpl/view/section/Common', 'storymaps/tpl/utils/UI', 'lib-build/hbars!./Panel', 'lib-build/less!./Panel'], function (module, exports, _Common, _UI, _Panel) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Common2 = _interopRequireDefault(_Common);

  var _UI2 = _interopRequireDefault(_UI);

  var _Panel2 = _interopRequireDefault(_Panel);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var BUILDER_PANEL_HEIGHT = 125;

  var Panel = function () {
    function Panel(panel) {
      _classCallCheck(this, Panel);

      this.id = _UI2.default.getUID();
      this.layout = panel.layout;

      this._settings = panel.settings;
      this._blocksJSON = panel.blocks;
      this._blocks = null;

      this._node = null;
    }

    _createClass(Panel, [{
      key: 'render',
      value: function render() {
        var blocksRender = _Common2.default.renderBlocks(this._blocksJSON, {});

        this._blocks = blocksRender.blocks;

        return (0, _Panel2.default)({
          id: this.id,
          classes: this.getClasses(),
          blocks: blocksRender.output
        });
      }
    }, {
      key: 'load',
      value: function load() {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._blocks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var block = _step.value;

            block.load();
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }, {
      key: 'postCreate',
      value: function postCreate() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.container) {
          return;
        }

        this._node = params.container.find('#' + this.id);

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._blocks[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var block = _step2.value;

            block.postCreate({
              container: this._node,
              onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
              onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
              builderConfigurationTabs: this._mediaConfigurationTabs
            });
          }

          // In builder - hide the panel if panel has only one empty text block
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        if (!app.isInBuilder && this._blocks.length == 1 && this._blocks[0].type == 'text' && !this._blocks[0].getPreviewText()) {
          this._node.find('.blocksWrapper').hide();
        }
      }
    }, {
      key: 'getClasses',
      value: function getClasses() {
        var classes = ['imm-panel'];

        if (this._settings) {
          classes.push('style-' + this._settings.style);
          classes.push('theme-' + this._settings.theme);
          classes.push('placement-' + this._settings['position-x']);
          classes.push('size-' + this._settings.size);
        }

        return classes.join(' ');
      }
    }, {
      key: 'updatePosition',
      value: function updatePosition(params) {
        if (!params.currentSectionScroll) {
          return;
        }

        // windowHeight as this is in Immersive and scroll beneath the header and builder panel
        var sectionHeight = app.display.windowHeight,
            scrollTop = params.currentSectionScroll % sectionHeight,
            scrollProgress = scrollTop / sectionHeight,
            panelPos = null,
            panelOpa = 1;

        /*
         * Scroll full is a simple postion:relative element that scroll along with the page
         */

        if (this.layout == 'scroll-partial') {
          // Move the panel around the middle of the viewPort
          // Goal is that the panel is fully opaque at the middle of the screen
          // The panel only scroll over sectionHeight / 4
          // 100px is 1/2 of panel height, it should be replaced a real measurement TODO

          // Keep the header on purpose
          var visibleArea = app.display.windowHeight;
          if (app.isInBuilder) {
            visibleArea -= BUILDER_PANEL_HEIGHT;
          }

          var middlePositionY = visibleArea / 2,
              panelHalfHeight = 75;

          panelPos = middlePositionY + panelHalfHeight - scrollProgress * (sectionHeight / 4);

          // Should use GSOP or some other lib to compute this
          if (scrollProgress <= 0.5) {
            panelOpa = scrollProgress * 2 * 1.5; // 1.5 acceleration factor
          } else {
            panelOpa = 1 - (scrollProgress - 0.5) * 2 / 1.5;
          }

          if (panelOpa > 1) {
            panelOpa = 1;
          } else if (panelOpa < 0) {
            panelOpa = 0;
          }

          if (panelOpa > 0.9) {
            panelOpa = 1;
          }

          this._node.parent().find('.imm-panel').css({
            transform: 'inherit',
            opacity: 0,
            visibility: 'hidden'
          });
          this._node.css({
            transform: 'translateY(' + parseInt(panelPos) + 'px)',
            opacity: panelOpa,
            visibility: 'visible'
          });
        }
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        var arcgisContent = [];

        var _iteratorNormalCompletion3 = true;
        var _didIteratorError3 = false;
        var _iteratorError3 = undefined;

        try {
          for (var _iterator3 = this._blocks[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
            var block = _step3.value;

            arcgisContent.push.apply(arcgisContent, _toConsumableArray(block.getArcGISContent()));
          }
        } catch (err) {
          _didIteratorError3 = true;
          _iteratorError3 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion3 && _iterator3.return) {
              _iterator3.return();
            }
          } finally {
            if (_didIteratorError3) {
              throw _iteratorError3;
            }
          }
        }

        return arcgisContent;
      }
    }]);

    return Panel;
  }();

  exports.default = Panel;
  module.exports = exports['default'];
});
//# sourceMappingURL=Panel.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/section/Immersive/PanelBuilder', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<div class=\"builder-config-panel\">\r\n  <div class=\"panel-scrolling\">\r\n\r\n\r\n    <div class=\"panel-config-row\">\r\n\r\n      <div class=\"options-container panel-scrolling-placement\" data-option=\"position-x\">\r\n        <div class=\"column-label\">Position</div>\r\n        <div class=\"panel-column\">\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='left'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelAlignLeft.png\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='center'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelAlignCenter.png\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='right'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelAlignRight.png\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"options-container panel-scrolling-size\" data-option=\"size\">\r\n        <div class=\"column-label\">Size</div>\r\n        <div class=\"panel-column\">\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='small'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelWidthNarrow.png\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='medium'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelWidthMedium.png\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='large'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelWidthWide.png\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"panel-config-row\">\r\n\r\n      <div class=\"options-container panel-scrolling-theme\" data-option=\"theme\">\r\n        <div class=\"column-label\">Theme</div>\r\n        <div class=\"panel-column\">\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='black-over-white'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelThemeLight.png\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='white-over-black'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelThemeDark.png\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"options-container panel-scrolling-style\" data-option=\"style\">\r\n        <div class=\"column-label\">Background</div>\r\n        <div class=\"panel-column\">\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='background'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelBackgroundFill.png\" />\r\n            </div>\r\n          </div>\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='text-shadow'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelBackgroundShadow.png\" />\r\n            </div>\r\n          </div>\r\n          <!--\r\n          <div class=\"panel-cfg-item\">\r\n            <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='auto'>\r\n              <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelBackgroundAuto.png\" />\r\n            </div>\r\n          </div>\r\n          -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"row-scrolling column-label\">Scrolling (for all panels)</div>\r\n    <div class=\"options-container panel-scrolling-layout\" data-option=\"layout\">\r\n      <div class=\"panel-cfg-item\">\r\n        <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='scroll-full'>\r\n          <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelScrollFull.gif\" />\r\n        </div>\r\n      </div>\r\n      <div class=\"panel-cfg-item\">\r\n        <div class=\"panel-cfg-item-wrapper fa fa-check\" data-value='scroll-partial'>\r\n          <img class=\"panel-cfg-item-icon\" src=\"resources/tpl/builder/icons/immersive/panelScrollPartial.gif\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"builder-config-panel-btn\">\r\n  <i class=\"builder-invite-open fa fa-pencil\" aria-hidden=\"true\"></i>\r\n  <i class=\"builder-invite-close fa fa-check\" aria-hidden=\"true\"></i>\r\n</div>\r\n";
  },"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/section/Immersive/PanelBuilder',[],function(){});
define('storymaps-react/tpl/view/section/Immersive/PanelBuilder',['module', 'exports', './Panel', 'storymaps/tpl/view/section/Common', 'storymaps-react/common/builder/textEditor/MediumEditorWrapper', 'lib-build/hbars!./PanelBuilder', 'dojo/topic', 'dojo/_base/lang', 'lib-build/less!./PanelBuilder'], function (module, exports, _Panel2, _Common, _MediumEditorWrapper, _PanelBuilder, _topic, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Panel3 = _interopRequireDefault(_Panel2);

  var _Common2 = _interopRequireDefault(_Common);

  var _MediumEditorWrapper2 = _interopRequireDefault(_MediumEditorWrapper);

  var _PanelBuilder2 = _interopRequireDefault(_PanelBuilder);

  var _topic2 = _interopRequireDefault(_topic);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var PanelBuilder = function (_Panel) {
    _inherits(PanelBuilder, _Panel);

    function PanelBuilder(panel, callbacks) {
      _classCallCheck(this, PanelBuilder);

      var _this = _possibleConstructorReturn(this, (PanelBuilder.__proto__ || Object.getPrototypeOf(PanelBuilder)).call(this, panel));

      _this._callbacks = callbacks;
      _this._editor = null;
      _this._configPanelIsInit = false;
      _this._configPanelIsOpen = false;
      _this._configPanelMedia = null;
      _this._mediaConfigurationTabs = null;
      return _this;
    }

    _createClass(PanelBuilder, [{
      key: 'postCreate',
      value: function postCreate(params) {
        this._mediaConfigurationTabs = params.mediaConfigurationTabs;

        _get(PanelBuilder.prototype.__proto__ || Object.getPrototypeOf(PanelBuilder.prototype), 'postCreate', this).call(this, params);

        this._editor = new _MediumEditorWrapper2.default({
          node: this._node.find('.blocks'),
          addMedia: this.addMedia.bind(this),
          addButtons: ['text', 'media'],
          style: 'compact',
          authorizedMedia: ['image', 'video', 'webpage'],
          onChange: this._onContentChange.bind(this)
        });

        this.updateBuilderEditorPlacementRules();

        // Add Builder UI
        this._node.find('.panel-cfg').html((0, _PanelBuilder2.default)({}));

        // Register the minimum events
        this._node.find('.blocks').click(this.onPanelClick.bind(this));
        this._node.find('.builder-config-panel-btn').click(this.toggleBuilderPanel.bind(this));
      }
    }, {
      key: 'updatePosition',
      value: function updatePosition(params, isNavigatingAway) {
        _get(PanelBuilder.prototype.__proto__ || Object.getPrototypeOf(PanelBuilder.prototype), 'updatePosition', this).call(this, params, isNavigatingAway);
        this._editor.hideToolbars();

        // Update media cfg
        if (this._configPanelIsOpen) {
          // Close media cfg when changing view
          if (params.isNewView) {
            this._configPanelMedia.closeConfigPanel();
            this._configPanelIsOpen = false;
            this._configPanelMedia = null;
          } else {
            var mediaNode = this._configPanelMedia.getNode(),
                mediaBBOX = mediaNode[0].getBoundingClientRect();

            mediaNode.find('.media-cfg-panel').css('top', mediaBBOX.bottom);
          }
        }

        /*
         * Scroll-full panels in builder are hidden because the view panel has greater z-index
         * See other implementation in early May commit
         */
      }
    }, {
      key: 'focus',
      value: function focus() {}
      // Focusing the panel is not ideal as the placeholder will not reappear
      //  if user chose to set the media first
      // TODO
      /*
      setTimeout(function() {
        if (this._editor) {
          this._editor.focus();
        }
      }.bind(this), 50);
      */


      //
      // Config panel
      //

    }, {
      key: 'onPanelClick',
      value: function onPanelClick() {
        this._node.find('.panel-cfg').addClass('active');

        // In builder - a click on a scroll partial panel make it fully opaque
        if (this.layout == 'scroll-partial') {
          this._node.css('opacity', 1);
        }
      }
    }, {
      key: 'toggleBuilderPanel',
      value: function toggleBuilderPanel() {
        var builderInvite = this._node.find('.builder-config-panel-btn'),
            builderPanel = this._node.find('.builder-config-panel');

        // Init builder config panel
        if (!this._configPanelIsInit) {
          this._node.find('.panel-cfg-item').click(this.onOptionChange.bind(this));

          // Layout is not a regular setting
          var settings = Object.assign({}, this._settings, {
            'layout': this.layout
          });

          // Layout scroll full - hover
          this._node.find('.panel-cfg-item-wrapper[data-value="scroll-full"]').hover(function () {
            $(this).find('.panel-cfg-item-icon').attr('src', 'resources/tpl/builder/icons/immersive/panelScrollFullHover.gif');
          }, function () {
            $(this).find('.panel-cfg-item-icon').attr('src', 'resources/tpl/builder/icons/immersive/panelScrollFull.gif');
          });

          // Layout scroll partial - hover
          this._node.find('.panel-cfg-item-wrapper[data-value="scroll-partial"]').hover(function () {
            $(this).find('.panel-cfg-item-icon').attr('src', 'resources/tpl/builder/icons/immersive/panelScrollPartialHover.gif');
          }, function () {
            $(this).find('.panel-cfg-item-icon').attr('src', 'resources/tpl/builder/icons/immersive/panelScrollPartial.gif');
          });

          for (var option in settings) {
            var value = settings[option];
            var container = this._node.find('.options-container[data-option="' + option + '"]');
            container.find('.panel-cfg-item-wrapper[data-value="' + value + '"]').addClass('active');
          }
        }

        this._editor.hideToolbars();

        builderInvite.toggleClass('active');
        builderPanel.toggleClass('active');

        // Make scroll-partial panel fully opaque
        if (this.layout == 'scroll-partial') {
          if (builderPanel.hasClass('active')) {
            this._node.data('opacity-tmp', this._node.css('opacity'));
            this._node.css('opacity', 1);
          } else {
            this._node.css('opacity', this._node.data('opacity-tmp'));
            this._node.data('opacity-tmp', '');
          }
        }

        // Close media config
        if (this._configPanelIsOpen && this._configPanelMedia) {
          this._configPanelMedia.closeConfigPanel();
          this._configPanelIsOpen = false;
          this._configPanelMedia = null;
        }
      }
    }, {
      key: 'onOptionChange',
      value: function onOptionChange(e) {
        var target = $(e.target),
            optionsContainer = target.parents('.options-container'),
            option = optionsContainer.data('option'),
            value = target.data('value');

        if (!target.hasClass('panel-cfg-item-wrapper')) {
          return;
        }

        // Layout is a bit special as all panels of the view need to be updated
        //  this is managed by Immersive
        if (option == 'layout') {
          this._callbacks.onUpdateLayout(value);
        }

        optionsContainer.find('.panel-cfg-item-wrapper').removeClass('active');
        target.addClass('active');

        this._settings[option] = value;
        this.updateSettings();

        if (this.layout == 'scroll-partial') {
          this._node.css('opacity', 1);
        }

        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: 'updateSettings',
      value: function updateSettings() {
        this._node.removeClass().addClass(this.getClasses());

        this.updateBuilderEditorPlacementRules();
      }
    }, {
      key: 'updateBuilderEditorPlacementRules',
      value: function updateBuilderEditorPlacementRules() {
        var settings = this._settings,
            size = settings.size,
            placement = settings['position-x'],
            rules = {
          width: '',
          minWidth: '250px',
          maxWidth: '400px',
          left: '',
          marginLeft: '',
          marginRight: ''
        };

        if (size == 'small') {
          rules.width = 'calc((100vw - 250px) * .28)';
          rules.maxWidth = '300px';
        } else if (size == 'medium') {
          rules.width = 'calc((100vw - 250px) * .38)';
        } else if (size == 'large') {
          rules.width = 'calc((100vw - 250px) * .48)';
          rules.maxWidth = '600px';
        }

        if (placement == 'left') {
          rules.marginLeft = '30px';
        } else if (placement == 'center') {
          rules.minWidth = '';
          rules.maxWidth = '';
          rules.width = '';
        } else if (placement == 'right') {
          rules.marginRight = '30px';
          rules.left = 'inherit !important';
        }

        this._editor.setAddMenuPlacementRules(rules);
      }
    }, {
      key: '_onContentChange',
      value: function _onContentChange() {
        this.serialize();
        this._callbacks.onChange();
      }
    }, {
      key: 'addMedia',
      value: function addMedia() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.media) {
          return;
        }

        var block = _Common2.default.createBlock(params.media);

        this._blocks.push(block);

        // Load the block after the editor got a chance to add it
        // TODO!
        setTimeout(function () {
          block.postCreate({
            //container: params.previousNode.next()
            container: this._node,
            onToggleMediaConfig: this._onToggleMediaConfig.bind(this),
            onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
            builderConfigurationTabs: this._mediaConfigurationTabs
          });
          block.load();
        }.bind(this), 50);

        return block.render({
          placement: 'block'
        });
      }
    }, {
      key: '_onToggleMediaConfig',
      value: function _onToggleMediaConfig(media) {
        console.log('Immersive > toggle media config', media);

        var mediaCfg = media.getNode().find('.media-cfg-panel'),
            mediaNode = media.getNode()[0],
            mediaBBOX = mediaNode.getBoundingClientRect(),
            scrollOffset = 0;

        // Closing the media config
        if (!media.getNode().hasClass('config-panel-active')) {
          mediaCfg.css('top', '');
          this._configPanelIsOpen = false;
          this._configPanelMedia = null;
          return;
        }

        // The panel is closed but there is another one open
        if (this._configPanelIsOpen && this._configPanelMedia) {
          this._configPanelMedia.closeConfigPanel();
        }

        this._configPanelIsOpen = true;
        this._configPanelMedia = media;

        //
        // Position the media config panel
        //

        mediaCfg.css('top', mediaBBOX.bottom);

        //
        // Scroll the page if there isn't enough room for the builder panel
        //

        if (mediaBBOX.bottom + /* media panel */175 + /* view panel */125 > app.display.windowHeight) {
          scrollOffset = app.display.windowHeight - mediaBBOX.bottom - 175 - 125;
        }

        if (scrollOffset) {
          var currentScroll = document.body.scrollTop || document.documentElement.scrollTop;

          $('html,body').animate({
            scrollTop: currentScroll - scrollOffset + 10
          }, 150);
        }
      }
    }, {
      key: '_onEditMedia',
      value: function _onEditMedia(media, newMediaJSON) {
        var newMedia = _Common2.default.initMedia(newMediaJSON);

        media.getNode().before(newMedia.render({
          placement: 'block'
        }));

        // Delete actual background
        media.getNode().remove();

        newMedia.postCreate({
          container: this._node,
          onToggleMediaConfig: app.isInBuilder ? this._onToggleMediaConfig.bind(this) : null,
          onConfigAction: app.isInBuilder ? this._onMediaConfigAction.bind(this) : null,
          builderConfigurationTabs: this._mediaConfigurationTabs
        });

        // TODO: this may be an issue if picking a map/scene already present
        newMedia.load();

        this._blocks.splice(this._blocks.indexOf(media), 1, newMedia);
      }
    }, {
      key: '_onMediaConfigAction',
      value: function _onMediaConfigAction() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        if (!params.action || !params.media) {
          return;
        }

        if (params.action == 'remove') {
          params.media.remove();
          this._blocks.splice(this._blocks.indexOf(params.media), 1);
        } else if (params.action == 'swap') {
          app.builder.mediaPicker.open({
            mode: 'edit',
            media: params.media.serialize(),
            authorizedMedia: ['image', 'video', 'webpage']
          }).then(function (newMedia) {
            this._onToggleMediaConfig(params.media);
            this._onEditMedia(params.media, newMedia);
          }.bind(this), function () {
            //
          });
        }
      }
    }, {
      key: 'getPreviewText',
      value: function getPreviewText() {
        var text = '';

        if (this._blocksJSON && this._blocksJSON.length) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = this._blocksJSON[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var block = _step.value;

              if (block.type == 'text') {
                text = $(block.text.value).text();
                if (text) {
                  break;
                }
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        }

        return text;
      }
    }, {
      key: 'findBlock',
      value: function findBlock(id) {
        if (!id) {
          return null;
        }

        for (var i = 0; i < this._blocks.length; i++) {
          if (this._blocks[i]._domID == id) {
            return this._blocks[i];
          }
        }
      }
    }, {
      key: 'serialize',
      value: function serialize() {
        var blocksSerialized = [];

        if (this._editor) {
          blocksSerialized = this._editor.serialize();

          for (var i = 0; i < blocksSerialized.length; i++) {
            var editorBlock = blocksSerialized[i];

            if (editorBlock.type == 'media') {
              var block = this.findBlock(editorBlock.id);
              if (block) {
                blocksSerialized[i] = block.serialize();
              }
            }
          }

          this._blocksJSON = blocksSerialized;
        }

        return _lang2.default.clone({
          layout: this.layout,
          settings: this._settings,
          blocks: this._blocksJSON
        });
      }
    }]);

    return PanelBuilder;
  }(_Panel3.default);

  exports.default = PanelBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=PanelBuilder.js.map
;
define('storymaps/tpl/view/section/Immersive/PanelFactoryBuilder',[
  'storymaps-react/tpl/view/section/Immersive/PanelBuilder'
],
function(
  Panel
) {

  var DEFAULT_LAYOUT = 'scroll-full';
  var DEFAULT_SETTINGS = {
    'position-x': 'left',
    size: 'medium',
    style: 'background',
    theme: 'white-over-black'
  };
  var DEFAULT_BLOCKS = [
    {
      type: 'text',
      text: {
        value: '<p class="block"></p>'
      }
    }
  ];

  return {
    createInstance: function(panelJSON, callbacks) {

      if (! panelJSON) {
        var newPanelJSON = {
          'layout': DEFAULT_LAYOUT,
          'settings': DEFAULT_SETTINGS,
          'blocks': DEFAULT_BLOCKS
        };

        return new Panel(newPanelJSON, callbacks);
      }
      else {
        return new Panel(panelJSON, callbacks);
      }
    },
    duplicateWithoutContent: function(panelJSON, callbacks) {
      var newPanelJSON = {};

      if (panelJSON) {
        newPanelJSON = JSON.parse(JSON.stringify(panelJSON));
        newPanelJSON.blocks = DEFAULT_BLOCKS;
      }
      else {
        newPanelJSON = {
          'layout': DEFAULT_LAYOUT,
          'settings': DEFAULT_SETTINGS,
          'blocks': DEFAULT_BLOCKS
        };
      }

      return new Panel(newPanelJSON, callbacks);
    }
  };
});

(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){"use strict";if(global._babelPolyfill){throw new Error("only one instance of babel/polyfill is allowed")}global._babelPolyfill=true;require("core-js/shim");require("regenerator/runtime")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"core-js/shim":72,"regenerator/runtime":73}],2:[function(require,module,exports){"use strict";var $=require("./$");module.exports=function(IS_INCLUDES){return function(el){var O=$.toObject(this),length=$.toLength(O.length),index=$.toIndex(arguments[1],length),value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index}return!IS_INCLUDES&&-1}}},{"./$":16}],3:[function(require,module,exports){"use strict";var $=require("./$"),ctx=require("./$.ctx");module.exports=function(TYPE){var IS_MAP=TYPE==1,IS_FILTER=TYPE==2,IS_SOME=TYPE==3,IS_EVERY=TYPE==4,IS_FIND_INDEX=TYPE==6,NO_HOLES=TYPE==5||IS_FIND_INDEX;return function(callbackfn){var O=Object($.assertDefined(this)),self=$.ES5Object(O),f=ctx(callbackfn,arguments[1],3),length=$.toLength(self.length),index=0,result=IS_MAP?Array(length):IS_FILTER?[]:undefined,val,res;for(;length>index;index++)if(NO_HOLES||index in self){val=self[index];res=f(val,index,O);if(TYPE){if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return true;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return false}}return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}},{"./$":16,"./$.ctx":10}],4:[function(require,module,exports){var $=require("./$");function assert(condition,msg1,msg2){if(!condition)throw TypeError(msg2?msg1+msg2:msg1)}assert.def=$.assertDefined;assert.fn=function(it){if(!$.isFunction(it))throw TypeError(it+" is not a function!");return it};assert.obj=function(it){if(!$.isObject(it))throw TypeError(it+" is not an object!");return it};assert.inst=function(it,Constructor,name){if(!(it instanceof Constructor))throw TypeError(name+": use the 'new' operator!");return it};module.exports=assert},{"./$":16}],5:[function(require,module,exports){var $=require("./$");module.exports=Object.assign||function assign(target,source){var T=Object($.assertDefined(target)),l=arguments.length,i=1;while(l>i){var S=$.ES5Object(arguments[i++]),keys=$.getKeys(S),length=keys.length,j=0,key;while(length>j)T[key=keys[j++]]=S[key]}return T}},{"./$":16}],6:[function(require,module,exports){var $=require("./$"),TAG=require("./$.wks")("toStringTag"),toString={}.toString;function cof(it){return toString.call(it).slice(8,-1)}cof.classof=function(it){var O,T;return it==undefined?it===undefined?"Undefined":"Null":typeof(T=(O=Object(it))[TAG])=="string"?T:cof(O)};cof.set=function(it,tag,stat){if(it&&!$.has(it=stat?it:it.prototype,TAG))$.hide(it,TAG,tag)};module.exports=cof},{"./$":16,"./$.wks":27}],7:[function(require,module,exports){"use strict";var $=require("./$"),ctx=require("./$.ctx"),safe=require("./$.uid").safe,assert=require("./$.assert"),$iter=require("./$.iter"),has=$.has,set=$.set,isObject=$.isObject,hide=$.hide,step=$iter.step,isFrozen=Object.isFrozen||$.core.Object.isFrozen,ID=safe("id"),O1=safe("O1"),LAST=safe("last"),FIRST=safe("first"),ITER=safe("iter"),SIZE=$.DESC?safe("size"):"size",id=0;function fastKey(it,create){if(!isObject(it))return(typeof it=="string"?"S":"P")+it;if(isFrozen(it))return"F";if(!has(it,ID)){if(!create)return"E";hide(it,ID,++id)}return"O"+it[ID]}function getEntry(that,key){var index=fastKey(key),entry;if(index!="F")return that[O1][index];for(entry=that[FIRST];entry;entry=entry.n){if(entry.k==key)return entry}}module.exports={getConstructor:function(NAME,IS_MAP,ADDER){function C(iterable){var that=assert.inst(this,C,NAME);set(that,O1,$.create(null));set(that,SIZE,0);set(that,LAST,undefined);set(that,FIRST,undefined);if(iterable!=undefined)$iter.forOf(iterable,IS_MAP,that[ADDER],that)}$.mix(C.prototype,{clear:function clear(){for(var that=this,data=that[O1],entry=that[FIRST];entry;entry=entry.n){entry.r=true;if(entry.p)entry.p=entry.p.n=undefined;delete data[entry.i]}that[FIRST]=that[LAST]=undefined;that[SIZE]=0},"delete":function(key){var that=this,entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that[O1][entry.i];entry.r=true;if(prev)prev.n=next;if(next)next.p=prev;if(that[FIRST]==entry)that[FIRST]=next;if(that[LAST]==entry)that[LAST]=prev;that[SIZE]--}return!!entry},forEach:function forEach(callbackfn){var f=ctx(callbackfn,arguments[1],3),entry;while(entry=entry?entry.n:this[FIRST]){f(entry.v,entry.k,this);while(entry&&entry.r)entry=entry.p}},has:function has(key){return!!getEntry(this,key)}});if($.DESC)$.setDesc(C.prototype,"size",{get:function(){return assert.def(this[SIZE])}});return C},def:function(that,key,value){var entry=getEntry(that,key),prev,index;if(entry){entry.v=value}else{that[LAST]=entry={i:index=fastKey(key,true),k:key,v:value,p:prev=that[LAST],n:undefined,r:false};if(!that[FIRST])that[FIRST]=entry;if(prev)prev.n=entry;that[SIZE]++;if(index!="F")that[O1][index]=entry}return that},getEntry:getEntry,getIterConstructor:function(){return function(iterated,kind){set(this,ITER,{o:iterated,k:kind})}},next:function(){var iter=this[ITER],kind=iter.k,entry=iter.l;while(entry&&entry.r)entry=entry.p;if(!iter.o||!(iter.l=entry=entry?entry.n:iter.o[FIRST])){iter.o=undefined;return step(1)}if(kind=="key")return step(0,entry.k);if(kind=="value")return step(0,entry.v);return step(0,[entry.k,entry.v])}}},{"./$":16,"./$.assert":4,"./$.ctx":10,"./$.iter":15,"./$.uid":25}],8:[function(require,module,exports){"use strict";var $=require("./$"),safe=require("./$.uid").safe,assert=require("./$.assert"),forOf=require("./$.iter").forOf,_has=$.has,isObject=$.isObject,hide=$.hide,isFrozen=Object.isFrozen||$.core.Object.isFrozen,id=0,ID=safe("id"),WEAK=safe("weak"),LEAK=safe("leak"),method=require("./$.array-methods"),find=method(5),findIndex=method(6);function findFrozen(store,key){return find.call(store.array,function(it){return it[0]===key})}function leakStore(that){return that[LEAK]||hide(that,LEAK,{array:[],get:function(key){var entry=findFrozen(this,key);if(entry)return entry[1]},has:function(key){return!!findFrozen(this,key)},set:function(key,value){var entry=findFrozen(this,key);if(entry)entry[1]=value;else this.array.push([key,value])},"delete":function(key){var index=findIndex.call(this.array,function(it){return it[0]===key});if(~index)this.array.splice(index,1);return!!~index}})[LEAK]}module.exports={getConstructor:function(NAME,IS_MAP,ADDER){function C(iterable){$.set(assert.inst(this,C,NAME),ID,id++);if(iterable!=undefined)forOf(iterable,IS_MAP,this[ADDER],this)}$.mix(C.prototype,{"delete":function(key){if(!isObject(key))return false;if(isFrozen(key))return leakStore(this)["delete"](key);return _has(key,WEAK)&&_has(key[WEAK],this[ID])&&delete key[WEAK][this[ID]]},has:function has(key){if(!isObject(key))return false;if(isFrozen(key))return leakStore(this).has(key);return _has(key,WEAK)&&_has(key[WEAK],this[ID])}});return C},def:function(that,key,value){if(isFrozen(assert.obj(key))){leakStore(that).set(key,value)}else{_has(key,WEAK)||hide(key,WEAK,{});key[WEAK][that[ID]]=value}return that},leakStore:leakStore,WEAK:WEAK,ID:ID}},{"./$":16,"./$.array-methods":3,"./$.assert":4,"./$.iter":15,"./$.uid":25}],9:[function(require,module,exports){"use strict";var $=require("./$"),$def=require("./$.def"),$iter=require("./$.iter"),assertInstance=require("./$.assert").inst;module.exports=function(NAME,methods,common,IS_MAP,isWeak){var Base=$.g[NAME],C=Base,ADDER=IS_MAP?"set":"add",proto=C&&C.prototype,O={};function fixMethod(KEY,CHAIN){var method=proto[KEY];if($.FW)proto[KEY]=function(a,b){var result=method.call(this,a===0?0:a,b);return CHAIN?this:result}}if(!$.isFunction(C)||!(isWeak||!$iter.BUGGY&&proto.forEach&&proto.entries)){C=common.getConstructor(NAME,IS_MAP,ADDER);$.mix(C.prototype,methods)}else{var inst=new C,chain=inst[ADDER](isWeak?{}:-0,1),buggyZero;if(!require("./$.iter-detect")(function(iter){new C(iter)})){C=function(iterable){assertInstance(this,C,NAME);var that=new Base;if(iterable!=undefined)$iter.forOf(iterable,IS_MAP,that[ADDER],that);return that};C.prototype=proto;if($.FW)proto.constructor=C}isWeak||inst.forEach(function(val,key){buggyZero=1/key===-Infinity});if(buggyZero){fixMethod("delete");fixMethod("has");IS_MAP&&fixMethod("get")}if(buggyZero||chain!==inst)fixMethod(ADDER,true)}require("./$.cof").set(C,NAME);require("./$.species")(C);O[NAME]=C;$def($def.G+$def.W+$def.F*(C!=Base),O);if(!isWeak)$iter.std(C,NAME,common.getIterConstructor(),common.next,IS_MAP?"key+value":"value",!IS_MAP,true);return C}},{"./$":16,"./$.assert":4,"./$.cof":6,"./$.def":11,"./$.iter":15,"./$.iter-detect":14,"./$.species":22}],10:[function(require,module,exports){var assertFunction=require("./$.assert").fn;module.exports=function(fn,that,length){assertFunction(fn);if(~length&&that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},{"./$.assert":4}],11:[function(require,module,exports){var $=require("./$"),global=$.g,core=$.core,isFunction=$.isFunction;function ctx(fn,that){return function(){return fn.apply(that,arguments)}}global.core=core;$def.F=1;$def.G=2;$def.S=4;$def.P=8;$def.B=16;$def.W=32;function $def(type,name,source){var key,own,out,exp,isGlobal=type&$def.G,target=isGlobal?global:type&$def.S?global[name]:(global[name]||{}).prototype,exports=isGlobal?core:core[name]||(core[name]={});if(isGlobal)source=name;for(key in source){own=!(type&$def.F)&&target&&key in target;out=(own?target:source)[key];if(type&$def.B&&own)exp=ctx(out,global);else exp=type&$def.P&&isFunction(out)?ctx(Function.call,out):out;if(target&&!own){if(isGlobal)target[key]=out;else delete target[key]&&$.hide(target,key,out)}if(exports[key]!=out)$.hide(exports,key,exp)}}module.exports=$def},{"./$":16}],12:[function(require,module,exports){module.exports=function($){$.FW=true;$.path=$.g;return $}},{}],13:[function(require,module,exports){module.exports=function(fn,args,that){var un=that===undefined;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3]);case 5:return un?fn(args[0],args[1],args[2],args[3],args[4]):fn.call(that,args[0],args[1],args[2],args[3],args[4])}return fn.apply(that,args)}},{}],14:[function(require,module,exports){var SYMBOL_ITERATOR=require("./$.wks")("iterator"),SAFE_CLOSING=false;try{var riter=[7][SYMBOL_ITERATOR]();riter["return"]=function(){SAFE_CLOSING=true};Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec){if(!SAFE_CLOSING)return false;var safe=false;try{var arr=[7],iter=arr[SYMBOL_ITERATOR]();iter.next=function(){safe=true};arr[SYMBOL_ITERATOR]=function(){return iter};exec(arr)}catch(e){}return safe}},{"./$.wks":27}],15:[function(require,module,exports){"use strict";var $=require("./$"),ctx=require("./$.ctx"),cof=require("./$.cof"),$def=require("./$.def"),assertObject=require("./$.assert").obj,SYMBOL_ITERATOR=require("./$.wks")("iterator"),FF_ITERATOR="@@iterator",Iterators={},IteratorPrototype={};var BUGGY="keys"in[]&&!("next"in[].keys());setIterator(IteratorPrototype,$.that);function setIterator(O,value){$.hide(O,SYMBOL_ITERATOR,value);if(FF_ITERATOR in[])$.hide(O,FF_ITERATOR,value)}function defineIterator(Constructor,NAME,value,DEFAULT){var proto=Constructor.prototype,iter=proto[SYMBOL_ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT]||value;if($.FW)setIterator(proto,iter);if(iter!==value){var iterProto=$.getProto(iter.call(new Constructor));cof.set(iterProto,NAME+" Iterator",true);if($.FW)$.has(proto,FF_ITERATOR)&&setIterator(iterProto,$.that)}Iterators[NAME]=iter;Iterators[NAME+" Iterator"]=$.that;return iter}function getIterator(it){var Symbol=$.g.Symbol,ext=it[Symbol&&Symbol.iterator||FF_ITERATOR],getIter=ext||it[SYMBOL_ITERATOR]||Iterators[cof.classof(it)];return assertObject(getIter.call(it))}function closeIterator(iterator){var ret=iterator["return"];if(ret!==undefined)assertObject(ret.call(iterator))}function stepCall(iterator,fn,value,entries){try{return entries?fn(assertObject(value)[0],value[1]):fn(value)}catch(e){closeIterator(iterator);throw e}}var $iter=module.exports={BUGGY:BUGGY,Iterators:Iterators,prototype:IteratorPrototype,step:function(done,value){return{value:value,done:!!done}},stepCall:stepCall,close:closeIterator,is:function(it){var O=Object(it),Symbol=$.g.Symbol,SYM=Symbol&&Symbol.iterator||FF_ITERATOR;return SYM in O||SYMBOL_ITERATOR in O||$.has(Iterators,cof.classof(O))},get:getIterator,set:setIterator,create:function(Constructor,NAME,next,proto){Constructor.prototype=$.create(proto||$iter.prototype,{next:$.desc(1,next)});cof.set(Constructor,NAME+" Iterator")},define:defineIterator,std:function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCE){function createIter(kind){return function(){return new Constructor(this,kind)}}$iter.create(Constructor,NAME,next);var entries=createIter("key+value"),values=createIter("value"),proto=Base.prototype,methods,key;if(DEFAULT=="value")values=defineIterator(Base,NAME,values,"values");else entries=defineIterator(Base,NAME,entries,"entries");if(DEFAULT){methods={entries:entries,keys:IS_SET?values:createIter("key"),values:values};$def($def.P+$def.F*BUGGY,NAME,methods);if(FORCE)for(key in methods){if(!(key in proto))$.hide(proto,key,methods[key])}}},forOf:function(iterable,entries,fn,that){var iterator=getIterator(iterable),f=ctx(fn,that,entries?2:1),step;while(!(step=iterator.next()).done){if(stepCall(iterator,f,step.value,entries)===false){return closeIterator(iterator)}}}}},{"./$":16,"./$.assert":4,"./$.cof":6,"./$.ctx":10,"./$.def":11,"./$.wks":27}],16:[function(require,module,exports){"use strict";var global=typeof self!="undefined"?self:Function("return this")(),core={},defineProperty=Object.defineProperty,hasOwnProperty={}.hasOwnProperty,ceil=Math.ceil,floor=Math.floor,max=Math.max,min=Math.min;var DESC=!!function(){try{return defineProperty({},"a",{get:function(){return 2}}).a==2}catch(e){}}();var hide=createDefiner(1);function toInteger(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}function desc(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}function simpleSet(object,key,value){object[key]=value;return object}function createDefiner(bitmap){return DESC?function(object,key,value){return $.setDesc(object,key,desc(bitmap,value))}:simpleSet}function isObject(it){return it!==null&&(typeof it=="object"||typeof it=="function")}function isFunction(it){return typeof it=="function"}function assertDefined(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it}var $=module.exports=require("./$.fw")({g:global,core:core,html:global.document&&document.documentElement,isObject:isObject,isFunction:isFunction,it:function(it){return it},that:function(){return this},toInteger:toInteger,toLength:function(it){return it>0?min(toInteger(it),9007199254740991):0},toIndex:function(index,length){index=toInteger(index);return index<0?max(index+length,0):min(index,length)},has:function(it,key){return hasOwnProperty.call(it,key)},create:Object.create,getProto:Object.getPrototypeOf,DESC:DESC,desc:desc,getDesc:Object.getOwnPropertyDescriptor,setDesc:defineProperty,getKeys:Object.keys,getNames:Object.getOwnPropertyNames,getSymbols:Object.getOwnPropertySymbols,assertDefined:assertDefined,ES5Object:Object,toObject:function(it){return $.ES5Object(assertDefined(it))},hide:hide,def:createDefiner(0),set:global.Symbol?simpleSet:hide,mix:function(target,src){for(var key in src)hide(target,key,src[key]);return target},each:[].forEach});if(typeof __e!="undefined")__e=core;if(typeof __g!="undefined")__g=global},{"./$.fw":12}],17:[function(require,module,exports){var $=require("./$");module.exports=function(object,el){var O=$.toObject(object),keys=$.getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key}},{"./$":16}],18:[function(require,module,exports){var $=require("./$"),assertObject=require("./$.assert").obj;module.exports=function ownKeys(it){assertObject(it);return $.getSymbols?$.getNames(it).concat($.getSymbols(it)):$.getNames(it)}},{"./$":16,"./$.assert":4}],19:[function(require,module,exports){"use strict";var $=require("./$"),invoke=require("./$.invoke"),assertFunction=require("./$.assert").fn;module.exports=function(){var fn=assertFunction(this),length=arguments.length,pargs=Array(length),i=0,_=$.path._,holder=false;while(length>i)if((pargs[i]=arguments[i++])===_)holder=true;return function(){var that=this,_length=arguments.length,j=0,k=0,args;if(!holder&&!_length)return invoke(fn,pargs,that);args=pargs.slice();if(holder)for(;length>j;j++)if(args[j]===_)args[j]=arguments[k++];while(_length>k)args.push(arguments[k++]);return invoke(fn,args,that)}}},{"./$":16,"./$.assert":4,"./$.invoke":13}],20:[function(require,module,exports){"use strict";module.exports=function(regExp,replace,isStatic){var replacer=replace===Object(replace)?function(part){return replace[part]}:replace;return function(it){return String(isStatic?it:this).replace(regExp,replacer)}}},{}],21:[function(require,module,exports){var $=require("./$"),assert=require("./$.assert");function check(O,proto){assert.obj(O);assert(proto===null||$.isObject(proto),proto,": can't set as prototype!")}module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(buggy,set){try{set=require("./$.ctx")(Function.call,$.getDesc(Object.prototype,"__proto__").set,2);set({},[])}catch(e){buggy=true}return function setPrototypeOf(O,proto){check(O,proto);if(buggy)O.__proto__=proto;else set(O,proto);return O}}():undefined),check:check}},{"./$":16,"./$.assert":4,"./$.ctx":10}],22:[function(require,module,exports){var $=require("./$");module.exports=function(C){if($.DESC&&$.FW)$.setDesc(C,require("./$.wks")("species"),{configurable:true,get:$.that})}},{"./$":16,"./$.wks":27}],23:[function(require,module,exports){"use strict";var $=require("./$");module.exports=function(TO_STRING){return function(pos){var s=String($.assertDefined(this)),i=$.toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return TO_STRING?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}}},{"./$":16}],24:[function(require,module,exports){"use strict";var $=require("./$"),ctx=require("./$.ctx"),cof=require("./$.cof"),invoke=require("./$.invoke"),global=$.g,isFunction=$.isFunction,html=$.html,document=global.document,process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,postMessage=global.postMessage,addEventListener=global.addEventListener,MessageChannel=global.MessageChannel,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port;function run(){var id=+this;if($.has(queue,id)){var fn=queue[id];delete queue[id];fn()}}function listner(event){run.call(event.data)}if(!isFunction(setTask)||!isFunction(clearTask)){setTask=function(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);queue[++counter]=function(){invoke(isFunction(fn)?fn:Function(fn),args)};defer(counter);return counter};clearTask=function(id){delete queue[id]};if(cof(process)=="process"){defer=function(id){process.nextTick(ctx(run,id,1))}}else if(addEventListener&&isFunction(postMessage)&&!global.importScripts){defer=function(id){postMessage(id,"*")};addEventListener("message",listner,false)}else if(isFunction(MessageChannel)){channel=new MessageChannel;port=channel.port2;channel.port1.onmessage=listner;defer=ctx(port.postMessage,port,1)}else if(document&&ONREADYSTATECHANGE in document.createElement("script")){defer=function(id){html.appendChild(document.createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run.call(id)}}}else{defer=function(id){setTimeout(ctx(run,id,1),0)}}}module.exports={set:setTask,clear:clearTask}},{"./$":16,"./$.cof":6,"./$.ctx":10,"./$.invoke":13}],25:[function(require,module,exports){var sid=0;function uid(key){return"Symbol("+key+")_"+(++sid+Math.random()).toString(36)}uid.safe=require("./$").g.Symbol||uid;module.exports=uid},{"./$":16}],26:[function(require,module,exports){var $=require("./$"),UNSCOPABLES=require("./$.wks")("unscopables");if($.FW&&!(UNSCOPABLES in[]))$.hide(Array.prototype,UNSCOPABLES,{});module.exports=function(key){if($.FW)[][UNSCOPABLES][key]=true}},{"./$":16,"./$.wks":27}],27:[function(require,module,exports){var global=require("./$").g,store={};module.exports=function(name){return store[name]||(store[name]=global.Symbol&&global.Symbol[name]||require("./$.uid").safe("Symbol."+name))}},{"./$":16,"./$.uid":25}],28:[function(require,module,exports){var $=require("./$"),cof=require("./$.cof"),$def=require("./$.def"),invoke=require("./$.invoke"),arrayMethod=require("./$.array-methods"),IE_PROTO=require("./$.uid").safe("__proto__"),assert=require("./$.assert"),assertObject=assert.obj,ObjectProto=Object.prototype,A=[],slice=A.slice,indexOf=A.indexOf,classof=cof.classof,defineProperties=Object.defineProperties,has=$.has,defineProperty=$.setDesc,getOwnDescriptor=$.getDesc,isFunction=$.isFunction,toObject=$.toObject,toLength=$.toLength,IE8_DOM_DEFINE=false;if(!$.DESC){try{IE8_DOM_DEFINE=defineProperty(document.createElement("div"),"x",{get:function(){return 8}}).x==8}catch(e){}$.setDesc=function(O,P,Attributes){if(IE8_DOM_DEFINE)try{return defineProperty(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");if("value"in Attributes)assertObject(O)[P]=Attributes.value;return O};$.getDesc=function(O,P){if(IE8_DOM_DEFINE)try{return getOwnDescriptor(O,P)}catch(e){}if(has(O,P))return $.desc(!ObjectProto.propertyIsEnumerable.call(O,P),O[P])};defineProperties=function(O,Properties){assertObject(O);var keys=$.getKeys(Properties),length=keys.length,i=0,P;while(length>i)$.setDesc(O,P=keys[i++],Properties[P]);return O}}$def($def.S+$def.F*!$.DESC,"Object",{getOwnPropertyDescriptor:$.getDesc,defineProperty:$.setDesc,defineProperties:defineProperties});var keys1=("constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,"+"toLocaleString,toString,valueOf").split(","),keys2=keys1.concat("length","prototype"),keysLen1=keys1.length;var createDict=function(){var iframe=document.createElement("iframe"),i=keysLen1,gt=">",iframeDocument;iframe.style.display="none";$.html.appendChild(iframe);iframe.src="javascript:";iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write("<script>document.F=Object</script"+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict.prototype[keys1[i]];return createDict()};function createGetKeys(names,length){return function(object){var O=toObject(object),i=0,result=[],key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(length>i)if(has(O,key=names[i++])){~indexOf.call(result,key)||result.push(key)}return result}}function isPrimitive(it){return!$.isObject(it)}function Empty(){}$def($def.S,"Object",{getPrototypeOf:$.getProto=$.getProto||function(O){O=Object(assert.def(O));if(has(O,IE_PROTO))return O[IE_PROTO];if(isFunction(O.constructor)&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectProto:null},getOwnPropertyNames:$.getNames=$.getNames||createGetKeys(keys2,keys2.length,true),create:$.create=$.create||function(O,Properties){var result;if(O!==null){Empty.prototype=assertObject(O);result=new Empty;Empty.prototype=null;result[IE_PROTO]=O}else result=createDict();return Properties===undefined?result:defineProperties(result,Properties)},keys:$.getKeys=$.getKeys||createGetKeys(keys1,keysLen1,false),seal:$.it,freeze:$.it,preventExtensions:$.it,isSealed:isPrimitive,isFrozen:isPrimitive,isExtensible:$.isObject});$def($def.P,"Function",{bind:function(that){var fn=assert.fn(this),partArgs=slice.call(arguments,1);function bound(){var args=partArgs.concat(slice.call(arguments));return invoke(fn,args,this instanceof bound?$.create(fn.prototype):that)}if(fn.prototype)bound.prototype=fn.prototype;return bound}});function arrayMethodFix(fn){return function(){return fn.apply($.ES5Object(this),arguments)}}if(!(0 in Object("z")&&"z"[0]=="z")){$.ES5Object=function(it){return cof(it)=="String"?it.split(""):Object(it)}}$def($def.P+$def.F*($.ES5Object!=Object),"Array",{slice:arrayMethodFix(slice),join:arrayMethodFix(A.join)});$def($def.S,"Array",{isArray:function(arg){return cof(arg)=="Array"}});function createArrayReduce(isRight){return function(callbackfn,memo){assert.fn(callbackfn);var O=toObject(this),length=toLength(O.length),index=isRight?length-1:0,i=isRight?-1:1;if(arguments.length<2)for(;;){if(index in O){memo=O[index];index+=i;break}index+=i;assert(isRight?index>=0:length>index,"Reduce of empty array with no initial value")}for(;isRight?index>=0:length>index;index+=i)if(index in O){memo=callbackfn(memo,O[index],index,this)}return memo}}$def($def.P,"Array",{forEach:$.each=$.each||arrayMethod(0),map:arrayMethod(1),filter:arrayMethod(2),some:arrayMethod(3),every:arrayMethod(4),reduce:createArrayReduce(false),reduceRight:createArrayReduce(true),indexOf:indexOf=indexOf||require("./$.array-includes")(false),lastIndexOf:function(el,fromIndex){var O=toObject(this),length=toLength(O.length),index=length-1;if(arguments.length>1)index=Math.min(index,$.toInteger(fromIndex));if(index<0)index=toLength(length+index);for(;index>=0;index--)if(index in O)if(O[index]===el)return index;return-1}});$def($def.P,"String",{trim:require("./$.replacer")(/^\s*([\s\S]*\S)?\s*$/,"$1")});$def($def.S,"Date",{now:function(){return+new Date}});function lz(num){return num>9?num:"0"+num}$def($def.P,"Date",{toISOString:function(){if(!isFinite(this))throw RangeError("Invalid time value");var d=this,y=d.getUTCFullYear(),m=d.getUTCMilliseconds(),s=y<0?"-":y>9999?"+":"";return s+("00000"+Math.abs(y)).slice(s?-6:-4)+"-"+lz(d.getUTCMonth()+1)+"-"+lz(d.getUTCDate())+"T"+lz(d.getUTCHours())+":"+lz(d.getUTCMinutes())+":"+lz(d.getUTCSeconds())+"."+(m>99?m:"0"+lz(m))+"Z"}});if(classof(function(){return arguments}())=="Object")cof.classof=function(it){var tag=classof(it);return tag=="Object"&&isFunction(it.callee)?"Arguments":tag}},{"./$":16,"./$.array-includes":2,"./$.array-methods":3,"./$.assert":4,"./$.cof":6,"./$.def":11,"./$.invoke":13,"./$.replacer":20,"./$.uid":25}],29:[function(require,module,exports){"use strict";var $=require("./$"),$def=require("./$.def"),toIndex=$.toIndex;$def($def.P,"Array",{copyWithin:function copyWithin(target,start){var O=Object($.assertDefined(this)),len=$.toLength(O.length),to=toIndex(target,len),from=toIndex(start,len),end=arguments[2],fin=end===undefined?len:toIndex(end,len),count=Math.min(fin-from,len-to),inc=1;if(from<to&&to<from+count){inc=-1;from=from+count-1;to=to+count-1}while(count-->0){if(from in O)O[to]=O[from];else delete O[to];to+=inc;from+=inc}return O}});require("./$.unscope")("copyWithin")},{"./$":16,"./$.def":11,"./$.unscope":26}],30:[function(require,module,exports){"use strict";var $=require("./$"),$def=require("./$.def"),toIndex=$.toIndex;$def($def.P,"Array",{fill:function fill(value){var O=Object($.assertDefined(this)),length=$.toLength(O.length),index=toIndex(arguments[1],length),end=arguments[2],endPos=end===undefined?length:toIndex(end,length);while(endPos>index)O[index++]=value;return O}});require("./$.unscope")("fill")},{"./$":16,"./$.def":11,"./$.unscope":26}],31:[function(require,module,exports){var $def=require("./$.def");$def($def.P,"Array",{findIndex:require("./$.array-methods")(6)});require("./$.unscope")("findIndex")},{"./$.array-methods":3,"./$.def":11,"./$.unscope":26}],32:[function(require,module,exports){var $def=require("./$.def");$def($def.P,"Array",{find:require("./$.array-methods")(5)});require("./$.unscope")("find")},{"./$.array-methods":3,"./$.def":11,"./$.unscope":26}],33:[function(require,module,exports){var $=require("./$"),ctx=require("./$.ctx"),$def=require("./$.def"),$iter=require("./$.iter"),stepCall=$iter.stepCall;$def($def.S+$def.F*!require("./$.iter-detect")(function(iter){Array.from(iter)}),"Array",{from:function from(arrayLike){var O=Object($.assertDefined(arrayLike)),mapfn=arguments[1],mapping=mapfn!==undefined,f=mapping?ctx(mapfn,arguments[2],2):undefined,index=0,length,result,step,iterator;if($iter.is(O)){iterator=$iter.get(O);result=new(typeof this=="function"?this:Array);for(;!(step=iterator.next()).done;index++){result[index]=mapping?stepCall(iterator,f,[step.value,index],true):step.value}}else{result=new(typeof this=="function"?this:Array)(length=$.toLength(O.length));for(;length>index;index++){result[index]=mapping?f(O[index],index):O[index]}}result.length=index;return result}})},{"./$":16,"./$.ctx":10,"./$.def":11,"./$.iter":15,"./$.iter-detect":14}],34:[function(require,module,exports){var $=require("./$"),setUnscope=require("./$.unscope"),ITER=require("./$.uid").safe("iter"),$iter=require("./$.iter"),step=$iter.step,Iterators=$iter.Iterators;$iter.std(Array,"Array",function(iterated,kind){$.set(this,ITER,{o:$.toObject(iterated),i:0,k:kind})},function(){var iter=this[ITER],O=iter.o,kind=iter.k,index=iter.i++;if(!O||index>=O.length){iter.o=undefined;return step(1)}if(kind=="key")return step(0,index);if(kind=="value")return step(0,O[index]);return step(0,[index,O[index]])},"value");Iterators.Arguments=Iterators.Array;setUnscope("keys");setUnscope("values");setUnscope("entries")},{"./$":16,"./$.iter":15,"./$.uid":25,"./$.unscope":26}],35:[function(require,module,exports){var $def=require("./$.def");$def($def.S,"Array",{of:function of(){var index=0,length=arguments.length,result=new(typeof this=="function"?this:Array)(length);while(length>index)result[index]=arguments[index++];result.length=length;return result}})},{"./$.def":11}],36:[function(require,module,exports){require("./$.species")(Array)},{"./$.species":22}],37:[function(require,module,exports){"use strict";var $=require("./$"),NAME="name",setDesc=$.setDesc,FunctionProto=Function.prototype;NAME in FunctionProto||$.FW&&$.DESC&&setDesc(FunctionProto,NAME,{configurable:true,get:function(){var match=String(this).match(/^\s*function ([^ (]*)/),name=match?match[1]:"";$.has(this,NAME)||setDesc(this,NAME,$.desc(5,name));return name},set:function(value){$.has(this,NAME)||setDesc(this,NAME,$.desc(0,value))}})},{"./$":16}],38:[function(require,module,exports){"use strict";var strong=require("./$.collection-strong");require("./$.collection")("Map",{get:function get(key){var entry=strong.getEntry(this,key);return entry&&entry.v},set:function set(key,value){return strong.def(this,key===0?0:key,value)}},strong,true)},{"./$.collection":9,"./$.collection-strong":7}],39:[function(require,module,exports){var Infinity=1/0,$def=require("./$.def"),E=Math.E,pow=Math.pow,abs=Math.abs,exp=Math.exp,log=Math.log,sqrt=Math.sqrt,ceil=Math.ceil,floor=Math.floor,EPSILON=pow(2,-52),EPSILON32=pow(2,-23),MAX32=pow(2,127)*(2-EPSILON32),MIN32=pow(2,-126);function roundTiesToEven(n){return n+1/EPSILON-1/EPSILON}function sign(x){return(x=+x)==0||x!=x?x:x<0?-1:1;

}function asinh(x){return!isFinite(x=+x)||x==0?x:x<0?-asinh(-x):log(x+sqrt(x*x+1))}function expm1(x){return(x=+x)==0?x:x>-1e-6&&x<1e-6?x+x*x/2:exp(x)-1}$def($def.S,"Math",{acosh:function acosh(x){return(x=+x)<1?NaN:isFinite(x)?log(x/E+sqrt(x+1)*sqrt(x-1)/E)+1:x},asinh:asinh,atanh:function atanh(x){return(x=+x)==0?x:log((1+x)/(1-x))/2},cbrt:function cbrt(x){return sign(x=+x)*pow(abs(x),1/3)},clz32:function clz32(x){return(x>>>=0)?31-floor(log(x+.5)*Math.LOG2E):32},cosh:function cosh(x){return(exp(x=+x)+exp(-x))/2},expm1:expm1,fround:function fround(x){var $abs=abs(x),$sign=sign(x),a,result;if($abs<MIN32)return $sign*roundTiesToEven($abs/MIN32/EPSILON32)*MIN32*EPSILON32;a=(1+EPSILON32/EPSILON)*$abs;result=a-(a-$abs);if(result>MAX32||result!=result)return $sign*Infinity;return $sign*result},hypot:function hypot(value1,value2){var sum=0,len1=arguments.length,len2=len1,args=Array(len1),larg=-Infinity,arg;while(len1--){arg=args[len1]=+arguments[len1];if(arg==Infinity||arg==-Infinity)return Infinity;if(arg>larg)larg=arg}larg=arg||1;while(len2--)sum+=pow(args[len2]/larg,2);return larg*sqrt(sum)},imul:function imul(x,y){var UInt16=65535,xn=+x,yn=+y,xl=UInt16&xn,yl=UInt16&yn;return 0|xl*yl+((UInt16&xn>>>16)*yl+xl*(UInt16&yn>>>16)<<16>>>0)},log1p:function log1p(x){return(x=+x)>-1e-8&&x<1e-8?x-x*x/2:log(1+x)},log10:function log10(x){return log(x)/Math.LN10},log2:function log2(x){return log(x)/Math.LN2},sign:sign,sinh:function sinh(x){return abs(x=+x)<1?(expm1(x)-expm1(-x))/2:(exp(x-1)-exp(-x-1))*(E/2)},tanh:function tanh(x){var a=expm1(x=+x),b=expm1(-x);return a==Infinity?1:b==Infinity?-1:(a-b)/(exp(x)+exp(-x))},trunc:function trunc(it){return(it>0?floor:ceil)(it)}})},{"./$.def":11}],40:[function(require,module,exports){"use strict";var $=require("./$"),isObject=$.isObject,isFunction=$.isFunction,NUMBER="Number",Number=$.g[NUMBER],Base=Number,proto=Number.prototype;function toPrimitive(it){var fn,val;if(isFunction(fn=it.valueOf)&&!isObject(val=fn.call(it)))return val;if(isFunction(fn=it.toString)&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to number")}function toNumber(it){if(isObject(it))it=toPrimitive(it);if(typeof it=="string"&&it.length>2&&it.charCodeAt(0)==48){var binary=false;switch(it.charCodeAt(1)){case 66:case 98:binary=true;case 79:case 111:return parseInt(it.slice(2),binary?2:8)}}return+it}if($.FW&&!(Number("0o1")&&Number("0b1"))){Number=function Number(it){return this instanceof Number?new Base(toNumber(it)):toNumber(it)};$.each.call($.DESC?$.getNames(Base):("MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,"+"EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,"+"MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger").split(","),function(key){if($.has(Base,key)&&!$.has(Number,key)){$.setDesc(Number,key,$.getDesc(Base,key))}});Number.prototype=proto;proto.constructor=Number;$.hide($.g,NUMBER,Number)}},{"./$":16}],41:[function(require,module,exports){var $=require("./$"),$def=require("./$.def"),abs=Math.abs,floor=Math.floor,_isFinite=$.g.isFinite,MAX_SAFE_INTEGER=9007199254740991;function isInteger(it){return!$.isObject(it)&&_isFinite(it)&&floor(it)===it}$def($def.S,"Number",{EPSILON:Math.pow(2,-52),isFinite:function isFinite(it){return typeof it=="number"&&_isFinite(it)},isInteger:isInteger,isNaN:function isNaN(number){return number!=number},isSafeInteger:function isSafeInteger(number){return isInteger(number)&&abs(number)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER:MAX_SAFE_INTEGER,MIN_SAFE_INTEGER:-MAX_SAFE_INTEGER,parseFloat:parseFloat,parseInt:parseInt})},{"./$":16,"./$.def":11}],42:[function(require,module,exports){var $def=require("./$.def");$def($def.S,"Object",{assign:require("./$.assign")})},{"./$.assign":5,"./$.def":11}],43:[function(require,module,exports){var $def=require("./$.def");$def($def.S,"Object",{is:function is(x,y){return x===y?x!==0||1/x===1/y:x!=x&&y!=y}})},{"./$.def":11}],44:[function(require,module,exports){var $def=require("./$.def");$def($def.S,"Object",{setPrototypeOf:require("./$.set-proto").set})},{"./$.def":11,"./$.set-proto":21}],45:[function(require,module,exports){var $=require("./$"),$def=require("./$.def"),isObject=$.isObject,toObject=$.toObject;function wrapObjectMethod(METHOD,MODE){var fn=($.core.Object||{})[METHOD]||Object[METHOD],f=0,o={};o[METHOD]=MODE==1?function(it){return isObject(it)?fn(it):it}:MODE==2?function(it){return isObject(it)?fn(it):true}:MODE==3?function(it){return isObject(it)?fn(it):false}:MODE==4?function getOwnPropertyDescriptor(it,key){return fn(toObject(it),key)}:MODE==5?function getPrototypeOf(it){return fn(Object($.assertDefined(it)))}:function(it){return fn(toObject(it))};try{fn("z")}catch(e){f=1}$def($def.S+$def.F*f,"Object",o)}wrapObjectMethod("freeze",1);wrapObjectMethod("seal",1);wrapObjectMethod("preventExtensions",1);wrapObjectMethod("isFrozen",2);wrapObjectMethod("isSealed",2);wrapObjectMethod("isExtensible",3);wrapObjectMethod("getOwnPropertyDescriptor",4);wrapObjectMethod("getPrototypeOf",5);wrapObjectMethod("keys");wrapObjectMethod("getOwnPropertyNames")},{"./$":16,"./$.def":11}],46:[function(require,module,exports){"use strict";var $=require("./$"),cof=require("./$.cof"),tmp={};tmp[require("./$.wks")("toStringTag")]="z";if($.FW&&cof(tmp)!="z")$.hide(Object.prototype,"toString",function toString(){return"[object "+cof.classof(this)+"]"})},{"./$":16,"./$.cof":6,"./$.wks":27}],47:[function(require,module,exports){"use strict";var $=require("./$"),ctx=require("./$.ctx"),cof=require("./$.cof"),$def=require("./$.def"),assert=require("./$.assert"),$iter=require("./$.iter"),SPECIES=require("./$.wks")("species"),RECORD=require("./$.uid").safe("record"),forOf=$iter.forOf,PROMISE="Promise",global=$.g,process=global.process,asap=process&&process.nextTick||require("./$.task").set,P=global[PROMISE],Base=P,isFunction=$.isFunction,isObject=$.isObject,assertFunction=assert.fn,assertObject=assert.obj,test;function getConstructor(C){var S=assertObject(C)[SPECIES];return S!=undefined?S:C}function isThenable(it){var then;if(isObject(it))then=it.then;return isFunction(then)?then:false}function isUnhandled(promise){var record=promise[RECORD],chain=record.c,i=0,react;if(record.h)return false;while(chain.length>i){react=chain[i++];if(react.fail||!isUnhandled(react.P))return false}return true}function notify(record,isReject){var chain=record.c;if(isReject||chain.length)asap(function(){var promise=record.p,value=record.v,ok=record.s==1,i=0;if(isReject&&isUnhandled(promise)){setTimeout(function(){if(isUnhandled(promise)){if(cof(process)=="process"){process.emit("unhandledRejection",value,promise)}else if(global.console&&isFunction(console.error)){console.error("Unhandled promise rejection",value)}}},1e3)}else while(chain.length>i)!function(react){var cb=ok?react.ok:react.fail,ret,then;try{if(cb){if(!ok)record.h=true;ret=cb===true?value:cb(value);if(ret===react.P){react.rej(TypeError(PROMISE+"-chain cycle"))}else if(then=isThenable(ret)){then.call(ret,react.res,react.rej)}else react.res(ret)}else react.rej(value)}catch(err){react.rej(err)}}(chain[i++]);chain.length=0})}function $reject(value){var record=this;if(record.d)return;record.d=true;record=record.r||record;record.v=value;record.s=2;notify(record,true)}function $resolve(value){var record=this,then,wrapper;if(record.d)return;record.d=true;record=record.r||record;try{if(then=isThenable(value)){wrapper={r:record,d:false};then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}else{record.v=value;record.s=1;notify(record)}}catch(err){$reject.call(wrapper||{r:record,d:false},err)}}if(!(isFunction(P)&&isFunction(P.resolve)&&P.resolve(test=new P(function(){}))==test)){P=function Promise(executor){assertFunction(executor);var record={p:assert.inst(this,P,PROMISE),c:[],s:0,d:false,v:undefined,h:false};$.hide(this,RECORD,record);try{executor(ctx($resolve,record,1),ctx($reject,record,1))}catch(err){$reject.call(record,err)}};$.mix(P.prototype,{then:function then(onFulfilled,onRejected){var S=assertObject(assertObject(this).constructor)[SPECIES];var react={ok:isFunction(onFulfilled)?onFulfilled:true,fail:isFunction(onRejected)?onRejected:false};var promise=react.P=new(S!=undefined?S:P)(function(res,rej){react.res=assertFunction(res);react.rej=assertFunction(rej)});var record=this[RECORD];record.c.push(react);record.s&&notify(record);return promise},"catch":function(onRejected){return this.then(undefined,onRejected)}})}$def($def.G+$def.W+$def.F*(P!=Base),{Promise:P});cof.set(P,PROMISE);require("./$.species")(P);$def($def.S,PROMISE,{reject:function reject(r){return new(getConstructor(this))(function(res,rej){rej(r)})},resolve:function resolve(x){return isObject(x)&&RECORD in x&&$.getProto(x)===this.prototype?x:new(getConstructor(this))(function(res){res(x)})}});$def($def.S+$def.F*!require("./$.iter-detect")(function(iter){P.all(iter)["catch"](function(){})}),PROMISE,{all:function all(iterable){var C=getConstructor(this),values=[];return new C(function(res,rej){forOf(iterable,false,values.push,values);var remaining=values.length,results=Array(remaining);if(remaining)$.each.call(values,function(promise,index){C.resolve(promise).then(function(value){results[index]=value;--remaining||res(results)},rej)});else res(results)})},race:function race(iterable){var C=getConstructor(this);return new C(function(res,rej){forOf(iterable,false,function(promise){C.resolve(promise).then(res,rej)})})}})},{"./$":16,"./$.assert":4,"./$.cof":6,"./$.ctx":10,"./$.def":11,"./$.iter":15,"./$.iter-detect":14,"./$.species":22,"./$.task":24,"./$.uid":25,"./$.wks":27}],48:[function(require,module,exports){var $=require("./$"),$def=require("./$.def"),setProto=require("./$.set-proto"),$iter=require("./$.iter"),ITER=require("./$.uid").safe("iter"),step=$iter.step,assert=require("./$.assert"),isObject=$.isObject,getDesc=$.getDesc,setDesc=$.setDesc,getProto=$.getProto,apply=Function.apply,assertObject=assert.obj,_isExtensible=Object.isExtensible||$.it;function Enumerate(iterated){var keys=[],key;for(key in iterated)keys.push(key);$.set(this,ITER,{o:iterated,a:keys,i:0})}$iter.create(Enumerate,"Object",function(){var iter=this[ITER],keys=iter.a,key;do{if(iter.i>=keys.length)return step(1)}while(!((key=keys[iter.i++])in iter.o));return step(0,key)});function wrap(fn){return function(it){assertObject(it);try{fn.apply(undefined,arguments);return true}catch(e){return false}}}function get(target,propertyKey){var receiver=arguments.length<3?target:arguments[2],desc=getDesc(assertObject(target),propertyKey),proto;if(desc)return $.has(desc,"value")?desc.value:desc.get===undefined?undefined:desc.get.call(receiver);return isObject(proto=getProto(target))?get(proto,propertyKey,receiver):undefined}function set(target,propertyKey,V){var receiver=arguments.length<4?target:arguments[3],ownDesc=getDesc(assertObject(target),propertyKey),existingDescriptor,proto;if(!ownDesc){if(isObject(proto=getProto(target))){return set(proto,propertyKey,V,receiver)}ownDesc=$.desc(0)}if($.has(ownDesc,"value")){if(ownDesc.writable===false||!isObject(receiver))return false;existingDescriptor=getDesc(receiver,propertyKey)||$.desc(0);existingDescriptor.value=V;setDesc(receiver,propertyKey,existingDescriptor);return true}return ownDesc.set===undefined?false:(ownDesc.set.call(receiver,V),true)}var reflect={apply:require("./$.ctx")(Function.call,apply,3),construct:function construct(target,argumentsList){var proto=assert.fn(arguments.length<3?target:arguments[2]).prototype,instance=$.create(isObject(proto)?proto:Object.prototype),result=apply.call(target,instance,argumentsList);return isObject(result)?result:instance},defineProperty:wrap(setDesc),deleteProperty:function deleteProperty(target,propertyKey){var desc=getDesc(assertObject(target),propertyKey);return desc&&!desc.configurable?false:delete target[propertyKey]},enumerate:function enumerate(target){return new Enumerate(assertObject(target))},get:get,getOwnPropertyDescriptor:function getOwnPropertyDescriptor(target,propertyKey){return getDesc(assertObject(target),propertyKey)},getPrototypeOf:function getPrototypeOf(target){return getProto(assertObject(target))},has:function has(target,propertyKey){return propertyKey in target},isExtensible:function isExtensible(target){return!!_isExtensible(assertObject(target))},ownKeys:require("./$.own-keys"),preventExtensions:wrap(Object.preventExtensions||$.it),set:set};if(setProto)reflect.setPrototypeOf=function setPrototypeOf(target,proto){setProto.check(target,proto);try{setProto.set(target,proto);return true}catch(e){return false}};$def($def.G,{Reflect:{}});$def($def.S,"Reflect",reflect)},{"./$":16,"./$.assert":4,"./$.ctx":10,"./$.def":11,"./$.iter":15,"./$.own-keys":18,"./$.set-proto":21,"./$.uid":25}],49:[function(require,module,exports){var $=require("./$"),cof=require("./$.cof"),RegExp=$.g.RegExp,Base=RegExp,proto=RegExp.prototype;if($.FW&&$.DESC){if(!function(){try{return RegExp(/a/g,"i")=="/a/i"}catch(e){}}()){RegExp=function RegExp(pattern,flags){return new Base(cof(pattern)=="RegExp"&&flags!==undefined?pattern.source:pattern,flags)};$.each.call($.getNames(Base),function(key){key in RegExp||$.setDesc(RegExp,key,{configurable:true,get:function(){return Base[key]},set:function(it){Base[key]=it}})});proto.constructor=RegExp;RegExp.prototype=proto;$.hide($.g,"RegExp",RegExp)}if(/./g.flags!="g")$.setDesc(proto,"flags",{configurable:true,get:require("./$.replacer")(/^.*\/(\w*)$/,"$1")})}require("./$.species")(RegExp)},{"./$":16,"./$.cof":6,"./$.replacer":20,"./$.species":22}],50:[function(require,module,exports){"use strict";var strong=require("./$.collection-strong");require("./$.collection")("Set",{add:function add(value){return strong.def(this,value=value===0?0:value,value)}},strong)},{"./$.collection":9,"./$.collection-strong":7}],51:[function(require,module,exports){var $def=require("./$.def");$def($def.P,"String",{codePointAt:require("./$.string-at")(false)})},{"./$.def":11,"./$.string-at":23}],52:[function(require,module,exports){"use strict";var $=require("./$"),cof=require("./$.cof"),$def=require("./$.def"),toLength=$.toLength;$def($def.P,"String",{endsWith:function endsWith(searchString){if(cof(searchString)=="RegExp")throw TypeError();var that=String($.assertDefined(this)),endPosition=arguments[1],len=toLength(that.length),end=endPosition===undefined?len:Math.min(toLength(endPosition),len);searchString+="";return that.slice(end-searchString.length,end)===searchString}})},{"./$":16,"./$.cof":6,"./$.def":11}],53:[function(require,module,exports){var $def=require("./$.def"),toIndex=require("./$").toIndex,fromCharCode=String.fromCharCode;$def($def.S,"String",{fromCodePoint:function fromCodePoint(x){var res=[],len=arguments.length,i=0,code;while(len>i){code=+arguments[i++];if(toIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(code<65536?fromCharCode(code):fromCharCode(((code-=65536)>>10)+55296,code%1024+56320))}return res.join("")}})},{"./$":16,"./$.def":11}],54:[function(require,module,exports){"use strict";var $=require("./$"),cof=require("./$.cof"),$def=require("./$.def");$def($def.P,"String",{includes:function includes(searchString){if(cof(searchString)=="RegExp")throw TypeError();return!!~String($.assertDefined(this)).indexOf(searchString,arguments[1])}})},{"./$":16,"./$.cof":6,"./$.def":11}],55:[function(require,module,exports){var set=require("./$").set,at=require("./$.string-at")(true),ITER=require("./$.uid").safe("iter"),$iter=require("./$.iter"),step=$iter.step;$iter.std(String,"String",function(iterated){set(this,ITER,{o:String(iterated),i:0})},function(){var iter=this[ITER],O=iter.o,index=iter.i,point;if(index>=O.length)return step(1);point=at.call(O,index);iter.i+=point.length;return step(0,point)})},{"./$":16,"./$.iter":15,"./$.string-at":23,"./$.uid":25}],56:[function(require,module,exports){var $=require("./$"),$def=require("./$.def");$def($def.S,"String",{raw:function raw(callSite){var tpl=$.toObject(callSite.raw),len=$.toLength(tpl.length),sln=arguments.length,res=[],i=0;while(len>i){res.push(String(tpl[i++]));if(i<sln)res.push(String(arguments[i]))}return res.join("")}})},{"./$":16,"./$.def":11}],57:[function(require,module,exports){"use strict";var $=require("./$"),$def=require("./$.def");$def($def.P,"String",{repeat:function repeat(count){var str=String($.assertDefined(this)),res="",n=$.toInteger(count);if(n<0||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))if(n&1)res+=str;return res}})},{"./$":16,"./$.def":11}],58:[function(require,module,exports){"use strict";var $=require("./$"),cof=require("./$.cof"),$def=require("./$.def");$def($def.P,"String",{startsWith:function startsWith(searchString){if(cof(searchString)=="RegExp")throw TypeError();var that=String($.assertDefined(this)),index=$.toLength(Math.min(arguments[1],that.length));searchString+="";return that.slice(index,index+searchString.length)===searchString}})},{"./$":16,"./$.cof":6,"./$.def":11}],59:[function(require,module,exports){"use strict";var $=require("./$"),setTag=require("./$.cof").set,uid=require("./$.uid"),$def=require("./$.def"),keyOf=require("./$.keyof"),has=$.has,hide=$.hide,getNames=$.getNames,toObject=$.toObject,Symbol=$.g.Symbol,Base=Symbol,setter=false,TAG=uid.safe("tag"),SymbolRegistry={},AllSymbols={};function wrap(tag){var sym=AllSymbols[tag]=$.set($.create(Symbol.prototype),TAG,tag);$.DESC&&setter&&$.setDesc(Object.prototype,tag,{configurable:true,set:function(value){hide(this,tag,value)}});return sym}if(!$.isFunction(Symbol)){Symbol=function Symbol(description){if(this instanceof Symbol)throw TypeError("Symbol is not a constructor");return wrap(uid(description))};hide(Symbol.prototype,"toString",function(){return this[TAG]})}$def($def.G+$def.W,{Symbol:Symbol});var symbolStatics={"for":function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=Symbol(key)},keyFor:function keyFor(key){return keyOf(SymbolRegistry,key)},pure:uid.safe,set:$.set,useSetter:function(){setter=true},useSimple:function(){setter=false}};$.each.call(("hasInstance,isConcatSpreadable,iterator,match,replace,search,"+"species,split,toPrimitive,toStringTag,unscopables").split(","),function(it){var sym=require("./$.wks")(it);symbolStatics[it]=Symbol===Base?sym:wrap(sym)});setter=true;$def($def.S,"Symbol",symbolStatics);$def($def.S+$def.F*(Symbol!=Base),"Object",{getOwnPropertyNames:function getOwnPropertyNames(it){var names=getNames(toObject(it)),result=[],key,i=0;while(names.length>i)has(AllSymbols,key=names[i++])||result.push(key);return result},getOwnPropertySymbols:function getOwnPropertySymbols(it){var names=getNames(toObject(it)),result=[],key,i=0;while(names.length>i)has(AllSymbols,key=names[i++])&&result.push(AllSymbols[key]);return result}});setTag(Symbol,"Symbol");setTag(Math,"Math",true);setTag($.g.JSON,"JSON",true)},{"./$":16,"./$.cof":6,"./$.def":11,"./$.keyof":17,"./$.uid":25,"./$.wks":27}],60:[function(require,module,exports){"use strict";var $=require("./$"),weak=require("./$.collection-weak"),leakStore=weak.leakStore,ID=weak.ID,WEAK=weak.WEAK,has=$.has,isObject=$.isObject,isFrozen=Object.isFrozen||$.core.Object.isFrozen,tmp={};var WeakMap=require("./$.collection")("WeakMap",{get:function get(key){if(isObject(key)){if(isFrozen(key))return leakStore(this).get(key);if(has(key,WEAK))return key[WEAK][this[ID]]}},set:function set(key,value){return weak.def(this,key,value)}},weak,true,true);if($.FW&&(new WeakMap).set((Object.freeze||Object)(tmp),7).get(tmp)!=7){$.each.call(["delete","has","get","set"],function(key){var method=WeakMap.prototype[key];WeakMap.prototype[key]=function(a,b){if(isObject(a)&&isFrozen(a)){var result=leakStore(this)[key](a,b);return key=="set"?this:result}return method.call(this,a,b)}})}},{"./$":16,"./$.collection":9,"./$.collection-weak":8}],61:[function(require,module,exports){"use strict";var weak=require("./$.collection-weak");require("./$.collection")("WeakSet",{add:function add(value){return weak.def(this,value,true)}},weak,false,true)},{"./$.collection":9,"./$.collection-weak":8}],62:[function(require,module,exports){var $def=require("./$.def");$def($def.P,"Array",{includes:require("./$.array-includes")(true)});require("./$.unscope")("includes")},{"./$.array-includes":2,"./$.def":11,"./$.unscope":26}],63:[function(require,module,exports){var $=require("./$"),$def=require("./$.def"),ownKeys=require("./$.own-keys");$def($def.S,"Object",{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var O=$.toObject(object),result={};$.each.call(ownKeys(O),function(key){$.setDesc(result,key,$.desc(0,$.getDesc(O,key)))});return result}})},{"./$":16,"./$.def":11,"./$.own-keys":18}],64:[function(require,module,exports){var $=require("./$"),$def=require("./$.def");function createObjectToArray(isEntries){return function(object){var O=$.toObject(object),keys=$.getKeys(object),length=keys.length,i=0,result=Array(length),key;if(isEntries)while(length>i)result[i]=[key=keys[i++],O[key]];else while(length>i)result[i]=O[keys[i++]];return result}}$def($def.S,"Object",{values:createObjectToArray(false),entries:createObjectToArray(true)})},{"./$":16,"./$.def":11}],65:[function(require,module,exports){var $def=require("./$.def");$def($def.S,"RegExp",{escape:require("./$.replacer")(/([\\\-[\]{}()*+?.,^$|])/g,"\\$1",true)})},{"./$.def":11,"./$.replacer":20}],66:[function(require,module,exports){var $def=require("./$.def"),forOf=require("./$.iter").forOf;$def($def.P,"Set",{toJSON:function(){var arr=[];forOf(this,false,arr.push,arr);return arr}})},{"./$.def":11,"./$.iter":15}],67:[function(require,module,exports){var $def=require("./$.def");$def($def.P,"String",{at:require("./$.string-at")(true)})},{"./$.def":11,"./$.string-at":23}],68:[function(require,module,exports){var $=require("./$"),$def=require("./$.def"),$Array=$.core.Array||Array,statics={};function setStatics(keys,length){$.each.call(keys.split(","),function(key){if(length==undefined&&key in $Array)statics[key]=$Array[key];else if(key in[])statics[key]=require("./$.ctx")(Function.call,[][key],length)})}setStatics("pop,reverse,shift,keys,values,entries",1);setStatics("indexOf,every,some,forEach,map,filter,find,findIndex,includes",3);setStatics("join,slice,concat,push,splice,unshift,sort,lastIndexOf,"+"reduce,reduceRight,copyWithin,fill,turn");$def($def.S,"Array",statics)},{"./$":16,"./$.ctx":10,"./$.def":11}],69:[function(require,module,exports){require("./es6.array.iterator");var $=require("./$"),Iterators=require("./$.iter").Iterators,ITERATOR=require("./$.wks")("iterator"),NodeList=$.g.NodeList;if($.FW&&NodeList&&!(ITERATOR in NodeList.prototype)){$.hide(NodeList.prototype,ITERATOR,Iterators.Array)}Iterators.NodeList=Iterators.Array},{"./$":16,"./$.iter":15,"./$.wks":27,"./es6.array.iterator":34}],70:[function(require,module,exports){var $def=require("./$.def"),$task=require("./$.task");$def($def.G+$def.B,{setImmediate:$task.set,clearImmediate:$task.clear})},{"./$.def":11,"./$.task":24}],71:[function(require,module,exports){var $=require("./$"),$def=require("./$.def"),invoke=require("./$.invoke"),partial=require("./$.partial"),MSIE=!!$.g.navigator&&/MSIE .\./.test(navigator.userAgent);function wrap(set){return MSIE?function(fn,time){return set(invoke(partial,[].slice.call(arguments,2),$.isFunction(fn)?fn:Function(fn)),time)}:set}$def($def.G+$def.B+$def.F*MSIE,{setTimeout:wrap($.g.setTimeout),setInterval:wrap($.g.setInterval)})},{"./$":16,"./$.def":11,"./$.invoke":13,"./$.partial":19}],72:[function(require,module,exports){require("./modules/es5");require("./modules/es6.symbol");require("./modules/es6.object.assign");require("./modules/es6.object.is");require("./modules/es6.object.set-prototype-of");require("./modules/es6.object.to-string");require("./modules/es6.object.statics-accept-primitives");require("./modules/es6.function.name");require("./modules/es6.number.constructor");require("./modules/es6.number.statics");require("./modules/es6.math");require("./modules/es6.string.from-code-point");require("./modules/es6.string.raw");require("./modules/es6.string.iterator");require("./modules/es6.string.code-point-at");require("./modules/es6.string.ends-with");require("./modules/es6.string.includes");require("./modules/es6.string.repeat");require("./modules/es6.string.starts-with");require("./modules/es6.array.from");require("./modules/es6.array.of");require("./modules/es6.array.iterator");require("./modules/es6.array.species");require("./modules/es6.array.copy-within");require("./modules/es6.array.fill");require("./modules/es6.array.find");require("./modules/es6.array.find-index");require("./modules/es6.regexp");require("./modules/es6.promise");require("./modules/es6.map");require("./modules/es6.set");require("./modules/es6.weak-map");require("./modules/es6.weak-set");require("./modules/es6.reflect");require("./modules/es7.array.includes");require("./modules/es7.string.at");require("./modules/es7.regexp.escape");require("./modules/es7.object.get-own-property-descriptors");require("./modules/es7.object.to-array");require("./modules/es7.set.to-json");require("./modules/js.array.statics");require("./modules/web.timers");require("./modules/web.immediate");require("./modules/web.dom.iterable");module.exports=require("./modules/$").core},{"./modules/$":16,"./modules/es5":28,"./modules/es6.array.copy-within":29,"./modules/es6.array.fill":30,"./modules/es6.array.find":32,"./modules/es6.array.find-index":31,"./modules/es6.array.from":33,"./modules/es6.array.iterator":34,"./modules/es6.array.of":35,"./modules/es6.array.species":36,"./modules/es6.function.name":37,"./modules/es6.map":38,"./modules/es6.math":39,"./modules/es6.number.constructor":40,"./modules/es6.number.statics":41,"./modules/es6.object.assign":42,"./modules/es6.object.is":43,"./modules/es6.object.set-prototype-of":44,"./modules/es6.object.statics-accept-primitives":45,"./modules/es6.object.to-string":46,"./modules/es6.promise":47,"./modules/es6.reflect":48,"./modules/es6.regexp":49,"./modules/es6.set":50,"./modules/es6.string.code-point-at":51,"./modules/es6.string.ends-with":52,"./modules/es6.string.from-code-point":53,"./modules/es6.string.includes":54,"./modules/es6.string.iterator":55,"./modules/es6.string.raw":56,"./modules/es6.string.repeat":57,"./modules/es6.string.starts-with":58,"./modules/es6.symbol":59,"./modules/es6.weak-map":60,"./modules/es6.weak-set":61,"./modules/es7.array.includes":62,"./modules/es7.object.get-own-property-descriptors":63,"./modules/es7.object.to-array":64,"./modules/es7.regexp.escape":65,"./modules/es7.set.to-json":66,"./modules/es7.string.at":67,"./modules/js.array.statics":68,"./modules/web.dom.iterable":69,"./modules/web.immediate":70,"./modules/web.timers":71}],73:[function(require,module,exports){(function(global){!function(global){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var undefined;var iteratorSymbol=typeof Symbol==="function"&&Symbol.iterator||"@@iterator";var inModule=typeof module==="object";var runtime=global.regeneratorRuntime;if(runtime){if(inModule){module.exports=runtime}return}runtime=global.regeneratorRuntime=inModule?module.exports:{};function wrap(innerFn,outerFn,self,tryLocsList){var generator=Object.create((outerFn||Generator).prototype);generator._invoke=makeInvokeMethod(innerFn,self||null,new Context(tryLocsList||[]));return generator}runtime.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype;GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName="GeneratorFunction";runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};runtime.mark=function(genFun){genFun.__proto__=GeneratorFunctionPrototype;genFun.prototype=Object.create(Gp);return genFun};runtime.async=function(innerFn,outerFn,self,tryLocsList){return new Promise(function(resolve,reject){var generator=wrap(innerFn,outerFn,self,tryLocsList);var callNext=step.bind(generator,"next");var callThrow=step.bind(generator,"throw");function step(method,arg){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg);return}var info=record.arg;if(info.done){resolve(info.value)}else{Promise.resolve(info.value).then(callNext,callThrow)}}callNext()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){return doneResult()}while(true){var delegate=context.delegate;if(delegate){if(method==="return"||method==="throw"&&delegate.iterator.throw===undefined){context.delegate=null;var returnMethod=delegate.iterator.return;if(returnMethod){var record=tryCatch(returnMethod,delegate.iterator,arg);if(record.type==="throw"){method="throw";arg=record.arg;continue}}if(method==="return"){continue}}var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if(record.type==="throw"){context.delegate=null;method="throw";arg=record.arg;continue}method="next";arg=undefined;var info=record.arg;if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc}else{state=GenStateSuspendedYield;return info}context.delegate=null}if(method==="next"){if(state===GenStateSuspendedYield){context.sent=arg}else{delete context.sent}}else if(method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw arg}if(context.dispatchException(arg)){method="next";arg=undefined}}else if(method==="return"){context.abrupt("return",arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg===ContinueSentinel){if(context.delegate&&method==="next"){arg=undefined}}else{return info}}else if(record.type==="throw"){state=GenStateCompleted;method="throw";arg=record.arg}}}}function defineGeneratorMethod(method){Gp[method]=function(arg){return this._invoke(method,arg)}}defineGeneratorMethod("next");defineGeneratorMethod("throw");defineGeneratorMethod("return");Gp[iteratorSymbol]=function(){return this};Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset()}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}runtime.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(){this.prev=0;

this.next=0;this.sent=undefined;this.done=false;this.delegate=null;this.tryEntries.forEach(resetTryEntry);for(var tempIndex=0,tempName;hasOwn.call(this,tempName="t"+tempIndex)||tempIndex<20;++tempIndex){this[tempName]=null}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.next=finallyEntry.finallyLoc}else{this.complete(record)}return ContinueSentinel},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=record.arg;this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}return ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){return this.complete(entry.completion,entry.afterLoc)}}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};return ContinueSentinel}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1]);
define("lib/babel-polyfill/browser-polyfill", function(){});


define('lib-build/less!storymaps/tpl/core/MainView',[],function(){});

define('lib-build/css!storymaps/tpl/view/media/Common',[],function(){});
define('storymaps-react/tpl/core/Controller',['module', 'exports', 'dojo/_base/lang', 'dojo/topic', 'lib-build/i18n!./../../../resources/tpl/builder/nls/app', 'storymaps-react/tpl/view/media/Media'], function (module, exports, _lang, _topic, _app, _Media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _lang2 = _interopRequireDefault(_lang);

  var _topic2 = _interopRequireDefault(_topic);

  var _app2 = _interopRequireDefault(_app);

  var _Media2 = _interopRequireDefault(_Media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var storyMap = 'Story Map';

  var DEFAULT_HEADER_SETTINGS = {
    logo: {
      enabled: true,
      url: 'resources/tpl/viewer/icons/esri-logo.png',
      link: 'https://www.esri.com'
    },
    link: {
      url: 'https://storymaps.arcgis.com',
      title: _app2.default.builder.header.defaultTagline.replace(/\${STORY_MAP}/g, storyMap)
    },
    social: {
      enabled: true
    }
  };

  var Controller = function () {
    function Controller() {
      _classCallCheck(this, Controller);
    }

    _createClass(Controller, null, [{
      key: 'getStoryTitle',
      value: function getStoryTitle() {
        var coverSection = this._sections && this._sections[0];

        if (coverSection) {
          return coverSection.getPreviewText();
        }

        return '';
      }
    }, {
      key: 'getStoryURL',
      value: function getStoryURL() {
        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        var url = params.url || document.location.href;

        // If sharing in builder mode the link will always open the viewer
        // TODO clean, should get all url parameters, filter edit and rebuild URL
        url = url.replace(/\?edit(=.*)*&/, '?');
        url = url.replace(/\&edit(=.*)*/, '');
        url = url.replace(/\?edit/, '');

        // Filter out locale URL
        url = url.replace(/\?locale(=[a-zA-Z\-]+)+&/, '?');
        url = url.replace(/\&locale(=[a-zA-Z\-]+)+/, '');

        return params.urlEncoding ? encodeURIComponent(url) : url;
      }
    }, {
      key: 'isStoryBlank',
      value: function isStoryBlank() {
        if (!app.data.appItem || !app.data.appItem.data || !app.data.appItem.data.values || !app.data.appItem.data.values.config || !app.data.appItem.data.values.settings || !app.data.appItem.data.values.sections || !app.data.appItem.data.values.template) {
          return true;
        }

        return false;
      }
    }, {
      key: 'renderHeader',
      value: function renderHeader() {
        var appItem = app.data.appItem,
            headerSettings = appItem ? appItem.data.values.settings.header : null;

        if (!headerSettings || !headerSettings.logo || !headerSettings.link) {
          headerSettings = Controller.DEFAULT_HEADER_SETTINGS;
        }

        app.ui.header.render({
          logo: headerSettings.logo,
          link: headerSettings.link,
          social: headerSettings.social,
          bookmarks: this.getBookmarks(),
          title: this.getStoryTitle()
        });
      }
    }, {
      key: 'renderStory',
      value: function renderStory(config, sections) {
        this._sections = [];
        this._currentSection = null;
        this._$currentSection = null;
        this._currentSectionIndex = null;
        this._container = $('.sections');

        var errorInPreviousSection = false,
            sectionsLength = sections.length;

        app.data.errorWebGL = false;

        // Merge consecutive sequence sections
        // This always run in viewer and builder before the story is parsed
        // It's a V1 legacy, it was too easy to create that kind of situation
        // As this is an extra loop, could consider merging that with next loop
        // Or performing this only if the story has not been edited since V1 (see version tracked in item data)
        var prevSectionType = '';
        for (var i = sections.length - 1; i >= 0; i--) {
          var section = sections[i];

          if (section.type == 'sequence' && prevSectionType == 'sequence') {
            section.foreground.blocks = section.foreground.blocks.concat(sections[i + 1].foreground.blocks);
            sections.splice(i + 1, 1);
          }

          prevSectionType = section.type;
        }

        //
        // Add the story to the dom
        // TODO: need to check if the story has at least cover and another section
        // TODO: benchmark lazy load creation with fake scrollbar
        //

        $.each(sections, function (index, section) {
          var error = false,
              newSection = app.ui.SectionFactory.createInstance(section);

          if (newSection) {
            // If it's an alternate section but there hasn't been any error
            //  in previous section, we can ignore
            if (section.alternate === true && !errorInPreviousSection) {
              return;
            }

            try {
              this._container.append(newSection.render(index));
            } catch (e) {
              console.error(e);

              error = true;
              errorInPreviousSection = true;

              // A WEBGL error can either reject the whole section
              //  like if the author has defined an alternate section
              //  in that case the section is not rendered at all
              // Or the section might be displayed and the media will show an error
              //  it's the section that decide what it wants
              // RUNTIME-NO-WEBGL is throwned only if the whole section is ignored
              if (e == 'RUNTIME-NO-WEBGL') {
                app.data.errorWebGL = true;
              }
            }

            if (!error) {
              this._sections.push(newSection);
            }
          }

          // If there has been and error with WebGL
          // If rendering the section before credits
          // Or the last section if no credits
          if (app.data.errorWebGL) {
            if (app.isInBuilder && (index == sectionsLength - 3 && sections[index + 1].type == 'credits-placeholder' || index == sectionsLength - 2 && sections[index + 1].type == 'credits-placeholder') || !app.isInBuilder && (index == sectionsLength - 2 && sections[index + 1].type == 'credits' || index == sectionsLength - 1 && section.type != 'credits')) {
              var errorSection = this.getErrorSection({
                type: app.data.errorWebGL ? 'WEBGL' : ''
              });

              if (errorSection) {
                this._sections.push(errorSection);
                this._container.append(errorSection.render(index));
              }
            }
          }
        }.bind(this));

        app.data.sections = this._sections;
        app.data.sectionsJSON = sections;

        app.data.title = app.Controller.getStoryTitle();
        document.title = app.data.title;

        //
        // Now that everything is in the DOM, call postCreate on every section
        //  which will call similar method on every view and media
        // Primary goal is for everyone to have a reference to it's DOM container
        //

        $('.section').each(function (i, node) {
          this._sections[i].postCreate($(node));
        }.bind(this));
      }
    }, {
      key: 'getBookmarks',
      value: function getBookmarks() {
        var bookmarks = [];

        $.each(this._sections, function (i, section) {
          if (section.getBookmark) {
            var bookmark = section.getBookmark();

            if (bookmark && bookmark.status == 'visible') {
              bookmarks.push({
                index: i,
                title: bookmark.bookmark
              });
            }
          }
        });

        return bookmarks;
      }
    }, {
      key: 'preloadSectionByIndex',
      value: function preloadSectionByIndex(index) {
        this.preloadSection(this._sections[index], {});
      }
    }, {
      key: 'preloadSection',
      value: function preloadSection(section, params) {
        if (!section) {
          return;
        }

        window.requestAnimationFrame(function () {
          section.onScroll(_lang2.default.mixin(params, {
            status: 'preload'
          }));
        });
      }
    }, {
      key: 'toggleScrollEvents',
      value: function toggleScrollEvents(enable) {
        this._disableScrollEvents = !enable;
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        var newSection = this._sections[params.currentSectionIndex];

        // tried different things to remove jank
        //  - delay action on prev section
        //  - have bg be taller calc(100vh + 10px)
        // ...

        if (!newSection || this._disableScrollEvents) {
          return;
        }

        var sectionTop = app.display.sections[params.currentSectionIndex].top;

        newSection.onScroll(_lang2.default.mixin(params, {
          status: 'current',
          viewportTop: params.scrollTop - sectionTop,
          viewportBottom: params.scrollTop + app.display.sectionHeight - sectionTop
        }));

        // If changing section
        if (params.currentSectionIndex != this._currentSectionIndex) {
          console.log('Scroll to section ', params.currentSectionIndex);

          // Activate new section
          params.$currentSection.addClass('active');

          // Dev event
          _topic2.default.publish('story-navigated-section', {
            index: params.currentSectionIndex,
            data: this._currentSection
          });

          //
          // Preload next section
          //

          var nextSection = this._sections[params.currentSectionIndex + 1];

          if (nextSection) {
            if (params.currentSectionIndex != this._currentSectionIndex) {
              this.preloadSection(nextSection, params);
            }
          }

          //
          // Unload previous section
          //

          var currentSection = this._currentSection;
          var currentSectionEl = this._$currentSection;

          if (currentSectionEl) {
            window.requestAnimationFrame(function () {
              currentSectionEl.removeClass('active');
              currentSection.onScroll({ status: 'unload' });
            });
          }
        }

        //
        // Refresh visible sections
        //

        $.each(params.visibleSections, function (i, sectionIndex) {
          var section = this._sections[sectionIndex],
              sectionTop = app.display.sections[sectionIndex].top;

          //console.log('Visible  section ' + sectionIndex);

          // Skip current section that already got one event sent
          if (sectionIndex == params.currentSectionIndex) {
            return;
          }

          section.onScroll(_lang2.default.mixin(params, {
            status: 'visible',
            viewportTop: params.scrollTop - sectionTop,
            viewportBottom: params.scrollTop + app.display.sectionHeight - sectionTop
          }));
        }.bind(this));

        //
        // Save references
        //

        this._$currentSection = params.$currentSection;
        this._currentSectionIndex = params.currentSectionIndex;
        this._currentSection = newSection;
      }
    }, {
      key: 'onResize',
      value: function onResize(params) {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._sections[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var section = _step.value;

            section.resize(params);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }, {
      key: 'navigateToSection',
      value: function navigateToSection() {
        var _this = this;

        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        return new Promise(function (resolve) {
          if (params.index == undefined || params.animate == undefined) {
            return;
          }

          if (params.index > app.display.sections.length - 1) {
            return;
          }

          var HEADER_HEIGHT = 50;

          var sectionType = _this._sections[params.index].type,
              sectionTop = app.display.sections[params.index].top,
              sectionOffset = 1,
              newScrollPos = 0;

          // So that the panel get displayed
          if (sectionType == 'immersive') {
            // TODO should be given by Immersive
            sectionOffset = app.display.windowHeight - 250 + HEADER_HEIGHT;
            if (app.isInBuilder) {
              // Builder view panel
              sectionOffset += 125;
            }
          }

          newScrollPos = Math.floor(sectionTop - HEADER_HEIGHT + sectionOffset);

          if (params.animate) {
            //if (params.disableEvents) {
            _this.toggleScrollEvents(false);
            //}

            $('html,body').animate({
              scrollTop: newScrollPos
            }, {
              duration: params.animateSpeed || 400
            }).promise().then(function () {
              //if (params.disableEvents) {
              this.toggleScrollEvents(true);
              // So that stuff get updated once at destination
              // Just updating the position doesn't work for the last section if it's not tall enough to fill the height
              // That update method should be integrated into the Controller and keep MainView for catching Scroll Events
              // TODO
              app.ui.update({
                forceUpdate: true
              });
              resolve(params.index);
              //}
            }.bind(_this));
          } else {
            document.body.scrollTop = newScrollPos;
            // Firefox
            document.documentElement.scrollTop = newScrollPos;

            resolve(params.index);
          }
        });
      }
    }, {
      key: 'getSectionById',
      value: function getSectionById(sectionId) {
        for (var sectionIndex in this._sections) {
          var section = this._sections[sectionIndex];

          if (section.id == sectionId) {
            return parseInt(sectionIndex, 10);
          }
        }

        return -1;
      }
    }, {
      key: 'getSectionIndexById',
      value: function getSectionIndexById(sectionIndex) {
        return this._sections[sectionIndex].id;
      }
    }, {
      key: 'getErrorSection',
      value: function getErrorSection(params) {
        params = params || {};

        var errorSection = null;

        if (params.type == 'WEBGL') {
          var storyWarningBtn = 'mailto:?to=&subject=Check%20out%20this%20story&body=' + document.location.href;

          errorSection = app.ui.SectionFactory.createInstance({
            type: 'sequence',
            layout: 'sequence-2',
            background: {
              type: 'color',
              color: {
                value: '#FFF'
              }
            },
            foreground: {
              blocks: [{
                type: 'text',
                text: {
                  value: '<div class="block"><table><tr><td style="padding-bottom: 10px;"><img src="resources/tpl/viewer/icons/warning-mobile-smartphone.png" /></td><td style="padding-bottom: 10px; padding-left: 13px;">You\'ve read the mobile version of this story. For the full version, with richer media elements try it out on a desktop computer.</td></tr><tr><td colspan="2" style="padding-top: 10px; border-top: 1px solid white; text-align: center;"><a class="btn btn-warning-email" style="background-color: white; color: rgba(255, 0, 0, 0.7);" href="' + storyWarningBtn + '"><img src="resources/tpl/viewer/icons/warning-mobile-laptop.png" style="margin-right: 5px;"/>Email a link to this story</a></td></tr></table></div>'
                }
              }]
            }
          });
        }

        return errorSection;
      }
    }, {
      key: 'getArcGISContent',
      value: function getArcGISContent() {
        var arcgisContent = [];

        var appData = app.data.appItem && app.data.appItem.data && app.data.appItem.data.values,
            headerLogo = appData && appData.settings && appData.settings.header && appData.settings.header.logo;

        if (headerLogo && headerLogo.enabled && headerLogo.url) {
          var headerArcGISLogo = _Media2.default.getArcGISItemResourceURL(headerLogo.url);
          if (headerArcGISLogo) {
            arcgisContent.push({
              type: 'item-resource',
              mediaType: 'image',
              url: headerArcGISLogo.url,
              file: headerArcGISLogo.file
            });
          }
        }

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._sections[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var section = _step2.value;

            arcgisContent.push.apply(arcgisContent, _toConsumableArray(section.getArcGISContent()));
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        return arcgisContent;
      }
    }, {
      key: 'DEFAULT_HEADER_SETTINGS',
      get: function get() {
        return DEFAULT_HEADER_SETTINGS;
      }
    }]);

    return Controller;
  }();

  exports.default = Controller;
  module.exports = exports['default'];
});
//# sourceMappingURL=Controller.js.map
;
(function(l,e){"object"===typeof exports?e(exports):"function"===typeof define&&define.amd?define('lib/progress.js/minified/progress.min',["exports"],e):e(l)})(this,function(l){function e(a){this._targetElement="undefined"!=typeof a.length?a:[a];"undefined"===typeof window._progressjsId&&(window._progressjsId=1);"undefined"===typeof window._progressjsIntervals&&(window._progressjsIntervals={});this._options={theme:"blue",overlayMode:!1,considerTransition:!0}}function m(a,c){var d=this;100<=c&&(c=100);a.hasAttribute("data-progressjs")&&
setTimeout(function(){"undefined"!=typeof d._onProgressCallback&&d._onProgressCallback.call(d,a,c);var b=h(a);b.style.width=parseInt(c)+"%";var b=b.querySelector(".progressjs-percent"),g=parseInt(b.innerHTML.replace("%","")),e=parseInt(c),j=function(a,b,c){var d=Math.abs(b-c);3>d?k=30:20>d?k=20:intervanIn=1;0!=b-c&&(a.innerHTML=(f?++b:--b)+"%",setTimeout(function(){j(a,b,c)},k))},f=!0;g>e&&(f=!1);var k=10;j(b,g,e)},50)}function h(a){a=parseInt(a.getAttribute("data-progressjs"));return document.querySelector('.progressjs-container > .progressjs-progress[data-progressjs="'+
a+'"] > .progressjs-inner')}function p(a){for(var c=0,d=this._targetElement.length;c<d;c++){var b=this._targetElement[c];if(b.hasAttribute("data-progressjs")){var g=h(b);(g=parseInt(g.style.width.replace("%","")))&&m.call(this,b,g+(a||1))}}}function q(){var a,c=document.createElement("fakeelement"),d={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in d)if(void 0!==c.style[a])return d[a]}var n=function(a){if("object"===
typeof a)return new e(a);if("string"===typeof a){if(a=document.querySelectorAll(a))return new e(a);throw Error("There is no element with given selector.");}return new e(document.body)};n.version="0.1.0";n.fn=e.prototype={clone:function(){return new e(this)},setOption:function(a,c){this._options[a]=c;return this},setOptions:function(a){var c=this._options,d={},b;for(b in c)d[b]=c[b];for(b in a)d[b]=a[b];this._options=d;return this},start:function(){"undefined"!=typeof this._onBeforeStartCallback&&
this._onBeforeStartCallback.call(this);if(!document.querySelector(".progressjs-container")){var a=document.createElement("div");a.className="progressjs-container";document.body.appendChild(a)}for(var a=0,c=this._targetElement.length;a<c;a++){var d=this._targetElement[a];if(!d.hasAttribute("data-progressjs")){var b=d,g,e,j;"body"===b.tagName.toLowerCase()?(g=b.clientWidth,e=b.clientHeight):(g=b.offsetWidth,e=b.offsetHeight);for(var f=j=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)j+=b.offsetLeft,
f+=b.offsetTop,b=b.offsetParent;b=f;d.setAttribute("data-progressjs",window._progressjsId);f=document.createElement("div");f.className="progressjs-progress progressjs-theme-"+this._options.theme;f.style.position="body"===d.tagName.toLowerCase()?"fixed":"absolute";f.setAttribute("data-progressjs",window._progressjsId);var k=document.createElement("div");k.className="progressjs-inner";var h=document.createElement("div");h.className="progressjs-percent";h.innerHTML="1%";k.appendChild(h);this._options.overlayMode&&
"body"===d.tagName.toLowerCase()?(f.style.left=0,f.style.right=0,f.style.top=0,f.style.bottom=0):(f.style.left=j+"px",f.style.top=b+"px",f.style.width=g+"px",this._options.overlayMode&&(f.style.height=e+"px"));f.appendChild(k);document.querySelector(".progressjs-container").appendChild(f);m(d,1);++window._progressjsId}}return this},set:function(a){for(var c=0,d=this._targetElement.length;c<d;c++)m.call(this,this._targetElement[c],a);return this},increase:function(a){p.call(this,a);return this},autoIncrease:function(a,
c){var d=this,b=parseInt(this._targetElement[0].getAttribute("data-progressjs"));"undefined"!=typeof window._progressjsIntervals[b]&&clearInterval(window._progressjsIntervals[b]);window._progressjsIntervals[b]=setInterval(function(){p.call(d,a)},c);return this},end:function(){a:{"undefined"!=typeof this._onBeforeEndCallback&&(!0===this._options.considerTransition?h(this._targetElement[0]).addEventListener(q(),this._onBeforeEndCallback,!1):this._onBeforeEndCallback.call(this));for(var a=parseInt(this._targetElement[0].getAttribute("data-progressjs")),
c=0,d=this._targetElement.length;c<d;c++){var b=this._targetElement[c],e=h(b);if(!e)break a;var l=1;100>parseInt(e.style.width.replace("%",""))&&(m.call(this,b,100),l=500);(function(a,b){setTimeout(function(){a.parentNode.className+=" progressjs-end";setTimeout(function(){a.parentNode.parentNode.removeChild(a.parentNode);b.removeAttribute("data-progressjs")},1E3)},l)})(e,b)}if(window._progressjsIntervals[a])try{clearInterval(window._progressjsIntervals[a]),window._progressjsIntervals[a]=null,delete window._progressjsIntervals[a]}catch(j){}}return this},
onbeforeend:function(a){if("function"===typeof a)this._onBeforeEndCallback=a;else throw Error("Provided callback for onbeforeend was not a function");return this},onbeforestart:function(a){if("function"===typeof a)this._onBeforeStartCallback=a;else throw Error("Provided callback for onbeforestart was not a function");return this},onprogress:function(a){if("function"===typeof a)this._onProgressCallback=a;else throw Error("Provided callback for onprogress was not a function");return this}};return l.progressJs=
n});


define('lib-build/css!lib/progress.js/minified/progressjs.min',[],function(){});

define('lib-build/less!storymaps/tpl/view/ui/ProgressBar',[],function(){});
define('storymaps/tpl/view/ui/ProgressBar',[
  'lib/progress.js/minified/progress.min',
  'lib-build/css!lib/progress.js/minified/progressjs.min',
  'lib-build/less!./ProgressBar'
], function(
  ProgressJs
) {
  return function ProgressBar(/*container, isInBuilder*/) {

    var _progressBar = new ProgressJs();

    this.start = function() {
      _progressBar.start();
    };

    this.update = function(progress) {
      _progressBar.set(progress);
    };
  };
});


define('lib-build/hbars!storymaps-react/tpl/view/ui/Bookmark', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;
  return "<li class=\"bookmark\" data-index=\""
    + escapeExpression(((helper = (helper = helpers.index || (depth0 != null ? depth0.index : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"index","hash":{},"data":data}) : helper)))
    + "\">"
    + escapeExpression(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"title","hash":{},"data":data}) : helper)))
    + "</li>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/view/ui/BookmarksMore', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, buffer = "<li class=\"dropdown bookmark-dropdown\">\r\n	<a class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n		<span class=\"glyphicon glyphicon-th-list\"></span> <span class=\"caret\"></span>\r\n	</a>\r\n	<ul class=\"dropdown-menu dropdown-menu-right\">\r\n		";
  stack1 = ((helper = (helper = helpers.bookmarks || (depth0 != null ? depth0.bookmarks : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"bookmarks","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "\r\n	</ul>\r\n</li>\r\n";
},"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/ui/Bookmarks',[],function(){});
define('storymaps-react/tpl/view/ui/Bookmarks',['module', 'exports', 'lib-build/hbars!./Bookmark', 'lib-build/hbars!./BookmarksMore', 'lib-build/less!./Bookmarks'], function (module, exports, _Bookmark, _BookmarksMore) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Bookmark2 = _interopRequireDefault(_Bookmark);

  var _BookmarksMore2 = _interopRequireDefault(_BookmarksMore);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var Bookmarks = function () {
    function Bookmarks(container) {
      _classCallCheck(this, Bookmarks);

      this.container = container;
      this.bookmarkIndex = 0;
      this.bookmarkNavigationInProgress = false;
    }

    _createClass(Bookmarks, [{
      key: 'update',
      value: function update(sectionIndex) {
        this.showBookmarkIndex(sectionIndex);
      }
    }, {
      key: 'resize',
      value: function resize() {
        var _this = this;

        var availableWidthForTabs = this.container.width();
        // start by hiding the dropdown and its button
        this.container.children('li').addClass('visible');
        this.container.find('.dropdown').removeClass('visible');
        this.container.find('.dropdown-menu li').removeClass('visible');

        var widthCounter = 0;
        var index = 0;
        var displayMoreButton = false;
        var bookmarks = this.container.children('.bookmark');
        var moreButtonSize = this.container.find('li.dropdown').outerWidth(true);

        bookmarks.each(function (i, elem) {
          var element = $(elem);

          index++;
          // find the width of the bookmark
          widthCounter += element.outerWidth(true);

          var tooWideWithBookmark = widthCounter > availableWidthForTabs;
          var tooWideWithBookmarkAndMoreButton = widthCounter + moreButtonSize > availableWidthForTabs;
          var notLastBookmark = index < bookmarks.length;

          // If adding the button would overflow
          //  or if adding the button and the more button would overflow and there is more bookmarks to come
          if (tooWideWithBookmark || tooWideWithBookmarkAndMoreButton && notLastBookmark) {
            // display the 'more' button, hide the bookmark from the horizontal list, and show the bookmark in the dropdown list
            displayMoreButton = true;
            element.removeClass('visible');
            _this.container.find('.dropdown-menu li').eq(element.index()).addClass('visible');
          }
        });

        var activeBookmark = this.container.children('.bookmark.active');
        var activeBookmarkDropdown = this.container.find('.dropdown-menu li.active');

        // The active bookmark is not visible -> the active bookmark is now in the dropdown list
        if (activeBookmark.length && !activeBookmark.hasClass('visible')) {
          // remove the active class from the horizontal list (the item is already hidden in that list)
          // then add the active class to the dropdown item
          // then make the dropdown active.
          activeBookmark.removeClass('active');
          this.container.find('.nav-tabs .dropdown-menu li').eq(activeBookmark.index()).addClass('active');
          this.container.find('.nav-tabs > .dropdown').addClass('active');
        }
        // The active bookmark in the dropdown is not visible -> the active bookmark is now visible in the main list
        else if (activeBookmarkDropdown.length && !activeBookmarkDropdown.hasClass('visible')) {
            // remove the active class from the dropdown bookmark (it's already hidden there)
            // then add the active class to the bookmark in the horizontal list
            // and then make the dropdown inactive.
            activeBookmarkDropdown.removeClass('active');
            this.container.find('.nav-tabs > .bookmark').eq(activeBookmarkDropdown.index()).addClass('active');
            this.container.find('.nav-tabs > .dropdown').removeClass('active');
          }

        if (displayMoreButton) {
          // show the dropdown
          this.container.find('.dropdown').addClass('visible');
        }
      }
    }, {
      key: 'updateVisibleBookmark',
      value: function updateVisibleBookmark(index) {
        // take array of all the elements that are at or below the index.
        var possibleBookmarks = this.container.find('.bookmark.visible').filter(function (i, item) {
          return $(item).data('index') <= index;
        });
        // take the last one (the one that either HAS this index or is the closest, but below, to it.)
        if (possibleBookmarks.length) {
          $(possibleBookmarks[possibleBookmarks.length - 1]).addClass('active');
        }
      }
    }, {
      key: 'showBookmarkIndex',
      value: function showBookmarkIndex(index) {
        if (!this.bookmarkNavigationInProgress) {

          if (!index && index !== 0) {
            index = this.bookmarkIndex;
          }

          this.container.find('li, .bookmark').removeClass('active');

          this.updateVisibleBookmark(index);

          // when you get to an index that is NOT in the visible list, show the dropdown selected.
          // active bookmark's parent is dropdown? No? then OK...
          var inDropdown = this.container.find('.bookmark.active').closest('.bookmark-dropdown').length > 0;
          // The bookmark is in the dropdown
          if (inDropdown) {
            this.container.find('.dropdown').addClass('active');

            if (!app.isLoading) {
              // Open the dropdown if not open
              if (!this.container.find('.dropdown').hasClass('open')) {
                this.container.find('.dropdown-toggle').click();
              }
            }
          }
          // The bookmark is visible
          else {
              if (!app.isLoading) {
                // Close the dropdown if open
                if (this.container.find('.dropdown').hasClass('open')) {
                  this.container.find('.dropdown-toggle').click();
                }
              }
            }

          this.bookmarkIndex = index;
        }
      }
    }, {
      key: 'render',
      value: function render(bookmarks) {
        if (!bookmarks) {
          bookmarks = [];
        }

        var bookmarksHTML = '';

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = bookmarks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var bookmark = _step.value;

            bookmarksHTML += (0, _Bookmark2.default)(bookmark);
          }

          // populates the list AND the dropdown with the bookmarks
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        this.container.html(bookmarksHTML + (0, _BookmarksMore2.default)({ bookmarks: bookmarksHTML }));

        this.addEvents();

        this.resize();
        this.showBookmarkIndex();
      }
    }, {
      key: 'addEvents',
      value: function addEvents() {
        var _this2 = this;

        this.container.find('.bookmark').off('click').on('click', function (event) {
          _this2.onBookmarkNavigate($(event.currentTarget));
        });
      }
    }, {
      key: 'onBookmarkNavigate',
      value: function onBookmarkNavigate(target) {
        var _this3 = this;

        var index = target.data('index');

        this.bookmarkNavigationInProgress = true;

        app.Controller.navigateToSection({
          index: index,
          animate: true
        }).then(function () {
          // but when all the way done, no more updates called on header... so have to tell it manually, which could be off... not a good idea.
          // unless look at app's selected section
          _this3.bookmarkNavigationInProgress = false;
          _this3.showBookmarkIndex(index);
        });
      }
    }]);

    return Bookmarks;
  }();

  exports.default = Bookmarks;
  module.exports = exports['default'];
});
//# sourceMappingURL=Bookmarks.js.map
;
define('lib-build/tpl',{load: function(id){throw new Error("Dynamic load not allowed: " + id);}});

define('lib-build/tpl!storymaps/common/ui/share/ShareDialog', [],function () { return function(obj){obj||(obj={});var __t,__p='',__e=_.escape;with(obj){__p+='<div class="modal-dialog">\r\n  <div class="modal-content">\r\n\r\n    <div class="modal-logo"></div>\r\n    <div class="modal-header">\r\n      <h4 class="modal-title"></h4>\r\n    </div>\r\n\r\n    <div class="modal-body">\r\n      <div class="share-url-social">\r\n        <div class="share-url-panel"></div>\r\n        <div class="share-social-container">\r\n          <i class="social-icon share_facebook fa fa-facebook-square"></i>\r\n          <i class="social-icon share_twitter fa fa-twitter"></i>\r\n        </div>\r\n      </div>\r\n\r\n      <div class="embed-title"></div>\r\n      <div class="share-embed-panel"></div>\r\n\r\n      <div class="checkbox autoplay-container">\r\n        <label>\r\n          <input type="checkbox" class="autoplay-checkbox" value="autoplay" />\r\n          <span class="autoplay-label"></span>\r\n        </label>\r\n        <span class="help autoplay-help" data-toggle="tooltip">\r\n          <i class="fa fa-question-circle" aria-hidden="true"></i>\r\n        </span>\r\n        <span class="autoplay-notification"></span>\r\n      </div>\r\n    </div>\r\n\r\n    <div class="modal-footer">\r\n      <button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal"></button>\r\n    </div>\r\n  </div>\r\n</div>\r\n';}return __p}; });


define('lib-build/css!storymaps/common/ui/share/ShareDialog',[],function(){});

define('lib-build/less!storymaps/common/ui/share/ShareDialog',[],function(){});

define('lib-build/tpl!storymaps/common/ui/share/ShareURLPanel', [],function () { return function(obj){obj||(obj={});var __t,__p='',__e=_.escape;with(obj){__p+='<div class="share-url-container">\r\n\t<span class="share-btn glyphicon glyphicon-copy"></span>\r\n\t<input type="text" class="form-control bitlylink" readonly="true"/>\r\n\t<a class="btn btn-primary btn-bitlylink-open" target="_blank"></a>\r\n\t<div class="share-status-wrapper"><span class="share-status"></span></div>\r\n</div>\r\n';}return __p}; });


define('lib-build/css!storymaps/common/ui/share/ShareURLPanel',[],function(){});
/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2014 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.2.0
 */
(function(window, undefined) {
  "use strict";
  /**
 * Store references to critically important global functions that may be
 * overridden on certain web pages.
 */
  var _window = window, _document = _window.document, _navigator = _window.navigator, _setTimeout = _window.setTimeout, _clearTimeout = _window.clearTimeout, _setInterval = _window.setInterval, _clearInterval = _window.clearInterval, _getComputedStyle = _window.getComputedStyle, _encodeURIComponent = _window.encodeURIComponent, _ActiveXObject = _window.ActiveXObject, _Error = _window.Error, _parseInt = _window.Number.parseInt || _window.parseInt, _parseFloat = _window.Number.parseFloat || _window.parseFloat, _isNaN = _window.Number.isNaN || _window.isNaN, _now = _window.Date.now, _keys = _window.Object.keys, _defineProperty = _window.Object.defineProperty, _hasOwn = _window.Object.prototype.hasOwnProperty, _slice = _window.Array.prototype.slice, _unwrap = function() {
    var unwrapper = function(el) {
      return el;
    };
    if (typeof _window.wrap === "function" && typeof _window.unwrap === "function") {
      try {
        var div = _document.createElement("div");
        var unwrappedDiv = _window.unwrap(div);
        if (div.nodeType === 1 && unwrappedDiv && unwrappedDiv.nodeType === 1) {
          unwrapper = _window.unwrap;
        }
      } catch (e) {}
    }
    return unwrapper;
  }();
  /**
 * Convert an `arguments` object into an Array.
 *
 * @returns The arguments as an Array
 * @private
 */
  var _args = function(argumentsObj) {
    return _slice.call(argumentsObj, 0);
  };
  /**
 * Shallow-copy the owned, enumerable properties of one object over to another, similar to jQuery's `$.extend`.
 *
 * @returns The target object, augmented
 * @private
 */
  var _extend = function() {
    var i, len, arg, prop, src, copy, args = _args(arguments), target = args[0] || {};
    for (i = 1, len = args.length; i < len; i++) {
      if ((arg = args[i]) != null) {
        for (prop in arg) {
          if (_hasOwn.call(arg, prop)) {
            src = target[prop];
            copy = arg[prop];
            if (target !== copy && copy !== undefined) {
              target[prop] = copy;
            }
          }
        }
      }
    }
    return target;
  };
  /**
 * Return a deep copy of the source object or array.
 *
 * @returns Object or Array
 * @private
 */
  var _deepCopy = function(source) {
    var copy, i, len, prop;
    if (typeof source !== "object" || source == null || typeof source.nodeType === "number") {
      copy = source;
    } else if (typeof source.length === "number") {
      copy = [];
      for (i = 0, len = source.length; i < len; i++) {
        if (_hasOwn.call(source, i)) {
          copy[i] = _deepCopy(source[i]);
        }
      }
    } else {
      copy = {};
      for (prop in source) {
        if (_hasOwn.call(source, prop)) {
          copy[prop] = _deepCopy(source[prop]);
        }
      }
    }
    return copy;
  };
  /**
 * Makes a shallow copy of `obj` (like `_extend`) but filters its properties based on a list of `keys` to keep.
 * The inverse of `_omit`, mostly. The big difference is that these properties do NOT need to be enumerable to
 * be kept.
 *
 * @returns A new filtered object.
 * @private
 */
  var _pick = function(obj, keys) {
    var newObj = {};
    for (var i = 0, len = keys.length; i < len; i++) {
      if (keys[i] in obj) {
        newObj[keys[i]] = obj[keys[i]];
      }
    }
    return newObj;
  };
  /**
 * Makes a shallow copy of `obj` (like `_extend`) but filters its properties based on a list of `keys` to omit.
 * The inverse of `_pick`.
 *
 * @returns A new filtered object.
 * @private
 */
  var _omit = function(obj, keys) {
    var newObj = {};
    for (var prop in obj) {
      if (keys.indexOf(prop) === -1) {
        newObj[prop] = obj[prop];
      }
    }
    return newObj;
  };
  /**
 * Remove all owned, enumerable properties from an object.
 *
 * @returns The original object without its owned, enumerable properties.
 * @private
 */
  var _deleteOwnProperties = function(obj) {
    if (obj) {
      for (var prop in obj) {
        if (_hasOwn.call(obj, prop)) {
          delete obj[prop];
        }
      }
    }
    return obj;
  };
  /**
 * Determine if an element is contained within another element.
 *
 * @returns Boolean
 * @private
 */
  var _containedBy = function(el, ancestorEl) {
    if (el && el.nodeType === 1 && el.ownerDocument && ancestorEl && (ancestorEl.nodeType === 1 && ancestorEl.ownerDocument && ancestorEl.ownerDocument === el.ownerDocument || ancestorEl.nodeType === 9 && !ancestorEl.ownerDocument && ancestorEl === el.ownerDocument)) {
      do {
        if (el === ancestorEl) {
          return true;
        }
        el = el.parentNode;
      } while (el);
    }
    return false;
  };
  /**
 * Get the URL path's parent directory.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getDirPathOfUrl = function(url) {
    var dir;
    if (typeof url === "string" && url) {
      dir = url.split("#")[0].split("?")[0];
      dir = url.slice(0, url.lastIndexOf("/") + 1);
    }
    return dir;
  };
  /**
 * Get the current script's URL by throwing an `Error` and analyzing it.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getCurrentScriptUrlFromErrorStack = function(stack) {
    var url, matches;
    if (typeof stack === "string" && stack) {
      matches = stack.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);
      if (matches && matches[1]) {
        url = matches[1];
      } else {
        matches = stack.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);
        if (matches && matches[1]) {
          url = matches[1];
        }
      }
    }
    return url;
  };
  /**
 * Get the current script's URL by throwing an `Error` and analyzing it.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getCurrentScriptUrlFromError = function() {
    var url, err;
    try {
      throw new _Error();
    } catch (e) {
      err = e;
    }
    if (err) {
      url = err.sourceURL || err.fileName || _getCurrentScriptUrlFromErrorStack(err.stack);
    }
    return url;
  };
  /**
 * Get the current script's URL.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getCurrentScriptUrl = function() {
    var jsPath, scripts, i;
    if (_document.currentScript && (jsPath = _document.currentScript.src)) {
      return jsPath;
    }
    scripts = _document.getElementsByTagName("script");
    if (scripts.length === 1) {
      return scripts[0].src || undefined;
    }
    if ("readyState" in scripts[0]) {
      for (i = scripts.length; i--; ) {
        if (scripts[i].readyState === "interactive" && (jsPath = scripts[i].src)) {
          return jsPath;
        }
      }
    }
    if (_document.readyState === "loading" && (jsPath = scripts[scripts.length - 1].src)) {
      return jsPath;
    }
    if (jsPath = _getCurrentScriptUrlFromError()) {
      return jsPath;
    }
    return undefined;
  };
  /**
 * Get the unanimous parent directory of ALL script tags.
 * If any script tags are either (a) inline or (b) from differing parent
 * directories, this method must return `undefined`.
 *
 * @returns String or `undefined`
 * @private
 */
  var _getUnanimousScriptParentDir = function() {
    var i, jsDir, jsPath, scripts = _document.getElementsByTagName("script");
    for (i = scripts.length; i--; ) {
      if (!(jsPath = scripts[i].src)) {
        jsDir = null;
        break;
      }
      jsPath = _getDirPathOfUrl(jsPath);
      if (jsDir == null) {
        jsDir = jsPath;
      } else if (jsDir !== jsPath) {
        jsDir = null;
        break;
      }
    }
    return jsDir || undefined;
  };
  /**
 * Get the presumed location of the "ZeroClipboard.swf" file, based on the location
 * of the executing JavaScript file (e.g. "ZeroClipboard.js", etc.).
 *
 * @returns String
 * @private
 */
  var _getDefaultSwfPath = function() {
    var jsDir = _getDirPathOfUrl(_getCurrentScriptUrl()) || _getUnanimousScriptParentDir() || "";
    return jsDir + "ZeroClipboard.swf";
  };
  /**
 * Keep track of if the page is framed (in an `iframe`). This can never change.
 * @private
 */
  var _pageIsFramed = function() {
    return window.opener == null && (!!window.top && window != window.top || !!window.parent && window != window.parent);
  }();
  /**
 * Keep track of the state of the Flash object.
 * @private
 */
  var _flashState = {
    bridge: null,
    version: "0.0.0",
    pluginType: "unknown",
    disabled: null,
    outdated: null,
    sandboxed: null,
    unavailable: null,
    degraded: null,
    deactivated: null,
    overdue: null,
    ready: null
  };
  /**
 * The minimum Flash Player version required to use ZeroClipboard completely.
 * @readonly
 * @private
 */
  var _minimumFlashVersion = "11.0.0";
  /**
 * The ZeroClipboard library version number, as reported by Flash, at the time the SWF was compiled.
 */
  var _zcSwfVersion;
  /**
 * Keep track of all event listener registrations.
 * @private
 */
  var _handlers = {};
  /**
 * Keep track of the currently activated element.
 * @private
 */
  var _currentElement;
  /**
 * Keep track of the element that was activated when a `copy` process started.
 * @private
 */
  var _copyTarget;
  /**
 * Keep track of data for the pending clipboard transaction.
 * @private
 */
  var _clipData = {};
  /**
 * Keep track of data formats for the pending clipboard transaction.
 * @private
 */
  var _clipDataFormatMap = null;
  /**
 * Keep track of the Flash availability check timeout.
 * @private
 */
  var _flashCheckTimeout = 0;
  /**
 * Keep track of SWF network errors interval polling.
 * @private
 */
  var _swfFallbackCheckInterval = 0;
  /**
 * The `message` store for events
 * @private
 */
  var _eventMessages = {
    ready: "Flash communication is established",
    error: {
      "flash-disabled": "Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.",
      "flash-outdated": "Flash is too outdated to support ZeroClipboard",
      "flash-sandboxed": "Attempting to run Flash in a sandboxed iframe, which is impossible",
      "flash-unavailable": "Flash is unable to communicate bidirectionally with JavaScript",
      "flash-degraded": "Flash is unable to preserve data fidelity when communicating with JavaScript",
      "flash-deactivated": "Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.",
      "flash-overdue": "Flash communication was established but NOT within the acceptable time limit",
      "version-mismatch": "ZeroClipboard JS version number does not match ZeroClipboard SWF version number",
      "clipboard-error": "At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard",
      "config-mismatch": "ZeroClipboard configuration does not match Flash's reality",
      "swf-not-found": "The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"
    }
  };
  /**
 * The `name`s of `error` events that can only occur is Flash has at least
 * been able to load the SWF successfully.
 * @private
 */
  var _errorsThatOnlyOccurAfterFlashLoads = [ "flash-unavailable", "flash-degraded", "flash-overdue", "version-mismatch", "config-mismatch", "clipboard-error" ];
  /**
 * The `name`s of `error` events that should likely result in the `_flashState`
 * variable's property values being updated.
 * @private
 */
  var _flashStateErrorNames = [ "flash-disabled", "flash-outdated", "flash-sandboxed", "flash-unavailable", "flash-degraded", "flash-deactivated", "flash-overdue" ];
  /**
 * A RegExp to match the `name` property of `error` events related to Flash.
 * @private
 */
  var _flashStateErrorNameMatchingRegex = new RegExp("^flash-(" + _flashStateErrorNames.map(function(errorName) {
    return errorName.replace(/^flash-/, "");
  }).join("|") + ")$");
  /**
 * A RegExp to match the `name` property of `error` events related to Flash,
 * which is enabled.
 * @private
 */
  var _flashStateEnabledErrorNameMatchingRegex = new RegExp("^flash-(" + _flashStateErrorNames.slice(1).map(function(errorName) {
    return errorName.replace(/^flash-/, "");
  }).join("|") + ")$");
  /**
 * ZeroClipboard configuration defaults for the Core module.
 * @private
 */
  var _globalConfig = {
    swfPath: _getDefaultSwfPath(),
    trustedDomains: window.location.host ? [ window.location.host ] : [],
    cacheBust: true,
    forceEnhancedClipboard: false,
    flashLoadTimeout: 3e4,
    autoActivate: true,
    bubbleEvents: true,
    containerId: "global-zeroclipboard-html-bridge",
    containerClass: "global-zeroclipboard-container",
    swfObjectId: "global-zeroclipboard-flash-bridge",
    hoverClass: "zeroclipboard-is-hover",
    activeClass: "zeroclipboard-is-active",
    forceHandCursor: false,
    title: null,
    zIndex: 999999999
  };
  /**
 * The underlying implementation of `ZeroClipboard.config`.
 * @private
 */
  var _config = function(options) {
    if (typeof options === "object" && options !== null) {
      for (var prop in options) {
        if (_hasOwn.call(options, prop)) {
          if (/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(prop)) {
            _globalConfig[prop] = options[prop];
          } else if (_flashState.bridge == null) {
            if (prop === "containerId" || prop === "swfObjectId") {
              if (_isValidHtml4Id(options[prop])) {
                _globalConfig[prop] = options[prop];
              } else {
                throw new Error("The specified `" + prop + "` value is not valid as an HTML4 Element ID");
              }
            } else {
              _globalConfig[prop] = options[prop];
            }
          }
        }
      }
    }
    if (typeof options === "string" && options) {
      if (_hasOwn.call(_globalConfig, options)) {
        return _globalConfig[options];
      }
      return;
    }
    return _deepCopy(_globalConfig);
  };
  /**
 * The underlying implementation of `ZeroClipboard.state`.
 * @private
 */
  var _state = function() {
    _detectSandbox();
    return {
      browser: _pick(_navigator, [ "userAgent", "platform", "appName" ]),
      flash: _omit(_flashState, [ "bridge" ]),
      zeroclipboard: {
        version: ZeroClipboard.version,
        config: ZeroClipboard.config()
      }
    };
  };
  /**
 * The underlying implementation of `ZeroClipboard.isFlashUnusable`.
 * @private
 */
  var _isFlashUnusable = function() {
    return !!(_flashState.disabled || _flashState.outdated || _flashState.sandboxed || _flashState.unavailable || _flashState.degraded || _flashState.deactivated);
  };
  /**
 * The underlying implementation of `ZeroClipboard.on`.
 * @private
 */
  var _on = function(eventType, listener) {
    var i, len, events, added = {};
    if (typeof eventType === "string" && eventType) {
      events = eventType.toLowerCase().split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          ZeroClipboard.on(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].replace(/^on/, "");
        added[eventType] = true;
        if (!_handlers[eventType]) {
          _handlers[eventType] = [];
        }
        _handlers[eventType].push(listener);
      }
      if (added.ready && _flashState.ready) {
        ZeroClipboard.emit({
          type: "ready"
        });
      }
      if (added.error) {
        for (i = 0, len = _flashStateErrorNames.length; i < len; i++) {
          if (_flashState[_flashStateErrorNames[i].replace(/^flash-/, "")] === true) {
            ZeroClipboard.emit({
              type: "error",
              name: _flashStateErrorNames[i]
            });
            break;
          }
        }
        if (_zcSwfVersion !== undefined && ZeroClipboard.version !== _zcSwfVersion) {
          ZeroClipboard.emit({
            type: "error",
            name: "version-mismatch",
            jsVersion: ZeroClipboard.version,
            swfVersion: _zcSwfVersion
          });
        }
      }
    }
    return ZeroClipboard;
  };
  /**
 * The underlying implementation of `ZeroClipboard.off`.
 * @private
 */
  var _off = function(eventType, listener) {
    var i, len, foundIndex, events, perEventHandlers;
    if (arguments.length === 0) {
      events = _keys(_handlers);
    } else if (typeof eventType === "string" && eventType) {
      events = eventType.split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          ZeroClipboard.off(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].toLowerCase().replace(/^on/, "");
        perEventHandlers = _handlers[eventType];
        if (perEventHandlers && perEventHandlers.length) {
          if (listener) {
            foundIndex = perEventHandlers.indexOf(listener);
            while (foundIndex !== -1) {
              perEventHandlers.splice(foundIndex, 1);
              foundIndex = perEventHandlers.indexOf(listener, foundIndex);
            }
          } else {
            perEventHandlers.length = 0;
          }
        }
      }
    }
    return ZeroClipboard;
  };
  /**
 * The underlying implementation of `ZeroClipboard.handlers`.
 * @private
 */
  var _listeners = function(eventType) {
    var copy;
    if (typeof eventType === "string" && eventType) {
      copy = _deepCopy(_handlers[eventType]) || null;
    } else {
      copy = _deepCopy(_handlers);
    }
    return copy;
  };
  /**
 * The underlying implementation of `ZeroClipboard.emit`.
 * @private
 */
  var _emit = function(event) {
    var eventCopy, returnVal, tmp;
    event = _createEvent(event);
    if (!event) {
      return;
    }
    if (_preprocessEvent(event)) {
      return;
    }
    if (event.type === "ready" && _flashState.overdue === true) {
      return ZeroClipboard.emit({
        type: "error",
        name: "flash-overdue"
      });
    }
    eventCopy = _extend({}, event);
    _dispatchCallbacks.call(this, eventCopy);
    if (event.type === "copy") {
      tmp = _mapClipDataToFlash(_clipData);
      returnVal = tmp.data;
      _clipDataFormatMap = tmp.formatMap;
    }
    return returnVal;
  };
  /**
 * The underlying implementation of `ZeroClipboard.create`.
 * @private
 */
  var _create = function() {
    var previousState = _flashState.sandboxed;
    _detectSandbox();
    if (typeof _flashState.ready !== "boolean") {
      _flashState.ready = false;
    }
    if (_flashState.sandboxed !== previousState && _flashState.sandboxed === true) {
      _flashState.ready = false;
      ZeroClipboard.emit({
        type: "error",
        name: "flash-sandboxed"
      });
    } else if (!ZeroClipboard.isFlashUnusable() && _flashState.bridge === null) {
      var maxWait = _globalConfig.flashLoadTimeout;
      if (typeof maxWait === "number" && maxWait >= 0) {
        _flashCheckTimeout = _setTimeout(function() {
          if (typeof _flashState.deactivated !== "boolean") {
            _flashState.deactivated = true;
          }
          if (_flashState.deactivated === true) {
            ZeroClipboard.emit({
              type: "error",
              name: "flash-deactivated"
            });
          }
        }, maxWait);
      }
      _flashState.overdue = false;
      _embedSwf();
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.destroy`.
 * @private
 */
  var _destroy = function() {
    ZeroClipboard.clearData();
    ZeroClipboard.blur();
    ZeroClipboard.emit("destroy");
    _unembedSwf();
    ZeroClipboard.off();
  };
  /**
 * The underlying implementation of `ZeroClipboard.setData`.
 * @private
 */
  var _setData = function(format, data) {
    var dataObj;
    if (typeof format === "object" && format && typeof data === "undefined") {
      dataObj = format;
      ZeroClipboard.clearData();
    } else if (typeof format === "string" && format) {
      dataObj = {};
      dataObj[format] = data;
    } else {
      return;
    }
    for (var dataFormat in dataObj) {
      if (typeof dataFormat === "string" && dataFormat && _hasOwn.call(dataObj, dataFormat) && typeof dataObj[dataFormat] === "string" && dataObj[dataFormat]) {
        _clipData[dataFormat] = dataObj[dataFormat];
      }
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.clearData`.
 * @private
 */
  var _clearData = function(format) {
    if (typeof format === "undefined") {
      _deleteOwnProperties(_clipData);
      _clipDataFormatMap = null;
    } else if (typeof format === "string" && _hasOwn.call(_clipData, format)) {
      delete _clipData[format];
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.getData`.
 * @private
 */
  var _getData = function(format) {
    if (typeof format === "undefined") {
      return _deepCopy(_clipData);
    } else if (typeof format === "string" && _hasOwn.call(_clipData, format)) {
      return _clipData[format];
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.focus`/`ZeroClipboard.activate`.
 * @private
 */
  var _focus = function(element) {
    if (!(element && element.nodeType === 1)) {
      return;
    }
    if (_currentElement) {
      _removeClass(_currentElement, _globalConfig.activeClass);
      if (_currentElement !== element) {
        _removeClass(_currentElement, _globalConfig.hoverClass);
      }
    }
    _currentElement = element;
    _addClass(element, _globalConfig.hoverClass);
    var newTitle = element.getAttribute("title") || _globalConfig.title;
    if (typeof newTitle === "string" && newTitle) {
      var htmlBridge = _getHtmlBridge(_flashState.bridge);
      if (htmlBridge) {
        htmlBridge.setAttribute("title", newTitle);
      }
    }
    var useHandCursor = _globalConfig.forceHandCursor === true || _getStyle(element, "cursor") === "pointer";
    _setHandCursor(useHandCursor);
    _reposition();
  };
  /**
 * The underlying implementation of `ZeroClipboard.blur`/`ZeroClipboard.deactivate`.
 * @private
 */
  var _blur = function() {
    var htmlBridge = _getHtmlBridge(_flashState.bridge);
    if (htmlBridge) {
      htmlBridge.removeAttribute("title");
      htmlBridge.style.left = "0px";
      htmlBridge.style.top = "-9999px";
      htmlBridge.style.width = "1px";
      htmlBridge.style.height = "1px";
    }
    if (_currentElement) {
      _removeClass(_currentElement, _globalConfig.hoverClass);
      _removeClass(_currentElement, _globalConfig.activeClass);
      _currentElement = null;
    }
  };
  /**
 * The underlying implementation of `ZeroClipboard.activeElement`.
 * @private
 */
  var _activeElement = function() {
    return _currentElement || null;
  };
  /**
 * Check if a value is a valid HTML4 `ID` or `Name` token.
 * @private
 */
  var _isValidHtml4Id = function(id) {
    return typeof id === "string" && id && /^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(id);
  };
  /**
 * Create or update an `event` object, based on the `eventType`.
 * @private
 */
  var _createEvent = function(event) {
    var eventType;
    if (typeof event === "string" && event) {
      eventType = event;
      event = {};
    } else if (typeof event === "object" && event && typeof event.type === "string" && event.type) {
      eventType = event.type;
    }
    if (!eventType) {
      return;
    }
    eventType = eventType.toLowerCase();
    if (!event.target && (/^(copy|aftercopy|_click)$/.test(eventType) || eventType === "error" && event.name === "clipboard-error")) {
      event.target = _copyTarget;
    }
    _extend(event, {
      type: eventType,
      target: event.target || _currentElement || null,
      relatedTarget: event.relatedTarget || null,
      currentTarget: _flashState && _flashState.bridge || null,
      timeStamp: event.timeStamp || _now() || null
    });
    var msg = _eventMessages[event.type];
    if (event.type === "error" && event.name && msg) {
      msg = msg[event.name];
    }
    if (msg) {
      event.message = msg;
    }
    if (event.type === "ready") {
      _extend(event, {
        target: null,
        version: _flashState.version
      });
    }
    if (event.type === "error") {
      if (_flashStateErrorNameMatchingRegex.test(event.name)) {
        _extend(event, {
          target: null,
          minimumVersion: _minimumFlashVersion
        });
      }
      if (_flashStateEnabledErrorNameMatchingRegex.test(event.name)) {
        _extend(event, {
          version: _flashState.version
        });
      }
    }
    if (event.type === "copy") {
      event.clipboardData = {
        setData: ZeroClipboard.setData,
        clearData: ZeroClipboard.clearData
      };
    }
    if (event.type === "aftercopy") {
      event = _mapClipResultsFromFlash(event, _clipDataFormatMap);
    }
    if (event.target && !event.relatedTarget) {
      event.relatedTarget = _getRelatedTarget(event.target);
    }
    return _addMouseData(event);
  };
  /**
 * Get a relatedTarget from the target's `data-clipboard-target` attribute
 * @private
 */
  var _getRelatedTarget = function(targetEl) {
    var relatedTargetId = targetEl && targetEl.getAttribute && targetEl.getAttribute("data-clipboard-target");
    return relatedTargetId ? _document.getElementById(relatedTargetId) : null;
  };
  /**
 * Add element and position data to `MouseEvent` instances
 * @private
 */
  var _addMouseData = function(event) {
    if (event && /^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)) {
      var srcElement = event.target;
      var fromElement = event.type === "_mouseover" && event.relatedTarget ? event.relatedTarget : undefined;
      var toElement = event.type === "_mouseout" && event.relatedTarget ? event.relatedTarget : undefined;
      var pos = _getElementPosition(srcElement);
      var screenLeft = _window.screenLeft || _window.screenX || 0;
      var screenTop = _window.screenTop || _window.screenY || 0;
      var scrollLeft = _document.body.scrollLeft + _document.documentElement.scrollLeft;
      var scrollTop = _document.body.scrollTop + _document.documentElement.scrollTop;
      var pageX = pos.left + (typeof event._stageX === "number" ? event._stageX : 0);
      var pageY = pos.top + (typeof event._stageY === "number" ? event._stageY : 0);
      var clientX = pageX - scrollLeft;
      var clientY = pageY - scrollTop;
      var screenX = screenLeft + clientX;
      var screenY = screenTop + clientY;
      var moveX = typeof event.movementX === "number" ? event.movementX : 0;
      var moveY = typeof event.movementY === "number" ? event.movementY : 0;
      delete event._stageX;
      delete event._stageY;
      _extend(event, {
        srcElement: srcElement,
        fromElement: fromElement,
        toElement: toElement,
        screenX: screenX,
        screenY: screenY,
        pageX: pageX,
        pageY: pageY,
        clientX: clientX,
        clientY: clientY,
        x: clientX,
        y: clientY,
        movementX: moveX,
        movementY: moveY,
        offsetX: 0,
        offsetY: 0,
        layerX: 0,
        layerY: 0
      });
    }
    return event;
  };
  /**
 * Determine if an event's registered handlers should be execute synchronously or asynchronously.
 *
 * @returns {boolean}
 * @private
 */
  var _shouldPerformAsync = function(event) {
    var eventType = event && typeof event.type === "string" && event.type || "";
    return !/^(?:(?:before)?copy|destroy)$/.test(eventType);
  };
  /**
 * Control if a callback should be executed asynchronously or not.
 *
 * @returns `undefined`
 * @private
 */
  var _dispatchCallback = function(func, context, args, async) {
    if (async) {
      _setTimeout(function() {
        func.apply(context, args);
      }, 0);
    } else {
      func.apply(context, args);
    }
  };
  /**
 * Handle the actual dispatching of events to client instances.
 *
 * @returns `undefined`
 * @private
 */
  var _dispatchCallbacks = function(event) {
    if (!(typeof event === "object" && event && event.type)) {
      return;
    }
    var async = _shouldPerformAsync(event);
    var wildcardTypeHandlers = _handlers["*"] || [];
    var specificTypeHandlers = _handlers[event.type] || [];
    var handlers = wildcardTypeHandlers.concat(specificTypeHandlers);
    if (handlers && handlers.length) {
      var i, len, func, context, eventCopy, originalContext = this;
      for (i = 0, len = handlers.length; i < len; i++) {
        func = handlers[i];
        context = originalContext;
        if (typeof func === "string" && typeof _window[func] === "function") {
          func = _window[func];
        }
        if (typeof func === "object" && func && typeof func.handleEvent === "function") {
          context = func;
          func = func.handleEvent;
        }
        if (typeof func === "function") {
          eventCopy = _extend({}, event);
          _dispatchCallback(func, context, [ eventCopy ], async);
        }
      }
    }
    return this;
  };
  /**
 * Check an `error` event's `name` property to see if Flash has
 * already loaded, which rules out possible `iframe` sandboxing.
 * @private
 */
  var _getSandboxStatusFromErrorEvent = function(event) {
    var isSandboxed = null;
    if (_pageIsFramed === false || event && event.type === "error" && event.name && _errorsThatOnlyOccurAfterFlashLoads.indexOf(event.name) !== -1) {
      isSandboxed = false;
    }
    return isSandboxed;
  };
  /**
 * Preprocess any special behaviors, reactions, or state changes after receiving this event.
 * Executes only once per event emitted, NOT once per client.
 * @private
 */
  var _preprocessEvent = function(event) {
    var element = event.target || _currentElement || null;
    var sourceIsSwf = event._source === "swf";
    delete event._source;
    switch (event.type) {
     case "error":
      var isSandboxed = event.name === "flash-sandboxed" || _getSandboxStatusFromErrorEvent(event);
      if (typeof isSandboxed === "boolean") {
        _flashState.sandboxed = isSandboxed;
      }
      if (_flashStateErrorNames.indexOf(event.name) !== -1) {
        _extend(_flashState, {
          disabled: event.name === "flash-disabled",
          outdated: event.name === "flash-outdated",
          unavailable: event.name === "flash-unavailable",
          degraded: event.name === "flash-degraded",
          deactivated: event.name === "flash-deactivated",
          overdue: event.name === "flash-overdue",
          ready: false
        });
      } else if (event.name === "version-mismatch") {
        _zcSwfVersion = event.swfVersion;
        _extend(_flashState, {
          disabled: false,
          outdated: false,
          unavailable: false,
          degraded: false,
          deactivated: false,
          overdue: false,
          ready: false
        });
      }
      _clearTimeoutsAndPolling();
      break;

     case "ready":
      _zcSwfVersion = event.swfVersion;
      var wasDeactivated = _flashState.deactivated === true;
      _extend(_flashState, {
        disabled: false,
        outdated: false,
        sandboxed: false,
        unavailable: false,
        degraded: false,
        deactivated: false,
        overdue: wasDeactivated,
        ready: !wasDeactivated
      });
      _clearTimeoutsAndPolling();
      break;

     case "beforecopy":
      _copyTarget = element;
      break;

     case "copy":
      var textContent, htmlContent, targetEl = event.relatedTarget;
      if (!(_clipData["text/html"] || _clipData["text/plain"]) && targetEl && (htmlContent = targetEl.value || targetEl.outerHTML || targetEl.innerHTML) && (textContent = targetEl.value || targetEl.textContent || targetEl.innerText)) {
        event.clipboardData.clearData();
        event.clipboardData.setData("text/plain", textContent);
        if (htmlContent !== textContent) {
          event.clipboardData.setData("text/html", htmlContent);
        }
      } else if (!_clipData["text/plain"] && event.target && (textContent = event.target.getAttribute("data-clipboard-text"))) {
        event.clipboardData.clearData();
        event.clipboardData.setData("text/plain", textContent);
      }
      break;

     case "aftercopy":
      _queueEmitClipboardErrors(event);
      ZeroClipboard.clearData();
      if (element && element !== _safeActiveElement() && element.focus) {
        element.focus();
      }
      break;

     case "_mouseover":
      ZeroClipboard.focus(element);
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        if (element && element !== event.relatedTarget && !_containedBy(event.relatedTarget, element)) {
          _fireMouseEvent(_extend({}, event, {
            type: "mouseenter",
            bubbles: false,
            cancelable: false
          }));
        }
        _fireMouseEvent(_extend({}, event, {
          type: "mouseover"
        }));
      }
      break;

     case "_mouseout":
      ZeroClipboard.blur();
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        if (element && element !== event.relatedTarget && !_containedBy(event.relatedTarget, element)) {
          _fireMouseEvent(_extend({}, event, {
            type: "mouseleave",
            bubbles: false,
            cancelable: false
          }));
        }
        _fireMouseEvent(_extend({}, event, {
          type: "mouseout"
        }));
      }
      break;

     case "_mousedown":
      _addClass(element, _globalConfig.activeClass);
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;

     case "_mouseup":
      _removeClass(element, _globalConfig.activeClass);
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;

     case "_click":
      _copyTarget = null;
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;

     case "_mousemove":
      if (_globalConfig.bubbleEvents === true && sourceIsSwf) {
        _fireMouseEvent(_extend({}, event, {
          type: event.type.slice(1)
        }));
      }
      break;
    }
    if (/^_(?:click|mouse(?:over|out|down|up|move))$/.test(event.type)) {
      return true;
    }
  };
  /**
 * Check an "aftercopy" event for clipboard errors and emit a corresponding "error" event.
 * @private
 */
  var _queueEmitClipboardErrors = function(aftercopyEvent) {
    if (aftercopyEvent.errors && aftercopyEvent.errors.length > 0) {
      var errorEvent = _deepCopy(aftercopyEvent);
      _extend(errorEvent, {
        type: "error",
        name: "clipboard-error"
      });
      delete errorEvent.success;
      _setTimeout(function() {
        ZeroClipboard.emit(errorEvent);
      }, 0);
    }
  };
  /**
 * Dispatch a synthetic MouseEvent.
 *
 * @returns `undefined`
 * @private
 */
  var _fireMouseEvent = function(event) {
    if (!(event && typeof event.type === "string" && event)) {
      return;
    }
    var e, target = event.target || null, doc = target && target.ownerDocument || _document, defaults = {
      view: doc.defaultView || _window,
      canBubble: true,
      cancelable: true,
      detail: event.type === "click" ? 1 : 0,
      button: typeof event.which === "number" ? event.which - 1 : typeof event.button === "number" ? event.button : doc.createEvent ? 0 : 1
    }, args = _extend(defaults, event);
    if (!target) {
      return;
    }
    if (doc.createEvent && target.dispatchEvent) {
      args = [ args.type, args.canBubble, args.cancelable, args.view, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.button, args.relatedTarget ];
      e = doc.createEvent("MouseEvents");
      if (e.initMouseEvent) {
        e.initMouseEvent.apply(e, args);
        e._source = "js";
        target.dispatchEvent(e);
      }
    }
  };
  /**
 * Continuously poll the DOM until either:
 *  (a) the fallback content becomes visible, or
 *  (b) we receive an event from SWF (handled elsewhere)
 *
 * IMPORTANT:
 * This is NOT a necessary check but it can result in significantly faster
 * detection of bad `swfPath` configuration and/or network/server issues [in
 * supported browsers] than waiting for the entire `flashLoadTimeout` duration
 * to elapse before detecting that the SWF cannot be loaded. The detection
 * duration can be anywhere from 10-30 times faster [in supported browsers] by
 * using this approach.
 *
 * @returns `undefined`
 * @private
 */
  var _watchForSwfFallbackContent = function() {
    var maxWait = _globalConfig.flashLoadTimeout;
    if (typeof maxWait === "number" && maxWait >= 0) {
      var pollWait = Math.min(1e3, maxWait / 10);
      var fallbackContentId = _globalConfig.swfObjectId + "_fallbackContent";
      _swfFallbackCheckInterval = _setInterval(function() {
        var el = _document.getElementById(fallbackContentId);
        if (_isElementVisible(el)) {
          _clearTimeoutsAndPolling();
          _flashState.deactivated = null;
          ZeroClipboard.emit({
            type: "error",
            name: "swf-not-found"
          });
        }
      }, pollWait);
    }
  };
  /**
 * Create the HTML bridge element to embed the Flash object into.
 * @private
 */
  var _createHtmlBridge = function() {
    var container = _document.createElement("div");
    container.id = _globalConfig.containerId;
    container.className = _globalConfig.containerClass;
    container.style.position = "absolute";
    container.style.left = "0px";
    container.style.top = "-9999px";
    container.style.width = "1px";
    container.style.height = "1px";
    container.style.zIndex = "" + _getSafeZIndex(_globalConfig.zIndex);
    return container;
  };
  /**
 * Get the HTML element container that wraps the Flash bridge object/element.
 * @private
 */
  var _getHtmlBridge = function(flashBridge) {
    var htmlBridge = flashBridge && flashBridge.parentNode;
    while (htmlBridge && htmlBridge.nodeName === "OBJECT" && htmlBridge.parentNode) {
      htmlBridge = htmlBridge.parentNode;
    }
    return htmlBridge || null;
  };
  /**
 * Create the SWF object.
 *
 * @returns The SWF object reference.
 * @private
 */
  var _embedSwf = function() {
    var len, flashBridge = _flashState.bridge, container = _getHtmlBridge(flashBridge);
    if (!flashBridge) {
      var allowScriptAccess = _determineScriptAccess(_window.location.host, _globalConfig);
      var allowNetworking = allowScriptAccess === "never" ? "none" : "all";
      var flashvars = _vars(_extend({
        jsVersion: ZeroClipboard.version
      }, _globalConfig));
      var swfUrl = _globalConfig.swfPath + _cacheBust(_globalConfig.swfPath, _globalConfig);
      container = _createHtmlBridge();
      var divToBeReplaced = _document.createElement("div");
      container.appendChild(divToBeReplaced);
      _document.body.appendChild(container);
      var tmpDiv = _document.createElement("div");
      var usingActiveX = _flashState.pluginType === "activex";
      tmpDiv.innerHTML = '<object id="' + _globalConfig.swfObjectId + '" name="' + _globalConfig.swfObjectId + '" ' + 'width="100%" height="100%" ' + (usingActiveX ? 'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"' : 'type="application/x-shockwave-flash" data="' + swfUrl + '"') + ">" + (usingActiveX ? '<param name="movie" value="' + swfUrl + '"/>' : "") + '<param name="allowScriptAccess" value="' + allowScriptAccess + '"/>' + '<param name="allowNetworking" value="' + allowNetworking + '"/>' + '<param name="menu" value="false"/>' + '<param name="wmode" value="transparent"/>' + '<param name="flashvars" value="' + flashvars + '"/>' + '<div id="' + _globalConfig.swfObjectId + '_fallbackContent">&nbsp;</div>' + "</object>";
      flashBridge = tmpDiv.firstChild;
      tmpDiv = null;
      _unwrap(flashBridge).ZeroClipboard = ZeroClipboard;
      container.replaceChild(flashBridge, divToBeReplaced);
      _watchForSwfFallbackContent();
    }
    if (!flashBridge) {
      flashBridge = _document[_globalConfig.swfObjectId];
      if (flashBridge && (len = flashBridge.length)) {
        flashBridge = flashBridge[len - 1];
      }
      if (!flashBridge && container) {
        flashBridge = container.firstChild;
      }
    }
    _flashState.bridge = flashBridge || null;
    return flashBridge;
  };
  /**
 * Destroy the SWF object.
 * @private
 */
  var _unembedSwf = function() {
    var flashBridge = _flashState.bridge;
    if (flashBridge) {
      var htmlBridge = _getHtmlBridge(flashBridge);
      if (htmlBridge) {
        if (_flashState.pluginType === "activex" && "readyState" in flashBridge) {
          flashBridge.style.display = "none";
          (function removeSwfFromIE() {
            if (flashBridge.readyState === 4) {
              for (var prop in flashBridge) {
                if (typeof flashBridge[prop] === "function") {
                  flashBridge[prop] = null;
                }
              }
              if (flashBridge.parentNode) {
                flashBridge.parentNode.removeChild(flashBridge);
              }
              if (htmlBridge.parentNode) {
                htmlBridge.parentNode.removeChild(htmlBridge);
              }
            } else {
              _setTimeout(removeSwfFromIE, 10);
            }
          })();
        } else {
          if (flashBridge.parentNode) {
            flashBridge.parentNode.removeChild(flashBridge);
          }
          if (htmlBridge.parentNode) {
            htmlBridge.parentNode.removeChild(htmlBridge);
          }
        }
      }
      _clearTimeoutsAndPolling();
      _flashState.ready = null;
      _flashState.bridge = null;
      _flashState.deactivated = null;
      _zcSwfVersion = undefined;
    }
  };
  /**
 * Map the data format names of the "clipData" to Flash-friendly names.
 *
 * @returns A new transformed object.
 * @private
 */
  var _mapClipDataToFlash = function(clipData) {
    var newClipData = {}, formatMap = {};
    if (!(typeof clipData === "object" && clipData)) {
      return;
    }
    for (var dataFormat in clipData) {
      if (dataFormat && _hasOwn.call(clipData, dataFormat) && typeof clipData[dataFormat] === "string" && clipData[dataFormat]) {
        switch (dataFormat.toLowerCase()) {
         case "text/plain":
         case "text":
         case "air:text":
         case "flash:text":
          newClipData.text = clipData[dataFormat];
          formatMap.text = dataFormat;
          break;

         case "text/html":
         case "html":
         case "air:html":
         case "flash:html":
          newClipData.html = clipData[dataFormat];
          formatMap.html = dataFormat;
          break;

         case "application/rtf":
         case "text/rtf":
         case "rtf":
         case "richtext":
         case "air:rtf":
         case "flash:rtf":
          newClipData.rtf = clipData[dataFormat];
          formatMap.rtf = dataFormat;
          break;

         default:
          break;
        }
      }
    }
    return {
      data: newClipData,
      formatMap: formatMap
    };
  };
  /**
 * Map the data format names from Flash-friendly names back to their original "clipData" names (via a format mapping).
 *
 * @returns A new transformed object.
 * @private
 */
  var _mapClipResultsFromFlash = function(clipResults, formatMap) {
    if (!(typeof clipResults === "object" && clipResults && typeof formatMap === "object" && formatMap)) {
      return clipResults;
    }
    var newResults = {};
    for (var prop in clipResults) {
      if (_hasOwn.call(clipResults, prop)) {
        if (prop === "errors") {
          newResults[prop] = clipResults[prop] ? clipResults[prop].slice() : [];
          for (var i = 0, len = newResults[prop].length; i < len; i++) {
            newResults[prop][i].format = formatMap[newResults[prop][i].format];
          }
        } else if (prop !== "success" && prop !== "data") {
          newResults[prop] = clipResults[prop];
        } else {
          newResults[prop] = {};
          var tmpHash = clipResults[prop];
          for (var dataFormat in tmpHash) {
            if (dataFormat && _hasOwn.call(tmpHash, dataFormat) && _hasOwn.call(formatMap, dataFormat)) {
              newResults[prop][formatMap[dataFormat]] = tmpHash[dataFormat];
            }
          }
        }
      }
    }
    return newResults;
  };
  /**
 * Will look at a path, and will create a "?noCache={time}" or "&noCache={time}"
 * query param string to return. Does NOT append that string to the original path.
 * This is useful because ExternalInterface often breaks when a Flash SWF is cached.
 *
 * @returns The `noCache` query param with necessary "?"/"&" prefix.
 * @private
 */
  var _cacheBust = function(path, options) {
    var cacheBust = options == null || options && options.cacheBust === true;
    if (cacheBust) {
      return (path.indexOf("?") === -1 ? "?" : "&") + "noCache=" + _now();
    } else {
      return "";
    }
  };
  /**
 * Creates a query string for the FlashVars param.
 * Does NOT include the cache-busting query param.
 *
 * @returns FlashVars query string
 * @private
 */
  var _vars = function(options) {
    var i, len, domain, domains, str = "", trustedOriginsExpanded = [];
    if (options.trustedDomains) {
      if (typeof options.trustedDomains === "string") {
        domains = [ options.trustedDomains ];
      } else if (typeof options.trustedDomains === "object" && "length" in options.trustedDomains) {
        domains = options.trustedDomains;
      }
    }
    if (domains && domains.length) {
      for (i = 0, len = domains.length; i < len; i++) {
        if (_hasOwn.call(domains, i) && domains[i] && typeof domains[i] === "string") {
          domain = _extractDomain(domains[i]);
          if (!domain) {
            continue;
          }
          if (domain === "*") {
            trustedOriginsExpanded.length = 0;
            trustedOriginsExpanded.push(domain);
            break;
          }
          trustedOriginsExpanded.push.apply(trustedOriginsExpanded, [ domain, "//" + domain, _window.location.protocol + "//" + domain ]);
        }
      }
    }
    if (trustedOriginsExpanded.length) {
      str += "trustedOrigins=" + _encodeURIComponent(trustedOriginsExpanded.join(","));
    }
    if (options.forceEnhancedClipboard === true) {
      str += (str ? "&" : "") + "forceEnhancedClipboard=true";
    }
    if (typeof options.swfObjectId === "string" && options.swfObjectId) {
      str += (str ? "&" : "") + "swfObjectId=" + _encodeURIComponent(options.swfObjectId);
    }
    if (typeof options.jsVersion === "string" && options.jsVersion) {
      str += (str ? "&" : "") + "jsVersion=" + _encodeURIComponent(options.jsVersion);
    }
    return str;
  };
  /**
 * Extract the domain (e.g. "github.com") from an origin (e.g. "https://github.com") or
 * URL (e.g. "https://github.com/zeroclipboard/zeroclipboard/").
 *
 * @returns the domain
 * @private
 */
  var _extractDomain = function(originOrUrl) {
    if (originOrUrl == null || originOrUrl === "") {
      return null;
    }
    originOrUrl = originOrUrl.replace(/^\s+|\s+$/g, "");
    if (originOrUrl === "") {
      return null;
    }
    var protocolIndex = originOrUrl.indexOf("//");
    originOrUrl = protocolIndex === -1 ? originOrUrl : originOrUrl.slice(protocolIndex + 2);
    var pathIndex = originOrUrl.indexOf("/");
    originOrUrl = pathIndex === -1 ? originOrUrl : protocolIndex === -1 || pathIndex === 0 ? null : originOrUrl.slice(0, pathIndex);
    if (originOrUrl && originOrUrl.slice(-4).toLowerCase() === ".swf") {
      return null;
    }
    return originOrUrl || null;
  };
  /**
 * Set `allowScriptAccess` based on `trustedDomains` and `window.location.host` vs. `swfPath`.
 *
 * @returns The appropriate script access level.
 * @private
 */
  var _determineScriptAccess = function() {
    var _extractAllDomains = function(origins) {
      var i, len, tmp, resultsArray = [];
      if (typeof origins === "string") {
        origins = [ origins ];
      }
      if (!(typeof origins === "object" && origins && typeof origins.length === "number")) {
        return resultsArray;
      }
      for (i = 0, len = origins.length; i < len; i++) {
        if (_hasOwn.call(origins, i) && (tmp = _extractDomain(origins[i]))) {
          if (tmp === "*") {
            resultsArray.length = 0;
            resultsArray.push("*");
            break;
          }
          if (resultsArray.indexOf(tmp) === -1) {
            resultsArray.push(tmp);
          }
        }
      }
      return resultsArray;
    };
    return function(currentDomain, configOptions) {
      var swfDomain = _extractDomain(configOptions.swfPath);
      if (swfDomain === null) {
        swfDomain = currentDomain;
      }
      var trustedDomains = _extractAllDomains(configOptions.trustedDomains);
      var len = trustedDomains.length;
      if (len > 0) {
        if (len === 1 && trustedDomains[0] === "*") {
          return "always";
        }
        if (trustedDomains.indexOf(currentDomain) !== -1) {
          if (len === 1 && currentDomain === swfDomain) {
            return "sameDomain";
          }
          return "always";
        }
      }
      return "never";
    };
  }();
  /**
 * Get the currently active/focused DOM element.
 *
 * @returns the currently active/focused element, or `null`
 * @private
 */
  var _safeActiveElement = function() {
    try {
      return _document.activeElement;
    } catch (err) {
      return null;
    }
  };
  /**
 * Add a class to an element, if it doesn't already have it.
 *
 * @returns The element, with its new class added.
 * @private
 */
  var _addClass = function(element, value) {
    var c, cl, className, classNames = [];
    if (typeof value === "string" && value) {
      classNames = value.split(/\s+/);
    }
    if (element && element.nodeType === 1 && classNames.length > 0) {
      if (element.classList) {
        for (c = 0, cl = classNames.length; c < cl; c++) {
          element.classList.add(classNames[c]);
        }
      } else if (element.hasOwnProperty("className")) {
        className = " " + element.className + " ";
        for (c = 0, cl = classNames.length; c < cl; c++) {
          if (className.indexOf(" " + classNames[c] + " ") === -1) {
            className += classNames[c] + " ";
          }
        }
        element.className = className.replace(/^\s+|\s+$/g, "");
      }
    }
    return element;
  };
  /**
 * Remove a class from an element, if it has it.
 *
 * @returns The element, with its class removed.
 * @private
 */
  var _removeClass = function(element, value) {
    var c, cl, className, classNames = [];
    if (typeof value === "string" && value) {
      classNames = value.split(/\s+/);
    }
    if (element && element.nodeType === 1 && classNames.length > 0) {
      if (element.classList && element.classList.length > 0) {
        for (c = 0, cl = classNames.length; c < cl; c++) {
          element.classList.remove(classNames[c]);
        }
      } else if (element.className) {
        className = (" " + element.className + " ").replace(/[\r\n\t]/g, " ");
        for (c = 0, cl = classNames.length; c < cl; c++) {
          className = className.replace(" " + classNames[c] + " ", " ");
        }
        element.className = className.replace(/^\s+|\s+$/g, "");
      }
    }
    return element;
  };
  /**
 * Attempt to interpret the element's CSS styling. If `prop` is `"cursor"`,
 * then we assume that it should be a hand ("pointer") cursor if the element
 * is an anchor element ("a" tag).
 *
 * @returns The computed style property.
 * @private
 */
  var _getStyle = function(el, prop) {
    var value = _getComputedStyle(el, null).getPropertyValue(prop);
    if (prop === "cursor") {
      if (!value || value === "auto") {
        if (el.nodeName === "A") {
          return "pointer";
        }
      }
    }
    return value;
  };
  /**
 * Get the absolutely positioned coordinates of a DOM element.
 *
 * @returns Object containing the element's position, width, and height.
 * @private
 */
  var _getElementPosition = function(el) {
    var pos = {
      left: 0,
      top: 0,
      width: 0,
      height: 0
    };
    if (el.getBoundingClientRect) {
      var elRect = el.getBoundingClientRect();
      var pageXOffset = _window.pageXOffset;
      var pageYOffset = _window.pageYOffset;
      var leftBorderWidth = _document.documentElement.clientLeft || 0;
      var topBorderWidth = _document.documentElement.clientTop || 0;
      var leftBodyOffset = 0;
      var topBodyOffset = 0;
      if (_getStyle(_document.body, "position") === "relative") {
        var bodyRect = _document.body.getBoundingClientRect();
        var htmlRect = _document.documentElement.getBoundingClientRect();
        leftBodyOffset = bodyRect.left - htmlRect.left || 0;
        topBodyOffset = bodyRect.top - htmlRect.top || 0;
      }
      pos.left = elRect.left + pageXOffset - leftBorderWidth - leftBodyOffset;
      pos.top = elRect.top + pageYOffset - topBorderWidth - topBodyOffset;
      pos.width = "width" in elRect ? elRect.width : elRect.right - elRect.left;
      pos.height = "height" in elRect ? elRect.height : elRect.bottom - elRect.top;
    }
    return pos;
  };
  /**
 * Determine is an element is visible somewhere within the document (page).
 *
 * @returns Boolean
 * @private
 */
  var _isElementVisible = function(el) {
    if (!el) {
      return false;
    }
    var styles = _getComputedStyle(el, null);
    var hasCssHeight = _parseFloat(styles.height) > 0;
    var hasCssWidth = _parseFloat(styles.width) > 0;
    var hasCssTop = _parseFloat(styles.top) >= 0;
    var hasCssLeft = _parseFloat(styles.left) >= 0;
    var cssKnows = hasCssHeight && hasCssWidth && hasCssTop && hasCssLeft;
    var rect = cssKnows ? null : _getElementPosition(el);
    var isVisible = styles.display !== "none" && styles.visibility !== "collapse" && (cssKnows || !!rect && (hasCssHeight || rect.height > 0) && (hasCssWidth || rect.width > 0) && (hasCssTop || rect.top >= 0) && (hasCssLeft || rect.left >= 0));
    return isVisible;
  };
  /**
 * Clear all existing timeouts and interval polling delegates.
 *
 * @returns `undefined`
 * @private
 */
  var _clearTimeoutsAndPolling = function() {
    _clearTimeout(_flashCheckTimeout);
    _flashCheckTimeout = 0;
    _clearInterval(_swfFallbackCheckInterval);
    _swfFallbackCheckInterval = 0;
  };
  /**
 * Reposition the Flash object to cover the currently activated element.
 *
 * @returns `undefined`
 * @private
 */
  var _reposition = function() {
    var htmlBridge;
    if (_currentElement && (htmlBridge = _getHtmlBridge(_flashState.bridge))) {
      var pos = _getElementPosition(_currentElement);
      _extend(htmlBridge.style, {
        width: pos.width + "px",
        height: pos.height + "px",
        top: pos.top + "px",
        left: pos.left + "px",
        zIndex: "" + _getSafeZIndex(_globalConfig.zIndex)
      });
    }
  };
  /**
 * Sends a signal to the Flash object to display the hand cursor if `true`.
 *
 * @returns `undefined`
 * @private
 */
  var _setHandCursor = function(enabled) {
    if (_flashState.ready === true) {
      if (_flashState.bridge && typeof _flashState.bridge.setHandCursor === "function") {
        _flashState.bridge.setHandCursor(enabled);
      } else {
        _flashState.ready = false;
      }
    }
  };
  /**
 * Get a safe value for `zIndex`
 *
 * @returns an integer, or "auto"
 * @private
 */
  var _getSafeZIndex = function(val) {
    if (/^(?:auto|inherit)$/.test(val)) {
      return val;
    }
    var zIndex;
    if (typeof val === "number" && !_isNaN(val)) {
      zIndex = val;
    } else if (typeof val === "string") {
      zIndex = _getSafeZIndex(_parseInt(val, 10));
    }
    return typeof zIndex === "number" ? zIndex : "auto";
  };
  /**
 * Attempt to detect if ZeroClipboard is executing inside of a sandboxed iframe.
 * If it is, Flash Player cannot be used, so ZeroClipboard is dead in the water.
 *
 * @see {@link http://lists.w3.org/Archives/Public/public-whatwg-archive/2014Dec/0002.html}
 * @see {@link https://github.com/zeroclipboard/zeroclipboard/issues/511}
 * @see {@link http://zeroclipboard.org/test-iframes.html}
 *
 * @returns `true` (is sandboxed), `false` (is not sandboxed), or `null` (uncertain) 
 * @private
 */
  var _detectSandbox = function(doNotReassessFlashSupport) {
    var effectiveScriptOrigin, frame, frameError, previousState = _flashState.sandboxed, isSandboxed = null;
    doNotReassessFlashSupport = doNotReassessFlashSupport === true;
    if (_pageIsFramed === false) {
      isSandboxed = false;
    } else {
      try {
        frame = window.frameElement || null;
      } catch (e) {
        frameError = {
          name: e.name,
          message: e.message
        };
      }
      if (frame && frame.nodeType === 1 && frame.nodeName === "IFRAME") {
        try {
          isSandboxed = frame.hasAttribute("sandbox");
        } catch (e) {
          isSandboxed = null;
        }
      } else {
        try {
          effectiveScriptOrigin = document.domain || null;
        } catch (e) {
          effectiveScriptOrigin = null;
        }
        if (effectiveScriptOrigin === null || frameError && frameError.name === "SecurityError" && /(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(frameError.message.toLowerCase())) {
          isSandboxed = true;
        }
      }
    }
    _flashState.sandboxed = isSandboxed;
    if (previousState !== isSandboxed && !doNotReassessFlashSupport) {
      _detectFlashSupport(_ActiveXObject);
    }
    return isSandboxed;
  };
  /**
 * Detect the Flash Player status, version, and plugin type.
 *
 * @see {@link https://code.google.com/p/doctype-mirror/wiki/ArticleDetectFlash#The_code}
 * @see {@link http://stackoverflow.com/questions/12866060/detecting-pepper-ppapi-flash-with-javascript}
 *
 * @returns `undefined`
 * @private
 */
  var _detectFlashSupport = function(ActiveXObject) {
    var plugin, ax, mimeType, hasFlash = false, isActiveX = false, isPPAPI = false, flashVersion = "";
    /**
   * Derived from Apple's suggested sniffer.
   * @param {String} desc e.g. "Shockwave Flash 7.0 r61"
   * @returns {String} "7.0.61"
   * @private
   */
    function parseFlashVersion(desc) {
      var matches = desc.match(/[\d]+/g);
      matches.length = 3;
      return matches.join(".");
    }
    function isPepperFlash(flashPlayerFileName) {
      return !!flashPlayerFileName && (flashPlayerFileName = flashPlayerFileName.toLowerCase()) && (/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(flashPlayerFileName) || flashPlayerFileName.slice(-13) === "chrome.plugin");
    }
    function inspectPlugin(plugin) {
      if (plugin) {
        hasFlash = true;
        if (plugin.version) {
          flashVersion = parseFlashVersion(plugin.version);
        }
        if (!flashVersion && plugin.description) {
          flashVersion = parseFlashVersion(plugin.description);
        }
        if (plugin.filename) {
          isPPAPI = isPepperFlash(plugin.filename);
        }
      }
    }
    if (_navigator.plugins && _navigator.plugins.length) {
      plugin = _navigator.plugins["Shockwave Flash"];
      inspectPlugin(plugin);
      if (_navigator.plugins["Shockwave Flash 2.0"]) {
        hasFlash = true;
        flashVersion = "2.0.0.11";
      }
    } else if (_navigator.mimeTypes && _navigator.mimeTypes.length) {
      mimeType = _navigator.mimeTypes["application/x-shockwave-flash"];
      plugin = mimeType && mimeType.enabledPlugin;
      inspectPlugin(plugin);
    } else if (typeof ActiveXObject !== "undefined") {
      isActiveX = true;
      try {
        ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
        hasFlash = true;
        flashVersion = parseFlashVersion(ax.GetVariable("$version"));
      } catch (e1) {
        try {
          ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
          hasFlash = true;
          flashVersion = "6.0.21";
        } catch (e2) {
          try {
            ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
            hasFlash = true;
            flashVersion = parseFlashVersion(ax.GetVariable("$version"));
          } catch (e3) {
            isActiveX = false;
          }
        }
      }
    }
    _flashState.disabled = hasFlash !== true;
    _flashState.outdated = flashVersion && _parseFloat(flashVersion) < _parseFloat(_minimumFlashVersion);
    _flashState.version = flashVersion || "0.0.0";
    _flashState.pluginType = isPPAPI ? "pepper" : isActiveX ? "activex" : hasFlash ? "netscape" : "unknown";
  };
  /**
 * Invoke the Flash detection algorithms immediately upon inclusion so we're not waiting later.
 */
  _detectFlashSupport(_ActiveXObject);
  /**
 * Always assess the `sandboxed` state of the page at important Flash-related moments.
 */
  _detectSandbox(true);
  /**
 * A shell constructor for `ZeroClipboard` client instances.
 *
 * @constructor
 */
  var ZeroClipboard = function() {
    if (!(this instanceof ZeroClipboard)) {
      return new ZeroClipboard();
    }
    if (typeof ZeroClipboard._createClient === "function") {
      ZeroClipboard._createClient.apply(this, _args(arguments));
    }
  };
  /**
 * The ZeroClipboard library's version number.
 *
 * @static
 * @readonly
 * @property {string}
 */
  _defineProperty(ZeroClipboard, "version", {
    value: "2.2.0",
    writable: false,
    configurable: true,
    enumerable: true
  });
  /**
 * Update or get a copy of the ZeroClipboard global configuration.
 * Returns a copy of the current/updated configuration.
 *
 * @returns Object
 * @static
 */
  ZeroClipboard.config = function() {
    return _config.apply(this, _args(arguments));
  };
  /**
 * Diagnostic method that describes the state of the browser, Flash Player, and ZeroClipboard.
 *
 * @returns Object
 * @static
 */
  ZeroClipboard.state = function() {
    return _state.apply(this, _args(arguments));
  };
  /**
 * Check if Flash is unusable for any reason: disabled, outdated, deactivated, etc.
 *
 * @returns Boolean
 * @static
 */
  ZeroClipboard.isFlashUnusable = function() {
    return _isFlashUnusable.apply(this, _args(arguments));
  };
  /**
 * Register an event listener.
 *
 * @returns `ZeroClipboard`
 * @static
 */
  ZeroClipboard.on = function() {
    return _on.apply(this, _args(arguments));
  };
  /**
 * Unregister an event listener.
 * If no `listener` function/object is provided, it will unregister all listeners for the provided `eventType`.
 * If no `eventType` is provided, it will unregister all listeners for every event type.
 *
 * @returns `ZeroClipboard`
 * @static
 */
  ZeroClipboard.off = function() {
    return _off.apply(this, _args(arguments));
  };
  /**
 * Retrieve event listeners for an `eventType`.
 * If no `eventType` is provided, it will retrieve all listeners for every event type.
 *
 * @returns array of listeners for the `eventType`; if no `eventType`, then a map/hash object of listeners for all event types; or `null`
 */
  ZeroClipboard.handlers = function() {
    return _listeners.apply(this, _args(arguments));
  };
  /**
 * Event emission receiver from the Flash object, forwarding to any registered JavaScript event listeners.
 *
 * @returns For the "copy" event, returns the Flash-friendly "clipData" object; otherwise `undefined`.
 * @static
 */
  ZeroClipboard.emit = function() {
    return _emit.apply(this, _args(arguments));
  };
  /**
 * Create and embed the Flash object.
 *
 * @returns The Flash object
 * @static
 */
  ZeroClipboard.create = function() {
    return _create.apply(this, _args(arguments));
  };
  /**
 * Self-destruct and clean up everything, including the embedded Flash object.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.destroy = function() {
    return _destroy.apply(this, _args(arguments));
  };
  /**
 * Set the pending data for clipboard injection.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.setData = function() {
    return _setData.apply(this, _args(arguments));
  };
  /**
 * Clear the pending data for clipboard injection.
 * If no `format` is provided, all pending data formats will be cleared.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.clearData = function() {
    return _clearData.apply(this, _args(arguments));
  };
  /**
 * Get a copy of the pending data for clipboard injection.
 * If no `format` is provided, a copy of ALL pending data formats will be returned.
 *
 * @returns `String` or `Object`
 * @static
 */
  ZeroClipboard.getData = function() {
    return _getData.apply(this, _args(arguments));
  };
  /**
 * Sets the current HTML object that the Flash object should overlay. This will put the global
 * Flash object on top of the current element; depending on the setup, this may also set the
 * pending clipboard text data as well as the Flash object's wrapping element's title attribute
 * based on the underlying HTML element and ZeroClipboard configuration.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.focus = ZeroClipboard.activate = function() {
    return _focus.apply(this, _args(arguments));
  };
  /**
 * Un-overlays the Flash object. This will put the global Flash object off-screen; depending on
 * the setup, this may also unset the Flash object's wrapping element's title attribute based on
 * the underlying HTML element and ZeroClipboard configuration.
 *
 * @returns `undefined`
 * @static
 */
  ZeroClipboard.blur = ZeroClipboard.deactivate = function() {
    return _blur.apply(this, _args(arguments));
  };
  /**
 * Returns the currently focused/"activated" HTML element that the Flash object is wrapping.
 *
 * @returns `HTMLElement` or `null`
 * @static
 */
  ZeroClipboard.activeElement = function() {
    return _activeElement.apply(this, _args(arguments));
  };
  /**
 * Keep track of the ZeroClipboard client instance counter.
 */
  var _clientIdCounter = 0;
  /**
 * Keep track of the state of the client instances.
 *
 * Entry structure:
 *   _clientMeta[client.id] = {
 *     instance: client,
 *     elements: [],
 *     handlers: {}
 *   };
 */
  var _clientMeta = {};
  /**
 * Keep track of the ZeroClipboard clipped elements counter.
 */
  var _elementIdCounter = 0;
  /**
 * Keep track of the state of the clipped element relationships to clients.
 *
 * Entry structure:
 *   _elementMeta[element.zcClippingId] = [client1.id, client2.id];
 */
  var _elementMeta = {};
  /**
 * Keep track of the state of the mouse event handlers for clipped elements.
 *
 * Entry structure:
 *   _mouseHandlers[element.zcClippingId] = {
 *     mouseover:  function(event) {},
 *     mouseout:   function(event) {},
 *     mouseenter: function(event) {},
 *     mouseleave: function(event) {},
 *     mousemove:  function(event) {}
 *   };
 */
  var _mouseHandlers = {};
  /**
 * Extending the ZeroClipboard configuration defaults for the Client module.
 */
  _extend(_globalConfig, {
    autoActivate: true
  });
  /**
 * The real constructor for `ZeroClipboard` client instances.
 * @private
 */
  var _clientConstructor = function(elements) {
    var client = this;
    client.id = "" + _clientIdCounter++;
    _clientMeta[client.id] = {
      instance: client,
      elements: [],
      handlers: {}
    };
    if (elements) {
      client.clip(elements);
    }
    ZeroClipboard.on("*", function(event) {
      return client.emit(event);
    });
    ZeroClipboard.on("destroy", function() {
      client.destroy();
    });
    ZeroClipboard.create();
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.on`.
 * @private
 */
  var _clientOn = function(eventType, listener) {
    var i, len, events, added = {}, meta = _clientMeta[this.id], handlers = meta && meta.handlers;
    if (!meta) {
      throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");
    }
    if (typeof eventType === "string" && eventType) {
      events = eventType.toLowerCase().split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          this.on(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].replace(/^on/, "");
        added[eventType] = true;
        if (!handlers[eventType]) {
          handlers[eventType] = [];
        }
        handlers[eventType].push(listener);
      }
      if (added.ready && _flashState.ready) {
        this.emit({
          type: "ready",
          client: this
        });
      }
      if (added.error) {
        for (i = 0, len = _flashStateErrorNames.length; i < len; i++) {
          if (_flashState[_flashStateErrorNames[i].replace(/^flash-/, "")]) {
            this.emit({
              type: "error",
              name: _flashStateErrorNames[i],
              client: this
            });
            break;
          }
        }
        if (_zcSwfVersion !== undefined && ZeroClipboard.version !== _zcSwfVersion) {
          this.emit({
            type: "error",
            name: "version-mismatch",
            jsVersion: ZeroClipboard.version,
            swfVersion: _zcSwfVersion
          });
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.off`.
 * @private
 */
  var _clientOff = function(eventType, listener) {
    var i, len, foundIndex, events, perEventHandlers, meta = _clientMeta[this.id], handlers = meta && meta.handlers;
    if (!handlers) {
      return this;
    }
    if (arguments.length === 0) {
      events = _keys(handlers);
    } else if (typeof eventType === "string" && eventType) {
      events = eventType.split(/\s+/);
    } else if (typeof eventType === "object" && eventType && typeof listener === "undefined") {
      for (i in eventType) {
        if (_hasOwn.call(eventType, i) && typeof i === "string" && i && typeof eventType[i] === "function") {
          this.off(i, eventType[i]);
        }
      }
    }
    if (events && events.length) {
      for (i = 0, len = events.length; i < len; i++) {
        eventType = events[i].toLowerCase().replace(/^on/, "");
        perEventHandlers = handlers[eventType];
        if (perEventHandlers && perEventHandlers.length) {
          if (listener) {
            foundIndex = perEventHandlers.indexOf(listener);
            while (foundIndex !== -1) {
              perEventHandlers.splice(foundIndex, 1);
              foundIndex = perEventHandlers.indexOf(listener, foundIndex);
            }
          } else {
            perEventHandlers.length = 0;
          }
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.handlers`.
 * @private
 */
  var _clientListeners = function(eventType) {
    var copy = null, handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;
    if (handlers) {
      if (typeof eventType === "string" && eventType) {
        copy = handlers[eventType] ? handlers[eventType].slice(0) : [];
      } else {
        copy = _deepCopy(handlers);
      }
    }
    return copy;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.emit`.
 * @private
 */
  var _clientEmit = function(event) {
    if (_clientShouldEmit.call(this, event)) {
      if (typeof event === "object" && event && typeof event.type === "string" && event.type) {
        event = _extend({}, event);
      }
      var eventCopy = _extend({}, _createEvent(event), {
        client: this
      });
      _clientDispatchCallbacks.call(this, eventCopy);
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.clip`.
 * @private
 */
  var _clientClip = function(elements) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");
    }
    elements = _prepClip(elements);
    for (var i = 0; i < elements.length; i++) {
      if (_hasOwn.call(elements, i) && elements[i] && elements[i].nodeType === 1) {
        if (!elements[i].zcClippingId) {
          elements[i].zcClippingId = "zcClippingId_" + _elementIdCounter++;
          _elementMeta[elements[i].zcClippingId] = [ this.id ];
          if (_globalConfig.autoActivate === true) {
            _addMouseHandlers(elements[i]);
          }
        } else if (_elementMeta[elements[i].zcClippingId].indexOf(this.id) === -1) {
          _elementMeta[elements[i].zcClippingId].push(this.id);
        }
        var clippedElements = _clientMeta[this.id] && _clientMeta[this.id].elements;
        if (clippedElements.indexOf(elements[i]) === -1) {
          clippedElements.push(elements[i]);
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.unclip`.
 * @private
 */
  var _clientUnclip = function(elements) {
    var meta = _clientMeta[this.id];
    if (!meta) {
      return this;
    }
    var clippedElements = meta.elements;
    var arrayIndex;
    if (typeof elements === "undefined") {
      elements = clippedElements.slice(0);
    } else {
      elements = _prepClip(elements);
    }
    for (var i = elements.length; i--; ) {
      if (_hasOwn.call(elements, i) && elements[i] && elements[i].nodeType === 1) {
        arrayIndex = 0;
        while ((arrayIndex = clippedElements.indexOf(elements[i], arrayIndex)) !== -1) {
          clippedElements.splice(arrayIndex, 1);
        }
        var clientIds = _elementMeta[elements[i].zcClippingId];
        if (clientIds) {
          arrayIndex = 0;
          while ((arrayIndex = clientIds.indexOf(this.id, arrayIndex)) !== -1) {
            clientIds.splice(arrayIndex, 1);
          }
          if (clientIds.length === 0) {
            if (_globalConfig.autoActivate === true) {
              _removeMouseHandlers(elements[i]);
            }
            delete elements[i].zcClippingId;
          }
        }
      }
    }
    return this;
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.elements`.
 * @private
 */
  var _clientElements = function() {
    var meta = _clientMeta[this.id];
    return meta && meta.elements ? meta.elements.slice(0) : [];
  };
  /**
 * The underlying implementation of `ZeroClipboard.Client.prototype.destroy`.
 * @private
 */
  var _clientDestroy = function() {
    if (!_clientMeta[this.id]) {
      return;
    }
    this.unclip();
    this.off();
    delete _clientMeta[this.id];
  };
  /**
 * Inspect an Event to see if the Client (`this`) should honor it for emission.
 * @private
 */
  var _clientShouldEmit = function(event) {
    if (!(event && event.type)) {
      return false;
    }
    if (event.client && event.client !== this) {
      return false;
    }
    var meta = _clientMeta[this.id];
    var clippedEls = meta && meta.elements;
    var hasClippedEls = !!clippedEls && clippedEls.length > 0;
    var goodTarget = !event.target || hasClippedEls && clippedEls.indexOf(event.target) !== -1;
    var goodRelTarget = event.relatedTarget && hasClippedEls && clippedEls.indexOf(event.relatedTarget) !== -1;
    var goodClient = event.client && event.client === this;
    if (!meta || !(goodTarget || goodRelTarget || goodClient)) {
      return false;
    }
    return true;
  };
  /**
 * Handle the actual dispatching of events to a client instance.
 *
 * @returns `undefined`
 * @private
 */
  var _clientDispatchCallbacks = function(event) {
    var meta = _clientMeta[this.id];
    if (!(typeof event === "object" && event && event.type && meta)) {
      return;
    }
    var async = _shouldPerformAsync(event);
    var wildcardTypeHandlers = meta && meta.handlers["*"] || [];
    var specificTypeHandlers = meta && meta.handlers[event.type] || [];
    var handlers = wildcardTypeHandlers.concat(specificTypeHandlers);
    if (handlers && handlers.length) {
      var i, len, func, context, eventCopy, originalContext = this;
      for (i = 0, len = handlers.length; i < len; i++) {
        func = handlers[i];
        context = originalContext;
        if (typeof func === "string" && typeof _window[func] === "function") {
          func = _window[func];
        }
        if (typeof func === "object" && func && typeof func.handleEvent === "function") {
          context = func;
          func = func.handleEvent;
        }
        if (typeof func === "function") {
          eventCopy = _extend({}, event);
          _dispatchCallback(func, context, [ eventCopy ], async);
        }
      }
    }
  };
  /**
 * Prepares the elements for clipping/unclipping.
 *
 * @returns An Array of elements.
 * @private
 */
  var _prepClip = function(elements) {
    if (typeof elements === "string") {
      elements = [];
    }
    return typeof elements.length !== "number" ? [ elements ] : elements;
  };
  /**
 * Add a `mouseover` handler function for a clipped element.
 *
 * @returns `undefined`
 * @private
 */
  var _addMouseHandlers = function(element) {
    if (!(element && element.nodeType === 1)) {
      return;
    }
    var _suppressMouseEvents = function(event) {
      if (!(event || (event = _window.event))) {
        return;
      }
      if (event._source !== "js") {
        event.stopImmediatePropagation();
        event.preventDefault();
      }
      delete event._source;
    };
    var _elementMouseOver = function(event) {
      if (!(event || (event = _window.event))) {
        return;
      }
      _suppressMouseEvents(event);
      ZeroClipboard.focus(element);
    };
    element.addEventListener("mouseover", _elementMouseOver, false);
    element.addEventListener("mouseout", _suppressMouseEvents, false);
    element.addEventListener("mouseenter", _suppressMouseEvents, false);
    element.addEventListener("mouseleave", _suppressMouseEvents, false);
    element.addEventListener("mousemove", _suppressMouseEvents, false);
    _mouseHandlers[element.zcClippingId] = {
      mouseover: _elementMouseOver,
      mouseout: _suppressMouseEvents,
      mouseenter: _suppressMouseEvents,
      mouseleave: _suppressMouseEvents,
      mousemove: _suppressMouseEvents
    };
  };
  /**
 * Remove a `mouseover` handler function for a clipped element.
 *
 * @returns `undefined`
 * @private
 */
  var _removeMouseHandlers = function(element) {
    if (!(element && element.nodeType === 1)) {
      return;
    }
    var mouseHandlers = _mouseHandlers[element.zcClippingId];
    if (!(typeof mouseHandlers === "object" && mouseHandlers)) {
      return;
    }
    var key, val, mouseEvents = [ "move", "leave", "enter", "out", "over" ];
    for (var i = 0, len = mouseEvents.length; i < len; i++) {
      key = "mouse" + mouseEvents[i];
      val = mouseHandlers[key];
      if (typeof val === "function") {
        element.removeEventListener(key, val, false);
      }
    }
    delete _mouseHandlers[element.zcClippingId];
  };
  /**
 * Creates a new ZeroClipboard client instance.
 * Optionally, auto-`clip` an element or collection of elements.
 *
 * @constructor
 */
  ZeroClipboard._createClient = function() {
    _clientConstructor.apply(this, _args(arguments));
  };
  /**
 * Register an event listener to the client.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.on = function() {
    return _clientOn.apply(this, _args(arguments));
  };
  /**
 * Unregister an event handler from the client.
 * If no `listener` function/object is provided, it will unregister all handlers for the provided `eventType`.
 * If no `eventType` is provided, it will unregister all handlers for every event type.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.off = function() {
    return _clientOff.apply(this, _args(arguments));
  };
  /**
 * Retrieve event listeners for an `eventType` from the client.
 * If no `eventType` is provided, it will retrieve all listeners for every event type.
 *
 * @returns array of listeners for the `eventType`; if no `eventType`, then a map/hash object of listeners for all event types; or `null`
 */
  ZeroClipboard.prototype.handlers = function() {
    return _clientListeners.apply(this, _args(arguments));
  };
  /**
 * Event emission receiver from the Flash object for this client's registered JavaScript event listeners.
 *
 * @returns For the "copy" event, returns the Flash-friendly "clipData" object; otherwise `undefined`.
 */
  ZeroClipboard.prototype.emit = function() {
    return _clientEmit.apply(this, _args(arguments));
  };
  /**
 * Register clipboard actions for new element(s) to the client.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.clip = function() {
    return _clientClip.apply(this, _args(arguments));
  };
  /**
 * Unregister the clipboard actions of previously registered element(s) on the page.
 * If no elements are provided, ALL registered elements will be unregistered.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.unclip = function() {
    return _clientUnclip.apply(this, _args(arguments));
  };
  /**
 * Get all of the elements to which this client is clipped.
 *
 * @returns array of clipped elements
 */
  ZeroClipboard.prototype.elements = function() {
    return _clientElements.apply(this, _args(arguments));
  };
  /**
 * Self-destruct and clean up everything for a single client.
 * This will NOT destroy the embedded Flash object.
 *
 * @returns `undefined`
 */
  ZeroClipboard.prototype.destroy = function() {
    return _clientDestroy.apply(this, _args(arguments));
  };
  /**
 * Stores the pending plain text to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setText = function(text) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData("text/plain", text);
    return this;
  };
  /**
 * Stores the pending HTML text to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setHtml = function(html) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData("text/html", html);
    return this;
  };
  /**
 * Stores the pending rich text (RTF) to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setRichText = function(richText) {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData("application/rtf", richText);
    return this;
  };
  /**
 * Stores the pending data to inject into the clipboard.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.setData = function() {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.setData.apply(this, _args(arguments));
    return this;
  };
  /**
 * Clears the pending data to inject into the clipboard.
 * If no `format` is provided, all pending data formats will be cleared.
 *
 * @returns `this`
 */
  ZeroClipboard.prototype.clearData = function() {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    ZeroClipboard.clearData.apply(this, _args(arguments));
    return this;
  };
  /**
 * Gets a copy of the pending data to inject into the clipboard.
 * If no `format` is provided, a copy of ALL pending data formats will be returned.
 *
 * @returns `String` or `Object`
 */
  ZeroClipboard.prototype.getData = function() {
    if (!_clientMeta[this.id]) {
      throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");
    }
    return ZeroClipboard.getData.apply(this, _args(arguments));
  };
  if (typeof define === "function" && define.amd) {
    define('lib/zero-clipboard/dist/ZeroClipboard',[],function() {
      return ZeroClipboard;
    });
  } else if (typeof module === "object" && module && typeof module.exports === "object" && module.exports) {
    module.exports = ZeroClipboard;
  } else {
    window.ZeroClipboard = ZeroClipboard;
  }
})(function() {
  return this || window;
}());
define('storymaps/common/ui/share/ShareURLPanel',[
  'lib-build/tpl!./ShareURLPanel',
  'lib-build/css!./ShareURLPanel',
  '../../utils/SocialSharing',
  'dojo/has',
  'lib/zero-clipboard/dist/ZeroClipboard'
], function(
  viewTpl,
  viewCss,
  SocialSharing,
  has,
  ZeroClipboard
) {
  return function ShareURLPanel(container) {
    container.append(viewTpl({ }));

    var _linkField = container.find('.bitlylink'),
        _url = null;

    initEvents();

    this.present = function(url) {
      _url = SocialSharing.cleanURL(url, true);

      buildShortLink(url);

      container.find('.btn-bitlylink-open').html(i18n.viewer.shareFromCommon.open);

      // Touch device don't likely have flash...
      container.find('.share-url-container').toggleClass('touch', !! has('touch'));
      container.find('.share-btn').attr('title', i18n.viewer.shareFromCommon.copy);
      container.find('.share-status').html(i18n.viewer.shareFromCommon.copied);
    };

    this.focus = function() {
      _linkField.select();
    };

    this.setAutoplay = function(isAutoplay) {
      var url = _url;

      if (isAutoplay) {
        url += url.match(/\?/) ? '&' : '?';
        url += 'autoplay';
      }

      buildShortLink(url);
    };

    function buildShortLink(url) {
      _linkField.val(url);
      container.find('.btn-bitlylink-open').attr('href', url);

      SocialSharing.requestBitly(url).then(function(shortURL) {
        _linkField.val(shortURL).select();
      });

      //
      // Copy button
      //

      var swfPath = 'resources/lib/zero-clipboard/ZeroClipboard.swf';
      if (! app.isProduction) {
        swfPath = 'lib/zero-clipboard/dist/ZeroClipboard.swf';
      }
      ZeroClipboard.config({ swfPath: swfPath  });
      var bitLyCopy = new ZeroClipboard(container.find('.share-btn'));

      bitLyCopy.on('copy', function(event) {
        var clipboard = event.clipboardData;
        clipboard.setData('text/plain', container.find('.bitlylink').val());
        container.find('.share-btn').removeClass('glyphicon-copy').addClass('glyphicon-ok');
        container.find('.share-status').show();
        container.find('.bitlylink')[0].selectionStart = container.find('.bitlylink')[0].selectionEnd = -1;

        container.find('.bitlylink').focus();

        setTimeout(function() {
          container.find('.share-btn').addClass('glyphicon-copy').removeClass('glyphicon-ok');
          container.find('.share-status').hide();
        }, 2000);
      });
    }

    function initEvents() {
      container.find('.bitlylink').click(function() {
        this.setSelectionRange(0, this.value.length);
      });
    }
  };
});


define('lib-build/tpl!storymaps/common/ui/share/ShareEmbedPanel', [],function () { return function(obj){obj||(obj={});var __t,__p='',__e=_.escape;with(obj){__p+='<div class="share-embed-container">\r\n\t<div class="embed-explain"></div>\r\n\r\n\t<div class="share-embed-wrapper">\r\n\t\t<div class="share-btn glyphicon glyphicon-copy"></div>\t\r\n\t\t<textarea class="form-control embedTextarea" readonly="true"></textarea>\r\n\t</div>\r\n\t<div class="share-status-wrapper"><span class="share-status"></span></div>\r\n\r\n\t<div>\r\n\t\t<span class="embed-lbl-size"></span>\r\n\t\t<div class="btn-group">\r\n\t\t\t<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">\r\n\t\t\t\t<span class="embed-sizes-btn"></span>&nbsp;<span class="caret"></span>\r\n\t\t\t</button>\r\n\t\t\t<ul class="dropdown-menu embed-sizes" role="menu"></ul>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n';}return __p}; });


define('lib-build/css!storymaps/common/ui/share/ShareEmbedPanel',[],function(){});
define('storymaps/common/ui/share/ShareEmbedPanel',[
  'lib-build/tpl!./ShareEmbedPanel',
  'lib-build/css!./ShareEmbedPanel',
  'dojo/has',
  'lib/zero-clipboard/dist/ZeroClipboard'
], function(
  viewTpl,
  viewCss,
  has,
  ZeroClipboard
) {
  return function ShareEmbedPanel(container) {
    var EMBED_TPL  = '<iframe width="%WIDTH%" height="%HEIGHT%" src="%URL%" frameborder="0" scrolling="no"></iframe>',
        EMBED_SIZE = [
          {
            width: '100%',
            height: '800px'
          },
          {
            width: '100%',
            height: '640px'
          },
          {
            width: '800px',
            height: '600px'
          },
          {
            width: '640px',
            height: '480px'
          }
        ],
        _url = null,
        _urlBackup = null;

    container.append(viewTpl({ }));

    buildEmbedSizeList();

    initEvents();

    this.present = function(url) {
      _url = url;
      _urlBackup = url;

      container.find('.embed-explain').html(i18n.viewer.shareFromCommon.embedExplain);
      container.find('.embed-lbl-size').html(i18n.viewer.shareFromCommon.size);

      container.find('.embed-sizes a').eq(0).click();

      // Touch device don't likely have flash...
      container.find('.share-embed-wrapper').toggleClass('touch', !! has('touch'));
      container.find('.share-clipboard').attr('title', i18n.viewer.shareFromCommon.copy);
      container.find('.share-status').html(i18n.viewer.shareFromCommon.copied);
    };

    this.setAutoplay = function(isAutoplay) {
      var url = _urlBackup;

      if (isAutoplay) {
        url += url.match(/\?/) ? '&' : '?';
        url += 'autoplay';
      }

      _url = url;
      
      container.find('.embed-sizes a').eq(0).click();
    };

    function buildEmbedSizeList() {
      $.each(EMBED_SIZE, function(i, size) {
        container.find('.embed-sizes').append('<li><a data-width="' + size.width + '" data-height="' + size.height + '">' + size.width + ' / ' + size.height + '</a></li>');
      });

      container.find('.embed-sizes a').click(function() {
        var $this = $(this);

        $this.parents('.btn-group').find('.embed-sizes-btn').text($this.text());
        setEmbed($this.data('width'), $this.data('height'));
      });
    }

    function setEmbed(width, height) {
      container.find('.embedTextarea').val(
        EMBED_TPL
          .replace('%URL%', _url)
          .replace('%WIDTH%', width)
          .replace('%HEIGHT%', height)
      );

      //
      // Copy button
      //

      var swfPath = 'resources/lib/zero-clipboard/ZeroClipboard.swf';
      if (! app.isProduction) {
        swfPath = 'lib/zero-clipboard/dist/ZeroClipboard.swf';
      }
      ZeroClipboard.config({ swfPath: swfPath  });
      var bitLyCopy = new ZeroClipboard(container.find('.share-btn'));

      bitLyCopy.on('copy', function(event) {
        var clipboard = event.clipboardData;
        clipboard.setData('text/plain', container.find('.embedTextarea').val());
        container.find('.share-btn').removeClass('glyphicon-copy').addClass('glyphicon-ok');
        container.find('.share-status').show();
        container.find('.embedTextarea')[0].selectionStart = container.find('.embedTextarea')[0].selectionEnd = -1;

        container.find('.bitlylink').focus();

        setTimeout(function() {
          container.find('.share-btn').addClass('glyphicon-copy').removeClass('glyphicon-ok');
          container.find('.share-status').hide();
        }, 2000);
      });
    }

    function initEvents() {
      container.find('.embedTextarea').click(function() {
        this.setSelectionRange(0, this.value.length);
      });
    }
  };
});

define('storymaps/common/ui/share/ShareDialog',[
  'lib-build/tpl!./ShareDialog',
  'lib-build/css!./ShareDialog',
  'lib-build/less!./ShareDialog',
  './ShareURLPanel',
  './ShareEmbedPanel',
  '../../utils/SocialSharing'
], function(
  viewTpl,
  viewCss,
  viewLess,
  ShareURLPanel,
  ShareEmbedPanel,
  SocialSharing
) {
  return function ShareDialog(container) {
    container.append(viewTpl({ }));

    var _shareURLPanel = new ShareURLPanel(container.find('.share-url-panel')),
        _shareEmbedPanel = new ShareEmbedPanel(container.find('.share-embed-panel'));

    container.on('shown.bs.modal', function() {
      _shareURLPanel.focus();
    });

    container.find('.autoplay-checkbox').change(function() {
      _shareURLPanel.setAutoplay(!! this.checked);
      _shareEmbedPanel.setAutoplay(!! this.checked);
      
      container.find('.autoplay-notification')
        .html(i18n.viewer.shareFromCommon.linksupdated)
        .fadeIn();

      setTimeout(function() {
        container.find('.autoplay-notification').fadeOut();
      }, 1000);
    });

    this.present = function(url, socialOptions) {
      socialOptions = socialOptions || {
        facebook: false,
        twitter: false
      };

      container.find('.social-container').toggle(socialOptions.facebook || socialOptions.twitter);
      createSocialbuttons(socialOptions);

      /*
      SocialSharing.shareFacebook(
        '',
        '',
        null,
        $(this).data('url')
      );

      var tweet = app.data.title;

      if ($('meta[name="twitter:description"]').length) {
        tweet += ' - ' + $('meta[name="twitter:description"]').attr('content');
      }
      else {
        tweet += ' - ' + app.data.subtitle;
      }

      var title = $('<div>' + tweet + '</div>').text();

      SocialSharing.shareTwitter(
        title,
        $(this).data('url')
      );
      */

      _shareURLPanel.present(url);
      _shareEmbedPanel.present(url);

      container.find('.modal-title').html(i18n.viewer.headerFromCommon.share);
      container.find('.embed-title').html(i18n.viewer.shareFromCommon.embed);
      container.find('.btn-close').html(i18n.viewer.common.close);

      container.find('.autoplay-label').html(i18n.viewer.shareFromCommon.autoplayLabel);
      container.find('.autoplay-help').tooltip({
        title: i18n.viewer.shareFromCommon.autoplayExplain1
          + '<br /><br />'
          + i18n.viewer.shareFromCommon.autoplayExplain2,
        html: true
      });
      container.find('.autoplay-checkbox').prop('checked', false);

      container.modal({ keyboard: true });
    };

    function createSocialbuttons(socialOptions) {
      var appTitle = $('<div>' + app.data.title + '</div>').text();

      container.find('.share_facebook').toggle(socialOptions.facebook);
      if (socialOptions.facebook) {
        container.find('.share_facebook').off('click').click(function() {
          SocialSharing.shareFacebook(
            '',
            '',
            null,
            $(this).data('url')
          );
        });
      }

      container.find('.share_twitter').toggle(socialOptions.twitter);
      if (socialOptions.twitter) {
        container.find('.share_twitter').off('click').click(function() {
          SocialSharing.shareTwitter(
            appTitle,
            $(this).data('url')
          );
        });
      }
    }
  };
});


define('lib-build/less!storymaps-react/tpl/view/ui/Header',[],function(){});
define('storymaps-react/tpl/view/ui/Header',['module', 'exports', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'storymaps/common/utils/CommonHelper', 'storymaps-react/tpl/view/media/Media', 'storymaps/tpl/view/ui/ProgressBar', './Bookmarks', 'storymaps/common/ui/share/ShareDialog', 'storymaps/common/utils/SocialSharing', 'dojo/has', 'lib-build/less!./Header'], function (module, exports, _app, _CommonHelper, _Media, _ProgressBar, _Bookmarks, _ShareDialog, _SocialSharing, _has) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _app2 = _interopRequireDefault(_app);

  var _CommonHelper2 = _interopRequireDefault(_CommonHelper);

  var _Media2 = _interopRequireDefault(_Media);

  var _ProgressBar2 = _interopRequireDefault(_ProgressBar);

  var _Bookmarks2 = _interopRequireDefault(_Bookmarks);

  var _ShareDialog2 = _interopRequireDefault(_ShareDialog);

  var _SocialSharing2 = _interopRequireDefault(_SocialSharing);

  var _has2 = _interopRequireDefault(_has);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var HEADER_HEIGHT = 50;

  var Header = function () {
    function Header() {
      _classCallCheck(this, Header);

      this._node = $('.story-header');
      this._bookmarksNode = this._node.find('.bookmarks');

      this._shareDialog = new _ShareDialog2.default($('#shareDialog'));
      this._progressBar = new _ProgressBar2.default();
      this._bookmarks = new _Bookmarks2.default(this._node.find('.bookmarks'));

      this._isCompact = null;
      this._currentSection = null;

      this.initShareTooltip();
    }

    _createClass(Header, [{
      key: 'render',
      value: function render() {
        var _this = this;

        var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
        var logo = params.logo;
        var link = params.link;
        var social = params.social;
        var title = params.title;


        var socialCfg = {
          logoEnabled: logo.enabled,
          logoURL: _Media2.default.addToken(logo.url),
          logoTarget: logo.link,
          linkURL: link.url,
          linkText: link.title
        };

        this.setLogo(this._node, socialCfg).then(function () {
          _this._bookmarks.render(params.bookmarks);
        }, function () {
          _this._bookmarks.render(params.bookmarks);
        });
        this.setLink(this._node, socialCfg);

        this._node.find('.title').html(title);

        this._node.find('.share-btn').off('click').click(this._onShareBtnClick.bind(this)).toggleClass('active', !!social.enabled);

        this._progressBar.start();
        this._bookmarks.render(params.bookmarks);

        this.toggleShareButton();
      }
    }, {
      key: 'initShareTooltip',
      value: function initShareTooltip() {
        var shareContainer = this._node.find('.share-btn-container[data-toggle="tooltip"]');

        shareContainer.tooltip({
          title: _app2.default.builder.header.sharingNotAvailable,
          placement: 'auto left'
        });

        shareContainer.on('inserted.bs.tooltip', function () {
          $(this).data('bs.tooltip').$tip.addClass('custom-share-tooltip');
        });

        shareContainer.tooltip('disable');
      }
    }, {
      key: 'toggleShareButton',
      value: function toggleShareButton() {
        var isPrivate = true;

        if (window.app.data.appItem && window.app.data.appItem.item && window.app.data.appItem.item.access) {
          if (app.data.appItem.item.access !== 'private' && app.data.appItem.item.access !== 'shared') {
            isPrivate = false;
          }
        }

        var socialShareButton = this._node.find('.share-btn');
        var shareContainer = this._node.find('.share-btn-container[data-toggle="tooltip"]');

        // if the story's private or the app has not yet been saved, disable the share button.
        if (isPrivate || app.builder && app.builder.isDirectCreationFirstSave) {
          socialShareButton.addClass('share-disabled');
          shareContainer.tooltip('enable');
        } else {
          socialShareButton.removeClass('share-disabled');
          shareContainer.tooltip('disable');
        }
      }
    }, {
      key: 'disableShareButtonAutoplay',
      value: function disableShareButtonAutoplay() {
        var socialShareButton = this._node.find('.share-btn');
        var shareContainer = this._node.find('.share-btn-container[data-toggle="tooltip"]');

        socialShareButton.addClass('share-disabled');
        shareContainer.tooltip('destroy').tooltip({
          title: window.i18n.viewer.headerFromCommon.tooltipAutoplayDisabled,
          trigger: 'hover',
          placement: 'left'
        });
      }
    }, {
      key: 'setLogo',
      value: function setLogo(container, headerCfg) {
        return new Promise(function (resolve, reject) {
          if (!headerCfg.logoEnabled || !headerCfg.logoURL || headerCfg.logoURL == 'NO_LOGO') {
            container.find('.logoImg').hide();
            //resizeLinkContainer(container);
            reject();
          } else {
            (function () {
              container.find('.logoLink').css('cursor', headerCfg.logoTarget ? 'pointer' : 'default');

              if (headerCfg.logoTarget) {
                container.find('.logoLink').attr('href', headerCfg.logoTarget);
              }

              var imageNode = container.find('.logoImg');

              imageNode.on('error', function () {
                imageNode.hide();
                reject();
              });

              imageNode.on('load', function () {
                resolve();
              });

              imageNode.attr('src', headerCfg.logoURL).show();
            })();
          }
        });
      }
    }, {
      key: 'setLink',
      value: function setLink(container, headerCfg) {
        if (headerCfg.linkURL && headerCfg.linkText) {
          container.find('.linkContainer').html('<a href="' + headerCfg.linkURL + '" class="link" target="_blank" tabindex="-1">' + headerCfg.linkText + '</a>');
        } else {
          container.find('.linkContainer').html(headerCfg.linkText);
        }
      }
    }, {
      key: 'update',
      value: function update(params) {
        //
        // Story progress
        //
        this._progressBar.update(params.storyProgress);

        //
        // Header mode
        //

        if (this._isCompact !== params.headerCompact) {
          this._isCompact = params.headerCompact;

          this._node.toggleClass('compact', this._isCompact);
          this._bookmarksNode.toggleClass('bookmarks-hidden', this._isCompact);
          if (!this._isCompact) {
            this._node.css('background-color', 'rgba(0,0,0,1)');
          }
        }
        //
        // Bookmarks
        // only update when the section number has changed (not on each scroll)
        if (this._currentSection !== params.sectionIndex) {
          this._currentSection = params.sectionIndex;
          this._bookmarks.update(params.sectionIndex);
        }
      }
    }, {
      key: 'resize',
      value: function resize() {
        this._bookmarks.resize();
      }
    }, {
      key: 'getHeight',
      value: function getHeight() {
        return HEADER_HEIGHT;
      }
    }, {
      key: '_onShareBtnClick',
      value: function _onShareBtnClick() {
        this._shareDialog.present(_SocialSharing2.default.cleanURL(document.location.href, true), {
          facebook: true,
          twitter: true
        });
      }
    }, {
      key: 'showEditButton',
      value: function showEditButton() {
        this._node.find('.header-edit-button').html('<i class="header-edit-icon fa fa-pencil"></i>' + _app2.default.builder.header.edit + '<span aria-hidden="true" class="header-edit-close"></span>').show().off('click').click(_CommonHelper2.default.switchToBuilder);

        if ((0, _has2.default)('ff') || (0, _has2.default)('ie') || (0, _has2.default)('trident') == 7) {
          this._node.find('.header-edit-close').hide();
        } else {
          this._node.find('.header-edit-close').click(function () {
            this._node.find('.header-edit-button').hide();
            $(window).resize();
            return false;
          }.bind(this));
        }
      }
    }]);

    return Header;
  }();

  exports.default = Header;
  module.exports = exports['default'];
});
//# sourceMappingURL=Header.js.map
;

define('lib-build/hbars!storymaps-react/tpl/view/ui/Autoplay', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  return "<div class=\"autoplay-controls\">\r\n  <i class=\"autoplay-btn fa fa-pause\" aria-hidden=\"true\"></i>\r\n  <div class=\"slider-container \">\r\n		<input type=\"text\" />\r\n	</div>\r\n</div>\r\n";
  },"useData":true}); });


define('lib-build/less!storymaps-react/tpl/view/ui/Autoplay',[],function(){});
/*! =======================================================
                      VERSION  9.1.3              
========================================================= */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},windowIsDefined="object"===("undefined"==typeof window?"undefined":_typeof(window));!function(a){if("function"==typeof define&&define.amd)define('lib/seiyria-bootstrap-slider/dist/bootstrap-slider.min',["jquery"],a);else if("object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports){var b;try{b=require("jquery")}catch(c){b=null}module.exports=a(b)}else window&&(window.Slider=a(window.jQuery))}(function(a){var b="slider",c="bootstrapSlider";windowIsDefined&&!window.console&&(window.console={}),windowIsDefined&&!window.console.log&&(window.console.log=function(){}),windowIsDefined&&!window.console.warn&&(window.console.warn=function(){});var d;return function(a){function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l&&l!==k)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}var m=this.map(function(){var d=a.data(this,b);return d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d)),a(this)});return!m||m.length>1?m:m[0]}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;c(a)}(a),function(a){function e(b,c){function d(a,b){var c="data-slider-"+b.replace(/_/g,"-"),d=a.getAttribute(c);try{return JSON.parse(d)}catch(e){return d}}this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:!1,over:!1},"string"==typeof b?this.element=document.querySelector(b):b instanceof HTMLElement&&(this.element=b),c=c?c:{};for(var e=Object.keys(this.defaultOptions),f=0;f<e.length;f++){var h=e[f],i=c[h];i="undefined"!=typeof i?i:d(this.element,h),i=null!==i?i:this.defaultOptions[h],this.options||(this.options={}),this.options[h]=i}"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.tooltip_position="right";var j,k,l,m,n,o=this.element.style.width,p=!1,q=this.element.parentNode;if(this.sliderElem)p=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var r=document.createElement("div");r.className="slider-track",k=document.createElement("div"),k.className="slider-track-low",j=document.createElement("div"),j.className="slider-selection",l=document.createElement("div"),l.className="slider-track-high",m=document.createElement("div"),m.className="slider-handle min-slider-handle",m.setAttribute("role","slider"),m.setAttribute("aria-valuemin",this.options.min),m.setAttribute("aria-valuemax",this.options.max),n=document.createElement("div"),n.className="slider-handle max-slider-handle",n.setAttribute("role","slider"),n.setAttribute("aria-valuemin",this.options.min),n.setAttribute("aria-valuemax",this.options.max),r.appendChild(k),r.appendChild(j),r.appendChild(l);var s=Array.isArray(this.options.labelledby);if(s&&this.options.labelledby[0]&&m.setAttribute("aria-labelledby",this.options.labelledby[0]),s&&this.options.labelledby[1]&&n.setAttribute("aria-labelledby",this.options.labelledby[1]),!s&&this.options.labelledby&&(m.setAttribute("aria-labelledby",this.options.labelledby),n.setAttribute("aria-labelledby",this.options.labelledby)),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(this.ticksContainer=document.createElement("div"),this.ticksContainer.className="slider-tick-container",f=0;f<this.options.ticks.length;f++){var t=document.createElement("div");t.className="slider-tick",this.ticks.push(t),this.ticksContainer.appendChild(t)}j.className+=" tick-slider-selection"}if(this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",f=0;f<this.options.ticks_labels.length;f++){var u=document.createElement("div"),v=0===this.options.ticks_positions.length,w=this.options.reversed&&v?this.options.ticks_labels.length-(f+1):f;u.className="slider-tick-label",u.innerHTML=this.options.ticks_labels[w],this.tickLabels.push(u),this.tickLabelContainer.appendChild(u)}var x=function(a){var b=document.createElement("div");b.className="tooltip-arrow";var c=document.createElement("div");c.className="tooltip-inner",a.appendChild(b),a.appendChild(c)},y=document.createElement("div");y.className="tooltip tooltip-main",y.setAttribute("role","presentation"),x(y);var z=document.createElement("div");z.className="tooltip tooltip-min",z.setAttribute("role","presentation"),x(z);var A=document.createElement("div");A.className="tooltip tooltip-max",A.setAttribute("role","presentation"),x(A),this.sliderElem.appendChild(r),this.sliderElem.appendChild(y),this.sliderElem.appendChild(z),this.sliderElem.appendChild(A),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),this.ticksContainer&&this.sliderElem.appendChild(this.ticksContainer),this.sliderElem.appendChild(m),this.sliderElem.appendChild(n),q.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(a&&(this.$element=a(this.element),this.$sliderElem=a(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.touchX=0,this.touchY=0,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),g[this.options.scale]&&(this.options.scale=g[this.options.scale]),p===!0&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(a){this._removeProperty(this.trackLow,a),this._removeProperty(this.trackSelection,a),this._removeProperty(this.trackHigh,a)},this),[this.handle1,this.handle2].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top"),this._removeProperty(a,"margin-left"),this._removeProperty(a,"margin-top"),this._removeClass(a,"right"),this._removeClass(a,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=o,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this._setTooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this.options.range?this._state.value=[this.options.value,this.options.max]:this._state.value=this.options.value,this.trackLow=k||this.trackLow,this.trackSelection=j||this.trackSelection,this.trackHigh=l||this.trackHigh,"none"===this.options.selection&&(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")),this.handle1=m||this.handle1,this.handle2=n||this.handle2,p===!0)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),f=0;f<this.ticks.length;f++)this._removeClass(this.ticks[f],"round triangle hide");var B=["round","triangle","custom"],C=-1!==B.indexOf(this.options.handle);if(C)for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),f=0;f<this.ticks.length;f++)this._addClass(this.ticks[f],this.options.handle);this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchstart=this._touchstart.bind(this),this.touchmove=this._touchmove.bind(this),this.touchCapable&&(this.sliderElem.addEventListener("touchstart",this.touchstart,!1),this.sliderElem.addEventListener("touchmove",this.touchmove,!1)),this.sliderElem.addEventListener("mousedown",this.mousedown,!1),this.resize=this._resize.bind(this),window.addEventListener("resize",this.resize,!1),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showTooltip(),this._alwaysShowTooltip=!0):(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1),this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)),this.options.enabled?this.enable():this.disable()}var f={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},g={linear:{toValue:function(a){var b=a/100*(this.options.max-this.options.min),c=!0;if(this.options.ticks_positions.length>0){for(var d,e,f,g=0,h=1;h<this.options.ticks_positions.length;h++)if(a<=this.options.ticks_positions[h]){d=this.options.ticks[h-1],f=this.options.ticks_positions[h-1],e=this.options.ticks[h],g=this.options.ticks_positions[h];break}var i=(a-f)/(g-f);b=d+i*(e-d),c=!1}var j=c?this.options.min:0,k=j+Math.round(b/this.options.step)*this.options.step;return k<this.options.min?this.options.min:k>this.options.max?this.options.max:k},toPercentage:function(a){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var b,c,d,e=0,f=0;f<this.options.ticks.length;f++)if(a<=this.options.ticks[f]){b=f>0?this.options.ticks[f-1]:0,d=f>0?this.options.ticks_positions[f-1]:0,c=this.options.ticks[f],e=this.options.ticks_positions[f];break}if(f>0){var g=(a-b)/(c-b);return d+g*(e-d)}}return 100*(a-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(a){var b=0===this.options.min?0:Math.log(this.options.min),c=Math.log(this.options.max),d=Math.exp(b+(c-b)*a/100);return d=this.options.min+Math.round((d-this.options.min)/this.options.step)*this.options.step,d<this.options.min?this.options.min:d>this.options.max?this.options.max:d},toPercentage:function(a){if(this.options.max===this.options.min)return 0;var b=Math.log(this.options.max),c=0===this.options.min?0:Math.log(this.options.min),d=0===a?0:Math.log(a);return 100*(d-c)/(b-c)}}};d=function(a,b){return e.call(this,a,b),this},d.prototype={_init:function(){},constructor:d,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(a){return Array.isArray(a)?a[0]+" : "+a[1]:a},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,scale:"linear",focus:!1,tooltip_position:null,labelledby:null},getElement:function(){return this.sliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(a,b,c){a||(a=0);var d=this.getValue();this._state.value=this._validateInputValue(a);var e=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=e(this._state.value[0]),this._state.value[1]=e(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=e(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),"after"===this.options.selection?this._state.value[1]=this.options.max:this._state.value[1]=this.options.min),this.options.max>this.options.min?this._state.percentage=[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:this._state.percentage=[0,0,100],this._layout();var f=this.options.range?this._state.value:this._state.value[0];return this._setDataVal(f),b===!0&&this._trigger("slide",f),d!==f&&c===!0&&this._trigger("change",{oldValue:d,newValue:f}),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),a&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(a,b){return this._bindNonQueryEventHandler(a,b),this},off:function(b,c){a?(this.$element.off(b,c),this.$sliderElem.off(b,c)):this._unbindNonQueryEventHandler(b,c)},getAttribute:function(a){return a?this.options[a]:this.options},setAttribute:function(a,b){return this.options[a]=b,this},refresh:function(){return this._removeSliderEventHandlers(),e.call(this,this.element,this.options),a&&a.data(this.element,"slider",this),this},relayout:function(){return this._resize(),this._layout(),this},_removeSliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.showTooltip&&(this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle2.removeEventListener("focus",this.showTooltip,!1)),this.hideTooltip&&(this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("blur",this.hideTooltip,!1)),this.showTooltip&&this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.hideTooltip&&this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.touchstart,!1),this.sliderElem.removeEventListener("touchmove",this.touchmove,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1),window.removeEventListener("resize",this.resize,!1)},_bindNonQueryEventHandler:function(a,b){void 0===this.eventToCallbackMap[a]&&(this.eventToCallbackMap[a]=[]),this.eventToCallbackMap[a].push(b)},_unbindNonQueryEventHandler:function(a,b){var c=this.eventToCallbackMap[a];if(void 0!==c)for(var d=0;d<c.length;d++)if(c[d]===b){c.splice(d,1);break}},_cleanUpEventCallbacksMap:function(){for(var a=Object.keys(this.eventToCallbackMap),b=0;b<a.length;b++){var c=a[b];this.eventToCallbackMap[c]=null}},_showTooltip:function(){this.options.tooltip_split===!1?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hideTooltip:function(){this._state.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_layout:function(){var a;if(a=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=a[0]+"%",this.handle1.setAttribute("aria-valuenow",this._state.value[0]),this.handle2.style[this.stylePos]=a[1]+"%",this.handle2.setAttribute("aria-valuenow",this._state.value[1]),Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var b="vertical"===this.options.orientation?"height":"width",c="vertical"===this.options.orientation?"marginTop":"marginLeft",d=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var e=0;if(0===this.options.ticks_positions.length)"vertical"!==this.options.orientation&&(this.tickLabelContainer.style[c]=-d/2+"px"),e=this.tickLabelContainer.offsetHeight;else for(f=0;f<this.tickLabelContainer.childNodes.length;f++)this.tickLabelContainer.childNodes[f].offsetHeight>e&&(e=this.tickLabelContainer.childNodes[f].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=e+"px")}for(var f=0;f<this.options.ticks.length;f++){var g=this.options.ticks_positions[f]||this._toPercentage(this.options.ticks[f]);this.options.reversed&&(g=100-g),this.ticks[f].style[this.stylePos]=g+"%",this._removeClass(this.ticks[f],"in-selection"),this.options.range?g>=a[0]&&g<=a[1]&&this._addClass(this.ticks[f],"in-selection"):"after"===this.options.selection&&g>=a[0]?this._addClass(this.ticks[f],"in-selection"):"before"===this.options.selection&&g<=a[0]&&this._addClass(this.ticks[f],"in-selection"),this.tickLabels[f]&&(this.tickLabels[f].style[b]=d+"px","vertical"!==this.options.orientation&&void 0!==this.options.ticks_positions[f]?(this.tickLabels[f].style.position="absolute",this.tickLabels[f].style[this.stylePos]=g+"%",this.tickLabels[f].style[c]=-d/2+"px"):"vertical"===this.options.orientation&&(this.tickLabels[f].style.marginLeft=this.sliderElem.offsetWidth+"px",this.tickLabelContainer.style.marginTop=this.sliderElem.offsetWidth/2*-1+"px"))}}var h;if(this.options.range){h=this.options.formatter(this._state.value),this._setText(this.tooltipInner,h),this.tooltip.style[this.stylePos]=(a[1]+a[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var i=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,i);var j=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,j),this.tooltip_min.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else h=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,h),this.tooltip.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(a[0],a[1])+"%",this.trackSelection.style.top=Math.min(a[0],a[1])+"%",this.trackSelection.style.height=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";else{this.trackLow.style.left="0",this.trackLow.style.width=Math.min(a[0],a[1])+"%",this.trackSelection.style.left=Math.min(a[0],a[1])+"%",this.trackSelection.style.width=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";var k=this.tooltip_min.getBoundingClientRect(),l=this.tooltip_max.getBoundingClientRect();"bottom"===this.options.tooltip_position?k.right>l.left?(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="",this.tooltip_max.style.bottom="22px"):(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top=this.tooltip_min.style.top,this.tooltip_max.style.bottom=""):k.right>l.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}},_resize:function(a){this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this._layout()},_removeProperty:function(a,b){a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},_mousedown:function(a){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos];var b=this._getPercentage(a);if(this.options.range){var c=Math.abs(this._state.percentage[0]-b),d=Math.abs(this._state.percentage[1]-b);this._state.dragged=d>c?0:1,this._adjustPercentageForRangeSliders(b)}else this._state.dragged=0;this._state.percentage[this._state.dragged]=b,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var e=this._calculateValue();return this._trigger("slideStart",e),this._setDataVal(e),this.setValue(e,!1,!0),this._pauseEvent(a),this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_touchstart:function(a){if(void 0===a.changedTouches)return void this._mousedown(a);var b=a.changedTouches[0];this.touchX=b.pageX,this.touchY=b.pageY},_triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},_keydown:function(a,b){if(!this._state.enabled)return!1;var c;switch(b.keyCode){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){if(this.options.natural_arrow_keys){var d="vertical"===this.options.orientation&&!this.options.reversed,e="horizontal"===this.options.orientation&&this.options.reversed;(d||e)&&(c=-c)}var f=this._state.value[a]+c*this.options.step;return this.options.range&&(f=[a?this._state.value[0]:f,a?f:this._state.value[1]]),this._trigger("slideStart",f),this._setDataVal(f),this.setValue(f,!0,!0),this._setDataVal(f),this._trigger("slideStop",f),this._layout(),this._pauseEvent(b),!1}},_pauseEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},_mousemove:function(a){if(!this._state.enabled)return!1;var b=this._getPercentage(a);this._adjustPercentageForRangeSliders(b),this._state.percentage[this._state.dragged]=b,this._layout();var c=this._calculateValue(!0);return this.setValue(c,!0,!0),!1},_touchmove:function(a){if(void 0!==a.changedTouches){var b=a.changedTouches[0],c=b.pageX-this.touchX,d=b.pageY-this.touchY;this._state.inDrag||("vertical"===this.options.orientation&&5>=c&&c>=-5&&(d>=15||-15>=d)?this._mousedown(a):5>=d&&d>=-5&&(c>=15||-15>=c)&&this._mousedown(a))}},_adjustPercentageForRangeSliders:function(a){if(this.options.range){var b=this._getNumDigitsAfterDecimalPlace(a);b=b?b-1:0;var c=this._applyToFixedAndParseFloat(a,b);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],b)<c?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],b)>c&&(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0)}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,this._state.over===!1&&this._hideTooltip();var a=this._calculateValue(!0);return this._layout(),this._setDataVal(a),this._trigger("slideStop",a),!1},_calculateValue:function(a){var b;if(this.options.range?(b=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(b[0]=this._toValue(this._state.percentage[0]),b[0]=this._applyPrecision(b[0])),100!==this._state.percentage[1]&&(b[1]=this._toValue(this._state.percentage[1]),b[1]=this._applyPrecision(b[1]))):(b=this._toValue(this._state.percentage[0]),b=parseFloat(b),b=this._applyPrecision(b)),a){for(var c=[b,1/0],d=0;d<this.options.ticks.length;d++){var e=Math.abs(this.options.ticks[d]-b);e<=c[1]&&(c=[this.options.ticks[d],e])}if(c[1]<=this.options.ticks_snap_bounds)return c[0]}return b},_applyPrecision:function(a){var b=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(a,b)},_getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},_applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},_getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=a[this.mousePos],c=this._state.offset[this.stylePos],d=b-c,e=d/this._state.size*100;return e=Math.round(e/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(e=100-e),Math.max(0,Math.min(100,e))},_validateInputValue:function(a){if("number"==typeof a)return a;if(Array.isArray(a))return this._validateArray(a),a;throw new Error(f.formatInvalidInputErrorMsg(a))},_validateArray:function(a){for(var b=0;b<a.length;b++){var c=a[b];if("number"!=typeof c)throw new Error(f.formatInvalidInputErrorMsg(c))}},_setDataVal:function(a){this.element.setAttribute("data-value",a),this.element.setAttribute("value",a),this.element.value=a},_trigger:function(b,c){c=c||0===c?c:void 0;var d=this.eventToCallbackMap[b];if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f(c)}a&&this._triggerJQueryEvent(b,c)},_triggerJQueryEvent:function(a,b){var c={type:a,value:b};this.$element.trigger(c),this.$sliderElem.trigger(c)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(a,b){"undefined"!=typeof a.textContent?a.textContent=b:"undefined"!=typeof a.innerText&&(a.innerText=b)},_removeClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)");d=d.replace(g," ")}a.className=d.trim()},_addClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)"),h=g.test(d);h||(d+=" "+f)}a.className=d.trim()},_offsetLeft:function(a){return a.getBoundingClientRect().left},_offsetTop:function(a){for(var b=a.offsetTop;(a=a.offsetParent)&&!isNaN(a.offsetTop);)b+=a.offsetTop,"BODY"!==a.tagName&&(b-=a.scrollTop);return b},_offset:function(a){return{left:this._offsetLeft(a),top:this._offsetTop(a)}},_css:function(b,c,d){if(a)a.style(b,c,d);else{var e=c.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(a,b){return b.toUpperCase()});b.style[e]=d}},_toValue:function(a){return this.options.scale.toValue.apply(this,[a])},_toPercentage:function(a){return this.options.scale.toPercentage.apply(this,[a])},_setTooltipPosition:function(){var a=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var b=this.options.tooltip_position||"right",c="left"===b?"right":"left";a.forEach(function(a){this._addClass(a,b),a.style[c]="100%"}.bind(this))}else"bottom"===this.options.tooltip_position?a.forEach(function(a){this._addClass(a,"bottom"),a.style.top="22px"}.bind(this)):a.forEach(function(a){this._addClass(a,"top"),a.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},a&&!function(){var e=void 0;a.fn.slider?(windowIsDefined&&window.console.warn("bootstrap-slider.js - WARNING: $.fn.slider namespace is already bound. Use the $.fn.bootstrapSlider namespace instead."),e=c):(a.bridget(b,d),e=b),a.bridget(c,d),a(function(){a("input[data-provide=slider]")[e]()})}()}(a),d});

define('lib-build/css!lib/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min',[],function(){});
define('storymaps-react/tpl/view/ui/Autoplay',['module', 'exports', 'lib-build/hbars!./Autoplay', 'dojo/has', 'lib-build/less!./Autoplay', 'lib/seiyria-bootstrap-slider/dist/bootstrap-slider.min', 'lib-build/css!lib/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min'], function (module, exports, _Autoplay, _has) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Autoplay2 = _interopRequireDefault(_Autoplay);

  var _has2 = _interopRequireDefault(_has);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var SCROLL_DURATION = 1000,
      DEFAULT_DELAY = 10,
      BTN_FADE_DELAY = 3000;

  var END_STORY_DELAY_BOTTOM = 2000,
      END_STORY_DELAY_TOP = 2000;

  var HEADER_HEIGHT = 50,
      IMMERSIVE_PANEL_PADDING = 180;

  /*
   * Autoplay require specific knowledge of each section type behavior,
   *   it would be best to offload that to each section class
   * Then it could use a similar model than other story maps apps to allow
   *   for a Kiosk app to control the autoplay
   */

  var Autoplay = function () {
    function Autoplay() {
      _classCallCheck(this, Autoplay);

      this._node = null;
      this._autoplayBtn = null;

      this._inProgress = false;
      this._delay = null;

      this._slider = null;
      this._isHoverContainer = false;
      this._mouseMoveTime = Date.now();

      this._init();
    }

    _createClass(Autoplay, [{
      key: 'start',
      value: function start() {
        var p = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

        this._delay = this._slider.slider('getValue') * 1000;

        if (this._inProgress) {
          return;
        }

        this._inProgress = true;

        if (p.immediate) {
          this._next();
        } else {
          setTimeout(this._next.bind(this), this._delay);
        }

        this._updatePlayPauseButton(true);
      }
    }, {
      key: 'stop',
      value: function stop() {
        this._inProgress = false;
        this._updatePlayPauseButton(false);
      }
    }, {
      key: 'isPlaying',
      value: function isPlaying() {
        return this._inProgress;
      }
    }, {
      key: '_next',
      value: function _next() {
        var currentSectionIndex = app.Controller._currentSectionIndex,
            currentSection = app.display.sections[currentSectionIndex],
            currentSectionType = currentSection.type,
            currentSectionHeight = currentSection.node.height(),
            browserHeight = app.display.windowHeight,
            scrollTop = $(document).scrollTop(),
            step = 0;

        if (!this._inProgress) {
          return;
        }

        if (currentSectionType == 'cover') {
          // +1 to trigger the proper active section
          step = browserHeight - HEADER_HEIGHT + 1;
        } else if (currentSectionType == 'immersive') {
          var remainingScroll = Math.ceil(currentSection.top + currentSectionHeight - scrollTop);

          if (remainingScroll >= currentSectionHeight - 1) {
            step = browserHeight + (remainingScroll - currentSectionHeight) - IMMERSIVE_PANEL_PADDING;
          } else if (remainingScroll == currentSectionHeight - browserHeight + IMMERSIVE_PANEL_PADDING) {
            step = browserHeight + IMMERSIVE_PANEL_PADDING;
          } else if (remainingScroll == browserHeight) {
            step = browserHeight - HEADER_HEIGHT;
          } else {
            step = browserHeight;
          }
        } else if (currentSectionType == 'title') {
          step = browserHeight;
        } else {
          //let remainingScroll = currentSection.top + currentSectionHeight - scrollTop;
          //step = Math.min(currentSectionHeight, browserHeight);
          //step = Math.min(step, remainingScroll);

          step = browserHeight;
        }

        console.log('scrolling', step + 'px on a ', currentSectionType, 'section');

        /*
        if (app.display.sections[currentSectionIndex + 1]) {
          var nextSectionTop = Math.floor(app.display.sections[currentSectionIndex + 1].top);
            // Make sure never scroll past the top of next section
          // TODO: should not be necessary...
          if (scrollTop + step > nextSectionTop + 1) {
            step = nextSectionTop - scrollTop - HEADER_HEIGHT + 1;
          }
          // If the next section is less than 200px away, scroll to it to avoid doing a small scroll next
          else if (scrollTop + step >= nextSectionTop - 200) {
            step = nextSectionTop - scrollTop + 1;
          }
        }
        */

        // Make sure never scroll past the top of next Immersive section
        var targetSectionIndex = -1;

        for (var i = app.display.sections.length - 1; i > 0; i--) {
          var section = app.display.sections[i];
          if (scrollTop + step > section.top) {
            targetSectionIndex = i;
            break;
          }
        }

        if (targetSectionIndex != currentSectionIndex) {
          var nextSection = app.display.sections[targetSectionIndex];
          if (nextSection && nextSection.type == 'immersive') {
            var nextSectionTop = nextSection.top;

            if (scrollTop + step > nextSectionTop) {
              step = nextSectionTop - scrollTop - HEADER_HEIGHT + 1;
            }
          }
        } else {
          var _nextSection = app.display.sections[currentSectionIndex + 1];
          if (_nextSection) {
            // Allow to scroll 200px more to avoid next scroll being small
            if (_nextSection.top - (scrollTop + step) < 200) {
              step += _nextSection.top - (scrollTop + step) - HEADER_HEIGHT;
            }
          }
        }

        $('html,body').animate({
          scrollTop: scrollTop + step
        }, {
          duration: SCROLL_DURATION
          //easing: 'linear'
        }).promise().then(function () {
          if ($(document).scrollTop() + browserHeight >= $('body').height()) {
            setTimeout(function () {
              document.body.scrollTop = 0;
              document.documentElement.scrollTop = 0;

              app.ui.update({
                forceUpdate: true
              });

              setTimeout(this._next.bind(this), END_STORY_DELAY_TOP);
            }.bind(this), END_STORY_DELAY_BOTTOM);
          } else {
            setTimeout(this._next.bind(this), this._delay);
          }
        }.bind(this));
      }
    }, {
      key: '_showContainer',
      value: function _showContainer() {
        var now = Date.now();

        // Debounce container show
        if (this._mouseMoveTime > now - 150) {
          this._node.removeClass('fade');
        }

        this._mouseMoveTime = now;
      }
    }, {
      key: '_hideContainer',
      value: function _hideContainer() {
        if (!this._isHoverContainer && Date.now() > this._mouseMoveTime + BTN_FADE_DELAY) {
          this._node.addClass('fade');
        }
      }
    }, {
      key: '_updatePlayPauseButton',
      value: function _updatePlayPauseButton(isPlaying) {
        if (isPlaying) {
          this._autoplayBtn.removeClass('fa-play').addClass('fa-pause');
        } else {
          this._autoplayBtn.removeClass('fa-pause').addClass('fa-play');
        }
      }
    }, {
      key: '_init',
      value: function _init() {
        var _this = this;

        $('body').append(_Autoplay2.default);

        this._node = $('.autoplay-controls');
        this._autoplayBtn = this._node.find('.autoplay-btn');

        //
        // Container show/hide
        //

        if (!(0, _has2.default)('ios')) {
          $('.sections').mousemove(this._showContainer.bind(this));
          setInterval(this._hideContainer.bind(this), 1000);

          this._node.hover(function () {
            _this._isHoverContainer = true;
          }, function () {
            _this._isHoverContainer = false;
            _this._hideContainer();
          });
        }

        // Slider
        this._slider = this._node.find('.slider-container input').slider({
          min: 5,
          max: 60,
          value: DEFAULT_DELAY,
          formatter: function formatter(value) {
            return value + 's';
          }
        });

        // Slider change
        this._node.find('.slider-container input').on('slideStop', function () {
          if (_this.isPlaying()) {
            _this.start({ immediate: false });
          }
        });

        this._autoplayBtn.click(function () {
          var nowPlaying = _this._autoplayBtn.hasClass('fa-play');

          if (nowPlaying) {
            _this.start({ immediate: true });
          } else {
            _this.stop();
          }
        });

        $(window).bind('mousewheel DOMMouseScroll', function () {
          if (_this._inProgress) {
            _this.stop();

            _this._mouseMoveTime = Date.now();

            _this._autoplayBtn.removeClass('fa-pause').addClass('fa-play');

            _this._node.removeClass('fade');
          }
        });
      }
    }]);

    return Autoplay;
  }();

  exports.default = Autoplay;
  module.exports = exports['default'];
});
//# sourceMappingURL=Autoplay.js.map
;
/*!
 * Bootstrap v3.3.6 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under the MIT license
 */
if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>2)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 3")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.6",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a(f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.6",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),a(c.target).is('input[type="radio"]')||a(c.target).is('input[type="checkbox"]')||c.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.6",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));return a>this.$items.length-1||0>a?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle="collapse"][href="#'+b.id+'"],[data-toggle="collapse"][data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.6",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":e.data();c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.6",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.6",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.6",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),c.isInStateTrue()?void 0:(clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide())},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;(e||!/destroy|hide/.test(b))&&(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.6",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.6",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");
d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.6",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.6",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return c>e?"top":!1;if("bottom"==this.affixed)return null!=c?e+this.unpin<=f.top?!1:"bottom":a-d>=e+g?!1:"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&c>=e?"top":null!=d&&i+j>=a-d?"bottom":!1},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);
define("lib/calcite-bootstrap/js/bootstrap.min", function(){});


define('lib-build/css!storymaps/common/utils/SocialSharing',[],function(){});
/*
| Copyright 2016 Esri
|
| Licensed under the Apache License, Version 2.0 (the "License");
| you may not use this file except in compliance with the License.
| You may obtain a copy of the License at
|
|    http://www.apache.org/licenses/LICENSE-2.0
|
| Unless required by applicable law or agreed to in writing, software
| distributed under the License is distributed on an "AS IS" BASIS,
| WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
| See the License for the specific language governing permissions and
| limitations under the License.
*/

define('storymaps/tpl/core/MainView',[
  'lib/babel-polyfill/browser-polyfill',
  'lib/jquery/dist/jquery.min',

  'lib-build/less!./MainView',
  'lib-build/css!../view/media/Common',

  'storymaps-react/tpl/core/Controller',
  'storymaps/common/Core',
  'storymaps/common/utils/CommonHelper',
  'storymaps/tpl/utils/UI',

  'storymaps-react/tpl/view/ui/Header',
  'storymaps-react/tpl/view/ui/Autoplay',

  'lib/calcite-bootstrap/js/bootstrap.min',
  'lib-build/css!storymaps/common/utils/SocialSharing',

  'esri/arcgis/utils',
  'dojo/_base/lang',
  'dojo/on',
  'dojo/has',
  'dojo/topic'

  //'lib/FitText.js/jquery.fittext.js'
], function(
  babelPolyfill,
  jQuery,

  viewCss,
  mediasCss,

  Controller,
  Core,
  CommonHelper,
  UIUtils,

  Header,
  Autoplay,

  bootstrapJS,
  socialSharingCss,

  arcgisUtils,
  lang,
  on,
  has,
  topic
) {

  // Story header
  var _header = new Header();
  // Save scroll position when a modal opens
  var _modalOpenScrollPosition = null;
  // Save the current scroll position to ignore duplicate events
  var _currentScrollTop = null;

  // Core
  var _core = null;

  // Hold reference to UI component for customization
  app.ui = {
    header: _header,
    update: updateUI
  };

  //
  // The section and media factory are accessed through window object as we can't import module dynamically with es6
  //  and Controller that is es6 needs them
  //

  require(
    [app.isInBuilder ? 'storymaps-react/tpl/view/section/FactoryBuilder' : 'storymaps-react/tpl/view/section/FactoryViewer'],
    function(SectionFactory) {
      app.ui.SectionFactory = SectionFactory;
    }
  );

  require(
    [app.isInBuilder ? 'storymaps/tpl/view/section/Immersive/PanelFactoryBuilder' : 'storymaps/tpl/view/section/Immersive/PanelFactoryViewer'],
    function(ImmersivePanelFactory) {
      app.ui.ImmersivePanelFactory = ImmersivePanelFactory;
    }
  );

  require(
    [app.isInBuilder ? 'storymaps-react/tpl/view/media/FactoryBuilder' : 'storymaps-react/tpl/view/media/FactoryViewer'],
    function(MediaFactory) {
      app.ui.MediaFactory = MediaFactory;
    }
  );

  require(
    [app.isInBuilder ? 'storymaps-react/tpl/builder/Controller' : 'storymaps-react/tpl/core/Controller'],
    function(Controller) {
      app.Controller = Controller;
    }
  );

  function init(core) {
    console.log('App loaded');
    _core = core;
    return true;
  }

  function initStory(config, settings, sections) {
    // Need some minimal info like window size before rendering the story
    computeDisplayInfos();

    if (app.display.browserWidth < 768) {
      $('body').addClass('mobile-view');
      app.isMobileView = true;
    }

    if (has('touch')) {
      $('body').addClass('touch');
    }

    app.Controller.renderStory(config, sections);
    app.Controller.renderHeader();

    displayApp();

    // Update display infos
    setTimeout(function() {
      computeDisplayInfos();
    }, 100);

    // To makes safari happy
    setTimeout(function() {
      computeDisplayInfos();
    }, 300);

    setTimeout(function() {
      computeDisplayInfos();
    }, 500);
  }

  /*
   * Update UI - mostly triggered on Scroll
   */
  function updateUI(p) {
    p = p || {};

    var scrollTop = app.display.scrollTop;

    // In builder, always recompute display infos for editing
    if (app.isInBuilder) {
      computeDisplayInfos();
    }

    app.display.scrollTop = scrollTop;

    // Ignore event without actual scroll
    if (_currentScrollTop == scrollTop && ! p.forceUpdate) {
      return;
    }

    _currentScrollTop = scrollTop;

    var sectionsDisplayInfos = getActiveAndVisibleSections(scrollTop, scrollTop + app.display.windowHeight),
        currentSectionDisplayInfos = sectionsDisplayInfos.activeSection;

    if (! currentSectionDisplayInfos) {
      return;
    }

    var currentSectionIndex = currentSectionDisplayInfos.index,
        $currentSection = currentSectionDisplayInfos.node,
        currentSectionScroll = scrollTop - currentSectionDisplayInfos.top;
        //nextSection = app.display.sections[currentSectionIndex + 1]

    //
    // Story
    //

    app.Controller.onScroll({
      currentSectionIndex: currentSectionIndex,
      scrollTop: scrollTop,
      windowWidth: app.display.windowWidth,
      windowHeight: app.display.windowHeight,
      $currentSection: $currentSection,
      sectionHeight: app.display.sectionHeight,
      currentSectionScroll: currentSectionScroll,
      visibleSections: sectionsDisplayInfos.visibleSections
    });

    //
    // Header
    //

    // TODO not sure what this is doing
    var headerCompact = false;

    if (scrollTop <= app.display.windowHeight) {
      var newPos = app.display.windowHeight - scrollTop /*- app.display.headerHeight*/ - /* help header animation */ 50;

      if (newPos < 40) {
        newPos = 0;
      }

      headerCompact = newPos !== 0;
    }

    _header.update({
      headerCompact: headerCompact,
      storyProgress: (scrollTop + app.display.windowHeight) / app.display.storyHeight * 100,
      sectionIndex: currentSectionIndex
    });
  }

  /*
  function getCurrentSectionDisplayInfos(scrollTop) {
    var sections = app.display.sections,
        nbSections = sections.length;

    for (var i = 0; i < nbSections; i++) {
      if (sections[i].top > scrollTop) {
        var index = i - 1;

        return {
          index: index,
          top: sections[index].top,
          node: sections[index].node
        };
      }
    }

    return null;
  }
  */

  /*
   * Compute the active and visible sections at every scroll
   */
  function getActiveAndVisibleSections(viewportTop, viewportBottom) {
    var sections = app.display.sections,
        nbSections = sections.length,
        activeSection = null,
        visibleSections = [],
        sectionTop = 0,
        sectionIndex = 0,
        sectionBottom = null;

    for (var i = 0; i < nbSections; i++) {
      sectionTop = sections[i].top;
      sectionIndex = i - 1;
      sectionBottom = sections[i + 1] ? sections[i + 1].top : -1;

      // The active section is the section that is before the section not visible
      if (sectionTop > viewportTop + 50) {
        if (! activeSection) {
          activeSection = {
            index: sectionIndex,
            top: sections[sectionIndex].top,
            node: sections[sectionIndex].node
          };
        }
      }

      // Except in the case it's last section of the story and there is no credits
      if (i == nbSections - 1 && ! activeSection && sections[i].type != 'credits') {
        activeSection = {
          index: i,
          top: sections[i].top,
          node: sections[i].node
        };
      }

      if (viewportTop >= sectionTop && viewportTop < sectionBottom) {
        visibleSections.push(sectionIndex + 1);
      }
      else if (viewportBottom > sectionTop && viewportTop < sectionTop) {
        visibleSections.push(sectionIndex + 1);
      }
    }

    return {
      activeSection: activeSection,
      visibleSections: visibleSections
    };
  }

  /*
   * Compute some display informations about sections and medias
   *  - elect the active section
   *  - find the sections partially visible
   */
  function computeDisplayInfos() {
    // Sections display info
    var sections = [];

    $('.section').each(function(index) {
      var node = $(this);

      sections.push({
        top: node.hasClass('hidden') ? Number.MAX_VALUE : node.position().top,
        node: node,
        type: app.data.sections[index].type
      });
    });

    // Videos in Sequence
    var inlineVideos = [];

    /*
    // Video autoplay
    $('.block .video').each(function() {
      var node = $(this),
          nodeBlock = node.parents('.block').eq(0);

      inlineVideos.push({
        id: node.attr('id'),
        top: nodeBlock.position().top,
        bottom: nodeBlock.position().top + node.height(),
        sectionIndex: node.parents('.section').index(),
        // TODO: KO with after-block like image caption!
        blockIndex: nodeBlock.index()
      });
    });
    */

    //var hasTouch = app.display ? app.display.hasTouch : has('touch');
    //var isMobile = app.display ? app.display.isMobile : UIUtils.isMobileBrowser();
    var $window = $(window),
        windowWidth = $window.width(),
        windowHeight = $window.height(),
        headerHeight = _header.getHeight();

    app.display = {
      browserWidth: windowWidth,
      windowWidth: windowWidth - (app.isInBuilder ? $('.section-builder-panel').width() : 0),
      windowHeight: windowHeight,
      headerHeight: headerHeight,
      sectionHeight: windowHeight - headerHeight,
      storyHeight: $('body').height(),
      scrollTop: app.display ? app.display.scrollTop : 0,
      sections: sections,
      inlineVideos: inlineVideos
      /*,
      hasTouch: hasTouch,
      isMobile: isMobile*/
    };
  }

  /*
  function positionSnapSections()
  {
    $.each(app.data.sections, function(i, section) {
      if (section instanceof Immersive) {
        var sectionDisplay = app.display.sections[i];

        SectionCommon.resizeSnapSection2(i, sectionDisplay.top);
      }
    });
  }
  */

  function displayApp() {

    //
    // Page init
    //

    // By default do not keep scrolling position when reloading the story
    var forceScrollTop = true;

    var urlParams = CommonHelper.getUrlParams();
    if (urlParams.forceScrollTop === 'false') {
      forceScrollTop = false;
    }

    if (forceScrollTop) {
      $(window).on('beforeunload', function() {
        $(window).scrollTop(0);
      });
    }

    //
    // Resize event
    //

    var optimizedResize = CommonHelper.throttle(function() {
      onResize();
    }, 50);

    $(window)
      .resize(optimizedResize)
      .trigger('resize');

    //
    // Scroll event
    //

    // Using RAF in a recursive loop is convenient for builder as this is executed periodically
    //  the builder don't need to manually fire event when text/media/section change
    //  to recompute the display
    // But this can make debugging hard, if turned false. Scroll will only be fired on real scroll
    var useRequestAnimationFrameLoop = true;
    var doc = $(document);

    if (urlParams.useRafLoop === 'false') {
      useRequestAnimationFrameLoop = false;
    }

    if (useRequestAnimationFrameLoop) {
      window.requestAnimationFrame(function rafloop() {
        // To not pass scroll event to UI components when the modal is open
        // This does not prevent the event, it just make sure the component
        // don't render with invalid scroll values (especially the header)
        var preventScroll = false;
        if ($('body').hasClass('modal-open')) {
          preventScroll = true;
        }

        if (! preventScroll) {
          app.display.scrollTop = doc.scrollTop();
          updateUI();
        }

        window.requestAnimationFrame(rafloop);
      });
    }
    else {
      var working = false;

      var scrollAction = function() {
        var performance = window.performance;
        var t0 = performance.now();

        updateUI();

        console.log('onScroll took', performance.now() - t0);

        working = false;
      };

      $(window).scroll(function() {
        // To not pass scroll event to UI components when the modal is open
        // This does not prevent the event, it just make sure the component
        // don't render with invalid scroll values (especially the header)
        if (app.isInBuilder && $('body').hasClass('modal-open')) {
          return;
        }

        app.display.scrollTop = doc.scrollTop();

        if (! working) {
          window.requestAnimationFrame(scrollAction);
          working = true;
        }
      });
    }

    //
    // Prevent scroll when a modal is open
    //

    // When a modal opens, set the body to fixed position with proper scrolling
    // This seems to be the only effective way to allow scroll in modal but avoid
    //   the scroll to affect the whole page
    // Other ideas:
    //  - set body to overflow: hidden and add a replacement for the scrollbar
    //  - can't seem to preventDefault from jQuery handler but can be done from
    //    browser event as shown above but target does not reflect is event is
    //    bubbling, is there a way to know?
    $('.modal').on('show.bs.modal', function() {
      //_modalOpen = true;

      _modalOpenScrollPosition = app.display.scrollTop;

      $('body').css({
        position: 'fixed',
        top: - app.display.scrollTop
      });

      $('.sections').css({
        position: 'fixed'
      });
    });

    $('.modal').on('hide.bs.modal', function() {
      //_modalOpen = false;

      $('body').css({
        position: '',
        top: ''
      });

      $('.sections').css({
        position: ''
      });

      $('html,body').scrollTop(_modalOpenScrollPosition);
    });

    //
    // Story builder button
    //

    if (_core.hasSwitchBuilderButton()) {
      app.ui.header.showEditButton();
    }

    /*
    function autoSizeText() {
      var el,
          elements,
          _i,
          _len,
          _results = [];

      elements = $('.fg-title');

      if (elements.length < 0) {
        return;
      }

      for (_i = 0, _len = elements.length; _i < _len; _i++) {
        el = elements[_i];
        _results.push((function(el) {
          var resizeText, _results1;
          resizeText = function() {
            var elNewFontSize = (parseInt($(el).css('font-size').slice(0, -2)) - 1) + 'px';
            return $(el).css('font-size', elNewFontSize);
          };

          _results1 = [];
          while (el.scrollHeight > el.offsetHeight) {
            _results1.push(resizeText());
          }
          return _results1;
        })(el));
      }
      return _results;
    }

    autoSizeText();
    */

    //$('.cover-title').fitText();
    //$('.cover-subtitle').fitText();
    //$('.section-layout-title .fg-title').fitText();

    //
    // Autoplay
    //

    // Autoplay in viewer mode
    if (! app.isInBuilder && CommonHelper.getUrlParams().autoplay !== undefined && CommonHelper.getUrlParams().autoplay !== 'false') {
      app.ui.autoplay = new Autoplay();

      // Start when app is ready
      topic.subscribe('tpl-ready', function() {
        if (! $('body').hasClass('mobile-view')) {
          $('.section-layout-cover .scroll-invite').hide();
          app.ui.header.disableShareButtonAutoplay();
          
          app.ui.autoplay.start();
        }
      });
    }

    //
    // Display the app
    //

    updateUI();
    topic.publish('tpl-ready');
    hideLoadingOverlay();
  }

  function onResize() {
    // This does not dictate much as the switch between mobile view
    //   is only done when story is initializing
    var isSmall = app.display.browserWidth < 768;

    computeDisplayInfos();

    _header.resize();

    app.Controller.onResize({
      windowWidth: app.display.windowWidth,
      windowHeight: app.display.windowHeight,
      sectionHeight: app.display.sectionHeight
    });

    // Disable builder on small screens
    if (app.isInBuilder) {
      $('body').toggleClass('error modal-open', isSmall);
      $('#loadingOverlay').toggleClass('error', isSmall);
      $('#fatalError').toggle(isSmall);
      $('.progressjs-container').toggle(! isSmall);
    }

    // Stop autoplay in mobile view
    if (app.ui.autoplay && isSmall) {
      app.ui.autoplay.stop();
    }
  }

  function isStoryBlank() {
    return app.Controller.isStoryBlank();
  }

  function appInitComplete() {
    if (! app.data.appItem || ! app.data.appItem.data) {
      return;
    }

    var itemData = app.data.appItem.data.values;

    initStory(
      itemData.config,
      itemData.settings,
      itemData.sections
    );
  }

  //
  // Loading Overlay
  //

  function hideLoadingOverlay() {
    $('#loadingIndicator').css('margin-left', '-25px');

    setTimeout(function() {
      $('#loadingIndicator, #loadingMessage').addClass('fadeOut').fadeOut(300);
      $('#loadingOverlay').fadeOut(600);
    }, 0); // TODO may need extra wait for Cover video to load
  }

  /*
   * TODO prototype - load static config from JSON file
   */
  function getConfig(configName) {
    if (! configName) {
      alert('No configuration specified in index.html > configOptions.story');
    }

    $.ajax({
      type: 'GET',
      url: 'stories/' + configName + '.json',
      dataType: 'json'
    }).then(
      function(data) {
        if (data && data.config && data.sections && data.sections.length) {
          initStory(data.config, data.settings, data.sections);
        }
        else {
          alert('The specified configuration couldn\'t be loaded because of a JSON syntax error.');
        }
      },
      function() {
        alert('The specified configuration hasn\'t been found or couldn\'t be loaded because of a JSON syntax error.');
      }
    );
  }

  return {
    init: init,
    isStoryBlank: isStoryBlank,
    getConfig: getConfig,
    appInitComplete: appInitComplete,
    updateUI: updateUI
  };
});


define('lib-build/css!storymaps/common/builder/Builder',[],function(){});

define('lib-build/hbars!storymaps-react/tpl/builder/panel/BuilderPanel', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing;
  return "<div class=\"builder-buttons\">\r\n  <img src=\"resources/tpl/builder/icons/builder.jpg\" />\r\n\r\n  <button class=\"btn btn-settings\">\r\n    <i class=\"fa fa-cogs\" aria-hidden=\"true\"></i>\r\n    <span class=\"btn-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.commonStrings : depth0)) != null ? stack1.buttonSettings : stack1), depth0))
    + "</span>\r\n  </button>\r\n  <div class=\"beta-feedback\">\r\n    <a href=\"http://links.esri.com/storymaps/cascade-beta-feedback\" target=\"_blank\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.betaFeedback : stack1), depth0))
    + "</a>\r\n    <i class=\"beta-tooltip fa fa-info-circle\" aria-hidden=\"true\"></i>\r\n  </div>\r\n\r\n  <button class=\"btn btn-share\">\r\n    <i class=\"fa fa-share\" aria-hidden=\"true\"></i>\r\n    <span class=\"btn-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.commonStrings : depth0)) != null ? stack1.buttonShare : stack1), depth0))
    + "</span>\r\n\r\n    <div class=\"btn-share-container\">\r\n      <div class=\"btn-share-outer-tooltip\" data-level=\"private\">\r\n        <div class=\"btn-share-wrapper\" data-level=\"private\" data-title=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.sharingLevelStrings : depth0)) != null ? stack1.btnPrivate : stack1), depth0))
    + "\">\r\n    			<span class=\"small-loader\"></span>\r\n    			<i class=\"share-icon fa fa-user\" aria-hidden=\"true\"></i>\r\n    		</div>\r\n      </div>\r\n      <div class=\"btn-share-outer-tooltip tooltip-enabled\" data-level=\"account\" data-title=\""
    + escapeExpression(((helper = (helper = helpers.organizationWarning || (depth0 != null ? depth0.organizationWarning : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"organizationWarning","hash":{},"data":data}) : helper)))
    + "\">\r\n        <div class=\"btn-share-wrapper\" data-level=\"account\" data-title=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.sharingLevelStrings : depth0)) != null ? stack1.btnOrg : stack1), depth0))
    + "\">\r\n    			<span class=\"small-loader\"></span>\r\n    			<i class=\"share-icon fa fa-users\" aria-hidden=\"true\"></i>\r\n    		</div>\r\n      </div>\r\n      <div class=\"btn-share-outer-tooltip tooltip-enabled\" data-level=\"public\" data-title=\""
    + escapeExpression(((helper = (helper = helpers.publicWarning || (depth0 != null ? depth0.publicWarning : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"publicWarning","hash":{},"data":data}) : helper)))
    + "\">\r\n        <div class=\"btn-share-wrapper\" data-level=\"public\" data-title=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.sharingLevelStrings : depth0)) != null ? stack1.btnPublic : stack1), depth0))
    + "\">\r\n    			<span class=\"small-loader\"></span>\r\n    			<i class=\"share-icon fa fa-globe\" aria-hidden=\"true\"></i>\r\n    		</div>\r\n      </div>\r\n    </div>\r\n  </button>\r\n\r\n  <button class=\"btn btn-preview\">\r\n    <i class=\"fa fa-eye\" aria-hidden=\"true\"></i>\r\n    <span class=\"btn-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.commonStrings : depth0)) != null ? stack1.buttonPreview : stack1), depth0))
    + "</span>\r\n  </button>\r\n\r\n  <button class=\"btn btn-check\">\r\n    <i class=\"fa fa-heartbeat\" aria-hidden=\"true\"></i>\r\n    <span class=\"btn-label\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.commonStrings : depth0)) != null ? stack1.buttonCheck : stack1), depth0))
    + "</span>\r\n    <i class=\"check-tooltip fa fa-info-circle\" aria-hidden=\"true\" style=\"font-size: 14px;\"></i>\r\n  </button>\r\n\r\n  <button id=\"save-button\" class=\"btn btn-save\" data-toggle=\"tooltip\" data-placement=\"top\" data-title=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.saveError : stack1), depth0))
    + "\">\r\n    <i class=\"btn-save-icon fa fa-floppy-o\" aria-hidden=\"true\"></i>\r\n    <span class=\"btn-save-loader small-loader\"></span>\r\n    <span class=\"btn-save-success glyphicon glyphicon-ok\"></span>\r\n    <span class=\"btn-save-error glyphicon glyphicon-exclamation-sign\"></span>\r\n    <span class=\"btn-save-label\">"
    + escapeExpression(((helper = (helper = helpers.btnSave || (depth0 != null ? depth0.btnSave : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"btnSave","hash":{},"data":data}) : helper)))
    + "</span>\r\n  </button>\r\n</div>\r\n\r\n<div class=\"overview\"></div>\r\n";
},"useData":true}); });

define('storymaps-react/common/_resources/nls/core',{
	root: ({
		commonCore: {
			builderPanel: {
				panelHeader: "{TPL_NAME} Builder",
				buttonSaving: "Saving",
				buttonSaved: "Saved",
				buttonError: "Save failed",
				buttonShare: "Share",
				buttonSettings: "Settings",
				buttonHelp: "Help",
				buttonPreview: "View story",
				buttonCheck: "Check story",
				tooltipFirstSave: "This isn't available until you save.",
				tooltipNotShared: "This isn't available until you share.",
				tooltipNotShared2: "Your story isn't shared, only you can access it.",
				noPendingChange: "No pending change",
				unSavedChangePlural: "Pending changes",
				closeWithPendingChange: "Are you sure to want to confirm this action? Your changes will be lost.",
				saveError: "Save failed, please try again",
				status1: "Story is shared but it has issues",
				status2: "Story isn't shared but it has issues",
				status3: "Story is public",
				status4: "Story is shared within your organization",
				status5: "Story is private",
				status6: "Story isn't saved yet",
				checking: "Checking",
				fix: "Fix"
			},
			saveError: {
				title: "Error saving the story",
				err1Div1: "The story can't be saved because you already have another item with the same name.",
				err1Div2: "Please modify the title of your story and then save it.",
				btnOk: "Edit the story title"
			},
			saveErrorSocial: {
				title: "Social media sharing",
				panel1: "Your storys may not appear properly on social media as your ArcGIS web application item title is not the same as your story title.",
				panel1tooltip: "By defining a title, summary and thumbnail image, your story will look like this:",
				panel2:	"Which title would you like to use on social media:",
				panel2q1: "Story title (recommended)",
				panel2q1tooltip: "By choosing this option, your item title will be modified to match your story title and further changes in the builder will be synchronized.",
				panel2q2: "Item title",
				panel3: "To further improve how your story looks on social media use ${MYSTORIES} to add a summary and a thumbnail image.",
				panel4: "Do not warn me again for this story",
				save: "Save",
				mystories: "My Stories"
			},
			share: {
				shareTitle: "Share your story",
				preview: "Preview",
				viewlive: "View story",
				btnPrivate: "Private",
				btnPrivateTooltip: "Only you can see the story",
				btnOrg: "Organization",
				btnOrgTooltip: "Only members of your organization can see the story",
				btnPublic: "Public",
				btnPublicTooltip: "Everyone can see the story",
				loadingMessage: "Checking your story for issues",
				viewToggle1: "Show story content",
				viewToggle2: "Close story content",
				socialize: "Socialize",
				statusPrivate: "Your story is private, only you can see it.",
				statusError: "There are issues in your story content that will be noticeable to your readers. You can identify and fix these issues below.",
				statusNoErrPrivate: "Share your story once you are ready!",
				mystoriesinvite: "Manage all your stories",
				notavailable1: "Sorry, sharing your story from the Builder is not supported since this application is not hosted in %PRODUCT%.",
				notavailable2: "Sorry, sharing your story from the Builder is not supported on this version of Portal for ArcGIS (requires 10.4 or later).",
				notavailable3: "You can share this story from %LINK%.",
				notavailable4: "My Stories",
				notavailable5: "its item page",
				notavailable6: "Sorry, this feature is not fully supported in development mode. Depending on your deployment scenario, this feature may be supported when deployed.",
				notavailable7: "Make sure to visit %MYCONTENT% to confirm the maps and layers used in your story are also shared.",
				notavailable8: "My Content",
				mystoriesinvite2: "To improve how your story looks on social networks use ${MYSTORIES} to add a summary and a thumbnail image."
			},
			settings: {
				header: "Settings",
				tabError: "Please check all tabs for errors"
			},
			settingsHeader: {
				title: "Header",
				logoEsri: "Esri logo",
				logoNone: "No logo",
				logoCustom: "Custom logo",
				logoCustomPlaceholder: "URL (max 250x50 pixels)",
				logoCustomTargetPlaceholder: "Click-through link",
				logoSocialExplain: "Customize the header link.",
				logoSocialText: "Text",
				logoSocialLink: "Link",
				lblSmallHeader: "Use compact header (no subtitle)"
			}
		}
	}),
	"ar": 1,
	"cs": 1,
	"da": 1,
	"de": 1,
	"el": 1,
	"es": 1,
	"et": 1,
	"fi": 1,
	"fr": 1,
	"he": 1,
	"hr": 1,
	"it": 1,
	"ja": 1,
	"ko": 1,
	"lt": 1,
	"lv": 1,
	"nl": 1,
	"nb": 1,
	"pl": 1,
	"pt-br": 1,
	"pt-pt": 1,
	"ro": 1,
	"ru": 1,
	"sr": 1,
	"sv": 1,
	"th": 1,
	"tr": 1,
	"vi": 1,
	"zh-cn": 1,
	"zh-hk": 1,
	"zh-tw": 1
});


define('resources/tpl/viewer/nls/app',{
  root: ({
    viewer: {
      common: {
		add: "Add",
		edit: "Edit",
		save: "Save",
		next: "Next",
		cancel: "Cancel",
		back: "Back",
		apply: "Apply",
		close: "Close",
		open: "Open",
		start: "Start",
		loading: "Loading",
		disabledAdmin: "This feature has been disabled by the Administrator",
		width: "Width",
		height: "Height",
		create: "Create",
		yes: "Yes",
		no: "No"
      },
      errors: {
        boxTitle: "An error has occurred",
        invalidConfig: "Invalid configuration",
        invalidConfigNoApp: "Web Mapping Application identifier not specified in index.html.",
        invalidConfigNoAppDev: "No Web Mapping Application identifier is specified in URL parameters (?appid=). In development mode, the appid configuration in index.html is ignored.",
        unspecifiedConfigOwner: "Authorized owner hasn't been configured.",
        invalidConfigOwner: "Story owner is not authorized.",
        invalidConfignoOAuth: "The story require authentication, please configure an ArcGIS OAuth ID in index.html or make the story public.",
        invalidApp: "This story cannot be loaded.",
        appLoadingFail: "Something went wrong, the {TPL_NAME} did not load correctly.",
        notConfiguredDesktop: "The story is not configured yet.",
        notConfiguredMobile: "The {TPL_NAME} builder is not supported at this display size. If possible, resize your browser to access the builder or please build your story on a device with a larger screen.",
        notConfiguredMobile2: "Please rotate your device to landscape orientation to use the {TPL_NAME} builder.",
        notAuthorized: "You are not authorized to access this story",
        notAuthorizedBuilder: "You are not authorized to use {TPL_NAME} builder.",
        noViewerIE: "This story is not supported in Internet Explorer before version %VERSION%. %UPGRADE%",
        upgradeBrowser: "<a href='http://browsehappy.com/' target='_blank'>Please update your browser</a>.",
        mapLoadingFail: "Something went wrong, the map did not load correctly.",
        signOut: "Sign Out"
      },
      signin: {
		title: "Authentication is required",
		explainViewer: "Please sign in with an account on %PORTAL_LINK% to access the story.",
		explainBuilder: "Please sign in with an account on %PORTAL_LINK% to configure the story."
	  },
      headerFromCommon: {
        storymapsText: "A story map",
        builderButton: "Edit",
        facebookTooltip: "Share on Facebook",
		twitterTooltip: "Share on Twitter",
		bitlyTooltip: "Get a short link",
        share: "Share",
        tooltipAutoplayDisabled: "This isn't available in autoplay mode"
      },
      shareFromCommon: {
        copy: "Copy",
        copied: "Copied",
        open: "Open",
        embed: "Embed in web page",
        embedExplain: "Use the following HTML code to embed the story in a web page.",
        size: "Size (width/height):",
        autoplayLabel: "Autoplay mode",
		autoplayExplain1: "Autoplay mode will advance through your story at a regular interval. This is ideal on a kiosk or public display monitor, but be aware that in other situations it may make the story harder to read. This feature isn't supported on small displays.",
		autoplayExplain2: "When this mode is active there are controls to play/pause the story and adjust the navigation speed.",
        linksupdated: "Links updated!"
      }
    }
  }),
	"ar": 1,
	"cs": 1,
	"da": 1,
	"de": 1,
	"el": 1,
	"es": 1,
	"et": 1,
	"fi": 1,
	"fr": 1,
	"he": 1,
	"hr": 1,
	"it": 1,
	"ja": 1,
	"ko": 1,
	"lt": 1,
	"lv": 1,
	"nl": 1,
	"nb": 1,
	"pl": 1,
	"pt-br": 1,
	"pt-pt": 1,
	"ro": 1,
	"ru": 1,
	"sr": 1,
	"sv": 1,
	"th": 1,
	"tr": 1,
	"vi": 1,
	"zh-cn": 1,
	"zh-hk": 1,
	"zh-tw": 1
});



define('lib-build/less!storymaps-react/tpl/builder/panel/BuilderPanel',[],function(){});
define('storymaps-react/tpl/builder/panel/BuilderPanel',['module', 'exports', 'lib-build/hbars!./BuilderPanel', 'lib-build/i18n!./../../../common/_resources/nls/core', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'lib-build/i18n!./../../../../resources/tpl/viewer/nls/app', '../overviewPanel/OverviewPanel', 'storymaps/common/builder/BuilderHelper', 'dojo/topic', 'lib-build/less!./BuilderPanel'], function (module, exports, _BuilderPanel, _core, _app, _app3, _OverviewPanel, _BuilderHelper, _topic) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _BuilderPanel2 = _interopRequireDefault(_BuilderPanel);

  var _core2 = _interopRequireDefault(_core);

  var _app2 = _interopRequireDefault(_app);

  var _app4 = _interopRequireDefault(_app3);

  var _OverviewPanel2 = _interopRequireDefault(_OverviewPanel);

  var _BuilderHelper2 = _interopRequireDefault(_BuilderHelper);

  var _topic2 = _interopRequireDefault(_topic);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var BuilderPanel = function () {
    function BuilderPanel() {
      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

      _classCallCheck(this, BuilderPanel);

      this._node = params.container;
      this._saveApp = params.saveApp;
      this._shareApp = params.shareApp;
      this._saveFailed = false;

      if (!this._node || !this._saveApp || !this._shareApp) {
        console.error('Could not initialize Builder Panel');
        return;
      }

      var publicWarning = _app2.default.builder.builderPanel.publicWarning;
      var organizationWarning = _app2.default.builder.builderPanel.organizationWarning;

      this._node.html((0, _BuilderPanel2.default)({
        btnSave: _app4.default.viewer.common.save,
        commonStrings: _core2.default.commonCore.builderPanel,
        sharingLevelStrings: _core2.default.commonCore.share,
        strings: _app2.default.builder.builderPanel,
        publicWarning: publicWarning,
        organizationWarning: organizationWarning
      }));

      this._overviewPanel = null;

      // Initialize the inner share button tooltip before the outer. Then manually show and hide the outer tooltip when the inner one shows and hides.
      // That way both show at first
      this._node.find('.btn-share-container .btn-share-wrapper').tooltip({
        container: '.section-builder-panel',
        placement: 'top'
      });

      this._node.find('.btn-share-container .btn-share-wrapper').on('inserted.bs.tooltip', function () {
        // this class is so we don't have the min-width of 200px for these buttons...
        $(this).data('bs.tooltip').$tip.addClass('share-tooltip');
      });

      this._node.find('.btn-share-container .btn-share-wrapper').on('show.bs.tooltip', function () {
        $(this).closest('.btn-share-outer-tooltip.tooltip-enabled').tooltip('show');
      });

      this._node.find('.btn-share-container .btn-share-wrapper').on('hide.bs.tooltip', function () {
        $(this).closest('.btn-share-outer-tooltip.tooltip-enabled').tooltip('hide');
      });

      this._node.find('.btn-share-outer-tooltip.tooltip-enabled').tooltip({
        placement: 'bottom',
        container: '.section-builder-panel',
        trigger: 'manual'
      });

      this._node.find('.btn-share-outer-tooltip.tooltip-enabled').on('inserted.bs.tooltip', function () {
        // this class is so we don't have the min-width of 200px for these buttons...
        $(this).data('bs.tooltip').$tip.addClass('custom-warning tooltip-bright');
      });

      this._initEvents();
    }

    _createClass(BuilderPanel, [{
      key: '_initEvents',
      value: function _initEvents() {
        _topic2.default.subscribe('tpl-ready', this._onStoryReady.bind(this));
        _topic2.default.subscribe('builder-section-update', this._updateOverview.bind(this));
        _topic2.default.subscribe('story-navigated-section', this._onSectionNavigate.bind(this));
        _topic2.default.subscribe('builder-story-title-update', this._updateStoryTitle.bind(this));
        _topic2.default.subscribe('builder-story-update', this._updateSaveButtonStatus.bind(this));

        this._node.find('.btn-settings').click(this._onSettings.bind(this));
        this._node.find('.btn-preview').click(this._onPreview.bind(this));
        this._node.find('.btn-check').click(this._onCheck.bind(this));
        this._node.find('.btn-save').click(this._onSave.bind(this));

        var appName = 'Story Map Cascade';
        var betaNoteString = _app2.default.builder.builderPanel.betaNote.replace(/\${APP_NAME}/g, appName);

        this._node.find('.beta-tooltip').tooltip({
          title: betaNoteString,
          placement: 'bottom',
          container: '.section-builder-panel'
        });

        this._node.find('.check-tooltip').tooltip({
          title: 'Click here to visit My Stories on the Story Maps website to diagnose and fix issues such as broken links or sharing errors.' + '<br /><br />' + 'Once My Stories opens in a new tab, you can find your story and click it to check for errors.',
          placement: 'top',
          container: '.section-builder-panel',
          html: true
        });
      }
    }, {
      key: '_onStoryReady',
      value: function _onStoryReady() {
        this._initShareButtons();
        this._updateShareButtons();
        this._updatePreviewButton();
        this._updateCheckButton();
        this._updateOverview();
      }
    }, {
      key: '_updateStoryTitle',
      value: function _updateStoryTitle() {
        var buttons = this._node.find('.builder-buttons .btn'),
            buttonsExceptSave = this._node.find('.builder-buttons .btn:not(.btn-save)'),
            storyTitle = app.Controller.getStoryTitle();

        buttons.toggleClass('disabled', !storyTitle);

        if (!storyTitle) {
          buttons.tooltip({
            title: _app2.default.builder.builderPanel.addTitleNote,
            placement: 'right',
            container: '.section-builder-panel'
          });
        } else {
          // if we're in a "save failed" mode, we don't want to blow away the tooltip that says that on the save button... otherwise we blow away its tooltip
          if (this._saveFailed) {
            buttonsExceptSave.tooltip('destroy');
          } else {
            buttons.tooltip('destroy');
          }
        }

        this._updateShareButtons();
        this._updatePreviewButton();
        this._updateCheckButton();
      }
    }, {
      key: '_onSettings',
      value: function _onSettings(e) {
        if ($(e.currentTarget).hasClass('disabled')) {
          return;
        }

        app.Controller.openSettings();
      }
    }, {
      key: '_initShareButtons',
      value: function _initShareButtons() {
        //
        // Find which share buttons to active
        //
        var isOrg = app.portal.isOrganization !== false,
            privileges = app.portal.getPortalUser().privileges || [],
            sharingLevel = app.data.appItem.item.access,
            itemControl = app.data.appItem.item.itemControl,
            enableOrg = isOrg && privileges.indexOf('portal:user:shareToOrg') > -1,
            enablePub = !isOrg || privileges.indexOf('portal:user:shareToPublic') > -1,
            storyIsPrivate = sharingLevel == 'private' || sharingLevel == 'shared',
            storyIsOrg = sharingLevel == 'account',
            userIsOwner = app.data.appItem.item.owner == app.portal.getPortalUser().username;

        // TODO: to review with 4.2
        // Group with shared ownership and custom role with admin:update
        if (itemControl == 'update') {
          enableOrg = false;
          enablePub = false;
        }
        // TODO checking if the privilege is here directly would be enough if builder was not opening if user don't have proper update priv (only admin view all)
        else if (itemControl == 'admin' && !userIsOwner) {
            enableOrg = privileges.indexOf('portal:admin:shareToOrg') > -1;
            enablePub = privileges.indexOf('portal:admin:shareToPublic') > -1;
          }

        // TODO: in some case the button may need to be disabled
        if (storyIsOrg) {
          enableOrg = true;
        } else if (!storyIsPrivate) {
          enablePub = true;
        }

        // TODO: tooltip when org has disabled sharing
        this._node.find('.btn-share-outer-tooltip[data-level="account"]').toggle(enableOrg);
        this._node.find('.btn-share-outer-tooltip[data-level="public"]').toggle(enablePub);

        this._node.find('.btn-share-wrapper').click(this._onChangeSharing.bind(this));
      }
    }, {
      key: '_onChangeSharing',
      value: function _onChangeSharing(e) {
        var sharingBtn = $(e.currentTarget);

        this._node.find('.btn-share-this._node').addClass('disabled');
        this._node.find('.btn-share-wrapper').removeClass('active');

        sharingBtn.addClass('sharing');

        this._shareApp({
          sharingLevel: sharingBtn.data('level')
        }).then(function () {
          this._updateShareButtons();
          this._updatePreviewButton();

          // Update status of Share dialog > sharing buttons
          app.Controller.renderHeader();
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: '_updateShareButtons',
      value: function _updateShareButtons() {
        var sharingLevel = 'private',
            isCreated = !!app.data.appItem.item.id,
            shareBtn = this._node.find('.btn-share');

        shareBtn.toggleClass('disabled', !isCreated);

        this._node.find('.btn-share-wrapper').removeClass('sharing');

        if (app.data.appItem.item && app.data.appItem.item.access && app.Controller.getStoryTitle()) {
          sharingLevel = app.data.appItem.item.access;

          this._node.find('.btn-share-container').removeClass('disabled');
          this._node.find('.btn-share-wrapper[data-level=' + sharingLevel + ']').addClass('active');
        } else {
          this._node.find('.btn-share-container').addClass('disabled');
        }
      }
    }, {
      key: '_updatePreviewButton',
      value: function _updatePreviewButton() {
        var sharingLevel = app.data.appItem.item.access,
            isCreated = !!app.data.appItem.item.id,
            isShared = sharingLevel == 'account' || sharingLevel == 'public',
            previewBtn = this._node.find('.btn-preview');

        previewBtn.toggleClass('disabled', !isCreated);

        if (isCreated && !isShared) {
          previewBtn.tooltip({
            title: _app2.default.builder.builderPanel.notSharedNote,
            placement: 'right',
            container: '.section-builder-panel'
          });
        } else {
          previewBtn.tooltip('destroy');
        }
      }
    }, {
      key: '_onPreview',
      value: function _onPreview(e) {
        if ($(e.currentTarget).hasClass('disabled')) {
          return;
        }

        window.open(app.Controller.getStoryURL() + '&preview', '_blank');
      }
    }, {
      key: '_updateCheckButton',
      value: function _updateCheckButton() {
        var isCreated = !!app.data.appItem.item.id,
            checkBtn = this._node.find('.btn-check');

        checkBtn.toggleClass('disabled', !isCreated);
      }
    }, {
      key: '_onCheck',
      value: function _onCheck(e) {
        if ($(e.currentTarget).hasClass('disabled')) {
          return;
        }

        window.open(_BuilderHelper2.default.getMyStoriesURL(), '_blank');
      }
    }, {
      key: '_updateSaveButtonStatus',
      value: function _updateSaveButtonStatus() {
        var saveBtn = this._node.find('.btn-save'),
            title = app.Controller.getStoryTitle();

        saveBtn.toggleClass('btn-bright', !!(title && app.builder.pendingChanges));
      }
    }, {
      key: '_onSave',
      value: function _onSave(e) {
        var btn = $(e.currentTarget);

        if (btn.hasClass('disabled')) {
          return;
        }

        btn.removeClass('saved').addClass('saving disabled');

        btn.find('.btn-save-label').html(_core2.default.commonCore.builderPanel.buttonSaving);

        this._saveApp();
      }
    }, {
      key: 'saveSucceeded',
      value: function saveSucceeded() {
        var _this = this;

        this._saveFailed = false;

        this._node.find('.btn-save').removeClass('saving disabled').addClass('saved');
        this._node.find('.btn-save-label').html(_core2.default.commonCore.builderPanel.buttonSaved);

        this._node.find('.btn-save[data-toggle="tooltip"]').tooltip('destroy');

        setTimeout(function () {
          _this._node.find('.btn-save').removeClass('saved').find('.btn-save-label').html(_app4.default.viewer.common.save);
        }, 3500);

        this._updateSaveButtonStatus();
        this._updateShareButtons();
        this._updatePreviewButton();
        this._updateCheckButton();
      }
    }, {
      key: 'saveFailed',
      value: function saveFailed() {
        var _this2 = this;

        this._saveFailed = true;

        this._node.find('.btn-save').removeClass('saving').addClass('error');
        this._node.find('.btn-save-label').html(_core2.default.commonCore.builderPanel.buttonError);

        this._node.find('.btn-save[data-toggle="tooltip"]').tooltip({
          trigger: 'manual',
          placement: 'right',
          container: '.builder-buttons'
        });

        this._node.find('.btn-save[data-toggle="tooltip"]').on('inserted.bs.tooltip', function () {
          // selectively style only this tooltip by giving it a class
          $(this).data('bs.tooltip').$tip.addClass('tooltip-danger');
        });
        this._node.find('.btn-save[data-toggle="tooltip"]').tooltip('show');

        setTimeout(function () {
          _this2._node.find('.btn-save').removeClass('error disabled').find('.btn-save-label').html(_app4.default.viewer.common.save);
        }, 3500);
      }
    }, {
      key: '_updateOverview',
      value: function _updateOverview() {
        var storyOverview = app.Controller.getStoryOverview();

        if (!this._overviewPanel) {
          this._initOverviewPanel(storyOverview);
        } else {
          this._overviewPanel.updateItems(storyOverview);
        }
      }
    }, {
      key: '_onSectionNavigate',
      value: function _onSectionNavigate(data) {
        if (this._overviewPanel) {
          this._overviewPanel.navigateTo(app.Controller.getSectionIndexById(data.index));
        }
      }
    }, {
      key: '_initOverviewPanel',
      value: function _initOverviewPanel(storyOverview) {
        this._overviewPanel = new _OverviewPanel2.default(this._node.find('.overview')[0], 'vertical', storyOverview, {
          selectItem: function selectItem(sectionId) {
            var sectionIndex = app.Controller.getSectionById(sectionId);
            console.log('selectItem:', sectionIndex);
            app.Controller.navigateToSection({
              index: sectionIndex,
              animate: false
            });
          },

          duplicateItem: function duplicateItem(sectionId) {
            var sectionIndex = app.Controller.getSectionById(sectionId);
            console.log('duplicateItem:', sectionIndex);

            app.Controller.duplicateSection({
              index: sectionIndex
            });
          },
          toggleHidden: function toggleHidden(sectionId) {
            var sectionIndex = app.Controller.getSectionById(sectionId);
            console.log('toggleHidden:', sectionIndex);
            console.log('TODO NOT IMPLEMENTED');
          },
          deleteItem: function deleteItem(sectionId) {
            var sectionIndex = app.Controller.getSectionById(sectionId);
            console.log('deleteItem:', sectionIndex);
            app.Controller.deleteSection({
              index: sectionIndex
            });
          },

          organize: function organize(sectionsIds) {
            var sectionsIndexes = app.Controller.getSectionsIndexesByIds(sectionsIds);
            console.log('organize:', sectionsIds, sectionsIndexes);

            app.Controller.organizeSections(sectionsIndexes);
          }
        });
      }
    }]);

    return BuilderPanel;
  }();

  exports.default = BuilderPanel;
  module.exports = exports['default'];
});
//# sourceMappingURL=BuilderPanel.js.map
;

define('lib-build/hbars!storymaps/common/builder/SaveErrorPopupSocial', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, functionType="function", helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, buffer = "<div class=\"modal-dialog\">\r\n	<div class=\"modal-content\">\r\n		<div class=\"modal-logo\"></div>\r\n		<div class=\"modal-header\">\r\n			<h4 class=\"modal-title\">"
    + escapeExpression(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"title","hash":{},"data":data}) : helper)))
    + "</h4>\r\n		</div>\r\n\r\n		<div class=\"modal-body\">\r\n			<div class=\"panel1\">\r\n				";
  stack1 = ((helper = (helper = helpers.panel1 || (depth0 != null ? depth0.panel1 : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel1","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  buffer += "\r\n				<a href=\"#\" class=\"help\" data-toggle=\"tooltip\">\r\n					<i class=\"fa fa-question-circle\" aria-hidden=\"true\"></i>\r\n				</a>\r\n			</div>\r\n			<div class=\"panel2\">\r\n				<div class=\"panel2lbl\">"
    + escapeExpression(((helper = (helper = helpers.panel2 || (depth0 != null ? depth0.panel2 : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel2","hash":{},"data":data}) : helper)))
    + "</div>\r\n				<div class=\"form-group\">\r\n					<div class=\"radio\">\r\n						<label>\r\n							<input type=\"radio\" name=\"optErrorSocial\" value=\"story\" checked>\r\n							<span>\r\n								"
    + escapeExpression(((helper = (helper = helpers.panel2q1 || (depth0 != null ? depth0.panel2q1 : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel2q1","hash":{},"data":data}) : helper)))
    + "\r\n								<a href=\"#\" class=\"help\" data-toggle=\"tooltip\" title=\""
    + escapeExpression(((helper = (helper = helpers.panel2q1tooltip || (depth0 != null ? depth0.panel2q1tooltip : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel2q1tooltip","hash":{},"data":data}) : helper)))
    + "\">\r\n									<i class=\"fa fa-question-circle\" aria-hidden=\"true\"></i>\r\n								</a>\r\n							</span>\r\n						</label>\r\n					</div>\r\n					<div class=\"radio\">\r\n						<label>\r\n							<input type=\"radio\" name=\"optErrorSocial\" value=\"item\">\r\n							<span>";
  stack1 = ((helper = (helper = helpers.panel2q2 || (depth0 != null ? depth0.panel2q2 : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel2q2","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  buffer += "</span>\r\n						</label>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<div class=\"panel3\">";
  stack1 = ((helper = (helper = helpers.panel3 || (depth0 != null ? depth0.panel3 : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel3","hash":{},"data":data}) : helper));
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</div>\r\n		</div>\r\n\r\n		<div class=\"modal-footer\">\r\n			<div class=\"stop-asking\">\r\n				<div class=\"checkbox\">\r\n					<label class=\"disabled\">\r\n						<input type=\"checkbox\" value=\"\" disabled>\r\n						"
    + escapeExpression(((helper = (helper = helpers.panel4 || (depth0 != null ? depth0.panel4 : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"panel4","hash":{},"data":data}) : helper)))
    + "\r\n					</label>\r\n				</div>\r\n			</div>\r\n			<button type=\"button\" class=\"btn btn-primary\">"
    + escapeExpression(((helper = (helper = helpers.btnSave || (depth0 != null ? depth0.btnSave : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"btnSave","hash":{},"data":data}) : helper)))
    + "</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/css!storymaps/common/builder/SaveErrorPopupSocial',[],function(){});
define('storymaps/common/builder/SaveErrorPopupSocial',[
  'lib-build/hbars!./SaveErrorPopupSocial',
  'lib-build/css!./SaveErrorPopupSocial',
  '../utils/CommonHelper',
  'dojo/Deferred',
  'dojo/i18n!commonResources/nls/core.js?v=' + app.version
],
function(
  viewTpl,
  viewCss,
  CommonHelper,
  Deferred,
  i18n
) {
  return function SaveErrorPopupSocial(container) {
    var _resultDeferred = null;

    container.append(viewTpl({
      title: i18n.commonCore.saveErrorSocial.title,
      panel1: i18n.commonCore.saveErrorSocial.panel1,
      panel2: i18n.commonCore.saveErrorSocial.panel2,
      panel2q1: i18n.commonCore.saveErrorSocial.panel2q1,
      panel2q1tooltip: i18n.commonCore.saveErrorSocial.panel2q1tooltip,
      panel2q2: i18n.commonCore.saveErrorSocial.panel2q2,
      panel3: i18n.commonCore.saveErrorSocial.panel3
        .replace('${MYSTORIES}', '<a href="' + CommonHelper.getMyStoriesURL() + '" target="_blank">' + i18n.commonCore.saveErrorSocial.mystories + '</a>'),
      panel4: i18n.commonCore.saveErrorSocial.panel4,
      btnSave: i18n.commonCore.saveErrorSocial.save
    }));

    initEvents();

    this.present = function() {
      _resultDeferred = new Deferred();

      container.find('.panel1 .help').tooltip({
        title: i18n.commonCore.saveErrorSocial.panel1tooltip + '<img src="resources/tpl/builder/icons/share/builder-help-social.png"/>',
        html: true,
        placement: 'right'
      });

      container.find('.panel2 .help').tooltip();

      container.modal({
        keyboard: false
      });

      return _resultDeferred;
    };

    function initEvents() {
      container.find('input[name="optErrorSocial"]').change(function() {
        var value = container.find('input[name="optErrorSocial"]:checked').val();
        if (value == 'story') {
          container.find('.stop-asking input')
            .attr('disabled', 'disabled')
            .prop('checked', false);

          container.find('.stop-asking label').addClass('disabled');
        }
        else {
          container.find('.stop-asking input').removeAttr('disabled');
          container.find('.stop-asking label').removeClass('disabled');
        }
      });

      container.find('.btn-primary').click(function() {
        if (container.find('.stop-asking input').is(':checked')) {
          app.data.appItem.data.values.config.doNotWarnTitle = true;
        }

        _resultDeferred.resolve({
          choice: container.find('input[name="optErrorSocial"]:checked').val()
        });
        container.modal('hide');
      });
    }
  };
});

/*
| Copyright 2016 Esri
|
| Licensed under the Apache License, Version 2.0 (the "License");
| you may not use this file except in compliance with the License.
| You may obtain a copy of the License at
|
|    http://www.apache.org/licenses/LICENSE-2.0
|
| Unless required by applicable law or agreed to in writing, software
| distributed under the License is distributed on an "AS IS" BASIS,
| WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
| See the License for the specific language governing permissions and
| limitations under the License.
*/

define('storymaps/common/builder/Builder',[
  'lib-build/css!./Builder',
  'esri/arcgis/Portal',
  'storymaps-react/tpl/builder/panel/BuilderPanel',
  './SaveErrorPopupSocial',
  //'./settings/SettingsPopup',
  './BuilderHelper',
  //'./MyStoriesWrapper',
  '../utils/CommonHelper',
  //'../utils/WebMapHelper',
  'esri/IdentityManager',
  'dojo/Deferred',
  'dojo/_base/lang'
  //'lib-app/history.min'
], function(
  viewCss,
  esriPortal,
  BuilderPanel,
  SaveErrorPopupSocial,
  //SettingsPopup,
  BuilderHelper,
  //MyStoriesWrapper,
  CommonHelper,
  //WebMapHelper,
  IdentityManager,
  Deferred,
  lang
) {
  var _core = null,
      _builderView = null,
      _builderPanel = null, // eslint-disable-line no-unused-vars
      _settingsPopup = null,
      _saveErrorPopupSocial = null;

  this.isDirectCreation = false;
  this.isGalleryCreation = false;
  this.isDirectCreationFirstSave = false;

  function init(core, builderView) {
    _core = core;
    _builderView = builderView;
    //_settingsPopup = new SettingsPopup($('#settingsPopup'));

    console.log('common.builder.Builder - init');

    var urlParams = CommonHelper.getUrlParams();

    app.builder.isDirectCreation = urlParams.fromScratch != null || urlParams.fromscratch != null;
    app.builder.isGalleryCreation = urlParams.fromGallery != null;
    app.builder.isDirectCreationFirstSave = app.builder.isDirectCreation;

    // TODO
    if (false && ! CommonHelper.getAppID(_core.isProd()) && ! app.builder.isDirectCreation) { // eslint-disable-line
      console.error('common.builder.Builder - abort builder initialization, no appid supplied');
      return;
    }
    else if (app.builder.isDirectCreation) {
      console.log('common.builder.Builder - Builder start in direct creation mode');
    }
    else if (app.builder.isGalleryCreation) {
      console.log('common.builder.Builder - Builder start in gallery creation mode');
    }

    $('body').addClass('builder-mode');

    // Add the default StoryMaps theme
    //app.cfg.COLOR_SCHEMES.splice(0, 0, app.cfg.COLORS);

    _builderView.init(_settingsPopup);
    //_builderPanel.init(_builderView);

    _builderPanel = new BuilderPanel({
      container: $('.section-builder-panel'),
      saveApp: _builderView.saveApp,
      openSettings: function() { },
      shareApp: shareApp
    });

    app.builder.builderPanel = _builderPanel;

    _saveErrorPopupSocial = new SaveErrorPopupSocial($('#saveErrorPopupSocial'));

    // TODO
    //_settingsPopup.init(_builderView);
    //_settingsPopup.initLocalization();

    //topic.subscribe('BUILDER_INCREMENT_COUNTER', _builderPanel.incrementSaveCounter);

    // My Stories
    //topic.subscribe('BUILDER-MY-STORIES-CHECK', MyStoriesWrapper.scanStory);

    // Reload / close confirmation if there is unsaved change
    window.onbeforeunload = function(e) {
      e = e || window.event;

      if (! app.isInBuilder || ! app.builder.pendingChanges) {
        return;
      }

      if (e) {
        e.returnValue = i18n.commonCore.builderPanel.closeWithPendingChange;
      }

      return i18n.commonCore.builderPanel.closeWithPendingChange;
    };

    app.builder.cleanApp = BuilderHelper.cleanApp;
  }

  function appInitComplete() {
    var storyTitle = '',
        itemTitle = '';

    if (app.data.title) {
      storyTitle = app.data.title.trim();
    }

    if (app.data.appItem && app.data.appItem.item && app.data.appItem.item.title) {
      itemTitle = app.data.appItem.item.title.trim();
    }

    app.builder.titleMatchOnLoad = itemTitle == storyTitle;

    if (app.builder.isDirectCreation || app.builder.isGalleryCreation) {
      app.builder.titleMatchOnLoad = true;
    }

    //_builderPanel.updateSharingStatus();
    _builderView.appInitComplete();
  }

  function resize() {
    //
  }

  //
  // Save
  //

  function saveApp() {
    if (! app.portal) {
      console.error('Fatal error - not signed in');
      saveAppFailed('APP');
      return;
    }

    var storyTitle = '',
        itemTitle = '';

    if (app.data.title) {
      storyTitle = app.data.title.trim();
    }

    if (app.data.appItem && app.data.appItem.item && app.data.appItem.item.title) {
      itemTitle = app.data.appItem.item.title.trim();
    }

    if (! storyTitle) {
      saveAppFailed('NONAME');
      return;
    }

    // FromScratch
    if (app.builder.isDirectCreationFirstSave) {
      app.portal.getPortalUser().getItems().then(function(items) {
        var foundDuplicate = false;

        if (items) {
          $.each(items, function(i, item) {
            if (item.title && item.title.toLowerCase() == storyTitle.toLowerCase()) {
              foundDuplicate = true;
            }
          });
        }

        // TODO make that an option
        if (foundDuplicate) {
          saveAppFailed('DUPLICATE');
        }
        else {
          saveAppFromScratch(storyTitle);
        }
      });
    }
    // Save of an existing app
    else {
      // if item and story title don't match
      //  and user hasn't chose to not be warned about it
      //  and story is public
      if (! app.builder.titleMatchOnLoad
          && ! app.data.appItem.data.values.config.doNotWarnTitle
          && app.data.appItem.item.access == 'public'
          // Extra check that title actually differs - don't show the dialog it title where not matching but user fixed it
          && storyTitle != itemTitle
      ) {
        // If the warning dialog has already been displayed in the session, skip it and reuse the choice
        if (app.builder.titleMatchDialogDisplayed) {
          builderSave(app.builder.titleFromItem);
        }
        // Show the warning dialog
        else {
          app.builder.titleMatchDialogDisplayed = true;

          _saveErrorPopupSocial.present().then(
            function(p) {
              p = p || {};
              app.builder.titleFromItem = p.choice == 'item';
              builderSave(app.builder.titleFromItem);
            }
          );
        }
      }
      else {
        // Save the app
        var keepItemTitle = app.data.appItem.data.values.config.doNotWarnTitle
            || (app.data.appItem.item.access != 'public' && ! app.builder.titleMatchOnLoad);

        builderSave(keepItemTitle);
      }
    }
  }

  function builderSave(doNotOverwriteTitle) {
    BuilderHelper.saveApp(doNotOverwriteTitle).then(
      function() {
        saveAppSuccess();
      },
      function() {
        saveAppFailed('APP');
      }
    );
  }

  function saveAppFromScratch(title) {
    var uid = IdentityManager.findCredential(BuilderHelper.getPortalURL()).userId;

    lang.mixin(app.data.appItem.item, {
      title: title,
      snippet: '',
      uploaded: Date.now(),
      modified: Date.now(),
      owner: uid,
      access: 'private'
    });

		// Save the app
    BuilderHelper.saveApp(false).then(
      function(response) {
        var baseUrl = document.location.protocol + '//' + document.location.host + document.location.pathname;
        if (! baseUrl.match(/index\.html$/)) {
          baseUrl += 'index.html';
        }

        lang.mixin(app.data.appItem.item, {
          id: response.id,
          item: response.item,
          url: baseUrl + '?appid=' + response.id
        });

        BuilderHelper.saveApp(false).then(function() {
          console.log('common.builder.Builder - saveAppFromScratch - appid:', response.id);

          app.builder.isDirectCreationFirstSave = false;

          window.history.replaceState({}, '', 'index.html?appid=' + response.id + '&edit');

          saveAppSuccess();
        });
      },
      function() {
        saveAppFailed();
      }
    );
  }

  //
  // Sharing
  //

  function shareApp(params) {
    var resultDeferred = new Deferred(),
        item = app.data.appItem.item;

    if (! params || ! params.sharingLevel || ! item) {
      resultDeferred.reject();
      return resultDeferred;
    }

    var sharingLevel = params.sharingLevel;

    if (sharingLevel != 'public' && sharingLevel != 'account' && sharingLevel != 'private') {
      sharingLevel = 'private';
    }

    // Find items to share - only if they aren't already shared to the proper level
    var targetItems = [app.data.appItem.item.id];

    BuilderHelper.shareItems(targetItems.join(','), sharingLevel).then(function(response) {
      var success = response
        && response.results
        && response.results.length == targetItems.length;

      if (success) {
        $.each(response.results, function(i, result) {
          if (! result.success) {
            success = false;
          }
        });

        app.data.appItem.item.access = sharingLevel;
      }

      resultDeferred.resolve();
    });

    return resultDeferred;
  }

  //
  // Save callbacks
  //

  function saveAppSuccess() {
    app.mystories = app.mystories || { };
    app.mystories.isChecking = true;

    app.isWebMapCreation = false;

    app.builder.pendingChanges = 0;

    _builderPanel.saveSucceeded();
    //app.data.updateAfterSave();

    // Initialize My Stories
    if (app.builder.isGalleryCreation || app.builder.isDirectCreationFirstSave) {
      app.builder.isDirectCreationFirstSave = false;
      app.builder.isGalleryCreation = false;
      // Delay a little to be sure the share dialog will be open when the scan will be done
      //setTimeout(window.myStoriesInit, 200);
    }
    // else {
    //   MyStoriesWrapper.scanStory();
    // }

    //_builderPanel.updateSharingStatus();
  }

  function saveAppFailed(source, error) {
    _builderPanel.saveFailed(source, error);
    _builderView.saveFailed(source, error);
  }

  return {
    init: init,
    resize: resize,
    appInitComplete: appInitComplete,
    saveApp: saveApp
  };
});


define('lib-build/tpl!storymaps/tpl/builder/BuilderView', [],function () { return function(obj){obj||(obj={});var __t,__p='',__e=_.escape;with(obj){__p+='<div class="modal fade" id="settingsPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade builderShare" id="sharePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade builderShareError" id="sharePopupError" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade saveErrorPopup" id="saveErrorPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n<div class="modal fade saveErrorPopupSocial" id="saveErrorPopupSocial" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="modal fade media-picker-popup" role="dialog" data-backdrop="static" tabindex="-1"></div>\r\n\r\n<div class="notification-container">\r\n\r\n</div>\r\n';}return __p}; });


define('lib-build/less!storymaps/tpl/builder/BuilderView',[],function(){});
define('storymaps-react/tpl/builder/Controller',['module', 'exports', '../core/Controller', 'dojo/topic', 'lib-build/i18n!./../../../resources/tpl/builder/nls/app', './notification/Undo'], function (module, exports, _Controller, _topic, _app, _Undo) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Controller2 = _interopRequireDefault(_Controller);

  var _topic2 = _interopRequireDefault(_topic);

  var _app2 = _interopRequireDefault(_app);

  var _Undo2 = _interopRequireDefault(_Undo);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  var _get = function get(object, property, receiver) {
    if (object === null) object = Function.prototype;
    var desc = Object.getOwnPropertyDescriptor(object, property);

    if (desc === undefined) {
      var parent = Object.getPrototypeOf(object);

      if (parent === null) {
        return undefined;
      } else {
        return get(parent, property, receiver);
      }
    } else if ("value" in desc) {
      return desc.value;
    } else {
      var getter = desc.get;

      if (getter === undefined) {
        return undefined;
      }

      return getter.call(receiver);
    }
  };

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  _topic2.default.subscribe('builder-section-update', function () {
    ControllerBuilder.storyChange();
  });

  _topic2.default.subscribe('builder-media-update', function () {
    ControllerBuilder.storyChange();
  });

  var ControllerBuilder = function (_ControllerCore) {
    _inherits(ControllerBuilder, _ControllerCore);

    function ControllerBuilder() {
      _classCallCheck(this, ControllerBuilder);

      return _possibleConstructorReturn(this, (ControllerBuilder.__proto__ || Object.getPrototypeOf(ControllerBuilder)).apply(this, arguments));
    }

    _createClass(ControllerBuilder, null, [{
      key: 'storyChange',
      value: function storyChange() {
        app.builder.pendingChanges++;

        _topic2.default.publish('builder-story-update');
      }
    }, {
      key: 'storyUndo',
      value: function storyUndo() {
        app.builder.pendingChanges--;

        _topic2.default.publish('builder-story-update');
      }
    }, {
      key: 'renderStory',
      value: function renderStory(config, sections) {
        //
        // Insert a credits placeholder section to allow user to add content at the bottom of the story
        // That section visibility is updated depending on story content
        // See BuilderView.js > onSectionUpdate
        //

        var lastSection = sections[sections.length - 1],
            creditsPlaceholderPos = sections.length;

        if (lastSection && lastSection.type == 'credits') {
          creditsPlaceholderPos = creditsPlaceholderPos - 1;
        }

        sections.splice(creditsPlaceholderPos, 0, app.ui.SectionFactory.createInstance({
          type: 'credits-placeholder'
        }));

        _get(ControllerBuilder.__proto__ || Object.getPrototypeOf(ControllerBuilder), 'renderStory', this).call(this, config, sections);
      }
    }, {
      key: 'onScroll',
      value: function onScroll(params) {
        _get(ControllerBuilder.__proto__ || Object.getPrototypeOf(ControllerBuilder), 'onScroll', this).call(this, params);

        /*
        var currentSection = app.display.sections[this._currentSectionIndex],
            nextSection = app.display.sections[this._currentSectionIndex + 1];
          if (! currentSection) {
          return;
        }
        */

        // TODO
        /*
        $('.builder-section-add-menu').removeClass('active');
          if (currentSection.type != 'sequence') {
          if (! nextSection) {
            console.log('Need bottom of story menu');
          }
          else if (nextSection.type != 'sequence') {
            var nextSectionTop = nextSection.top,
                scrollTop = params.scrollTop,
                needAddMenu = scrollTop + (app.display.windowHeight * 0.9) > nextSectionTop;
              nextSection.node.find('.builder-section-add-menu').toggleClass('active', needAddMenu);
          }
        }
        */

        /*
        console.log(this._isNavigatingAway, this._currentViewScrollPosition, this._currentViewScrollPosition >= app.display.sectionHeight / 2)
        if (this._isNavigatingAway && this._currentViewScrollPosition >= app.display.sectionHeight / 2) {
          this._node.next().find('.builder-imm-after-menu')
            .addClass('active')
            .css('top', app.display.windowHeight - this._currentViewScrollPosition);
        }
        else {
          this._node.next().find('.builder-imm-after-menu').removeClass('active');
        }
        */
      }
    }, {
      key: 'openSettings',
      value: function openSettings() {
        var headerSettings = app.data.appItem.data.values.settings.header;

        if (!headerSettings || !headerSettings.logo || !headerSettings.link) {
          headerSettings = _Controller2.default.DEFAULT_HEADER_SETTINGS;
        }

        var settingsPopupParams = {
          context: {
            headerBackground: '#000'
          },
          settings: Object.assign({}, headerSettings, { bookmarks: this.getBookmarksBuilder() })
        };

        app.builder.settingsPopup.open(settingsPopupParams).then(function (settings) {

          // Persist header
          app.data.appItem.data.values.settings.header = {
            logo: settings.logo,
            link: settings.link,
            social: settings.social
          };

          // Persist bookmarks
          this._setBookmarksBuilder(settings.bookmarks);

          // Update header
          this.renderHeader();

          this.storyChange();
        }.bind(this), function () {
          //
        });
      }
    }, {
      key: 'getBookmarksBuilder',
      value: function getBookmarksBuilder() {
        var bookmarks = [];

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this._sections[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var section = _step.value;

            if (section.getBookmark) {
              var bookmark = section.getBookmark();
              if (bookmark) {
                if (!bookmark.title) {
                  if (section.type == 'sequence') {
                    bookmark.title = _app2.default.builder.headerConfig.bookmarks.sequentialDefault;
                  } else if (section.type == 'immersive') {
                    bookmark.title = _app2.default.builder.headerConfig.bookmarks.immersiveDefault;
                  } else if (section.type == 'title') {
                    bookmark.title = _app2.default.builder.headerConfig.bookmarks.titleDefault;
                  } else if (section.type == 'cover') {
                    bookmark.title = _app2.default.builder.headerConfig.bookmarks.coverDefault;
                  }
                } else {
                  if (section.type == 'cover') {
                    bookmark.title += ' ' + _app2.default.builder.headerConfig.bookmarks.coverAppendage;
                  }
                }
                bookmarks.push(bookmark);
              }
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return bookmarks;
      }
    }, {
      key: '_setBookmarksBuilder',
      value: function _setBookmarksBuilder(bookmarks) {
        var bookmarkIndex = 0;

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this._sections[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var section = _step2.value;

            if (section.getBookmark) {
              section.setBookmark(bookmarks[bookmarkIndex++]);
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    }, {
      key: 'serializeStory',
      value: function serializeStory() {
        var story = [];

        var _iteratorNormalCompletion3 = true;
        var _didIteratorError3 = false;
        var _iteratorError3 = undefined;

        try {
          for (var _iterator3 = this._sections[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
            var section = _step3.value;

            var sectionJSON = section.serialize();

            if (sectionJSON) {
              story.push(sectionJSON);
            }
          }
        } catch (err) {
          _didIteratorError3 = true;
          _iteratorError3 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion3 && _iterator3.return) {
              _iterator3.return();
            }
          } finally {
            if (_didIteratorError3) {
              throw _iteratorError3;
            }
          }
        }

        return story;
      }
    }, {
      key: 'getStoryOverview',
      value: function getStoryOverview() {
        var overview = [];

        if (!this._sections) {
          return overview;
        }

        var onlyOneSectionInStory = false;
        if (this._sections.length == 3 || this._sections.length == 4 && this._sections[3].type == 'credits') {
          onlyOneSectionInStory = true;
        }

        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = this._sections[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            var section = _step4.value;

            var type = section.type;

            if (type == 'credits-placeholder') {
              continue;
            }

            if (type == 'cover') {
              overview.push({
                id: section.id,
                style: 'button',
                label: _app2.default.builder.builderPanel.coverLabel,
                hasDelete: false,
                hasHide: false,
                hasDuplicate: false,
                hasOrganize: false
              });
            } else if (type == 'credits') {
              overview.push({
                id: section.id,
                style: 'button',
                label: _app2.default.builder.builderPanel.creditsLabel,
                hasDelete: true,
                hasHide: true,
                hasDuplicate: false,
                hasOrganize: false
              });
            } else if (type == 'title') {
              overview.push({
                id: section.id,
                style: 'thumbnail',
                size: 'short',
                thumbnail: section.getPreviewThumbnail(),
                label: section.getPreviewText(),
                icon: section.getPreviewIcon(),
                hasDelete: !onlyOneSectionInStory,
                hasHide: true,
                hasDuplicate: true,
                hasOrganize: true
              });
            } else if (type == 'sequence') {
              var storyIsEmpty = false;

              if (this._sections.length == 3 && !section.getPreviewText() && !section.getPreviewThumbnail()) {
                storyIsEmpty = true;
              }

              overview.push({
                id: section.id,
                style: storyIsEmpty ? 'simple-text' : 'thumbnail',
                size: 'tall',
                thumbnail: section.getPreviewThumbnail(),
                text: storyIsEmpty ? 'As you build your story, the sections will appear here.' : section.getPreviewText(),
                hasDelete: !onlyOneSectionInStory,
                hasHide: true,
                hasDuplicate: !storyIsEmpty,
                hasOrganize: !onlyOneSectionInStory
              });
            } else {
              overview.push({
                id: section.id,
                style: 'thumbnail',
                size: 'tall',
                showTitleBar: true,
                thumbnail: section.getPreviewThumbnail(),
                title: section.getPreviewText(),
                icon: section.getPreviewIcon(),
                hasDelete: !onlyOneSectionInStory,
                hasHide: true,
                hasDuplicate: true,
                hasOrganize: true
              });
            }
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4.return) {
              _iterator4.return();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }

        return overview;
      }
    }, {
      key: 'addSection',
      value: function addSection(p) {
        console.log('addSection:', p);

        if (!p || !(p.type || p.section)) {
          return;
        }

        if (p.index === undefined || p.index < 0 || p.index > this._sections.length) {
          return;
        }

        var newSectionJSON = p.section || {
          type: p.type
        };

        var newSection = app.ui.SectionFactory.createInstance(newSectionJSON);

        this._sections.splice(p.index + 1, 0, newSection);
        this._container.find('.section').eq(p.index).after(newSection.render());
        newSection.postCreate(this._container.find('.section').eq(p.index + 1));

        if (p.navigation !== false) {
          window.requestAnimationFrame(function () {
            this.navigateToSection({
              index: p.index + 1,
              animate: true,
              animateSpeed: p.animateSpeed
            });

            newSection.focus();
          }.bind(this));
        }

        //
        // Undo
        //

        /*
        if (! p.section) {
          var undoNotification = new UndoNotification({
            container: this._container.find('.section').eq(p.index + 1),
            label: 'You created a section' // TODO
          });
            undoNotification.display().then(
            function() {
              this.deleteSection({
                index: p.index + 1
              });
                this.storyUndo();
            }.bind(this),
            function() {
              //
            }
          );
        }
        */

        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: '_splitSection',
      value: function _splitSection(p) {
        var sectionSplit1 = this._sections[p.section].serializePartially(0, p.split + 1);
        var sectionSplit2 = this._sections[p.section].serializePartially(p.split + 1);

        this.deleteSection({
          index: p.section,
          navigation: false,
          undo: false
        });

        this.addSection({
          index: p.section - 1,
          section: sectionSplit1,
          navigation: false
        });

        this.addSection({
          index: p.section,
          section: sectionSplit2,
          navigation: false
        });
      }
    }, {
      key: 'splitAndAddSection',
      value: function splitAndAddSection(p) {
        console.log('splitAndAddSection:', p);

        if (!p || !p.type) {
          return;
        }

        if (p.section === undefined || p.section < 0 || p.section > this._sections.length) {
          return;
        }

        if (p.split === undefined || p.split < 0) {
          return;
        }

        // If splitting after the last block, will just add a section
        if (!this._sections[p.section].requireSplitAt(p.split)) {
          this.addSection({
            navigation: p.type != 'title',
            index: p.section,
            type: p.type,
            animateSpeed: 800
          });

          return;
        }

        var scrollTop = $(window).scrollTop();

        this._splitSection(p);

        this.addSection({
          index: p.section,
          type: p.type,
          navigation: p.type != 'title',
          animate: true,
          animateSpeed: 800
        });

        if (p.type == 'title') {
          $(window).scrollTop(scrollTop);

          app.ui.update({
            forceUpdate: true
          });
        }
      }
    }, {
      key: 'deleteActiveSection',
      value: function deleteActiveSection() {
        this.deleteSection({
          index: this._currentSectionIndex
        });
      }
    }, {
      key: 'deleteSection',
      value: function deleteSection(p) {
        console.log('deleteSection:', p);

        if (!p || !p.index) {
          return;
        }

        var sectionsBackup = [],
            currentIndexBackup = this._currentSectionIndex;

        for (var i = 0; i < this._sections.length; i++) {
          sectionsBackup[i] = this._sections[i];
        }

        // TODO destroy
        this._sections.splice(p.index, 1);
        this._container.find('.section').eq(p.index).remove();

        var postDeleteCurrentSection = this._sections[this._currentSectionIndex];

        // If deleting active section, will move to previous one
        if (p.index == this._currentSectionIndex) {
          postDeleteCurrentSection = this._sections[this._currentSectionIndex - 1];
        }

        // Merge eventual consecutive sequence section that would be created by deleting
        //   a section in between two sequences
        // skipMerge: because the merge function is also using delete for internal reason
        var mergeData = {
          hasMerged: false
        };

        if (!p.skipMerge) {
          mergeData = this._mergeConsecutiveSequenceSections(postDeleteCurrentSection);
        }

        _topic2.default.publish('builder-section-update');

        if (p.navigation !== false || mergeData.hasMerged) {
          window.requestAnimationFrame(function () {
            // Some clean up of references to the current section to make sure
            //  the section will be activated properly at it's new location
            //  especially an issue with Immersive
            this._currentSectionIndex = -1;
            this._currentSection = null;
            this._$currentSection = null;

            this.navigateToSection({
              index: mergeData.newCurrentSectionIndex,
              animate: true,
              animateSpeed: 800
            });
          }.bind(this));
        }

        //
        // Undo
        //
        if (p.undo !== false) {
          var undoNotification = new _Undo2.default({
            container: this._container.find('.section').eq(p.index + 1),
            label: 'You deleted a section', // TODO
            clearFollowingsAfterUndo: true
          });

          undoNotification.display().then(function () {
            this._restoreSectionBackup(sectionsBackup, currentIndexBackup);
          }.bind(this), function () {
            //
          });
        }
      }
    }, {
      key: 'duplicateSection',
      value: function duplicateSection(p) {
        console.log('duplicateSection:', p);

        if (!p || !p.index) {
          return;
        }

        var oldSection = this._sections.slice(p.index, p.index + 1)[0],
            oldSectionJSON = oldSection.serialize();

        if (oldSectionJSON.bookmark) {
          oldSectionJSON.bookmark.enabled = false;
        }

        var newSection = app.ui.SectionFactory.createInstance(oldSectionJSON);

        this._sections.splice(p.index + 1, 0, newSection);
        this._container.find('.section').eq(p.index).after(newSection.render());
        newSection.postCreate(this._container.find('.section').eq(p.index + 1));

        this.navigateToSection({
          index: p.index + 1,
          animate: false
        });

        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: 'getSectionsIndexesByIds',
      value: function getSectionsIndexesByIds(sectionsIds) {
        var sectionsIndexes = [];

        var _iteratorNormalCompletion5 = true;
        var _didIteratorError5 = false;
        var _iteratorError5 = undefined;

        try {
          for (var _iterator5 = sectionsIds[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
            var sectionId = _step5.value;

            for (var sectionIndex = 0; sectionIndex < this._sections.length; sectionIndex++) {
              var section = this._sections[sectionIndex];
              if (section.id == sectionId) {
                sectionsIndexes.push(sectionIndex);
              }
            }
          }
        } catch (err) {
          _didIteratorError5 = true;
          _iteratorError5 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion5 && _iterator5.return) {
              _iterator5.return();
            }
          } finally {
            if (_didIteratorError5) {
              throw _iteratorError5;
            }
          }
        }

        return sectionsIndexes;
      }
    }, {
      key: 'organizeSections',
      value: function organizeSections(sectionIndexes, isUndo) {
        console.log('organizeSections:', sectionIndexes);

        //
        // Check if the specified new order require a change
        //

        var newSectionsAlreadySorted = true;

        for (var _i = 0; _i < sectionIndexes.length - 1; _i++) {
          if (sectionIndexes[_i] > sectionIndexes[_i + 1]) {
            newSectionsAlreadySorted = false;
            break;
          }
        }

        if (newSectionsAlreadySorted) {
          return;
        }

        var sectionsBackup = [],
            currentIndexBackup = this._currentSectionIndex;

        for (var _i2 = 0; _i2 < this._sections.length; _i2++) {
          sectionsBackup[_i2] = this._sections[_i2];
        }

        var newSections = [],
            newCurrentSectionIndex = -1,
            sectionIndex = null;

        // Reorder the sections object
        for (var i = 0; i < sectionIndexes.length; i++) {
          sectionIndex = sectionIndexes[i];
          newSections.push(this._sections[sectionIndex]);

          if (sectionIndex == this._currentSectionIndex) {
            newCurrentSectionIndex = i;
          }
        }

        // Add back credits placeholder that is not passed to the overview panel
        // TODO: shall it?
        var lastSection = this._sections[this._sections.length - 1];
        // If the last section is credits, the placeholder is before
        if (lastSection.type == 'credits') {
          newSections.splice(newSections.length - 1, 0, this._sections[this._sections.length - 2]);
        } else {
          newSections.push(lastSection);
        }

        // Persist
        this._sections = newSections;
        // Persit in viewer controller - not sure why it's needed TODO
        this.prototype.__proto__.constructor._sections = this._sections;
        app.data.sections = newSections;

        // Reorder the DOM
        for (sectionIndex = this._sections.length - 1; sectionIndex >= 0; sectionIndex--) {
          var section = this._sections[sectionIndex];
          this._container.prepend(section._node);
        }

        var newCurrentSection = this._sections[newCurrentSectionIndex];

        // Merge eventual consecutive sequence sections
        var mergeData = this._mergeConsecutiveSequenceSections(newCurrentSection);

        var undoLabel = 'You organized the sections';
        if (mergeData.hasMerged) {
          newCurrentSectionIndex = mergeData.newCurrentSectionIndex;

          //undoLabel += '.<br />Some consecutive sequential sections have been joined.<br />';
        }

        // Navigate to new position of current section
        if (newCurrentSectionIndex != -1) {
          window.requestAnimationFrame(function () {
            // Some clean up of references to the current section to make sure
            //  the section will be activated properly at it's new location
            //  especially an issue with Immersive
            this._currentSectionIndex = -1;
            this._currentSection = null;
            this._$currentSection = null;

            this.navigateToSection({
              index: newCurrentSectionIndex,
              animate: false
            });
          }.bind(this));
        }

        //
        // Undo
        //

        if (!isUndo) {
          var undoNotification = new _Undo2.default({
            container: this._node,
            label: undoLabel
          });

          undoNotification.display({
            clearPreviousUndo: true
          }).then(function () {
            // Not sure why the following is not working... it only work in some case
            //this.organizeSections(sectionIndexes, true);

            // and the following only work in some other cases...
            /*
            var reverseSort = [];
            for (let i=0; i < sectionIndexes.length; i++) {
              reverseSort[i] = sectionIndexes[sectionIndexes[i]];
            }
            this.organizeSections(reverseSort, true);
            */

            this._restoreSectionBackup(sectionsBackup, currentIndexBackup);
          }.bind(this), function () {
            //
          });
        }

        _topic2.default.publish('builder-section-update');
      }
    }, {
      key: '_restoreSectionBackup',
      value: function _restoreSectionBackup(sectionsBackup, currentIndexBackup) {
        // Persist
        this._sections = sectionsBackup;
        // Persit in viewer controller - not sure why it's needed TODO
        this.prototype.__proto__.constructor._sections = sectionsBackup;
        app.data.sections = sectionsBackup;

        // Reorder the DOM
        for (var sectionIndex = this._sections.length - 1; sectionIndex >= 0; sectionIndex--) {
          var section = this._sections[sectionIndex];
          this._container.prepend(section._node);
        }

        $.each(this._container.children(), function (i, sectionNode) {
          var foundNode = false;

          var _iteratorNormalCompletion6 = true;
          var _didIteratorError6 = false;
          var _iteratorError6 = undefined;

          try {
            for (var _iterator6 = this._sections[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
              var _section = _step6.value;

              if ($(_section._node).is(sectionNode)) {
                foundNode = true;
              }
            }
          } catch (err) {
            _didIteratorError6 = true;
            _iteratorError6 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion6 && _iterator6.return) {
                _iterator6.return();
              }
            } finally {
              if (_didIteratorError6) {
                throw _iteratorError6;
              }
            }
          }

          if (!foundNode) {
            sectionNode.remove();
          }
        }.bind(this));

        _topic2.default.publish('builder-section-update');

        if (this._currentSectionIndex != currentIndexBackup) {
          window.requestAnimationFrame(function () {
            // Some clean up of references to the current section to make sure
            //  the section will be activated properly at it's new location
            //  especially an issue with Immersive
            this._currentSectionIndex = -1;
            this._currentSection = null;
            this._$currentSection = null;

            this.navigateToSection({
              index: currentIndexBackup,
              animate: false
            });
          }.bind(this));
        }
      }
    }, {
      key: '_mergeConsecutiveSequenceSections',
      value: function _mergeConsecutiveSequenceSections(currentSection) {
        var hasMerged = false;

        // Will work on consecutive section only two by two
        // Goes bottom up in the story to avoid array manipulation side effect
        // Create a new section and delete the two that are merged
        //   to allow undo that has kept a reference to those sections
        // A more sophisticated algorithm seems unessary as this should be used
        //   rarely after V1 stories are cleaned

        var prevSectionType = '';

        for (var i = this._sections.length - 1; i >= 0; i--) {
          var section = this._sections[i];

          if (section.type == 'sequence' && prevSectionType == 'sequence') {
            var newSection = section.mergeAndSerialize(this._sections[i + 1]);

            // If the current section is one of the section getting merged
            //  it will be updated to the new section (after the merge to get a valid reference)
            var updateCurrentSection = false;
            if (currentSection == section || currentSection == this._sections[i + 1]) {
              updateCurrentSection = true;
            }

            this.deleteSection({
              index: i + 1,
              navigation: false,
              undo: false,
              skipMerge: true
            });

            this.deleteSection({
              index: i,
              navigation: false,
              undo: false,
              skipMerge: true
            });

            this.addSection({
              index: i - 1,
              section: newSection,
              navigation: false
            });

            if (updateCurrentSection) {
              currentSection = this._sections[i];
            }

            hasMerged = true;
          }

          prevSectionType = section.type;
        }

        // Compute the index of the currentSection
        var newCurrentSectionIndex = -1;
        for (var sectionIndex = this._sections.length - 1; sectionIndex >= 0; sectionIndex--) {
          var _section2 = this._sections[sectionIndex];
          if (_section2 == currentSection) {
            newCurrentSectionIndex = sectionIndex;
          }
        }

        return {
          hasMerged: hasMerged,
          newCurrentSectionIndex: newCurrentSectionIndex
        };
      }
    }]);

    return ControllerBuilder;
  }(_Controller2.default);

  exports.default = ControllerBuilder;
  module.exports = exports['default'];
});
//# sourceMappingURL=Controller.js.map
;

define('lib-build/tpl!storymaps/common/builder/mediaPicker/MediaPickerPopup', [],function () { return function(obj){obj||(obj={});var __t,__p='',__e=_.escape;with(obj){__p+='<div class="modal-dialog">\r\n  <div class="modal-content">\r\n    <div class="modal-logo"></div>\r\n    <div class="modal-header">\r\n      <h4 class="modal-title"></h4>\r\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n        <span aria-hidden="true">&times;</span>\r\n      </button>\r\n    </div>\r\n    <div class="modal-body" id="media-picker">\r\n    </div>\r\n  </div>\r\n</div>\r\n';}return __p}; });


define('lib-build/less!storymaps/common/builder/mediaPicker/MediaPickerPopup',[],function(){});
define('storymaps-react/common/builder/mediaPicker/constants',['module', 'exports'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.default = {
    providers: {
      GOOGLE_PHOTOS: 'googlePhotos',
      FLICKR: 'flickr',
      ARCGIS: 'arcgis',
      URL: 'urlContent'
    },
    contentType: {
      IMAGE: 'image',
      VIDEO: 'video',
      // AUDIO: 'audio',
      WEBPAGE: 'webpage',
      WEBMAP: 'webmap',
      WEBSCENE: 'webscene'
    },
    // supported agol upload types that fit within the content types above.
    // http://mediawikidev.esri.com/index.php/Manage_item_resource_files
    // Yes, you need a dot in front of the extension
    uploadFileExtensions: {
      // VIDEO: ['.mp4'],
      // AUDIO: ['.mp3'],
      IMAGE: ['.png', '.jpeg', '.jpg', '.gif', '.bmp']
    },
    fetchStatus: {
      NOT_FETCHED: 'NOT_FETCHED',
      FETCHING: 'FETCHING',
      SUCCESS: 'SUCCESS',
      ERROR: 'ERROR',
      NON_MATCHING_URL: 'NON_MATCHING_URL',
      NOT_AUTHORIZED: 'NOT_AUTHORIZED',
      NOT_FOUND: 'NOT_FOUND',
      BAD_FORMAT: 'BAD_FORMAT'
    },
    galleryContent: {
      ALBUMS: 'ALBUMS',
      IMAGES: 'IMAGES',
      AGOL: 'AGOL',
      IMG_HEIGHT: 100, // this also needs to be changed in GalleryItem.less
      ALBUM_HEIGHT: 150 // this also needs to be changed in GalleryItem.less
    },
    searchType: {
      USER: 'USER',
      TEXT: 'TEXT'
    },
    searchLocation: {
      STORY: 'STORY',
      AGOL: 'AGOL',
      ORG: 'ORG',
      MINE: 'MINE'
    },
    // these are from REST API, Managing your org > Concepts > Items and item types
    // decided not to do stored images because of token issues.
    agolContentType: {
      WEBMAP: 'Web Map',
      WEBSCENE: 'Web Scene',
      IMAGE: 'Image'
    },
    sortField: {
      DATE: 'modified',
      TITLE: 'title',
      VIEWS: 'numViews'
    },
    sortOrder: {
      ASC: 'asc',
      DESC: 'desc'
    },
    flickrLicenseStrings: {
      PUBLIC_DOMAIN: 'PUBLIC_DOMAIN',
      COMMERCIAL: 'COMMERCIAL',
      NON_COMMERCIAL: 'NON_COMMERCIAL',
      ALL_RIGHTS_RESERVED: 'ALL_RIGHTS_RESERVED',
      ANY: 'ANY'
    },
    flickrLicenseVals: {
      PUBLIC_DOMAIN: [8, 9, 10],
      COMMERCIAL: [4, 5, 8, 9, 10],
      NON_COMMERCIAL: [1, 2, 4, 5, 8, 9, 10],
      ANY: [0, 1, 2, 4, 5, 8, 9, 10]
    },
    userFetchError: {
      NO_USER: 'NO_USER',
      NO_PHOTOS: 'NO_PHOTOS',
      ERROR: 'ERROR'
    },
    // for agol photo attaching
    photoSettings: {
      maxWidth: 1500,
      maxHeight: 1000,
      maxFileSize: 10000000 // 10Mb in bytes.
    },
    blankBackground: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'
  };
  module.exports = exports['default'];
});
//# sourceMappingURL=constants.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/actionTypes',['exports'], function (exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  var UPDATE_ALBUMS = exports.UPDATE_ALBUMS = 'UPDATE_ALBUMS';
  var UPDATE_ALBUM_FETCH_STATUS = exports.UPDATE_ALBUM_FETCH_STATUS = 'UPDATE_ALBUM_FETCH_STATUS';
  var UPDATE_IMAGE_FETCH_STATUS = exports.UPDATE_IMAGE_FETCH_STATUS = 'UPDATE_IMAGE_FETCH_STATUS';
  var UPDATE_USERNAME = exports.UPDATE_USERNAME = 'UPDATE_USERNAME';
  var UPDATE_DISPLAYED_CONTENT = exports.UPDATE_DISPLAYED_CONTENT = 'UPDATE_DISPLAYED_CONTENT';
  var UPDATE_IMAGES = exports.UPDATE_IMAGES = 'UPDATE_IMAGES';
  var UPDATE_SELECTED_ALBUM = exports.UPDATE_SELECTED_ALBUM = 'UPDATE_SELECTED_ALBUM';
  var UPDATE_SEARCH_TYPE = exports.UPDATE_SEARCH_TYPE = 'UPDATE_SEARCH_TYPE';
  var UPDATE_USER_SEARCH_TERM = exports.UPDATE_USER_SEARCH_TERM = 'UPDATE_USER_SEARCH_TERM';
  var UPDATE_PHOTO_SEARCH_TERM = exports.UPDATE_PHOTO_SEARCH_TERM = 'UPDATE_PHOTO_SEARCH_TERM';
  var UPDATE_USER_LICENSE = exports.UPDATE_USER_LICENSE = 'UPDATE_USER_LICENSE';
  var UPDATE_PHOTO_LICENSE = exports.UPDATE_PHOTO_LICENSE = 'UPDATE_PHOTO_LICENSE';
  var UPDATE_SEARCH_LOCATION = exports.UPDATE_SEARCH_LOCATION = 'UPDATE_SEARCH_LOCATION';
  var UPDATE_SEARCH_TERM = exports.UPDATE_SEARCH_TERM = 'UPDATE_SEARCH_TERM';
  var UPDATE_AUTHORIZED_CONTENT_TYPES = exports.UPDATE_AUTHORIZED_CONTENT_TYPES = 'UPDATE_AUTHORIZED_CONTENT_TYPES';
  var UPDATE_AVAILABLE_CONTENT_TYPES = exports.UPDATE_AVAILABLE_CONTENT_TYPES = 'UPDATE_AVAILABLE_CONTENT_TYPES';
  var UPDATE_SELECTED_CONTENT_TYPES = exports.UPDATE_SELECTED_CONTENT_TYPES = 'UPDATE_SELECTED_CONTENT_TYPES';
  var UPDATE_SORT_FIELD = exports.UPDATE_SORT_FIELD = 'UPDATE_SORT_FIELD';
  var UPDATE_SORT_ORDER = exports.UPDATE_SORT_ORDER = 'UPDATE_SORT_ORDER';
});
//# sourceMappingURL=actionTypes.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/reducer',['module', 'exports', 'redux', '../constants', './actionTypes'], function (module, exports, _redux, _constants, _actionTypes) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _constants2 = _interopRequireDefault(_constants);

  var types = _interopRequireWildcard(_actionTypes);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  var commonMembers = {
    albums: [],
    selectedAlbum: {},
    images: [],
    displayedContent: _constants2.default.galleryContent.ALBUMS,
    albumFetchStatus: _constants2.default.fetchStatus.NOT_FETCHED,
    imageFetchStatus: _constants2.default.fetchStatus.NOT_FETCHED,
    userName: ''
  };

  var flickrMembers = {
    selectedTab: _constants2.default.searchType.TEXT,
    selectedUser: '',
    userSearchTerm: '',
    userLicense: _constants2.default.flickrLicenseStrings.ANY, // possibly in google photos as well
    photoSearchTerm: '',
    photoLicense: _constants2.default.flickrLicenseStrings.COMMERCIAL
  };

  var googlePhotosMembers = {};

  var agolMembers = {
    displayedContent: _constants2.default.galleryContent.AGOL,
    searchLocation: _constants2.default.searchLocation.MINE,
    searchStr: '',
    sortField: _constants2.default.sortField.DATE,
    sortOrder: _constants2.default.sortOrder.DESC
  };

  var urlMembers = {};

  var flickrState = Object.assign({}, commonMembers, flickrMembers);
  var googlePhotosState = Object.assign({}, commonMembers, googlePhotosMembers);
  var agolState = Object.assign({}, commonMembers, agolMembers);
  var urlState = Object.assign({}, commonMembers, urlMembers);

  function flickr() {
    var state = arguments.length <= 0 || arguments[0] === undefined ? flickrState : arguments[0];
    var action = arguments[1];

    if (!checkProvider(action, _constants2.default.providers.FLICKR)) {
      return state;
    }
    var stateProp, actionProp;
    switch (action.type) {
      case types.UPDATE_USER_SEARCH_TERM:
        stateProp = 'userSearchTerm', actionProp = 'term';
        break;
      case types.UPDATE_PHOTO_SEARCH_TERM:
        stateProp = 'photoSearchTerm', actionProp = 'term';
        break;
      case types.UPDATE_SEARCH_TYPE:
        stateProp = 'selectedTab', actionProp = 'type';
        break;
      case types.UPDATE_USER_LICENSE:
        stateProp = 'userLicense', actionProp = 'license';
        break;
      case types.UPDATE_PHOTO_LICENSE:
        stateProp = 'photoLicense', actionProp = 'license';
        break;
      default:
        return generic(state, action);
    }
    return Object.assign({}, state, _defineProperty({}, stateProp, action.value[actionProp]));
  }

  function googlePhotos() {
    var state = arguments.length <= 0 || arguments[0] === undefined ? googlePhotosState : arguments[0];
    var action = arguments[1];

    if (!checkProvider(action, _constants2.default.providers.GOOGLE_PHOTOS)) {
      return state;
    }
    return generic(state, action);
  }

  function agol() {
    var state = arguments.length <= 0 || arguments[0] === undefined ? agolState : arguments[0];
    var action = arguments[1];

    if (!checkProvider(action, _constants2.default.providers.ARCGIS)) {
      return state;
    }
    var stateProp, actionProp;
    switch (action.type) {
      case types.UPDATE_SEARCH_LOCATION:
        stateProp = 'searchLocation', actionProp = 'type';
        break;
      case types.UPDATE_SEARCH_TERM:
        stateProp = 'searchStr', actionProp = 'term';
        break;
      case types.UPDATE_SORT_FIELD:
        stateProp = 'sortField', actionProp = 'field';
        break;
      case types.UPDATE_SORT_ORDER:
        stateProp = 'sortOrder', actionProp = 'order';
        break;
      default:
        return generic(state, action);
    }
    return Object.assign({}, state, _defineProperty({}, stateProp, action.value[actionProp]));
  }

  function urlContent() {
    var state = arguments.length <= 0 || arguments[0] === undefined ? urlState : arguments[0];
    var action = arguments[1];

    if (!checkProvider(action, _constants2.default.providers.URL)) {
      return state;
    }
    return generic(state, action);
  }

  function checkProvider(action, thisProvider) {
    if (action && action.value && action.value.providerType === thisProvider) {
      return true;
    }
    return false;
  }

  function generic(state, action) {
    var stateProp, actionProp;
    switch (action.type) {
      case types.UPDATE_ALBUMS:
        stateProp = 'albums', actionProp = 'albums';
        break;
      case types.UPDATE_ALBUM_FETCH_STATUS:
        stateProp = 'albumFetchStatus', actionProp = 'fetchStatus';
        break;
      case types.UPDATE_IMAGE_FETCH_STATUS:
        stateProp = 'imageFetchStatus', actionProp = 'fetchStatus';
        break;
      case types.UPDATE_USERNAME:
        stateProp = 'userName', actionProp = 'userName';
        break;
      case types.UPDATE_DISPLAYED_CONTENT:
        stateProp = 'displayedContent', actionProp = 'displayedContent';
        break;
      case types.UPDATE_IMAGES:
        stateProp = 'images', actionProp = 'images';
        break;
      case types.UPDATE_SELECTED_ALBUM:
        stateProp = 'selectedAlbum', actionProp = 'selectedAlbum';
        break;
      default:
        {
          return state;
        }
    }
    return Object.assign({}, state, _defineProperty({}, stateProp, action.value[actionProp]));
  }

  exports.default = (0, _redux.combineReducers)({
    flickr: flickr,
    googlePhotos: googlePhotos,
    agol: agol,
    urlContent: urlContent
  });
  module.exports = exports['default'];
});
//# sourceMappingURL=reducer.js.map
;
define('storymaps-react/common/builder/mediaPicker/actionTypes',['exports'], function (exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  var BROWSE_SELECT_PROVIDER = exports.BROWSE_SELECT_PROVIDER = 'BROWSE_SELECT_PROVIDER';
});
//# sourceMappingURL=actionTypes.js.map
;
define('storymaps-react/common/builder/mediaPicker/reducer',['module', 'exports', 'redux', './browsePanel/reducer', './constants', './actionTypes'], function (module, exports, _redux, _reducer, _constants, _actionTypes) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _reducer2 = _interopRequireDefault(_reducer);

  var _constants2 = _interopRequireDefault(_constants);

  var actionTypes = _interopRequireWildcard(_actionTypes);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var initialState = {
    browseSelectedProvider: _constants2.default.providers.ARCGIS,
    authorizedMedia: []
  };

  var ui = function ui() {
    var state = arguments.length <= 0 || arguments[0] === undefined ? initialState : arguments[0];
    var action = arguments[1];

    switch (action.type) {
      case actionTypes.BROWSE_SELECT_PROVIDER:
        return Object.assign({}, state, { browseSelectedProvider: action.value });
      case actionTypes.UPDATE_AUTHORIZED_MEDIA:
        return Object.assign({}, state, { authorizedMedia: action.value });
      default:
        {
          return state;
        }
    }
  };

  exports.default = (0, _redux.combineReducers)({
    ui: ui,
    browsePanel: _reducer2.default
  });
  module.exports = exports['default'];
});
//# sourceMappingURL=reducer.js.map
;
define('storymaps-react/common/builder/mediaPicker/utils/Helper',['module', 'exports'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
    return typeof obj;
  } : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj;
  };

  var dataURItoBlob = function dataURItoBlob(dataURI) {
    var byteString = void 0;

    if (dataURI.split(',')[0].indexOf('base64') >= 0) {
      byteString = atob(dataURI.split(',')[1]);
    } else {
      byteString = unescape(dataURI.split(',')[1]);
    }

    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
    var ia = new Uint8Array(byteString.length);

    for (var i = 0; i < byteString.length; i++) {
      ia[i] = byteString.charCodeAt(i);
    }

    return new Blob([ia], { type: mimeString });
  };

  var classnames = function classnames() {
    var classes = '';
    var hasOwn = {}.hasOwnProperty;

    for (var i = 0; i < arguments.length; i++) {
      var arg = arguments[i];

      if (!arg) {
        continue;
      }

      var argType = typeof arg === 'undefined' ? 'undefined' : _typeof(arg);

      if (argType === 'string' || argType === 'number') {
        classes += ' ' + arg;
      } else if ($.isArray(arg)) {
        classes += ' ' + classnames.apply(null, arg);
      } else if (argType === 'object') {
        for (var key in arg) {
          if (hasOwn.call(arg, key) && arg[key]) {
            classes += ' ' + key;
          }
        }
      }
    }

    return classes.substr(1);
  };

  var stripTrailingSlash = function stripTrailingSlash(str) {
    if (str.substr(-1) === '/') {
      return str.substr(0, str.length - 1);
    }
    return str;
  };

  exports.default = {
    classnames: classnames,
    dataURItoBlob: dataURItoBlob,
    stripTrailingSlash: stripTrailingSlash
  };
  module.exports = exports['default'];
});
//# sourceMappingURL=Helper.js.map
;
define('storymaps-react/common/_resources/nls/media',{
  root: {
    mediaPicker: {
      browseToggle: {
        arcGIS: "ArcGIS",
        flickr: "Flickr",
        googlePhotos: "Google+",
        facebook: "Facebook",
        urls: "Link to Content",
        urls_short: "Link",
        // the keys for contentType should match constants.contentType
        contentType: {
          error: 'No authorized media',
          starter: "In this part of the story, you can add ",
          listSeparator: ",",
          OR: 'or',
          IMAGE: 'an image',
          VIDEO: 'a video',
          WEBPAGE: 'a webpage',
          WEBMAP: 'a webmap',
          WEBSCENE: 'a webscene'
        }
      },
      browsePanel: {
        providers: {
          searchingFor: "Searching for",
          albumsOf: "Albums of", // Context: when displaying "Albums of [user]". Possessive.
          noPhotosFound: "No photos matched your search. Please try again.",
          noItemsFound: "No items matched your search. Please try again.",
          noItemsInThisStory: "No content from ArcGIS has been added to this story yet.",
          limitReached: "Showing 100 items. If you didn't find what you need, try a keyword search.",
          galleryItems: {
            remove1: "Delete this unused image from your ArcGIS account.",
            remove2: "(You'll need to upload it again if you decide to use it later.)",
            removeFailed: "Remove this inaccessible image from this list.",
            uploadError: "Sorry, this item failed to upload",
            modified: "Modified", // context: "Modified 3/18/16"
            uploaded: "Uploaded", // context: "Uploaded 3/18/16"
            by: "by" // context: "Webmap by John Smith"
          },
          googlePhotos: {
            searchAndBrowse: "Browse photos on Picasa or Google+"
          },
          flickr: {
            photostream: "Photostream",
            searchAndBrowse: "Search and browse photos on Flickr"
          },
          urlContent: {
            uploadHeaders: {
              generic: "Link to content on the web",
              imageOnly: "Link to an image on the web",
              imageAndVideo: "Link to an image or video on the web"
            },
            linkText: {
              // context: full text for this section could be:
              // starter + hasVideo. listStarterWithAlso + <list of content types>. ender.
              // starter + listStarterWithoutAlso + <list of content types>. ender.
              starter: "In the box above,",
              hasVideo: "you can paste links or iframe code for videos from YouTube and Vimeo.",
              listStarterWithAlso: "You can also link directly to",
              listStarterWithoutAlso: "you can link directly to", // attaches directly to starter above
              listSeparator: ",",
              OR: 'or',
              IMAGE: 'photos',
              WEBPAGE: [
                'web pages',
                'web applications'
              ],
              ender: "When possible, use secure (https) links."
            },
            placeholder: "https://... or http://... or <iframe>",
            uploadErrors: {
              generic: "Something went wrong with the address entered. Please try again.",
              imageOnly: [
                "You must use an image in this part of the story.",
                 "Please provide a link to an image (.jpg, .png, .gif), or choose an image from ArcGIS, Flickr, or Google+."
              ],
              imageAndVideo: [
                "You must use an image or video in this part of the story.",
                "Please provide a link to an image (.jpg, .png, .gif) or a video on YouTube or Vimeo, or choose an image from ArcGIS, Flickr, or Google+."
              ],
              badFormat: 'The link to the ${media-type} you are trying to add is formatted incorrectly.',
              inaccessible: 'The ${media-type} you are trying to add is missing or not accessible.',
              tryAgain: 'Please check the address and try again.',
              mediaTypes: {
                VIDEO: 'video',
                IMAGE: 'image',
                generic: 'media'
              }
            }
          }
        },
        sidePanel: {
          googlePhotos: {
            brand1: "Picasa",
            brand2: "Google+",
            placeholder: "Email or Picasa/Google+ ID",
            helpText: "You can add photos uploaded to ${brand1} or ${brand2} to your story. ${helpLinkText} about using images stored in your Google account in your stories.",
            helpLinkText: "Learn more",
            cannotFindUser: "Cannot find user", // Context: "Cannot find user 'johnsmith'."
            tryAgain: "Please try again."
          },
          flickr: {
            // tabs for search type
            searchType: {
              account: "Flickr Account",
              text: "All Flickr"
            },
            // placeholders for text search inputs
            placeholders: {
              user: "Search for account",
              userText: "Search this account for photos",
              text: "Search for photos"
            },
            // error/warning messages
            errors: {
              cannotFindUser: "Cannot find user", // Context: "Cannot find user 'johnsmith'. Did you mean 'John Smith'?"
              noUserPhotos: "does not have any public photos.", // Context: "'helloworld' does not have any public photos. Did you mean 'hello world'?"
              didYouMean: "Did you mean", // Context: "'johnsmith' does not have any public photos. Did you mean 'John Smith'?"
              generalUserError: "Something went wrong when searching for user"
            },
            // licenses
            licenses: {
              public: 'Public Domain',
              commercial: 'OK for Commercial Use',
              nonCommercial: 'OK for Non-Commercial Use',
              reserved: 'All Rights Reserved',
              any: 'Any License'
            }
          },
          agol: {
            searchLocation: {
              thisStory: "This Story",
              agol: "ArcGIS Online",
              myOrg: "Organization", // context: "<Org Name> Organization"
              myContent: "My Content"
            },
            createContent: {
              or: "OR",
              dragAndDrop: "Drop image(s) here",
              uploadImage: "Browse for image(s)",
              agolInfo: "Images will be stored in your ArcGIS account and accessible inside your story.",
              saveBeforeUpload: "Once you save this story, you can upload images to ArcGIS here.",
              fileTypes: "Supported file types:",
              listSeparator: ","
            },
            filterAndSort: {
              webmap: "Web Map",
              webscene: "Web Scene",
              image: "Image",
              date: "Date",
              title: "Title",
              views: "Views",
              search: "Search by keyword or ID"
            }
          }
        }
      }
    }
  },
  "ar": 1,
  "cs": 1,
  "da": 1,
  "de": 1,
  "el": 1,
  "es": 1,
  "et": 1,
  "fi": 1,
  "fr": 1,
  "he": 1,
  "hr": 1,
  "it": 1,
  "ja": 1,
  "ko": 1,
  "lt": 1,
  "lv": 1,
  "nl": 1,
  "nb": 1,
  "pl": 1,
  "pt-br": 1,
  "pt-pt": 1,
  "ro": 1,
  "ru": 1,
  "sr": 1,
  "sv": 1,
  "th": 1,
  "tr": 1,
  "vi": 1,
  "zh-cn": 1,
  "zh-hk": 1,
  "zh-tw": 1
});



define('lib-build/less!storymaps-react/common/builder/mediaPicker/browseToggle/BrowseToggle',[],function(){});

define('lib-build/css!storymaps-react/common/builder/mediaPicker/browseToggle/BrowseToggle',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browseToggle/BrowseToggle',['module', 'exports', 'react', '../utils/Helper', '../constants', 'lib-build/i18n!../../../_resources/nls/media', 'lib-build/less!./BrowseToggle', 'lib-build/css!./BrowseToggle'], function (module, exports, _react, _Helper, _constants, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _Helper2 = _interopRequireDefault(_Helper);

  var _constants2 = _interopRequireDefault(_constants);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browseToggle;

  var BrowseToggle = function (_React$Component) {
    _inherits(BrowseToggle, _React$Component);

    function BrowseToggle() {
      _classCallCheck(this, BrowseToggle);

      return _possibleConstructorReturn(this, (BrowseToggle.__proto__ || Object.getPrototypeOf(BrowseToggle)).apply(this, arguments));
    }

    _createClass(BrowseToggle, [{
      key: 'getLongerTitleClass',
      value: function getLongerTitleClass(title, length) {
        if (title.length > length) {
          return 'longer-title';
        }
        return '';
      }
    }, {
      key: 'getShrinkableTitle',
      value: function getShrinkableTitle(startingClasses, longCutoff) {
        if (this.props.shortTitle) {
          var shortClasses = 'title-text visible-xs-inline visible-sm-inline ' + this.getLongerTitleClass(this.props.shortTitle, longCutoff);
          var regularClasses = 'title-text hidden-xs hidden-sm ' + this.getLongerTitleClass(this.props.title, longCutoff);
          return _react2.default.createElement(
            'span',
            { className: startingClasses },
            _react2.default.createElement(
              'span',
              { className: shortClasses },
              this.props.shortTitle
            ),
            _react2.default.createElement(
              'span',
              { className: regularClasses },
              this.props.title
            )
          );
        }
        var titleClasses = startingClasses + ' title-text ' + this.getLongerTitleClass(this.props.title, longCutoff);
        return _react2.default.createElement(
          'span',
          { className: titleClasses },
          this.props.title
        );
      }
    }, {
      key: 'getInlineTitle',
      value: function getInlineTitle() {
        return _react2.default.createElement(
          'div',
          { className: 'inline-title' },
          _react2.default.createElement('span', { className: 'fa ' + this.props.inlineIcon }),
          this.getShrinkableTitle('', 12)
        );
      }
    }, {
      key: 'getLogoTitle',
      value: function getLogoTitle() {
        return _react2.default.createElement('div', { className: 'provider-logo', alt: 'this.props.title' });
      }
    }, {
      key: 'getPlainTitle',
      value: function getPlainTitle() {
        return _react2.default.createElement(
          'div',
          null,
          this.getShrinkableTitle('plain-title', 16)
        );
      }
    }, {
      key: 'differentiateTitle',
      value: function differentiateTitle() {
        if (this.props.fullLogo) {
          return this.getLogoTitle();
        }
        if (this.props.inlineIcon) {
          return this.getInlineTitle();
        }
        return this.getPlainTitle();
      }
    }, {
      key: 'render',
      value: function render() {
        var toggleClasses = _Helper2.default.classnames(['browse-toggle', this.props.type, {
          'selected': this.props.isSelected
        }]);

        return _react2.default.createElement(
          'div',
          { className: toggleClasses, onClick: this.props.onClick },
          this.differentiateTitle()
        );
      }
    }]);

    return BrowseToggle;
  }(_react2.default.Component);

  var AuthMediaHeader = function (_React$Component2) {
    _inherits(AuthMediaHeader, _React$Component2);

    function AuthMediaHeader() {
      _classCallCheck(this, AuthMediaHeader);

      return _possibleConstructorReturn(this, (AuthMediaHeader.__proto__ || Object.getPrototypeOf(AuthMediaHeader)).apply(this, arguments));
    }

    _createClass(AuthMediaHeader, [{
      key: 'findText',
      value: function findText(typeConstant) {
        var typeKey = Object.keys(_constants2.default.contentType).find(function (key) {
          return _constants2.default.contentType[key] === typeConstant;
        });
        return text.contentType[typeKey];
      }
    }, {
      key: 'getMediaList',
      value: function getMediaList(mediaCount) {
        var _this3 = this;

        if (!mediaCount) {
          return;
        }

        return this.props.authorizedMedia.map(function (media, i) {
          var suffix = '';
          if (i === mediaCount - 1) {
            suffix = '.';
          } else if (i === mediaCount - 2) {
            suffix = ' ' + text.contentType.OR + ' ';
          } else if (i < mediaCount - 2) {
            suffix = text.contentType.listSeparator + ' ';
          }
          return _this3.findText(media) + suffix;
        }).join('');
      }
    }, {
      key: 'render',
      value: function render() {
        var mediaCount = this.props.authorizedMedia ? this.props.authorizedMedia.length : null;
        if (mediaCount === Object.keys(_constants2.default.contentType).length) {
          return null;
        }
        return _react2.default.createElement(
          'div',
          { className: 'mp-type-message' },
          _react2.default.createElement(
            'span',
            { className: 'mp-type-details info', style: { display: mediaCount ? 'inline' : 'none' } },
            _react2.default.createElement('span', { className: 'fa fa-info-circle' }),
            _react2.default.createElement(
              'span',
              null,
              text.contentType.starter
            ),
            _react2.default.createElement(
              'span',
              null,
              this.getMediaList(mediaCount)
            )
          ),
          _react2.default.createElement(
            'span',
            { className: 'mp-type-error error', style: { display: mediaCount ? 'none' : 'inline' } },
            _react2.default.createElement('span', { className: 'fa fa-warning' }),
            _react2.default.createElement(
              'span',
              null,
              text.contentType.error
            )
          )
        );
      }
    }]);

    return AuthMediaHeader;
  }(_react2.default.Component);

  var BrowseToggles = function (_React$Component3) {
    _inherits(BrowseToggles, _React$Component3);

    function BrowseToggles() {
      _classCallCheck(this, BrowseToggles);

      return _possibleConstructorReturn(this, (BrowseToggles.__proto__ || Object.getPrototypeOf(BrowseToggles)).apply(this, arguments));
    }

    _createClass(BrowseToggles, [{
      key: 'getDivider',
      value: function getDivider(i) {
        if (i < this.props.browseToggles.length - 1) {
          return _react2.default.createElement('div', { className: 'vert-divider', key: 'divider-' + i });
        }
        return null;
      }
    }, {
      key: 'renderBrowseToggles',
      value: function renderBrowseToggles() {
        var _this5 = this;

        var elArr = [];
        this.props.browseToggles.forEach(function (browseToggle, i) {
          elArr.push(_react2.default.createElement(BrowseToggle, _extends({
            onClick: function onClick() {
              _this5.props.selectProvider(browseToggle.type);
            },
            key: browseToggle.type,
            isLast: i === _this5.props.browseToggles.length - 1,
            isSelected: browseToggle.type === _this5.props.browseSelectedProvider
          }, browseToggle)));
          var divider = _this5.getDivider(i);
          if (divider) {
            elArr.push(divider);
          }
        });
        return elArr;
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'mp-header' },
          _react2.default.createElement(AuthMediaHeader, {
            authorizedMedia: this.props.authorizedMedia
          }),
          _react2.default.createElement(
            'div',
            { className: 'mp-browse-toggles' },
            this.renderBrowseToggles()
          )
        );
      }
    }]);

    return BrowseToggles;
  }(_react2.default.Component);

  exports.default = BrowseToggles;
  module.exports = exports['default'];
});
//# sourceMappingURL=BrowseToggle.js.map
;
define('storymaps-react/common/builder/mediaPicker/actions',['exports', './actionTypes'], function (exports, _actionTypes) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.selectProvider = selectProvider;

  var types = _interopRequireWildcard(_actionTypes);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function selectProvider(provider) {
    return {
      type: types.BROWSE_SELECT_PROVIDER,
      value: provider
    };
  }
});
//# sourceMappingURL=actions.js.map
;
define('storymaps-react/common/builder/mediaPicker/browseToggle/BrowseToggleContainer',['module', 'exports', 'react-redux', './BrowseToggle', './../actions', 'lib-build/i18n!../../../_resources/nls/media'], function (module, exports, _reactRedux, _BrowseToggle, _actions, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _BrowseToggle2 = _interopRequireDefault(_BrowseToggle);

  var actions = _interopRequireWildcard(_actions);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var text = _media2.default.mediaPicker.browseToggle;

  var browseToggles = [{
    type: 'arcgis',
    title: text.arcGIS,
    media: 'geo',
    fullLogo: true
  }, {
    type: 'flickr',
    title: text.flickr,
    media: 'images',
    inlineIcon: 'fa-flickr'
  }, {
    type: 'googlePhotos',
    title: text.googlePhotos,
    media: 'images',
    inlineIcon: 'fa-google'
  }, {
    type: 'urlContent',
    title: text.urls,
    shortTitle: text.urls_short,
    media: 'links',
    inlineIcon: 'fa-link'
  }];

  var mapStateToProps = function mapStateToProps(state) {
    return {
      browseSelectedProvider: state.ui.browseSelectedProvider,
      browseToggles: browseToggles
    };
  };

  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    return {
      selectProvider: function selectProvider(provider) {
        dispatch(actions.selectProvider(provider));
      }
    };
  };

  var BrowseToggleContainer = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(_BrowseToggle2.default);

  exports.default = BrowseToggleContainer;
  module.exports = exports['default'];
});
//# sourceMappingURL=BrowseToggleContainer.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/actions',['exports', './actionTypes'], function (exports, _actionTypes) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.updateAlbums = updateAlbums;
  exports.updateAlbumFetchStatus = updateAlbumFetchStatus;
  exports.updateImageFetchStatus = updateImageFetchStatus;
  exports.updateUsername = updateUsername;
  exports.updateDisplayedContent = updateDisplayedContent;
  exports.updateImages = updateImages;
  exports.updateSelectedAlbum = updateSelectedAlbum;
  exports.updateSearchType = updateSearchType;
  exports.updateUserSearchTerm = updateUserSearchTerm;
  exports.updatePhotoSearchTerm = updatePhotoSearchTerm;
  exports.updateUserLicense = updateUserLicense;
  exports.updatePhotoLicense = updatePhotoLicense;
  exports.updateSearchLocation = updateSearchLocation;
  exports.updateSearchTerm = updateSearchTerm;
  exports.updateSortField = updateSortField;
  exports.updateSortOrder = updateSortOrder;

  var types = _interopRequireWildcard(_actionTypes);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function updateAlbums(albumObj) {
    return {
      type: types.UPDATE_ALBUMS,
      value: albumObj
    };
  }

  function updateAlbumFetchStatus(statusObj) {
    return {
      type: types.UPDATE_ALBUM_FETCH_STATUS,
      value: statusObj
    };
  }

  function updateImageFetchStatus(statusObj) {
    return {
      type: types.UPDATE_IMAGE_FETCH_STATUS,
      value: statusObj
    };
  }

  function updateUsername(usernameObj) {
    return {
      type: types.UPDATE_USERNAME,
      value: usernameObj
    };
  }

  function updateDisplayedContent(displayedContentObj) {
    return {
      type: types.UPDATE_DISPLAYED_CONTENT,
      value: displayedContentObj
    };
  }

  function updateImages(imagesObj) {
    return {
      type: types.UPDATE_IMAGES,
      value: imagesObj
    };
  }

  function updateSelectedAlbum(selectedAlbumObj) {
    return {
      type: types.UPDATE_SELECTED_ALBUM,
      value: selectedAlbumObj
    };
  }

  function updateSearchType(searchType) {
    return {
      type: types.UPDATE_SEARCH_TYPE,
      value: searchType
    };
  }

  function updateUserSearchTerm(searchTerm) {
    return {
      type: types.UPDATE_USER_SEARCH_TERM,
      value: searchTerm
    };
  }

  function updatePhotoSearchTerm(searchTerm) {
    return {
      type: types.UPDATE_PHOTO_SEARCH_TERM,
      value: searchTerm
    };
  }

  function updateUserLicense(license) {
    return {
      type: types.UPDATE_USER_LICENSE,
      value: license
    };
  }

  function updatePhotoLicense(license) {
    return {
      type: types.UPDATE_PHOTO_LICENSE,
      value: license
    };
  }

  function updateSearchLocation(location) {
    return {
      type: types.UPDATE_SEARCH_LOCATION,
      value: location
    };
  }

  function updateSearchTerm(term) {
    return {
      type: types.UPDATE_SEARCH_TERM,
      value: term
    };
  }

  function updateSortField(field) {
    return {
      type: types.UPDATE_SORT_FIELD,
      value: field
    };
  }

  function updateSortOrder(order) {
    return {
      type: types.UPDATE_SORT_ORDER,
      value: order
    };
  }
});
//# sourceMappingURL=actions.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/breadcrumbs/Breadcrumbs',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/breadcrumbs/Breadcrumbs',['module', 'exports', 'react', 'lib-build/less!./Breadcrumbs'], function (module, exports, _react) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function Breadcrumbs(props) {
    var showCrumbs = function showCrumbs() {
      return props.crumbs.map(function (crumb) {
        var onItemClick = function onItemClick() {
          props.onClick({
            link: crumb.link
          });
        };

        if (crumb.active) {
          return _react2.default.createElement(
            'li',
            {
              key: crumb.id,
              onClick: onItemClick,
              className: 'active'
            },
            crumb.title
          );
        } else {
          return _react2.default.createElement(
            'li',
            {
              key: crumb.id,
              onClick: onItemClick
            },
            _react2.default.createElement(
              'a',
              null,
              crumb.title
            )
          );
        }
      });
    };

    return _react2.default.createElement(
      'div',
      { className: 'row flex-static', style: props.crumbs && props.crumbs.length ? null : { display: 'none' } },
      _react2.default.createElement(
        'ol',
        { className: 'breadcrumb' },
        showCrumbs()
      )
    );
  }

  exports.default = Breadcrumbs;
  module.exports = exports['default'];
});
//# sourceMappingURL=Breadcrumbs.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/breadcrumbs/BreadcrumbModel',['module', 'exports'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _class = function _class(title, link, displayedContent) {
    _classCallCheck(this, _class);

    this.id = title + '-' + link;
    this.title = title;
    this.link = link;
    this.active = this.link === displayedContent;
  };

  exports.default = _class;
  module.exports = exports['default'];
});
//# sourceMappingURL=BreadcrumbModel.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/breadcrumbs/AGOLHeader',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/breadcrumbs/AGOLHeader',['module', 'exports', 'react', '../../constants', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./AGOLHeader'], function (module, exports, _react, _constants, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _constants2 = _interopRequireDefault(_constants);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.sidePanel.agol;

  /*
  class CompoundMediaIcon extends React.Component {
    render() {
      return (
        <span className="compound-media fa fa-stack">
          <i className="fa fa-picture-o fa-stack-1x" />
          <i className="fa fa-circle fa-stack-2x" />
          <i className="fa fa-globe fa-stack-2x" />
          <CompoundMapIcon />
        </span>
      );
    }
  }
  */

  var CompoundMapIcon = function (_React$Component) {
    _inherits(CompoundMapIcon, _React$Component);

    function CompoundMapIcon() {
      _classCallCheck(this, CompoundMapIcon);

      return _possibleConstructorReturn(this, (CompoundMapIcon.__proto__ || Object.getPrototypeOf(CompoundMapIcon)).apply(this, arguments));
    }

    _createClass(CompoundMapIcon, [{
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'span',
          { className: 'compound-map fa fa-stack' },
          _react2.default.createElement('i', { className: 'fa fa-map fa-inverse fa-stack-1x' }),
          _react2.default.createElement('i', { className: 'fa fa-map-o fa-stack-1x' }),
          _react2.default.createElement('i', { className: 'fa fa-circle fa-stack-1x auto-dim' }),
          _react2.default.createElement('i', { className: 'fa fa-map-marker fa-stack-1x auto-dim' })
        );
      }
    }]);

    return CompoundMapIcon;
  }(_react2.default.Component);

  var FilterToggle = function (_React$Component2) {
    _inherits(FilterToggle, _React$Component2);

    function FilterToggle() {
      _classCallCheck(this, FilterToggle);

      return _possibleConstructorReturn(this, (FilterToggle.__proto__ || Object.getPrototypeOf(FilterToggle)).apply(this, arguments));
    }

    _createClass(FilterToggle, [{
      key: 'getIconSpan',
      value: function getIconSpan() {
        if (this.props.value === _constants2.default.contentType.WEBMAP) {
          return _react2.default.createElement(CompoundMapIcon, null);
        }
        return (
          // <CompoundMediaIcon />
          _react2.default.createElement('span', { className: 'fa fa-' + this.props.icon })
        );
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'label',
          {
            className: 'btn btn-clear' + (this.props.checked ? ' active' : ''),
            tabIndex: '4',
            htmlFor: this.props.id,
            onKeyPress: this.props.onClick // keyboard navigation
            , onClick: this.props.onClick },
          this.getIconSpan(),
          _react2.default.createElement('span', { className: 'fa fa-check floating-check' }),
          _react2.default.createElement('input', {
            tabIndex: '-1',
            onChange: this.props.onClick,
            checked: this.props.checked,
            type: 'checkbox',
            name: 'contentType',
            value: this.props.value,
            id: this.props.id })
        );
      }
    }]);

    return FilterToggle;
  }(_react2.default.Component);

  var FilterToggles = function (_React$Component3) {
    _inherits(FilterToggles, _React$Component3);

    function FilterToggles() {
      _classCallCheck(this, FilterToggles);

      return _possibleConstructorReturn(this, (FilterToggles.__proto__ || Object.getPrototypeOf(FilterToggles)).apply(this, arguments));
    }

    _createClass(FilterToggles, [{
      key: 'thisOnClick',
      value: function thisOnClick(evt) {
        if (evt.charCode + 0 === evt.charCode) {
          if (evt.charCode !== 13) {
            return;
          }
          $(evt.currentTarget).toggleClass('active');
        }
        var activeToggles = $(evt.currentTarget.parentElement).find('.active input');
        if (!activeToggles.length) {
          this.props.onKeyPress([]);
          return;
        }
        var contentTypes = activeToggles.map(function (i, node) {
          return node.value;
        }).get();
        this.props.onKeyPress(contentTypes);
      }
    }, {
      key: 'isSelected',
      value: function isSelected(contentType) {
        return this.props.selectedTypes.indexOf(contentType) >= 0 && this.props.availTypes.indexOf(contentType) >= 0;
      }
    }, {
      key: 'renderToggle',
      value: function renderToggle(contentType) {
        var _this4 = this;

        var iconClass = void 0;
        switch (contentType) {
          case _constants2.default.contentType.WEBMAP:
            iconClass = null;
            break;
          case _constants2.default.contentType.WEBSCENE:
            iconClass = 'globe fa-2x';
            break;
          case _constants2.default.contentType.IMAGE:
            iconClass = 'picture-o fa-2x';
            break;
          case _constants2.default.contentType.VIDEO:
            iconClass = 'video-camera fa-2x';
            break;
          case _constants2.default.contentType.AUDIO:
            iconClass = 'volume-up fa-2x';
            break;
          default:
            console.warn('unknown toggle type', contentType);
            return null;
        }
        return _react2.default.createElement(FilterToggle, {
          id: 'agol-' + contentType,
          key: 'agol-' + contentType,
          icon: iconClass,
          onClick: function onClick(evt) {
            return _this4.thisOnClick(evt);
          },
          value: contentType,
          label: text.filterAndSort[contentType],
          checked: this.isSelected(contentType)
        });
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'filter-toggle btn-group', 'data-toggle': 'buttons' },
          this.props.availTypes.map(this.renderToggle.bind(this))
        );
      }
    }]);

    return FilterToggles;
  }(_react2.default.Component);

  var VerticalDivider = function (_React$Component4) {
    _inherits(VerticalDivider, _React$Component4);

    function VerticalDivider() {
      _classCallCheck(this, VerticalDivider);

      return _possibleConstructorReturn(this, (VerticalDivider.__proto__ || Object.getPrototypeOf(VerticalDivider)).apply(this, arguments));
    }

    _createClass(VerticalDivider, [{
      key: 'render',
      value: function render() {
        return _react2.default.createElement('div', { className: 'vert-divider' });
      }
    }]);

    return VerticalDivider;
  }(_react2.default.Component);

  var CalendarSortIcon = function (_React$Component5) {
    _inherits(CalendarSortIcon, _React$Component5);

    function CalendarSortIcon() {
      _classCallCheck(this, CalendarSortIcon);

      return _possibleConstructorReturn(this, (CalendarSortIcon.__proto__ || Object.getPrototypeOf(CalendarSortIcon)).apply(this, arguments));
    }

    _createClass(CalendarSortIcon, [{
      key: 'getSortClass',
      value: function getSortClass() {
        return 'fa-angle-' + (this.props.order === _constants2.default.sortOrder.ASC ? 'up' : 'down');
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'span',
          { className: 'fa fa-stack calendar-sort' },
          _react2.default.createElement('i', { className: 'fa fa-stack-1x fa-lg fa-calendar-o' }),
          _react2.default.createElement('i', { className: 'fa fa-stack-1x ' + this.getSortClass() })
        );
      }
    }]);

    return CalendarSortIcon;
  }(_react2.default.Component);

  var AlphaSortIcon = function (_React$Component6) {
    _inherits(AlphaSortIcon, _React$Component6);

    function AlphaSortIcon() {
      _classCallCheck(this, AlphaSortIcon);

      return _possibleConstructorReturn(this, (AlphaSortIcon.__proto__ || Object.getPrototypeOf(AlphaSortIcon)).apply(this, arguments));
    }

    _createClass(AlphaSortIcon, [{
      key: 'getSortClass',
      value: function getSortClass() {
        return 'fa-sort-alpha-' + (this.props.order === _constants2.default.sortOrder.ASC ? 'asc' : 'desc');
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement('span', { className: 'fa inline ' + this.getSortClass() });
      }
    }]);

    return AlphaSortIcon;
  }(_react2.default.Component);

  var SortToggle = function (_React$Component7) {
    _inherits(SortToggle, _React$Component7);

    function SortToggle() {
      _classCallCheck(this, SortToggle);

      return _possibleConstructorReturn(this, (SortToggle.__proto__ || Object.getPrototypeOf(SortToggle)).apply(this, arguments));
    }

    _createClass(SortToggle, [{
      key: 'getSortIcon',
      value: function getSortIcon() {
        switch (this.props.value) {
          case _constants2.default.sortField.DATE:
            return _react2.default.createElement(CalendarSortIcon, { order: this.props.order });
          case _constants2.default.sortField.TITLE:
            return _react2.default.createElement(AlphaSortIcon, { order: this.props.order });
        }
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'label',
          {
            className: 'btn btn-clear' + (this.props.checked ? ' active' : ''),
            tabIndex: '5',
            htmlFor: this.props.id,
            onKeyPress: this.props.onClick,
            onClick: this.props.onClick },
          this.getSortIcon(),
          _react2.default.createElement(
            'span',
            { className: 'btn-label' },
            this.props.label
          ),
          _react2.default.createElement('input', {
            onChange: this.props.onClick,
            checked: this.props.checked,
            type: 'radio',
            name: 'contentType',
            value: this.props.value,
            id: this.props.id })
        );
      }
    }]);

    return SortToggle;
  }(_react2.default.Component);

  var SortToggles = function (_React$Component8) {
    _inherits(SortToggles, _React$Component8);

    function SortToggles() {
      _classCallCheck(this, SortToggles);

      return _possibleConstructorReturn(this, (SortToggles.__proto__ || Object.getPrototypeOf(SortToggles)).apply(this, arguments));
    }

    _createClass(SortToggles, [{
      key: 'thisOnClick',
      value: function thisOnClick(evt, sortField, sortOrder) {
        if (evt.charCode + 0 === evt.charCode && evt.charCode !== 13) {
          return;
        }

        if (sortField === this.props.sortField) {
          var newSortOrder = this.switchSortOrder(sortOrder);
          this.props.onKeyPress.sortOrderChange(newSortOrder, sortField);
          return;
        }
        this.props.onKeyPress.sortFieldChange(sortField, sortOrder);
      }
    }, {
      key: 'switchSortOrder',
      value: function switchSortOrder(currentOrder) {
        if (currentOrder === _constants2.default.sortOrder.ASC) {
          return _constants2.default.sortOrder.DESC;
        }
        return _constants2.default.sortOrder.ASC;
      }
    }, {
      key: 'isSelected',
      value: function isSelected(field) {
        return this.props.sortField === _constants2.default.sortField[field];
      }
    }, {
      key: 'render',
      value: function render() {
        var _this10 = this;

        return _react2.default.createElement(
          'div',
          { className: 'sort-toggle btn-group', 'data-toggle': 'buttons' },
          _react2.default.createElement(SortToggle, {
            id: 'date-sort',
            onClick: function onClick(evt) {
              return _this10.thisOnClick(evt, _constants2.default.sortField.DATE, _this10.props.sortOrder.date);
            },
            value: _constants2.default.sortField.DATE,
            checked: this.isSelected('DATE'),
            order: this.props.sortOrder.date,
            label: text.filterAndSort.date
          }),
          _react2.default.createElement(SortToggle, {
            id: 'title-sort',
            onClick: function onClick(evt) {
              return _this10.thisOnClick(evt, _constants2.default.sortField.TITLE, _this10.props.sortOrder.title);
            },
            value: _constants2.default.sortField.TITLE,
            checked: this.isSelected('TITLE'),
            order: this.props.sortOrder.title,
            label: text.filterAndSort.title
          })
        );
      }
    }]);

    return SortToggles;
  }(_react2.default.Component);

  var AGOLHeader = function (_React$Component9) {
    _inherits(AGOLHeader, _React$Component9);

    function AGOLHeader() {
      _classCallCheck(this, AGOLHeader);

      return _possibleConstructorReturn(this, (AGOLHeader.__proto__ || Object.getPrototypeOf(AGOLHeader)).apply(this, arguments));
    }

    _createClass(AGOLHeader, [{
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'agol-header' },
          _react2.default.createElement(FilterToggles, {
            availTypes: this.props.containerState.availableContentTypes,
            selectedTypes: this.props.containerState.selectedContentTypes,
            onKeyPress: this.props.onKeyPress.selectedContentTypesChange
          }),
          _react2.default.createElement(VerticalDivider, null),
          _react2.default.createElement(SortToggles, {
            onKeyPress: this.props.onKeyPress,
            sortField: this.props.sortField,
            sortOrder: {
              date: this.props.containerState.dateSortOrder,
              title: this.props.containerState.titleSortOrder
            }
          })
        );
      }
    }]);

    return AGOLHeader;
  }(_react2.default.Component);

  exports.default = AGOLHeader;
  module.exports = exports['default'];
});
//# sourceMappingURL=AGOLHeader.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/gallery/GalleryItem',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/gallery/GalleryItem',['module', 'exports', 'react', './../../constants', '../../utils/Helper', 'dojo/topic', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./GalleryItem'], function (module, exports, _react, _constants, _Helper, _topic, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _constants2 = _interopRequireDefault(_constants);

  var _Helper2 = _interopRequireDefault(_Helper);

  var _topic2 = _interopRequireDefault(_topic);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.providers.galleryItems;

  var GalleryItemDiv = function (_React$Component) {
    _inherits(GalleryItemDiv, _React$Component);

    function GalleryItemDiv() {
      _classCallCheck(this, GalleryItemDiv);

      return _possibleConstructorReturn(this, (GalleryItemDiv.__proto__ || Object.getPrototypeOf(GalleryItemDiv)).call(this));
    }

    _createClass(GalleryItemDiv, [{
      key: 'getIconSpan',
      value: function getIconSpan(iconClass) {
        return _react2.default.createElement('span', { className: 'fa fa-lg fa-' + iconClass });
      }
    }, {
      key: 'getTextClass',
      value: function getTextClass(str) {
        if (!str) {
          return null;
        }
        var breakTest = str.match(/\s|\-/);
        if (!breakTest || breakTest.index > 12) {
          return 'break-all';
        }
        return null;
      }
    }, {
      key: 'getHoverText',
      value: function getHoverText() {
        var mod = this.props.item.modified;
        var dateStr = mod && mod.toLocaleDateString ? mod.toLocaleDateString() : mod ? mod : '';
        if (dateStr) {
          if (this.props.item.agolType && dateStr) {
            dateStr = text.modified + ' ' + dateStr;
          } else {
            dateStr = text.uploaded + ' ' + dateStr;
          }
        }
        var ownerStr = this.props.item.owner && this.props.showOwner ? text.by + ' ' + this.props.item.owner : '';
        var popoverClass = this.props.item.usedInStory === false ? 'unused' : null;

        var strArr = ['<div ' + (popoverClass ? 'class="' + popoverClass + '"' : '') + '>', '<span class="item-popover-title">' + this.props.title + '</span>', '<br>', this.props.item.displayName, ownerStr, '<br>', dateStr, '</div>'];

        if (this.props.item.snippet) {
          strArr.push('<br>', this.props.item.snippet);
        }
        return strArr.join(' ');
      }
    }, {
      key: 'getImgDiv',
      value: function getImgDiv() {
        if (this.props.hasError) {
          return _react2.default.createElement(
            'div',
            { className: 'img-wrapper load-error' },
            _react2.default.createElement(
              'div',
              { className: 'alert alert-danger' },
              _react2.default.createElement('span', { className: 'fa fa-exclamation-triangle text-danger' }),
              _react2.default.createElement('br', null),
              _react2.default.createElement(
                'span',
                { className: 'text-danger' },
                text.uploadError
              ),
              this.getDeleteButton()
            )
          );
        }
        if (this.props.showPopupDescription) {
          return _react2.default.createElement(
            'div',
            { className: 'img-wrapper' },
            _react2.default.createElement('img', {
              'data-toggle': 'popover',
              'data-trigger': 'hover',
              'data-html': 'true',
              'data-placement': 'left',
              'data-content': this.getHoverText(),
              src: this.props.thumbUrl }),
            this.getLoading(),
            this.getDeleteButton()
          );
        }
        return _react2.default.createElement('img', { src: this.props.thumbUrl });
      }
    }, {
      key: 'getDeleteButton',
      value: function getDeleteButton() {
        var _this2 = this;

        if (this.props.onItemDelete && this.props.item.usedInStory === false) {
          return _react2.default.createElement(
            'span',
            {
              className: 'remove',
              onClick: function onClick(evt) {
                return _this2.props.onItemDelete(evt, _this2.props.item);
              },
              'data-toggle': 'popover',
              'data-trigger': 'hover',
              'data-placement': 'left',
              'data-html': 'true',
              'data-content': this.getDeleteHoverText() },
            _react2.default.createElement('span', { className: 'fa fa-trash' })
          );
        }
        return null;
      }
    }, {
      key: 'getDeleteHoverText',
      value: function getDeleteHoverText() {
        if (this.props.item.error) {
          return text.removeFailed;
        }
        return text.remove1 + ' ' + text.remove2;
      }
    }, {
      key: 'getLoading',
      value: function getLoading() {
        if (this.props.loading) {
          return _react2.default.createElement('span', { className: 'small-loader' });
        }
        return null;
      }
    }, {
      key: 'render',
      value: function render() {
        var combinedClasses = _Helper2.default.classnames([this.props.startingClasses, 'mp-gallery-item']);
        var iconSpan = this.props.iconClass ? this.getIconSpan(this.props.iconClass) : null;

        return _react2.default.createElement(
          'div',
          {
            onClick: this.props.onClick,
            className: combinedClasses,
            style: this.props.computedStyle },
          this.getImgDiv(),
          _react2.default.createElement(
            'div',
            { className: 'title' },
            iconSpan,
            _react2.default.createElement(
              'span',
              { className: this.getTextClass(this.props.title) },
              this.props.title
            )
          )
        );
      }
    }]);

    return GalleryItemDiv;
  }(_react2.default.Component);

  function GalleryItem(props) {
    var onAlbumClicked = function onAlbumClicked() {
      props.onAlbumClicked({
        id: props.item.id,
        title: props.item.title
      });
    };

    var onImageClicked = function onImageClicked() {
      if (props.item.getPicUrl) {
        // getPicUrl should return a result with width, height, and url,
        // no matter what. if the network request fails, getPicUrl should
        // still resolve with the original item width, height, url.
        props.item.getPicUrl(props.item).then(function (result) {
          _topic2.default.publish('MEDIA-PICKER-SELECTION', Object.assign(result, { type: 'image' }));
        });
        return;
      }
      _topic2.default.publish('MEDIA-PICKER-SELECTION', {
        type: 'image',
        width: props.item.width,
        height: props.item.height,
        url: props.item.picUrl,
        thumbUrl: props.item.thumbUrl
      });
    };

    var onItemClicked = function onItemClicked() {
      var itemType = props.item.type;
      var selection = { type: itemType };
      if (itemType === 'image') {
        Object.assign(selection, {
          url: props.item.picUrl,
          thumbUrl: props.item.thumbUrl
        });
      } else {
        Object.assign(selection, {
          id: props.item.id
        });
      }
      _topic2.default.publish('MEDIA-PICKER-SELECTION', selection);
    };

    var showItemContents = function showItemContents() {
      switch (props.type) {
        case _constants2.default.galleryContent.ALBUMS:
          return showAlbums();
        case _constants2.default.galleryContent.IMAGES:
          return showImages();
        case _constants2.default.galleryContent.AGOL:
          return showItems();
        default:
          return null;
      }
    };

    var getAlbumStyle = function getAlbumStyle() {
      return {
        width: _constants2.default.galleryContent.ALBUM_HEIGHT + 'px'
      };
    };

    var getImgStyle = function getImgStyle(item) {
      var computedWidth;
      if (item.thumbWidth && item.thumbHeight) {
        var scaleFactor = _constants2.default.galleryContent.IMG_HEIGHT / parseInt(item.thumbHeight, 10);
        computedWidth = parseInt(item.thumbWidth, 10) * scaleFactor + 'px';
      }
      return {
        width: computedWidth || 'auto',
        maxWidth: computedWidth ? null : _constants2.default.galleryContent.IMG_HEIGHT * 1.5 + 'px'
      };
    };

    var getItemIcon = function getItemIcon(item) {
      switch (item.type) {
        case _constants2.default.contentType.WEBMAP:
          return 'map-o';
        case _constants2.default.contentType.WEBSCENE:
          return 'globe fa-2x';
        case _constants2.default.contentType.IMAGE:
          return 'picture-o';
        default:
          return 'star';
      }
    };

    var showAlbums = function showAlbums() {
      return _react2.default.createElement(GalleryItemDiv, {
        thumbUrl: props.item.tokenizedThumbUrl || props.item.thumbUrl || props.item.thumbnail,
        title: props.item.name || props.item.title,
        onClick: onAlbumClicked,
        startingClasses: 'album',
        computedStyle: getAlbumStyle(),
        showPopupDescription: false
      });
    };

    var showImages = function showImages() {
      return _react2.default.createElement(GalleryItemDiv, {
        thumbUrl: props.item.tokenizedThumbUrl || props.item.thumbUrl || props.item.thumbnail,
        title: props.item.name || props.item.title,
        onClick: onImageClicked,
        startingClasses: 'image',
        computedStyle: getImgStyle(props.item),
        showPopupDescription: false
      });
    };

    var getItemThumbUrl = function getItemThumbUrl(item) {
      return item.dataUrl || item.tokenizedThumbUrl || item.thumbUrl || item.thumbnail;
    };

    var showItems = function showItems() {
      var startingClasses = _Helper2.default.classnames(['image', {
        'unused': props.item.usedInStory === false,
        'loading': props.item.isTemp
      }]);
      return _react2.default.createElement(GalleryItemDiv, {
        thumbUrl: getItemThumbUrl(props.item),
        loading: props.item.isTemp,
        hasError: props.item.error,
        title: props.item.name || props.item.title,
        onItemDelete: props.item.isTemp ? null : props.onItemDelete,
        onClick: props.item.error || props.item.isTemp ? null : onItemClicked,
        startingClasses: startingClasses,
        computedStyle: getImgStyle(props.item),
        iconClass: getItemIcon(props.item),
        showPopupDescription: true,
        showOwner: props.showOwner,
        item: props.item
      });
    };

    var itemContents = showItemContents();

    return itemContents;
  }

  exports.default = GalleryItem;
  module.exports = exports['default'];
});
//# sourceMappingURL=GalleryItem.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/gallery/Gallery',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/gallery/Gallery',['module', 'exports', 'react', 'react-dom', '../../utils/Helper', './GalleryItem', '../../constants', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./Gallery'], function (module, exports, _react, _reactDom, _Helper, _GalleryItem, _constants, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _Helper2 = _interopRequireDefault(_Helper);

  var _GalleryItem2 = _interopRequireDefault(_GalleryItem);

  var _constants2 = _interopRequireDefault(_constants);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel;

  function Spinner() {
    return _react2.default.createElement('div', { className: 'small-loader', role: 'alert' });
  }

  function Alert(props) {
    return _react2.default.createElement(
      'div',
      { className: 'alert alert-danger', role: 'alert' },
      _react2.default.createElement(
        'span',
        null,
        props.text
      )
    );
  }

  var Placeholder = function (_React$Component) {
    _inherits(Placeholder, _React$Component);

    function Placeholder() {
      _classCallCheck(this, Placeholder);

      return _possibleConstructorReturn(this, (Placeholder.__proto__ || Object.getPrototypeOf(Placeholder)).apply(this, arguments));
    }

    _createClass(Placeholder, [{
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'placeholder' },
          this.props.text
        );
      }
    }]);

    return Placeholder;
  }(_react2.default.Component);

  var Gallery = function (_React$Component2) {
    _inherits(Gallery, _React$Component2);

    function Gallery() {
      _classCallCheck(this, Gallery);

      return _possibleConstructorReturn(this, (Gallery.__proto__ || Object.getPrototypeOf(Gallery)).call(this));
    }

    _createClass(Gallery, [{
      key: 'componentDidUpdate',
      value: function componentDidUpdate() {
        // attach popovers to gallery container because items are position: relative
        // and popovers break or get hidden under the sidepanel with position: relative
        var thisDomNode = $(_reactDom2.default.findDOMNode(this));
        $('.mp-gallery img[data-toggle="popover"]').popover({
          container: thisDomNode,
          delay: { show: 500, hide: 200 }
        });
        $('.mp-gallery .remove[data-toggle="popover"]').popover({
          container: thisDomNode,
          delay: { show: 750, hide: 200 },
          template: '<div class="popover remove" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>'
        });

        // scroll to the top of the container if there are no items
        // (this happens not only when there are actually no items to display,
        // but also right before there's a new set of items to display)
        if (!this.props.items || !this.props.items.length) {
          if (typeof thisDomNode.scrollTop === 'function') {
            thisDomNode.scrollTop(0);
          } else {
            thisDomNode.scrollTop = 0;
          }
        }
      }
    }, {
      key: 'renderItems',
      value: function renderItems() {
        var _this3 = this;

        if (!this.props.items || !this.props.items.length) {
          return null;
        }

        return this.props.items.map(function (item) {
          return _react2.default.createElement(_GalleryItem2.default, {
            key: item.id,
            item: item,
            showOwner: _this3.props.providerProps && _this3.props.providerProps.searchLocation !== _constants2.default.searchLocation.MINE,
            onItemDelete: _this3.props.onItemDelete,
            onAlbumClicked: _this3.props.onAlbumClicked,
            type: _this3.props.displayedContent
          });
        });
      }
    }, {
      key: 'renderLimit',
      value: function renderLimit() {
        if (this.props.displayedContent !== _constants2.default.galleryContent.AGOL) {
          return;
        }
        if (!this.props.items || this.props.items.length < 100 || this.props.providerProps.searchLocation === _constants2.default.searchLocation.STORY) {
          return;
        }
        return _react2.default.createElement(
          'div',
          { className: 'alert alert-info limit-reached' },
          text.providers.limitReached
        );
      }
    }, {
      key: 'getSpinner',
      value: function getSpinner() {
        // albums displayed and loading, or images displayed and loading.
        if (this.props.displayedContent === _constants2.default.galleryContent.ALBUMS && this.props.providerProps.albumFetchStatus === _constants2.default.fetchStatus.FETCHING || this.props.displayedContent === _constants2.default.galleryContent.IMAGES && this.props.providerProps.imageFetchStatus === _constants2.default.fetchStatus.FETCHING || this.props.displayedContent === _constants2.default.galleryContent.AGOL && this.props.providerProps.imageFetchStatus === _constants2.default.fetchStatus.FETCHING) {
          return _react2.default.createElement(Spinner, null);
        }
        return null;
      }
    }, {
      key: 'getAlert',
      value: function getAlert() {
        if (this.props.items && this.props.items.length) {
          return null;
        }
        // image loading success but not images found.
        if (this.props.displayedContent === _constants2.default.galleryContent.IMAGES && this.props.providerProps.imageFetchStatus === _constants2.default.fetchStatus.SUCCESS) {
          return _react2.default.createElement(Alert, { text: text.providers.noPhotosFound });
        }
        if (this.props.displayedContent === _constants2.default.galleryContent.AGOL && this.props.providerProps.imageFetchStatus === _constants2.default.fetchStatus.SUCCESS) {
          if (this.props.providerProps.searchLocation === _constants2.default.searchLocation.STORY && !this.props.containerState.storyResourceCount) {
            return _react2.default.createElement(Alert, { text: text.providers.noItemsInThisStory });
          }
          return _react2.default.createElement(Alert, { text: text.providers.noItemsFound });
        }
        return null;
      }
    }, {
      key: 'getPlaceholder',
      value: function getPlaceholder() {
        if (this.props.items && this.props.items.length) {
          return null;
        }
        if (this.props && this.props.containerState && this.props.containerState.provider) {
          return _react2.default.createElement(Placeholder, { text: text.providers[this.props.containerState.provider].searchAndBrowse || '' });
        }
        return null;
      }
    }, {
      key: 'render',
      value: function render() {
        // get these items first, because we need to add .centered and
        // possibly .flex-grow to mp-gallery.
        var spinner = this.getSpinner();
        var alert = this.getAlert();
        var placeholder = alert || spinner ? null : this.getPlaceholder();
        var hasItems = !spinner && !alert && !placeholder;
        var galleryClasses = _Helper2.default.classnames(['row', 'mp-gallery', {
          'centered': !hasItems,
          'flex-grow': placeholder
        }]);
        return _react2.default.createElement(
          'div',
          { className: galleryClasses },
          spinner || alert || placeholder,
          hasItems ? this.renderItems() : null,
          hasItems ? this.renderLimit() : null
        );
      }
    }]);

    return Gallery;
  }(_react2.default.Component);

  exports.default = Gallery;
  module.exports = exports['default'];
});
//# sourceMappingURL=Gallery.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanel',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/providers/Common',['module', 'exports', 'react', '../../constants', '../breadcrumbs/Breadcrumbs', '../breadcrumbs/BreadcrumbModel', '../breadcrumbs/AGOLHeader', '../gallery/Gallery', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!../sidePanel/SidePanel'], function (module, exports, _react, _constants, _Breadcrumbs, _BreadcrumbModel, _AGOLHeader, _Gallery, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _constants2 = _interopRequireDefault(_constants);

  var _Breadcrumbs2 = _interopRequireDefault(_Breadcrumbs);

  var _BreadcrumbModel2 = _interopRequireDefault(_BreadcrumbModel);

  var _AGOLHeader2 = _interopRequireDefault(_AGOLHeader);

  var _Gallery2 = _interopRequireDefault(_Gallery);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.providers;

  var CommonProvider = function (_React$Component) {
    _inherits(CommonProvider, _React$Component);

    function CommonProvider(props) {
      _classCallCheck(this, CommonProvider);

      var _this = _possibleConstructorReturn(this, (CommonProvider.__proto__ || Object.getPrototypeOf(CommonProvider)).call(this, props));

      _this.onKeyPress = _this.onKeyPress.bind(_this);
      _this.fetchAlbums = _this.fetchAlbums.bind(_this);
      _this.onAlbumClicked = _this.onAlbumClicked.bind(_this);
      _this.determineGalleryItems = _this.determineGalleryItems.bind(_this);
      _this.getBreadcrumbs = _this.getBreadcrumbs.bind(_this);
      _this.onBreadcrumbClicked = _this.onBreadcrumbClicked.bind(_this);
      return _this;
    }

    _createClass(CommonProvider, [{
      key: 'onKeyPress',
      value: function onKeyPress(event) {
        if (event.charCode === 13) {
          this.fetchAlbums();
        }
      }
    }, {
      key: 'fetchAlbums',
      value: function fetchAlbums(name) {
        var _this2 = this;

        // we want this to be static so when username search returns it will  be the same value..
        var userName = name || this.props.searchValue || this.props.containerState.searchValue;

        this.beforeAlbumFetched();
        if (!userName) {
          this.props.updateAlbumFetchStatus({
            fetchStatus: _constants2.default.fetchStatus.ERROR
          });
          return;
        }
        userName = userName.trim();
        this.props.connector.getProviderAlbums(userName).then(function (results) {
          _this2.onAlbumSuccess(userName, results);
        }).catch(function (error) {
          console.warn(error);
          _this2.props.updateAlbumFetchStatus({
            fetchStatus: _constants2.default.fetchStatus.ERROR
          });
          if (_this2.props.handleUserError) {
            _this2.props.handleUserError(error);
          }
        });
      }
    }, {
      key: 'beforeAlbumFetched',
      value: function beforeAlbumFetched() {
        this.props.updateImages({
          images: []
        });
        this.props.updateAlbums({
          albums: []
        });
        this.props.updateDisplayedContent({
          displayedContent: _constants2.default.galleryContent.ALBUMS
        });
        this.props.updateAlbumFetchStatus({
          fetchStatus: _constants2.default.fetchStatus.FETCHING
        });
        this.props.updateUserSearchTerm ? this.props.updateUserSearchTerm({ term: '' }) : null;
        this.props.updateSelectedAlbum({ selectedAlbum: {} });
      }
    }, {
      key: 'onAlbumSuccess',
      value: function onAlbumSuccess(userName, results) {
        this.props.updateAlbumFetchStatus({
          fetchStatus: _constants2.default.fetchStatus.SUCCESS
        });
        this.props.updateUsername({
          userName: results.username || userName
        });
        this.props.updateAlbums({
          albums: results.albums || results
        });
        if (this.props.handleAlbumSuccess) {
          this.props.handleAlbumSuccess();
        }
      }
    }, {
      key: 'onAlbumClicked',
      value: function onAlbumClicked(selectedItem) {
        var _this3 = this;

        // don't go through all the work below if we're clicking on the
        // same album that's already selected and loaded.
        if (selectedItem.title === this.props.provider.selectedAlbum.title && this.props.provider.images.length) {
          this.props.updateDisplayedContent({
            displayedContent: _constants2.default.galleryContent.IMAGES
          });
          return;
        }
        this.beforeImageFetch();

        this.props.connector.getItemsInAlbum(selectedItem.id, this.props.imageQueryParams).then(function (results) {
          _this3.handleImageReturn(results);
          _this3.props.updateSelectedAlbum({
            selectedAlbum: selectedItem
          });
          _this3.props.onChange.userTextInput ? _this3.props.onChange.userTextInput({ target: { value: '' } }) : null;
          _this3.props.updateUserSearchTerm ? _this3.props.updateUserSearchTerm({ term: '' }) : null;
        }).catch(function (error) {
          console.log(error);
          _this3.props.updateImageFetchStatus({
            fetchStatus: _constants2.default.fetchStatus.ERROR
          });
        });
      }
    }, {
      key: 'beforeImageFetch',
      value: function beforeImageFetch() {
        // clear out the existing images before we switch to IMAGES gallery
        this.props.updateImages({
          images: []
        });
        this.props.updateImageFetchStatus({
          fetchStatus: _constants2.default.fetchStatus.FETCHING
        });
        this.props.updateDisplayedContent({
          displayedContent: _constants2.default.galleryContent.IMAGES
        });
      }
    }, {
      key: 'handleImageReturn',
      value: function handleImageReturn(results) {
        this.props.updateImageFetchStatus({
          fetchStatus: _constants2.default.fetchStatus.SUCCESS
        });
        this.props.updateImages({
          images: results
        });
      }
    }, {
      key: 'determineGalleryItems',
      value: function determineGalleryItems() {
        switch (this.props.provider.displayedContent) {
          case _constants2.default.galleryContent.ALBUMS:
            return this.props.provider.albums;
          case _constants2.default.galleryContent.IMAGES:
            return this.props.provider.images;
          case _constants2.default.galleryContent.AGOL:
            return this.props.provider.images;
          default:
            {
              return [];
            }
        }
      }
    }, {
      key: 'getSearchLabel',
      value: function getSearchLabel(term) {
        return text.searchingFor + ' " ' + term + ' "';
      }
    }, {
      key: 'getBreadcrumbs',
      value: function getBreadcrumbs() {
        var breadcrumbs = [];
        var providerRef = this.props.provider;
        var textSearchLabel = this.getSearchLabel(providerRef.photoSearchTerm);
        var secondUserLabel = providerRef.selectedAlbum.id ? providerRef.selectedAlbum.title : this.getSearchLabel(providerRef.userSearchTerm);

        if (providerRef.selectedTab && providerRef.selectedTab === _constants2.default.searchType.TEXT) {
          if (!providerRef.photoSearchTerm) {
            return breadcrumbs;
          }
          breadcrumbs.push(new _BreadcrumbModel2.default(textSearchLabel, _constants2.default.galleryContent.IMAGES, providerRef.displayedContent));
          return breadcrumbs;
        }

        if (providerRef.albumFetchStatus !== _constants2.default.fetchStatus.ERROR) {
          if (providerRef.albums.length) {
            breadcrumbs.push(new _BreadcrumbModel2.default(text.albumsOf + ' ' + providerRef.userName, _constants2.default.galleryContent.ALBUMS, providerRef.displayedContent));
          }

          if (providerRef.imageFetchStatus !== _constants2.default.fetchStatus.ERROR) {
            if (providerRef.images.length || providerRef.selectedAlbum.id || providerRef.userSearchTerm) {
              secondUserLabel = breadcrumbs.push(new _BreadcrumbModel2.default(secondUserLabel, _constants2.default.galleryContent.IMAGES, providerRef.displayedContent));
            }
          }
        }

        return breadcrumbs;
      }
    }, {
      key: 'onBreadcrumbClicked',
      value: function onBreadcrumbClicked(crumb) {
        this.props.updateDisplayedContent({
          displayedContent: crumb.link
        });
      }
    }, {
      key: 'getGalleryHeader',
      value: function getGalleryHeader() {
        switch (this.props.provider.displayedContent) {
          case _constants2.default.galleryContent.ALBUMS:
          case _constants2.default.galleryContent.IMAGES:
            return _react2.default.createElement(_Breadcrumbs2.default, {
              crumbs: this.getBreadcrumbs(),
              onClick: this.onBreadcrumbClicked
            });
          case _constants2.default.galleryContent.AGOL:
            return _react2.default.createElement(_AGOLHeader2.default, {
              containerState: this.props.containerState,
              sortField: this.props.provider.sortField,
              sortOrder: this.props.provider.sortOrder,
              onKeyPress: this.props.onKeyPress
            });
        }
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { style: this.props.display ? null : { display: 'none' }, className: 'browse-panel-container' },
          _react2.default.createElement(
            'div',
            { className: 'column-sidepanel arrow-box' },
            _react2.default.createElement(this.props.sidePanel, {
              onChange: this.props.onChange,
              onClear: this.props.onClear || null,
              onKeyPress: this.props.onKeyPress || this.onKeyPress,
              containerState: this.props.containerState,
              providerProps: this.props.provider
            })
          ),
          _react2.default.createElement(
            'div',
            { className: 'column-gallery' },
            this.getGalleryHeader(),
            _react2.default.createElement(_Gallery2.default, {
              containerState: this.props.containerState,
              providerProps: this.props.provider,
              onAlbumClicked: this.onAlbumClicked,
              onItemDelete: this.props.onKeyPress && this.props.onKeyPress.onItemDelete ? this.props.onKeyPress.onItemDelete : null,
              items: this.determineGalleryItems(),
              displayedContent: this.props.provider.displayedContent
            })
          )
        );
      }
    }]);

    return CommonProvider;
  }(_react2.default.Component);

  exports.default = CommonProvider;
  module.exports = exports['default'];
});
//# sourceMappingURL=Common.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanelGooglePhotos',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanelGooglePhotos',['module', 'exports', 'react', 'react-dom', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./SidePanelGooglePhotos'], function (module, exports, _react, _reactDom, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.sidePanel.googlePhotos;

  var UserSearchAlert = function (_React$Component) {
    _inherits(UserSearchAlert, _React$Component);

    function UserSearchAlert() {
      _classCallCheck(this, UserSearchAlert);

      return _possibleConstructorReturn(this, (UserSearchAlert.__proto__ || Object.getPrototypeOf(UserSearchAlert)).apply(this, arguments));
    }

    _createClass(UserSearchAlert, [{
      key: 'render',
      value: function render() {
        var style = {
          display: this.props.display ? 'block' : 'none'
        };
        var msg = text.cannotFindUser + ' ' + this.props.triedUser + '. ' + text.tryAgain;

        return _react2.default.createElement(
          'div',
          { className: 'alert alert-danger', role: 'alert', style: style },
          _react2.default.createElement(
            'span',
            null,
            msg
          )
        );
      }
    }]);

    return UserSearchAlert;
  }(_react2.default.Component);

  var SearchInput = function (_React$Component2) {
    _inherits(SearchInput, _React$Component2);

    function SearchInput() {
      _classCallCheck(this, SearchInput);

      return _possibleConstructorReturn(this, (SearchInput.__proto__ || Object.getPrototypeOf(SearchInput)).apply(this, arguments));
    }

    _createClass(SearchInput, [{
      key: 'componentDidMount',
      value: function componentDidMount() {
        var _this3 = this;

        var modal = $(_reactDom2.default.findDOMNode(this)).parents('.modal');
        modal.on('shown.bs.modal', function () {
          if (_this3.props.setFocus) {
            $(_this3.refs.textInput).focus();
          }
        });
      }
    }, {
      key: 'componentDidUpdate',
      value: function componentDidUpdate() {
        if (this.props.setFocus) {
          var activeEl = document.activeElement;
          // if someone is navigating by tabbing, don't take the focus off where they are
          var activeTabIndex = activeEl.tabIndex ? parseInt(activeEl.tabIndex) : 0;
          if (activeEl !== this.refs.textInput && activeTabIndex <= 0) {
            $(this.refs.textInput).focus();
          }
        }
      }
    }, {
      key: 'render',
      value: function render() {
        var _this4 = this;

        var parentClass = 'input-group search';
        if (this.props.disabled) {
          parentClass += ' disabled';
        }
        return _react2.default.createElement(
          'div',
          { className: parentClass },
          _react2.default.createElement(
            'div',
            { className: 'input-group-addon' },
            _react2.default.createElement('span', { className: 'fa fa-' + this.props.icon })
          ),
          _react2.default.createElement('input', {
            ref: 'textInput',
            tabIndex: '1',
            type: 'text',
            disabled: this.props.disabled,
            value: this.props.value,
            className: 'form-control',
            placeholder: this.props.placeholder,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress }),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : this.props.value ? '1' : null,
              className: 'btn danger input-group-addon',
              style: this.props.value ? null : { display: 'none' },
              onClick: this.props.value ? function (evt) {
                return _this4.props.onClear(Object.assign({}, evt, { charCode: 13 }));
              } : null,
              onKeyPress: this.props.onClear,
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-remove' })
          ),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : '1',
              className: 'btn input-group-addon',
              onKeyPress: this.props.onKeyPress
              // treat click like enter
              , onClick: this.props.disabled ? null : function (evt) {
                return _this4.props.onKeyPress(Object.assign({}, evt, { charCode: 13 }));
              },
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-' + (this.props.loading ? 'refresh fa-spin' : 'search') })
          )
        );
      }
    }]);

    return SearchInput;
  }(_react2.default.Component);

  var SidePanelGooglePhotos = function (_React$Component3) {
    _inherits(SidePanelGooglePhotos, _React$Component3);

    function SidePanelGooglePhotos() {
      _classCallCheck(this, SidePanelGooglePhotos);

      return _possibleConstructorReturn(this, (SidePanelGooglePhotos.__proto__ || Object.getPrototypeOf(SidePanelGooglePhotos)).apply(this, arguments));
    }

    _createClass(SidePanelGooglePhotos, [{
      key: 'getHelpSpans',
      value: function getHelpSpans() {
        var splitArr = text.helpText.split(/\$\{(.+?)\}/);
        return splitArr.map(function (str, i) {
          var reactKey = 'googlehelp-' + i;
          var spanStr = str;
          if (text[str]) {
            spanStr = text[str];
          }
          if (str.indexOf('brand') === 0) {
            return _react2.default.createElement(
              'span',
              { key: reactKey },
              _react2.default.createElement(
                'strong',
                null,
                spanStr
              )
            );
          }
          if (str === 'helpLinkText') {
            return _react2.default.createElement(
              'a',
              { key: reactKey, href: app.cfg.BUILDER_LINKS.picasaHelp, target: '_blank' },
              _react2.default.createElement(
                'strong',
                null,
                spanStr
              )
            );
          }
          return _react2.default.createElement(
            'span',
            { key: reactKey },
            spanStr
          );
        });
      }
    }, {
      key: 'render',
      value: function render() {
        var msgDisplay = this.props.containerState.userErrorType !== '';

        return _react2.default.createElement(
          'div',
          { className: 'mp-sidepanel google' },
          _react2.default.createElement(SearchInput, {
            icon: 'picture-o',
            placeholder: text.placeholder,
            value: this.props.containerState.searchValue,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress,
            onClear: this.props.onClear,
            setFocus: this.props.containerState.focusInput
          }),
          _react2.default.createElement(UserSearchAlert, {
            display: msgDisplay,
            status: this.props.containerState.userErrorType,
            triedUser: this.props.containerState.searchValue
          }),
          _react2.default.createElement(
            'div',
            { className: 'help-text' },
            this.getHelpSpans()
          )
        );
      }
    }]);

    return SidePanelGooglePhotos;
  }(_react2.default.Component);

  exports.default = SidePanelGooglePhotos;
  module.exports = exports['default'];
});
//# sourceMappingURL=SidePanelGooglePhotos.js.map
;
define('storymaps-react/common/builder/mediaPicker/connectors/GooglePhotos',['exports', 'jquery'], function (exports, _jquery) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.GooglePhotosConnector = undefined;

  var _jquery2 = _interopRequireDefault(_jquery);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var GooglePhotosConnector = function () {
    var getAlbums = function getAlbums(userId) {
      return new Promise(function (resolve, reject) {
        var rqStr = document.location.protocol + '//picasaweb.google.com/data/feed/base/user/' + userId + '?alt=json&access=public';

        if (!userId) {
          reject();
          return;
        }

        _jquery2.default.ajax({
          url: rqStr,
          dataType: 'jsonp',
          timeout: 4000 // handle 404 for user name not found
        }).then(function (data) {
          var albums = [];

          if (data && data.feed && data.feed.entry) {
            _jquery2.default.each(data.feed.entry, function (i, album) {
              albums.push({
                id: album.id['$t'],
                title: album.title['$t'] || '',
                thumbUrl: album['media$group']['media$thumbnail'][0].url
              });
            });
          }
          resolve(albums);
        }, function (error) {
          reject(error);
        });
      });
    };

    var getAlbum = function getAlbum(albumUrl, params) {
      return new Promise(function (resolve, reject) {
        var rqStr = '';

        if (!albumUrl) {
          reject();
          return;
        } else {
          rqStr = albumUrl.replace('/data/entry/base/', '/data/feed/base/') + '&kind=photo&fields=title,subtitle,icon,entry(title,gphoto:numphotos,media:group(media:content,media:thumbnail,media:description),georss:where)';
        }

        rqStr += '&imgmax=1600';
        rqStr += params.maxPictures ? '&max-results=' + params.maxPictures : '';

        _jquery2.default.getJSON(rqStr, function (data) {
          var photos = [];

          _jquery2.default.each(data.feed.entry, function (i, item) {
            var picUrl = item['media$group']['media$content'][0].url || '';
            var thumbUrl = item['media$group']['media$thumbnail'][2].url || '';

            // If the builder is used in HTTPS, the picture will have an HTTPS url
            // Some browser won't load picture using HTTPS when the app is accessed over HTTP
            picUrl = picUrl.replace('https://', 'http://');
            thumbUrl = thumbUrl.replace('https://', 'http://');

            var photo = {
              name: item['media$group']['media$description']['$t'] || '',
              description: '',
              picUrl: picUrl,
              thumbUrl: thumbUrl,
              lat: '',
              lng: '',
              height: item['media$group']['media$content'][0].height,
              width: item['media$group']['media$content'][0].width,
              isVideo: false,
              id: picUrl,
              type: 'googlePhotos'
            };

            if (item['georss$where'] && item['georss$where']['gml$Point'] && item['georss$where']['gml$Point']['gml$pos'] && item['georss$where']['gml$Point']['gml$pos']['$t'] && item['georss$where']['gml$Point']['gml$pos']['$t'].split(' ').length == 2) {

              photo.lat = item['georss$where']['gml$Point']['gml$pos']['$t'].split(' ')[0];
              photo.lng = item['georss$where']['gml$Point']['gml$pos']['$t'].split(' ')[1];
            }

            photos.push(photo);
          });
          resolve(photos);
        }).fail(function (error) {
          reject(error);
        });
      });
    };

    return {
      getProviderAlbums: getAlbums,
      getItemsInAlbum: getAlbum
    };
  }();

  exports.GooglePhotosConnector = GooglePhotosConnector;
});
//# sourceMappingURL=GooglePhotos.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/providers/GooglePhotosContainer',['module', 'exports', 'react', 'react-redux', '../actions', '../../constants', './Common', '../sidePanel/SidePanelGooglePhotos', '../../connectors/GooglePhotos'], function (module, exports, _react, _reactRedux, _actions, _constants, _Common, _SidePanelGooglePhotos, _GooglePhotos) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var actions = _interopRequireWildcard(_actions);

  var _constants2 = _interopRequireDefault(_constants);

  var _Common2 = _interopRequireDefault(_Common);

  var _SidePanelGooglePhotos2 = _interopRequireDefault(_SidePanelGooglePhotos);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var GooglePhotosContainer = function (_React$Component) {
    _inherits(GooglePhotosContainer, _React$Component);

    function GooglePhotosContainer() {
      _classCallCheck(this, GooglePhotosContainer);

      var _this = _possibleConstructorReturn(this, (GooglePhotosContainer.__proto__ || Object.getPrototypeOf(GooglePhotosContainer)).call(this));

      _this.state = {
        searchValue: '',
        userErrorType: '',
        focusInput: false,
        provider: _constants2.default.providers.GOOGLE_PHOTOS
      };

      _this.onChange = _this.onChange.bind(_this);
      return _this;
    }

    _createClass(GooglePhotosContainer, [{
      key: 'componentWillReceiveProps',
      value: function componentWillReceiveProps(nextProps) {
        this.setState({
          focusInput: nextProps.display && !this.props.display || nextProps.openFocus
        });
      }
    }, {
      key: 'onChange',
      value: function onChange(event) {
        this.setState({
          searchValue: event.target.value,
          userErrorType: ''
        });
      }
    }, {
      key: 'onClear',
      value: function onClear(evt) {
        var _this2 = this;

        if (evt.charCode === 13) {
          this.setState({ searchValue: true, focusInput: true });
          this.onChange({ target: { value: '' } });
          // need setTimeout because textKeypress reads this.state,
          // which hasn't happened if you call this.textKeypress
          // sequentially.
          setTimeout(function () {
            // can't use same evt above because it's nulled by this point.
            _this2.refs.Common.onKeyPress({ charCode: 13 });
          }, 10);
        }
      }
    }, {
      key: 'handleUserError',
      value: function handleUserError(error) {
        this.setState({
          userErrorType: error ? error.reason : _constants2.default.userFetchError.ERROR
        });
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(_Common2.default, _extends({
          ref: 'Common',
          sidePanel: _SidePanelGooglePhotos2.default,
          connector: _GooglePhotos.GooglePhotosConnector,
          imageQueryParams: { maxPictures: 200 },
          onChange: this.onChange,
          onClear: this.onClear.bind(this),
          containerState: this.state,
          handleUserError: this.handleUserError.bind(this)
        }, this.props));
      }
    }]);

    return GooglePhotosContainer;
  }(_react2.default.Component);

  var mapStateToProps = function mapStateToProps(state) {
    return {
      provider: state.browsePanel.googlePhotos
    };
  };

  //
  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    var dispatchWithType = function dispatchWithType(action, args) {
      var argumentsWithType = Object.assign({}, args, { providerType: _constants2.default.providers.GOOGLE_PHOTOS });

      dispatch(action(argumentsWithType));
    };

    return {
      updateAlbums: function updateAlbums(provider) {
        dispatchWithType(actions.updateAlbums, provider);
      },
      updateAlbumFetchStatus: function updateAlbumFetchStatus(status) {
        dispatchWithType(actions.updateAlbumFetchStatus, status);
      },
      updateUsername: function updateUsername(userName) {
        dispatchWithType(actions.updateUsername, userName);
      },
      updateDisplayedContent: function updateDisplayedContent(content) {
        dispatchWithType(actions.updateDisplayedContent, content);
      },
      updateImages: function updateImages(images) {
        dispatchWithType(actions.updateImages, images);
      },
      updateSelectedAlbum: function updateSelectedAlbum(selectedAlbum) {
        dispatchWithType(actions.updateSelectedAlbum, selectedAlbum);
      },
      updateImageFetchStatus: function updateImageFetchStatus(status) {
        dispatchWithType(actions.updateImageFetchStatus, status);
      }
    };
  };

  exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(GooglePhotosContainer);
  module.exports = exports['default'];
});
//# sourceMappingURL=GooglePhotosContainer.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanelFlickr',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanelFlickr',['module', 'exports', 'react', 'react-dom', '../../constants', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./SidePanelFlickr'], function (module, exports, _react, _reactDom, _constants, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _constants2 = _interopRequireDefault(_constants);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.sidePanel.flickr;

  var TypeToggle = function (_React$Component) {
    _inherits(TypeToggle, _React$Component);

    function TypeToggle() {
      _classCallCheck(this, TypeToggle);

      return _possibleConstructorReturn(this, (TypeToggle.__proto__ || Object.getPrototypeOf(TypeToggle)).apply(this, arguments));
    }

    _createClass(TypeToggle, [{
      key: 'thisOnClick',
      value: function thisOnClick(evt) {
        var val = $(evt.currentTarget).find('input').val();
        if (val === this.props.selectedTab) {
          return;
        }
        this.props.onChange({ type: val });
      }
    }, {
      key: 'isSelected',
      value: function isSelected(thisType) {
        return this.props.selectedTab === _constants2.default.searchType[thisType];
      }
    }, {
      key: 'render',
      value: function render() {
        var _this2 = this;

        return _react2.default.createElement(
          'div',
          { className: 'type-toggle btn-group', 'data-toggle': 'buttons' },
          _react2.default.createElement(
            'label',
            {
              className: 'btn btn-gray' + (this.isSelected('TEXT') ? ' active' : ''),
              htmlFor: 'flickr-text',
              onClick: function onClick(evt) {
                return _this2.thisOnClick(evt);
              } },
            text.searchType.text,
            _react2.default.createElement('input', {
              onChange: function onChange(evt) {
                return _this2.thisOnClick(evt);
              },
              type: 'radio',
              name: 'searchType',
              value: _constants2.default.searchType.TEXT,
              id: 'flickr-text',
              checked: this.isSelected('TEXT') })
          ),
          _react2.default.createElement(
            'label',
            {
              className: 'btn btn-gray' + (this.isSelected('USER') ? ' active' : ''),
              htmlFor: 'flickr-user',
              onClick: function onClick(evt) {
                return _this2.thisOnClick(evt);
              } },
            text.searchType.account,
            _react2.default.createElement('input', {
              onChange: function onChange(evt) {
                return _this2.thisOnClick(evt);
              },
              type: 'radio',
              name: 'searchType',
              id: 'flickr-user',
              value: _constants2.default.searchType.USER,
              checked: this.isSelected('USER') })
          )
        );
      }
    }]);

    return TypeToggle;
  }(_react2.default.Component);

  var SearchInput = function (_React$Component2) {
    _inherits(SearchInput, _React$Component2);

    function SearchInput() {
      _classCallCheck(this, SearchInput);

      return _possibleConstructorReturn(this, (SearchInput.__proto__ || Object.getPrototypeOf(SearchInput)).apply(this, arguments));
    }

    _createClass(SearchInput, [{
      key: 'componentDidMount',
      value: function componentDidMount() {
        var _this4 = this;

        var modal = $(_reactDom2.default.findDOMNode(this)).parents('.modal');
        modal.on('shown.bs.modal', function () {
          if (_this4.props.setFocus) {
            $(_this4.refs.textInput).focus();
          }
        });
      }
    }, {
      key: 'componentDidUpdate',
      value: function componentDidUpdate() {
        if (this.props.setFocus) {
          var activeEl = document.activeElement;
          // if someone is navigating by tabbing, don't take the focus off where they are
          var activeTabIndex = activeEl.tabIndex ? parseInt(activeEl.tabIndex) : 0;
          if (activeEl !== this.refs.textInput && activeTabIndex <= 0) {
            $(this.refs.textInput).focus();
          }
        }
      }
    }, {
      key: 'render',
      value: function render() {
        var _this5 = this;

        var parentClass = 'input-group search';
        if (this.props.disabled) {
          parentClass += ' disabled';
        }
        return _react2.default.createElement(
          'div',
          { className: parentClass },
          _react2.default.createElement(
            'div',
            { className: 'input-group-addon' },
            _react2.default.createElement('span', { className: 'fa fa-' + this.props.icon })
          ),
          _react2.default.createElement('input', {
            ref: 'textInput',
            tabIndex: '1',
            type: 'text',
            disabled: this.props.disabled,
            value: this.props.value,
            className: 'form-control',
            placeholder: this.props.placeholder,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress }),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : this.props.value ? '1' : null,
              className: 'btn danger input-group-addon',
              style: this.props.value ? null : { display: 'none' },
              onClick: this.props.value ? function (evt) {
                return _this5.props.onClear(Object.assign({}, evt, { charCode: 13 }));
              } : null,
              onKeyPress: this.props.onClear,
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-remove' })
          ),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : '1',
              className: 'btn input-group-addon',
              onKeyPress: this.props.onKeyPress
              // treat click like enter
              , onClick: this.props.disabled ? null : function (evt) {
                return _this5.props.onKeyPress(Object.assign({}, evt, { charCode: 13 }));
              },
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-' + (this.props.loading ? 'refresh fa-spin' : 'search') })
          )
        );
      }
    }]);

    return SearchInput;
  }(_react2.default.Component);

  var LicenseSearch = function (_React$Component3) {
    _inherits(LicenseSearch, _React$Component3);

    function LicenseSearch() {
      _classCallCheck(this, LicenseSearch);

      return _possibleConstructorReturn(this, (LicenseSearch.__proto__ || Object.getPrototypeOf(LicenseSearch)).apply(this, arguments));
    }

    _createClass(LicenseSearch, [{
      key: 'getOptions',
      value: function getOptions() {
        var options = [_react2.default.createElement(
          'option',
          {
            value: _constants2.default.flickrLicenseStrings.PUBLIC_DOMAIN,
            key: _constants2.default.flickrLicenseStrings.PUBLIC_DOMAIN },
          text.licenses.public
        ), _react2.default.createElement(
          'option',
          {
            value: _constants2.default.flickrLicenseStrings.COMMERCIAL,
            key: _constants2.default.flickrLicenseStrings.COMMERCIAL },
          text.licenses.commercial
        ), _react2.default.createElement(
          'option',
          {
            value: _constants2.default.flickrLicenseStrings.NON_COMMERCIAL,
            key: _constants2.default.flickrLicenseStrings.NON_COMMERCIAL },
          text.licenses.nonCommercial
        )];
        if (this.props.searchType === _constants2.default.searchType.USER) {
          options.push(_react2.default.createElement(
            'option',
            {
              value: _constants2.default.flickrLicenseStrings.ANY,
              key: _constants2.default.flickrLicenseStrings.ANY },
            text.licenses.any
          ));
        }
        return options;
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'license-group form-group' + (this.props.disabled ? ' disabled' : '') },
          _react2.default.createElement(
            'label',
            { htmlFor: this.props.searchType + '-license' },
            'License: '
          ),
          _react2.default.createElement(
            'select',
            {
              id: this.props.searchType + '-license',
              onChange: this.props.onChange,
              disabled: this.props.disabled,
              className: 'license form-control',
              defaultValue: this.props.license },
            this.getOptions()
          )
        );
      }
    }]);

    return LicenseSearch;
  }(_react2.default.Component);

  var UserSearchAlert = function (_React$Component4) {
    _inherits(UserSearchAlert, _React$Component4);

    function UserSearchAlert() {
      _classCallCheck(this, UserSearchAlert);

      return _possibleConstructorReturn(this, (UserSearchAlert.__proto__ || Object.getPrototypeOf(UserSearchAlert)).apply(this, arguments));
    }

    _createClass(UserSearchAlert, [{
      key: 'render',
      value: function render() {
        var style = {
          display: this.props.display ? 'block' : 'none'
        };
        var msg;
        switch (this.props.status) {
          case _constants2.default.userFetchError.NO_USER:
          case _constants2.default.userFetchError.ERROR:
            msg = text.errors.cannotFindUser + ' ' + this.props.triedUser + '. ';
            break;
          case _constants2.default.userFetchError.NO_PHOTOS:
            msg = this.props.triedUser + ' ' + text.errors.noUserPhotos + ' ';
            break;
          default:
            msg = text.errors.generalUserError + ' ' + this.props.triedUser + '.';
        }
        var altUser = this.props.altUsername;
        if (this.props.altNSID) {
          altUser += ' (' + this.props.altNSID + ')';
        }
        var altDisplay = {
          display: this.props.altUsername ? 'inline' : 'none'
        };
        return _react2.default.createElement(
          'div',
          { className: 'alert alert-danger', role: 'alert', style: style },
          _react2.default.createElement(
            'span',
            null,
            msg
          ),
          _react2.default.createElement(
            'div',
            { style: altDisplay },
            _react2.default.createElement(
              'span',
              null,
              text.errors.didYouMean,
              ''
            ),
            _react2.default.createElement(
              'a',
              { href: '#', className: 'alert-link', onClick: this.props.tryDifferentUser },
              altUser
            ),
            '?'
          )
        );
      }
    }]);

    return UserSearchAlert;
  }(_react2.default.Component);

  var UserSearch = function (_React$Component5) {
    _inherits(UserSearch, _React$Component5);

    function UserSearch() {
      _classCallCheck(this, UserSearch);

      return _possibleConstructorReturn(this, (UserSearch.__proto__ || Object.getPrototypeOf(UserSearch)).apply(this, arguments));
    }

    _createClass(UserSearch, [{
      key: 'render',
      value: function render() {
        var style = {
          display: this.props.display ? 'block' : 'none'
        };
        var msgDisplay = this.props.containerState.userErrorType !== '';
        return _react2.default.createElement(
          'div',
          { style: style },
          _react2.default.createElement(SearchInput, {
            icon: 'user',
            setFocus: this.props.containerState.focusUserNameInput && this.props.disable.textSearch,
            value: this.props.containerState.userNameInputValue,
            placeholder: text.placeholders.user,
            loading: this.props.albumLoading,
            onChange: this.props.onChange.userNameInput,
            onKeyPress: this.props.onKeyPress.userNameKeypress,
            onClear: this.props.onKeyPress.userNameClear
          }),
          _react2.default.createElement(UserSearchAlert, {
            display: msgDisplay,
            triedUser: this.props.containerState.userNameInputValue,
            status: this.props.containerState.userErrorType,
            altUsername: this.props.containerState.altUsername,
            altNSID: this.props.containerState.altNSID,
            tryDifferentUser: this.props.onKeyPress.tryDifferentUser
          }),
          _react2.default.createElement(SearchInput, {
            icon: 'picture-o',
            setFocus: this.props.containerState.focusUserTextInput && !this.props.disable.textSearch,
            disabled: this.props.disable.textSearch,
            placeholder: text.placeholders.userText,
            value: this.props.containerState.userTextInputValue,
            loading: this.props.imageLoading,
            onChange: this.props.onChange.userTextInput,
            onKeyPress: this.props.onKeyPress.userTextKeypress,
            onClear: this.props.onKeyPress.userTextClear
          }),
          _react2.default.createElement(LicenseSearch, {
            disabled: this.props.disable.licenseSearch,
            onChange: this.props.onKeyPress.userLicenseChange,
            searchType: _constants2.default.searchType.USER,
            license: this.props.license
          })
        );
      }
    }]);

    return UserSearch;
  }(_react2.default.Component);

  var TextSearch = function (_React$Component6) {
    _inherits(TextSearch, _React$Component6);

    function TextSearch() {
      _classCallCheck(this, TextSearch);

      return _possibleConstructorReturn(this, (TextSearch.__proto__ || Object.getPrototypeOf(TextSearch)).apply(this, arguments));
    }

    _createClass(TextSearch, [{
      key: 'render',
      value: function render() {
        var style = {
          display: this.props.display ? 'block' : 'none'
        };
        return _react2.default.createElement(
          'div',
          { style: style },
          _react2.default.createElement(SearchInput, {
            icon: 'picture-o',
            setFocus: this.props.containerState.focusTextInput,
            placeholder: text.placeholders.text,
            value: this.props.containerState.textInputValue,
            loading: this.props.imageLoading,
            onChange: this.props.onChange.textInput,
            onKeyPress: this.props.onKeyPress.textKeypress,
            onClear: this.props.onKeyPress.textClear
          }),
          _react2.default.createElement(LicenseSearch, {
            onChange: this.props.onKeyPress.photoLicenseChange,
            searchType: _constants2.default.searchType.TEXT,
            license: this.props.license
          })
        );
      }
    }]);

    return TextSearch;
  }(_react2.default.Component);

  var SidePanelFlickr = function (_React$Component7) {
    _inherits(SidePanelFlickr, _React$Component7);

    function SidePanelFlickr() {
      _classCallCheck(this, SidePanelFlickr);

      return _possibleConstructorReturn(this, (SidePanelFlickr.__proto__ || Object.getPrototypeOf(SidePanelFlickr)).apply(this, arguments));
    }

    _createClass(SidePanelFlickr, [{
      key: 'render',
      value: function render() {
        var userDisplay = this.props.providerProps.selectedTab === _constants2.default.searchType.USER ? true : false;
        var textDisplay = this.props.providerProps.selectedTab === _constants2.default.searchType.TEXT ? true : false;

        // tried doing this in flickrContainer file, but depended on either actions that were happening in common or on redux state.
        var disableUserTextSearch = !this.props.providerProps.userName || this.props.providerProps.userName.trim().toLowerCase() !== this.props.containerState.userNameInputValue.trim().toLowerCase();
        var disableUserLicenseSearch = disableUserTextSearch || this.props.providerProps.userSearchTerm === '' || this.props.providerProps.userSearchTerm !== this.props.containerState.userTextInputValue;

        return _react2.default.createElement(
          'div',
          { className: 'mp-sidepanel flickr' },
          _react2.default.createElement(TypeToggle, {
            selectedTab: this.props.providerProps.selectedTab,
            onChange: this.props.onKeyPress.searchType }),
          _react2.default.createElement(UserSearch, {
            albumLoading: this.props.providerProps.albumFetchStatus === _constants2.default.fetchStatus.FETCHING,
            imageLoading: this.props.providerProps.imageFetchStatus === _constants2.default.fetchStatus.FETCHING && this.props.providerProps.userSearchTerm,
            userError: this.props.containerState.userErrorType,
            display: userDisplay,
            disable: { textSearch: disableUserTextSearch, licenseSearch: disableUserLicenseSearch },
            license: this.props.providerProps.userLicense,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress,
            containerState: this.props.containerState }),
          _react2.default.createElement(TextSearch, {
            imageLoading: this.props.providerProps.imageFetchStatus === _constants2.default.fetchStatus.FETCHING,
            display: textDisplay,
            license: this.props.providerProps.photoLicense,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress,
            containerState: this.props.containerState })
        );
      }
    }]);

    return SidePanelFlickr;
  }(_react2.default.Component);

  exports.default = SidePanelFlickr;
  module.exports = exports['default'];
});
//# sourceMappingURL=SidePanelFlickr.js.map
;
define('storymaps-react/common/builder/mediaPicker/config',['module', 'exports'], function (module, exports) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.default = {
    APP_IS_PORTAL: false,
    FLICKR_API_KEY: '750b36a2ac65a72e03cf9cef06d79f45',
    YOUTUBE_API_KEY: 'AIzaSyDevTFP16nz6sA-akiOVi6wWXiplJnQ4qw',
    YOUTUBE_DISABLE_ON_PORTAL: true
  };
  module.exports = exports['default'];
});
//# sourceMappingURL=config.js.map
;
define('storymaps-react/common/builder/mediaPicker/connectors/Flickr',['exports', 'jquery', '../config', 'lib-build/i18n!../../../_resources/nls/media', '../constants'], function (exports, _jquery, _config, _media, _constants) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.FlickrConnector = undefined;

  var _jquery2 = _interopRequireDefault(_jquery);

  var _config2 = _interopRequireDefault(_config);

  var _media2 = _interopRequireDefault(_media);

  var _constants2 = _interopRequireDefault(_constants);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var text = _media2.default.mediaPicker.browsePanel.providers.flickr;

  var FlickrConnector = function () {
    var _userId = null;
    var _photostreamId = null;
    var defaultOptions = {
      per_page: 500
    };

    var loadAlbums = function loadAlbums(userName) {
      return new Promise(function (resolve, reject) {
        var nIndex = userName.indexOf('@N');
        if (nIndex > 0 && nIndex === userName.length - 4) {
          _userId = userName;
          getSetsFromNSID(resolve, reject);
          return;
        }

        // make a simple connect example first...
        request('flickr.people.findByUsername', { username: userName }).done(function (result) {
          if (result && result.stat === 'ok') {
            _userId = result.user.id;
            getSetsFromNSID(resolve, reject, userName, result.user);
          } else {
            getUserByUrl(userName).then(function (response) {
              return tryUserAgain(_constants2.default.userFetchError.NO_USER, reject, response);
            }).fail(function (error) {
              console.warn(error);
              reject({ reason: _constants2.default.userFetchError.ERROR });
            });
          }
        });
      });
    };

    var getSetsFromNSID = function getSetsFromNSID(resolve, reject, userName, user) {
      getSets().then(function (setResponse, streamResponse) {
        var photosets = setResponse[0].photosets.photoset;
        addPhotostream(photosets, streamResponse[0].photos.photo[0]);
        if (photosets && photosets.length) {
          resolve({
            sets: enrichSet(photosets),
            username: user && user.username && user.username._content ? user.username._content : null
          });
        } else if (userName) {
          getUserByUrl(userName).then(function (response) {
            return tryUserAgain(_constants2.default.userFetchError.NO_PHOTOS, reject, response);
          }).fail(function (error) {
            console.warn(error);
            reject({ reason: _constants2.default.userFetchError.NO_PHOTOS });
          });
        } else {
          reject({ reason: _constants2.default.userFetchError.NO_PHOTOS });
        }
      });
    };

    var tryUserAgain = function tryUserAgain(reason, reject, response) {
      if (response && response.stat === 'ok') {
        var altUsername = response.user.username._content;
        request('flickr.people.findByUsername', { username: altUsername }).then(function (results) {
          if (results && results.stat === 'ok') {
            reject({
              reason: reason || _constants2.default.userFetchError.ERROR,
              alternate: altUsername
            });
          } else {
            reject({
              reason: reason || _constants2.default.userFetchError.ERROR,
              alternate: altUsername,
              nsid: response.user.id
            });
          }
        });
      } else {
        reject({ reason: reason || _constants2.default.userFetchError.ERROR });
      }
    };

    var addPhotostream = function addPhotostream(photosets, firstStreamPhoto) {
      if (firstStreamPhoto) {
        _photostreamId = firstStreamPhoto.id;
        photosets.unshift(firstStreamPhoto);
      }
      return photosets;
    };

    var getPicturesInSet = function getPicturesInSet(setId, options) {
      if (setId === _photostreamId) {
        return getPhotostream(options);
      }
      return getPictures('flickr.photosets.getPhotos', Object.assign({ photoset_id: setId }, options));
    };

    var getPhotostream = function getPhotostream(options) {
      return getPictures('flickr.people.getPhotos', Object.assign({ user_id: _userId }, options));
    };

    var searchPhotos = function searchPhotos(options) {
      if (options.user) {
        Object.assign(options, { user_id: _userId });
      }
      return getPictures('flickr.photos.search', options);
    };

    var getPictures = function getPictures(method, params) {
      return new Promise(function (resolve, reject) {

        var searchParams = Object.assign({
          extras: 'geo,description,license,url_s,url_n,url_m,url_l'
        }, defaultOptions, params);

        request(method, searchParams).done(function (result) {
          if (!result || result.stat !== 'ok') {
            reject();
          }

          var response = [],
              photos = [];

          if (result.photos) {
            photos = result.photos.photo;
          } else if (result.photoset) {
            photos = result.photoset.photo;
          }

          _jquery2.default.each(photos, function (i, photo) {

            var thumbUrlOptions = getThumbUrlOptions(photo);

            response.push(Object.assign({
              name: photo.title || '',
              description: photo.description ? photo.description._content || '' : '',
              getPicUrl: getPhotoUrlOptions, // this allows us to get larger photos than _b (1024px longest side)
              picUrl: getPhotoURLFromSearchResults(photo), // this is a fallback now
              lat: photo.latitude || '',
              lng: photo.longitude || '',
              height: photo.height_l || photo.height_m,
              width: photo.width_l || photo.width_m,
              isVideo: false,
              id: photo.id,
              license: photo.license,
              type: 'flickr'
            }, thumbUrlOptions));
          });

          resolve(response);
        });
      });
    };

    var getPhotoUrlOptions = function getPhotoUrlOptions(photo) {
      return new Promise(function (resolve) {
        var fallback = {
          url: photo.picUrl,
          width: photo.width,
          height: photo.height
        };
        request('flickr.photos.getSizes', { photo_id: photo.id }).done(function (result) {
          if (result.stat !== 'ok' || !result.sizes || !result.sizes.size || !result.sizes.size.length) {
            resolve(fallback);
            return;
          }
          resolve(parsePhotoUrlOptions(result.sizes.size, fallback));
        }).fail(function (xhr, status, err) {
          console.warn('failed to get sizes from flickr', err);
          resolve(fallback);
        });
      });
    };

    // flickr url choices, found here: https://www.flickr.com/services/api/misc.urls.html
    // getSizes choices, found here: https://www.flickr.com/services/api/flickr.photos.getSizes.html
    // just return all sizes, as formatted arr of {width, height, url}
    var parsePhotoUrlOptions = function parsePhotoUrlOptions(sizesArr, fallback) {
      var formattedSizes = sizesArr.map(function (sizeObj) {
        return {
          width: parseInt(sizeObj.width),
          height: parseInt(sizeObj.height),
          url: sizeObj.source
        };
      });
      return Object.assign({}, fallback, {
        sizes: formattedSizes
      });
    };

    var getPhotoURLFromSearchResults = function getPhotoURLFromSearchResults(photo) {
      return photo.url_l || photo.url_m || getPhotoURLFromSize(photo, 'b');
    };

    var getPhotoURLFromSize = function getPhotoURLFromSize(photo, size) {
      return 'http://farm' + photo.farm + '.static.flickr.com/' + photo.server + '/' + photo.id + '_' + photo.secret + '_' + size + '.jpg';
    };

    var getThumbUrlOptions = function getThumbUrlOptions(photo) {
      var suffix;
      // find the best thumbnail url for the height of the photo.
      // the gallery photo height is defined by constants.galleryContent.IMG_HEIGHT,
      // so we compare photo heights to 80% of that
      // (ok to scale up a little, but too much makes it look fuzzy)
      var heightCompare = _constants2.default.galleryContent.IMG_HEIGHT * 0.8;
      if (photo.url_s && photo.height_s >= heightCompare) {
        suffix = 's';
      } else if (photo.url_n && photo.height_n >= heightCompare) {
        suffix = 'n';
      } else if (photo.url_m && photo.height_m >= heightCompare) {
        suffix = 'm';
      } else if (photo.url_l) {
        suffix = 'l';
      } else {
        return { thumbUrl: getPhotoURLFromSize(photo, 'm') };
      }
      return {
        thumbUrl: photo['url_' + suffix],
        thumbWidth: photo['width_' + suffix],
        thumbHeight: photo['height_' + suffix]
      };
    };

    var getSets = function getSets() {
      return _jquery2.default.when(request('flickr.photosets.getList', Object.assign({}, defaultOptions, { user_id: _userId, primary_photo_extras: 'url_q' })), request('flickr.people.getPhotos', Object.assign({}, defaultOptions, { user_id: _userId, per_page: 1, extras: 'url_q' })));
    };

    var enrichSet = function enrichSet(sets) {
      _jquery2.default.each(sets, function (i, set) {
        set._thumbnail = set.url_q || (set.primary_photo_extras ? set.primary_photo_extras.url_q : false) || 'http://farm2.static.flickr.com/' + set.server + '/' + (set.primary || set.id) + '_' + set.secret + '_q' + '.jpg';
      });

      return sets;
    };

    var request = function request(method, params) {
      var url = 'https://' + 'api.flickr.com/services/rest/?method=' + method + '&format=json' + '&api_key=' + _config2.default.FLICKR_API_KEY + (!params ? '' : '&' + _jquery2.default.param(params)) + '&jsoncallback=?';

      return _jquery2.default.getJSON(url);
    };

    var getProviderAlbums = function getProviderAlbums(userName) {
      return new Promise(function (resolve, reject) {
        loadAlbums(userName).then(function (results) {
          var albumInfos = [];

          results.sets.forEach(function (set) {
            var albumInfo = {
              id: set.id,
              thumbUrl: set._thumbnail,
              title: set.id === _photostreamId ? text.photostream : set.title._content,
              details: {
                photos: set.photos
              }
            };
            albumInfos.push(albumInfo);
          });

          resolve({ albums: albumInfos, username: results.username });
        }).catch(function (error) {
          reject(error);
        });
      });
    };

    var getUserByUrl = function getUserByUrl(userName) {
      return request('flickr.urls.lookupUser', { url: 'http://www.flickr.com/photos/' + userName });
    };

    return {
      getProviderAlbums: getProviderAlbums,
      getItemsInAlbum: getPicturesInSet,
      photoSearch: searchPhotos
    };
  }();

  exports.FlickrConnector = FlickrConnector;
});
//# sourceMappingURL=Flickr.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/providers/FlickrContainer',['module', 'exports', 'react', 'react-redux', '../actions', '../../constants', './Common', '../sidePanel/SidePanelFlickr', '../../connectors/Flickr'], function (module, exports, _react, _reactRedux, _actions, _constants, _Common, _SidePanelFlickr, _Flickr) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var actions = _interopRequireWildcard(_actions);

  var _constants2 = _interopRequireDefault(_constants);

  var _Common2 = _interopRequireDefault(_Common);

  var _SidePanelFlickr2 = _interopRequireDefault(_SidePanelFlickr);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var FlickrContainer = function (_React$Component) {
    _inherits(FlickrContainer, _React$Component);

    function FlickrContainer() {
      _classCallCheck(this, FlickrContainer);

      var _this = _possibleConstructorReturn(this, (FlickrContainer.__proto__ || Object.getPrototypeOf(FlickrContainer)).call(this));

      _this.state = {
        userNameInputValue: '',
        userTextInputValue: '',
        textInputValue: '',
        userErrorType: '',
        altUsername: '',
        altNSID: '',
        focusUserNameInput: false,
        focusUserTextInput: false,
        focusTextInput: false,
        provider: _constants2.default.providers.FLICKR
      };

      // these actions change this container state
      _this.onChange = {
        userNameInput: _this.userNameInput.bind(_this),
        userTextInput: _this.userTextInput.bind(_this),
        textInput: _this.textInput.bind(_this)
      };

      // these actions potentially change the redux state
      _this.onKeyPress = {
        searchType: _this.searchTypeSubmit.bind(_this),
        userNameKeypress: _this.userNameKeypress.bind(_this),
        userTextKeypress: _this.userTextKeypress.bind(_this),
        tryDifferentUser: _this.tryDifferentUser.bind(_this),
        userNameClear: _this.userNameClear.bind(_this),
        userTextClear: _this.userTextClear.bind(_this),
        textClear: _this.textClear.bind(_this),
        textKeypress: _this.textKeypress.bind(_this),
        userLicenseChange: _this.userLicenseChange.bind(_this),
        photoLicenseChange: _this.photoLicenseChange.bind(_this)
      };
      return _this;
    }

    _createClass(FlickrContainer, [{
      key: 'componentWillReceiveProps',
      value: function componentWillReceiveProps(nextProps) {
        var isUser = nextProps.provider.selectedTab === _constants2.default.searchType.USER;
        var switchedToPane = nextProps.display && !this.props.display;
        var switchedToTab = this.props.provider.selectedTab !== nextProps.provider.selectedTab;
        this.setState({
          focusUserNameInput: isUser && (switchedToPane || switchedToTab || nextProps.openFocus),
          focusUserTextInput: isUser && (switchedToPane || switchedToTab || nextProps.openFocus),
          focusTextInput: !isUser && (switchedToPane || switchedToTab || nextProps.openFocus)
        });
      }
    }, {
      key: 'userNameInput',
      value: function userNameInput(evt) {
        this.setState({
          userNameInputValue: evt.target.value,
          userErrorType: '',
          altUsername: '',
          altNSID: ''
        });
      }
    }, {
      key: 'userTextInput',
      value: function userTextInput(evt) {
        this.setState({
          userTextInputValue: evt.target.value
        });
      }
    }, {
      key: 'textInput',
      value: function textInput(evt) {
        this.setState({
          textInputValue: evt.target.value
        });
      }
    }, {
      key: 'userNameKeypress',
      value: function userNameKeypress(evt) {
        if (evt.charCode === 13) {
          // on userNAME submit, clear out userTEXT search term
          this.userTextInput({ target: { value: '' } });
          if (!this.state.userNameInputValue) {
            this.refs.Common.beforeAlbumFetched();
            this.refs.Common.onAlbumSuccess('', []);
            return;
          }
          this.refs.Common.fetchAlbums(this.state.userNameInputValue);
        }
      }
    }, {
      key: 'userTextKeypress',
      value: function userTextKeypress(evt) {
        if (evt.charCode === 13) {
          this.userTextSubmit();
        }
      }
    }, {
      key: 'textKeypress',
      value: function textKeypress(evt) {
        if (evt.charCode === 13) {
          this.photoTextSubmit();
        }
      }
    }, {
      key: 'userNameClear',
      value: function userNameClear(evt) {
        var _this2 = this;

        if (evt.charCode === 13) {
          this.userNameInput({ target: { value: '' } });
          this.setState({ focusUserNameInput: true });
          // need setTimeout because userNameKeypress reads this.state,
          // which hasn't happened if you call this.userNameKeypress
          // sequentially.
          setTimeout(function () {
            // can't use same evt above because it's nulled by this point.
            _this2.userNameKeypress({ charCode: 13 });
          }, 10);
        }
      }
    }, {
      key: 'userTextClear',
      value: function userTextClear(evt) {
        var _this3 = this;

        if (evt.charCode === 13) {
          this.userTextInput({ target: { value: '' } });
          this.setState({ focusUserTextInput: true });
          // need setTimeout because userTextKeypress reads this.state,
          // which hasn't happened if you call this.userTextKeypress
          // sequentially.
          setTimeout(function () {
            // can't use same evt above because it's nulled by this point.
            _this3.userTextKeypress({ charCode: 13 });
          }, 10);
        }
      }
    }, {
      key: 'textClear',
      value: function textClear(evt) {
        var _this4 = this;

        if (evt.charCode === 13) {
          this.setState({ focusTextInput: true });
          this.textInput({ target: { value: '' } });
          // need setTimeout because textKeypress reads this.state,
          // which hasn't happened if you call this.textKeypress
          // sequentially.
          setTimeout(function () {
            // can't use same evt above because it's nulled by this point.
            _this4.textKeypress({ charCode: 13 });
          }, 10);
        }
      }
    }, {
      key: 'userTextSubmit',
      value: function userTextSubmit(options) {
        var term = this.state.userTextInputValue.trim();
        if (!term) {
          this.props.updateUserSearchTerm({ term: '' });
          this.props.updateImages({ images: [] });
          this.props.updateDisplayedContent({ displayedContent: _constants2.default.galleryContent.ALBUMS });
          return;
        }
        options = options || {};
        this.props.updateUserSearchTerm({ term: term });
        Object.assign(options, {
          text: term
        });
        this.props.updateSelectedAlbum({ selectedAlbum: {} });
        var licenseVal = _constants2.default.flickrLicenseVals[this.props.provider.userLicense].toString();
        this.imageFetch(Object.assign({
          user: true,
          license: licenseVal
        }, options));
      }
    }, {
      key: 'photoTextSubmit',
      value: function photoTextSubmit(options) {
        var term = this.state.textInputValue.trim();
        this.props.updatePhotoSearchTerm({ term: term });
        if (!term) {
          this.props.updateImages({ images: null });
          this.props.updateImageFetchStatus({ fetchStatus: _constants2.default.fetchStatus.NOT_FETCHED });
          return;
        }
        var licenseVal = _constants2.default.flickrLicenseVals[this.props.provider.photoLicense].toString();
        this.imageFetch(Object.assign({
          text: term,
          license: licenseVal
        }, options));
      }
    }, {
      key: 'imageFetch',
      value: function imageFetch(options) {
        var _this5 = this;

        this.refs.Common.beforeImageFetch();
        _Flickr.FlickrConnector.photoSearch(options).then(function (results) {
          return _this5.refs.Common.handleImageReturn(results);
        });
      }
    }, {
      key: 'userLicenseChange',
      value: function userLicenseChange(evt) {
        var licenseStr = evt.target.value;
        this.props.updateUserLicense({ license: licenseStr });
        this.userTextSubmit({
          license: _constants2.default.flickrLicenseVals[licenseStr].toString()
        });
      }
    }, {
      key: 'photoLicenseChange',
      value: function photoLicenseChange(evt) {
        var licenseStr = evt.target.value;
        this.props.updatePhotoLicense({ license: licenseStr });
        this.photoTextSubmit({
          license: _constants2.default.flickrLicenseVals[licenseStr].toString()
        });
      }
    }, {
      key: 'searchTypeSubmit',
      value: function searchTypeSubmit(typeObj) {
        var _this6 = this;

        this.props.updateSearchType(typeObj);
        this.setState({
          userNameInputValue: this.props.provider.userName,
          userTextInputValue: this.props.provider.userSearchTerm,
          textInputValue: this.props.provider.photoSearchTerm,
          userErrorType: '',
          altUsername: '',
          altNSID: ''
        });
        this.props.updateImages({ images: [] });
        this.props.updateAlbumFetchStatus({ fetchStatus: _constants2.default.fetchStatus.NOT_FETCHED });
        this.props.updateImageFetchStatus({ fetchStatus: _constants2.default.fetchStatus.NOT_FETCHED });
        switch (typeObj.type) {
          case _constants2.default.searchType.USER:
            if (!this.props.provider.userName) {
              return;
            }
            if (this.props.provider.userSearchTerm) {
              this.userTextSubmit();
            } else {
              if (this.props.provider.userName && this.props.provider.albums.length) {
                this.props.updateDisplayedContent({ displayedContent: _constants2.default.galleryContent.ALBUMS });
                if (this.props.provider.selectedAlbum.id) {
                  setTimeout(function () {
                    _this6.refs.Common.onAlbumClicked(_this6.props.provider.selectedAlbum);
                  }, 1);
                }
              } else {
                this.refs.Common.fetchAlbums(this.state.userNameInputValue);
              }
            }
            break;
          case _constants2.default.searchType.TEXT:
            this.props.updateDisplayedContent({ displayedContent: _constants2.default.galleryContent.IMAGES });
            this.photoTextSubmit();
            break;
          default:
            return;
        }
      }
    }, {
      key: 'handleAlbumSuccess',
      value: function handleAlbumSuccess() {
        this.setState({
          focusUserTextInput: true
        });
      }
    }, {
      key: 'handleUserError',
      value: function handleUserError(error) {
        this.setState({
          userErrorType: error.reason,
          altUsername: error.alternate,
          altNSID: error.nsid
        });
      }
    }, {
      key: 'tryDifferentUser',
      value: function tryDifferentUser() /*evt*/{
        var _this7 = this;

        this.userNameInput({ target: { value: this.state.altNSID || this.state.altUsername } });
        setTimeout(function () {
          _this7.userNameKeypress({ charCode: 13 });
        }, 10);
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(_Common2.default, _extends({
          ref: 'Common',
          sidePanel: _SidePanelFlickr2.default,
          connector: _Flickr.FlickrConnector,
          imageQueryParams: { per_page: 500 },
          onChange: this.onChange,
          onKeyPress: this.onKeyPress,
          handleAlbumSuccess: this.handleAlbumSuccess.bind(this),
          handleUserError: this.handleUserError.bind(this),
          containerState: this.state
        }, this.props));
      }
    }]);

    return FlickrContainer;
  }(_react2.default.Component);

  var mapStateToProps = function mapStateToProps(state) {
    return {
      provider: state.browsePanel.flickr
    };
  };

  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    var dispatchWithType = function dispatchWithType(action, args) {
      var argumentsWithType = Object.assign({}, args, { providerType: _constants2.default.providers.FLICKR });

      dispatch(action(argumentsWithType));
    };

    return {
      updateAlbums: function updateAlbums(provider) {
        dispatchWithType(actions.updateAlbums, provider);
      },
      updateAlbumFetchStatus: function updateAlbumFetchStatus(status) {
        dispatchWithType(actions.updateAlbumFetchStatus, status);
      },
      updateUsername: function updateUsername(userName) {
        dispatchWithType(actions.updateUsername, userName);
      },
      updateDisplayedContent: function updateDisplayedContent(content) {
        dispatchWithType(actions.updateDisplayedContent, content);
      },
      updateImages: function updateImages(images) {
        dispatchWithType(actions.updateImages, images);
      },
      updateSelectedAlbum: function updateSelectedAlbum(selectedAlbum) {
        dispatchWithType(actions.updateSelectedAlbum, selectedAlbum);
      },
      updateImageFetchStatus: function updateImageFetchStatus(status) {
        dispatchWithType(actions.updateImageFetchStatus, status);
      },
      updateSearchType: function updateSearchType(type) {
        dispatchWithType(actions.updateSearchType, type);
      },
      updateUserSearchTerm: function updateUserSearchTerm(term) {
        dispatchWithType(actions.updateUserSearchTerm, term);
      },
      updatePhotoSearchTerm: function updatePhotoSearchTerm(term) {
        dispatchWithType(actions.updatePhotoSearchTerm, term);
      },
      updateUserLicense: function updateUserLicense(license) {
        dispatchWithType(actions.updateUserLicense, license);
      },
      updatePhotoLicense: function updatePhotoLicense(license) {
        dispatchWithType(actions.updatePhotoLicense, license);
      }
    };
  };

  exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(FlickrContainer);
  module.exports = exports['default'];
});
//# sourceMappingURL=FlickrContainer.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/FileUploader/NewerImageUploadHelper',['module', 'exports', '../../../constants'], function (module, exports, _constants) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _constants2 = _interopRequireDefault(_constants);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  /* ----- main function to export ----- */

  // need to return
  // {
  //    type: 'image' // since this is the image helper, we shouldn't have gotten here on a different media type
  //    file: either the original file or a file blob, extracted from dataURItoBlob(scaled-image's dataUrl);
  //    thumb: same format as file
  //    width: scaled image width
  //    height: scaled image height
  //    dataUrl: used if single file for placeholder in main app while upload occurs, used if multi-file for placeholder in MP while upload occurs
  // }

  var loadImageFromFile = function loadImageFromFile(file, isSingle) {
    return new Promise(function (resolve, reject) {

      if (file.type.indexOf('gif') >= 0) {
        handleGifFile(file).then(resolve).catch(reject);
      } else {
        handleImageFile(file, isSingle).then(resolve).catch(reject);
      }
    });
  };

  var handleGifFile = function handleGifFile(file) {
    return new Promise(function (resolve, reject) {
      // do some client-side processing to make sure the gif isn't too big
      // (either in dimensions or filesize);

      // since we can't resample or resize gifs client-side, first check the filesize.
      // if it's too big, no sense in continuing...
      if (!validateFileSize(file)) {
        console.warn('gif file size too big!');
        reject({ reason: 'filesize' });
        return;
      }

      // we don't know the dimensions of a gif until
      // we make it into an Image object and wait for it to load...

      createNewImage(file).then(function (img) {
        // now we have the dimensions, so we can validate them client-side.
        if (!validateDimensions(img)) {
          reject({ reason: 'gif dimensions' });
          return;
        }

        // we pass the dimensions back to the requesting function.
        resolveWithData({ file: file, img: img, dataUrl: _constants2.default.blankBackground }, resolve);
      }).catch(reject); // pass createNewImage rejection along.
    });
  };

  var handleImageFile = function handleImageFile(origFile, isSingle) {
    return new Promise(function (resolve, reject) {
      createNewImage(origFile).then(function (img) {
        var canvas = createNewCanvas(img, 'photo');
        var file = origFile;
        var canvasDataUrl = void 0;
        if (!validateFileSize(origFile) || !validateDimensions(img)) {
          canvasDataUrl = canvas.toDataURL();
          file = dataURItoBlob(canvasDataUrl);
          if (!validateFileSize(file)) {
            reject({ reason: 'compressed filesize' });
            return;
          }
        }
        var thumbCanvas = createNewCanvas(img, 'thumb');
        var thumbDataUrl = thumbCanvas.toDataURL();
        var thumb = dataURItoBlob(thumbDataUrl);
        var dataUrl = isSingle ? canvasDataUrl : thumbDataUrl;
        resolveWithData({ canvas: canvas, file: file, dataUrl: dataUrl, thumb: thumb }, resolve);
      }).catch(reject);
    });
  };

  /* ----- UTILITY FUNCTIONS ----- */

  var resolveWithData = function resolveWithData(options, resolve) {
    options.img = options.img || options.canvas;
    resolve(Object.assign({
      type: 'image',
      width: options.img.width,
      height: options.img.height,
      file: options.file
    }, options.dataUrl ? { dataUrl: options.dataUrl } : {}, options.thumb ? { thumb: options.thumb } : {}));
  };

  var validateFileSize = function validateFileSize(fileOrBlob) {
    return fileOrBlob.size <= _constants2.default.photoSettings.maxFileSize;
  };

  var validateDimensions = function validateDimensions(imgOrCanvas) {
    return imgOrCanvas.width <= _constants2.default.photoSettings.maxWidth && imgOrCanvas.height <= _constants2.default.photoSettings.maxHeight;
  };

  var createNewImage = function createNewImage(file) {
    return new Promise(function (resolve, reject) {
      // we don't know the dimensions of a gif until
      // we make it into an Image object and wait for it to load...

      var img = new Image();
      var URL = window.URL || window.webkitURL;

      if (!URL) {
        reject({ reason: 'no window.URL' });
        return;
      }

      img.src = URL.createObjectURL(file);
      img.onload = function () {
        this.onload = null; // revoke onload listener
        URL.revokeObjectURL(file); // release memory
        resolve(this);
      };
    });
  };

  var createNewCanvas = function createNewCanvas(img, size) {
    var dims = getPhotoSize(img, size);
    var canvas = document.createElement('canvas');
    canvas.width = dims.width;
    canvas.height = dims.height;
    canvas.getContext('2d').drawImage(img, 0, 0, img.width, img.height, 0, 0, dims.width, dims.height);

    return canvas;
  };

  var getPhotoSize = function getPhotoSize(img, type) {
    var height = void 0,
        width = void 0;
    if (validateDimensions(img) && type === 'photo') {
      height = img.height;
      width = img.width;
    } else {
      var imgRatio = img.width / img.height;
      if (type === 'thumb') {
        height = Math.max(_constants2.default.galleryContent.IMG_HEIGHT, _constants2.default.galleryContent.ALBUM_HEIGHT);
        width = imgRatio * height;
      } else {
        var maxRatio = _constants2.default.photoSettings.maxWidth / _constants2.default.photoSettings.maxHeight;
        if (imgRatio < maxRatio && maxRatio > 1) {
          height = _constants2.default.photoSettings.maxHeight;
          width = imgRatio * height;
        } else {
          width = _constants2.default.photoSettings.maxWidth;
          height = width / imgRatio;
        }
      }
    }
    return {
      height: Math.round(height),
      width: Math.round(width)
    };
  };

  var dataURItoBlob = function dataURItoBlob(dataURI) {
    var byteString = void 0;

    if (dataURI.split(',')[0].indexOf('base64') >= 0) {
      byteString = atob(dataURI.split(',')[1]);
    } else {
      byteString = unescape(dataURI.split(',')[1]);
    }

    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
    var ia = new Uint8Array(byteString.length);

    for (var i = 0; i < byteString.length; i++) {
      ia[i] = byteString.charCodeAt(i);
    }

    return new Blob([ia], { type: mimeString });
  };

  exports.default = {
    loadImageFromFile: loadImageFromFile
  };
  module.exports = exports['default'];
});
//# sourceMappingURL=NewerImageUploadHelper.js.map
;
define('storymaps-react/common/builder/mediaPicker/connectors/ArcGIS',['exports', 'lib-build/i18n!../../../_resources/nls/media', '../constants', '../utils/Helper', 'esri/request'], function (exports, _media, _constants, _Helper, _request) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.ArcGISConnector = undefined;

  var _media2 = _interopRequireDefault(_media);

  var _constants2 = _interopRequireDefault(_constants);

  var _Helper2 = _interopRequireDefault(_Helper);

  var _request2 = _interopRequireDefault(_request);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  var text = _media2.default.mediaPicker.browsePanel.sidePanel.agol;

  var ArcGISConnector = function () {
    var _portal, _appItem, _appId, _portalUser /*, _next*/;

    var defaultParams = {
      num: 100
    };

    /* search options expectations
    options: {
      // all are single str values except contentTypes, which is an arr
      searchLocation: constants.searchLocation.{STORY, AGOL, ORG, MINE},
      contentTypes: [constants.agolContentType.{WEBMAP, WEBSCENE}],
      sortField: constants.sortField.{DATE, TITLE},
      sortOrder: constants.sort.order.{ASC, DESC},
      searchStr: {str},
      page
    }
    */

    var getPortal = function getPortal() {
      _portal = app.portal;
      return _portal;
    };

    var getAppItem = function getAppItem() {
      _appItem = app.data && app.data.appItem;
      return _appItem;
    };

    var getAppId = function getAppId() {
      _appId = getAppItem() && _appItem.item.id;
      return _appId;
    };

    var getAppIdPromise = function getAppIdPromise() {
      return new Promise(function (resolve, reject) {
        if (getAppId()) {
          resolve(_appId);
          return;
        }
        var count = 0;
        var interval = setInterval(function () {
          if (getAppId()) {
            resolve(_appId);
            clearInterval(interval);
            return;
          }
          count++;
          if (count > 5) {
            reject('no appId');
            clearInterval(interval);
            return;
          }
        }, 1000);
      });
    };

    var getUser = function getUser() {
      _portalUser = app.portal && app.portal.user;
      return _portalUser;
    };

    var getOwner = function getOwner() {
      if (!_appItem) {
        console.warn('no app owner');
        return;
      }
      return _appItem.item.owner;
    };

    var checkSignin = function checkSignin() {
      var promise = new Promise(function (resolve, reject) {
        if (!app.portal) {
          console.warn('no portal');
          reject();
        }
        if (!_portalUser && !getUser()) {
          app.portal.signIn().then(function () {
            resolve();
          });
        }
      });

      return promise;
    };

    var getItems = function getItems(options) {
      return new Promise(function (resolve, reject) {
        if (!app.portal) {
          reject('no portal');
          return;
        }
        if (!_portalUser && !getUser()) {
          reject('no user');
          return;
        }

        if (options.searchLocation === _constants2.default.searchLocation.STORY) {
          getStoryResources(options, resolve, reject);
          return;
        }

        var q = void 0;
        if (options.idArr) {
          q = buildIdQuery(options.idArr);
        } else {
          options.contentTypesArr = buildTypeQ(options.contentTypes);
          if (!options.contentTypesArr) {
            resolve();
            return;
          }
          q = buildQ(options);
        }

        var queryParams = Object.assign({}, defaultParams, {
          q: q
        });
        if (options.sortField) {
          queryParams.sortField = options.sortField;
        }
        if (options.sortOrder) {
          queryParams.sortOrder = options.sortOrder;
        }
        queryItems(queryParams, resolve, reject);
      });
    };

    var getResourcesUrl = function getResourcesUrl() {
      return _Helper2.default.stripTrailingSlash((_portal || getPortal()).portalUrl) + '/content/items/' + _appId + '/resources/';
    };

    var getStoryResources = function getStoryResources(options, resolve, reject) {
      if (!_appId && !getAppId()) {
        resolve();
        return;
      }
      var resourcesUrl = getResourcesUrl();

      (0, _request2.default)({
        url: resourcesUrl,
        handleAs: 'json',
        content: {
          num: 1000,
          f: 'json'
        }
      }).then(function (response) {
        return handleResourceReturn(response, resolve);
      }, function (err) {
        return handleQueryError(err, reject);
      });
    };

    var handleResourceReturn = function handleResourceReturn(response, resolve) {
      var results = formatResources(response.resources);
      resolve(results);
    };

    var queryItems = function queryItems(queryParams, resolve, reject) {
      app.portal.queryItems(queryParams).then(function (response) {
        return handleQueryReturn(response, resolve);
      }, function (err) {
        return handleQueryError(err, reject);
      });
    };

    var handleQueryReturn = function handleQueryReturn(response, resolve) {
      var results = formatResults(response.results);
      // _next = response.nextQueryParams;
      resolve(results);
    };

    var handleQueryError = function handleQueryError(err, reject) {
      reject(err);
    };

    var getFormDataFromFileDetails = function getFormDataFromFileDetails(fileDetails) {
      var formdata = new FormData();
      formdata.append('f', 'json');
      addToFormData(formdata, fileDetails);

      return formdata;
    };

    var addToFormData = function addToFormData(formdata, fileDetails) {
      formdata.append('file', fileDetails.file, fileDetails.processedFileName);
      if (fileDetails.thumb) {
        formdata.append('thumb', fileDetails.thumb, fileDetails.thumbName);
      }
    };

    var uploadSingleResource = function uploadSingleResource(fileDetails) {
      return new Promise(function (resolve, reject) {
        if (!_appId && !getAppId()) {
          reject();
          return;
        }

        var formdata = getFormDataFromFileDetails(fileDetails);

        var portalUrl = _Helper2.default.stripTrailingSlash((_portal || getPortal()).portalUrl);
        var owner = getOwner();
        var folder = (_appItem || getAppItem()).item.ownerFolder;

        var uploadUrl = portalUrl + '/content/users/' + owner + (folder ? '/' + folder : '') + '/items/' + _appId + '/addResources';

        (0, _request2.default)({
          url: uploadUrl,
          handleAs: 'json',
          form: formdata
        }, {
          usePost: true
        }).then(function (result) {
          if (result.success) {
            var resourcesUrl = getResourcesUrl();
            var picUrl = resourcesUrl + encodeURIComponent(fileDetails.processedFileName);
            var thumbUrl = fileDetails.thumb ? resourcesUrl + encodeURIComponent(fileDetails.thumbName) : null;
            resolve(Object.assign(result, { picUrl: picUrl, thumbUrl: thumbUrl }));
          } else {
            reject(result);
          }
        }, function (err) {
          reject(err);
        });
      });
    };

    var removeResources = function removeResources(item) {
      return new Promise(function (resolve, reject) {
        if (!_appId && !getAppId()) {
          reject();
          return;
        }
        var portalUrl = _Helper2.default.stripTrailingSlash((_portal || getPortal()).portalUrl);
        var owner = getOwner();
        var folder = (_appItem || getAppItem()).item.ownerFolder;

        var removeUrl = portalUrl + '/content/users/' + owner + (folder ? '/' + folder : '') + '/items/' + _appId + '/removeResources';

        (0, _request2.default)({
          url: removeUrl,
          handleAs: 'json',
          content: {
            resource: item.fileName,
            f: 'json'
          }
        }, {
          usePost: true
        }).then(function (result) {
          if (result.success) {
            resolve();
          } else {
            console.warn('removeResources .then !result.success', result);
            reject(result);
          }
        }, function (err) {
          console.warn('removeResources errback', err);
          reject(err);
        });
        if (item.thumbFile && item.thumbFile !== item.fileName) {
          (0, _request2.default)({
            url: removeUrl,
            handleAs: 'json',
            content: {
              resource: item.thumbFile,
              f: 'json'
            }
          }, {
            usePost: true
          }).then(function (result) {
            if (!result || !result.success) {
              console.warn('unsuccessful deletion of thumbnail file');
            }
          }, function (err) {
            console.warn('unsuccessful deletion of thumbnail file', err);
          });
        }
      });
    };

    var formatResources = function formatResources(resources) {
      var resourcesUrl = getResourcesUrl();
      var returnArr = [];

      resources.forEach(function (resource) {
        // resource is currently an object with a single
        // property, "resource", which is the file name. make a shortcut to it.

        var r = resource.resource;

        // skip the __thumb files
        if (r.indexOf('__thumb') >= 0) {
          return;
        }
        var nameSplit = r.split('__');
        var endSplit = nameSplit.slice(-1)[0].split('.');
        var fileExt = endSplit.slice(-1)[0];
        var type = getResourceType(fileExt);
        // skip the unsupported resource types
        if (!type) {
          return;
        }

        var thumbFile = findThumbUrl(r, resources);
        var thumbUrl = _Helper2.default.stripTrailingSlash(resourcesUrl) + '/' + encodeURIComponent(thumbFile);
        var tokenizedThumbUrl = thumbUrl + '?token=' + _portalUser.credential.token;
        var name = nameSplit.length === 1 ? nameSplit[0] : nameSplit.slice(0, -1).join('__') + '.' + fileExt;
        // TODO: what to do with files that don't have datestamps in their titles?
        var modified = endSplit[0].match(/^[0-9]{13}$/) ? new Date(parseInt(endSplit[0])) : '';

        returnArr.push({
          name: name,
          modified: modified,
          thumbUrl: thumbUrl,
          tokenizedThumbUrl: tokenizedThumbUrl,
          thumbFile: thumbFile,
          type: type,
          picUrl: _Helper2.default.stripTrailingSlash(resourcesUrl) + '/' + r,
          displayName: text.filterAndSort.image,
          id: r, // these need unique ids for react gallery item array
          fileName: r,
          title: name,
          fromResources: true
        });
      });
      return returnArr;
    };

    var findThumbUrl = function findThumbUrl(originalResourceName, allResources) {
      var lastDot = originalResourceName.lastIndexOf('.');
      var originalNameWithoutExtension = lastDot >= 0 ? originalResourceName.substr(0, lastDot) : originalResourceName;
      var thumbFile = allResources.find(function (resource) {
        var r = resource.resource;
        // skip the non-thumb files
        if (r.indexOf('__thumb') < 0) {
          return false;
        }
        if (r.indexOf(originalNameWithoutExtension) === 0) {
          return true;
        }
        return false;
      });
      thumbFile = thumbFile ? thumbFile.resource : originalResourceName;
      return thumbFile;
    };

    var formatResults = function formatResults(results) {
      return results.map(function (result) {
        return Object.assign({
          name: result.title,
          title: result.title,
          id: result.id,
          agolType: result.type, // used by gallery item to identify agol items
          type: standardizeItemType(result.type),
          displayName: result.displayName,
          owner: result.owner,
          modified: result.modified,
          snippet: result.snippet
        }, getThumbUrlOptions(result));
      });
    };

    var getResourceType = function getResourceType(fileExt) {
      if (!fileExt) {
        return false;
      }
      fileExt = '.' + fileExt.toLowerCase();
      for (var key in _constants2.default.contentType) {
        if (_constants2.default.uploadFileExtensions[key]) {
          if (_constants2.default.uploadFileExtensions[key].indexOf(fileExt) >= 0) {
            return _constants2.default.contentType[key];
          }
        }
      }
      return false;
    };

    var standardizeItemType = function standardizeItemType(agolType) {
      switch (agolType) {
        case _constants2.default.agolContentType.WEBMAP:
          return _constants2.default.contentType.WEBMAP;
        case _constants2.default.agolContentType.WEBSCENE:
          return _constants2.default.contentType.WEBSCENE;
        case _constants2.default.agolContentType.IMAGE:
          return _constants2.default.contentType.IMAGE;
        default:
          console.warn('no type found for', agolType);
          return 'agh, whats this???';
      }
    };

    var getThumbUrlOptions = function getThumbUrlOptions(item) {
      var thumbUrl = item.thumbnailUrl;
      if (!thumbUrl) {
        var baseUrl = app.portal.staticImagesUrl;
        if (!baseUrl) {
          console.warn('no staticImagesUrl in portal');
          return {};
        }
        switch (item.type) {
          case _constants2.default.agolContentType.WEBSCENE:
            thumbUrl = baseUrl + '/scene.png';
            break;
          case _constants2.default.agolContentType.WEBMAP:
          default:
            thumbUrl = baseUrl + '/desktopapp.png';
        }
      }
      return {
        thumbUrl: thumbUrl,
        thumbHeight: 133,
        thumbWidth: 200
      };
    };

    var buildIdQuery = function buildIdQuery(ids) {
      return 'id:' + ids.join(' OR id:');
    };

    var buildQ = function buildQ(options) {
      // build an array of everything we want in our q string, then join with a space.
      var qArr = [];

      // if a search string exists, add it first.
      if (options.searchStr) {
        qArr.push(processSearchStr(options.searchStr));
      }

      // add the content type and search location strings to q
      qArr.push.apply(qArr, _toConsumableArray(options.contentTypesArr).concat([buildLocQ(options.searchLocation)]));

      return qArr.join(' ');
    };

    var processSearchStr = function processSearchStr(str) {
      if (str.match(/^[A-Fa-f0-9]{32}$/)) {
        return 'id:' + str;
      }
      return str;
    };

    var buildTypeQ = function buildTypeQ(contentTypeArr) {
      var includeArr = [],
          excludeArr = [];
      if (contentTypeArr.indexOf(_constants2.default.contentType.WEBMAP) >= 0) {
        includeArr.push('type:"Web Map"');
        excludeArr.push('-type:"Web Mapping Application"');
      }
      if (contentTypeArr.indexOf(_constants2.default.contentType.WEBSCENE) >= 0) {
        includeArr.push('type:"Web Scene"');
        excludeArr.push('-type:"CityEngine Web Scene"');
      }
      if (includeArr.length === 0) {
        return false;
      }
      var includeStr = void 0;
      if (includeArr.length === 1) {
        includeStr = includeArr[0];
      } else {
        includeStr = '(' + includeArr.join(' OR ') + ')';
      }
      var excludeStr = excludeArr.join(' ');
      return [includeStr, excludeStr];
    };

    var buildLocQ = function buildLocQ(searchLocation) {
      switch (searchLocation) {
        case _constants2.default.searchLocation.ORG:
          return 'orgid:' + _portalUser.orgId;
        case _constants2.default.searchLocation.MINE:
          return 'owner:' + _portalUser.username;
        case _constants2.default.searchLocation.AGOL:
          return ''; // no search location is all of agol
        default:
          console.warn('TODO: deal with searchLocation', searchLocation);
          return '';
      }
    };

    return {
      checkSignin: checkSignin,
      getItems: getItems,
      getPortal: getPortal,
      getAppItem: getAppItem,
      getAppId: getAppId,
      getAppIdPromise: getAppIdPromise,
      getUser: getUser,
      uploadSingleResource: uploadSingleResource,
      removeResources: removeResources,
      formatResources: formatResources
    };
  }();
  window.Connector = ArcGISConnector;
  exports.ArcGISConnector = ArcGISConnector;
});
//# sourceMappingURL=ArcGIS.js.map
;
//name: Hermite resize
//about: Fast image resize/resample using Hermite filter with JavaScript.
//author: ViliusL
//demo: http://viliusle.github.io/miniPaint/
function resample_hermite(canvas, W, H, W2, H2){
	var time1 = Date.now();
	W2 = Math.round(W2);
	H2 = Math.round(H2);
	var img = canvas.getContext("2d").getImageData(0, 0, W, H);
	var img2 = canvas.getContext("2d").getImageData(0, 0, W2, H2);
	var data = img.data;
	var data2 = img2.data;
	var ratio_w = W / W2;
	var ratio_h = H / H2;
	var ratio_w_half = Math.ceil(ratio_w/2);
	var ratio_h_half = Math.ceil(ratio_h/2);
	
	for(var j = 0; j < H2; j++){
		for(var i = 0; i < W2; i++){
			var x2 = (i + j*W2) * 4;
			var weight = 0;
			var weights = 0;
			var weights_alpha = 0;
			var gx_r = gx_g = gx_b = gx_a = 0;
			var center_y = (j + 0.5) * ratio_h;
			for(var yy = Math.floor(j * ratio_h); yy < (j + 1) * ratio_h; yy++){
				var dy = Math.abs(center_y - (yy + 0.5)) / ratio_h_half;
				var center_x = (i + 0.5) * ratio_w;
				var w0 = dy*dy //pre-calc part of w
				for(var xx = Math.floor(i * ratio_w); xx < (i + 1) * ratio_w; xx++){
					var dx = Math.abs(center_x - (xx + 0.5)) / ratio_w_half;
					var w = Math.sqrt(w0 + dx*dx);
					if(w >= -1 && w <= 1){
						//hermite filter
						weight = 2 * w*w*w - 3*w*w + 1;
						if(weight > 0){
							dx = 4*(xx + yy*W);
							//alpha
							gx_a += weight * data[dx + 3];
							weights_alpha += weight;
							//colors
							if(data[dx + 3] < 255)
								weight = weight * data[dx + 3] / 250;
							gx_r += weight * data[dx];
							gx_g += weight * data[dx + 1];
							gx_b += weight * data[dx + 2];
							weights += weight;
							}
						}
					}		
				}
			data2[x2]     = gx_r / weights;
			data2[x2 + 1] = gx_g / weights;
			data2[x2 + 2] = gx_b / weights;
			data2[x2 + 3] = gx_a / weights_alpha;
			}
		}
	console.log("hermite = "+(Math.round(Date.now() - time1)/1000)+" s");
	canvas.getContext("2d").clearRect(0, 0, Math.max(W, W2), Math.max(H, H2));
	canvas.width = W2;
	canvas.height = H2;
	canvas.getContext("2d").putImageData(img2, 0, 0);
	}
;
define("lib/resample-hermite/hermite", function(){});

/*!
 * Loader v0.1.1
 * https://github.com/fengyuanchen/loader
 *
 * Copyright (c) 2015 Fengyuan Chen
 * Released under the MIT license
 *
 * Date: 2015-12-25T06:57:42.553Z
 */

(function (global, factory) {
  if (typeof module === 'object' && typeof module.exports === 'object') {
    module.exports = factory(global, true);
  } else {
    factory(global);
  }
})(typeof window !== 'undefined' ? window : this, function (window, noGlobal) {

  'use strict';


  // Variables
  // ---------------------------------------------------------------------------

  // Globals
  var ArrayBuffer = window.ArrayBuffer;

  // RegExps
  var REGEXP_DATA_URL = /^data\:/;
  var REGEXP_DATA_URL_HEAD = /^data\:([^\;]+)\;base64,/;
  var REGEXP_DATA_URL_JPEG = /^data\:image\/jpeg.*;base64,/;

  // Maths
  var PI = Math.PI;
  var min = Math.min;
  var max = Math.max;
  var sin = Math.sin;
  var cos = Math.cos;
  var abs = Math.abs;
  var floor = Math.floor;

  // Shortcuts
  var objectProto = Object.prototype;
  var toString = objectProto.toString;
  var hasOwnProperty = objectProto.hasOwnProperty;
  var fromCharCode = String.fromCharCode;


  // Utilities
  // ---------------------------------------------------------------------------

  function typeOf(obj) {
    return toString.call(obj).slice(8, -1).toLowerCase();
  }

  function isNumber(num) {
    return typeof num === 'number' && !isNaN(num);
  }

  function isObject(obj) {
    return typeof obj === 'object' && obj !== null;
  }

  function isPlainObject(obj) {
    var constructor;
    var prototype;

    if (!isObject(obj)) {
      return false;
    }

    try {
      constructor = obj.constructor;
      prototype = constructor.prototype;

      return constructor && prototype && hasOwnProperty.call(prototype, 'isPrototypeOf');
    } catch (e) {
      return false;
    }
  }

  function isFunction(fn) {
    return typeOf(fn) === 'function';
  }

  function isArray(arr) {
    return Array.isArray ? Array.isArray(arr) : typeOf(arr) === 'array';
  }

  function toArray(obj, offset) {
    var args = [];

    offset = offset >= 0 ? offset : 0;

    if (Array.from) {
      return Array.from(obj).slice(offset);
    }

    return args.slice.call(obj, offset);
  }

  function each(obj, callback) {
    var length;
    var i;

    if (obj && isFunction(callback)) {
      if (isArray(obj) || isNumber(obj.length)/* array-like */) {
        for (i = 0, length = obj.length; i < length; i++) {
          if (callback.call(obj, obj[i], i, obj) === false) {
            break;
          }
        }
      } else if (isObject(obj)) {
        for (i in obj) {
          if (obj.hasOwnProperty(i)) {
            if (callback.call(obj, obj[i], i, obj) === false) {
              break;
            }
          }
        }
      }
    }

    return obj;
  }

  function extend(obj) {
    var args;

    if (arguments.length > 1) {
      args = toArray(arguments);

      if (Object.assign) {
        return Object.assign.apply(Object, args);
      }

      args.shift();

      each(args, function (arg) {
        each(arg, function (prop, i) {
          obj[i] = prop;
        });
      });
    }

    return obj;
  }

  function proxy(fn, context) {
    var args = toArray(arguments, 2);

    return function () {
      return fn.apply(context, args.concat(toArray(arguments)));
    };
  }

  function getStringFromCharCode(dataView, start, length) {
    var str = '';
    var i = start;

    for (length += start; i < length; i++) {
      str += fromCharCode(dataView.getUint8(i));
    }

    return str;
  }

  function dataURLToArrayBuffer(dataURL) {
    var base64 = dataURL.replace(REGEXP_DATA_URL_HEAD, '');
    var binary = atob(base64);
    var length = binary.length;
    var arrayBuffer = new ArrayBuffer(length);
    var dataView = new Uint8Array(arrayBuffer);
    var i;

    for (i = 0; i < length; i++) {
      dataView[i] = binary.charCodeAt(i);
    }

    return arrayBuffer;
  }

  // Only available for JPEG image
  function arrayBufferToDataURL(arrayBuffer) {
    var dataView = new Uint8Array(arrayBuffer);
    var length = dataView.length;
    var base64 = '';
    var i;

    for (i = 0; i < length; i++) {
      base64 += fromCharCode(dataView[i]);
    }

    return 'data:image/jpeg;base64,' + btoa(base64);
  }

  function createImage(url) {
    var image = new Image();

    image.src = url;

    return image;
  }

  function getRotatedSizes(data) {
    var deg = abs(data.degree) % 180;
    var arc = (deg > 90 ? (180 - deg) : deg) * PI / 180;
    var sinArc = sin(arc);
    var cosArc = cos(arc);
    var width = data.width;
    var height = data.height;

    return {
      width: width * cosArc + height * sinArc,
      height: width * sinArc + height * cosArc
    };
  }

  // Constructor
  // ---------------------------------------------------------------------------

  /**
   * Loader constructor
   *
   * @param {HTMLImageElement} image
   * @param {Object} options
   */
  function Loader(image, options) {
    this.image = image;
    this.options = extend({}, Loader.DEFAULTS, isPlainObject(options) && options);
    this.data = null;
    this.init();
  }

  Loader.prototype = {
    constructor: Loader,

    init: function () {
      var _this = this;
      var image = this.image;
      var xhr;
      var url;

      if (image && image.tagName.toLowerCase() === 'img' && image.src) {
        if (!ArrayBuffer) {
          return this.load(image);
        }

        url = image.src;

        // XMLHttpRequest disallows to open a Data URL in some browsers like IE11 and Safari
        if (REGEXP_DATA_URL.test(url)) {
          return REGEXP_DATA_URL_JPEG.test(url) ?
            this.read(dataURLToArrayBuffer(url)) :
            this.load(image);
        }

        xhr = new XMLHttpRequest();

        xhr.onerror = xhr.onabort = function () {
          _this.load(image);
        };

        xhr.onload = function () {
          _this.read(this.response);
        };

        xhr.open('get', url);
        xhr.responseType = 'arraybuffer';
        xhr.send();
      } else {
        throw new Error('The given image is not a valid image');
      }
    },

    read: function (arrayBuffer) {
      var orientation = this.readOrientation(arrayBuffer);

      if (orientation > 1) {
        this.translate(orientation);
        this.load(createImage(arrayBufferToDataURL(arrayBuffer)));
      } else {
        this.load(this.image);
      }
    },

    readOrientation: function (arrayBuffer) {
      var dataView = new DataView(arrayBuffer);
      var length = dataView.byteLength;
      var orientation;
      var exifIDCode;
      var tiffOffset;
      var firstIFDOffset;
      var littleEndian;
      var endianness;
      var app1Start;
      var ifdStart;
      var offset;
      var i;

      // Only handle JPEG image (0xFFD8)
      if (dataView.getUint8(0) === 0xFF && dataView.getUint8(1) === 0xD8) {
        offset = 2;

        while (offset < length) {
          if (dataView.getUint8(offset) === 0xFF && dataView.getUint8(offset + 1) === 0xE1) {
            app1Start = offset;
            break;
          }

          offset++;
        }
      }

      if (app1Start) {
        exifIDCode = app1Start + 4;
        tiffOffset = app1Start + 10;

        if (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {
          endianness = dataView.getUint16(tiffOffset);
          littleEndian = endianness === 0x4949;

          if (littleEndian || endianness === 0x4D4D /* bigEndian */) {
            if (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002A) {
              firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);

              if (firstIFDOffset >= 0x00000008) {
                ifdStart = tiffOffset + firstIFDOffset;
              }
            }
          }
        }
      }

      if (ifdStart) {
        length = dataView.getUint16(ifdStart, littleEndian);

        for (i = 0; i < length; i++) {
          offset = ifdStart + i * 12 + 2;

          if (dataView.getUint16(offset, littleEndian) === 0x0112 /* Orientation */) {

            // Get the original orientation value
            orientation = dataView.getUint16(offset + 8, littleEndian);

            // Override the orientation with the default value: 1
            dataView.setUint16(offset + 8, 1, littleEndian);
            break;
          }
        }
      }

      return orientation;
    },

    translate: function (orientation) {
      var rotate = 0;
      var scaleX = 1;
      var scaleY = 1;

      switch (orientation) {

        // horizontal flip
        case 2:
          scaleX = -1;
          break;

        // 180 rotate left
        case 3:
          rotate = -180;
          break;

        // vertical flip
        case 4:
          scaleY = -1;
          break;

        // vertical flip + 90 rotate right
        case 5:
          rotate = 90;
          scaleY = -1;
          break;

        // 90 rotate right
        case 6:
          rotate = 90;
          break;

        // horizontal flip + 90 rotate right
        case 7:
          rotate = 90;
          scaleX = -1;
          break;

        // 90 rotate left
        case 8:
          rotate = -90;
          break;
      }

      this.data = {
        rotate: rotate,
        scaleX: scaleX,
        scaleY: scaleY
      };
    },

    load: function (image) {
      var load = proxy(function () {
            image.removeEventListener('load', load, false);
            this.resize(image);
          }, this);

      if (image.complete) {
        this.resize(image);
      } else {
        image.addEventListener('load', load, false);
      }
    },

    draw: function (image) {
      var canvas = document.createElement('canvas');
      var context = canvas.getContext('2d');
      var data = this.data;
      var x = 0;
      var y = 0;
      var width = image.naturalWidth;
      var height = image.naturalHeight;
      var rotate = data && data.rotate;
      var scaleX = data && data.scaleX;
      var scaleY = data && data.scaleY;
      var scalable = isNumber(scaleX) && isNumber(scaleY) && (scaleX !== 1 || scaleY !== 1);
      var rotatable = isNumber(rotate) && rotate !== 0;
      var advanced = rotatable || scalable;
      var canvasWidth = width;
      var canvasHeight = height;
      var translateX;
      var translateY;
      var rotated;

      if (scalable) {
        translateX = width / 2;
        translateY = height / 2;
      }

      if (rotatable) {
        rotated = getRotatedSizes({
          width: width,
          height: height,
          degree: rotate
        });

        canvasWidth = rotated.width;
        canvasHeight = rotated.height;
        translateX = rotated.width / 2;
        translateY = rotated.height / 2;
      }

      canvas.width = canvasWidth;
      canvas.height = canvasHeight;

      if (advanced) {
        x = -width / 2;
        y = -height / 2;

        context.save();
        context.translate(translateX, translateY);
      }

      if (rotatable) {
        context.rotate(rotate * PI / 180);
      }

      // Should call `scale` after rotated
      if (scalable) {
        context.scale(scaleX, scaleY);
      }

      context.drawImage(image, floor(x), floor(y), floor(width), floor(height));

      if (advanced) {
        context.restore();
      }

      return canvas;
    },

    resize: function (image) {
      var options = this.options;
      var canvas = this.draw(image);
      var width = canvas.width;
      var height = canvas.height;
      var aspectRatio = width / height;
      var newCanvas = document.createElement('canvas');
      var minWidth = max(0, options.minWidth) || 0;
      var minHeight = max(0, options.minHeight) || 0;
      var maxWidth = max(minWidth, options.maxWidth) || Infinity;
      var maxHeight = max(minHeight, options.maxHeight) || Infinity;
      var newWidth = abs(options.width) || width;
      var newHeight =  abs(options.height) || height;

      if (minWidth > 0 && isFinite(minWidth)) {
        minHeight = minWidth / aspectRatio;
      } else if (minHeight > 0 && isFinite(minHeight)) {
        minWidth = minHeight * aspectRatio;
      }

      if (maxWidth > 0 && isFinite(maxWidth)) {
        maxHeight = maxWidth / aspectRatio;
      } else if (maxHeight > 0 && isFinite(maxHeight)) {
        maxWidth = maxHeight * aspectRatio;
      }

      newWidth = min(max(newWidth, minWidth), maxWidth);
      newHeight = min(max(newHeight, minHeight), maxHeight);

      if (isNumber(newWidth) && isNumber(newHeight)) {
        if (newHeight * aspectRatio > newWidth) {
          newHeight = newWidth / aspectRatio;
        } else {
          newWidth = newHeight * aspectRatio;
        }
      } else {
        newWidth = width;
        newHeight = height;
      }

      newCanvas.width = newWidth;
      newCanvas.height = newHeight;

      newCanvas.getContext('2d').drawImage(
        canvas,
        0, 0, floor(width), floor(height),
        0, 0, floor(newWidth), floor(newHeight)
      );

      this.done(newCanvas);
    },

    done: function (canvas) {
      var options = this.options;
      var result = canvas;

      if (options.type === 'image') {
        result = createImage(canvas.toDataURL());
      }

      if (isFunction(options.done)) {
        options.done.call(this, result);
      }
    }
  };

  Loader.DEFAULTS = {

    // String: the type of the loaded image or canvas
    type: 'image',

    // Number: the size limitation of the loaded image or canvas
    width: NaN,
    height: NaN,
    minWidth: 0,
    minHeight: 0,
    maxWidth: Infinity,
    maxHeight: Infinity,

    // Function: load complete callback
    done: null
  };


  // No Conflict
  // ---------------------------------------------------------------------------

  var _Loader = window.Loader;

  Loader.noConflict = function () {
    window.Loader = _Loader;
    return Loader;
  };


  // Export
  // ---------------------------------------------------------------------------

  if (typeof define === 'function' && define.amd) {
    define('loader', [], function () {
      return Loader;
    });
  }

  if (typeof noGlobal === 'undefined') {
    window.Loader = Loader;
  }

  return Loader;

});

define("lib/loader/dist/loader", function(){});


define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/FileUploader/FileUploader',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/FileUploader/FileUploader',['module', 'exports', 'jquery', 'react', 'dojo/Deferred', '../../../utils/Helper', 'lib-build/i18n!../../../../../_resources/nls/media', 'dojo/topic', '../../../constants', './NewerImageUploadHelper', '../../../connectors/ArcGIS', 'lib/resample-hermite/hermite', 'lib/loader/dist/loader', 'lib-build/less!./FileUploader'], function (module, exports, _jquery, _react, _Deferred, _Helper, _media, _topic, _constants, _NewerImageUploadHelper, _ArcGIS) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _jquery2 = _interopRequireDefault(_jquery);

  var _react2 = _interopRequireDefault(_react);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  var _Helper2 = _interopRequireDefault(_Helper);

  var _media2 = _interopRequireDefault(_media);

  var _topic2 = _interopRequireDefault(_topic);

  var _constants2 = _interopRequireDefault(_constants);

  var _NewerImageUploadHelper2 = _interopRequireDefault(_NewerImageUploadHelper);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _toConsumableArray(arr) {
    if (Array.isArray(arr)) {
      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
        arr2[i] = arr[i];
      }

      return arr2;
    } else {
      return Array.from(arr);
    }
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.sidePanel.agol;

  var FileUploader = function (_React$Component) {
    _inherits(FileUploader, _React$Component);

    function FileUploader(props) {
      _classCallCheck(this, FileUploader);

      var _this = _possibleConstructorReturn(this, (FileUploader.__proto__ || Object.getPrototypeOf(FileUploader)).call(this, props));

      _this.state = {
        dragging: false,
        fileError: false,
        singleFile: true,
        contentTypes: [],
        uploadExtensions: []
      };
      window.globalFileUploader = _this;
      window.globalConstants = _constants2.default;

      _this.checkForCapabilities();

      _this.fileChange = _this.fileChange.bind(_this);
      _this.onDragOver = _this.onDragOver.bind(_this);
      _this.onDragLeave = _this.onDragLeave.bind(_this);
      _this.onDrop = _this.onDrop.bind(_this);
      return _this;
    }

    _createClass(FileUploader, [{
      key: 'checkForCapabilities',
      value: function checkForCapabilities() {
        // check for dnd capabilities up front, not on every render
        this.hasDnD = !navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i) && 'draggable' in document.createElement('span') && typeof window.FileReader !== 'undefined';
        this.useCapture = navigator.userAgent.match(/iPad|iPhone|iPod/g);
      }
    }, {
      key: 'componentDidMount',
      value: function componentDidMount() {
        if (this.hasDnD && !window.dndDisabled) {
          this.addDnDListener();
        }
      }
    }, {
      key: 'componentWillReceiveProps',
      value: function componentWillReceiveProps(nextProps) {
        var uploadExtensions = [];
        var contentTypes = [];
        for (var key in _constants2.default.contentType) {
          if (nextProps.authorizedMedia.indexOf(_constants2.default.contentType[key]) >= 0) {
            if (_constants2.default.uploadFileExtensions[key]) {
              uploadExtensions.push.apply(uploadExtensions, _toConsumableArray(_constants2.default.uploadFileExtensions[key]));
              contentTypes.push(_constants2.default.contentType[key]);
            }
          }
        }
        this.setState({
          contentTypes: contentTypes,
          uploadExtensions: uploadExtensions
        });
      }
    }, {
      key: 'addDnDListener',
      value: function addDnDListener() {
        // prevent drag and drop anywhere in the window
        // (by default, would open file and lose place in app configuration)
        window.dndDisabled = true;
        window.addEventListener('dragover', function (evt) {
          if (evt && !(0, _jquery2.default)(evt.target).hasClass('drag-area')) {
            evt.preventDefault();
          }
        });
        window.addEventListener('drop', function (evt) {
          if (evt) {
            evt.preventDefault();
          }
        });
      }
    }, {
      key: 'validateFile',
      value: function validateFile(file) {
        var ext = file.name.slice(file.name.lastIndexOf('.')).toLowerCase();
        var simplifiedType = this.getSimplifiedType(file.type);
        var comparison = this.state.uploadExtensions;
        return comparison.some(function (filetype) {
          return filetype === ext || filetype === file.type || filetype === simplifiedType;
        });
      }
    }, {
      key: 'validateDrag',
      value: function validateDrag(items) {
        var i = 0,
            matching = true;
        while (i < items.length && matching) {
          var simplifiedType = this.getSimplifiedType(items[i].type);
          matching = this.state.contentTypes.indexOf(simplifiedType) >= 0;
          i++;
        }
        return !matching;
      }
    }, {
      key: 'getSimplifiedType',
      value: function getSimplifiedType(originalType) {
        return originalType.substring(0, originalType.indexOf('/'));
      }
    }, {
      key: 'fileChange',
      value: function fileChange(e) {

        var files = e.target ? e.target.files : e;

        if (files && files.length) {
          var singleFile = files.length === 1;
          this.setState({ singleFile: singleFile });
          if (!singleFile) {
            this.props.fileUploadFunctions.multiStart();
          }

          var processingOptions = this.sequentialPreprocessing(files, singleFile);
          this.sequentialProcessing(processingOptions);

          // let uploadArr = [];
          // for (let i = 0; i < files.length; i++) {
          //   uploadArr.push(
          //     this.processOneFile(files[i], singleFile).catch((err) => {
          //       console.warn('processOneFile rejected. err:', err);
          //       this.props.fileUploadFunctions.singleFailure(files[i]);
          //     })
          //   );
          // }
          // Promise.all(uploadArr).then(() => {
          //   this.props.fileUploadFunctions.allComplete();
          // }, () => {
          //   console.warn('Promise.all failure');
          //   this.props.fileUploadFunctions.allComplete();
          // });
        }
      }
    }, {
      key: 'sequentialPreprocessing',
      value: function sequentialPreprocessing(files, singleFile) {
        var _this2 = this;

        var namesArr = [],
            filesArr = [];
        for (var i = 0; i < files.length; i++) {
          if (this.validateFile(files[i])) {
            filesArr.push(files[i]);
            // need to create names upfront because name is linked to time,
            // and we want to put placeholders in for each image immediately,
            // but since we're processing sequentially, we need to capture the
            // name we used for each file. but also don't want every file to have
            // the same date, so offset by a microsecond for each file.
            // (files.length - i is to get the first file in the upload list to have
            // the most recent, not the least recent time, so it'll show up first on date sort)
            namesArr.push(this.getUploadFileNames(files[i], files.length - i));
          } else {
            this.setErrorTimer();
          }
        }

        if (!singleFile) {
          namesArr.forEach(function (names) {
            _this2.props.fileUploadFunctions.singleProgress(Object.assign({
              dataUrl: _constants2.default.blankBackground
            }, names));
          });
        }
        return { namesArr: namesArr, filesArr: filesArr, singleFile: singleFile, uploadArr: [], processArr: [], i: 0 };
      }
    }, {
      key: 'sequentialProcessing',
      value: function sequentialProcessing(params) {
        var _this3 = this;

        if (params.i < params.filesArr.length) {
          var processedDef;

          (function () {
            var names = params.namesArr[params.i];
            var file = params.filesArr[params.i];

            processedDef = _this3.processOneFileSequentially(file, params.singleFile, names);

            params.processArr.push(processedDef);

            processedDef.then(function (processedResult) {
              var uploadDef = _this3.uploadOneFileSequentially(processedResult, params.singleFile, names);
              params.uploadArr.push(uploadDef);
              params.i++;
              _this3.sequentialProcessing(params);
            }).catch(function (err) {
              console.warn('processOneFileSequentially rejected. err: ', err);
              _this3.props.fileUploadFunctions.singleFailure(Object.assign({}, file, names));
              params.i++;
              _this3.sequentialProcessing(params);
            });
          })();
        } else {
          Promise.all(params.processArr).then(function () {
            _this3.onAllProcessingComplete(params.uploadArr);
          }, function () {
            console.warn('Promise.all failure');
            // on failure, still trigger allComplete
            // but do we need a timeout or something here...?
            _this3.onAllProcessingComplete(params.uploadArr);
          });
        }
      }
    }, {
      key: 'onAllProcessingComplete',
      value: function onAllProcessingComplete(uploadArr) {
        var _this4 = this;

        Promise.all(uploadArr).then(function () {
          _this4.resetPicker();
          _this4.props.fileUploadFunctions.allComplete();
        }, function () {
          return _this4.props.fileUploadFunctions.allComplete;
        });
      }
    }, {
      key: 'processOneFileSequentially',
      value: function processOneFileSequentially(file, isSingle, names) {
        var _this5 = this;

        return new Promise(function (resolve, reject) {
          if (!_this5.validateFile(file)) {
            _this5.setErrorTimer();
            reject();
            return;
          }
          _this5.processFile(file, isSingle).then(function (result) {
            Object.assign(result, names);
            if (!isSingle) {
              // update the container with the file's thumbnail
              _this5.props.fileUploadFunctions.singleProgress(result);
            }
            resolve(result);
          }).catch(function (result) {
            console.warn('rejecting processFile', result);
            reject({ file: Object.assign({}, file, names), result: result });
          });
        });
      }
    }, {
      key: 'uploadOneFileSequentially',
      value: function uploadOneFileSequentially(fileDetails, isSingle, names) {
        var _this6 = this;

        return new Promise(function (resolve, reject) {
          _this6.fileUploadToAGOL(fileDetails, isSingle).then(function (uploadResult) {
            _this6.props.fileUploadFunctions.singleComplete(Object.assign(fileDetails, uploadResult));
            resolve();
          }, function (err) {
            console.warn('fileUploadToAGOL catch. err:', err);
            Object.assign(fileDetails, names);
            reject(err);
          });
        });
      }
    }, {
      key: 'processOneFile',
      value: function processOneFile(file, isSingle) {
        var _this7 = this;

        return new Promise(function (resolve, reject) {
          // validate file -- look for matching file extension from allowed extensions
          if (_this7.validateFile(file)) {
            (function () {
              var names = _this7.getUploadFileNames(file);

              if (!isSingle) {
                // pass a blank background back to the container for a placeholder while the thumbnail is generated
                _this7.props.fileUploadFunctions.singleProgress(Object.assign({ dataUrl: _constants2.default.blankBackground }, names));
              }

              _this7.processFile(file, isSingle).then(function (result) {
                Object.assign(result, names);
                if (!isSingle) {
                  // update the container with the file's thumbnail
                  _this7.props.fileUploadFunctions.singleProgress(result);
                }
                _this7.fileUploadToAGOL(result, isSingle).then(function (uploadResult) {
                  _this7.props.fileUploadFunctions.singleComplete(Object.assign(result, uploadResult));
                  resolve();
                }, function (err) {
                  console.warn('fileUploadToAGOL catch. err:', err);
                  Object.assign(file, names);
                  reject(err);
                });
              }).catch(function (result) {
                console.warn('rejecting processFile', result);
                Object.assign(file, names);
                reject(result);
              });
            })();
          } else {
            console.warn('reject file', file.name);
            _this7.setErrorTimer();
            reject();
          }
        });
      }
    }, {
      key: 'processFile',
      value: function processFile(file, isSingle) {
        var simplifiedType = this.getSimplifiedType(file.type);
        switch (simplifiedType) {
          case 'image':
            return _NewerImageUploadHelper2.default.loadImageFromFile(file, isSingle);
          case 'audio':
          case 'video':
            console.warn('unhandled file type', simplifiedType);
            return;
          default:
            console.warn('unknown file type', file);
            return;
        }
      }
    }, {
      key: 'setErrorTimer',
      value: function setErrorTimer() {
        var _this8 = this;

        this.setState({ fileError: true });
        setTimeout(function () {
          _this8.setState({ fileError: false });
        }, 3000);
      }
    }, {
      key: 'onDragOver',
      value: function onDragOver(e) {
        e.preventDefault();
        e.stopPropagation();
        var walker = void 0;
        if ((walker = e.dataTransfer) && (walker = walker.items) && walker.length) {
          var err = this.validateDrag(walker);
          this.setState({
            dragging: true,
            canCheckFileOnDrag: true,
            fileError: err
          });
          return;
        }
        this.setState({
          dragging: true,
          canCheckFileOnDrag: false
        });
      }
    }, {
      key: 'onDragLeave',
      value: function onDragLeave(e) {
        e.preventDefault();
        e.stopPropagation();
        this.setState({
          dragging: false,
          fileError: false
        });
      }
    }, {
      key: 'onDrop',
      value: function onDrop(e) {
        this.setState({
          dragging: false
        });
        if (e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files.length) {
          e.preventDefault();
          e.stopPropagation();
          this.setState({ singleFile: e.dataTransfer.files.length === 1 });
          this.fileChange(e.dataTransfer.files);
        }
      }
    }, {
      key: 'getUploadFileNames',
      value: function getUploadFileNames(file, offset) {
        var fileName = file.name;
        var now = new Date();
        var lastDot = fileName.lastIndexOf('.');
        var name = lastDot >= 0 ? fileName.substr(0, lastDot) : fileName;
        var ext = lastDot >= 0 ? fileName.substr(lastDot) : file.type.substr(file.type.indexOf('/' + 1));
        var baseName = name + '__' + (now.getTime() + (offset || 0));
        return {
          processedFileName: baseName + ext,
          thumbName: baseName + '__thumb' + ext
        };
      }
    }, {
      key: 'fileUploadToAGOL',
      value: function fileUploadToAGOL(processedResult, isSingle) {
        var _this9 = this;

        var broadcastAfterUpload = false;
        var def = new _Deferred2.default();
        if (this.state.singleFile || isSingle) {
          if (processedResult.dataUrl) {
            this.broadcastChosenFile(Object.assign(processedResult, { uploadDeferred: def }));
          } else {
            broadcastAfterUpload = true;
          }
        }

        _ArcGIS.ArcGISConnector.uploadSingleResource(processedResult).then(function (uploadResult) {
          var urls = {
            url: uploadResult.picUrl,
            thumbUrl: uploadResult.thumbUrl
          };
          def.resolve(urls);
          if (broadcastAfterUpload) {
            Object.assign(processedResult, urls);
            if (processedResult.dataUrl) {
              processedResult.dataUrl = null;
            }
            _this9.broadcastChosenFile(processedResult);
          }
        }).catch(function (result) {
          console.warn('uploadSingleResource catch. result:', result);
          def.reject(result);
        });

        return def;
      }
    }, {
      key: 'broadcastChosenFile',
      value: function broadcastChosenFile(fileDetails) {
        var broadcastDetails = {
          type: fileDetails.type,
          width: fileDetails.width,
          height: fileDetails.height
        };
        if (fileDetails.uploadDeferred) {
          Object.assign(broadcastDetails, { uploadDeferred: fileDetails.uploadDeferred });
        }

        if (fileDetails.dataUrl) {
          Object.assign(broadcastDetails, { dataUrl: fileDetails.dataUrl });
        }

        if (fileDetails.url) {
          Object.assign(broadcastDetails, { url: fileDetails.url });
        }

        if (fileDetails.thumbUrl) {
          Object.assign(broadcastDetails, { thumbUrl: fileDetails.thumbUrl });
        }

        _topic2.default.publish('MEDIA-PICKER-SELECTION', broadcastDetails);
      }
    }, {
      key: 'resetPicker',
      value: function resetPicker() {
        this.refs.input.value = '';
      }
    }, {
      key: 'getFileTypesText',
      value: function getFileTypesText() {
        return this.state.uploadExtensions.join(text.createContent.listSeparator + ' ');
      }
    }, {
      key: 'forceClickInput',
      value: function forceClickInput(evt) {
        if (evt.charCode && evt.charCode === 13) {
          this.refs.input.click();
        }
      }
    }, {
      key: 'renderDnD',
      value: function renderDnD() {
        var _this10 = this;

        var uploaderClasses = _Helper2.default.classnames([this.props.className, 'drag-area', 'uploader', 'alert', {
          'alert-gray': !this.state.dragging && !this.state.fileError || this.state.dragging && !this.state.canCheckFileOnDrag,
          'alert-danger': this.state.fileError,
          'alert-success': this.state.dragging && this.state.canCheckFileOnDrag && !this.state.fileError
        }]);
        var fileExtClasses = _Helper2.default.classnames(['info-filetype', 'block-md', {
          'text-danger': this.state.fileError
        }]);

        return _react2.default.createElement(
          'div',
          {
            className: uploaderClasses,
            onDragOver: this.onDragOver,
            onDragLeave: this.onDragLeave,
            onDrop: this.onDrop },
          _react2.default.createElement('span', { className: 'bg-img fa fa-picture-o fa-5x' }),
          _react2.default.createElement(
            'span',
            { className: 'block-md' },
            _react2.default.createElement('span', { className: 'fa fa-hand-rock-o fa-lg' }),
            _react2.default.createElement(
              'span',
              null,
              text.createContent.dragAndDrop
            )
          ),
          _react2.default.createElement(
            'span',
            { className: 'block-md' },
            text.createContent.or
          ),
          _react2.default.createElement(
            'button',
            {
              type: 'button',
              className: 'btn btn-bw inverse btn-file block-md',
              tabIndex: '3',
              onKeyPress: function onKeyPress(evt) {
                return _this10.forceClickInput(evt);
              }
            },
            _react2.default.createElement('span', { className: 'fa fa-folder-open-o fa-lg' }),
            _react2.default.createElement(
              'span',
              null,
              text.createContent.uploadImage
            ),
            _react2.default.createElement('input', {
              multiple: 'multiple',
              id: this.props.id,
              ref: 'input',
              type: 'file',
              accept: this.state.uploadExtensions.toString(),
              capture: this.useCapture ? 'camera' : false,
              tabIndex: '-1',
              onChange: this.fileChange })
          ),
          _react2.default.createElement(
            'div',
            { className: fileExtClasses },
            _react2.default.createElement('span', { className: 'fa fa-file-o info' }),
            _react2.default.createElement('span', { className: 'fa fa-exclamation-triangle danger' }),
            _react2.default.createElement(
              'span',
              null,
              text.createContent.fileTypes,
              ' '
            ),
            _react2.default.createElement(
              'span',
              null,
              ' ',
              this.getFileTypesText()
            )
          ),
          _react2.default.createElement(
            'div',
            { className: 'info-footer' },
            _react2.default.createElement('span', { className: 'fa fa-lg fa-info-circle' }),
            _react2.default.createElement(
              'span',
              null,
              text.createContent.agolInfo
            )
          )
        );
      }
    }, {
      key: 'renderNoDnD',
      value: function renderNoDnD() {
        return _react2.default.createElement(
          'button',
          { type: 'button', className: 'uploader btn btn-bw inverse btn-file btn-block' },
          text.createContent.uploadImage,
          _react2.default.createElement('input', {
            id: this.props.id,
            ref: 'input',
            type: 'file',
            accept: this.state.uploadExtensions.toString(),
            capture: this.useCapture ? 'camera' : false,
            tabIndex: '-1',
            onChange: this.fileChange })
        );
      }
    }, {
      key: 'renderNoAppId',
      value: function renderNoAppId() {
        return _react2.default.createElement(
          'div',
          { className: 'drag-area uploader alert alert-gray' },
          _react2.default.createElement(
            'span',
            null,
            text.createContent.saveBeforeUpload
          )
        );
      }
    }, {
      key: 'render',
      value: function render() {

        var inputClasses = _Helper2.default.classnames([this.props.className, 'photo-input', 'form-group']);

        var fileUploader = void 0;
        if (!this.props.appId) {
          fileUploader = this.renderNoAppId();
        } else if (this.hasDnD) {
          fileUploader = this.renderDnD();
        } else {
          fileUploader = this.renderNoDnD();
        }

        return _react2.default.createElement(
          'div',
          { className: inputClasses },
          fileUploader
        );
      }
    }]);

    return FileUploader;
  }(_react2.default.Component);

  exports.default = FileUploader;
  module.exports = exports['default'];
});
//# sourceMappingURL=FileUploader.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanelArcGIS',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/sidePanel/SidePanelArcGIS',['module', 'exports', 'react', 'react-dom', '../../utils/Helper', './FileUploader/FileUploader', '../../constants', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./SidePanelArcGIS'], function (module, exports, _react, _reactDom, _Helper, _FileUploader, _constants, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _Helper2 = _interopRequireDefault(_Helper);

  var _FileUploader2 = _interopRequireDefault(_FileUploader);

  var _constants2 = _interopRequireDefault(_constants);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.sidePanel.agol;

  var SearchInput = function (_React$Component) {
    _inherits(SearchInput, _React$Component);

    function SearchInput() {
      _classCallCheck(this, SearchInput);

      return _possibleConstructorReturn(this, (SearchInput.__proto__ || Object.getPrototypeOf(SearchInput)).apply(this, arguments));
    }

    _createClass(SearchInput, [{
      key: 'componentDidMount',
      value: function componentDidMount() {
        var _this2 = this;

        var modal = $(_reactDom2.default.findDOMNode(this)).parents('.modal');
        modal.on('shown.bs.modal', function () {
          if (_this2.props.setFocus) {
            $(_this2.refs.textInput).focus();
          }
        });
      }
    }, {
      key: 'componentDidUpdate',
      value: function componentDidUpdate() {
        if (this.props.setFocus) {
          var activeEl = document.activeElement;
          // if someone is navigating by tabbing, don't take the focus off where they are
          var activeTabIndex = activeEl.tabIndex ? parseInt(activeEl.tabIndex) : 0;
          if (activeEl !== this.refs.textInput && activeTabIndex <= 0) {
            $(this.refs.textInput).focus();
          }
        }
      }
    }, {
      key: 'render',
      value: function render() {
        var _this3 = this;

        return _react2.default.createElement(
          'div',
          { className: 'input-group search' },
          _react2.default.createElement(
            'div',
            { className: 'input-group-addon' },
            _react2.default.createElement('span', { className: 'fa fa-' + this.props.icon })
          ),
          _react2.default.createElement('input', {
            ref: 'textInput',
            tabIndex: '2',
            type: 'text',
            disabled: this.props.disabled,
            value: this.props.value,
            className: 'form-control',
            placeholder: this.props.placeholder,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress }),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : this.props.value ? '2' : null,
              className: 'btn danger input-group-addon',
              style: this.props.value ? null : { display: 'none' },
              onClick: this.props.value ? function (evt) {
                return _this3.props.onClear(Object.assign({}, evt, { charCode: 13 }));
              } : null,
              onKeyPress: this.props.onClear,
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-remove' })
          ),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : '2',
              className: 'btn input-group-addon',
              onKeyPress: this.props.onKeyPress
              // treat click like enter
              , onClick: this.props.disabled ? null : function (evt) {
                return _this3.props.onKeyPress(Object.assign({}, evt, { charCode: 13 }));
              },
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-' + (this.props.loading ? 'refresh fa-spin' : 'search') })
          )
        );
      }
    }]);

    return SearchInput;
  }(_react2.default.Component);

  var LocationToggle = function (_React$Component2) {
    _inherits(LocationToggle, _React$Component2);

    function LocationToggle() {
      _classCallCheck(this, LocationToggle);

      return _possibleConstructorReturn(this, (LocationToggle.__proto__ || Object.getPrototypeOf(LocationToggle)).apply(this, arguments));
    }

    _createClass(LocationToggle, [{
      key: 'render',
      value: function render() {
        var labelClasses = _Helper2.default.classnames(['btn', 'btn-gray', {
          'col-xs-3': this.props.toggleCount === 4,
          'col-xs-4': this.props.toggleCount === 3,
          'active': this.props.checked,
          'disabled': this.props.isDisabled
        }]);

        return _react2.default.createElement(
          'label',
          {
            tabIndex: this.props.isDisabled ? null : '1',
            className: labelClasses,
            htmlFor: this.props.id,
            onKeyPress: this.props.onClick,
            onClick: this.props.onClick },
          _react2.default.createElement(
            'span',
            { className: 'btn-label' },
            this.props.label
          ),
          _react2.default.createElement('input', {
            disabled: this.props.isDisabled,
            onChange: this.props.onClick,
            checked: this.props.checked,
            type: 'radio',
            name: 'searchLocation',
            value: this.props.value,
            id: this.props.id })
        );
      }
    }]);

    return LocationToggle;
  }(_react2.default.Component);

  var LocationToggles = function (_React$Component3) {
    _inherits(LocationToggles, _React$Component3);

    function LocationToggles() {
      _classCallCheck(this, LocationToggles);

      return _possibleConstructorReturn(this, (LocationToggles.__proto__ || Object.getPrototypeOf(LocationToggles)).apply(this, arguments));
    }

    _createClass(LocationToggles, [{
      key: 'thisOnClick',
      value: function thisOnClick(evt, val) {
        if (val === this.props.searchLocation || $(evt.target).closest('.btn.disabled').length || evt.charCode && evt.charCode !== 13) {
          return;
        }
        this.props.onChange({ type: val });
      }
    }, {
      key: 'isSelected',
      value: function isSelected(loc) {
        return this.props.searchLocation === _constants2.default.searchLocation[loc];
      }
    }, {
      key: 'isDisabled',
      value: function isDisabled() {
        return this.props.availableContentTypes.indexOf(_constants2.default.contentType.WEBMAP) < 0 && this.props.availableContentTypes.indexOf(_constants2.default.contentType.WEBSCENE) < 0;
      }
    }, {
      key: 'getOrgToggle',
      value: function getOrgToggle() {
        var _this6 = this;

        if (!this.props.portalIsOrg) {
          return null;
        }
        return _react2.default.createElement(LocationToggle, {
          id: 'agol-org',
          toggleCount: 4,
          isDisabled: this.isDisabled(),
          onClick: function onClick(evt) {
            return _this6.thisOnClick(evt, _constants2.default.searchLocation.ORG);
          },
          label: this.props.portalName + ' ' + text.searchLocation.myOrg,
          value: _constants2.default.searchLocation.ORG,
          checked: this.isSelected('ORG')
        });
      }
    }, {
      key: 'render',
      value: function render() {
        var _this7 = this;

        return _react2.default.createElement(
          'div',
          { className: 'content-toggle btn-group', 'data-toggle': 'buttons' },
          _react2.default.createElement(LocationToggle, {
            id: 'agol-agol',
            toggleCount: this.props.portalIsOrg ? 4 : 3,
            isDisabled: this.isDisabled(),
            onClick: function onClick(evt) {
              return _this7.thisOnClick(evt, _constants2.default.searchLocation.AGOL);
            },
            label: text.searchLocation.agol,
            value: _constants2.default.searchLocation.AGOL,
            checked: this.isSelected('AGOL')
          }),
          this.getOrgToggle(),
          _react2.default.createElement(LocationToggle, {
            id: 'agol-mine',
            toggleCount: this.props.portalIsOrg ? 4 : 3,
            isDisabled: this.isDisabled(),
            onClick: function onClick(evt) {
              return _this7.thisOnClick(evt, _constants2.default.searchLocation.MINE);
            },
            label: text.searchLocation.myContent,
            value: _constants2.default.searchLocation.MINE,
            checked: this.isSelected('MINE')
          }),
          _react2.default.createElement(LocationToggle, {
            id: 'agol-story',
            toggleCount: this.props.portalIsOrg ? 4 : 3,
            onClick: function onClick(evt) {
              return _this7.thisOnClick(evt, _constants2.default.searchLocation.STORY);
            },
            label: text.searchLocation.thisStory,
            value: _constants2.default.searchLocation.STORY,
            checked: this.isSelected('STORY')
          })
        );
      }
    }]);

    return LocationToggles;
  }(_react2.default.Component);

  var Divider = function (_React$Component4) {
    _inherits(Divider, _React$Component4);

    function Divider() {
      _classCallCheck(this, Divider);

      return _possibleConstructorReturn(this, (Divider.__proto__ || Object.getPrototypeOf(Divider)).apply(this, arguments));
    }

    _createClass(Divider, [{
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'divider' },
          _react2.default.createElement(
            'span',
            null,
            text.createContent.or
          )
        );
      }
    }]);

    return Divider;
  }(_react2.default.Component);

  var SidePanelArcGIS = function (_React$Component5) {
    _inherits(SidePanelArcGIS, _React$Component5);

    function SidePanelArcGIS() {
      _classCallCheck(this, SidePanelArcGIS);

      return _possibleConstructorReturn(this, (SidePanelArcGIS.__proto__ || Object.getPrototypeOf(SidePanelArcGIS)).apply(this, arguments));
    }

    _createClass(SidePanelArcGIS, [{
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'mp-sidepanel agol' },
          _react2.default.createElement(LocationToggles, {
            availableContentTypes: this.props.containerState.availableContentTypes,
            portalIsOrg: this.props.containerState.portalIsOrg,
            portalName: this.props.containerState.portalName,
            searchLocation: this.props.providerProps.searchLocation,
            onChange: this.props.onKeyPress.searchLocSubmit }),
          _react2.default.createElement(SearchInput, {
            setFocus: this.props.containerState.focusInput,
            icon: 'globe',
            placeholder: text.filterAndSort.search,
            value: this.props.containerState.textInputValue,
            loading: this.props.imageLoading,
            onChange: this.props.onChange.textInput,
            onKeyPress: this.props.onKeyPress.textKeypress,
            onClear: this.props.onKeyPress.textClear
          }),
          _react2.default.createElement(Divider, null),
          _react2.default.createElement(_FileUploader2.default, {
            authorizedMedia: this.props.containerState.authorizedMedia,
            availableContentTypes: this.props.containerState.availableContentTypes,
            appId: this.props.containerState.appId,
            fileUploadFunctions: this.props.onKeyPress.fileUploadFunctions
          })
        );
      }
    }]);

    return SidePanelArcGIS;
  }(_react2.default.Component);

  exports.default = SidePanelArcGIS;
  module.exports = exports['default'];
});
//# sourceMappingURL=SidePanelArcGIS.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/providers/ArcGISContainer',['module', 'exports', 'react', 'react-dom', 'react-redux', '../actions', '../../constants', './Common', '../sidePanel/SidePanelArcGIS', '../../connectors/ArcGIS'], function (module, exports, _react, _reactDom, _reactRedux, _actions, _constants, _Common, _SidePanelArcGIS, _ArcGIS) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var actions = _interopRequireWildcard(_actions);

  var _constants2 = _interopRequireDefault(_constants);

  var _Common2 = _interopRequireDefault(_Common);

  var _SidePanelArcGIS2 = _interopRequireDefault(_SidePanelArcGIS);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var ArcGISContainer = function (_React$Component) {
    _inherits(ArcGISContainer, _React$Component);

    function ArcGISContainer() {
      _classCallCheck(this, ArcGISContainer);

      var _this = _possibleConstructorReturn(this, (ArcGISContainer.__proto__ || Object.getPrototypeOf(ArcGISContainer)).call(this));

      window.globalAGOLContainer = _this;

      _this.state = {
        textInputValue: '',
        dateSortOrder: _constants2.default.sortOrder.DESC, // most recent first
        titleSortOrder: _constants2.default.sortOrder.ASC, // A-Z
        appId: null,
        portalIsOrg: false,
        portalName: '',
        focusInput: false,
        storyResourceCount: 0,
        availableContentTypes: [], // this is location-specific
        authorizedMedia: [], // this is just a duplicate of provider.authorizedMedia
        selectedContentTypes: []
      };

      _this.storyCache = {};

      // these actions change this container state
      _this.onChange = {
        textInput: _this.textInput.bind(_this)
      };

      // these actions potentially change the redux state
      _this.onKeyPress = {
        searchLocSubmit: _this.searchLocSubmit.bind(_this),
        textKeypress: _this.textKeypress.bind(_this),
        textClear: _this.textClear.bind(_this),
        selectedContentTypesChange: _this.selectedContentTypesChange.bind(_this),
        sortFieldChange: _this.sortFieldChange.bind(_this),
        sortOrderChange: _this.sortOrderChange.bind(_this),
        fileUploadFunctions: {
          multiStart: _this.multiFileUploadStart.bind(_this),
          singleProgress: _this.singleFileUploadProgress.bind(_this),
          singleComplete: _this.singleFileUploadComplete.bind(_this),
          singleFailure: _this.singleFileUploadError.bind(_this),
          allComplete: _this.allFileUploadsComplete.bind(_this)
        },
        onItemDelete: _this.onItemDelete.bind(_this)
      };
      return _this;
    }

    _createClass(ArcGISContainer, [{
      key: 'componentDidMount',
      value: function componentDidMount() {
        var _this2 = this;

        _ArcGIS.ArcGISConnector.checkSignin().then(function () {
          var portal = _ArcGIS.ArcGISConnector.getPortal();
          _this2.setState({
            portalIsOrg: portal.isOrganization,
            portalName: portal.name
          });
          _this2.itemFetch();
          // try loading /resources for thisStory at app load time
          _ArcGIS.ArcGISConnector.getAppIdPromise().then(function (appId) {
            _this2.setState({ appId: appId });
            _this2.thisStoryFetch({ searchLocation: _constants2.default.searchLocation.STORY });
          }).catch(function (error) {
            console.warn(error);
          });
        });
      }
    }, {
      key: 'componentWillReceiveProps',
      value: function componentWillReceiveProps(nextProps) {
        var _this3 = this;

        // availMedia depends on authorized media + search location.
        var availMedia = this.constructLocationSpecificContentTypes(nextProps.authorizedMedia, nextProps.provider.searchLocation);
        //

        var newState = {
          availableContentTypes: availMedia,
          authorizedMedia: nextProps.authorizedMedia,
          focusInput: nextProps.display && !this.props.display || nextProps.openFocus
        };

        var authMediaChanged = !this.compareArrays(nextProps.authorizedMedia, this.props.authorizedMedia);
        if (authMediaChanged) {
          var fetchOptions = {};
          // since all AGOL locations except ThisStory only contain GIS content, if no GIS content is authorized,
          // we force the user directly to ThisStory.
          if (this.isGisContentDisabled(nextProps)) {
            availMedia = this.constructLocationSpecificContentTypes(nextProps.authorizedMedia, _constants2.default.searchLocation.STORY);
            this.props.updateSearchLocation({ type: _constants2.default.searchLocation.STORY });
            Object.assign(fetchOptions, { searchLocation: _constants2.default.searchLocation.STORY });
          }
          Object.assign(fetchOptions, { contentTypes: availMedia });
          newState.selectedContentTypes = availMedia;

          this.fetchIfNotStory(fetchOptions);
        } else if (!this.compareArrays(availMedia, this.state.availableContentTypes)) {
          var unselectedTypes = availMedia.filter(function (media) {
            return _this3.state.availableContentTypes.indexOf(media) < 0;
          });
          if (unselectedTypes.length) {
            newState.selectedContentTypes = this.state.selectedContentTypes.concat(unselectedTypes);
          }
        }

        this.setState(newState);

        if (nextProps.appId && !this.state.appId) {
          this.setState({ appId: nextProps.appId });
        } else if (nextProps.thisStory === this.props.thisStory || !nextProps.thisStory) {
          return;
        }
        this.buildThisStoryCache(nextProps.thisStory, nextProps.appId);
      }
    }, {
      key: 'compareArrays',
      value: function compareArrays(arr1, arr2) {
        if (arr1.length !== arr2.length) {
          return false;
        }
        arr1.sort();
        arr2.sort();
        return arr1.every(function (d, i) {
          return arr2[i] === d;
        });
      }
    }, {
      key: 'constructLocationSpecificContentTypes',
      value: function constructLocationSpecificContentTypes(authMedia, searchLoc) {
        var availMedia = [];
        var isStory = searchLoc === _constants2.default.searchLocation.STORY;
        if (authMedia.indexOf(_constants2.default.contentType.WEBMAP) >= 0) {
          availMedia.push(_constants2.default.contentType.WEBMAP);
        }
        if (authMedia.indexOf(_constants2.default.contentType.WEBSCENE) >= 0) {
          availMedia.push(_constants2.default.contentType.WEBSCENE);
        }
        if (authMedia.indexOf(_constants2.default.contentType.IMAGE) >= 0 && isStory && _constants2.default.uploadFileExtensions.IMAGE) {
          availMedia.unshift(_constants2.default.contentType.IMAGE);
        }
        if (authMedia.indexOf(_constants2.default.contentType.AUDIO) >= 0 && isStory && _constants2.default.uploadFileExtensions.AUDIO) {
          availMedia.unshift(_constants2.default.contentType.AUDIO);
        }
        if (authMedia.indexOf(_constants2.default.contentType.VIDEO) >= 0 && isStory && _constants2.default.uploadFileExtensions.VIDEO) {
          availMedia.unshift(_constants2.default.contentType.VIDEO);
        }
        return availMedia;
      }
    }, {
      key: 'textInput',
      value: function textInput(evt) {
        this.setState({
          textInputValue: evt.target.value
        });
      }
    }, {
      key: 'textKeypress',
      value: function textKeypress(evt) {
        if (evt.charCode === 13) {
          this.textSubmit();
        }
      }
    }, {
      key: 'textClear',
      value: function textClear(evt) {
        var _this4 = this;

        if (evt.charCode === 13) {
          this.textInput({ target: { value: '' } });
          this.setState({ focusInput: true });
          // need setTimeout because textKeypress reads this.state,
          // which hasn't happened if you call this.textKeypress
          // sequentially.
          setTimeout(function () {
            // can't use same evt above because it's nulled by this point.
            _this4.textKeypress({ charCode: 13 });
          }, 10);
        }
      }
    }, {
      key: 'textSubmit',
      value: function textSubmit() {
        var term = this.state.textInputValue.trim();
        this.props.updateSearchTerm({ term: term });
        this.fetchIfNotStory({ searchStr: term });
      }
    }, {
      key: 'buildSearchOptionsFromReduxState',
      value: function buildSearchOptionsFromReduxState() {
        return {
          searchLocation: this.props.provider.searchLocation,
          contentTypes: this.state.selectedContentTypes,
          sortField: this.props.provider.sortField,
          sortOrder: this.props.provider.sortOrder,
          searchStr: this.props.provider.searchStr
        };
      }
    }, {
      key: 'clearThisStoryUsed',
      value: function clearThisStoryUsed() {
        for (var key in this.storyCache) {
          this.storyCache[key].usedInStory = false;
        }
      }
    }, {
      key: 'removeUnused',
      value: function removeUnused() {
        for (var key in this.storyCache) {
          var target = this.storyCache[key];
          if (target.usedInStory === false && !target.fromResources) {
            delete this.storyCache[key];
          }
        }
      }
    }, {
      key: 'buildThisStoryCache',
      value: function buildThisStoryCache(thisStoryArr, appId) {
        var _this5 = this;

        this.clearThisStoryUsed();

        var idArr = [];
        thisStoryArr.forEach(function (resource) {
          // already cached
          var target = _this5.storyCache[resource.id] || _this5.storyCache[resource.file];
          if (target) {
            target.usedInStory = true;
            return;
          }

          if (resource.id && resource.id !== appId && resource.id !== 'APPID') {
            idArr.push(resource.id);
          } else {
            _this5.storeImageResourceInfo(resource);
          }
        });

        this.removeUnused();

        this.setState({ storyResourceCount: Object.keys(this.storyCache).length });
        if (!idArr.length) {
          if (this.props.provider.searchLocation === _constants2.default.searchLocation.STORY) {
            this.handleImageReturn(this.filterAndSortThisStory());
          }
          return;
        }
        _ArcGIS.ArcGISConnector.getItems({ idArr: idArr }).then(function (results) {
          _this5.processThisStoryResults(results);
        });
      }
    }, {
      key: 'handleImageReturn',
      value: function handleImageReturn(results) {
        this.props.updateImageFetchStatus({ fetchStatus: _constants2.default.fetchStatus.SUCCESS });
        this.props.updateImages({ images: results });
      }
    }, {
      key: 'processThisStoryResults',
      value: function processThisStoryResults(results) {
        var _this6 = this;

        if (!results) {
          return;
        }
        results.forEach(function (result) {
          _this6.storyCache[result.id] = Object.assign(result, { usedInStory: true });
        });
        this.setState({ storyResourceCount: Object.keys(this.storyCache).length });
      }
    }, {
      key: 'storeImageResourceInfo',
      value: function storeImageResourceInfo(resource) {
        console.warn('resource fell through', resource);
      }
    }, {
      key: 'beforeItemFetch',
      value: function beforeItemFetch() {
        this.props.updateImageFetchStatus({ fetchStatus: _constants2.default.fetchStatus.FETCHING });
        this.props.updateImages({ images: [] });
      }
    }, {
      key: 'fetchIfNotStory',
      value: function fetchIfNotStory(options) {
        var searchParams = Object.assign({}, this.buildSearchOptionsFromReduxState(), options);
        if (searchParams.searchLocation !== _constants2.default.searchLocation.STORY) {
          this.itemFetch(options);
        } else {
          this.beforeItemFetch();
          this.handleImageReturn(this.filterAndSortThisStory(options));
        }
      }
    }, {
      key: 'isGisContentDisabled',
      value: function isGisContentDisabled(target) {
        target = target || this.props;
        return target.authorizedMedia.indexOf(_constants2.default.contentType.WEBMAP) < 0 && target.authorizedMedia.indexOf(_constants2.default.contentType.WEBSCENE) < 0;
      }
    }, {
      key: 'itemFetch',
      value: function itemFetch(options) {
        var _this7 = this;

        this.beforeItemFetch();
        var searchParams = Object.assign({}, this.buildSearchOptionsFromReduxState(), options);
        if (searchParams.searchStr && searchParams.searchStr.match(/^[A-Fa-f0-9]{32}$/) && !this.isGisContentDisabled()) {
          Object.assign(searchParams, { idArr: [searchParams.searchStr], searchLocation: _constants2.default.searchLocation.AGOL });
          this.props.updateSearchLocation({ type: _constants2.default.searchLocation.AGOL });
        }

        if (searchParams.searchLocation === _constants2.default.searchLocation.STORY && !searchParams.idArr) {
          this.thisStoryFetch(searchParams);
        } else {
          _ArcGIS.ArcGISConnector.getItems(searchParams).then(function (results) {
            return _this7.handleImageReturn(results);
          }).catch(function (error) {
            console.warn('itemFetch failed', error);
            _this7.handleImageReturn();
          });
        }
      }
    }, {
      key: 'itemDelete',
      value: function itemDelete(item) {
        var _this8 = this;

        _ArcGIS.ArcGISConnector.removeResources(item).then(function () /*results*/{
          if (_this8.storyCache[item.fileName]) {
            delete _this8.storyCache[item.fileName];
            _this8.handleImageReturn(_this8.filterAndSortThisStory());
          }
          $(_reactDom2.default.findDOMNode(_this8)).find('.popover').popover('hide');
        }).catch(function (results) {
          console.warn('deletion failed from container', results);
          if (_this8.storyCache[item.fileName]) {
            delete _this8.storyCache[item.fileName];
            _this8.handleImageReturn(_this8.filterAndSortThisStory());
          }
          $(_reactDom2.default.findDOMNode(_this8)).find('.popover').popover('hide');
        });
      }
    }, {
      key: 'thisStoryFetch',
      value: function thisStoryFetch(options) {
        var _this9 = this;

        return new Promise(function (resolve, reject) {
          _ArcGIS.ArcGISConnector.getItems(options).then(function (results) {
            _this9.handleThisStoryResults(results);
            resolve();
          }).catch(function (error) {
            reject(error);
            console.warn('itemFetch failed', error);
            if (_this9.props.provider.searchLocation === _constants2.default.searchLocation.STORY) {
              _this9.handleImageReturn();
            }
          });
        });
      }
    }, {
      key: 'handleThisStoryResults',
      value: function handleThisStoryResults(results) {
        var _this10 = this;

        if (!results) {
          this.handleImageReturn(this.filterAndSortThisStory());
          return;
        }
        results.forEach(function (resource) {
          var target = _this10.storyCache[resource.fileName];
          if (!target || target.isTemp && resource.isTemp || resource.error) {
            _this10.storyCache[resource.fileName] = Object.assign(resource, { usedInStory: false });
          } else if (target.isTemp) {
            _this10.storyCache[resource.fileName] = Object.assign(resource, { isTemp: false, usedInStory: false });
          } else if (target.thumbFile !== resource.thumbFile && resource.thumbUrl) {
            _this10.storyCache[resource.fileName].thumbFile = resource.thumbFile;
            _this10.storyCache[resource.fileName].thumbUrl = resource.thumbUrl;
            target.dataUrl = null;
          } else if (target.dataUrl && target.thumbFile === resource.thumbFile && target.thumbUrl) {
            target.dataUrl = null;
          }
        });
        if (this.props.provider.searchLocation === _constants2.default.searchLocation.STORY) {
          this.handleImageReturn(this.filterAndSortThisStory());
        }
      }
    }, {
      key: 'filterAndSortThisStory',
      value: function filterAndSortThisStory(options) {
        var filtered = [];
        var updatedProps = Object.assign({}, {
          sortField: this.props.provider.sortField,
          sortOrder: this.props.provider.sortOrder,
          searchStr: this.props.provider.searchStr,
          contentTypes: this.state.selectedContentTypes
        }, options);
        for (var key in this.storyCache) {
          var resource = this.storyCache[key];
          if (updatedProps.contentTypes.indexOf(resource.type) >= 0) {
            if (!updatedProps.searchStr || this.clientSideSearch(resource, updatedProps.searchStr)) {
              filtered.push(resource);
            }
          }
        }
        return this.sortThisStory(filtered, updatedProps);
      }
    }, {
      key: 'clientSideSearch',
      value: function clientSideSearch(resource, searchStr) {
        searchStr = searchStr.toLowerCase();
        return resource.name && resource.name.toLowerCase().indexOf(searchStr) >= 0 || resource.title && resource.title.toLowerCase().indexOf(searchStr) >= 0 || resource.snippet && resource.snippet.toLowerCase().indexOf(searchStr) >= 0;
      }
    }, {
      key: 'sortThisStory',
      value: function sortThisStory(filtered, updatedProps) {
        var sortField = updatedProps.sortField;
        var sortOrder = updatedProps.sortOrder;
        return filtered.sort(function (a, b) {
          var compare1 = sortOrder === _constants2.default.sortOrder.DESC ? a[sortField] : b[sortField];
          if (compare1.toLowerCase) {
            compare1 = compare1.toLowerCase();
          }
          var compare2 = sortOrder === _constants2.default.sortOrder.DESC ? b[sortField] : a[sortField];
          if (compare2.toLowerCase) {
            compare2 = compare2.toLowerCase();
          }
          if (compare1 < compare2) {
            return 1;
          }
          if (compare2 < compare1) {
            return -1;
          }
          return 0;
        });
      }
    }, {
      key: 'searchLocSubmit',
      value: function searchLocSubmit(typeObj) {
        this.props.updateSearchLocation(typeObj);
        this.itemFetch({ searchLocation: typeObj.type });
      }
    }, {
      key: 'selectedContentTypesChange',
      value: function selectedContentTypesChange(types) {
        this.setState({ selectedContentTypes: types });
        if (!types.length) {
          this.handleImageReturn([]);
        } else {
          this.fetchIfNotStory({ contentTypes: types });
        }
      }
    }, {
      key: 'sortFieldChange',
      value: function sortFieldChange(field, order) {
        this.props.updateSortField({ field: field });
        this.props.updateSortOrder({ order: order });
        this.fetchIfNotStory({
          sortField: field,
          sortOrder: order
        });
      }
    }, {
      key: 'sortOrderChange',
      value: function sortOrderChange(order, field) {
        this.props.updateSortOrder({ order: order });
        var stateField = field === _constants2.default.sortField.DATE ? 'dateSortOrder' : 'titleSortOrder';
        this.setState(_defineProperty({}, stateField, order));
        this.fetchIfNotStory({ sortOrder: order });
      }
    }, {
      key: 'multiFileUploadStart',
      value: function multiFileUploadStart() {
        this.beforeItemFetch();
        // got tired of typing constants.searchLocation. :|
        var STORY = _constants2.default.searchLocation.STORY;
        $('.popover').popover('hide');
        // clear search input
        this.textClear({ charCode: 13 });
        // clear item type filter (not enough to just add IMAGE type back,
        // since eventually we'll support audio and video upload)
        var availMedia = this.constructLocationSpecificContentTypes(this.props.authorizedMedia, STORY);
        this.setState({ selectedContentTypes: availMedia });

        this.props.updateSortField({ field: _constants2.default.sortField.DATE });
        this.props.updateSortOrder({ order: _constants2.default.sortOrder.DESC });

        if (this.props.provider.searchLocation !== STORY) {
          this.props.updateSearchLocation({ type: STORY });
          this.thisStoryFetch({
            searchLocation: STORY,
            sortField: _constants2.default.sortField.DATE,
            sortOrder: _constants2.default.sortOrder.DESC
          });
        } else {
          this.handleImageReturn(this.filterAndSortThisStory({
            sortField: _constants2.default.sortField.DATE,
            sortOrder: _constants2.default.sortOrder.DESC
          }));
        }
      }
    }, {
      key: 'singleFileUploadProgress',
      value: function singleFileUploadProgress(fileDetails) {
        if (fileDetails) {
          this.updateResourcesClientSide(fileDetails, { isTemp: true });
        }
      }
    }, {
      key: 'singleFileUploadError',
      value: function singleFileUploadError(fileDetails) {
        console.warn('singleFileUploadError', fileDetails);
        if (fileDetails) {
          if ($(_reactDom2.default.findDOMNode(this)).parents('.modal').hasClass('in')) {
            this.multiFileUploadStart();
          }
          this.updateResourcesClientSide(fileDetails, { error: true });
        }
      }
    }, {
      key: 'updateResourcesClientSide',
      value: function updateResourcesClientSide(fileDetails, moreDetails) {
        var formatted = _ArcGIS.ArcGISConnector.formatResources([Object.assign(fileDetails, { resource: fileDetails.processedFileName })]);
        if (!formatted || !formatted.length) {
          console.warn('bad file format', fileDetails);
          return;
        }
        var combined = Object.assign(formatted[0], moreDetails, { dataUrl: fileDetails.dataUrl });
        this.updateSingleResourceClientSide(combined);
      }
    }, {
      key: 'updateSingleResourceClientSide',
      value: function updateSingleResourceClientSide(fileDetails) {
        var fileName = fileDetails.fileName;
        var moreOptions = { usedInStory: false };

        if (!fileDetails.isTemp) {
          Object.assign(moreOptions, { isTemp: false });
        }

        this.storyCache[fileName] = Object.assign(fileDetails, moreOptions);

        if (this.props.provider.searchLocation === _constants2.default.searchLocation.STORY) {
          this.handleImageReturn(this.filterAndSortThisStory());
        }
      }
    }, {
      key: 'singleFileUploadComplete',
      value: function singleFileUploadComplete(fileDetails) {
        if (fileDetails) {
          this.updateResourcesClientSide(fileDetails, { isTemp: false });
        }
      }
    }, {
      key: 'allFileUploadsComplete',
      value: function allFileUploadsComplete() {
        this.thisStoryFetch({ searchLocation: _constants2.default.searchLocation.STORY });
      }
    }, {
      key: 'onItemDelete',
      value: function onItemDelete(evt, item) {
        evt.stopPropagation();
        evt.preventDefault();
        this.itemDelete(item);
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(_Common2.default, _extends({
          ref: 'Common',
          sidePanel: _SidePanelArcGIS2.default,
          connector: _ArcGIS.ArcGISConnector,
          onChange: this.onChange,
          onKeyPress: this.onKeyPress,
          containerState: this.state
        }, this.props));
      }
    }]);

    return ArcGISContainer;
  }(_react2.default.Component);

  var mapStateToProps = function mapStateToProps(state) {
    return {
      provider: state.browsePanel.agol
    };
  };

  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    var dispatchWithType = function dispatchWithType(action, args) {
      var argumentsWithType = Object.assign({}, args, { providerType: _constants2.default.providers.ARCGIS });

      dispatch(action(argumentsWithType));
    };

    return {
      updateImages: function updateImages(images) {
        dispatchWithType(actions.updateImages, images);
      },
      updateImageFetchStatus: function updateImageFetchStatus(status) {
        dispatchWithType(actions.updateImageFetchStatus, status);
      },
      updateSearchLocation: function updateSearchLocation(type) {
        dispatchWithType(actions.updateSearchLocation, type);
      },
      updateSearchTerm: function updateSearchTerm(term) {
        dispatchWithType(actions.updateSearchTerm, term);
      },
      updateSortField: function updateSortField(field) {
        dispatchWithType(actions.updateSortField, field);
      },
      updateSortOrder: function updateSortOrder(order) {
        dispatchWithType(actions.updateSortOrder, order);
      }
    };
  };

  exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(ArcGISContainer);
  module.exports = exports['default'];
});
//# sourceMappingURL=ArcGISContainer.js.map
;
define('storymaps-react/common/builder/mediaPicker/connectors/UrlContent',['exports', '../config', '../constants'], function (exports, _config, _constants) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });
  exports.URLConnector = undefined;

  var _config2 = _interopRequireDefault(_config);

  var _constants2 = _interopRequireDefault(_constants);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var URLConnector = function () {

    var checkVimeoUrl = function checkVimeoUrl(url) {
      return new Promise(function (resolve, reject) {
        var videoId = getVimeoId(url);
        if (!videoId) {
          resolve(_constants2.default.fetchStatus.NON_MATCHING_URL);
          return;
        }
        getVimeoVideoInfo(videoId).then(function (data) {
          if (!data) {
            reject({
              reason: _constants2.default.fetchStatus.NOT_FOUND,
              type: 'VIDEO'
            });
            return;
          }
          resolve({
            id: videoId,
            source: 'vimeo',
            title: data.title,
            description: data.description,
            user: data.user_name,
            thumbUrl: data.thumbnail_small,
            url: getVimeoVideoEmbed(videoId),
            viewCount: data.stats_number_of_plays,
            likeCount: data.stats_number_of_likes
          });
        }).catch(function (error) {
          reject({
            reason: _constants2.default.fetchStatus.NOT_FOUND,
            type: 'VIDEO',
            error: error
          });
        });
      });
    };

    var checkYoutubeUrl = function checkYoutubeUrl(url) {
      return new Promise(function (resolve, reject) {
        var videoId = getYoutubeId(url);
        if (!videoId) {
          resolve(_constants2.default.fetchStatus.NON_MATCHING_URL);
          return;
        }

        if (!regexVerifyYoutubeId(videoId)) {
          reject({
            reason: _constants2.default.fetchStatus.BAD_FORMAT,
            type: 'VIDEO'
          });
          return;
        }

        getYoutubeVideoInfo(videoId).then(function (item) {
          if (!item) {
            reject({
              reason: _constants2.default.fetchStatus.NOT_FOUND,
              type: 'VIDEO'
            });
            return;
          }
          resolve({
            id: videoId,
            source: 'youtube',
            title: item.snippet.title,
            description: item.snippet.description,
            user: item.snippet.channelTitle,
            thumbUrl: item.snippet.thumbnails['default'].url,
            url: getYoutubeEmbed(videoId),
            viewCount: item.statistics.viewCount,
            likeCount: item.statistics.likeCount
          });
        }).catch(function (error) {
          if (error && error.status == 403) {
            reject({
              reason: _constants2.default.fetchStatus.NOT_AUTHORIZED,
              type: 'VIDEO',
              error: error
            });
          } else {
            reject({
              reason: _constants2.default.fetchStatus.NOT_FOUND,
              type: 'VIDEO',
              error: error
            });
          }
        });
      });
    };

    var getYoutubeVideoInfo = function getYoutubeVideoInfo(videoId) {
      return new Promise(function (resolve, reject) {
        var requestUrl = 'https://www.googleapis.com/youtube/v3/videos' + '?part=snippet,statistics' + '&id=' + videoId + '&key=' + _config2.default.YOUTUBE_API_KEY;

        $.ajax({
          url: requestUrl,
          timeout: 4000
        }).then(function (response) {
          if (response && response.items && response.items.length) {
            resolve(response.items[0]);
          } else {
            reject();
          }
        }, function (error) {
          reject(error);
        });
      });
    };

    var getVimeoVideoInfo = function getVimeoVideoInfo(videoId) {
      return new Promise(function (resolve, reject) {
        var requestUrl = '//vimeo.com/api/v2/video/' + videoId + '.json';

        $.ajax({
          type: 'GET',
          url: requestUrl,
          jsonp: 'callback',
          dataType: 'jsonp',
          timeout: 4000
        }).then(function (data) {
          if (data && data[0]) {
            resolve(data[0]);
          } else {
            reject();
          }
        }, function (error) {
          reject(error);
        });
      });
    };

    var getYoutubeId = function getYoutubeId(url) {
      var urlTest = /(youtube\.com\/(watch\?v\=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{3,20})/.exec(url);
      return urlTest ? urlTest.pop() : null;
    };

    var regexVerifyYoutubeId = function regexVerifyYoutubeId(videoid) {
      return videoid.match(/^[a-zA-Z0-9_-]{11}$/);
    };

    var getVimeoId = function getVimeoId(url) {
      var urlTest = /https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/.exec(url);
      return urlTest ? urlTest.pop() : null;
    };

    var getYoutubeEmbed = function getYoutubeEmbed(videoId) {
      return '//www.youtube.com/embed/' + videoId + '?wmode=opaque&rel=0';
    };

    var getVimeoVideoEmbed = function getVimeoVideoEmbed(videoId) {
      return '//player.vimeo.com/video/' + videoId;
    };

    var checkForIframe = function checkForIframe(url) {
      return url.match(/^<iframe[^>][\s\S]*<\/iframe>$/) && url.match(/<iframe/g).length <= 2;
    };

    var getIframeSrc = function getIframeSrc(iframeStr) {
      var src = $(iframeStr).attr('src'); // seemed easier than parsing
      if (src) {
        return src;
      }
      return null;
    };

    var checkForImage = function checkForImage(url) {
      return new Promise(function (resolve, reject) {
        if (url.match(/(.jpg)|(.jpeg)|(.png)|(.gif)$/i)) {
          var image = new Image();
          image.src = url;
          image.onload = function () {
            this.onload = null;
            resolve({ url: url });
          };
          image.onerror = function (err) {
            this.onload = null;
            this.onerror = null;
            reject({
              reason: _constants2.default.fetchStatus.NOT_FOUND,
              type: 'IMAGE',
              error: err
            });
          };
        } else {
          resolve(_constants2.default.fetchStatus.NON_MATCHING_URL);
        }
      });
    };

    return {
      checkYoutubeUrl: checkYoutubeUrl,
      checkVimeoUrl: checkVimeoUrl,
      checkForIframe: checkForIframe,
      getIframeSrc: getIframeSrc,
      checkForImage: checkForImage
    };
  }();

  exports.URLConnector = URLConnector;
});
//# sourceMappingURL=UrlContent.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/providers/UrlContainer',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/providers/UrlContainer',['module', 'exports', 'react', 'react-dom', 'react-redux', '../actions', 'dojo/topic', '../../connectors/UrlContent', '../../constants', 'lib-build/i18n!../../../../_resources/nls/media', 'lib-build/less!./UrlContainer'], function (module, exports, _react, _reactDom, _reactRedux, _actions, _topic, _UrlContent, _constants, _media) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var actions = _interopRequireWildcard(_actions);

  var _topic2 = _interopRequireDefault(_topic);

  var _constants2 = _interopRequireDefault(_constants);

  var _media2 = _interopRequireDefault(_media);

  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj;
    } else {
      var newObj = {};

      if (obj != null) {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
        }
      }

      newObj.default = obj;
      return newObj;
    }
  }

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var text = _media2.default.mediaPicker.browsePanel.providers.urlContent;

  var Alert = function (_React$Component) {
    _inherits(Alert, _React$Component);

    function Alert() {
      _classCallCheck(this, Alert);

      return _possibleConstructorReturn(this, (Alert.__proto__ || Object.getPrototypeOf(Alert)).apply(this, arguments));
    }

    _createClass(Alert, [{
      key: 'getAlertSpans',
      value: function getAlertSpans() {
        if (Array.isArray(this.props.text)) {
          var mapped = this.props.text.map(function (str, i) {
            return _react2.default.createElement(
              'span',
              { key: 'errortext-' + i, className: 'block-span' },
              str
            );
          });
          return mapped;
        }
        return _react2.default.createElement(
          'span',
          null,
          this.props.text
        );
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'alert alert-danger', role: 'alert' },
          this.getAlertSpans()
        );
      }
    }]);

    return Alert;
  }(_react2.default.Component);

  var UrlInput = function (_React$Component2) {
    _inherits(UrlInput, _React$Component2);

    function UrlInput() {
      _classCallCheck(this, UrlInput);

      return _possibleConstructorReturn(this, (UrlInput.__proto__ || Object.getPrototypeOf(UrlInput)).apply(this, arguments));
    }

    _createClass(UrlInput, [{
      key: 'componentDidMount',
      value: function componentDidMount() {
        var _this3 = this;

        var modal = $(_reactDom2.default.findDOMNode(this)).parents('.modal');
        modal.on('shown.bs.modal', function () {
          if (_this3.props.setFocus) {
            $(_this3.refs.textareaInput).focus();
          }
        });
      }
    }, {
      key: 'componentDidUpdate',
      value: function componentDidUpdate() {
        if (this.props.setFocus) {
          var activeEl = document.activeElement;
          // if someone is navigating by tabbing, don't take the focus off where they are
          var activeTabIndex = activeEl.tabIndex ? parseInt(activeEl.tabIndex) : 0;
          if (activeEl !== this.refs.textareaInput && activeTabIndex <= 0) {
            $(this.refs.textareaInput).focus();
          }
        }
      }
    }, {
      key: 'render',
      value: function render() {
        var _this4 = this;

        return _react2.default.createElement(
          'div',
          { className: 'input-group search' },
          _react2.default.createElement(
            'div',
            { className: 'input-group-addon' },
            _react2.default.createElement('span', { className: 'fa fa-link' })
          ),
          _react2.default.createElement('textarea', {
            tabIndex: '1',
            ref: 'textareaInput',
            type: 'textarea',
            value: this.props.value,
            className: 'form-control',
            placeholder: this.props.placeholder,
            onChange: this.props.onChange,
            onKeyPress: this.props.onKeyPress }),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : this.props.value ? '1' : null,
              className: 'btn danger input-group-addon',
              style: this.props.value ? null : { display: 'none' },
              onClick: this.props.value ? function (evt) {
                return _this4.props.onClear(Object.assign({}, evt, { charCode: 13 }));
              } : null,
              onKeyPress: this.props.onClear,
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-remove' })
          ),
          _react2.default.createElement(
            'div',
            {
              tabIndex: this.props.disabled ? null : '1',
              className: 'btn input-group-addon',
              onKeyPress: this.props.onKeyPress
              // treat click like enter
              , onClick: this.props.disabled ? null : function (evt) {
                return _this4.props.onKeyPress(Object.assign({}, evt, { charCode: 13 }));
              },
              disabled: this.props.disabled },
            _react2.default.createElement('span', { className: 'fa fa-' + (this.props.loading ? 'refresh fa-spin' : 'check') })
          )
        );
      }
    }]);

    return UrlInput;
  }(_react2.default.Component);

  var UrlContainer = function (_React$Component3) {
    _inherits(UrlContainer, _React$Component3);

    function UrlContainer() {
      _classCallCheck(this, UrlContainer);

      var _this5 = _possibleConstructorReturn(this, (UrlContainer.__proto__ || Object.getPrototypeOf(UrlContainer)).call(this));

      _this5.state = {
        textInputValue: '',
        contentTypeDescriptor: 'generic',
        focusInput: false,
        hasError: false,
        errorText: ''
      };
      return _this5;
    }

    _createClass(UrlContainer, [{
      key: 'compareArrays',
      value: function compareArrays(arr1, arr2) {
        if (arr1.length !== arr2.length) {
          return false;
        }
        arr1.sort();
        arr2.sort();
        return arr1.every(function (d, i) {
          return arr2[i] === d;
        });
      }
    }, {
      key: 'componentWillReceiveProps',
      value: function componentWillReceiveProps(nextProps) {
        var shouldFocus = nextProps.display && !this.props.display || nextProps.openFocus;
        var newState = {
          focusInput: shouldFocus,
          contentTypeDescriptor: this.computeContentTypes(nextProps.authorizedMedia)
        };
        var authMediaChanged = !this.compareArrays(nextProps.authorizedMedia, this.props.authorizedMedia);
        if (shouldFocus || authMediaChanged) {
          Object.assign(newState, {
            textInputValue: '',
            hasError: false
          });
        }
        this.setState(newState);
      }
    }, {
      key: 'textInput',
      value: function textInput(evt) {
        var val = evt.target.value;
        if (!val.trim()) {
          val = '';
        }
        this.setState({
          textInputValue: val,
          hasError: false
        });
      }
    }, {
      key: 'textKeypress',
      value: function textKeypress(evt) {
        if (!evt.charCode && evt.charCode !== 0) {
          return;
        }
        if (evt.charCode === 13 && !evt.shiftKey) {
          if (evt.preventDefault) {
            evt.preventDefault();
          }
          this.textSubmit();
        }
      }
    }, {
      key: 'textClear',
      value: function textClear(evt) {
        if (evt.charCode === 13) {
          this.setState({
            textInputValue: '',
            focusInput: true,
            hasError: false
          });
        }
      }
    }, {
      key: 'textSubmit',
      value: function textSubmit() {
        this.processPageAddress();
      }
    }, {
      key: 'processPageAddress',
      value: function processPageAddress() {
        var _this6 = this;

        var addr = this.state.textInputValue.trim();
        if (!addr) {
          return;
        }

        // if the user has entered an iframe, we just want the
        // src tag of the iframe, since we'll be styling it ourselves
        if (_UrlContent.URLConnector.checkForIframe(addr)) {
          addr = _UrlContent.URLConnector.getIframeSrc(addr);
        }

        // fire off four url checks in parallel

        var promiseArr = [],
            promiseTypeMap = [];

        if (this.checkSingleMediaType('IMAGE')) {
          promiseArr.push(_UrlContent.URLConnector.checkForImage(addr));
          promiseTypeMap.push(_constants2.default.contentType.IMAGE);
        }
        if (this.checkSingleMediaType('VIDEO')) {
          promiseArr.push(_UrlContent.URLConnector.checkYoutubeUrl(addr));
          promiseArr.push(_UrlContent.URLConnector.checkVimeoUrl(addr));
          promiseTypeMap.push(_constants2.default.contentType.VIDEO);
          promiseTypeMap.push(_constants2.default.contentType.VIDEO);
        }

        Promise.all(promiseArr).then(function (results) {
          var found = results.some(function (result, i) {
            if (result === _constants2.default.fetchStatus.NON_MATCHING_URL) {
              return false;
            }
            _this6.publishSelection(Object.assign({ type: promiseTypeMap[i] }, result));
            return true;
          });
          if (found) {
            return;
          }
          if (_this6.checkSingleMediaType('WEBPAGE')) {
            if (addr.indexOf('http:\/\/') !== 0 && addr.indexOf('https:\/\/') !== 0 && addr.indexOf('\/\/') !== 0) {
              addr = '//' + addr;
            }
            _this6.publishSelection({ type: 'webpage', url: addr });
          } else {
            _this6.setState({
              hasError: true,
              errorText: text.uploadErrors[_this6.state.contentTypeDescriptor]
            });
          }
        }).catch(function (error) {
          _this6.setState({
            hasError: true,
            errorText: _this6.getErrorMessage(error) + ' ' + text.uploadErrors.tryAgain
          });
        });
      }
    }, {
      key: 'getErrorMessage',
      value: function getErrorMessage(error) {
        var msg = error.reason === _constants2.default.fetchStatus.BAD_FORMAT ? text.uploadErrors.badFormat : text.uploadErrors.inaccessible;
        var splitArr = msg.split(/\$\{(.+?)\}/);
        return splitArr.map(function (str) {
          if (str === 'media-type') {
            str = text.uploadErrors.mediaTypes[error.type] || text.uploadErrors.mediaTypes.generic;
          }
          return str;
        }).join('');
      }
    }, {
      key: 'publishSelection',
      value: function publishSelection(selection) {
        this.textClear({ charCode: 13 });
        _topic2.default.publish('MEDIA-PICKER-SELECTION', selection);
      }
    }, {
      key: 'computeContentTypes',
      value: function computeContentTypes(authMedia) {
        if (!authMedia || !authMedia.length) {
          console.warn('no authorized media');
          return 'generic';
        }
        if (authMedia.includes(_constants2.default.contentType.WEBPAGE)) {
          return 'generic';
        }
        if (authMedia.includes(_constants2.default.contentType.VIDEO) && authMedia.includes(_constants2.default.contentType.IMAGE)) {
          return 'imageAndVideo';
        }
        if (authMedia.includes(_constants2.default.contentType.IMAGE)) {
          return 'imageOnly';
        }
        console.warn('something funny happened with authorized media', authMedia);
        return 'generic';
      }
    }, {
      key: 'getUploadHeader',
      value: function getUploadHeader() {
        return text.uploadHeaders[this.state.contentTypeDescriptor];
      }
    }, {
      key: 'getAlert',
      value: function getAlert() {
        if (this.state.hasError) {
          return _react2.default.createElement(Alert, { text: this.state.errorText });
        }
      }
    }, {
      key: 'getMediaIcons',
      value: function getMediaIcons() {
        var mediaIcons = [];
        if (!this.props.authorizedMedia || !this.props.authorizedMedia.length) {
          return;
        }
        if (this.checkSingleMediaType('IMAGE')) {
          mediaIcons.push(_react2.default.createElement('span', { className: 'fa fa-picture-o', key: 'media-picture-o' }));
        }
        if (this.checkSingleMediaType('VIDEO')) {
          mediaIcons.push(_react2.default.createElement('span', { className: 'fa fa-vimeo', key: 'media-vimeo' }), _react2.default.createElement('span', { className: 'fa fa-youtube', key: 'media-youtube' }));
        }
        if (this.checkSingleMediaType('WEBPAGE')) {
          mediaIcons.push(_react2.default.createElement('span', { className: 'fa fa-code', key: 'media-code' }), _react2.default.createElement(
            'span',
            { className: 'www', key: 'media-www' },
            'www.'
          ));
        }
        return mediaIcons;
      }
    }, {
      key: 'checkSingleMediaType',
      value: function checkSingleMediaType(mediaType) {
        return this.props.authorizedMedia.includes(_constants2.default.contentType[mediaType]);
      }
    }, {
      key: 'getSingleMediaTypeText',
      value: function getSingleMediaTypeText(arr, mediaType) {
        if (this.checkSingleMediaType(mediaType) && text.linkText[mediaType]) {
          if (Array.isArray(text.linkText[mediaType])) {
            text.linkText[mediaType].forEach(function (str) {
              arr.push(str);
            });
          } else {
            arr.push(text.linkText[mediaType]);
          }
        }
      }
    }, {
      key: 'getMediaListStr',
      value: function getMediaListStr(arr) {
        if (!arr || !arr.length) {
          return;
        }
        var arrLength = arr.length;
        return arr.map(function (str, i) {
          var suffix = '';
          if (i === arrLength - 1) {
            suffix = '.';
          } else if (i === arrLength - 2) {
            suffix = ' ' + text.linkText.OR + ' ';
          } else if (i < arrLength - 2) {
            suffix = text.linkText.listSeparator + ' ';
          }
          return str + suffix;
        }).join('');
      }
    }, {
      key: 'getHelpText',
      value: function getHelpText() {
        var mediaTypesList = [];
        this.getSingleMediaTypeText(mediaTypesList, 'IMAGE');
        this.getSingleMediaTypeText(mediaTypesList, 'VIDEO');
        this.getSingleMediaTypeText(mediaTypesList, 'WEBPAGE');

        var divArr = [];

        var listStr = '';
        if (mediaTypesList.length > 0) {
          listStr = this.getMediaListStr(mediaTypesList);
        }

        var starterStr = text.linkText.starter + ' ';
        if (this.checkSingleMediaType('VIDEO')) {
          starterStr += text.linkText.hasVideo;
          divArr.push(_react2.default.createElement(
            'div',
            { key: 'link-text-starter' },
            starterStr
          ));
          if (listStr) {
            divArr.push(_react2.default.createElement(
              'div',
              { key: 'link-text-list' },
              text.linkText.listStarterWithAlso + ' ' + listStr
            ));
          }
        } else {
          if (!listStr) {
            return [_react2.default.createElement(
              'div',
              { key: 'link-text-ender' },
              text.linkText.ender
            )];
          }
          divArr.push(_react2.default.createElement(
            'div',
            { key: 'link-text-starter' },
            starterStr + ' ' + text.linkText.listStarterWithoutAlso + ' ' + listStr
          ));
        }
        divArr.push(_react2.default.createElement(
          'div',
          { key: 'link-text-ender' },
          text.linkText.ender
        ));

        return divArr;
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          {
            style: this.props.display ? null : { display: 'none' },
            className: 'browse-panel-container url-container' },
          _react2.default.createElement(
            'div',
            { className: 'help-title' },
            this.getUploadHeader()
          ),
          _react2.default.createElement(UrlInput, {
            placeholder: text.placeholder,
            value: this.state.textInputValue,
            setFocus: this.state.focusInput,
            onKeyPress: this.textKeypress.bind(this),
            onChange: this.textInput.bind(this),
            onClear: this.textClear.bind(this),
            hasError: !this.state.isValid
          }),
          _react2.default.createElement(
            'div',
            { className: 'help-section' },
            _react2.default.createElement(
              'div',
              { className: 'media-icons' },
              this.getMediaIcons()
            ),
            _react2.default.createElement(
              'div',
              { className: 'help-text' },
              this.getHelpText()
            )
          ),
          this.getAlert()
        );
      }
    }]);

    return UrlContainer;
  }(_react2.default.Component);

  var mapStateToProps = function mapStateToProps(state) {
    return {
      provider: state.browsePanel.urlContent
    };
  };

  var mapDispatchToProps = function mapDispatchToProps(dispatch) {
    var dispatchWithType = function dispatchWithType(action, args) {
      var argumentsWithType = Object.assign({}, args, { providerType: _constants2.default.providers.URL });

      dispatch(action(argumentsWithType));
    };

    return {
      updateImageFetchStatus: function updateImageFetchStatus(status) {
        dispatchWithType(actions.updateImageFetchStatus, status);
      }
    };
  };

  exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(UrlContainer);
  module.exports = exports['default'];
});
//# sourceMappingURL=UrlContainer.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/browsePanel/providers/Providers',[],function(){});
define('storymaps-react/common/builder/mediaPicker/browsePanel/providers/Providers',['module', 'exports', 'react', './GooglePhotosContainer', './FlickrContainer', './ArcGISContainer', './UrlContainer', '../../constants', 'lib-build/less!./Providers'], function (module, exports, _react, _GooglePhotosContainer, _FlickrContainer, _ArcGISContainer, _UrlContainer, _constants) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _GooglePhotosContainer2 = _interopRequireDefault(_GooglePhotosContainer);

  var _FlickrContainer2 = _interopRequireDefault(_FlickrContainer);

  var _ArcGISContainer2 = _interopRequireDefault(_ArcGISContainer);

  var _UrlContainer2 = _interopRequireDefault(_UrlContainer);

  var _constants2 = _interopRequireDefault(_constants);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  var Providers = function (_React$Component) {
    _inherits(Providers, _React$Component);

    function Providers() {
      _classCallCheck(this, Providers);

      var _this = _possibleConstructorReturn(this, (Providers.__proto__ || Object.getPrototypeOf(Providers)).call(this));

      _this.state = {
        justOpened: false
      };
      return _this;
    }

    _createClass(Providers, [{
      key: 'componentWillReceiveProps',
      value: function componentWillReceiveProps(nextProps) {
        this.setState({
          justOpened: nextProps.params.justOpened
        });
      }
    }, {
      key: 'displayTab',
      value: function displayTab(provider) {
        return this.props.browseSelectedProvider === provider;
      }
    }, {
      key: 'openFocus',
      value: function openFocus(provider) {
        return this.displayTab(provider) && this.state.justOpened;
      }
    }, {
      key: 'render',
      value: function render() {
        return _react2.default.createElement(
          'div',
          { className: 'mp-browse-panel-containers' },
          _react2.default.createElement(_GooglePhotosContainer2.default, {
            display: this.displayTab(_constants2.default.providers.GOOGLE_PHOTOS),
            openFocus: this.openFocus(_constants2.default.providers.GOOGLE_PHOTOS),
            authorizedMedia: this.props.params ? this.props.params.authorizedMedia : []
          }),
          _react2.default.createElement(_FlickrContainer2.default, {
            display: this.displayTab(_constants2.default.providers.FLICKR),
            openFocus: this.openFocus(_constants2.default.providers.FLICKR),
            authorizedMedia: this.props.params ? this.props.params.authorizedMedia : []
          }),
          _react2.default.createElement(_ArcGISContainer2.default, {
            display: this.displayTab(_constants2.default.providers.ARCGIS),
            openFocus: this.openFocus(_constants2.default.providers.ARCGIS),
            appId: this.props.params ? this.props.params.appid : null,
            thisStory: this.props.params ? this.props.params.arcgisThisStory : null,
            authorizedMedia: this.props.params ? this.props.params.authorizedMedia : []
          }),
          _react2.default.createElement(_UrlContainer2.default, {
            display: this.displayTab(_constants2.default.providers.URL),
            openFocus: this.openFocus(_constants2.default.providers.URL),
            authorizedMedia: this.props.params ? this.props.params.authorizedMedia : []
          })
        );
      }
    }]);

    return Providers;
  }(_react2.default.Component);

  exports.default = Providers;
  module.exports = exports['default'];
});
//# sourceMappingURL=Providers.js.map
;
define('storymaps-react/common/builder/mediaPicker/browsePanel/BrowsePanelContainer',['module', 'exports', 'react-redux', './providers/Providers'], function (module, exports, _reactRedux, _Providers) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Providers2 = _interopRequireDefault(_Providers);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  var mapStateToProps = function mapStateToProps(state) {
    return {
      browseSelectedProvider: state.ui.browseSelectedProvider,
      authorizedMedia: state.ui.authorizedMedia
    };
  };

  exports.default = (0, _reactRedux.connect)(mapStateToProps)(_Providers2.default);
  module.exports = exports['default'];
});
//# sourceMappingURL=BrowsePanelContainer.js.map
;

define('lib-build/less!storymaps-react/common/builder/mediaPicker/MediaPicker',[],function(){});
define('storymaps-react/common/builder/mediaPicker/MediaPicker',['module', 'exports', 'react', 'react-dom', 'redux', 'react-redux', './reducer', './browseToggle/BrowseToggleContainer', './browsePanel/BrowsePanelContainer', 'dojo/topic', 'dojo/Deferred', 'lib-build/less!./MediaPicker'], function (module, exports, _react, _reactDom, _redux, _reactRedux, _reducer, _BrowseToggleContainer, _BrowsePanelContainer, _topic, _Deferred) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _react2 = _interopRequireDefault(_react);

  var _reactDom2 = _interopRequireDefault(_reactDom);

  var _reducer2 = _interopRequireDefault(_reducer);

  var _BrowseToggleContainer2 = _interopRequireDefault(_BrowseToggleContainer);

  var _BrowsePanelContainer2 = _interopRequireDefault(_BrowsePanelContainer);

  var _topic2 = _interopRequireDefault(_topic);

  var _Deferred2 = _interopRequireDefault(_Deferred);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  function _possibleConstructorReturn(self, call) {
    if (!self) {
      throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }

    return call && (typeof call === "object" || typeof call === "function") ? call : self;
  }

  function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
      throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    subClass.prototype = Object.create(superClass && superClass.prototype, {
      constructor: {
        value: subClass,
        enumerable: false,
        writable: true,
        configurable: true
      }
    });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
  }

  function _defineProperty(obj, key, value) {
    if (key in obj) {
      Object.defineProperty(obj, key, {
        value: value,
        enumerable: true,
        configurable: true,
        writable: true
      });
    } else {
      obj[key] = value;
    }

    return obj;
  }

  var store = (0, _redux.createStore)(_reducer2.default, window.devToolsExtension ? window.devToolsExtension() : {});
  var _resultDeferred;

  /*
  export default function configureStore() {
    return store;
  }
  */

  // The event is fired in GalleryItem.jsx and end the media picking workflow
  _topic2.default.subscribe('MEDIA-PICKER-SELECTION', function (selection) {
    if (_resultDeferred && selection) {
      _resultDeferred.resolve(_defineProperty({
        type: selection.type }, selection.type, selection));
    }
  });

  var MediaPicker = function (_React$Component) {
    _inherits(MediaPicker, _React$Component);

    function MediaPicker(container) {
      _classCallCheck(this, MediaPicker);

      var _this = _possibleConstructorReturn(this, (MediaPicker.__proto__ || Object.getPrototypeOf(MediaPicker)).call(this));

      _this.container = container;
      _this.render();
      return _this;
    }

    _createClass(MediaPicker, [{
      key: 'open',
      value: function open(params) {
        var _this2 = this;

        _resultDeferred = new _Deferred2.default();

        console.log('init media picker', params);
        this.render(Object.assign(params, { justOpened: true }));

        _resultDeferred.then(function () {
          _this2.render(Object.assign(params, { justOpened: false }));
        }, function () {
          _this2.render(Object.assign(params, { justOpened: false }));
        });

        return _resultDeferred;
      }
    }, {
      key: 'render',
      value: function render(params) {
        _reactDom2.default.render(_react2.default.createElement(
          _reactRedux.Provider,
          { store: store },
          _react2.default.createElement(
            'div',
            { className: 'media-picker' },
            _react2.default.createElement(_BrowseToggleContainer2.default, { authorizedMedia: params ? params.authorizedMedia : null }),
            _react2.default.createElement(_BrowsePanelContainer2.default, { params: params })
          )
        ), document.getElementById(this.container));
      }
    }]);

    return MediaPicker;
  }(_react2.default.Component);

  exports.default = MediaPicker;
  module.exports = exports['default'];
});
//# sourceMappingURL=MediaPicker.js.map
;
define('storymaps/common/builder/mediaPicker/MediaPickerPopup',[
  'lib-build/tpl!./MediaPickerPopup',
  'lib-build/less!./MediaPickerPopup',
  'storymaps-react/common/builder/mediaPicker/MediaPicker',
  'dojo/Deferred'
], function(
  viewTpl,
  viewCss,
  MediaPicker,
  Deferred
) {
  var DEFAULT_AUTHORIZED_MEDIA = ['image', 'video', 'webpage', 'webmap', 'webscene'];

  return function MediaPickerPopup(params) {
    var _mediaPicker = null,
        _container = params && params.container;

    if (! _container) {
      console.error('Could not initialize MediaPickerPopup');
      return;
    }

    _container.html(viewTpl({}));

    _mediaPicker = new MediaPicker('media-picker');

    this.open = function(params) {
      var resultDeferred = new Deferred(),
          selection = null;

      params.arcgisThisStory = app.Controller.getArcGISContent();
      params.appid = app.data.appItem.item.id;

      params.authorizedMedia = params.authorizedMedia || DEFAULT_AUTHORIZED_MEDIA;

      _mediaPicker.open(params).then(
        function(s) {
          selection = s;
          _container.modal('hide');
        },
        function() {
          //
        }
      );

      _container.modal({
        keyboard: true
      });

      _container.on('hide.bs.modal', function() {
        if (resultDeferred.isFulfilled()) {
          return;
        }

        if (selection) {
          resultDeferred.resolve(selection);
        }
        else {
          resultDeferred.reject('No media selected');
        }
      });

      return resultDeferred;
    };
  };
});


define('lib-build/hbars!storymaps-react/tpl/builder/settings/Popup', ['Handlebars'], function (Handlebars) { return Handlebars.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression;
  return "<div class=\"modal-dialog hc-dialog\">\r\n	<div class=\"modal-content\">\r\n		<div class=\"modal-header\">\r\n			<div class=\"toggles\">\r\n        <div class=\"toggle selected\" data-tab=\"logo-sharing\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.toggles : depth0)) != null ? stack1.logoSharing : stack1), depth0))
    + "</div>\r\n        <div class=\"toggle\" data-tab=\"bookmarks\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.toggles : depth0)) != null ? stack1.bookmarks : stack1), depth0))
    + "</div>\r\n      </div>\r\n		</div>\r\n		<div class=\"modal-body\">\r\n	    <div class=\"modal-tab selected\" data-tab=\"logo-sharing\"></div>\r\n			<div class=\"modal-tab\" data-tab=\"bookmarks\"></div>\r\n		</div>\r\n		<div class=\"modal-footer\">\r\n      <button type=\"button\" class=\"btn btn-close apply\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.dialog : depth0)) != null ? stack1.apply : stack1), depth0))
    + "</button>\r\n			<button type=\"button\" class=\"btn btnCancel btn-naked btn-close\" data-dismiss=\"modal\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.dialog : depth0)) != null ? stack1.close : stack1), depth0))
    + "</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/builder/settings/LogoSharing', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data) {
  return " hidden";
  },"3":function(depth0,helpers,partials,data) {
  return "disabled";
  },"5":function(depth0,helpers,partials,data) {
  return "checked";
  },"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data) {
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "<div class=\"hc-container split\">\r\n  <div class=\"hc-item\">\r\n    <div class=\"hc-row item-title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.logo : stack1), depth0))
    + "</div>\r\n    <div class=\"hc-row\">\r\n      <div class=\"hc-item-container\" style=\"background: "
    + escapeExpression(((helper = (helper = helpers.background || (depth0 != null ? depth0.background : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"background","hash":{},"data":data}) : helper)))
    + ";\">\r\n        <img src=\""
    + escapeExpression(lambda(((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.logo : stack1)) != null ? stack1.url : stack1), depth0))
    + "\" class=\"hc-logo";
  stack1 = helpers.unless.call(depth0, ((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.logo : stack1)) != null ? stack1.enabled : stack1), {"name":"unless","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\">\r\n        <div class=\"hc-logo-button";
  stack1 = helpers['if'].call(depth0, ((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.logo : stack1)) != null ? stack1.enabled : stack1), {"name":"if","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += " btn btn-primary\">"
    + escapeExpression(((helper = (helper = helpers.useEsriLogoString || (depth0 != null ? depth0.useEsriLogoString : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"useEsriLogoString","hash":{},"data":data}) : helper)))
    + "</div>\r\n        <div class=\"hc-action-icon-underlay\">\r\n          <i class=\"hc-action-icon hc-settings fa fa-pencil\"></i>\r\n          <i class=\"hc-action-icon hc-remove fa fa-trash";
  stack1 = helpers.unless.call(depth0, ((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.logo : stack1)) != null ? stack1.enabled : stack1), {"name":"unless","hash":{},"fn":this.program(1, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"hc-logo-upload-msg alert\" role=\"alert\"></div>\r\n  </div>\r\n  <div class=\"hc-item\">\r\n    <div class=\"hc-row item-title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.logoLink : stack1), depth0))
    + "</div>\r\n    <div class=\"hc-row\">\r\n      <input type=\"text\" value=\""
    + escapeExpression(lambda(((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.logo : stack1)) != null ? stack1.link : stack1), depth0))
    + "\" class=\"hc-text-input logo-link\" ";
  stack1 = helpers.unless.call(depth0, ((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.logo : stack1)) != null ? stack1.enabled : stack1), {"name":"unless","hash":{},"fn":this.program(3, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += ">\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"hc-container split\">\r\n  <div class=\"hc-item\">\r\n    <div class=\"hc-row item-title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.customHeaderText : stack1), depth0))
    + "</div>\r\n    <div class=\"hc-row\">\r\n      <input type=\"text\" maxlength="
    + escapeExpression(((helper = (helper = helpers.maxCharacters || (depth0 != null ? depth0.maxCharacters : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"maxCharacters","hash":{},"data":data}) : helper)))
    + " size="
    + escapeExpression(((helper = (helper = helpers.maxCharacters || (depth0 != null ? depth0.maxCharacters : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"maxCharacters","hash":{},"data":data}) : helper)))
    + " value=\""
    + escapeExpression(lambda(((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.link : stack1)) != null ? stack1.title : stack1), depth0))
    + "\" class=\"hc-text-input truncated link-title\">\r\n    </div>\r\n  </div>\r\n  <div class=\"hc-item\">\r\n    <div class=\"hc-row item-title\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.link : stack1), depth0))
    + "</div>\r\n    <div class=\"hc-row tagline-link\" data-toggle=\"tooltip\" title=\""
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.taglineLinkDisabledTooltip : stack1), depth0))
    + "\">\r\n      <input type=\"text\" ";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.emptyTagline : depth0), {"name":"if","hash":{},"fn":this.program(3, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += " value=\""
    + escapeExpression(lambda(((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.link : stack1)) != null ? stack1.url : stack1), depth0))
    + "\" class=\"hc-text-input link-url\">\r\n    </div>\r\n  </div>\r\n  <div class=\"hc-item\">\r\n    <div class=\"hc-row\">\r\n      <label class=\"hc-check-label\">\r\n        <input type=\"checkbox\" class=\"hc-checkbox social-checkbox\" ";
  stack1 = helpers['if'].call(depth0, ((stack1 = ((stack1 = (depth0 != null ? depth0.settings : depth0)) != null ? stack1.social : stack1)) != null ? stack1.enabled : stack1), {"name":"if","hash":{},"fn":this.program(5, data),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + ">\r\n        <span class=\"hc-check-label-text\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.enableSocialSharing : stack1), depth0))
    + "</span>\r\n      </label>\r\n    </div>\r\n  </div>\r\n</div>\r\n";
},"useData":true}); });


define('lib-build/hbars!storymaps-react/tpl/builder/settings/Bookmark', ['Handlebars'], function (Handlebars) { return Handlebars.template({"1":function(depth0,helpers,partials,data,depths) {
  var stack1, helper, lambda=this.lambda, escapeExpression=this.escapeExpression, functionType="function", helperMissing=helpers.helperMissing, buffer = "    <li class=\"hc-row bookmark-row";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.disabled : depth0), {"name":"if","hash":{},"fn":this.program(2, data, depths),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += "\" data-index=\""
    + escapeExpression(lambda((data && data.index), depth0))
    + "\">\r\n      <div class=\"hc-column first\">\r\n        <label class=\"hc-check-label\">\r\n          <input type=\"checkbox\" class=\"hc-checkbox space bookmark-checkbox\" ";
  stack1 = helpers.unless.call(depth0, (depth0 != null ? depth0.disabled : depth0), {"name":"unless","hash":{},"fn":this.program(4, data, depths),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  buffer += ">\r\n          <span class=\"hc-check-label-text truncated\">"
    + escapeExpression(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"title","hash":{},"data":data}) : helper)))
    + "</span>\r\n        </label>\r\n      </div>\r\n      <div class=\"hc-column last\">\r\n          <input type=\"text\" ";
  stack1 = helpers['if'].call(depth0, (depth0 != null ? depth0.disabled : depth0), {"name":"if","hash":{},"fn":this.program(6, data, depths),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + " maxlength="
    + escapeExpression(lambda((depths[1] != null ? depths[1].maxCharacters : depths[1]), depth0))
    + " size="
    + escapeExpression(lambda((depths[1] != null ? depths[1].maxCharacters : depths[1]), depth0))
    + " value=\""
    + escapeExpression(((helper = (helper = helpers.bookmark || (depth0 != null ? depth0.bookmark : depth0)) != null ? helper : helperMissing),(typeof helper === functionType ? helper.call(depth0, {"name":"bookmark","hash":{},"data":data}) : helper)))
    + "\" class=\"hc-text-input truncated bookmark-text\">\r\n      </div>\r\n    </li>\r\n";
},"2":function(depth0,helpers,partials,data) {
  return " disabled";
  },"4":function(depth0,helpers,partials,data) {
  return "checked";
  },"6":function(depth0,helpers,partials,data) {
  return "disabled";
  },"compiler":[6,">= 2.0.0-beta.1"],"main":function(depth0,helpers,partials,data,depths) {
  var stack1, lambda=this.lambda, escapeExpression=this.escapeExpression, buffer = "<div class=\"hc-intro\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.intro : stack1), depth0))
    + "</div>\r\n\r\n<div class=\"hc-container header-container\">\r\n    <div class=\"hc-row\">\r\n        <div class=\"hc-column first\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.title : stack1), depth0))
    + "</div>\r\n        <div class=\"hc-column last\">"
    + escapeExpression(lambda(((stack1 = (depth0 != null ? depth0.strings : depth0)) != null ? stack1.bookmark : stack1), depth0))
    + "</div>\r\n    </div>\r\n</div>\r\n<ul class=\"hc-container content\">\r\n";
  stack1 = helpers.each.call(depth0, (depth0 != null ? depth0.bookmarks : depth0), {"name":"each","hash":{},"fn":this.program(1, data, depths),"inverse":this.noop,"data":data});
  if (stack1 != null) { buffer += stack1; }
  return buffer + "</ul>\r\n";
},"useData":true,"useDepths":true}); });


define('lib-build/less!storymaps-react/tpl/builder/settings/Popup',[],function(){});
define('storymaps-react/tpl/builder/settings/Popup',['module', 'exports', 'storymaps-react/tpl/view/media/Media', 'lib-build/hbars!./Popup', 'lib-build/hbars!./LogoSharing', 'lib-build/hbars!./Bookmark', 'storymaps/common/utils/CommonHelper', 'lib-build/i18n!./../../../../resources/tpl/builder/nls/app', 'dojo/_base/lang', 'lib-build/less!./Popup'], function (module, exports, _Media, _Popup, _LogoSharing, _Bookmark, _CommonHelper, _app, _lang) {
  'use strict';

  Object.defineProperty(exports, "__esModule", {
    value: true
  });

  var _Media2 = _interopRequireDefault(_Media);

  var _Popup2 = _interopRequireDefault(_Popup);

  var _LogoSharing2 = _interopRequireDefault(_LogoSharing);

  var _Bookmark2 = _interopRequireDefault(_Bookmark);

  var _CommonHelper2 = _interopRequireDefault(_CommonHelper);

  var _app2 = _interopRequireDefault(_app);

  var _lang2 = _interopRequireDefault(_lang);

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
      default: obj
    };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError("Cannot call a class as a function");
    }
  }

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
      }
    }

    return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);
      if (staticProps) defineProperties(Constructor, staticProps);
      return Constructor;
    };
  }();

  var SettingsPopup = function () {
    function SettingsPopup(options) {
      _classCallCheck(this, SettingsPopup);

      this.container = options.container;
      this.data = null;
      this.esriLogoUrl = 'resources/tpl/viewer/icons/esri-logo.png';
      this.esriLogoLink = 'https://storymaps.arcgis.com';

      this.reject = null;
      this.resolve = null;

      var dialogData = {
        dialog: _app2.default.builder.dialog,
        toggles: _app2.default.builder.headerConfig.toggles
      };

      this.container.append((0, _Popup2.default)(dialogData));

      this.attachModalEvents();
    }

    _createClass(SettingsPopup, [{
      key: 'attachModalEvents',
      value: function attachModalEvents() {
        this.attachToggleEvents();
        this.attachApplyEvents();
      }
    }, {
      key: 'attachApplyEvents',
      value: function attachApplyEvents() {
        var _this = this;

        this.container.find('.btn-close').on('click', function () {
          _this.detachEvents();
        });

        this.container.find('.btn-close.btnCancel').on('click', function () {
          _this.reject && _this.reject();
        });

        this.container.find('.btn-close.apply').on('click', function () {
          if (_this.container.find('.btn-close.apply').hasClass('disabled')) {
            return;
          }

          // apply all of the changes
          _this.applyBookmarkChanges();
          _this.applyLogoSharingChanges();

          _this.resolve && _this.resolve(_this.data.settings);

          _this.container.modal('hide');
        });
      }
    }, {
      key: 'detachEvents',
      value: function detachEvents() {
        this.container.find('.hc-logo-button').off('click');
        this.container.find('.hc-action-icon.hc-remove').off('click');
        this.container.find('.hc-action-icon.hc-settings').off('click');
        this.container.find('.hc-checkbox.bookmark-checkbox').off('click');
      }
    }, {
      key: 'applyBookmarkChanges',
      value: function applyBookmarkChanges() {
        // get the values and enabled/disabled.
        // how? Read through each one and apply what you see.
        var bookmarkNodes = this.container.find('.hc-row.bookmark-row');

        // these map 1-1 with the bookmarks so we're counting on the iterator to map up 1-1
        for (var i = 0; i < bookmarkNodes.length; i++) {
          var bookmarkNode = $(bookmarkNodes[i]);
          var bookmark = this.data.settings.bookmarks[i];

          if (!bookmark) {
            return;
          }

          var bookmarkValue = bookmarkNode.find('.hc-text-input.bookmark-text').val();
          var sanitizedBookmark = this.sanitizeValue(bookmarkValue);

          if (!sanitizedBookmark) {
            bookmarkNode.addClass('disabled');
          }

          if (bookmarkNode.hasClass('disabled')) {
            bookmark.status = 'disabled';
          } else {
            bookmark.status = 'visible';
          }

          bookmark.bookmark = sanitizedBookmark;
        }
      }
    }, {
      key: 'sanitizeValue',
      value: function sanitizeValue(text) {
        // Run the text through this to sanitize
        var sanitizedText = $('<div>' + text + '</div>').text();
        return sanitizedText;
      }
    }, {
      key: 'applyLogoSharingChanges',
      value: function applyLogoSharingChanges() {
        // that value is
        var checkbox = this.container.find('.hc-checkbox.social-checkbox');
        this.data.settings.social.enabled = checkbox.is(':checked');

        var isLogoEnabled = !this.container.find('.hc-logo').hasClass('hidden');
        this.data.settings.logo.enabled = isLogoEnabled;

        var logoLinkValue = this.container.find('.hc-text-input.logo-link').val();

        var sanitizedLogoLinkValue = this.sanitizeValue(logoLinkValue);
        // make sure it's a URL
        var logoLinkURL = _CommonHelper2.default.prependURLHTTP(sanitizedLogoLinkValue);
        this.data.settings.logo.link = logoLinkURL;

        // Logo is persisted when modified, it's more simple for dealing with the token for ArcGIS upload
        //let logoUrlValue = this.container.find('.hc-logo').attr('src');
        //this.data.settings.logo.url = logoUrlValue;

        var titleValue = this.container.find('.hc-text-input.link-title').val();
        var sanitizedTitleValue = this.sanitizeValue(titleValue);
        this.data.settings.link.title = sanitizedTitleValue;

        var linkValue = this.container.find('.hc-text-input.link-url').val();

        var sanitizedLinkValue = this.sanitizeValue(linkValue);
        // make sure it's a URL
        var linkURL = _CommonHelper2.default.prependURLHTTP(sanitizedLinkValue);
        this.data.settings.link.url = linkURL;
      }
    }, {
      key: 'attachToggleEvents',
      value: function attachToggleEvents() {
        var _this2 = this;

        var toggles = this.container.find('.toggle');
        var selectedClass = 'selected';

        toggles.on('click', function (event) {
          var target = $(event.currentTarget);
          var tabType = target.data('tab');

          toggles.removeClass(selectedClass);
          target.addClass(selectedClass);

          _this2.container.find('.modal-tab').removeClass(selectedClass);
          _this2.container.find('.modal-tab[data-tab="' + tabType + '"]').addClass(selectedClass);
        });
      }
    }, {
      key: 'attachBookmarkEvents',
      value: function attachBookmarkEvents() {
        this.attachEnableBookmarkEvent();
      }
    }, {
      key: 'attachLogoSharingEvents',
      value: function attachLogoSharingEvents() {
        this.attachRemoveLogoEvents();
        this.attachUseEsriLogoEvents();
        this.attachSelectLogoEvents();
        this.attachToggleTaglineLinkEvents();

        this.container.find('.hc-logo-upload-msg').removeClass('alert-success alert-warning alert-danger');
      }
    }, {
      key: 'attachToggleTaglineLinkEvents',
      value: function attachToggleTaglineLinkEvents() {
        var _this3 = this;

        var taglineTitle = this.container.find('.hc-text-input.link-title');

        taglineTitle.on('keyup', function (event) {
          var target = event.currentTarget;

          if (target.value.trim().length) {
            _this3.enableTaglineLink();
          } else {
            _this3.disableTaglineLink();
          }
        });
      }
    }, {
      key: 'enableTaglineLink',
      value: function enableTaglineLink() {
        var taglineLink = this.container.find('.hc-text-input.link-url');

        taglineLink.removeAttr('disabled');
        this.container.find('[data-toggle="tooltip"]').tooltip('disable');
      }
    }, {
      key: 'disableTaglineLink',
      value: function disableTaglineLink() {
        var taglineLink = this.container.find('.hc-text-input.link-url');

        taglineLink.attr('disabled', '');
        this.container.find('[data-toggle="tooltip"]').tooltip('enable');
      }
    }, {
      key: 'enableLogo',
      value: function enableLogo() {
        var hiddenClass = 'hidden';

        this.container.find('.hc-logo-button').addClass(hiddenClass);
        this.container.find('.hc-logo').removeClass(hiddenClass);
        this.container.find('.hc-action-icon.hc-remove').removeClass(hiddenClass);
        this.container.find('.hc-text-input.logo-link').removeAttr('disabled');
      }
    }, {
      key: 'attachUseEsriLogoEvents',
      value: function attachUseEsriLogoEvents() {
        var _this4 = this;

        this.container.find('.hc-logo-button').on('click', function () {
          // set to esri logo, and in the logo link as well
          _this4.container.find('.hc-logo').attr('src', _this4.esriLogoUrl);
          _this4.container.find('.hc-text-input.logo-link').val(_this4.esriLogoLink);

          _this4.data.settings.logo.url = _this4.esriLogoUrl;

          _this4.enableLogo();
        });
      }
    }, {
      key: 'attachRemoveLogoEvents',
      value: function attachRemoveLogoEvents() {
        var _this5 = this;

        this.container.find('.hc-action-icon.hc-remove').on('click', function (event) {
          var hiddenClass = 'hidden';
          var target = $(event.currentTarget);

          _this5.container.find('.hc-logo').addClass(hiddenClass);
          _this5.container.find('.hc-logo-button').removeClass(hiddenClass);
          _this5.container.find('.hc-text-input.logo-link').attr('disabled', '');

          _this5.container.find('.hc-logo').attr('src', '');

          target.addClass(hiddenClass);
        });
      }
    }, {
      key: 'attachSelectLogoEvents',
      value: function attachSelectLogoEvents() {
        var _this6 = this;

        this.container.find('.hc-action-icon.hc-settings').on('click', function () {

          //var existingCustomConfig = this.data.settings.logo.url && this.data.settings.logo.url != this.esriLogoUrl;
          // TODO: how store the source so that if user pick an image from Flickr the URL is not displayed in webpage?

          app.builder.mediaPicker.open({
            mode: 'add',
            authorizedMedia: ['image']
          }).then(function (selection) {
            if (selection.type === 'image') {
              var url = selection.image.url;

              if (selection.image.dataUrl && selection.image.uploadDeferred) {
                url = selection.image.dataUrl;

                _this6.data.settings.logo.url = '';

                _this6.container.find('.btn.apply').addClass('disabled');
                _this6.container.find('.hc-logo-upload-msg').html(_app2.default.builder.headerConfig.logoSharing.logoUploadProgress).addClass('alert-warning');

                selection.image.uploadDeferred.then(function (image) {
                  this.container.find('.hc-logo').attr('src', _Media2.default.addToken(image.url));
                  this.container.find('.btn.apply').removeClass('disabled');

                  this.container.find('.hc-logo-upload-msg').html(_app2.default.builder.headerConfig.logoSharing.logoUploadSuccess).removeClass('alert-warning').addClass('alert-success');

                  this.data.settings.logo.url = image.url;

                  setTimeout(function () {
                    this.container.find('.hc-logo-upload-msg').removeClass('alert-success');
                  }.bind(this), 2000);
                }.bind(_this6), function () {
                  var esriName = 'Esri';
                  // Remove the logo
                  this.container.find('.hc-action-icon.hc-remove').click();
                  this.container.find('.btn.apply').removeClass('disabled');

                  this.container.find('.hc-logo-upload-msg').removeClass('alert-warning').addClass('alert-danger').html(_app2.default.builder.headerConfig.logoSharing.logoUploadError.replace(/\${ESRI}/g, esriName));

                  setTimeout(function () {
                    this.container.find('.hc-logo-upload-msg').removeClass('alert-danger');
                  }.bind(this), 2000);
                }.bind(_this6));
              } else {
                _this6.data.settings.logo.url = url;
              }

              _this6.container.find('.hc-logo').attr('src', _Media2.default.addToken(url));
              _this6.enableLogo();
            }
          }, function () {
            //
          });
        });
      }
    }, {
      key: 'attachEnableBookmarkEvent',
      value: function attachEnableBookmarkEvent() {
        // clicking on the label will fire the checkbox click event
        this.container.find('.hc-checkbox.bookmark-checkbox').on('click', function (event) {
          var target = $(event.currentTarget);
          var disabledClass = 'disabled';
          var row = target.closest('.hc-row.bookmark-row');

          // enable/disable the row and input box
          if (row.hasClass(disabledClass)) {
            row.removeClass(disabledClass);
            row.find('.hc-text-input.bookmark-text').removeAttr('disabled');
          } else {
            row.addClass(disabledClass);
            row.find('.hc-text-input.bookmark-text').attr('disabled', '');
          }
        });
      }
    }, {
      key: 'open',
      value: function open(data) {
        var _this7 = this;

        return new Promise(function (resolve, reject) {
          _this7.resolve = resolve;
          _this7.reject = reject;

          var bookmarkMaxCharacters = 20;
          var logoSharingMaxCharacters = 30;

          _this7.data = $.extend(true, {}, data);

          _this7.data.settings.bookmarks = _this7.data.settings.bookmarks.map(function (item) {
            // truncate the bookmark value as well
            item.bookmark = item.bookmark.substr(0, bookmarkMaxCharacters);
            return item;
          });

          // add "disabled" member for the UI -- but NOT to the original array!
          var bookmarkUI = _this7.data.settings.bookmarks.map(function (item) {
            return Object.assign({}, item, { disabled: item.status === 'disabled' });
          });

          var esriName = 'Esri';

          var logoSharingData = _lang2.default.clone({
            settings: _this7.data.settings,
            background: _this7.data.context.headerBackground,
            maxCharacters: logoSharingMaxCharacters,
            strings: _app2.default.builder.headerConfig.logoSharing,
            useEsriLogoString: _app2.default.builder.headerConfig.logoSharing.logoButton.replace(/\${ESRI}/g, esriName),
            emptyTagline: !_this7.data.settings.link.title
          });

          logoSharingData.settings.logo.url = _Media2.default.addToken(logoSharingData.settings.logo.url);

          var bookmarkData = {
            bookmarks: bookmarkUI,
            maxCharacters: bookmarkMaxCharacters,
            strings: _app2.default.builder.headerConfig.bookmarks
          };

          _this7.container.find('.modal-tab[data-tab="logo-sharing"]').html((0, _LogoSharing2.default)(logoSharingData));

          _this7.container.find('.modal-tab[data-tab="bookmarks"]').html((0, _Bookmark2.default)(bookmarkData));

          _this7.attachBookmarkEvents();
          _this7.attachLogoSharingEvents();

          _this7.container.modal();

          _this7.container.on('shown.bs.modal', function () {
            _this7.container.find('[data-toggle="tooltip"]').tooltip({
              container: 'body'
            });
            // disable the tooltip if there's a tagline.
            var linkTitle = _this7.container.find('.hc-text-input.link-title')[0];
            if (linkTitle && linkTitle.value.trim().length) {
              _this7.container.find('[data-toggle="tooltip"]').tooltip('disable');
            }
          });
        });
      }
    }]);

    return SettingsPopup;
  }();

  exports.default = SettingsPopup;
  module.exports = exports['default'];
});
//# sourceMappingURL=Popup.js.map
;
/*
| Copyright 2016 Esri
|
| Licensed under the Apache License, Version 2.0 (the "License");
| you may not use this file except in compliance with the License.
| You may obtain a copy of the License at
|
|    http://www.apache.org/licenses/LICENSE-2.0
|
| Unless required by applicable law or agreed to in writing, software
| distributed under the License is distributed on an "AS IS" BASIS,
| WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
| See the License for the specific language governing permissions and
| limitations under the License.
*/

define('storymaps/tpl/builder/BuilderView',[
  'lib-build/tpl!./BuilderView',
  'lib-build/less!./BuilderView',
  'storymaps-react/tpl/builder/Controller',

  'storymaps/common/builder/mediaPicker/MediaPickerPopup',
  'storymaps-react/tpl/builder/settings/Popup',

  'storymaps/common/utils/CommonHelper',
  'storymaps/common/builder/BuilderHelper',

  // Utils
  'dojo/Deferred',
  'dojo/topic',
  'dojo/_base/lang',
  'lib/color-thief/dist/color-thief.min'
], function(
  viewTpl,
  viewCss,
  Controller,

  MediaPickerPopup,
  SettingsPopup,

  CommonHelper,
  BuilderHelper,

  // Utils
  Deferred,
  topic,
  lang
) {
  var STORY_SHELL = {
    config: {
      author: {
        name: ''
      }
    },
    settings: {
      /*
      theme: {
        colors: {
          id: 'black-over-white-1',
          'text-main': '#000',
          'background-main': '#FFF'
        }
      },*/
      header: { }
    },
    template: {
      name: app.cfg.TPL_ID,
      createdWith: app.version,
      editedWith: app.version,
      dataVersion: '1.0.0'
    },
    sections: [ ]
  };

  return function BuilderView(Core, Builder) {
    $('#builder-views').append(viewTpl({ }));

    var _settingsPopup = null, // eslint-disable-line no-unused-vars
        _mediaPicker = null;

    this.init = function() {
      app.builder.pendingChanges = 0;

      // Media picker
      _mediaPicker = new MediaPickerPopup({
        container: $('.media-picker-popup')
      });
      app.builder.mediaPicker = _mediaPicker;

      _settingsPopup = new SettingsPopup({
        container: $('#settings-popup')
      });
      app.builder.settingsPopup = _settingsPopup;

      //
      // My Stories
      //

      //topic.subscribe('MY-STORIES-EDIT-MEDIA', myStoriesEditMedia);
      //topic.subscribe('MY-STORIES-EDIT-MAP', myStoriesEditMap);

      topic.subscribe('builder-section-update', onSectionUpdate);

      // Mhh
      topic.subscribe('tpl-ready', function() {
        updateCreditsPlaceholderVisibility();
        topic.publish('builder-story-title-update', app.Controller.getStoryTitle());
      });
    };

    this.appInitComplete = function() {
      var newStory = null;

      //
      // Start in fromScratch mode
      //
      if (! app.data.appItem &&
          (CommonHelper.getUrlParams().fromScratch !== undefined
          || CommonHelper.getUrlParams().fromscratch !== undefined)) {
        newStory = getBlankAppDataJSON({
          //title: 'Cascade created on ' + new Date().toLocaleDateString() + ' at ' + new Date().toLocaleTimeString(),
          //subtitle: 'Builder placeholder'
          title: '',
          subtitle: ''
        });

        app.data.appItem = {
          item: BuilderHelper.getBlankAppJSON(),
          data: {
            values: null
          }
        };

        // TODO: tmp - force a different item title
        app.data.title = app.data.appItem.item.title;
      }
      //
      // Start from a webmap or an empty item
      //
      else if (app.data.appItem && app.Controller.isStoryBlank()) {
        var webmapId = null,
            websceneId = null;

        if (app.data.appItem.data && app.data.appItem.data.values) {
          webmapId = app.data.appItem.data.values.webmap;
          websceneId = app.data.appItem.data.values.webscene;
        }

        newStory = getBlankAppDataJSON({
          webmapId: webmapId,
          websceneId: websceneId,
          title: app.data.appItem.item.title || '',
          subtitle: app.data.appItem.item.snippet || ''
        });
      }

      if (newStory) {
        app.data.appItem.data.values = newStory;
      }

      topic.subscribe('builder-story-title-update', function(title) {
        document.title = title;
      });

      //
      // Update some components that need to know if the story has a title yet
      //
      topic.publish('builder-story-title-update', app.Controller.getStoryTitle());

      if (! app.isProduction && CommonHelper.getUrlParams().debug == 'media-picker') {
        app.builder.mediaPicker.open({
          mode: 'add'
        }).then(
          function(selection) {
            console.log('selected media:', selection);
          },
          function() {
            //
          }
        );
      }
    };

    this.updateUI = function() {
      //
    };

    this.saveApp = function() {
      var storyData = Controller.serializeStory();

      app.data.title = app.Controller.getStoryTitle();
      app.data.appItem.data.values.sections = storyData;

      Builder.saveApp();
    };

    this.saveFailed = function(source) {
      if (source === 'DUPLICATE') {
        app.data.sections[0].showTitleError();
        app.Controller.navigateToSection({
          index: 0,
          animate: false
        });
      }
    };

    /*jshint -W098 */
    this.resize = function() {
      // On Firefox and share dialog is displayed
      /*
      if (has('ff') && $('#sharePopup').hasClass('in')) {
        _sharePopup.updateMyStoriesPosition();
      }
      */
    };

    function onSectionUpdate() {
      var sections = app.data.sections;

      if (! sections || ! sections.length) {
        return;
      }

      app.Controller.renderHeader();
      updateCreditsPlaceholderVisibility();
    }

    function updateCreditsPlaceholderVisibility() {
      var sections = app.data.sections;

      if (! sections || ! sections.length) {
        return;
      }

      //
      // Update the visibility of credits-placeholder section
      // - not visible if there is a credits section
      // - visible if no credits and
      //    - there is more than 2 sections (excluding credits-placeholder)
      //    - 2 sections and the second section is
      //      - an immersive
      //      - a sequence with 2 or more complete blocks
      //

      var lastSection = sections[sections.length - 1];

      if (lastSection && lastSection.type == 'credits') {
        sections[sections.length - 2].setVisibility(false);
      }
      else {
        var isVisible = sections.length > 3;

        if (! isVisible) {
          if (sections[1].type == 'immersive') {
            isVisible = true;
          }
          else if (sections[1].type == 'sequence') {
            if (sections[1].getNumberOfBlocks() >= 3) {
              isVisible = true;
            }
          }
        }

        sections[sections.length - 1].setVisibility(isVisible);
      }
    }

    function getBlankAppDataJSON(params) {
      var story = lang.clone(STORY_SHELL);

      //story.config.author.name = app.portal.getPortalUser().fullName;

      var firstSectionBlocks = [
        {
          type: 'text',
          text: {
            value: '<p class="block block-placeholder"></p>'
          }
        }
      ];

      if (params.webmapId) {
        firstSectionBlocks = [
          /* todo webmap title? */
          app.ui.MediaFactory.createInstance({
            type: 'webmap',
            webmap: {
              id: params.webmapId
            }
          }).serialize()
        ];
      }
      else if (params.websceneId) {
        firstSectionBlocks = [
          /* todo webscene title? */
          app.ui.MediaFactory.createInstance({
            type: 'webscene',
            webscene: {
              id: params.websceneId
            }
          }).serialize()
        ];
      }

      story.sections = [
        app.ui.SectionFactory.createInstance({
          type: 'cover',
          foreground: {
            title: params.title,
            subtitle: params.subtitle
          }
        }).serialize(),
        app.ui.SectionFactory.createInstance({
          type: 'sequence',
          background: app.ui.MediaFactory.createInstance({
            type: 'color',
            color: {
              value: '#FFF'
            }
          }).serialize(),
          foreground: {
            blocks: firstSectionBlocks
          }
        }).serialize()
      ];

      return story;
    }
  };
});

require([
  'storymaps/common/Core',

  // Load some factory that are loaded dynamically and would not be included in build otherwise
  'storymaps-react/tpl/view/media/FactoryBuilder',
  'storymaps-react/tpl/view/section/FactoryBuilder',
  'storymaps/tpl/view/section/Immersive/PanelFactoryBuilder',

  'storymaps/tpl/core/MainView',
  'storymaps/common/builder/Builder',
  'storymaps/tpl/builder/BuilderView'
], function() {
    // Nothing here
});

define("storymaps/tpl/BuildConfigBuilder", function(){});

